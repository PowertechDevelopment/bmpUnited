
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="b7475c6e-f46a-55d0-bf68-6170192b4ace")}catch(e){}}();
(()=>{var Bb=Object.create;var Du=Object.defineProperty;var Mb=Object.getOwnPropertyDescriptor;var Gb=Object.getOwnPropertyNames;var Ub=Object.getPrototypeOf,Vb=Object.prototype.hasOwnProperty;var ni=(r,e)=>()=>(r&&(e=r(r=0)),e);var cm=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),ta=(r,e)=>{for(var t in e)Du(r,t,{get:e[t],enumerable:!0})},FA=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of Gb(e))!Vb.call(r,o)&&o!==t&&Du(r,o,{get:()=>e[o],enumerable:!(n=Mb(e,o))||n.enumerable});return r};var ml=(r,e,t)=>(t=r!=null?Bb(Ub(r)):{},FA(e||!r||!r.__esModule?Du(t,"default",{value:r,enumerable:!0}):t,r)),ra=r=>FA(Du({},"__esModule",{value:!0}),r);var wA={};ta(wA,{ByteBuffer:()=>bn});var dm,DA,bn,Nc=ni(()=>{dm=new Int32Array(1),DA=new Float32Array(dm.buffer),bn=class r{constructor(e){if(e&&!(e instanceof Uint8Array))throw new Error("Must initialize a ByteBuffer with a Uint8Array");this._data=e||new Uint8Array(256),this._index=0,this._start=0,this.length=e?e.length:0}extendWindowTo(e){this._index=e._index}getNewWindowFromRight(){let e=new r(this._data);return e._index=this._index,e._start=this._index,e}windowToUint8Array(){return this._data.subarray(this._start,this._index)}toUint8Array(){return this._data.subarray(0,this.length)}readByte(){if(this._index+1>this._data.length)throw new Error("Index out of bounds");return this._data[this._index++]}readByteArray(){let e=this.readVarUint(),t=this._index,n=t+e;if(n>this._data.length)throw new Error("Read array out of bounds");this._index=n;let o=new Uint8Array(e);return o.set(this._data.subarray(t,n)),o}readVarFloat(){let e=this._index,t=this._data,n=t.length;if(e+1>n)throw new Error("Index out of bounds");let o=t[e];if(o===0)return this._index=e+1,0;if(e+4>n)throw new Error("Index out of bounds");let i=o|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24;return this._index=e+4,i=i<<23|i>>>9,dm[0]=i,DA[0]}readVarUint(){let e=0,t=0;do{var n=this.readByte();e|=(n&127)<<t,t+=7}while(n&128&&t<35);return e>>>0}readVarInt(){let e=this.readVarUint()|0;return e&1?~(e>>>1):e>>>1}readVarUint64Bin(){let e=0,t="";do{var n=this.readByte();if(e<8){let o=((n&127)>>>0).toString(2);t=(n&128?o.padStart(7,"0"):o)+t}else{t=n.toString(2)+t;break}e+=1}while(n&128);return t}readVarUint64(){return this.convertBase(this.readVarUint64Bin(),2,10)}readVarInt64(){let e=this.readVarUint64Bin();if(e.slice(-1)=="1"){let t=this.parseToDigitsArray(e.slice(0,-1),2);return t=this.add(t,[1],2),"-"+this.convertBase(this.parseFromDigitsArray(t,2),2,10)}else return this.convertBase(e.slice(0,-1),2,10)}readString(){let e="";for(;;){let t,n=this.readByte();if(n<192)t=n;else{let o=this.readByte();if(n<224)t=(n&31)<<6|o&63;else{let i=this.readByte();if(n<240)t=(n&15)<<12|(o&63)<<6|i&63;else{let a=this.readByte();t=(n&7)<<18|(o&63)<<12|(i&63)<<6|a&63}}}if(t===0)break;t<65536?e+=String.fromCharCode(t):(t-=65536,e+=String.fromCharCode((t>>10)+55296,(t&1023)+56320))}return e}_growBy(e){if(this.length+e>this._data.length){let t=new Uint8Array(this.length+e<<1);t.set(this._data),this._data=t}this.length+=e}writeByte(e){let t=this.length;this._growBy(1),this._data[t]=e}overwriteByte(e){this._data[this._index]=e,this._index+=1}writeByteArray(e){this.writeVarUint(e.length);let t=this.length;this._growBy(e.length),this._data.set(e,t)}writeVarFloat(e){let t=this.length;DA[0]=e;let n=dm[0];if(n=n>>>23|n<<9,(n&255)===0){this.writeByte(0);return}this._growBy(4);let o=this._data;o[t]=n,o[t+1]=n>>8,o[t+2]=n>>16,o[t+3]=n>>24}writeVarUint(e){do{let t=e&127;e>>>=7,this.writeByte(e?t|128:t)}while(e)}writeVarInt(e){this.writeVarUint(e<<1^e>>31)}writeVarUint64Helper(e){if(e){var t=0;do{if(t<8){var n=parseInt(e.slice(-7),2);e=e.slice(0,-7)}else{var n=parseInt(e.slice(-8),2);e=e.slice(0,-8),this.writeByte(n);break}this.writeByte(e?n|128:n),t+=1}while(e)}}writeVarUint64(e){e=this.cleanNumericString(e);let t=this.convertBase(e,10,2);this.writeVarUint64Helper(t)}subtractOne(e){let t=1,n=e.split("").map(Number);for(let o=n.length-1;o>=0;o--)if(n[o]<t)n[o]=1;else{n[o]--,t=0;break}return n.join("").replace(/^0+/,"")}cleanNumericString(e){let t="";for(let n=0;n<e.length;n++){let o=e.charAt(n);(o>="0"&&o<="9"||n===0&&o==="-")&&(t+=o)}return t}writeVarInt64(e){if(e=this.cleanNumericString(e),e!=""){if(e[0]!="-")var t=this.convertBase(e,10,2)+"0";else{var t=this.convertBase(e.slice(1),10,2);if(t=="0"||t==""){this.writeVarUint64("0");return}t=this.subtractOne(t)+"1"}this.writeVarUint64Helper(t)}}add(e,t,n){let o=[],i=Math.max(e.length,t.length),a=0,s=0;for(;s<i||a;){let l=s<e.length?e[s]:0,d=s<t.length?t[s]:0,c=a+l+d;o.push(c%n),a=Math.floor(c/n),s++}return o}multiplyByNumber(e,t,n){if(e<0)return[];if(e===0)return[];let o=[],i=t;for(;e&1&&(o=this.add(o,i,n)),e=e>>1,e!==0;)i=this.add(i,i,n);return o}parseToDigitsArray(e,t){let n=e.toString().split(""),o=[];for(let i=n.length-1;i>=0;i--){let a=parseInt(n[i],t);if(isNaN(a))return[];o.push(a)}return o}parseFromDigitsArray(e,t){let n="";for(let o=e.length-1;o>=0;o--)n+=e[o].toString(t);return n}convertBase(e,t,n){let o=this.parseToDigitsArray(e,t);if(o===null)return"";let i=[0],a=[1];for(let s=0;s<o.length;s++)o[s]&&(i=this.add(i,this.multiplyByNumber(o[s],a,n),n)),a=this.multiplyByNumber(t,a,n);return this.parseFromDigitsArray(i,n)}writeString(e){let t;for(let n=0;n<e.length;n++){let o=e.charCodeAt(n);if(n+1===e.length||o<55296||o>=56320)t=o;else{let i=e.charCodeAt(++n);t=(o<<10)+i+-56613888}if(t===0)throw new Error("Cannot encode a string containing the null character");t<128?this.writeByte(t):(t<2048?this.writeByte(t>>6&31|192):(t<65536?this.writeByte(t>>12&15|224):(this.writeByte(t>>18&7|240),this.writeByte(t>>12&63|128)),this.writeByte(t>>6&63|128)),this.writeByte(t&63|128))}this.writeByte(0)}redactString(e){let t=this._index,n=this.readString(),o=this._index,i=n.length>=2&&n[0]==='"'&&n[n.length-1]==='"',a=i?n.substring(1,n.length-1):n;if(e.test(a.toLowerCase()))return;let s="*".repeat(o-t-1);i&&(s=`"${s.substring(1,s.length-1)}"`),this._index=t;let l;for(let d=0;d<s.length;d++){let c=s.charCodeAt(d);if(d+1===s.length||c<55296||c>=56320)l=c;else{let p=s.charCodeAt(++d);l=(c<<10)+p+-56613888}if(l===0)throw new Error("Cannot encode a string containing the null character");l<128?this.overwriteByte(l):(l<2048?this.overwriteByte(l>>6&31|192):(l<65536?this.overwriteByte(l>>12&15|224):(this.overwriteByte(l>>18&7|240),this.overwriteByte(l>>12&63|128)),this.overwriteByte(l>>6&63|128)),this.overwriteByte(l&63|128))}this.overwriteByte(0),this._index=o}}});var um,gs,pm=ni(()=>{um=class{constructor(){this._float=new Float32Array(1),this._int=new Int32Array(this._float.buffer),this._value=0}reset(){this._value=0}value(){return this._value}hashStr(e){for(var t=0;t<e.length;++t)this.hashI(e.codePointAt(t)||0)}hashBool(e){this.hashI(e?1:0)}hashBytes(e){for(var t=0;t<e.length;++t)this.hashI(e[t])}hashF(e){this._float[0]=e,this._value=this._combine(this._value,this._int[0])}hashI(e){this._value=this._combine(this._value,e)}_combine(e,t){return t+2654435769+(e<<6)+(e>>2)}},gs=class{constructor(e){this._helper=new um,this._bb=e}bb(){return this._bb}windowToUint8Array(){return this._bb.windowToUint8Array()}value(){return this._helper.value()}readByte(){let e=this._bb.readByte();return this._helper.hashI(e),e}readByteArray(){let e=this._bb.readByteArray();return this._helper.hashBytes(e),e}readVarFloat(){let e=this._bb.readVarFloat();return this._helper.hashF(e),e}readVarUint(){let e=this._bb.readVarUint();return this._helper.hashI(e),e}readVarInt(){let e=this._bb.readVarInt();return this._helper.hashI(e),e}readVarUint64(){let e=this._bb.readVarUint64();return this._helper.hashStr(e),e}readVarInt64(){let e=this._bb.readVarInt64();return this._helper.hashStr(e),e}readString(){let e=this._bb.readString();return this._helper.hashStr(e),e}}});var wa,_m=ni(()=>{wa=class{constructor(e,t){this._buckets=new Map,this._hash=e,this._equals=t}get(e,t){let n=this._hash(e),o=this._buckets.get(n);if(o!==void 0)for(let i=0;i<o.length;++i){let a=o[i];if(this._equals(e,a.key))return a.value}return t}set(e,t){let n=this._hash(e),o=this._buckets.get(n);o===void 0&&(o=[],this._buckets.set(n,o));for(let i=0;i<o.length;++i){let a=o[i];if(this._equals(e,a.key))return a.value=t,t}return o.push({key:e,value:t}),t}remove(e){let t=this._hash(e),n=this._buckets.get(t);if(n!==void 0){for(let o=0;o<n.length;++o)if(this._equals(e,n[o].key)){n.splice(o,1),n.length===0&&this._buckets.delete(t);break}}}}});function Ze(r){return JSON.stringify(r)}function pr(r,e,t){var n=new Error(r);throw n.line=e,n.column=t,n}var Pc=ni(()=>{});var MA={};ta(MA,{nativeTypes:()=>xA,parseSchema:()=>Fc,reservedNames:()=>BA});function eN(r){let e=r.split(kb),t=[],n=0,o=0;for(let[i,a]of e.entries()){i&1?Hb.test(a)||t.push({text:a,line:o+1,column:n+1}):a!==""&&pr("Syntax error "+Ze(a),o+1,n+1);let s=a.split(`
`);s.length>1&&(n=0),o+=s.length-1,n+=s[s.length-1].length}return t.push({text:"",line:o,column:n}),t}function tN(r){function e(){return r[s]}function t(l){return l.test(e().text)?(s++,!0):!1}function n(l,d){if(!t(l)){let c=e();pr("Expected "+d+" but found "+Ze(c.text),c.line,c.column)}}function o(){let l=e();pr("Unexpected token "+Ze(l.text),l.line,l.column)}let i=[],a=null,s=0;for(t(jb)&&(a=e().text,n(wu,"identifier"),n(LA,'";"'));s<r.length&&!t(Wb);){let l=[],d;t(qb)?d="ENUM":t(Zb)?d="STRUCT":t(Jb)?d="MESSAGE":o();let c=e();for(n(wu,"identifier"),n(Yb,'"{"');!t(Qb);){let p=null,u=!1,_=!1;d!=="ENUM"&&(p=e().text,n(wu,"identifier"),u=t(Xb));let h=e();n(wu,"identifier");let S=null;d!=="STRUCT"&&(n(zb,'"="'),S=e(),n(Kb,"integer"),(+S.text|0)+""!==S.text&&pr("Invalid integer "+Ze(S.text),S.line,S.column));let m=e();t($b)&&(d!=="MESSAGE"&&pr("Cannot deprecate this field",m.line,m.column),_=!0),n(LA,'";"'),l.push({name:h.text,line:h.line,column:h.column,type:p,isArray:u,isDeprecated:_,value:S!==null?+S.text|0:l.length+1})}i.push({name:c.text,line:c.line,column:c.column,kind:d,fields:l})}return{package:a,definitions:i}}function rN(r){let e=xA.slice(),t={};for(let i of r.definitions)e.indexOf(i.name)!==-1&&pr("The type "+Ze(i.name)+" is defined twice",i.line,i.column),BA.indexOf(i.name)!==-1&&pr("The type name "+Ze(i.name)+" is reserved",i.line,i.column),e.push(i.name),t[i.name]=i;for(let i of r.definitions){let a=i.fields;if(i.kind==="ENUM"||a.length===0)continue;for(let l of a)e.indexOf(l.type)===-1&&pr("The type "+Ze(l.type)+" is not defined for field "+Ze(l.name),l.line,l.column);let s=[];for(let l of a)s.indexOf(l.value)!==-1&&pr("The id for field "+Ze(l.name)+" is used twice",l.line,l.column),l.value<=0&&pr("The id for field "+Ze(l.name)+" must be positive",l.line,l.column),l.value>a.length&&pr("The id for field "+Ze(l.name)+" cannot be larger than "+a.length,l.line,l.column),s.push(l.value)}let n={},o=i=>{let a=t[i];if(a&&a.kind==="STRUCT"&&(n[i]===1&&pr("Recursive nesting of "+Ze(i)+" is not allowed",a.line,a.column),n[i]!==2&&a)){n[i]=1;for(let s of a.fields)s.isArray||o(s.type);n[i]=2}return!0};for(let i of r.definitions)o(i.name)}function Fc(r){let e=tN(eN(r));return rN(e),e}var xA,BA,kb,wu,Hb,zb,Wb,LA,Kb,Yb,Qb,Xb,qb,Zb,Jb,jb,$b,Lu=ni(()=>{Pc();xA=["bool","byte","float","int","string","uint","int64","uint64"],BA=["ByteBuffer","package"],kb=/((?:-|\b)\d+\b|[=;{}]|\[\]|\[deprecated\]|\b[A-Za-z_][A-Za-z0-9_]*\b|\/\/.*|\s+)/g,wu=/^[A-Za-z_][A-Za-z0-9_]*$/,Hb=/^\/\/.*|\s+$/,zb=/^=$/,Wb=/^$/,LA=/^;$/,Kb=/^-?\d+$/,Yb=/^\{$/,Qb=/^\}$/,Xb=/^\[\]$/,qb=/^enum$/,Zb=/^struct$/,Jb=/^message$/,jb=/^package$/,$b=/^\[deprecated\]$/});var GA={};ta(GA,{decodeBinarySchema:()=>Dc,encodeBinarySchema:()=>nN});function Dc(r){let e=r instanceof bn?r:new bn(r),t=e.readVarUint(),n=[];for(let o=0;o<t;o++){let i=e.readString(),a=e.readByte(),s=e.readVarUint(),l=[];for(let d=0;d<s;d++){let c=e.readString(),p=e.readVarInt(),u=!!(e.readByte()&1),_=e.readVarUint();l.push({name:c,line:0,column:0,type:mm[a]==="ENUM"?null:p,isArray:u,isDeprecated:!1,value:_})}n.push({name:i,line:0,column:0,kind:mm[a],fields:l})}for(let o=0;o<t;o++)for(let i of n[o].fields){let a=i.type;if(a!==null&&a<0){if(~a>=hm.length)throw new Error("Invalid type "+a);i.type=hm[~a]}else{if(a!==null&&a>=n.length)throw new Error("Invalid type "+a);i.type=a===null?null:n[a].name}}return{package:null,definitions:n}}function nN(r){let e=new bn,t=r.definitions,n={};e.writeVarUint(t.length);for(let o=0;o<t.length;o++)n[t[o].name]=o;for(let o of t){e.writeString(o.name),e.writeByte(mm.indexOf(o.kind)),e.writeVarUint(o.fields.length);for(let i of o.fields){let a=hm.indexOf(i.type);e.writeString(i.name),e.writeVarInt(a===-1?n[i.type]:~a),e.writeByte(i.isArray?1:0),e.writeVarUint(i.value)}}return e.toUint8Array()}var hm,mm,xu=ni(()=>{Nc();hm=["bool","byte","int","uint","float","string","int64","uint64"],mm=["ENUM","STRUCT","MESSAGE"]});var VA={};ta(VA,{compileSchema:()=>fm,compileSchemaJS:()=>UA});function oN(r,e,t){let n=[],o="  ";n.push("function(bb) {"),n.push("  if (!(bb instanceof this.ByteBuffer)) {"),n.push("    bb = new this.ByteBuffer(bb);"),n.push("  }"),n.push(""),r.kind==="MESSAGE"&&(n.push("  while (true) {"),n.push("  var x = bb.readVarUint();"),n.push("    switch (x) {"),n.push("    case 0:"),n.push("      return;"),n.push(""),o="      ");for(let i of r.fields){let a;switch(i.type){case"bool":{a="!!bb.readByte()";break}case"byte":{a="bb.readByte()";break}case"int":{a="bb.readVarInt()";break}case"uint":{a="bb.readVarUint()";break}case"int64":{a="bb.readVarInt64()";break}case"uint64":{a="bb.readVarUint64()";break}case"float":{a="bb.readVarFloat()";break}case"string":{t.has(i.name)?a="bb.redactString(this.shouldIgnoreForRedaction)":a="bb.readString()";break}default:{let s=e[i.type];s?s.kind==="ENUM"?a=`this[${Ze(s.name)}][bb.readVarUint()]`:a=`this[${Ze("redact"+s.name)}](bb)`:pr(`Invalid type ${Ze(i.type)} for field ${Ze(i.name)}`,i.line,i.column)}}r.kind==="MESSAGE"&&n.push(`    case ${i.value}:`),i.isArray?i.isDeprecated?i.type==="byte"?n.push(o+"bb.readByteArray();"):(n.push(o+"var length = bb.readVarUint();"),n.push(o+`while (length-- > 0) ${a};`)):i.type==="byte"?n.push(o+"bb.readByteArray();"):(n.push(o+"var values = null;"),n.push(o+"if (values === null) {"),n.push(o+"  var length = bb.readVarUint();"),n.push(o+"  var values = Array(length);"),n.push(o+`  for (var i = 0; i < length; i++) values[i] = ${a};`),n.push(o+"}")):i.isDeprecated?n.push(o+`${a};`):n.push(o+`${a};`),r.kind==="MESSAGE"&&(n.push("      break;"),n.push(""))}return r.kind==="MESSAGE"&&(n.push("    default:"),n.push('      throw new Error("Attempted to parse invalid message");'),n.push("    }"),n.push("  }")),n.push("}"),n.join(`
`)}function iN(r,e,t,n){let o=[],i="  ";o.push("function(bb, optDedupCache) {"),o.push("  var dedupKey = null;"),t.includes(r.name)&&(o.push("  if (!!optDedupCache) {"),o.push("    if (!(optDedupCache instanceof this.HashTable)) {"),o.push('      throw new Error("optDedupCache must be instance of HashTable");'),o.push("    }"),o.push("    // lookahead with hasher then reference result with dedup cache"),o.push("    var hasher = new this.Hasher(bb.getNewWindowFromRight());"),o.push(`    this[${Ze("hash"+r.name)}](hasher);`),o.push(`    dedupKey = { hash: hasher.value(), data: hasher.windowToUint8Array(), defName: ${Ze(r.name)} };`),o.push("    var cachedResult = optDedupCache.get(dedupKey, null);"),o.push("    if (cachedResult !== null) {"),o.push("      bb.extendWindowTo(hasher.bb());"),o.push("      return cachedResult;"),o.push("    }"),o.push("  }")),o.push("  var result = {};"),o.push("  if (!(bb instanceof this.ByteBuffer)) {"),o.push("    bb = new this.ByteBuffer(bb);"),o.push("  }"),o.push(""),r.kind==="MESSAGE"&&(o.push("  while (true) {"),o.push("  var x = bb.readVarUint();"),o.push("    switch (x) {"),o.push("    case 0:"),o.push("      return dedupKey !== null ? optDedupCache.set(dedupKey, result) : result;"),o.push(""),i="      ");for(let a of r.fields){let s,l;switch(a.type){case"bool":{s="!!bb.readByte()",l="!!hasher.readByte()";break}case"byte":{s="bb.readByte()",l="hasher.readByte()";break}case"int":{s="bb.readVarInt()",l="hasher.readVarInt()";break}case"uint":{s="bb.readVarUint()",l="hasher.readVarUint()";break}case"int64":{s="bb.readVarInt64()",l="hasher.readVarInt64()";break}case"uint64":{s="bb.readVarUint64()",l="hasher.readVarUint64()";break}case"float":{s="bb.readVarFloat()",l="hasher.readVarFloat()";break}case"string":{s="bb.readString()",l="hasher.readString()";break}default:{let d=e[a.type];d?d.kind==="ENUM"?(s=`this[${Ze(d.name)}][bb.readVarUint()]`,l=`this[${Ze(d.name)}][hasher.readVarUint()]`):(s=`this[${Ze("decode"+d.name)}](bb, optDedupCache || null)`,l=`this[${Ze("hash"+d.name)}](hasher)`):pr(`Invalid type ${Ze(a.type)} for field ${Ze(a.name)}`,a.line,a.column)}}r.kind==="MESSAGE"&&o.push(`    case ${a.value}:`),a.isArray?a.isDeprecated?a.type==="byte"?o.push(i+"bb.readByteArray();"):(o.push(i+"var length = bb.readVarUint();"),o.push(i+`while (length-- > 0) ${s};`)):a.type==="byte"?o.push(i+`result[${Ze(a.name)}] = bb.readByteArray();`):(o.push(i+"var arrayDedupKey = null;"),o.push(i+"var values = null;"),n.includes(a.type)&&(o.push(i+"if (!!optDedupCache) {"),o.push(i+"  // lookahead with hasher then reference result with dedup cache"),o.push(i+"  var hasher = new this.Hasher(bb.getNewWindowFromRight());"),o.push(i+"  var length = hasher.readVarUint();"),o.push(i+`  for (var i = 0; i < length; i++) ${l};`),o.push(i+`  arrayDedupKey = { hash: hasher.value(), data: hasher.windowToUint8Array(), defName: ${Ze(a.type+"[]")} };`),o.push(i+"  var cachedResult = optDedupCache.get(arrayDedupKey, null);"),o.push(i+"  if (cachedResult !== null) {"),o.push(i+"    bb.extendWindowTo(hasher.bb());"),o.push(i+"    values = cachedResult;"),o.push(i+"  }"),o.push(i+"}")),o.push(i+"if (values === null) {"),o.push(i+"  var length = bb.readVarUint();"),o.push(i+"  var values = Array(length);"),o.push(i+`  for (var i = 0; i < length; i++) values[i] = ${s};`),o.push(i+"  if (arrayDedupKey !== null) { optDedupCache.set(arrayDedupKey, values); }"),o.push(i+"}"),o.push(i+`result[${Ze(a.name)}] = values;`)):a.isDeprecated?o.push(i+`${s};`):o.push(i+`result[${Ze(a.name)}] = ${s};`),r.kind==="MESSAGE"&&(o.push("      break;"),o.push(""))}return r.kind==="MESSAGE"?(o.push("    default:"),o.push('      throw new Error("Attempted to parse invalid message");'),o.push("    }"),o.push("  }")):o.push("  return dedupKey !== null ? optDedupCache.set(dedupKey, result) : result;"),o.push("}"),o.join(`
`)}function aN(r,e){let t=[],n="  ";t.push("function(hasher) {"),t.push("  var result = {};"),t.push("  if (!(hasher instanceof this.Hasher)) {"),t.push('    throw new Error("Expected Hasher");'),t.push("  }"),t.push(""),r.kind==="MESSAGE"&&(t.push("  while (true) {"),t.push("    switch (hasher.readVarUint()) {"),t.push("    case 0:"),t.push("      return;"),t.push(""),n="      ");for(let o of r.fields){let i;switch(o.type){case"bool":{i="hasher.readByte()";break}case"byte":{i="hasher.readByte()";break}case"int":{i="hasher.readVarInt()";break}case"uint":{i="hasher.readVarUint()";break}case"int64":{i="hasher.readVarInt64()";break}case"uint64":{i="hasher.readVarUint64()";break}case"float":{i="hasher.readVarFloat()";break}case"string":{i="hasher.readString()";break}default:{let a=e[o.type];a?a.kind==="ENUM"?i="hasher.readVarUint()":i=`this[${Ze("hash"+a.name)}](hasher)`:pr(`Invalid type ${Ze(o.type)} for field ${Ze(o.name)}`,o.line,o.column)}}r.kind==="MESSAGE"&&t.push(`    case ${o.value}:`),o.isArray?o.type==="byte"?t.push(n+"hasher.readByteArray();"):(t.push(n+"var length = hasher.readVarUint();"),t.push(n+`while (length-- > 0) ${i};`)):t.push(n+`${i};`),r.kind==="MESSAGE"&&(t.push("      break;"),t.push(""))}return r.kind==="MESSAGE"?(t.push("    default:"),t.push('      throw new Error("Attempted to parse invalid message");'),t.push("    }"),t.push("  }")):t.push("  return;"),t.push("}"),t.join(`
`)}function sN(r,e){let t=[];t.push("function(message, bb) {"),t.push("  var isTopLevel = !bb;"),t.push("  if (isTopLevel) bb = new this.ByteBuffer();");for(let n of r.fields){let o;if(!n.isDeprecated){switch(n.type){case"bool":{o="bb.writeByte(value);";break}case"byte":{o="bb.writeByte(value);";break}case"int":{o="bb.writeVarInt(value);";break}case"uint":{o="bb.writeVarUint(value);";break}case"int64":{o="bb.writeVarInt64(value);";break}case"uint64":{o="bb.writeVarUint64(value);";break}case"float":{o="bb.writeVarFloat(value);";break}case"string":{o="bb.writeString(value);";break}default:{let i=e[n.type];if(i)i.kind==="ENUM"?o=`var encoded = this[${Ze(i.name)}][value]; if (encoded === void 0) throw new Error("Invalid value " + JSON.stringify(value) + ${Ze(" for enum "+Ze(i.name))}); bb.writeVarUint(encoded);`:o=`this[${Ze("encode"+i.name)}](value, bb);`;else throw new Error(`Invalid type ${Ze(n.type)} for field ${Ze(n.name)}`)}}t.push(""),t.push(`  var value = message[${Ze(n.name)}];`),t.push("  if (value != null) {"),r.kind==="MESSAGE"&&t.push(`    bb.writeVarUint(${n.value});`),n.isArray?n.type==="byte"?t.push("    bb.writeByteArray(value);"):(t.push("    var values = value, n = values.length;"),t.push("    bb.writeVarUint(n);"),t.push("    for (var i = 0; i < n; i++) {"),t.push("      value = values[i];"),t.push(`      ${o}`),t.push("    }")):t.push(`    ${o}`),r.kind==="STRUCT"&&(t.push("  } else {"),t.push(`    throw new Error(${Ze("Missing required field "+Ze(n.name))});`)),t.push("  }")}}return r.kind==="MESSAGE"&&t.push("  bb.writeVarUint(0);"),t.push(""),t.push("  if (isTopLevel) return bb.toUint8Array();"),t.push("}"),t.join(`
`)}function lN(r){return typeof r=="string"?Fc(r):r instanceof Uint8Array||r instanceof bn?Dc(r):r}function UA(r,e,t,n){r=lN(r);let o={},i=r.package,a=[];i!==null?a.push(`var ${i} = exports || ${i} || {}, exports;`):(a.push("var exports = exports || {};"),i="exports"),a.push(`${i}.ByteBuffer = ${i}.ByteBuffer || require("kiwi-schema").ByteBuffer;`),a.push(`${i}.shouldIgnoreForRedaction = ${(n==null?void 0:n.shouldIgnoreForRedaction)??/$^/};`);for(let s of r.definitions)o[s.name]=s;for(let s of r.definitions)switch(s.kind){case"ENUM":{let l={};for(let d of s.fields)l[d.name]=d.value,l[d.value]=d.name;a.push(`${i}[${Ze(s.name)}] = ${JSON.stringify(l,null,2)};`);break}case"STRUCT":case"MESSAGE":{a.push(""),a.push(`${i}[${Ze("decode"+s.name)}] = ${iN(s,o,e,t)};`),a.push(""),a.push(`${i}[${Ze("encode"+s.name)}] = ${sN(s,o)};`),a.push(""),a.push(`${i}[${Ze("hash"+s.name)}] = ${aN(s,o)};`),a.push(""),a.push(`${i}[${Ze("redact"+s.name)}] = ${oN(s,o,(n==null?void 0:n.sensitiveFields)??new Set)};`);break}default:pr("Invalid definition kind "+Ze(s.kind),s.line,s.column)}return a.push(""),a.join(`
`)}function cN(r,e){if(r.length!==e.length)return!1;for(let t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}function fm(r,e,t){let n={ByteBuffer:bn,Hasher:gs,HashTable:wa,makeDedupCache:()=>new wa(a=>a.hash,(a,s)=>a.defName===s.defName&&cN(a.data,s.data))},o=[],i=[];return e&&(o=e.filter(a=>!!a.match(/^[A-Za-z_][A-Za-z0-9_]*$/)),i=e.filter(a=>!!a.match(/^[A-Za-z_][A-Za-z0-9_]*\[\]$/)).map(a=>a.slice(0,a.length-2)),i.length+o.length!==e.length&&console.warn("Some definitions to dedup are invalid identifiers, skipping...")),new Function("exports",UA(r,o,i,t))(n),n}var gm=ni(()=>{Nc();pm();_m();Pc();Lu();xu()});var kA={};ta(kA,{KiwiCodec:()=>Bu,createKiwiCodec:()=>uN});function uN(r,e,t,n){return!r&&Am?fm(e,t,n):new Bu(e,t,n)}var Am,dN,Bu,HA=ni(()=>{Nc();pm();_m();gm();Lu();xu();dN=eval;try{Am=dN("true")}catch{Am=!1}Bu=class{constructor(e,t,n){this._definitions={};this._fieldValueToIndex={};this._enums={};typeof e=="string"?e=Fc(e):(e instanceof Uint8Array||e instanceof bn)&&(e=Dc(e));for(let o of e.definitions)this._definitions[o.name]=o;this._sensitiveFields=(n==null?void 0:n.sensitiveFields)??new Set,this._shouldIgnoreForRedaction=(n==null?void 0:n.shouldIgnoreForRedaction)??/$^/;for(let o of e.definitions)if(o.kind==="ENUM"){let i={};for(let a of o.fields)i[a.name]=a.value,i[a.value]=a.name;this._enums[o.name]=i,this[o.name]=i}else if(o.kind==="STRUCT"||o.kind==="MESSAGE"){if(this["decode"+o.name]=(i,a)=>this.decodeObject(o,i,a),this["encode"+o.name]=i=>this.encodeObject(o,i),this["redact"+o.name]=i=>this.redactObject(o,i),o.kind==="MESSAGE"){let i={};for(let a=0;a<o.fields.length;a++)i[o.fields[a].value]=a;this._fieldValueToIndex[o.name]=i}}else throw new Error(`Invalid definition kind ${o.kind}`);this._nonArrayDefinitionsToDedup=new Set,this._arrayDefinitionsToDedup=new Set,t&&(this._nonArrayDefinitionsToDedup=new Set(t.filter(o=>!!o.match(/^[A-Za-z_][A-Za-z0-9_]*$/))),this._arrayDefinitionsToDedup=new Set(t.filter(o=>!!o.match(/^[A-Za-z_][A-Za-z0-9_]*\[\]$/)).map(o=>o.slice(0,o.length-2))),this._arrayDefinitionsToDedup.size+this._nonArrayDefinitionsToDedup.size!==t.length&&console.warn("Some definitions to dedup are invalid identifiers, skipping..."))}decode(e,t,n){let o=this._definitions[e];if(o===void 0)throw new Error(`Invalid definition ${e}`);return this.decodeObject(o,t,n)}encode(e,t){let n=this._definitions[e];if(n===void 0)throw new Error(`Invalid definition ${e}`);return this.encodeObject(n,t)}decodeSingleField(e,t,n){switch(e.type){case"bool":return!!t.readByte();case"byte":return t.readByte();case"int":return t.readVarInt();case"uint":return t.readVarUint();case"int64":return t.readVarInt64();case"uint64":return t.readVarUint64();case"float":return t.readVarFloat();case"string":return t.readString();default:let o=this._definitions[e.type];if(!o)throw new Error(`Invalid type ${e.type}`);if(o.kind==="ENUM")return this._enums[e.type][t.readVarUint()];if(o.kind==="STRUCT"||o.kind==="MESSAGE")return this.decodeObject(o,t,n);throw new Error(`Invalid definition kind ${o.kind}`)}}encodeSingleField(e,t,n){switch(e.type){case"bool":n.writeByte(t);break;case"byte":n.writeByte(t);break;case"int":n.writeVarInt(t);break;case"uint":n.writeVarUint(t);break;case"int64":n.writeVarInt64(t);break;case"uint64":n.writeVarUint64(t);break;case"float":n.writeVarFloat(t);break;case"string":n.writeString(t);break;default:let o=this._definitions[e.type];if(!o)throw new Error(`Invalid type ${e.type}`);if(o.kind==="ENUM"){let i=this._enums[e.type][t];if(i===void 0)throw new Error("Invalid value "+JSON.stringify(t)+" for enum "+e.type);n.writeVarUint(i)}else if(o.kind==="STRUCT"||o.kind==="MESSAGE")this.encodeObject(o,t,n);else throw new Error(`Invalid definition kind ${o.kind}`);break}}hashSingleField(e,t){switch(e.type){case"bool":t.readByte();break;case"byte":t.readByte();break;case"int":t.readVarInt();break;case"uint":t.readVarUint();break;case"int64":t.readVarInt64();break;case"uint64":t.readVarUint64();break;case"float":t.readVarFloat();break;case"string":t.readString();break;default:let n=this._definitions[e.type];if(!n)throw new Error(`Invalid type ${e.type}`);if(n.kind==="ENUM")t.readVarUint();else if(n.kind==="STRUCT"||n.kind==="MESSAGE")this.hashObject(n,t);else throw new Error(`Invalid definition kind ${n.kind}`);break}}redactSingleField(e,t){switch(e.type){case"bool":t.readByte();break;case"byte":t.readByte();break;case"int":t.readVarInt();break;case"uint":t.readVarUint();break;case"int64":t.readVarInt64();break;case"uint64":t.readVarUint64();break;case"float":t.readVarFloat();break;case"string":this._sensitiveFields.has(e.name)?t.redactString(this._shouldIgnoreForRedaction):t.readString();break;default:let n=this._definitions[e.type];if(!n)throw new Error(`Invalid type ${e.type}`);if(n.kind==="ENUM")t.readVarUint();else if(n.kind==="STRUCT"||n.kind==="MESSAGE")this.redactObject(n,t);else throw new Error(`Invalid definition kind ${n.kind}`);break}}decodeArrayField(e,t,n){if(e.type==="byte")return t.readByteArray();let o=null,i=null;if(n&&this._arrayDefinitionsToDedup.has(e.type)){let a=new gs(t.getNewWindowFromRight()),s=a.readVarUint();for(let d=0;d<s;d++)this.hashSingleField(e,a);o={hash:a.value(),data:a.windowToUint8Array(),defName:e.type+"[]"};let l=n.get(o,null);l!==null&&(t.extendWindowTo(a.bb()),i=l)}if(i===null){let a=t.readVarUint();i=Array(a);for(let s=0;s<a;s++)i[s]=this.decodeSingleField(e,t,n);o!==null&&n.set(o,i)}return i}decodeObject(e,t,n){t instanceof bn||(t=new bn(t));let o=null;if(n&&this._nonArrayDefinitionsToDedup.has(e.name)){if(!(n instanceof wa))throw new Error("optDedupCache must be instance of HashTable");let a=new gs(t.getNewWindowFromRight());this.hashObject(e,a),o={hash:a.value(),data:a.windowToUint8Array(),defName:e.name};let s=n.get(o,null);if(s!==null)return t.extendWindowTo(a.bb()),s}let i={};if(e.kind==="MESSAGE")for(;;){let a=t.readVarUint();if(a===0)break;let s=this._fieldValueToIndex[e.name][a];if(s===void 0)throw new Error("Attempted to parse invalid message");let l=e.fields[s],d=l.isDeprecated?null:n,c=l.isArray?this.decodeArrayField(l,t,d):this.decodeSingleField(l,t,d);l.isDeprecated||(i[l.name]=c)}else for(let a of e.fields){let s=a.isDeprecated?null:n,l=a.isArray?this.decodeArrayField(a,t,s):this.decodeSingleField(a,t,s);a.isDeprecated||(i[a.name]=l)}return o!==null&&n.set(o,i),i}hashObject(e,t){if(e.kind==="MESSAGE")for(;;){let n=t.readVarUint();if(n===0)break;let o=this._fieldValueToIndex[e.name][n];if(o===void 0)throw new Error("Attempted to parse invalid message");let i=e.fields[o];if(i.isArray)if(i.type==="byte")t.readByteArray();else{let a=t.readVarUint();for(let s=0;s<a;s++)this.hashSingleField(i,t)}else this.hashSingleField(i,t)}else for(let n of e.fields)if(n.isArray)if(n.type==="byte")t.readByteArray();else{let o=t.readVarUint();for(let i=0;i<o;i++)this.hashSingleField(n,t)}else this.hashSingleField(n,t)}encodeObject(e,t,n){let o=!n;n||(n=new bn);for(let i of e.fields){if(i.isDeprecated)continue;let a=t[i.name];if(a!=null)if(e.kind==="MESSAGE"&&n.writeVarUint(i.value),i.isArray)if(i.type==="byte")n.writeByteArray(a);else{n.writeVarUint(a.length);for(let s=0;s<a.length;s++)this.encodeSingleField(i,a[s],n)}else this.encodeSingleField(i,a,n);else if(e.kind==="STRUCT")throw new Error("Missing required field "+i.name)}if(e.kind==="MESSAGE"&&n.writeVarUint(0),o)return n.toUint8Array()}redactObject(e,t){if(t instanceof bn||(t=new bn(t)),e.kind==="MESSAGE")for(;;){let n=t.readVarUint();if(n===0)break;let o=this._fieldValueToIndex[e.name][n];if(o===void 0)throw new Error("Attempted to parse invalid message");let i=e.fields[o];if(i.isArray)if(i.type==="byte")t.readByteArray();else{let a=t.readVarUint();for(let s=0;s<a;s++)this.redactSingleField(i,t)}else this.redactSingleField(i,t)}else for(let n of e.fields)if(n.isArray)if(n.type==="byte")t.readByteArray();else{let o=t.readVarUint();for(let i=0;i<o;i++)this.redactSingleField(n,t)}else this.redactSingleField(n,t)}makeDedupCache(){let e=(t,n)=>{if(t.length!==n.length)return!1;for(let o=0;o<t.length;o++)if(t[o]!==n[o])return!1;return!0};return new wa(t=>t.hash,(t,n)=>t.defName===n.defName&&e(t.data,n.data))}}});var QA={};ta(QA,{compileSchemaCallbackCPP:()=>_N});function pN(r,e,t){switch(e){case"bool":return{type:"bool ",name:t};case"byte":return{type:"uint8_t ",name:t};case"int":return{type:"int32_t ",name:t};case"uint":return{type:"uint32_t ",name:t};case"int64":return{type:"int64_t ",name:t};case"uint64":return{type:"uint64_t ",name:t};case"float":return{type:"float ",name:t};case"string":return{type:"const char *",name:t};default:{let n=r[e];return n.kind==="ENUM"?{type:n.name+" ",name:t}:null}}}function As(r,e,t,n){let o=[];for(let i of t){let a=e+i.name;if(i.isArray&&!n)return null;let s=pN(r,i.type,a);if(s!==null){o.push(s);continue}let l=r[i.type];if(l.kind!=="STRUCT")return null;let d=As(r,a+"_",l.fields,!1);if(d===null)return null;o.push.apply(o,d)}return o}function fl(r){return r.type+r.name}function KA(r){return r.name}function YA(r){switch(r.type){case"bool ":return`!bb.readBool(${r.name})`;case"uint8_t ":return`!bb.readByte(${r.name})`;case"int32_t ":return`!bb.readVarInt(${r.name})`;case"uint32_t ":return`!bb.readVarUint(${r.name})`;case"int64_t ":return`!bb.readVarInt64(${r.name})`;case"uint64_t ":return`!bb.readVarUint64(${r.name})`;case"float ":return`!bb.readVarFloat(${r.name})`;case"const char *":return`!bb.readString(${r.name})`;default:return`!bb.readVarUint(reinterpret_cast<uint32_t &>(${r.name}))`}}function zA(r){switch(r.type){case"bool ":return`_wb.writeBool(${r.name})`;case"uint8_t ":return`_wb.writeByte(${r.name})`;case"int32_t ":return`_wb.writeVarInt(${r.name})`;case"uint32_t ":return`_wb.writeVarUint(${r.name})`;case"int64_t ":return`_wb.writeVarInt64(${r.name})`;case"uint64_t ":return`_wb.writeVarUint64(${r.name})`;case"float ":return`_wb.writeVarFloat(${r.name})`;case"const char *":return`_wb.writeString(${r.name})`;default:return`_wb.writeVarUint(static_cast<uint32_t>(${r.name}))`}}function WA(r,e,t,n,o){let i=n.name;if(n.isArray){let s=`_${i}_count`;r.push(o+`uint32_t ${s};`),r.push(o+`if (!bb.readVarUint(${s})) return false;`),n.isDeprecated||r.push(o+`visitor.visit${t.name}_${n.name}_count(${s});`),r.push(o+`while (${s}-- > 0) {`),o+="  ",i+="_element"}let a=As(e,"",[n],!0);if(a!==null){for(let s of a)r.push(o+`${fl(s)};`);r.push(o+`if (${a.map(YA).join(" || ")}) return false;`),n.isDeprecated||r.push(o+`visitor.visit${t.name}_${i}(${a.map(KA).join(", ")});`)}else{n.isDeprecated||r.push(o+`visitor.visit${t.name}_${i}();`);let s=e[n.type];r.push(o+`if (!parse${s.name}(bb, visitor)) return false;`)}n.isArray&&r.push(o.slice(2)+"}")}function _N(r,e={}){let t={},n=[],o=e.includePrefix||"";for(let i of r.definitions)t[i.name]=i;r.package!==null&&(n.push(`#ifndef INCLUDE_${r.package.toUpperCase()}_H`),n.push(`#define INCLUDE_${r.package.toUpperCase()}_H`),n.push("")),n.push(`#include "${o}kiwi.h"`),n.push(""),r.package!==null&&(n.push(`namespace ${r.package} {`),n.push(""));for(let i of r.definitions)if(i.kind==="ENUM"){n.push(`enum class ${i.name} : uint32_t {`);for(let a of i.fields)a.isDeprecated||n.push(`  ${a.name} = ${a.value},`);n.push("};"),n.push("")}for(let i=0;i<2;i++){let a=") = 0;";i===0?(n.push("class Visitor {"),n.push("public:")):(n.push("class Writer : public Visitor {"),n.push("private:"),n.push("  kiwi::WriteBuffer &_wb;"),n.push("public:"),n.push("  Writer(kiwi::WriteBuffer &wb) : _wb(wb) {}"),a=") override;");for(let s of r.definitions){if(s.kind==="STRUCT"){let l=As(t,"",s.fields,!1);if(l!==null){n.push(`  virtual void visit${s.name}(${l.map(fl).join(", ")}${a}`);continue}}if(s.kind==="STRUCT"||s.kind==="MESSAGE"){n.push(`  virtual void begin${s.name}(${a}`);for(let l of s.fields){if(l.isDeprecated)continue;let d=l.name;l.isArray&&(n.push(`  virtual void visit${s.name}_${l.name}_count(uint32_t size${a}`),d+="_element");let c=As(t,"",[l],!0);c!==null?n.push(`  virtual void visit${s.name}_${d}(${c.map(fl).join(", ")}${a}`):n.push(`  virtual void visit${s.name}_${d}(${a}`)}n.push(`  virtual void end${s.name}(${a}`)}}n.push("};"),n.push("")}for(let i of r.definitions)(i.kind==="STRUCT"||i.kind==="MESSAGE")&&n.push(`bool parse${i.name}(kiwi::ByteBuffer &bb, Visitor &visitor);`);n.push(""),n.push("#ifdef IMPLEMENT_SCHEMA_H"),n.push("");for(let i of r.definitions)if(i.kind==="STRUCT"){let a=As(t,"",i.fields,!1);if(a!==null){n.push(`bool parse${i.name}(kiwi::ByteBuffer &bb, Visitor &visitor) {`);for(let s of a)n.push(`  ${fl(s)};`);n.push(`  if (${a.map(YA).join(" || ")}) return false;`),n.push(`  visitor.visit${i.name}(${a.map(KA).join(", ")});`),n.push("  return true;"),n.push("}"),n.push("")}else{n.push(`bool parse${i.name}(kiwi::ByteBuffer &bb, Visitor &visitor) {`),n.push(`  visitor.begin${i.name}();`);for(let s of i.fields)WA(n,t,i,s,"  ");n.push(`  visitor.end${i.name}();`),n.push("  return true;"),n.push("}"),n.push("")}}else if(i.kind==="MESSAGE"){n.push(`bool parse${i.name}(kiwi::ByteBuffer &bb, Visitor &visitor) {`),n.push(`  visitor.begin${i.name}();`),n.push("  while (true) {"),n.push("    uint32_t _type;"),n.push("    if (!bb.readVarUint(_type)) return false;"),n.push("    switch (_type) {"),n.push("      case 0: {"),n.push(`        visitor.end${i.name}();`),n.push("        return true;"),n.push("      }");for(let a of i.fields)n.push(`      case ${a.value}: {`),WA(n,t,i,a,"        "),n.push("        break;"),n.push("      }");n.push("      default: return false;"),n.push("    }"),n.push("  }"),n.push("}"),n.push("")}for(let i of r.definitions){if(i.kind==="STRUCT"){let a=As(t,"",i.fields,!1);if(a!==null){n.push(`void Writer::visit${i.name}(${a.map(fl).join(", ")}) {`);for(let s of a)n.push(`  ${zA(s)};`);n.push("}"),n.push("");continue}}if(i.kind==="STRUCT"||i.kind==="MESSAGE"){n.push(`void Writer::begin${i.name}() {`),n.push("}"),n.push("");for(let a of i.fields){if(a.isDeprecated)continue;let s=a.name;a.isArray&&(n.push(`void Writer::visit${i.name}_${a.name}_count(uint32_t size) {`),i.kind==="MESSAGE"&&n.push(`  _wb.writeVarUint(${a.value});`),n.push("  _wb.writeVarUint(size);"),n.push("}"),n.push(""),s+="_element");let l=As(t,"",[a],!0);if(l!==null){n.push(`void Writer::visit${i.name}_${s}(${l.map(fl).join(", ")}) {`),i.kind==="MESSAGE"&&!a.isArray&&n.push(`  _wb.writeVarUint(${a.value});`);for(let d of l)n.push(`  ${zA(d)};`);n.push("}"),n.push("")}else n.push(`void Writer::visit${i.name}_${s}() {`),i.kind==="MESSAGE"&&!a.isArray&&n.push(`  _wb.writeVarUint(${a.value});`),n.push("}"),n.push("")}n.push(`void Writer::end${i.name}() {`),i.kind==="MESSAGE"&&n.push("  _wb.writeVarUint(0);"),n.push("}"),n.push("")}}return n.push("#endif"),n.push(""),r.package!==null&&(n.push("}"),n.push(""),n.push("#endif"),n.push("")),n.join(`
`)}var XA=ni(()=>{});var tS={};ta(tS,{compileSchemaCPP:()=>ON,compileSchemaEnumsCPP:()=>CN});function Nn(r,e,t){let n;switch(e.type){case"bool":n="bool";break;case"byte":n="uint8_t";break;case"int":n="int32_t";break;case"uint":n="uint32_t";break;case"int64":n="int64_t";break;case"uint64":n="uint64_t";break;case"float":n="float";break;case"string":n="kiwi::String";break;default:{let o=r[e.type];o||pr(`Invalid type ${Ze(e.type)} for field ${Ze(e.name)}`,e.line,e.column),n=o.name;break}}return t&&(n=`kiwi::Array<${n}>`),n}function La(r){return"_data_"+r.name}function Sm(r){return r>>5}function Tm(r){return`(1 << ${r%32})`}function wo(r,e){return!e.isArray&&e.type in r&&r[e.type].kind!=="ENUM"}function ZA(r,e,t){switch(e.type){case"bool":return`_wb.writeBool(${t});`;case"byte":return`_wb.writeByte(${t});`;case"int":return`_wb.writeVarInt(${t});`;case"uint":return`_wb.writeVarUint(${t});`;case"int64":return`_wb.writeVarInt64(${t});`;case"uint64":return`_wb.writeVarUint64(${t});`;case"float":return`_wb.writeVarFloat(${t});`;case"string":return`_wb.writeString(${t}.c_str());`;default:{let n=r[e.type];if(!n)pr(`Invalid type ${Ze(e.type)} for field ${Ze(e.name)}`,e.line,e.column);else return n.kind==="ENUM"?`_wb.writeVarUint(static_cast<uint32_t>(${t}));`:`if (!${t}${wo(r,e)?"->":"."}encode(_wb)) return false;`}}}function Em(r,e,t){let n=wo(r,e);switch(e.type){case"bool":return`_bb.readBool(${t})`;case"byte":return`_bb.readByte(${t})`;case"int":return`_bb.readVarInt(${t})`;case"uint":return`_bb.readVarUint(${t})`;case"int64":return`_bb.readVarInt64(${t})`;case"uint64":return`_bb.readVarUint64(${t})`;case"float":return`_bb.readVarFloat(${t})`;case"string":return`_bb.readString(${t}, _pool)`;default:{let o=r[e.type];if(!o)pr(`Invalid type ${Ze(e.type)} for field ${Ze(e.name)}`,e.line,e.column);else return o.kind==="ENUM"?`_bb.readVarUint(reinterpret_cast<uint32_t &>(${t}))`:`${t+(n?"->":".")}decode(_bb, _pool, _schema)`}}}function JA(r){let e={bool:1,byte:1,int:4,uint:4,float:4};return r.slice().sort(function(t,n){let o=!t.isArray&&e[t.type]||8,i=!n.isArray&&e[n.type]||8;return o!==i?i-o:r.indexOf(t)-r.indexOf(n)})}function hN(r,e,t){let n=r.fields,o=[];o.push(`class ${r.name} {`),o.push("public:"),o.push(`  ${r.name}() { (void)_flags; }`),t||(o.push(`  ${r.name}(const ${r.name}&) = delete;`),o.push(`  ${r.name}& operator=(const ${r.name}&) = delete;`)),o.push(`  ${r.name}(${r.name}&&) = default;`),o.push(`  ${r.name}& operator=(${r.name}&&) = default;`),o.push(""),t&&(o.push(`  ${r.name} copy() const;`),o.push(""));for(let s of n){if(s.isDeprecated)continue;let l=Nn(e,s,s.isArray);o.push(`  ${l} *${s.name}();`),o.push(`  const ${l} *${s.name}() const;`),wo(e,s)?o.push(`  void set_${s.name}(${l} *value);`):s.isArray?o.push(`  ${l} &set_${s.name}(kiwi::MemoryPool &pool, uint32_t count);`):o.push(`  void set_${s.name}(const ${l} &value);`),o.push("")}o.push("  bool encode(kiwi::WriteBuffer &wb) const;"),o.push("  bool decode(kiwi::ByteBuffer &bb, kiwi::MemoryPool &pool, const BinarySchema *schema = nullptr);"),o.push(""),o.push("private:"),t&&(o.push(`  ${r.name}(const ${r.name}&) = default;`),o.push(`  ${r.name}& operator=(const ${r.name}&) = default;`)),o.push(`  uint32_t _flags[${n.length+31>>5}] = {};`);let i=JA(n),a="  ";for(let s of i){if(s.isDeprecated)continue;let l=La(s),d=Nn(e,s,s.isArray);wo(e,s)?o.push(a+`${d} *${l} = {};`):o.push(a+`${d} ${l} = {};`)}return o.push("};"),o.push(""),o}function mN(r,e,t){let n=r.fields,o=[];o.push(`class ${r.name} {`),o.push("public:"),o.push(`  ${r.name}() { (void)_flags; }`),o.push(`  ${r.name}(const ${r.name}&) = delete;`),o.push(`  ${r.name}& operator=(const ${r.name}&) = delete;`),o.push(`  ${r.name}(${r.name}&&) = default;`),o.push(`  ${r.name}& operator=(${r.name}&&) = default;`),o.push(""),t&&(o.push(`  ${r.name} copy(kiwi::MemoryPool& pool) const;`),o.push(""));for(let s of n){if(s.isDeprecated)continue;let l=Nn(e,s,s.isArray);wo(e,s)?(o.push(`  ${l} *${s.name}();`),o.push(`  const ${l} *${s.name}() const;`)):o.push(`  kiwi::Optional<${l}> ${s.name}() const;`),wo(e,s)?o.push(`  void set_${s.name}(kiwi::MemoryPool &pool, ${l} *value);`):s.isArray?o.push(`  ${l} &set_${s.name}(kiwi::MemoryPool &pool, uint32_t count);`):o.push(`  void set_${s.name}(kiwi::MemoryPool &pool, const ${l} &value);`),o.push("")}o.push("  bool encode(kiwi::WriteBuffer &wb) const;"),o.push("  bool decode(kiwi::ByteBuffer &bb, kiwi::MemoryPool &pool, const BinarySchema *schema = nullptr);"),o.push(""),o.push("private:"),o.push(`  uint32_t _flags[${n.length+31>>5}] = {};`);let i=JA(n);o.push("  union Field {"),o.push("  public:"),o.push("    bool operator==(const Field&) const { return false; }");let a="    ";for(let s of i){if(s.isDeprecated)continue;let l=La(s),d=Nn(e,s,s.isArray);wo(e,s)?o.push(a+`${d} *${l};`):o.push(a+`${d} ${l};`)}return o.push("  };"),o.push("  kiwi::SparseFields<Field> _fields;"),o.push("  friend std::hash<Field>;"),o.push("};"),o.push(""),o}function fN(r,e){if(r.type){let t=e[r.type];if(t&&t.kind==="ENUM")return!0}return!1}function jA(r,e){switch(r.type){case"bool":case"byte":case"int":case"uint":case"int64":case"uint64":case"float":case"string":return!0}return fN(r,e)}function $A(r,e){return e.type==="string"?"const char*":Nn(r,e,!1)}function gN(r,e,t){return e.type==="string"?`bb.readString(${t})`:Em(r,e,t).slice(1)}function AN(r,e){let t=[];t.push(`struct ${r.name}Visitor {`),t.push("  kiwi::ByteBuffer& bb;"),t.push("  BinarySchema& schema;"),t.push(""),t.push(`  ${r.name}Visitor(kiwi::ByteBuffer& _bb, BinarySchema& _schema) : bb(_bb), schema(_schema) {}`),t.push("");for(let n of r.fields)if(!n.isDeprecated)if(n.isArray)t.push("  // If this is overridden, the new implementation must skip over exactly count"),t.push(`  // encoded instances of ${n.type} in bb`),t.push(`  virtual bool visit${r.name}_${n.name}(size_t count) {`),t.push("    for (size_t i=0; i<count; i++) {"),t.push(`      if (!schema.skip${n.type}(bb)) return false;`),t.push("    }"),t.push("    return true;"),t.push("  }");else if(jA(n,e)){let o=$A(e,n);t.push(`  virtual bool visit${r.name}_${n.name}(${o} ${n.name}) { return true; }`)}else t.push(`  // If this is overridden, the new implementation must skip over encoded one ${n.type} in bb`),t.push(`  virtual bool visit${r.name}_${n.name}() {`),t.push(`    return schema.skip${n.type}(bb);`),t.push("  }");return t.push("};"),t.push(""),t.push(`bool parse${r.name}(kiwi::ByteBuffer& bb, ${r.name}Visitor& visitor);`),t.push(""),t}function SN(r,e){let t=[];t.push(`bool parse${r.name}(kiwi::ByteBuffer& bb, ${r.name}Visitor& visitor) {`),t.push("  while (true) {"),t.push("    uint32_t _field;"),t.push("    if (!bb.readVarUint(_field)) return false;"),t.push("    switch (_field) {"),t.push("      case 0: {"),t.push("        return true;"),t.push("      }");for(let n of r.fields)n.isDeprecated||(t.push(`      case ${n.value}: {`),n.isArray?(t.push("        uint32_t count;"),t.push("        if (!bb.readVarUint(count)) return false;"),t.push(`        if (!visitor.visit${r.name}_${n.name}(count)) return false;`),t.push("        break;")):jA(n,e)?(t.push(`        ${$A(e,n)} v;`),t.push(`        if (!${gN(e,n,"v")}) return false;`),t.push(`        if (!visitor.visit${r.name}_${n.name}(v)) return false;`),t.push("        break;")):(t.push(`        if (!visitor.visit${r.name}_${n.name}()) return false;`),t.push("        break;")),t.push("      }"));return t.push("      default:"),t.push(`        if (visitor.schema.skip${r.name}Field(bb, _field)) break;`),t.push("        return false;"),t.push("    }"),t.push("  }"),t.push("}"),t.push(""),t}function TN(r,e,t){let n=r.fields,o=[];t&&(o.push(`inline ${r.name} ${r.name}::copy() const {`),o.push(`  ${r.name} clone = *this;`),o.push("  return clone;"),o.push("}"),o.push(""));for(let[i,a]of n.entries()){let s=La(a),l=Nn(e,a,a.isArray),d=Sm(i),c=Tm(i);if(a.isDeprecated)continue;let p=`_flags[${d}] |= ${c}`,u=`_flags[${d}] & ${c}`;wo(e,a)?(o.push(`inline ${l} *${r.name}::${a.name}() {`),o.push(`  return ${s};`),o.push("}"),o.push(""),o.push(`inline const ${l} *${r.name}::${a.name}() const {`),o.push(`  return ${s};`),o.push("}"),o.push(""),o.push(`inline void ${r.name}::set_${a.name}(${l} *value) {`),o.push(`  ${s} = value;`),o.push("}"),o.push("")):a.isArray?(o.push(`inline ${l} *${r.name}::${a.name}() {`),o.push(`  return ${u} ? &${s} : nullptr;`),o.push("}"),o.push(""),o.push(`inline const ${l} *${r.name}::${a.name}() const {`),o.push(`  return ${u} ? &${s} : nullptr;`),o.push("}"),o.push(""),o.push(`inline ${l} &${r.name}::set_${a.name}(kiwi::MemoryPool &pool, uint32_t count) {`),o.push(`  ${p}; return ${s} = pool.array<${Nn(e,a,!1)}>(count);`),o.push("}"),o.push("")):(o.push(`inline ${l} *${r.name}::${a.name}() {`),o.push(`  return ${u} ? &${s} : nullptr;`),o.push("}"),o.push(""),o.push(`inline const ${l} *${r.name}::${a.name}() const {`),o.push(`  return ${u} ? &${s} : nullptr;`),o.push("}"),o.push(""),o.push(`inline void ${r.name}::set_${a.name}(const ${l} &value) {`),o.push(`  ${p}; ${s} = value;`),o.push("}"),o.push(""))}return o}function EN(r,e){let t=r.fields,n=[];n.push(`bool ${r.name}::encode(kiwi::WriteBuffer &_wb) const {`);for(let o of t){if(o.isDeprecated)continue;let i="  ";r.kind==="STRUCT"?n.push(`  if (${o.name}() == nullptr) return false;`):(n.push(`  if (${o.name}() != nullptr) {`),i="    ");let a=La(o),s=o.isArray?"_it":a,l=ZA(e,o,s);r.kind==="MESSAGE"&&n.push(i+`_wb.writeVarUint(${o.value});`),o.isArray?(n.push(i+`_wb.writeVarUint(${a}.size());`),n.push(i+`for (const ${Nn(e,o,!1)} &_it : ${a}) ${l}`)):n.push(i+l),r.kind!=="STRUCT"&&n.push("  }")}return r.kind==="MESSAGE"&&n.push("  _wb.writeVarUint(0);"),n.push("  return true;"),n.push("}"),n.push(""),n}function IN(r,e){let t=r.fields,n=[];n.push(`bool ${r.name}::decode(kiwi::ByteBuffer &_bb, kiwi::MemoryPool &_pool, const BinarySchema *_schema) {`);for(let o of t)if(o.isArray){n.push("  uint32_t count;");break}r.kind==="MESSAGE"&&(n.push("  while (true) {"),n.push("    uint32_t type;"),n.push("    if (!_bb.readVarUint(type)) return false;"),n.push("    switch (type) {"),n.push("      case 0:"),n.push("        return true;"));for(let o of t){let i=La(o),a=o.isArray?"_it":i,s=wo(e,o),l=Em(e,o,a),d=Nn(e,o,!1),c="  ";r.kind==="MESSAGE"&&(n.push(`      case ${o.value}: {`),c="        "),o.isArray?(n.push(c+"if (!_bb.readVarUint(count)) return false;"),o.isDeprecated?o.type==="byte"?n.push(c+"if (!_bb.skipCount(count)) return false;"):n.push(c+`for (${d} &_it : _pool.array<${d}>(count)) if (!${l}) return false;`):o.type==="byte"?n.push(c+`if (!_bb.readByteArray(set_${o.name}(_pool, count).data(), count)) return false;`):n.push(c+`for (${d} &_it : set_${o.name}(_pool, count)) if (!${l}) return false;`)):o.isDeprecated?(s?n.push(c+`${d} *${i} = _pool.allocate<${d}>();`):n.push(c+`${d} ${i} = {};`),n.push(c+`if (!${l}) return false;`)):(s&&n.push(c+`${i} = _pool.allocate<${d}>();`),n.push(c+`if (!${l}) return false;`),s||n.push(c+`set_${o.name}(${i});`)),r.kind==="MESSAGE"&&(n.push("        break;"),n.push("      }"))}return r.kind==="MESSAGE"?(n.push("      default: {"),n.push(`        if (!_schema || !_schema->skip${r.name}Field(_bb, type)) return false;`),n.push("        break;"),n.push("      }"),n.push("    }"),n.push("  }")):n.push("  return true;"),n.push("}"),n.push(""),n}function yN(r,e,t){let n=r.fields,o=[];t&&(o.push(`inline ${r.name} ${r.name}::copy(kiwi::MemoryPool& pool) const {`),o.push(`  ${r.name} clone;`),o.push("  clone._fields = _fields.copy(pool);"),o.push("  memcpy(clone._flags, _flags, sizeof(_flags));"),o.push("  return clone;"),o.push("}"),o.push(""));for(let[i,a]of n.entries()){let s=La(a),l=Nn(e,a,a.isArray),d=Sm(i),c=Tm(i);if(a.isDeprecated)continue;let p=`_flags[${d}] |= ${c}`,u=`_flags[${d}] & ${c}`,_=wo(e,a);_?(o.push(`inline ${l} *${r.name}::${a.name}() {`),o.push(`  if (!(${u})) return nullptr;`),o.push(`  Field* field = _fields.getField(${a.value});`),o.push(`  return field ? ${_?"":"&"}field->${s} : nullptr;`),o.push("}"),o.push(""),o.push(`inline const ${l} *${r.name}::${a.name}() const {`),o.push(`  if (!(${u})) return nullptr;`),o.push(`  const Field* field = _fields.getField(${a.value});`),o.push(`  return field ? ${_?"":"&"}field->${s} : nullptr;`),o.push("}"),o.push("")):(o.push(`inline kiwi::Optional<${l}> ${r.name}::${a.name}() const {`),o.push(`  if (!(${u})) return std::nullopt;`),o.push(`  const Field* field = _fields.getField(${a.value});`),o.push(`  return field ? kiwi::Optional<${l}>(field->${s}) : std::nullopt;`),o.push("}"),o.push("")),wo(e,a)?o.push(`inline void ${r.name}::set_${a.name}(kiwi::MemoryPool &pool, ${l} *value) {`):a.isArray?(o.push(`inline ${l} &${r.name}::set_${a.name}(kiwi::MemoryPool &pool, uint32_t count) {`),o.push(`  ${l} value = pool.array<${Nn(e,a,!1)}>(count);`)):o.push(`inline void ${r.name}::set_${a.name}(kiwi::MemoryPool &pool, const ${l} &value) {`),o.push(`  if (${u}) {`),o.push(`    Field* field = _fields.getField(${a.value});`),o.push(`    field->${s} = value;`),a.isArray&&o.push(`    return field->${s};`),o.push("  } else {"),o.push(`    ${p};`),a.isArray?o.push(`    return _fields.addField({${a.value}, Field{.${s} = value}}, pool)->field.${s};`):o.push(`    _fields.addField({${a.value}, Field{.${s} = value}}, pool);`),o.push("  }"),o.push("}"),o.push("")}return o}function RN(r,e){let t=r.fields,n=[];n.push(`bool ${r.name}::encode(kiwi::WriteBuffer &_wb) const {`);for(let o of t){if(o.isDeprecated)continue;let i=Nn(e,o,o.isArray),a=wo(e,o),s;a?s=`${i}*`:s=`kiwi::Optional<${i}>`;let l=La(o);n.push(`  const ${s} ${l} = ${o.name}();`),a?(n.push(`  if (${l}) {`),n.push(`    const ${Nn(e,o,o.isArray)}* _data = ${l};`)):(n.push(`  if (${l}.has_value()) {`),n.push(`    const ${Nn(e,o,o.isArray)}& _data = *${l};`));let d="    ";l="_data";let c=o.isArray?"_it":l,p=ZA(e,o,c);n.push(d+`_wb.writeVarUint(${o.value});`),o.isArray?(n.push(d+`_wb.writeVarUint(${l}.size());`),n.push(d+`for (const ${Nn(e,o,!1)} &_it : ${l}) ${p}`)):n.push(d+p),n.push("  }")}return n.push("  _wb.writeVarUint(0);"),n.push("  return true;"),n.push("}"),n.push(""),n}function vN(r,e){let t=r.fields,n=[];n.push(`bool ${r.name}::decode(kiwi::ByteBuffer &_bb, kiwi::MemoryPool &_pool, const BinarySchema *_schema) {`);for(let o of t)if(o.isArray){n.push("  uint32_t count;");break}n.push("  std::vector<kiwi::SparseFields<Field>::Element> tempFields;"),n.push("  while (true) {"),n.push("    uint32_t type;"),n.push("    if (!_bb.readVarUint(type)) return false;"),n.push("    switch (type) {"),n.push("      case 0: {"),n.push("        _fields = kiwi::SparseFields<Field>(tempFields.data(), tempFields.size(), _pool);"),n.push("        return true;"),n.push("      }");for(let[o,i]of t.entries()){let a=La(i),s=i.isArray?"_it":a,l=wo(e,i),d=Em(e,i,s),c=Nn(e,i,!1),p=Sm(o),u=Tm(o),_=`_flags[${p}] |= ${u}`;n.push(`      case ${i.value}: {`);let h="        ";i.isArray?(n.push(h+"if (!_bb.readVarUint(count)) return false;"),i.isDeprecated?i.type==="byte"?n.push(h+"if (!_bb.skipCount(count)) return false;"):n.push(h+`for (${c} &_it : _pool.array<${c}>(count)) if (!${d}) return false;`):(n.push(h+`${_};`),n.push(h+`${Nn(e,i,!0)} ${a} = _pool.array<${c}>(count);`),i.type==="byte"?n.push(h+`if (!_bb.readByteArray(${a}.data(), count)) return false;`):n.push(h+`for (${c} &_it : ${a}) if (!${d}) return false;`),n.push(h+`tempFields.push_back({${i.value}, Field{.${a} = ${a}}});`))):(l?n.push(h+`${c}* ${a} = _pool.allocate<${c}>();`):n.push(h+`${c} ${a} = {};`),n.push(h+`if (!${d}) return false;`),i.isDeprecated||(n.push(h+`${_};`),n.push(h+`tempFields.push_back({${i.value}, Field{.${a} = ${a}}});`))),n.push("        break;"),n.push("      }")}return n.push("      default: {"),n.push(`        if (!_schema || !_schema->skip${r.name}Field(_bb, type)) return false;`),n.push("        break;"),n.push("      }"),n.push("    }"),n.push("  }"),n.push("}"),n.push(""),n}function qA(r){return r.fields.every(e=>e.type==="uint"||e.type==="float"||e.type==="byte"&&e.isArray)}function ON(r,e={}){let t={};for(let d of r.definitions)t[d.name]=d;let n=e.includePrefix||"",{sparseMessages:o=[],copyableMessages:i=[],generateVisitors:a=[],separateEnumFile:s}=e;for(let d of o)d in t||pr(`Requesting sparse implementation for ${Ze(d)} which is not defined in the schema`,0,0);let l=[];l.push(`#include "${n}kiwi.h"`),s&&l.push(`#include "${n}${s}"`),l.push(""),r.package!==null&&(l.push(`namespace ${r.package} {`),l.push(""),l.push(`#ifndef INCLUDE_${r.package.toUpperCase()}_H`),l.push(`#define INCLUDE_${r.package.toUpperCase()}_H`),l.push("")),l.push("class BinarySchema {"),l.push("public:"),l.push("  bool parse(kiwi::ByteBuffer &bb);"),l.push("  const kiwi::BinarySchema &underlyingSchema() const { return _schema; }");for(let d of r.definitions)d.kind==="MESSAGE"&&(l.push(`  bool skip${d.name}Field(kiwi::ByteBuffer &bb, uint32_t id) const;`),l.push(`  bool skip${d.name}(kiwi::ByteBuffer &bb) const;`)),d.kind==="STRUCT"&&qA(d)&&l.push(`  bool skip${d.name}(kiwi::ByteBuffer &bb) const;`);l.push(""),l.push("private:"),l.push("  kiwi::BinarySchema _schema;");for(let d of r.definitions)d.kind==="MESSAGE"&&l.push(`  uint32_t _index${d.name} = 0;`);l.push("};"),l.push(""),s||eS(r,l);for(let d of[0,1,2,3]){let c=!1;if(d===3){if(r.package!==null){if(o.length>0){l.push(`}  // namespace ${r.package}`);for(let p of o)l.push("template<>"),l.push(`struct std::hash<${r.package}::${p}::Field> {`),l.push(`  size_t operator()(const ${r.package}::${p}::Field& msg) const {`),l.push("    return 0;"),l.push("  }"),l.push("};");l.push(`namespace ${r.package} {`)}l.push(`#endif  // INCLUDE_${r.package.toUpperCase()}_H`)}l.push("#ifdef IMPLEMENT_SCHEMA_H"),l.push(""),l.push("bool BinarySchema::parse(kiwi::ByteBuffer &bb) {"),l.push("  if (!_schema.parse(bb)) return false;");for(let p of r.definitions)p.kind==="MESSAGE"&&l.push(`  _schema.findDefinition("${p.name}", _index${p.name});`);l.push("  return true;"),l.push("}"),l.push("");for(let p of r.definitions)if(p.kind==="MESSAGE"&&(l.push(`bool BinarySchema::skip${p.name}Field(kiwi::ByteBuffer &bb, uint32_t id) const {`),l.push(`  return _schema.skipField(bb, _index${p.name}, id);`),l.push("}"),l.push(""),l.push(`bool BinarySchema::skip${p.name}(kiwi::ByteBuffer &bb) const {`),l.push("  while (true) {"),l.push("    uint32_t type;"),l.push("    if (!bb.readVarUint(type)) return false;"),l.push("    if (type == 0) return true;"),l.push(`    if (!skip${p.name}Field(bb, type)) return false;`),l.push("  }"),l.push("}"),l.push(""),a.includes(p.name)&&(l=l.concat(SN(p,t)))),p.kind==="STRUCT"&&qA(p)){l.push(`bool BinarySchema::skip${p.name}(kiwi::ByteBuffer &bb) const {`);let u=!1,_=!1;for(let h of p.fields)l.push(`  // ${h.name}`),h.type==="float"?(_||(l.push("  float f;"),_=!0),l.push("  if (!bb.readVarFloat(f)) return false;")):(u||(l.push("  uint32_t i;"),u=!0),l.push("  if (!bb.readVarUint(i)) return false;"),h.isArray&&l.push("  if (!bb.skipCount(i)) return false;"));l.push("  return true;"),l.push("}"),l.push("")}}for(let p of r.definitions){if(p.kind==="ENUM")continue;let u=o.includes(p.name);if(u&&p.kind!=="MESSAGE"){let _=`Type ${Ze(p.name)} cannot be declared as sparse. `;_+=`${Ze(p.name)} is type ${Ze(p.kind)}, but needs to be a MESSAGE.`,pr(_,p.line,p.column)}d===0?(l.push(`class ${p.name};`),c=!0):d===1?(u?l=l.concat(mN(p,t,i.includes(p.name))):l=l.concat(hN(p,t,i.includes(p.name))),a.includes(p.name)&&(l=l.concat(AN(p,t)))):d===2?u?l=l.concat(yN(p,t,i.includes(p.name))):l=l.concat(TN(p,t,i.includes(p.name))):u?(l=l.concat(RN(p,t)),l=l.concat(vN(p,t))):(l=l.concat(EN(p,t)),l=l.concat(IN(p,t)))}d===3?(l.push("#endif  // IMPLEMENT_SCHEMA_H"),l.push("")):c&&l.push("")}return r.package!==null&&(l.push(`}  // namespace ${r.package}`),l.push("")),l.join(`
`)}function CN(r){let e=["#pragma once",""];return r.package&&(e.push(`namespace ${r.package} {`),e.push("")),eS(r,e),r.package&&(e.push(""),e.push(`}  // namespace ${r.package}`),e.push("")),e.join(`
`)}function eS(r,e){for(let t of r.definitions)if(t.kind==="ENUM"){e.push(`enum class ${t.name} : uint32_t {`);for(let n of t.fields)e.push(`  ${n.name} = ${n.value},`);e.push("};"),e.push("")}}var rS=ni(()=>{Pc()});var nS={};ta(nS,{compileSchemaTypeScript:()=>bN});function bN(r){var e="",t=[];r.package!==null&&(t.push("export namespace "+r.package+" {"),e+="  ");for(let o of r.definitions)if(o.kind==="ENUM"){t.push(e+"export type "+o.name+" =");for(let[i,a]of o.fields.entries())t.push(e+"  "+JSON.stringify(a.name)+(i+1<o.fields.length?" |":";"));o.fields.length||t.push(e+"  any;"),t.push("")}for(let o of r.definitions)if(o.kind==="STRUCT"||o.kind==="MESSAGE"){t.push(e+"export interface "+o.name+" {");for(let i of o.fields){var n;if(!i.isDeprecated){switch(i.type){case"bool":n="boolean";break;case"byte":case"int":case"uint":case"float":n="number";break;case"int64":case"uint64":n="string";break;default:n=i.type;break}i.type==="byte"&&i.isArray?n="Uint8Array":i.isArray&&(n+="[]"),t.push(e+"  "+i.name+(o.kind==="MESSAGE"?"?":"")+": "+n+";")}}t.push(e+"}"),t.push("")}else o.kind!=="ENUM"&&pr("Invalid definition kind "+Ze(o.kind),o.line,o.column);t.push(e+"export type DedupCache = any;"),t.push(""),t.push(e+"export interface Schema {"),t.push(e+"  makeDedupCache(): DedupCache;");for(let o of r.definitions)o.kind==="ENUM"?t.push(e+"  "+o.name+": any;"):(o.kind==="STRUCT"||o.kind==="MESSAGE")&&(t.push(e+"  encode"+o.name+"(message: "+o.name+"): Uint8Array;"),t.push(e+"  decode"+o.name+"(buffer: Uint8Array, optionalDedupCache?: DedupCache): "+o.name+";"),t.push(e+"  redact"+o.name+"(buffer: Uint8Array): void;"));return t.push(e+"}"),r.package!==null&&t.push("}"),t.push(""),t.join(`
`)}var oS=ni(()=>{Pc()});var iS={};ta(iS,{prettyPrintSchema:()=>NN});function NN(r){let e=r.definitions,t="";r.package!==null&&(t+="package "+r.package+`;

`);let n=!0;for(let o of e){n?n=!1:t+=`
`,t+=o.kind.toLowerCase()+" "+o.name+` {
`;for(let i of o.fields)t+="  ",o.kind!=="ENUM"&&(t+=i.type,i.isArray&&(t+="[]"),t+=" "),t+=i.name,o.kind!=="STRUCT"&&(t+=" = "+i.value),i.isDeprecated&&(t+=" [deprecated]"),t+=`;
`;t+=`}
`}return t}var aS=ni(()=>{});var wc=cm(_r=>{"use strict";Object.defineProperty(_r,"__esModule",{value:!0});_r.prettyPrintSchema=_r.parseSchema=_r.encodeBinarySchema=_r.decodeBinarySchema=_r.compileSchemaTypeScript=_r.compileSchemaCPP=_r.compileSchemaCallbackCPP=_r.createKiwiCodec=_r.KiwiCodec=_r.compileSchemaJS=_r.compileSchema=_r.ByteBuffer=void 0;var PN=(Nc(),ra(wA));Object.defineProperty(_r,"ByteBuffer",{enumerable:!0,get:function(){return PN.ByteBuffer}});var sS=(gm(),ra(VA));Object.defineProperty(_r,"compileSchema",{enumerable:!0,get:function(){return sS.compileSchema}});Object.defineProperty(_r,"compileSchemaJS",{enumerable:!0,get:function(){return sS.compileSchemaJS}});var lS=(HA(),ra(kA));Object.defineProperty(_r,"KiwiCodec",{enumerable:!0,get:function(){return lS.KiwiCodec}});Object.defineProperty(_r,"createKiwiCodec",{enumerable:!0,get:function(){return lS.createKiwiCodec}});var FN=(XA(),ra(QA));Object.defineProperty(_r,"compileSchemaCallbackCPP",{enumerable:!0,get:function(){return FN.compileSchemaCallbackCPP}});var DN=(rS(),ra(tS));Object.defineProperty(_r,"compileSchemaCPP",{enumerable:!0,get:function(){return DN.compileSchemaCPP}});var wN=(oS(),ra(nS));Object.defineProperty(_r,"compileSchemaTypeScript",{enumerable:!0,get:function(){return wN.compileSchemaTypeScript}});var cS=(xu(),ra(GA));Object.defineProperty(_r,"decodeBinarySchema",{enumerable:!0,get:function(){return cS.decodeBinarySchema}});Object.defineProperty(_r,"encodeBinarySchema",{enumerable:!0,get:function(){return cS.encodeBinarySchema}});var LN=(Lu(),ra(MA));Object.defineProperty(_r,"parseSchema",{enumerable:!0,get:function(){return LN.parseSchema}});var xN=(aS(),ra(iS));Object.defineProperty(_r,"prettyPrintSchema",{enumerable:!0,get:function(){return xN.prettyPrintSchema}})});var pv=cm((Of,Cf)=>{(function(r,e){typeof Of=="object"&&typeof Cf<"u"?Cf.exports=e():typeof define=="function"&&define.amd?define(e):(r=r||self).RBush=e()})(Of,function(){"use strict";function r(m,f,T,y,E){(function v(A,I,C,g,R){for(;g>C;){if(g-C>600){var D=g-C+1,P=I-C+1,U=Math.log(D),B=.5*Math.exp(2*U/3),M=.5*Math.sqrt(U*B*(D-B)/D)*(P-D/2<0?-1:1),F=Math.max(C,Math.floor(I-P*B/D+M)),w=Math.min(g,Math.floor(I+(D-P)*B/D+M));v(A,I,F,w,R)}var V=A[I],k=C,H=g;for(e(A,C,I),R(A[g],V)>0&&e(A,C,g);k<H;){for(e(A,k,H),k++,H--;R(A[k],V)<0;)k++;for(;R(A[H],V)>0;)H--}R(A[C],V)===0?e(A,C,H):e(A,++H,g),H<=I&&(C=H+1),I<=H&&(g=H-1)}})(m,f,T||0,y||m.length-1,E||t)}function e(m,f,T){var y=m[f];m[f]=m[T],m[T]=y}function t(m,f){return m<f?-1:m>f?1:0}var n=function(m){m===void 0&&(m=9),this._maxEntries=Math.max(4,m),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function o(m,f,T){if(!T)return f.indexOf(m);for(var y=0;y<f.length;y++)if(T(m,f[y]))return y;return-1}function i(m,f){a(m,0,m.children.length,f,m)}function a(m,f,T,y,E){E||(E=h(null)),E.minX=1/0,E.minY=1/0,E.maxX=-1/0,E.maxY=-1/0;for(var v=f;v<T;v++){var A=m.children[v];s(E,m.leaf?y(A):A)}return E}function s(m,f){return m.minX=Math.min(m.minX,f.minX),m.minY=Math.min(m.minY,f.minY),m.maxX=Math.max(m.maxX,f.maxX),m.maxY=Math.max(m.maxY,f.maxY),m}function l(m,f){return m.minX-f.minX}function d(m,f){return m.minY-f.minY}function c(m){return(m.maxX-m.minX)*(m.maxY-m.minY)}function p(m){return m.maxX-m.minX+(m.maxY-m.minY)}function u(m,f){return m.minX<=f.minX&&m.minY<=f.minY&&f.maxX<=m.maxX&&f.maxY<=m.maxY}function _(m,f){return f.minX<=m.maxX&&f.minY<=m.maxY&&f.maxX>=m.minX&&f.maxY>=m.minY}function h(m){return{children:m,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function S(m,f,T,y,E){for(var v=[f,T];v.length;)if(!((T=v.pop())-(f=v.pop())<=y)){var A=f+Math.ceil((T-f)/y/2)*y;r(m,A,f,T,E),v.push(f,A,A,T)}}return n.prototype.all=function(){return this._all(this.data,[])},n.prototype.search=function(m){var f=this.data,T=[];if(!_(m,f))return T;for(var y=this.toBBox,E=[];f;){for(var v=0;v<f.children.length;v++){var A=f.children[v],I=f.leaf?y(A):A;_(m,I)&&(f.leaf?T.push(A):u(m,I)?this._all(A,T):E.push(A))}f=E.pop()}return T},n.prototype.collides=function(m){var f=this.data;if(!_(m,f))return!1;for(var T=[];f;){for(var y=0;y<f.children.length;y++){var E=f.children[y],v=f.leaf?this.toBBox(E):E;if(_(m,v)){if(f.leaf||u(m,v))return!0;T.push(E)}}f=T.pop()}return!1},n.prototype.load=function(m){if(!m||!m.length)return this;if(m.length<this._minEntries){for(var f=0;f<m.length;f++)this.insert(m[f]);return this}var T=this._build(m.slice(),0,m.length-1,0);if(this.data.children.length)if(this.data.height===T.height)this._splitRoot(this.data,T);else{if(this.data.height<T.height){var y=this.data;this.data=T,T=y}this._insert(T,this.data.height-T.height-1,!0)}else this.data=T;return this},n.prototype.insert=function(m){return m&&this._insert(m,this.data.height-1),this},n.prototype.clear=function(){return this.data=h([]),this},n.prototype.remove=function(m,f){if(!m)return this;for(var T,y,E,v=this.data,A=this.toBBox(m),I=[],C=[];v||I.length;){if(v||(v=I.pop(),y=I[I.length-1],T=C.pop(),E=!0),v.leaf){var g=o(m,v.children,f);if(g!==-1)return v.children.splice(g,1),I.push(v),this._condense(I),this}E||v.leaf||!u(v,A)?y?(T++,v=y.children[T],E=!1):v=null:(I.push(v),C.push(T),T=0,y=v,v=v.children[0])}return this},n.prototype.toBBox=function(m){return m},n.prototype.compareMinX=function(m,f){return m.minX-f.minX},n.prototype.compareMinY=function(m,f){return m.minY-f.minY},n.prototype.toJSON=function(){return this.data},n.prototype.fromJSON=function(m){return this.data=m,this},n.prototype._all=function(m,f){for(var T=[];m;)m.leaf?f.push.apply(f,m.children):T.push.apply(T,m.children),m=T.pop();return f},n.prototype._build=function(m,f,T,y){var E,v=T-f+1,A=this._maxEntries;if(v<=A)return i(E=h(m.slice(f,T+1)),this.toBBox),E;y||(y=Math.ceil(Math.log(v)/Math.log(A)),A=Math.ceil(v/Math.pow(A,y-1))),(E=h([])).leaf=!1,E.height=y;var I=Math.ceil(v/A),C=I*Math.ceil(Math.sqrt(A));S(m,f,T,C,this.compareMinX);for(var g=f;g<=T;g+=C){var R=Math.min(g+C-1,T);S(m,g,R,I,this.compareMinY);for(var D=g;D<=R;D+=I){var P=Math.min(D+I-1,R);E.children.push(this._build(m,D,P,y-1))}}return i(E,this.toBBox),E},n.prototype._chooseSubtree=function(m,f,T,y){for(;y.push(f),!f.leaf&&y.length-1!==T;){for(var E=1/0,v=1/0,A=void 0,I=0;I<f.children.length;I++){var C=f.children[I],g=c(C),R=(D=m,P=C,(Math.max(P.maxX,D.maxX)-Math.min(P.minX,D.minX))*(Math.max(P.maxY,D.maxY)-Math.min(P.minY,D.minY))-g);R<v?(v=R,E=g<E?g:E,A=C):R===v&&g<E&&(E=g,A=C)}f=A||f.children[0]}var D,P;return f},n.prototype._insert=function(m,f,T){var y=T?m:this.toBBox(m),E=[],v=this._chooseSubtree(y,this.data,f,E);for(v.children.push(m),s(v,y);f>=0&&E[f].children.length>this._maxEntries;)this._split(E,f),f--;this._adjustParentBBoxes(y,E,f)},n.prototype._split=function(m,f){var T=m[f],y=T.children.length,E=this._minEntries;this._chooseSplitAxis(T,E,y);var v=this._chooseSplitIndex(T,E,y),A=h(T.children.splice(v,T.children.length-v));A.height=T.height,A.leaf=T.leaf,i(T,this.toBBox),i(A,this.toBBox),f?m[f-1].children.push(A):this._splitRoot(T,A)},n.prototype._splitRoot=function(m,f){this.data=h([m,f]),this.data.height=m.height+1,this.data.leaf=!1,i(this.data,this.toBBox)},n.prototype._chooseSplitIndex=function(m,f,T){for(var y,E,v,A,I,C,g,R=1/0,D=1/0,P=f;P<=T-f;P++){var U=a(m,0,P,this.toBBox),B=a(m,P,T,this.toBBox),M=(E=U,v=B,A=void 0,I=void 0,C=void 0,g=void 0,A=Math.max(E.minX,v.minX),I=Math.max(E.minY,v.minY),C=Math.min(E.maxX,v.maxX),g=Math.min(E.maxY,v.maxY),Math.max(0,C-A)*Math.max(0,g-I)),F=c(U)+c(B);M<R?(R=M,y=P,D=F<D?F:D):M===R&&F<D&&(D=F,y=P)}return y||T-f},n.prototype._chooseSplitAxis=function(m,f,T){var y=m.leaf?this.compareMinX:l,E=m.leaf?this.compareMinY:d;this._allDistMargin(m,f,T,y)<this._allDistMargin(m,f,T,E)&&m.children.sort(y)},n.prototype._allDistMargin=function(m,f,T,y){m.children.sort(y);for(var E=this.toBBox,v=a(m,0,f,E),A=a(m,T-f,T,E),I=p(v)+p(A),C=f;C<T-f;C++){var g=m.children[C];s(v,m.leaf?E(g):g),I+=p(v)}for(var R=T-f-1;R>=f;R--){var D=m.children[R];s(A,m.leaf?E(D):D),I+=p(A)}return I},n.prototype._adjustParentBBoxes=function(m,f,T){for(var y=T;y>=0;y--)s(f[y],m)},n.prototype._condense=function(m){for(var f=m.length-1,T=void 0;f>=0;f--)m[f].children.length===0?f>0?(T=m[f-1].children).splice(T.indexOf(m[f]),1):this.clear():i(m[f],this.toBBox)},n})});var lb=cm((au,Zg)=>{(function(e,t){typeof au=="object"&&typeof Zg=="object"?Zg.exports=t():typeof define=="function"&&define.amd?define([],t):typeof au=="object"?au.JsDiff=t():e.JsDiff=t()})(au,function(){return function(r){var e={};function t(n){if(e[n])return e[n].exports;var o=e[n]={exports:{},id:n,loaded:!1};return r[n].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}return t.m=r,t.c=e,t.p="",t(0)}([function(r,e,t){"use strict";e.__esModule=!0,e.canonicalize=e.convertChangesToXML=e.convertChangesToDMP=e.merge=e.parsePatch=e.applyPatches=e.applyPatch=e.createPatch=e.createTwoFilesPatch=e.structuredPatch=e.diffArrays=e.diffJson=e.diffCss=e.diffSentences=e.diffTrimmedLines=e.diffLines=e.diffWordsWithSpace=e.diffWords=e.diffChars=e.Diff=void 0;var n=t(1),o=T(n),i=t(2),a=t(3),s=t(5),l=t(6),d=t(7),c=t(8),p=t(9),u=t(10),_=t(11),h=t(13),S=t(14),m=t(16),f=t(17);function T(y){return y&&y.__esModule?y:{default:y}}e.Diff=o.default,e.diffChars=i.diffChars,e.diffWords=a.diffWords,e.diffWordsWithSpace=a.diffWordsWithSpace,e.diffLines=s.diffLines,e.diffTrimmedLines=s.diffTrimmedLines,e.diffSentences=l.diffSentences,e.diffCss=d.diffCss,e.diffJson=c.diffJson,e.diffArrays=p.diffArrays,e.structuredPatch=S.structuredPatch,e.createTwoFilesPatch=S.createTwoFilesPatch,e.createPatch=S.createPatch,e.applyPatch=u.applyPatch,e.applyPatches=u.applyPatches,e.parsePatch=_.parsePatch,e.merge=h.merge,e.convertChangesToDMP=m.convertChangesToDMP,e.convertChangesToXML=f.convertChangesToXML,e.canonicalize=c.canonicalize},function(r,e){"use strict";e.__esModule=!0,e.default=t;function t(){}t.prototype={diff:function(a,s){var l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},d=l.callback;typeof l=="function"&&(d=l,l={}),this.options=l;var c=this;function p(E){return d?(setTimeout(function(){d(void 0,E)},0),!0):E}a=this.castInput(a),s=this.castInput(s),a=this.removeEmpty(this.tokenize(a)),s=this.removeEmpty(this.tokenize(s));var u=s.length,_=a.length,h=1,S=u+_,m=[{newPos:-1,components:[]}],f=this.extractCommon(m[0],s,a,0);if(m[0].newPos+1>=u&&f+1>=_)return p([{value:this.join(s),count:s.length}]);function T(){for(var E=-1*h;E<=h;E+=2){var v=void 0,A=m[E-1],I=m[E+1],C=(I?I.newPos:0)-E;A&&(m[E-1]=void 0);var g=A&&A.newPos+1<u,R=I&&0<=C&&C<_;if(!g&&!R){m[E]=void 0;continue}if(!g||R&&A.newPos<I.newPos?(v=o(I),c.pushComponent(v.components,void 0,!0)):(v=A,v.newPos++,c.pushComponent(v.components,!0,void 0)),C=c.extractCommon(v,s,a,E),v.newPos+1>=u&&C+1>=_)return p(n(c,v.components,s,a,c.useLongestToken));m[E]=v}h++}if(d)(function E(){setTimeout(function(){if(h>S)return d();T()||E()},0)})();else for(;h<=S;){var y=T();if(y)return y}},pushComponent:function(a,s,l){var d=a[a.length-1];d&&d.added===s&&d.removed===l?a[a.length-1]={count:d.count+1,added:s,removed:l}:a.push({count:1,added:s,removed:l})},extractCommon:function(a,s,l,d){for(var c=s.length,p=l.length,u=a.newPos,_=u-d,h=0;u+1<c&&_+1<p&&this.equals(s[u+1],l[_+1]);)u++,_++,h++;return h&&a.components.push({count:h}),a.newPos=u,_},equals:function(a,s){return this.options.comparator?this.options.comparator(a,s):a===s||this.options.ignoreCase&&a.toLowerCase()===s.toLowerCase()},removeEmpty:function(a){for(var s=[],l=0;l<a.length;l++)a[l]&&s.push(a[l]);return s},castInput:function(a){return a},tokenize:function(a){return a.split("")},join:function(a){return a.join("")}};function n(i,a,s,l,d){for(var c=0,p=a.length,u=0,_=0;c<p;c++){var h=a[c];if(h.removed){if(h.value=i.join(l.slice(_,_+h.count)),_+=h.count,c&&a[c-1].added){var m=a[c-1];a[c-1]=a[c],a[c]=m}}else{if(!h.added&&d){var S=s.slice(u,u+h.count);S=S.map(function(T,y){var E=l[_+y];return E.length>T.length?E:T}),h.value=i.join(S)}else h.value=i.join(s.slice(u,u+h.count));u+=h.count,h.added||(_+=h.count)}}var f=a[p-1];return p>1&&typeof f.value=="string"&&(f.added||f.removed)&&i.equals("",f.value)&&(a[p-2].value+=f.value,a.pop()),a}function o(i){return{newPos:i.newPos,components:i.components.slice(0)}}},function(r,e,t){"use strict";e.__esModule=!0,e.characterDiff=void 0,e.diffChars=s;var n=t(1),o=i(n);function i(l){return l&&l.__esModule?l:{default:l}}var a=e.characterDiff=new o.default;function s(l,d,c){return a.diff(l,d,c)}},function(r,e,t){"use strict";e.__esModule=!0,e.wordDiff=void 0,e.diffWords=c,e.diffWordsWithSpace=p;var n=t(1),o=a(n),i=t(4);function a(u){return u&&u.__esModule?u:{default:u}}var s=/^[A-Za-z\xC0-\u02C6\u02C8-\u02D7\u02DE-\u02FF\u1E00-\u1EFF]+$/,l=/\S/,d=e.wordDiff=new o.default;d.equals=function(u,_){return this.options.ignoreCase&&(u=u.toLowerCase(),_=_.toLowerCase()),u===_||this.options.ignoreWhitespace&&!l.test(u)&&!l.test(_)},d.tokenize=function(u){for(var _=u.split(/(\s+|\b)/),h=0;h<_.length-1;h++)!_[h+1]&&_[h+2]&&s.test(_[h])&&s.test(_[h+2])&&(_[h]+=_[h+2],_.splice(h+1,2),h--);return _};function c(u,_,h){return h=(0,i.generateOptions)(h,{ignoreWhitespace:!0}),d.diff(u,_,h)}function p(u,_,h){return d.diff(u,_,h)}},function(r,e){"use strict";e.__esModule=!0,e.generateOptions=t;function t(n,o){if(typeof n=="function")o.callback=n;else if(n)for(var i in n)n.hasOwnProperty(i)&&(o[i]=n[i]);return o}},function(r,e,t){"use strict";e.__esModule=!0,e.lineDiff=void 0,e.diffLines=l,e.diffTrimmedLines=d;var n=t(1),o=a(n),i=t(4);function a(c){return c&&c.__esModule?c:{default:c}}var s=e.lineDiff=new o.default;s.tokenize=function(c){var p=[],u=c.split(/(\n|\r\n)/);u[u.length-1]||u.pop();for(var _=0;_<u.length;_++){var h=u[_];_%2&&!this.options.newlineIsToken?p[p.length-1]+=h:(this.options.ignoreWhitespace&&(h=h.trim()),p.push(h))}return p};function l(c,p,u){return s.diff(c,p,u)}function d(c,p,u){var _=(0,i.generateOptions)(u,{ignoreWhitespace:!0});return s.diff(c,p,_)}},function(r,e,t){"use strict";e.__esModule=!0,e.sentenceDiff=void 0,e.diffSentences=s;var n=t(1),o=i(n);function i(l){return l&&l.__esModule?l:{default:l}}var a=e.sentenceDiff=new o.default;a.tokenize=function(l){return l.split(/(\S.+?[.!?])(?=\s+|$)/)};function s(l,d,c){return a.diff(l,d,c)}},function(r,e,t){"use strict";e.__esModule=!0,e.cssDiff=void 0,e.diffCss=s;var n=t(1),o=i(n);function i(l){return l&&l.__esModule?l:{default:l}}var a=e.cssDiff=new o.default;a.tokenize=function(l){return l.split(/([{}:;,]|\s+)/)};function s(l,d,c){return a.diff(l,d,c)}},function(r,e,t){"use strict";e.__esModule=!0,e.jsonDiff=void 0;var n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(u){return typeof u}:function(u){return u&&typeof Symbol=="function"&&u.constructor===Symbol&&u!==Symbol.prototype?"symbol":typeof u};e.diffJson=c,e.canonicalize=p;var o=t(1),i=s(o),a=t(5);function s(u){return u&&u.__esModule?u:{default:u}}var l=Object.prototype.toString,d=e.jsonDiff=new i.default;d.useLongestToken=!0,d.tokenize=a.lineDiff.tokenize,d.castInput=function(u){var _=this.options,h=_.undefinedReplacement,S=_.stringifyReplacer,m=S===void 0?function(f,T){return typeof T>"u"?h:T}:S;return typeof u=="string"?u:JSON.stringify(p(u,null,null,m),m,"  ")},d.equals=function(u,_){return i.default.prototype.equals.call(d,u.replace(/,([\r\n])/g,"$1"),_.replace(/,([\r\n])/g,"$1"))};function c(u,_,h){return d.diff(u,_,h)}function p(u,_,h,S,m){_=_||[],h=h||[],S&&(u=S(m,u));var f=void 0;for(f=0;f<_.length;f+=1)if(_[f]===u)return h[f];var T=void 0;if(l.call(u)==="[object Array]"){for(_.push(u),T=new Array(u.length),h.push(T),f=0;f<u.length;f+=1)T[f]=p(u[f],_,h,S,m);return _.pop(),h.pop(),T}if(u&&u.toJSON&&(u=u.toJSON()),(typeof u>"u"?"undefined":n(u))==="object"&&u!==null){_.push(u),T={},h.push(T);var y=[],E=void 0;for(E in u)u.hasOwnProperty(E)&&y.push(E);for(y.sort(),f=0;f<y.length;f+=1)E=y[f],T[E]=p(u[E],_,h,S,E);_.pop(),h.pop()}else T=u;return T}},function(r,e,t){"use strict";e.__esModule=!0,e.arrayDiff=void 0,e.diffArrays=s;var n=t(1),o=i(n);function i(l){return l&&l.__esModule?l:{default:l}}var a=e.arrayDiff=new o.default;a.tokenize=function(l){return l.slice()},a.join=a.removeEmpty=function(l){return l};function s(l,d,c){return a.diff(l,d,c)}},function(r,e,t){"use strict";e.__esModule=!0,e.applyPatch=s,e.applyPatches=l;var n=t(11),o=t(12),i=a(o);function a(d){return d&&d.__esModule?d:{default:d}}function s(d,c){var p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(typeof c=="string"&&(c=(0,n.parsePatch)(c)),Array.isArray(c)){if(c.length>1)throw new Error("applyPatch only works with a single input.");c=c[0]}var u=d.split(/\r\n|[\n\v\f\r\x85]/),_=d.match(/\r\n|[\n\v\f\r\x85]/g)||[],h=c.hunks,S=p.compareLine||function(j,pe,Pe,at){return pe===at},m=0,f=p.fuzzFactor||0,T=0,y=0,E=void 0,v=void 0;function A(j,pe){for(var Pe=0;Pe<j.lines.length;Pe++){var at=j.lines[Pe],Ke=at.length>0?at[0]:" ",_t=at.length>0?at.substr(1):at;if(Ke===" "||Ke==="-"){if(!S(pe+1,u[pe],Ke,_t)&&(m++,m>f))return!1;pe++}}return!0}for(var I=0;I<h.length;I++){for(var C=h[I],g=u.length-C.oldLines,R=0,D=y+C.oldStart-1,P=(0,i.default)(D,T,g);R!==void 0;R=P())if(A(C,D+R)){C.offset=y+=R;break}if(R===void 0)return!1;T=C.offset+C.oldStart+C.oldLines}for(var U=0,B=0;B<h.length;B++){var M=h[B],F=M.oldStart+M.offset+U-1;U+=M.newLines-M.oldLines,F<0&&(F=0);for(var w=0;w<M.lines.length;w++){var V=M.lines[w],k=V.length>0?V[0]:" ",H=V.length>0?V.substr(1):V,z=M.linedelimiters[w];if(k===" ")F++;else if(k==="-")u.splice(F,1),_.splice(F,1);else if(k==="+")u.splice(F,0,H),_.splice(F,0,z),F++;else if(k==="\\"){var Q=M.lines[w-1]?M.lines[w-1][0]:null;Q==="+"?E=!0:Q==="-"&&(v=!0)}}}if(E)for(;!u[u.length-1];)u.pop(),_.pop();else v&&(u.push(""),_.push(`
`));for(var K=0;K<u.length-1;K++)u[K]=u[K]+_[K];return u.join("")}function l(d,c){typeof d=="string"&&(d=(0,n.parsePatch)(d));var p=0;function u(){var _=d[p++];if(!_)return c.complete();c.loadFile(_,function(h,S){if(h)return c.complete(h);var m=s(S,_,c);c.patched(_,m,function(f){if(f)return c.complete(f);u()})})}u()}},function(r,e){"use strict";e.__esModule=!0,e.parsePatch=t;function t(n){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=n.split(/\r\n|[\n\v\f\r\x85]/),a=n.match(/\r\n|[\n\v\f\r\x85]/g)||[],s=[],l=0;function d(){var u={};for(s.push(u);l<i.length;){var _=i[l];if(/^(\-\-\-|\+\+\+|@@)\s/.test(_))break;var h=/^(?:Index:|diff(?: -r \w+)+)\s+(.+?)\s*$/.exec(_);h&&(u.index=h[1]),l++}for(c(u),c(u),u.hunks=[];l<i.length;){var S=i[l];if(/^(Index:|diff|\-\-\-|\+\+\+)\s/.test(S))break;if(/^@@/.test(S))u.hunks.push(p());else{if(S&&o.strict)throw new Error("Unknown line "+(l+1)+" "+JSON.stringify(S));l++}}}function c(u){var _=/^(---|\+\+\+)\s+(.*)$/.exec(i[l]);if(_){var h=_[1]==="---"?"old":"new",S=_[2].split("	",2),m=S[0].replace(/\\\\/g,"\\");/^".*"$/.test(m)&&(m=m.substr(1,m.length-2)),u[h+"FileName"]=m,u[h+"Header"]=(S[1]||"").trim(),l++}}function p(){for(var u=l,_=i[l++],h=_.split(/@@ -(\d+)(?:,(\d+))? \+(\d+)(?:,(\d+))? @@/),S={oldStart:+h[1],oldLines:+h[2]||1,newStart:+h[3],newLines:+h[4]||1,lines:[],linedelimiters:[]},m=0,f=0;l<i.length&&!(i[l].indexOf("--- ")===0&&l+2<i.length&&i[l+1].indexOf("+++ ")===0&&i[l+2].indexOf("@@")===0);l++){var T=i[l].length==0&&l!=i.length-1?" ":i[l][0];if(T==="+"||T==="-"||T===" "||T==="\\")S.lines.push(i[l]),S.linedelimiters.push(a[l]||`
`),T==="+"?m++:T==="-"?f++:T===" "&&(m++,f++);else break}if(!m&&S.newLines===1&&(S.newLines=0),!f&&S.oldLines===1&&(S.oldLines=0),o.strict){if(m!==S.newLines)throw new Error("Added line count did not match for hunk at line "+(u+1));if(f!==S.oldLines)throw new Error("Removed line count did not match for hunk at line "+(u+1))}return S}for(;l<i.length;)d();return s}},function(r,e){"use strict";e.__esModule=!0,e.default=function(t,n,o){var i=!0,a=!1,s=!1,l=1;return function d(){if(i&&!s){if(a?l++:i=!1,t+l<=o)return l;s=!0}if(!a)return s||(i=!0),n<=t-l?-l++:(a=!0,d())}}},function(r,e,t){"use strict";e.__esModule=!0,e.calcLineCount=s,e.merge=l;var n=t(14),o=t(11),i=t(15);function a(g){if(Array.isArray(g)){for(var R=0,D=Array(g.length);R<g.length;R++)D[R]=g[R];return D}else return Array.from(g)}function s(g){var R=C(g.lines),D=R.oldLines,P=R.newLines;D!==void 0?g.oldLines=D:delete g.oldLines,P!==void 0?g.newLines=P:delete g.newLines}function l(g,R,D){g=d(g,D),R=d(R,D);var P={};(g.index||R.index)&&(P.index=g.index||R.index),(g.newFileName||R.newFileName)&&(c(g)?c(R)?(P.oldFileName=p(P,g.oldFileName,R.oldFileName),P.newFileName=p(P,g.newFileName,R.newFileName),P.oldHeader=p(P,g.oldHeader,R.oldHeader),P.newHeader=p(P,g.newHeader,R.newHeader)):(P.oldFileName=g.oldFileName,P.newFileName=g.newFileName,P.oldHeader=g.oldHeader,P.newHeader=g.newHeader):(P.oldFileName=R.oldFileName||g.oldFileName,P.newFileName=R.newFileName||g.newFileName,P.oldHeader=R.oldHeader||g.oldHeader,P.newHeader=R.newHeader||g.newHeader)),P.hunks=[];for(var U=0,B=0,M=0,F=0;U<g.hunks.length||B<R.hunks.length;){var w=g.hunks[U]||{oldStart:1/0},V=R.hunks[B]||{oldStart:1/0};if(u(w,V))P.hunks.push(_(w,M)),U++,F+=w.newLines-w.oldLines;else if(u(V,w))P.hunks.push(_(V,F)),B++,M+=V.newLines-V.oldLines;else{var k={oldStart:Math.min(w.oldStart,V.oldStart),oldLines:0,newStart:Math.min(w.newStart+M,V.oldStart+F),newLines:0,lines:[]};h(k,w.oldStart,w.lines,V.oldStart,V.lines),B++,U++,P.hunks.push(k)}}return P}function d(g,R){if(typeof g=="string"){if(/^@@/m.test(g)||/^Index:/m.test(g))return(0,o.parsePatch)(g)[0];if(!R)throw new Error("Must provide a base reference or pass in a patch");return(0,n.structuredPatch)(void 0,void 0,R,g)}return g}function c(g){return g.newFileName&&g.newFileName!==g.oldFileName}function p(g,R,D){return R===D?R:(g.conflict=!0,{mine:R,theirs:D})}function u(g,R){return g.oldStart<R.oldStart&&g.oldStart+g.oldLines<R.oldStart}function _(g,R){return{oldStart:g.oldStart,oldLines:g.oldLines,newStart:g.newStart+R,newLines:g.newLines,lines:g.lines}}function h(g,R,D,P,U){var B={offset:R,lines:D,index:0},M={offset:P,lines:U,index:0};for(T(g,B,M),T(g,M,B);B.index<B.lines.length&&M.index<M.lines.length;){var F=B.lines[B.index],w=M.lines[M.index];if((F[0]==="-"||F[0]==="+")&&(w[0]==="-"||w[0]==="+"))S(g,B,M);else if(F[0]==="+"&&w[0]===" "){var V;(V=g.lines).push.apply(V,a(E(B)))}else if(w[0]==="+"&&F[0]===" "){var k;(k=g.lines).push.apply(k,a(E(M)))}else F[0]==="-"&&w[0]===" "?m(g,B,M):w[0]==="-"&&F[0]===" "?m(g,M,B,!0):F===w?(g.lines.push(F),B.index++,M.index++):f(g,E(B),E(M))}y(g,B),y(g,M),s(g)}function S(g,R,D){var P=E(R),U=E(D);if(A(P)&&A(U)){if((0,i.arrayStartsWith)(P,U)&&I(D,P,P.length-U.length)){var B;(B=g.lines).push.apply(B,a(P));return}else if((0,i.arrayStartsWith)(U,P)&&I(R,U,U.length-P.length)){var M;(M=g.lines).push.apply(M,a(U));return}}else if((0,i.arrayEqual)(P,U)){var F;(F=g.lines).push.apply(F,a(P));return}f(g,P,U)}function m(g,R,D,P){var U=E(R),B=v(D,U);if(B.merged){var M;(M=g.lines).push.apply(M,a(B.merged))}else f(g,P?B:U,P?U:B)}function f(g,R,D){g.conflict=!0,g.lines.push({conflict:!0,mine:R,theirs:D})}function T(g,R,D){for(;R.offset<D.offset&&R.index<R.lines.length;){var P=R.lines[R.index++];g.lines.push(P),R.offset++}}function y(g,R){for(;R.index<R.lines.length;){var D=R.lines[R.index++];g.lines.push(D)}}function E(g){for(var R=[],D=g.lines[g.index][0];g.index<g.lines.length;){var P=g.lines[g.index];if(D==="-"&&P[0]==="+"&&(D="+"),D===P[0])R.push(P),g.index++;else break}return R}function v(g,R){for(var D=[],P=[],U=0,B=!1,M=!1;U<R.length&&g.index<g.lines.length;){var F=g.lines[g.index],w=R[U];if(w[0]==="+")break;if(B=B||F[0]!==" ",P.push(w),U++,F[0]==="+")for(M=!0;F[0]==="+";)D.push(F),F=g.lines[++g.index];w.substr(1)===F.substr(1)?(D.push(F),g.index++):M=!0}if((R[U]||"")[0]==="+"&&B&&(M=!0),M)return D;for(;U<R.length;)P.push(R[U++]);return{merged:P,changes:D}}function A(g){return g.reduce(function(R,D){return R&&D[0]==="-"},!0)}function I(g,R,D){for(var P=0;P<D;P++){var U=R[R.length-D+P].substr(1);if(g.lines[g.index+P]!==" "+U)return!1}return g.index+=D,!0}function C(g){var R=0,D=0;return g.forEach(function(P){if(typeof P!="string"){var U=C(P.mine),B=C(P.theirs);R!==void 0&&(U.oldLines===B.oldLines?R+=U.oldLines:R=void 0),D!==void 0&&(U.newLines===B.newLines?D+=U.newLines:D=void 0)}else D!==void 0&&(P[0]==="+"||P[0]===" ")&&D++,R!==void 0&&(P[0]==="-"||P[0]===" ")&&R++}),{oldLines:R,newLines:D}}},function(r,e,t){"use strict";e.__esModule=!0,e.structuredPatch=i,e.createTwoFilesPatch=a,e.createPatch=s;var n=t(5);function o(l){if(Array.isArray(l)){for(var d=0,c=Array(l.length);d<l.length;d++)c[d]=l[d];return c}else return Array.from(l)}function i(l,d,c,p,u,_,h){h||(h={}),typeof h.context>"u"&&(h.context=4);var S=(0,n.diffLines)(c,p,h);S.push({value:"",lines:[]});function m(g){return g.map(function(R){return" "+R})}for(var f=[],T=0,y=0,E=[],v=1,A=1,I=function(R){var D=S[R],P=D.lines||D.value.replace(/\n$/,"").split(`
`);if(D.lines=P,D.added||D.removed){var U;if(!T){var B=S[R-1];T=v,y=A,B&&(E=h.context>0?m(B.lines.slice(-h.context)):[],T-=E.length,y-=E.length)}(U=E).push.apply(U,o(P.map(function(z){return(D.added?"+":"-")+z}))),D.added?A+=P.length:v+=P.length}else{if(T)if(P.length<=h.context*2&&R<S.length-2){var M;(M=E).push.apply(M,o(m(P)))}else{var F,w=Math.min(P.length,h.context);(F=E).push.apply(F,o(m(P.slice(0,w))));var V={oldStart:T,oldLines:v-T+w,newStart:y,newLines:A-y+w,lines:E};if(R>=S.length-2&&P.length<=h.context){var k=/\n$/.test(c),H=/\n$/.test(p);P.length==0&&!k?E.splice(V.oldLines,0,"\\ No newline at end of file"):(!k||!H)&&E.push("\\ No newline at end of file")}f.push(V),T=0,y=0,E=[]}v+=P.length,A+=P.length}},C=0;C<S.length;C++)I(C);return{oldFileName:l,newFileName:d,oldHeader:u,newHeader:_,hunks:f}}function a(l,d,c,p,u,_,h){var S=i(l,d,c,p,u,_,h),m=[];l==d&&m.push("Index: "+l),m.push("==================================================================="),m.push("--- "+S.oldFileName+(typeof S.oldHeader>"u"?"":"	"+S.oldHeader)),m.push("+++ "+S.newFileName+(typeof S.newHeader>"u"?"":"	"+S.newHeader));for(var f=0;f<S.hunks.length;f++){var T=S.hunks[f];m.push("@@ -"+T.oldStart+","+T.oldLines+" +"+T.newStart+","+T.newLines+" @@"),m.push.apply(m,T.lines)}return m.join(`
`)+`
`}function s(l,d,c,p,u,_){return a(l,l,d,c,p,u,_)}},function(r,e){"use strict";e.__esModule=!0,e.arrayEqual=t,e.arrayStartsWith=n;function t(o,i){return o.length!==i.length?!1:n(o,i)}function n(o,i){if(i.length>o.length)return!1;for(var a=0;a<i.length;a++)if(i[a]!==o[a])return!1;return!0}},function(r,e){"use strict";e.__esModule=!0,e.convertChangesToDMP=t;function t(n){for(var o=[],i=void 0,a=void 0,s=0;s<n.length;s++)i=n[s],i.added?a=1:i.removed?a=-1:a=0,o.push([a,i.value]);return o}},function(r,e){"use strict";e.__esModule=!0,e.convertChangesToXML=t;function t(o){for(var i=[],a=0;a<o.length;a++){var s=o[a];s.added?i.push("<ins>"):s.removed&&i.push("<del>"),i.push(n(s.value)),s.added?i.push("</ins>"):s.removed&&i.push("</del>")}return i.join("")}function n(o){var i=o;return i=i.replace(/&/g,"&amp;"),i=i.replace(/</g,"&lt;"),i=i.replace(/>/g,"&gt;"),i=i.replace(/"/g,"&quot;"),i}}])})});var bb=ml(wc());var Mu=class{_statsigDelegate;setDelegate(e){this._statsigDelegate=e}clearDelegate(){this._statsigDelegate=void 0}getDynamicConfigBoolean(e,t,n){return this._statsigDelegate?this._statsigDelegate.getDynamicConfigBoolean(e,t,n):n}getDynamicConfigNumber(e,t,n){return this._statsigDelegate?this._statsigDelegate.getDynamicConfigNumber(e,t,n):n}getDynamicConfigString(e,t,n){return this._statsigDelegate?this._statsigDelegate.getDynamicConfigString(e,t,n):n}getExperimentBoolean(e,t,n){return this._statsigDelegate?this._statsigDelegate.getExperimentBoolean(e,t,n):n}getExperimentNumber(e,t,n){return this._statsigDelegate?this._statsigDelegate.getExperimentNumber(e,t,n):n}getExperimentString(e,t,n){return this._statsigDelegate?this._statsigDelegate.getExperimentString(e,t,n):n}getFeatureGate(e){return this._statsigDelegate?this._statsigDelegate.getFeatureGate(e):!1}updateFeatureGateForTesting(e,t){this._statsigDelegate&&this._statsigDelegate.updateFeatureGateForTesting(e,t)}clearFeatureGatesForTesting(){this._statsigDelegate&&this._statsigDelegate.clearFeatureGatesForTesting()}setInRenderServerForViewerTests(){this._statsigDelegate&&this._statsigDelegate.setInRenderServerForViewerTests()}};var Qn=new Mu;var sr;(e=>{function r(t,n,o){return t<n?n:t>o?o:t}e.Math_clamp=r})(sr||(sr={}));var gl=r=>r===(r|0);var Gu;(n=>{function r(i,a){let s=0;switch(a){case 0:{for(let l of i)l<128?s=s+1:l<2048?s=s+2:l<65536?s=s+3:s=s+4;break}case 1:{for(let l of i)l<65536?s=s+1:s=s+2;break}case 2:{s=i.length;break}}return s}n.codeUnitCountForCodePoints=r;let e;(l=>(l[l.UTF8=0]="UTF8",l[l.UTF16=1]="UTF16",l[l.UTF32=2]="UTF32"))(e=n.Encoding||(n.Encoding={}));let o=class o{reset(a,s){return this.value=a,this.index=s,this.stop=a.length,this}countCodePointsUntil(a){let s=0;for(;this.index<a&&this.nextCodePoint()>=0;)s=s+1;return s}previousCodePoint(){if(this.index<=0)return-1;let a=this.value.charCodeAt(this.index=this.index-1);return(a&64512)!=56320?a:this.index<=0?-1:(this.value.charCodeAt(this.index=this.index-1)<<10)+a+-56613888}nextCodePoint(){if(this.index>=this.stop)return-1;let a=this.value.charCodeAt((this.index=this.index+1)+-1);if((a&64512)!=55296)return a;if(this.index>=this.stop)return-1;let s=this.value.charCodeAt((this.index=this.index+1)+-1);return(a<<10)+s+-56613888}constructor(){this.value="",this.index=0,this.stop=0}};o.INSTANCE=new o;let t=o;n.StringIterator=o})(Gu||(Gu={}));var ce=class{static equals(e,t){return e==null!=(t==null)?!1:e==null?!0:e.value==t.value}constructor(e){this.value=e}},dS=1e5;function Ir(r,e){if(e!=r,e.length<dS){r.push(...e);return}for(let t of e)r.push(t)}function uS(r,e,t){if(t!=r,t.length<dS){r.splice(e,0,...t);return}for(let n of t)r.splice(e,0,n),e=e+1}var ne;(d=>{function r(c){c.length!=0,c.pop()}d.List_removeLast=r;function e(c){let p=0;for(let u=0,_=c.length;u<_;u=u+1){let h=!1,S=c[u];for(let m=0;m<u;m=m+1)if(S==c[m]){h=!0;break}h||(p<u&&(c[p]=c[u]),p=p+1)}for(;p<c.length;)r(c)}d.List_removeDuplicates=e;function t(c){return c.length!=0,c[c.length-1]}d.List_last=t;function n(c,p){c.indexOf(p)==-1&&c.push(p)}d.List_appendOne=n;function o(c,p){let u=c.indexOf(p);u>=0&&c.splice(u,1)}d.List_removeOne=o;function i(c,p){let u=0;for(let _=0,h=c.length;_<h;_=_+1)p(c[_])||(u<_&&(c[u]=c[_]),u=u+1);for(;u<c.length;)r(c)}d.List_removeIf=i;function a(c,p){if(c.length!=p.length)return!1;for(let u=0,_=c.length;u<_;u=u+1)if(c[u]!=p[u])return!1;return!0}d.List_equals=a;function s(c,p){let u=c.slice();return u.push(p),u}d.List_cloneAndAppend=s;function l(c,p,u){if(c==null!=(p==null))return!1;if(c==null)return!0;if(c.length==p.length){for(let _=0,h=c.length;_<h;_=_+1)if(!u(c[_],p[_]))return!1;return!0}return!1}d.List_equalsWithComparison=l})(ne||(ne={}));var Ge;(n=>{function r(o,i,a){let s=o.get(i);return s!==void 0?s:a}n.StringMap_get=r;function e(o,i){o.forEach((a,s)=>{i(s,a)})}n.StringMap_each=e;function t(o){let i={};return e(o,(a,s)=>{i[a]=s}),i}n.StringMap_toJSObject=t})(Ge||(Ge={}));var Dt;(t=>{function r(n,o,i){let a=n.get(o);return a!==void 0?a:i}t.IntMap_get=r;function e(n,o){n.forEach((i,a)=>{o(a,i)})}t.IntMap_each=e})(Dt||(Dt={}));var gt;(t=>{function r(n,o){return(o<n?1:0)-(o>n?1:0)}t.int_compare=r;function e(n,o){return n%o|0}t.int_remainder=e})(gt||(gt={}));var kt;(n=>{function r(o,i){return(i<o?1:0)-(i>o?1:0)}n.double_compare=r;function e(o,i,a){return o*(1-a)+i*a}n.double_lerp=e;function t(o,i,a){return Math.min(Math.max(o,i),a)}n.double_clamp=t})(kt||(kt={}));var Lo;(i=>{function r(a){let s="";for(let l of a)s+=o(l);return s}i.string_fromCodePoints=r;function e(a,s){return(s<a|0)-(s>a|0)}i.string_compare=e;function t(a){let s="";for(let l of a)s+=String.fromCharCode(l);return s}i.string_fromCodeUnits=t;function n(a){let s=[],l=Gu.StringIterator.INSTANCE;for(l.reset(a,0);;){let d=l.nextCodePoint();if(d<0)return s;s.push(d)}}i.string_codePoints=n;function o(a){return a<65536?String.fromCharCode(a):String.fromCharCode((a-65536>>10)+55296)+String.fromCharCode((a-65536&1023)+56320)}i.string_fromCodePoint=o})(Lo||(Lo={}));var Lc=3;var pS;(function(r){r[r.INVALID=0]="INVALID",r[r.TEST_SETUP=1]="TEST_SETUP",r[r.USER=2]="USER",r[r.PLUGIN=3]="PLUGIN",r[r.SYSTEM=4]="SYSTEM",r[r.REST_API=5]="REST_API",r[r.ONBOARDING=6]="ONBOARDING",r[r.AUTOSAVE=7]="AUTOSAVE",r[r.AI=8]="AI"})(pS||(pS={}));var _S;(function(r){r[r.NONE=0]="NONE"})(_S||(_S={}));var hS;(function(r){r[r.IN_CUBIC=0]="IN_CUBIC",r[r.OUT_CUBIC=1]="OUT_CUBIC",r[r.INOUT_CUBIC=2]="INOUT_CUBIC",r[r.LINEAR=3]="LINEAR",r[r.IN_BACK_CUBIC=4]="IN_BACK_CUBIC",r[r.OUT_BACK_CUBIC=5]="OUT_BACK_CUBIC",r[r.INOUT_BACK_CUBIC=6]="INOUT_BACK_CUBIC",r[r.CUSTOM_CUBIC=7]="CUSTOM_CUBIC",r[r.SPRING=8]="SPRING",r[r.GENTLE_SPRING=9]="GENTLE_SPRING",r[r.CUSTOM_SPRING=10]="CUSTOM_SPRING",r[r.SPRING_PRESET_ONE=11]="SPRING_PRESET_ONE",r[r.SPRING_PRESET_TWO=12]="SPRING_PRESET_TWO",r[r.SPRING_PRESET_THREE=13]="SPRING_PRESET_THREE"})(hS||(hS={}));var mS;(function(r){r[r.LINEAR=0]="LINEAR",r[r.BEZIER=1]="BEZIER",r[r.OSCILLATION=2]="OSCILLATION",r[r.SPRING=3]="SPRING"})(mS||(mS={}));var fS;(function(r){r[r.SELF=0]="SELF",r[r.DESIGN=1]="DESIGN"})(fS||(fS={}));var gS;(function(r){r[r.SYNCED=0]="SYNCED",r[r.OFFLINE=1]="OFFLINE",r[r.SESSION_START=2]="SESSION_START",r[r.FORCED=3]="FORCED",r[r.LIMBOED_CHANGES=4]="LIMBOED_CHANGES"})(gS||(gS={}));var AS;(function(r){r[r.TEXT_MATCH=0]="TEXT_MATCH",r[r.LAYER_MATCH=1]="LAYER_MATCH",r[r.PAGE_MATCH=2]="PAGE_MATCH"})(AS||(AS={}));var SS;(function(r){r[r.TEXT=0]="TEXT",r[r.FRAME_OR_GROUP=1]="FRAME_OR_GROUP",r[r.COMPONENT=2]="COMPONENT",r[r.INSTANCE=3]="INSTANCE",r[r.IMAGE=4]="IMAGE",r[r.SHAPE=5]="SHAPE",r[r.OTHER=6]="OTHER"})(SS||(SS={}));var TS;(function(r){r[r.FIND=0]="FIND",r[r.REPLACE=1]="REPLACE"})(TS||(TS={}));var ES;(function(r){r[r.ACTIVE_PAGE=0]="ACTIVE_PAGE",r[r.ALL_PAGES=1]="ALL_PAGES"})(ES||(ES={}));var IS;(function(r){r[r.ONLY_ACTIVE=0]="ONLY_ACTIVE",r[r.ALL=1]="ALL"})(IS||(IS={}));var yS;(function(r){r[r.NONE=0]="NONE",r[r.UPPER_FIRST=1]="UPPER_FIRST",r[r.UPPER_ALL=2]="UPPER_ALL"})(yS||(yS={}));var RS;(function(r){r[r.NONE=0]="NONE",r[r.SELECT_ACTIVE=1]="SELECT_ACTIVE"})(RS||(RS={}));var vS;(function(r){r[r.ABOVE=0]="ABOVE",r[r.BELOW=1]="BELOW",r[r.LEFT=2]="LEFT",r[r.RIGHT=3]="RIGHT"})(vS||(vS={}));var OS;(function(r){r[r.TEXT=0]="TEXT",r[r.IMAGE=1]="IMAGE"})(OS||(OS={}));var CS;(function(r){r[r.CUSTOM=0]="CUSTOM",r[r.TWITTER_POST=1]="TWITTER_POST",r[r.LINKEDIN_POST=2]="LINKEDIN_POST"})(CS||(CS={}));var bS;(function(r){r[r.LIVE_FILE=0]="LIVE_FILE",r[r.HISTORY=1]="HISTORY",r[r.DETACHED_COMPONENTS=2]="DETACHED_COMPONENTS",r[r.PLAYGROUND=3]="PLAYGROUND",r[r.FIRST_DRAFT=4]="FIRST_DRAFT",r[r.HUB_FILE_EMBED=5]="HUB_FILE_EMBED",r[r.HUB_FILE_MOBILE=6]="HUB_FILE_MOBILE",r[r.FIGMASCOPE=7]="FIGMASCOPE",r[r.MOBILE=8]="MOBILE",r[r.COMPARE_CHANGES=9]="COMPARE_CHANGES",r[r.GARBAGE_COLLECTION_RESTORER=10]="GARBAGE_COLLECTION_RESTORER",r[r.TEMPLATE_COMMIT=11]="TEMPLATE_COMMIT",r[r.TEMPLATE_PREVIEW=12]="TEMPLATE_PREVIEW",r[r.FAKE_CLIPBOARD=13]="FAKE_CLIPBOARD",r[r.DEV_MODE_TYPOGRAPHY_PREVIEW=14]="DEV_MODE_TYPOGRAPHY_PREVIEW",r[r.SLIDE_THEME_STYLE_PREVIEW=15]="SLIDE_THEME_STYLE_PREVIEW",r[r.STYLE_SELECTION_PROPERTIES=16]="STYLE_SELECTION_PROPERTIES",r[r.EXPORTER_PAINT_ICON_RENDERING=17]="EXPORTER_PAINT_ICON_RENDERING",r[r.STYLE_RENDERING=18]="STYLE_RENDERING",r[r.AUTO_SUGGEST=19]="AUTO_SUGGEST",r[r.LINTER=20]="LINTER"})(bS||(bS={}));var NS;(function(r){r[r.SUCCESS=0]="SUCCESS",r[r.MERGE_IN_PROGRESS=1]="MERGE_IN_PROGRESS",r[r.PARSE_ERROR=2]="PARSE_ERROR",r[r.VERSION_MISMATCH=3]="VERSION_MISMATCH",r[r.INTERNAL_ERROR=4]="INTERNAL_ERROR"})(NS||(NS={}));var PS;(function(r){r[r.SUCCESS=0]="SUCCESS",r[r.PARSE_ERROR=1]="PARSE_ERROR",r[r.VERSION_MISMATCH=2]="VERSION_MISMATCH",r[r.INTERNAL_ERROR=3]="INTERNAL_ERROR"})(PS||(PS={}));var FS;(function(r){r[r.SUCCESS=0]="SUCCESS",r[r.NO_MERGE_IN_PROGRESS=1]="NO_MERGE_IN_PROGRESS",r[r.INTERNAL_ERROR=2]="INTERNAL_ERROR",r[r.MISSING_BACKING_SYMBOL=3]="MISSING_BACKING_SYMBOL"})(FS||(FS={}));var DS;(function(r){r[r.SUCCESS=0]="SUCCESS",r[r.NO_MERGE_IN_PROGRESS=1]="NO_MERGE_IN_PROGRESS",r[r.INVALID_INDEX=2]="INVALID_INDEX",r[r.INTERNAL_ERROR=3]="INTERNAL_ERROR",r[r.INVALID_STATE_TRANSITION=4]="INVALID_STATE_TRANSITION"})(DS||(DS={}));var wS;(function(r){r[r.SUCCESS=0]="SUCCESS",r[r.FAILURE=1]="FAILURE"})(wS||(wS={}));var LS;(function(r){r[r.SOURCE=0]="SOURCE",r[r.BRANCH=1]="BRANCH",r[r.COMPARE=2]="COMPARE"})(LS||(LS={}));var xS;(function(r){r[r.UPDATED_LIBRARY=0]="UPDATED_LIBRARY",r[r.CREATED=1]="CREATED",r[r.REMOVED=2]="REMOVED",r[r.UPDATED=3]="UPDATED",r[r.UNMODIFIED=4]="UNMODIFIED"})(xS||(xS={}));var BS;(function(r){r[r.SUCCESS=0]="SUCCESS",r[r.NO_MERGE_IN_PROGRESS=1]="NO_MERGE_IN_PROGRESS",r[r.UNABLE_TO_UNDO_CHANGES=2]="UNABLE_TO_UNDO_CHANGES",r[r.INTERNAL_ERROR=3]="INTERNAL_ERROR"})(BS||(BS={}));var MS;(function(r){r[r.BASIS_PARENT=0]="BASIS_PARENT",r[r.PARENT=1]="PARENT"})(MS||(MS={}));var GS;(function(r){r[r.PREVIEW=0]="PREVIEW",r[r.STAGE=1]="STAGE"})(GS||(GS={}));var US;(function(r){r[r.GENERIC=0]="GENERIC",r[r.STATE_GROUP=1]="STATE_GROUP",r[r.VARIABLE_COLLECTION=2]="VARIABLE_COLLECTION"})(US||(US={}));var VS;(function(r){r[r.STYLE_ATTACH=0]="STYLE_ATTACH",r[r.STYLE_DETACH=1]="STYLE_DETACH",r[r.VARIABLE_ATTACH=2]="VARIABLE_ATTACH",r[r.VARIABLE_DETACH=3]="VARIABLE_DETACH",r[r.IGNORE=4]="IGNORE",r[r.NONE=5]="NONE"})(VS||(VS={}));var kS;(function(r){r[r.DUPLICATION=0]="DUPLICATION",r[r.COPY_PASTE_FROM_SAME_FILE=1]="COPY_PASTE_FROM_SAME_FILE",r[r.COPY_PASTE_FROM_DIFFERENT_FILE=2]="COPY_PASTE_FROM_DIFFERENT_FILE",r[r.SWAPPING_FROM_LIBRARY_DRAG_AND_DROP=3]="SWAPPING_FROM_LIBRARY_DRAG_AND_DROP",r[r.SWAPPING_FROM_PROPERTIES_PANEL=4]="SWAPPING_FROM_PROPERTIES_PANEL",r[r.LIBRARY_DRAG_AND_DROP=5]="LIBRARY_DRAG_AND_DROP",r[r.PLAYGROUND=6]="PLAYGROUND",r[r.VIA_NODE_INSERTION=7]="VIA_NODE_INSERTION",r[r.DIRECT=8]="DIRECT",r[r.UNKNOWN=9]="UNKNOWN"})(kS||(kS={}));var HS;(function(r){r[r.APPLE=0]="APPLE",r[r.NOTO=1]="NOTO"})(HS||(HS={}));var zS;(function(r){r[r.PNG=0]="PNG",r[r.SVG=1]="SVG",r[r.RASTERIZE=2]="RASTERIZE"})(zS||(zS={}));var WS;(function(r){r[r.NO=0]="NO",r[r.YES=1]="YES",r[r.YES_WITHOUT_REORDER=2]="YES_WITHOUT_REORDER"})(WS||(WS={}));var KS;(function(r){r[r.SHAPES_SIDEBAR_REGULAR=0]="SHAPES_SIDEBAR_REGULAR",r[r.SHAPES_SIDEBAR_RECENTS=1]="SHAPES_SIDEBAR_RECENTS",r[r.OTHER=2]="OTHER",r[r.NONE=3]="NONE"})(KS||(KS={}));var YS;(function(r){r[r.CURRENT_TAB=0]="CURRENT_TAB",r[r.NEW_TAB=1]="NEW_TAB"})(YS||(YS={}));var QS;(function(r){r[r.SEARCH=0]="SEARCH",r[r.PREFERENCES=1]="PREFERENCES",r[r.HIDE_UI=2]="HIDE_UI"})(QS||(QS={}));var XS;(function(r){r[r.COPY_PASTE=0]="COPY_PASTE",r[r.COMPONENT_IMPORT=1]="COMPONENT_IMPORT",r[r.STATE_GROUP_IMPORT=2]="STATE_GROUP_IMPORT",r[r.STYLE_IMPORT=3]="STYLE_IMPORT",r[r.BRANCH_MERGE=4]="BRANCH_MERGE",r[r.TEMPLATE_INSERTION=5]="TEMPLATE_INSERTION",r[r.VARIABLE_IMPORT=6]="VARIABLE_IMPORT",r[r.VARIABLE_SET_IMPORT=7]="VARIABLE_SET_IMPORT",r[r.PLAYGROUND_INSERT=8]="PLAYGROUND_INSERT",r[r.MODULE_IMPORT=9]="MODULE_IMPORT"})(XS||(XS={}));var qS;(function(r){r[r.SOLID=0]="SOLID",r[r.DASHED=1]="DASHED",r[r.NONE=2]="NONE"})(qS||(qS={}));var ZS;(function(r){r[r.NO=0]="NO",r[r.YES=1]="YES"})(ZS||(ZS={}));var JS;(function(r){r[r.ACTIVE_SCENE=0]="ACTIVE_SCENE",r[r.PLAYGROUND_SCENE=1]="PLAYGROUND_SCENE"})(JS||(JS={}));var jS;(function(r){r[r.NONE=0]="NONE",r[r.BLACK=1]="BLACK",r[r.GRAY_DARK=2]="GRAY_DARK",r[r.GRAY=3]="GRAY",r[r.GRAY_LIGHT=4]="GRAY_LIGHT",r[r.RED=5]="RED",r[r.RED_LIGHT=6]="RED_LIGHT",r[r.ORANGE=7]="ORANGE",r[r.ORANGE_LIGHT=8]="ORANGE_LIGHT",r[r.YELLOW=9]="YELLOW",r[r.YELLOW_LIGHT=10]="YELLOW_LIGHT",r[r.GREEN=11]="GREEN",r[r.GREEN_LIGHT=12]="GREEN_LIGHT",r[r.BLUE=13]="BLUE",r[r.BLUE_LIGHT=14]="BLUE_LIGHT",r[r.VIOLET=15]="VIOLET",r[r.VIOLET_LIGHT=16]="VIOLET_LIGHT",r[r.WHITE=17]="WHITE",r[r.PINK=18]="PINK",r[r.PINK_LIGHT=19]="PINK_LIGHT",r[r.INDIGO=20]="INDIGO",r[r.INDIGO_LIGHT=21]="INDIGO_LIGHT",r[r.COBALT=22]="COBALT",r[r.COBALT_LIGHT=23]="COBALT_LIGHT",r[r.TEAL=24]="TEAL",r[r.TEAL_LIGHT=25]="TEAL_LIGHT",r[r.OLIVE=26]="OLIVE",r[r.OLIVE_LIGHT=27]="OLIVE_LIGHT",r[r.STICKY_GRAY=28]="STICKY_GRAY",r[r.STICKY_GRAY_UI3=29]="STICKY_GRAY_UI3",r[r.STICKY_RED=30]="STICKY_RED",r[r.STICKY_ORANGE=31]="STICKY_ORANGE",r[r.STICKY_YELLOW=32]="STICKY_YELLOW",r[r.STICKY_GREEN=33]="STICKY_GREEN",r[r.STICKY_BLUE=34]="STICKY_BLUE",r[r.STICKY_VIOLET=35]="STICKY_VIOLET",r[r.STICKY_PINK=36]="STICKY_PINK",r[r.STICKY_GRAY_LIGHT=37]="STICKY_GRAY_LIGHT",r[r.STICKY_INDIGO=38]="STICKY_INDIGO",r[r.STICKY_COBALT=39]="STICKY_COBALT",r[r.STICKY_TEAL=40]="STICKY_TEAL",r[r.STICKY_OLIVE=41]="STICKY_OLIVE",r[r.HIGHLIGHT_GRAY=42]="HIGHLIGHT_GRAY",r[r.HIGHLIGHT_RED=43]="HIGHLIGHT_RED",r[r.HIGHLIGHT_YELLOW=44]="HIGHLIGHT_YELLOW",r[r.HIGHLIGHT_GREEN=45]="HIGHLIGHT_GREEN",r[r.HIGHLIGHT_BLUE=46]="HIGHLIGHT_BLUE",r[r.HIGHLIGHT_VIOLET=47]="HIGHLIGHT_VIOLET",r[r.HIGHLIGHT_ORANGE=48]="HIGHLIGHT_ORANGE",r[r.HIGHLIGHT_WHITE=49]="HIGHLIGHT_WHITE",r[r.CODE_BLOCK_DRACULA=50]="CODE_BLOCK_DRACULA",r[r.CODE_BLOCK_DUOTONE_LIGHT=51]="CODE_BLOCK_DUOTONE_LIGHT",r[r.CODE_BLOCK_DUOTONE_SEA=52]="CODE_BLOCK_DUOTONE_SEA",r[r.CODE_BLOCK_DUOTONE_SPACE=53]="CODE_BLOCK_DUOTONE_SPACE",r[r.CODE_BLOCK_DUOTONE_EARTH=54]="CODE_BLOCK_DUOTONE_EARTH",r[r.CODE_BLOCK_DUOTONE_FOREST=55]="CODE_BLOCK_DUOTONE_FOREST",r[r.CUSTOM=56]="CUSTOM"})(jS||(jS={}));var $S;(function(r){r[r.LAYERS=0]="LAYERS",r[r.ASSETS=1]="ASSETS",r[r.KITS_SITES=2]="KITS_SITES",r[r.DAKOTA=3]="DAKOTA",r[r.CODE=4]="CODE"})($S||($S={}));var eT;(function(r){r[r.NEXT=0]="NEXT",r[r.PREVIOUS=1]="PREVIOUS",r[r.COMMIT=2]="COMMIT",r[r.CANCEL=3]="CANCEL",r[r.CLEAR=4]="CLEAR"})(eT||(eT={}));var tT;(function(r){r[r.VISIBLE=0]="VISIBLE",r[r.TRANSPARENT=1]="TRANSPARENT",r[r.TRANSPARENT_CUSTOM=2]="TRANSPARENT_CUSTOM",r[r.HIDDEN=3]="HIDDEN"})(tT||(tT={}));var rT;(function(r){r[r.COPY_TO_CLIPBOARD=0]="COPY_TO_CLIPBOARD",r[r.COMPOSE_EMAIL=1]="COMPOSE_EMAIL"})(rT||(rT={}));var nT;(function(r){r[r.PLACEHOLDER=1]="PLACEHOLDER",r[r.TOOLBELT_A11y=2]="TOOLBELT_A11y"})(nT||(nT={}));var oT;(function(r){r[r.RULER=0]="RULER",r[r.GUIDE=1]="GUIDE",r[r.BOTH=2]="BOTH"})(oT||(oT={}));var iT;(function(r){r[r.GENERIC=0]="GENERIC",r[r.SNAP=1]="SNAP",r[r.LEVEL=2]="LEVEL"})(iT||(iT={}));var aT;(function(r){r[r.YES=0]="YES",r[r.NO=1]="NO"})(aT||(aT={}));var sT;(function(r){r[r.FIGMA=0]="FIGMA",r[r.SITE=1]="SITE"})(sT||(sT={}));var lT;(function(r){r[r.TRANSLATE_TEXT=0]="TRANSLATE_TEXT",r[r.REWRITE_TEXT=1]="REWRITE_TEXT",r[r.SHORTEN_TEXT=2]="SHORTEN_TEXT",r[r.FIRST_DRAFT=3]="FIRST_DRAFT",r[r.FIRST_DRAFT_MAKE_CHANGES=4]="FIRST_DRAFT_MAKE_CHANGES",r[r.FIRST_DRAFT_MAKE_KIT_DEBUG=5]="FIRST_DRAFT_MAKE_KIT_DEBUG",r[r.FIND_INSPIRATION=6]="FIND_INSPIRATION",r[r.REMOVE_BACKGROUND=7]="REMOVE_BACKGROUND",r[r.AUTO_RENAME_LAYERS=8]="AUTO_RENAME_LAYERS",r[r.GENERATE_IMAGE=9]="GENERATE_IMAGE",r[r.MAGIC_LINK=10]="MAGIC_LINK",r[r.CONTENT_FILL=11]="CONTENT_FILL",r[r.SLIDES_REWRITE_TEXT=12]="SLIDES_REWRITE_TEXT",r[r.ASSISTANT_CHAT=13]="ASSISTANT_CHAT",r[r.MAKE_EDITS=14]="MAKE_EDITS",r[r.UPSCALE_IMAGE=15]="UPSCALE_IMAGE",r[r.FIRST_DRAFT_FINE_TUNE=16]="FIRST_DRAFT_FINE_TUNE"})(lT||(lT={}));var cT;(function(r){r[r.CONTEXT_MENU=0]="CONTEXT_MENU",r[r.QUICK_ACTIONS=1]="QUICK_ACTIONS",r[r.CREATE_COMPONENT=2]="CREATE_COMPONENT",r[r.CREATE_FRAME=3]="CREATE_FRAME",r[r.DRAW_FRAME_AROUND_NODES=4]="DRAW_FRAME_AROUND_NODES",r[r.STACK_SELECTION=5]="STACK_SELECTION",r[r.FIRST_DRAFT_LINT=6]="FIRST_DRAFT_LINT",r[r.EXPORT_FRAME=7]="EXPORT_FRAME",r[r.EXPORT_PICKER=8]="EXPORT_PICKER",r[r.MAGIC_LINK=9]="MAGIC_LINK",r[r.READY_FOR_DEV=10]="READY_FOR_DEV",r[r.LAYERS_PANEL_ACTION_ROW=11]="LAYERS_PANEL_ACTION_ROW",r[r.LAYERS_PANEL_OVERFLOW_MENU=12]="LAYERS_PANEL_OVERFLOW_MENU"})(cT||(cT={}));var dT;(function(r){r[r.CURRENT=0]="CURRENT",r[r.FIRST_DRAFT=1]="FIRST_DRAFT"})(dT||(dT={}));var uT;(function(r){r[r.EMPTY=0]="EMPTY",r[r.RESIZING_WIDTH_AND_HEIGHT=1]="RESIZING_WIDTH_AND_HEIGHT",r[r.RESIZING_HEIGHT=2]="RESIZING_HEIGHT",r[r.RESIZING_NONE=3]="RESIZING_NONE",r[r.TRUNCATION_DISABLED=4]="TRUNCATION_DISABLED",r[r.TRUNCATION_ENABLED=5]="TRUNCATION_ENABLED",r[r.ALIGNMENT_LEFT=6]="ALIGNMENT_LEFT",r[r.ALIGNMENT_CENTER=7]="ALIGNMENT_CENTER",r[r.ALIGNMENT_RIGHT=8]="ALIGNMENT_RIGHT",r[r.ALIGNMENT_JUSTIFIED=9]="ALIGNMENT_JUSTIFIED",r[r.DECORATION_NONE=10]="DECORATION_NONE",r[r.DECORATION_UNDERLINE=11]="DECORATION_UNDERLINE",r[r.DECORATION_STRIKETHROUGH=12]="DECORATION_STRIKETHROUGH",r[r.LIST_STYLE_PLAIN=13]="LIST_STYLE_PLAIN",r[r.LIST_STYLE_UNORDERED=14]="LIST_STYLE_UNORDERED",r[r.LIST_STYLE_ORDERED=15]="LIST_STYLE_ORDERED",r[r.TEXT_CASE_ORIGINAL=16]="TEXT_CASE_ORIGINAL",r[r.TEXT_CASE_UPPER=17]="TEXT_CASE_UPPER",r[r.TEXT_CASE_LOWER=18]="TEXT_CASE_LOWER",r[r.TEXT_CASE_TITLE=19]="TEXT_CASE_TITLE",r[r.TEXT_CASE_SMALL_CAPS=20]="TEXT_CASE_SMALL_CAPS",r[r.TEXT_CASE_SMALL_CAPS_FORCED=21]="TEXT_CASE_SMALL_CAPS_FORCED",r[r.FRACTIONS_ON=22]="FRACTIONS_ON",r[r.FRACTIONS_OFF=23]="FRACTIONS_OFF",r[r.DISCRETIONARY_LIGATURES_ON=24]="DISCRETIONARY_LIGATURES_ON",r[r.DISCRETIONARY_LIGATURES_OFF=25]="DISCRETIONARY_LIGATURES_OFF",r[r.HISTORICAL_LIGATURES_ON=26]="HISTORICAL_LIGATURES_ON",r[r.HISTORICAL_LIGATURES_OFF=27]="HISTORICAL_LIGATURES_OFF",r[r.NUMERIC_STYLE_ORIGINAL=28]="NUMERIC_STYLE_ORIGINAL",r[r.NUMERIC_STYLE_UPPER_PROPORTIONAL=29]="NUMERIC_STYLE_UPPER_PROPORTIONAL",r[r.NUMERIC_STYLE_UPPER_MONOSPACE=30]="NUMERIC_STYLE_UPPER_MONOSPACE",r[r.NUMERIC_STYLE_LOWER_PROPORTIONAL=31]="NUMERIC_STYLE_LOWER_PROPORTIONAL",r[r.NUMERIC_STYLE_LOWER_MONOSPACE=32]="NUMERIC_STYLE_LOWER_MONOSPACE",r[r.NUMERIC_POSITION_SUB=33]="NUMERIC_POSITION_SUB",r[r.NUMERIC_POSITION_SUPER=34]="NUMERIC_POSITION_SUPER",r[r.NUMERIC_POSITION_NORMAL=35]="NUMERIC_POSITION_NORMAL",r[r.OPENTYPE_FEATURE_ON=36]="OPENTYPE_FEATURE_ON",r[r.OPENTYPE_FEATURE_OFF=37]="OPENTYPE_FEATURE_OFF",r[r.FONT_VARIATIONS=38]="FONT_VARIATIONS",r[r.LEADING_TRIM_CAP_HEIGHT=39]="LEADING_TRIM_CAP_HEIGHT",r[r.LEADING_TRIM_NONE=40]="LEADING_TRIM_NONE",r[r.HANGING_PUNCTUATION_ON=41]="HANGING_PUNCTUATION_ON",r[r.HANGING_PUNCTUATION_OFF=42]="HANGING_PUNCTUATION_OFF",r[r.HANGING_LISTS_ON=43]="HANGING_LISTS_ON",r[r.HANGING_LISTS_OFF=44]="HANGING_LISTS_OFF",r[r.DECORATION_STYLE_SOLID=45]="DECORATION_STYLE_SOLID",r[r.DECORATION_STYLE_DOTTED=46]="DECORATION_STYLE_DOTTED",r[r.DECORATION_STYLE_WAVY=47]="DECORATION_STYLE_WAVY",r[r.DECORATION_SKIP_INK_ON=48]="DECORATION_SKIP_INK_ON",r[r.DECORATION_SKIP_INK_OFF=49]="DECORATION_SKIP_INK_OFF"})(uT||(uT={}));var pT;(function(r){r[r.CURRENT_PAGE=0]="CURRENT_PAGE",r[r.ALL_PAGES=1]="ALL_PAGES",r[r.CURRENT_SELECTION=2]="CURRENT_SELECTION"})(pT||(pT={}));var _T;(function(r){r[r.LOADED=0]="LOADED",r[r.LOADING=1]="LOADING",r[r.FAILED=2]="FAILED"})(_T||(_T={}));var hT;(function(r){r[r.PLUGIN=0]="PLUGIN",r[r.NON_PLUGIN=1]="NON_PLUGIN"})(hT||(hT={}));var mT;(function(r){r[r.AUTOMATIC=0]="AUTOMATIC",r[r.WHEN_REQUESTED=1]="WHEN_REQUESTED"})(mT||(mT={}));var fT;(function(r){r[r.NONE=0]="NONE",r[r.HORIZONTAL=1]="HORIZONTAL",r[r.VERTICAL=2]="VERTICAL"})(fT||(fT={}));var gT;(function(r){r[r.MIN=0]="MIN",r[r.CENTER=1]="CENTER",r[r.MAX=2]="MAX",r[r.SPACE_EVENLY=3]="SPACE_EVENLY",r[r.SPACE_BETWEEN=4]="SPACE_BETWEEN"})(gT||(gT={}));var AT;(function(r){r[r.MIN=0]="MIN",r[r.CENTER=1]="CENTER",r[r.MAX=2]="MAX",r[r.BASELINE=3]="BASELINE"})(AT||(AT={}));var ST;(function(r){r[r.MIN=0]="MIN",r[r.CENTER=1]="CENTER",r[r.MAX=2]="MAX",r[r.STRETCH=3]="STRETCH",r[r.AUTO=4]="AUTO",r[r.BASELINE=5]="BASELINE"})(ST||(ST={}));var TT;(function(r){r[r.AUTO=0]="AUTO",r[r.ABSOLUTE=1]="ABSOLUTE"})(TT||(TT={}));var ET;(function(r){r[r.FIXED=0]="FIXED",r[r.RESIZE_TO_FIT=1]="RESIZE_TO_FIT",r[r.RESIZE_TO_FIT_WITH_IMPLICIT_SIZE=2]="RESIZE_TO_FIT_WITH_IMPLICIT_SIZE"})(ET||(ET={}));var IT;(function(r){r[r.PACKED=0]="PACKED",r[r.SPACE_BETWEEN=1]="SPACE_BETWEEN"})(IT||(IT={}));var yT;(function(r){r[r.PADDING_TOP=0]="PADDING_TOP",r[r.PADDING_RIGHT=1]="PADDING_RIGHT",r[r.PADDING_BOTTOM=2]="PADDING_BOTTOM",r[r.PADDING_LEFT=3]="PADDING_LEFT",r[r.PADDING_HORIZONTAL=4]="PADDING_HORIZONTAL",r[r.PADDING_VERTICAL=5]="PADDING_VERTICAL",r[r.PADDING_ALL=6]="PADDING_ALL",r[r.SPACING=7]="SPACING",r[r.COUNTER_SPACING=8]="COUNTER_SPACING"})(yT||(yT={}));var RT;(function(r){r[r.TOP=0]="TOP",r[r.RIGHT=1]="RIGHT",r[r.BOTTOM=2]="BOTTOM",r[r.LEFT=3]="LEFT"})(RT||(RT={}));var vT;(function(r){r[r.SRGB=0]="SRGB",r[r.DISPLAY_P3=1]="DISPLAY_P3"})(vT||(vT={}));var OT;(function(r){r[r.LEGACY=0]="LEGACY",r[r.SRGB=1]="SRGB",r[r.DISPLAY_P3=2]="DISPLAY_P3"})(OT||(OT={}));var CT;(function(r){r[r.DOCUMENT=0]="DOCUMENT",r[r.SRGB=1]="SRGB",r[r.DISPLAY_P3_V4=2]="DISPLAY_P3_V4"})(CT||(CT={}));var bT;(function(r){r[r.NO_CONVERSION=0]="NO_CONVERSION",r[r.SRGB_TO_DISPLAY_P3=1]="SRGB_TO_DISPLAY_P3",r[r.DISPLAY_P3_TO_SRGB=2]="DISPLAY_P3_TO_SRGB"})(bT||(bT={}));var ee;(function(r){r[r.REDUX=0]="REDUX",r[r.PLUGIN=1]="PLUGIN",r[r.PROTOTYPE_LIB=2]="PROTOTYPE_LIB"})(ee||(ee={}));var NT;(function(r){r[r.IGNORE=0]="IGNORE",r[r.TRACK=1]="TRACK"})(NT||(NT={}));var PT;(function(r){r[r.NONE=0]="NONE",r[r.BUILD=1]="BUILD",r[r.COMPLETED=2]="COMPLETED"})(PT||(PT={}));var FT;(function(r){r[r.NONE=0]="NONE",r[r.AUTO=1]="AUTO",r[r.TOP=2]="TOP",r[r.LEFT=3]="LEFT",r[r.BOTTOM=4]="BOTTOM",r[r.RIGHT=5]="RIGHT",r[r.CENTER=6]="CENTER",r[r.EDGE=7]="EDGE",r[r.ABSOLUTE=8]="ABSOLUTE"})(FT||(FT={}));var DT;(function(r){r[r.FILL=0]="FILL",r[r.STROKE=1]="STROKE",r[r.WIDTH=2]="WIDTH",r[r.HEIGHT=3]="HEIGHT",r[r.MIN_WIDTH=4]="MIN_WIDTH",r[r.MIN_HEIGHT=5]="MIN_HEIGHT",r[r.MAX_WIDTH=6]="MAX_WIDTH",r[r.MAX_HEIGHT=7]="MAX_HEIGHT",r[r.STROKE_WIDTH=8]="STROKE_WIDTH",r[r.CORNER_RADIUS=9]="CORNER_RADIUS",r[r.EFFECT=10]="EFFECT",r[r.TEXT_STYLE=11]="TEXT_STYLE",r[r.TEXT_ALIGN_HORIZONTAL=12]="TEXT_ALIGN_HORIZONTAL",r[r.FONT_FAMILY=13]="FONT_FAMILY",r[r.FONT_SIZE=14]="FONT_SIZE",r[r.FONT_WEIGHT=15]="FONT_WEIGHT",r[r.LINE_HEIGHT=16]="LINE_HEIGHT",r[r.LETTER_SPACING=17]="LETTER_SPACING",r[r.STACK_SPACING=18]="STACK_SPACING",r[r.STACK_PADDING=19]="STACK_PADDING",r[r.STACK_MODE=20]="STACK_MODE",r[r.STACK_ALIGNMENT=21]="STACK_ALIGNMENT",r[r.OPACITY=22]="OPACITY",r[r.COMPONENT=23]="COMPONENT",r[r.FONT_STYLE=24]="FONT_STYLE"})(DT||(DT={}));var wT;(function(r){r[r.YELLOW=0]="YELLOW",r[r.ORANGE=1]="ORANGE",r[r.RED=2]="RED",r[r.PINK=3]="PINK",r[r.VIOLET=4]="VIOLET",r[r.BLUE=5]="BLUE",r[r.TEAL=6]="TEAL",r[r.GREEN=7]="GREEN"})(wT||(wT={}));var LT;(function(r){r[r.NONE=0]="NONE",r[r.ACCESSIBILITY=1]="ACCESSIBILITY",r[r.BEHAVIOR=2]="BEHAVIOR",r[r.CONTENT=3]="CONTENT",r[r.DEVELOPMENT=4]="DEVELOPMENT",r[r.INTERACTION=5]="INTERACTION"})(LT||(LT={}));var xT;(function(r){r[r.TOP=0]="TOP",r[r.BOTTOM=1]="BOTTOM",r[r.LEFT=2]="LEFT",r[r.RIGHT=3]="RIGHT"})(xT||(xT={}));var BT;(function(r){r[r.LOCAL=0]="LOCAL",r[r.LIBRARY=1]="LIBRARY"})(BT||(BT={}));var MT;(function(r){r[r.NONE=0]="NONE",r[r.BUILDING_BLOCK=1]="BUILDING_BLOCK",r[r.GROUPED_COMPONENT=2]="GROUPED_COMPONENT"})(MT||(MT={}));var GT;(function(r){r[r.COMPONENT=0]="COMPONENT",r[r.STATE_GROUP=1]="STATE_GROUP"})(GT||(GT={}));var UT;(function(r){r[r.NONE=0]="NONE",r[r.CAP_HEIGHT=1]="CAP_HEIGHT"})(UT||(UT={}));var VT;(function(r){r[r.POLL=0]="POLL",r[r.EMBED=1]="EMBED",r[r.FACEPILE=2]="FACEPILE",r[r.ALIGNMENT=3]="ALIGNMENT",r[r.YOUTUBE=4]="YOUTUBE"})(VT||(VT={}));var kT;(function(r){r[r.RAW=0]="RAW",r[r.PIXELS=1]="PIXELS",r[r.PERCENT=2]="PERCENT"})(kT||(kT={}));var Uu;(function(r){r[r.FILL=0]="FILL",r[r.STROKE=1]="STROKE",r[r.BACKGROUND__NO_LONGER_USED=2]="BACKGROUND__NO_LONGER_USED",r[r.TEXT=3]="TEXT",r[r.EFFECT=4]="EFFECT",r[r.GRID=5]="GRID",r[r.DEPRECATED_STROKE=6]="DEPRECATED_STROKE",r[r.NOT_SUPPORTED=7]="NOT_SUPPORTED"})(Uu||(Uu={}));var HT;(function(r){r[r.TOGGLE_BOLD=0]="TOGGLE_BOLD",r[r.INCREASE_BOLD=1]="INCREASE_BOLD",r[r.DECREASE_BOLD=2]="DECREASE_BOLD",r[r.TOGGLE_ITALIC=3]="TOGGLE_ITALIC",r[r.TOGGLE_UNDERLINE=4]="TOGGLE_UNDERLINE",r[r.TOGGLE_STRIKETHROUGH=5]="TOGGLE_STRIKETHROUGH",r[r.REMOVE_DECORATION=6]="REMOVE_DECORATION",r[r.SET_ORIGINAL_CASE=7]="SET_ORIGINAL_CASE",r[r.SET_UPPER_CASE=8]="SET_UPPER_CASE",r[r.SET_LOWER_CASE=9]="SET_LOWER_CASE",r[r.SET_TITLE_CASE=10]="SET_TITLE_CASE",r[r.INCREASE_LETTER_SPACING=11]="INCREASE_LETTER_SPACING",r[r.DECREASE_LETTER_SPACING=12]="DECREASE_LETTER_SPACING",r[r.INCREASE_LINE_HEIGHT=13]="INCREASE_LINE_HEIGHT",r[r.DECREASE_LINE_HEIGHT=14]="DECREASE_LINE_HEIGHT"})(HT||(HT={}));var zT;(function(r){r[r.SET_BOLD=0]="SET_BOLD",r[r.SET_UNBOLD=1]="SET_UNBOLD",r[r.INCREASE_BOLD=2]="INCREASE_BOLD",r[r.DECREASE_BOLD=3]="DECREASE_BOLD",r[r.SET_ITALIC=4]="SET_ITALIC",r[r.SET_UNITALIC=5]="SET_UNITALIC",r[r.SET_UNDERLINE=6]="SET_UNDERLINE",r[r.SET_STRIKETHROUGH=7]="SET_STRIKETHROUGH",r[r.REMOVE_DECORATION=8]="REMOVE_DECORATION",r[r.SET_ORIGINAL_CASE=9]="SET_ORIGINAL_CASE",r[r.SET_UPPER_CASE=10]="SET_UPPER_CASE",r[r.SET_LOWER_CASE=11]="SET_LOWER_CASE",r[r.SET_TITLE_CASE=12]="SET_TITLE_CASE",r[r.INCREASE_LETTER_SPACING=13]="INCREASE_LETTER_SPACING",r[r.DECREASE_LETTER_SPACING=14]="DECREASE_LETTER_SPACING",r[r.INCREASE_LINE_HEIGHT=15]="INCREASE_LINE_HEIGHT",r[r.DECREASE_LINE_HEIGHT=16]="DECREASE_LINE_HEIGHT"})(zT||(zT={}));var WT;(function(r){r[r.NONE=0]="NONE",r[r.CREATED=1]="CREATED",r[r.EDITED=2]="EDITED",r[r.REMOVED=3]="REMOVED",r[r.INDIRECTLY_EDITED=4]="INDIRECTLY_EDITED",r[r.AFFECTED=5]="AFFECTED",r[r.LIBRARY_UPDATES=6]="LIBRARY_UPDATES"})(WT||(WT={}));var KT;(function(r){r[r.ALL_SCOPES=0]="ALL_SCOPES",r[r.TEXT_CONTENT=1]="TEXT_CONTENT",r[r.CORNER_RADIUS=2]="CORNER_RADIUS",r[r.WIDTH_HEIGHT=3]="WIDTH_HEIGHT",r[r.GAP=4]="GAP",r[r.ALL_FILLS=5]="ALL_FILLS",r[r.FRAME_FILL=6]="FRAME_FILL",r[r.SHAPE_FILL=7]="SHAPE_FILL",r[r.TEXT_FILL=8]="TEXT_FILL",r[r.STROKE=9]="STROKE",r[r.STROKE_FLOAT=10]="STROKE_FLOAT",r[r.EFFECT_FLOAT=11]="EFFECT_FLOAT",r[r.EFFECT_COLOR=12]="EFFECT_COLOR",r[r.OPACITY=13]="OPACITY",r[r.FONT_STYLE=14]="FONT_STYLE",r[r.FONT_FAMILY=15]="FONT_FAMILY",r[r.FONT_SIZE=16]="FONT_SIZE",r[r.LINE_HEIGHT=17]="LINE_HEIGHT",r[r.LETTER_SPACING=18]="LETTER_SPACING",r[r.PARAGRAPH_SPACING=19]="PARAGRAPH_SPACING",r[r.PARAGRAPH_INDENT=20]="PARAGRAPH_INDENT",r[r.FONT_VARIATIONS=21]="FONT_VARIATIONS"})(KT||(KT={}));var YT;(function(r){r[r.WEB=0]="WEB",r[r.ANDROID=1]="ANDROID",r[r.iOS=2]="iOS"})(YT||(YT={}));var QT;(function(r){r[r.DESIGN_LAYOUT=0]="DESIGN_LAYOUT",r[r.WHITEBOARD_LAYOUT=1]="WHITEBOARD_LAYOUT",r[r.VECTOR=2]="VECTOR",r[r.TEXT=3]="TEXT",r[r.RASTER=4]="RASTER",r[r.GRADIENT=5]="GRADIENT",r[r.PLACE_IMAGE=6]="PLACE_IMAGE",r[r.HISTORY=7]="HISTORY",r[r.PREVIEW=8]="PREVIEW",r[r.COMMENTS=9]="COMMENTS",r[r.BRANCHING=10]="BRANCHING",r[r.DEV_HANDOFF=11]="DEV_HANDOFF",r[r.COMPARE_CHANGES=12]="COMPARE_CHANGES",r[r.LIBRARY=13]="LIBRARY",r[r.DEV_HANDOFF_HISTORY=14]="DEV_HANDOFF_HISTORY",r[r.SLIDE_LAYOUT=15]="SLIDE_LAYOUT",r[r.MAGIC_LINK=16]="MAGIC_LINK",r[r.COOPER_CONSTRAINED=17]="COOPER_CONSTRAINED",r[r.PROGRESSIVE_BLUR=18]="PROGRESSIVE_BLUR",r[r.COOPER_BULK_CREATE=19]="COOPER_BULK_CREATE"})(QT||(QT={}));var XT;(function(r){r[r.FORWARD=0]="FORWARD",r[r.REVERSE=1]="REVERSE"})(XT||(XT={}));var qT;(function(r){r[r.STRETCH=0]="STRETCH",r[r.SCATTER=1]="SCATTER"})(qT||(qT={}));var ZT;(function(r){r[r.USER_MESSAGE=0]="USER_MESSAGE",r[r.ASSISTANT_MESSAGE=1]="ASSISTANT_MESSAGE"})(ZT||(ZT={}));var JT;(function(r){r[r.HEADING1=0]="HEADING1",r[r.HEADING2=1]="HEADING2",r[r.HEADING3=2]="HEADING3",r[r.HEADING4=3]="HEADING4",r[r.HEADING5=4]="HEADING5",r[r.HEADING6=5]="HEADING6",r[r.PARAGRAPH=6]="PARAGRAPH",r[r.LINK=7]="LINK",r[r.BLOCKQUOTE=8]="BLOCKQUOTE"})(JT||(JT={}));var jT;(function(r){r[r.NONE=0]="NONE",r[r.NEW_DESIGN=1]="NEW_DESIGN",r[r.NEW_WHITEBOARD=2]="NEW_WHITEBOARD",r[r.NEW_SITE=3]="NEW_SITE",r[r.NEW_SLIDES=4]="NEW_SLIDES",r[r.NEW_FROM_SKETCH=5]="NEW_FROM_SKETCH",r[r.PLACE=6]="PLACE",r[r.QUIT=7]="QUIT",r[r.BACK_TO_FILES=8]="BACK_TO_FILES",r[r.OPEN_FONT_SETTINGS=9]="OPEN_FONT_SETTINGS",r[r.SAVE=10]="SAVE",r[r.SAVE_AS=11]="SAVE_AS",r[r.CREATE_SAVEPOINT=12]="CREATE_SAVEPOINT",r[r.TOGGLE_VERSION_HISTORY=13]="TOGGLE_VERSION_HISTORY",r[r.EXPORT_SELECTED_EXPORTABLES=14]="EXPORT_SELECTED_EXPORTABLES",r[r.EXPORT_SELECTED_EXPORTABLES_DIRECT=15]="EXPORT_SELECTED_EXPORTABLES_DIRECT",r[r.EXPORT_NODE_DIRECT_COOPER=16]="EXPORT_NODE_DIRECT_COOPER",r[r.EXPORT_ASSETS_HANDOFF=17]="EXPORT_ASSETS_HANDOFF",r[r.EXPORT_ALL_EXPORTABLES=18]="EXPORT_ALL_EXPORTABLES",r[r.EXPORT_SELECTION_OR_CURRENT_PAGE=19]="EXPORT_SELECTION_OR_CURRENT_PAGE",r[r.EXPORT_SELECTED_VIDEO=20]="EXPORT_SELECTED_VIDEO",r[r.IMPORT_FROM_CSV=21]="IMPORT_FROM_CSV",r[r.IMPORT=22]="IMPORT",r[r.PAGE_NEW=23]="PAGE_NEW",r[r.PAGE_PREVIOUS=24]="PAGE_PREVIOUS",r[r.PAGE_NEXT=25]="PAGE_NEXT",r[r.PAGE_DELETE=26]="PAGE_DELETE",r[r.PAGE_DUPLICATE=27]="PAGE_DUPLICATE",r[r.PAGE_MOVE_TO=28]="PAGE_MOVE_TO",r[r.PAGE_RENAME=29]="PAGE_RENAME",r[r.TRACK_PAGE_RENAME=30]="TRACK_PAGE_RENAME",r[r.BATCH_PAGE_RENAME=31]="BATCH_PAGE_RENAME",r[r.PAGE_MOVE_TO_MENU=32]="PAGE_MOVE_TO_MENU",r[r.PAGE_MOVE_TO_NEW_FILE=33]="PAGE_MOVE_TO_NEW_FILE",r[r.PAGE_COPY_LINK=34]="PAGE_COPY_LINK",r[r.COPY_LINK=35]="COPY_LINK",r[r.UNDO=36]="UNDO",r[r.REDO=37]="REDO",r[r.CUT=38]="CUT",r[r.COPY=39]="COPY",r[r.COPY_AS_MENU=40]="COPY_AS_MENU",r[r.COPY_PASTE_MENU=41]="COPY_PASTE_MENU",r[r.COPY_AS_CODE=42]="COPY_AS_CODE",r[r.COPY_AS_CSS=43]="COPY_AS_CSS",r[r.COPY_AS_CSS_RECURSIVE=44]="COPY_AS_CSS_RECURSIVE",r[r.COPY_AS_ANDROID=45]="COPY_AS_ANDROID",r[r.COPY_AS_IOS=46]="COPY_AS_IOS",r[r.COPY_AS_SVG=47]="COPY_AS_SVG",r[r.COPY_AS_PNG=48]="COPY_AS_PNG",r[r.PANELS_MENU=49]="PANELS_MENU",r[r.MASTER_COMPONENT_MENU=50]="MASTER_COMPONENT_MENU",r[r.COPY_PROPERTIES=51]="COPY_PROPERTIES",r[r.COPY_TEXT=52]="COPY_TEXT",r[r.COPY_LAYER_NAME=53]="COPY_LAYER_NAME",r[r.PASTE=54]="PASTE",r[r.PASTE_HERE=55]="PASTE_HERE",r[r.PASTE_PROPERTIES=56]="PASTE_PROPERTIES",r[r.PASTE_OVER_SELECTION=57]="PASTE_OVER_SELECTION",r[r.PASTE_TO_REPLACE=58]="PASTE_TO_REPLACE",r[r.PASTE_WIDGETS_AS_SUBLAYERS=59]="PASTE_WIDGETS_AS_SUBLAYERS",r[r.SELECT_CHILD=60]="SELECT_CHILD",r[r.SELECT_PARENT=61]="SELECT_PARENT",r[r.SELECT_NEXT_SIBLING=62]="SELECT_NEXT_SIBLING",r[r.SELECT_PREVIOUS_SIBLING=63]="SELECT_PREVIOUS_SIBLING",r[r.SELECT_NEXT_NODE=64]="SELECT_NEXT_NODE",r[r.SELECT_PREVIOUS_NODE=65]="SELECT_PREVIOUS_NODE",r[r.SELECT_ALL=66]="SELECT_ALL",r[r.SELECT_ALL_WIDGETS=67]="SELECT_ALL_WIDGETS",r[r.SELECT_ALL_SLIDES=68]="SELECT_ALL_SLIDES",r[r.SELECT_INVERSE=69]="SELECT_INVERSE",r[r.MOVE_TEXT_SELECTION_END=70]="MOVE_TEXT_SELECTION_END",r[r.MOVE_TEXT_SELECTION_START=71]="MOVE_TEXT_SELECTION_START",r[r.EXTEND_TEXT_SELECTION_END=72]="EXTEND_TEXT_SELECTION_END",r[r.EXTEND_TEXT_SELECTION_START=73]="EXTEND_TEXT_SELECTION_START",r[r.MOVE_TEXT_SELECTION_FORWARD=74]="MOVE_TEXT_SELECTION_FORWARD",r[r.MOVE_TEXT_SELECTION_BACKWARD=75]="MOVE_TEXT_SELECTION_BACKWARD",r[r.EXTEND_TEXT_SELECTION_FORWARD=76]="EXTEND_TEXT_SELECTION_FORWARD",r[r.EXTEND_TEXT_SELECTION_BACKWARD=77]="EXTEND_TEXT_SELECTION_BACKWARD",r[r.SELECT_MATCHING=78]="SELECT_MATCHING",r[r.SELECT_SIMILAR=79]="SELECT_SIMILAR",r[r.SELECT_NODE=80]="SELECT_NODE",r[r.SELECT_NODE_MENU=81]="SELECT_NODE_MENU",r[r.SET_DEFAULT_STYLE=82]="SET_DEFAULT_STYLE",r[r.FIND_SYMBOL=83]="FIND_SYMBOL",r[r.FIND_COMPONENT_IN_FILE=84]="FIND_COMPONENT_IN_FILE",r[r.CREATE_SYMBOL=85]="CREATE_SYMBOL",r[r.CREATE_MULTIPLE_SYMBOLS=86]="CREATE_MULTIPLE_SYMBOLS",r[r.CREATE_MULTIPLE_SYMBOLS_AND_STATE_GROUP=87]="CREATE_MULTIPLE_SYMBOLS_AND_STATE_GROUP",r[r.PUBLISH_SELECTION=88]="PUBLISH_SELECTION",r[r.PUBLISH_CHANGES_TO_LIBRARY=89]="PUBLISH_CHANGES_TO_LIBRARY",r[r.PUBLISH_TEMPLATE=90]="PUBLISH_TEMPLATE",r[r.PUSH_CHANGES_TO_MAIN=91]="PUSH_CHANGES_TO_MAIN",r[r.RESET_SYMBOL=92]="RESET_SYMBOL",r[r.RESET_SIZE=93]="RESET_SIZE",r[r.RESET_EXPORTS=94]="RESET_EXPORTS",r[r.RESET_EFFECTS=95]="RESET_EFFECTS",r[r.RESET_LAYER=96]="RESET_LAYER",r[r.RESET_VISIBLE=97]="RESET_VISIBLE",r[r.RESET_NAME=98]="RESET_NAME",r[r.RESET_FILL=99]="RESET_FILL",r[r.RESET_STROKE=100]="RESET_STROKE",r[r.RESET_TEXT=101]="RESET_TEXT",r[r.RESET_TEXT_STYLE=102]="RESET_TEXT_STYLE",r[r.RESET_PROTOTYPE_INTERACTIONS=103]="RESET_PROTOTYPE_INTERACTIONS",r[r.RESET_OVERLAY=104]="RESET_OVERLAY",r[r.RESTORE_SYMBOL_OR_STATE_GROUP=105]="RESTORE_SYMBOL_OR_STATE_GROUP",r[r.SWAP_TO_RELATED_SYMBOL=106]="SWAP_TO_RELATED_SYMBOL",r[r.ADD_VARIANT=107]="ADD_VARIANT",r[r.CREATE_STATE_GROUP=108]="CREATE_STATE_GROUP",r[r.CREATE_STATE=109]="CREATE_STATE",r[r.SWAP_TO_RELATED_STATE=110]="SWAP_TO_RELATED_STATE",r[r.CREATE_RESPONSIVE_SET=111]="CREATE_RESPONSIVE_SET",r[r.CREATE_TEMPLATE=112]="CREATE_TEMPLATE",r[r.CREATE_MODULE=113]="CREATE_MODULE",r[r.SWAP_NODES=114]="SWAP_NODES",r[r.DETACH_INSTANCE=115]="DETACH_INSTANCE",r[r.REMOVE_DETACHED_SYMBOL_ID=116]="REMOVE_DETACHED_SYMBOL_ID",r[r.UPDATE_INSTANCE_LAYOUT_VERSION=117]="UPDATE_INSTANCE_LAYOUT_VERSION",r[r.REGENERATE_ALL_INSTANCES=118]="REGENERATE_ALL_INSTANCES",r[r.REGENERATE_MISSING_THUMBNAILS=119]="REGENERATE_MISSING_THUMBNAILS",r[r.BACKUP_ALL_OVERRIDES=120]="BACKUP_ALL_OVERRIDES",r[r.DETACH_ALL_INSTANCES=121]="DETACH_ALL_INSTANCES",r[r.TOGGLE_VARIABLES=122]="TOGGLE_VARIABLES",r[r.REMOVE_ORPHANED_VARIABLES=123]="REMOVE_ORPHANED_VARIABLES",r[r.REPAIR_SELECTED_INSTANCES=124]="REPAIR_SELECTED_INSTANCES",r[r.DETACH_DELETED_VARIABLES=125]="DETACH_DELETED_VARIABLES",r[r.REPAIR_STATE_GROUP_VERSIONS=126]="REPAIR_STATE_GROUP_VERSIONS",r[r.REPAIR_VARIABLE_CONNECTIONS=127]="REPAIR_VARIABLE_CONNECTIONS",r[r.REPAIR_VARIABLE_MODE_VALUES=128]="REPAIR_VARIABLE_MODE_VALUES",r[r.RESTORE_SOFT_DELETED_VARIABLE_SETS=129]="RESTORE_SOFT_DELETED_VARIABLE_SETS",r[r.RERESOLVE_VARIABLE_REFERENCES=130]="RERESOLVE_VARIABLE_REFERENCES",r[r.RESTORE_AUTOLAYOUT_POSITION=131]="RESTORE_AUTOLAYOUT_POSITION",r[r.RESET_TRANSFORM=132]="RESET_TRANSFORM",r[r.RESET_VARIABLE_MODES=133]="RESET_VARIABLE_MODES",r[r.FIND_SHARED_INSTANCES_NEED_RELINKING=134]="FIND_SHARED_INSTANCES_NEED_RELINKING",r[r.RELINK_INSTANCES_TO_LOCAL_COMPONENT=135]="RELINK_INSTANCES_TO_LOCAL_COMPONENT",r[r.CALC_DELETED_COMPONENT_PUBLISHED_VERSION=136]="CALC_DELETED_COMPONENT_PUBLISHED_VERSION",r[r.REPUBLISH_SELECTED_COMPONENTS=137]="REPUBLISH_SELECTED_COMPONENTS",r[r.REPUBLISH_AUTO_LAYOUT_COMPONENTS=138]="REPUBLISH_AUTO_LAYOUT_COMPONENTS",r[r.SELECT_BROKEN_FIXED_SCROLLING_NODES=139]="SELECT_BROKEN_FIXED_SCROLLING_NODES",r[r.CLEAR_SELECTION_COMPONENT_PROPS=140]="CLEAR_SELECTION_COMPONENT_PROPS",r[r.REGENERATE_COMPONENT_PROPS=141]="REGENERATE_COMPONENT_PROPS",r[r.PRUNE_INVALID_COMPONENT_PROP_REFS=142]="PRUNE_INVALID_COMPONENT_PROP_REFS",r[r.PRUNE_DERIVED_DATA=143]="PRUNE_DERIVED_DATA",r[r.REPAIR_MISSING_OVERRIDE_KEYS=144]="REPAIR_MISSING_OVERRIDE_KEYS",r[r.REPAIR_CORRUPT_OVERRIDE_KEYS_FOR_SELECTION=145]="REPAIR_CORRUPT_OVERRIDE_KEYS_FOR_SELECTION",r[r.RESTORE_SOFT_DELETED_SELECTION=146]="RESTORE_SOFT_DELETED_SELECTION",r[r.REPAIR_DUPLICATE_SUBSCRIBED_ASSETS=147]="REPAIR_DUPLICATE_SUBSCRIBED_ASSETS",r[r.REFLOW_IMMUTABLE_FRAMES=148]="REFLOW_IMMUTABLE_FRAMES",r[r.DISABLE_ALL_UNFRAMED_MASKS=149]="DISABLE_ALL_UNFRAMED_MASKS",r[r.RESIZE_TO_FIT=150]="RESIZE_TO_FIT",r[r.TOGGLE_FRAME_ORIENTATION=151]="TOGGLE_FRAME_ORIENTATION",r[r.START_CHAT=152]="START_CHAT",r[r.TOGGLE_FRAME_CLIPPING=153]="TOGGLE_FRAME_CLIPPING",r[r.HIDE_SIBLING_LAYERS=154]="HIDE_SIBLING_LAYERS",r[r.COLLAPSE_LAYERS=155]="COLLAPSE_LAYERS",r[r.DUPLICATE=156]="DUPLICATE",r[r.DUPLICATE_IN_PLACE=157]="DUPLICATE_IN_PLACE",r[r.QUICK_CREATE=158]="QUICK_CREATE",r[r.QUICK_CREATE_DIAGRAM_SIBLING=159]="QUICK_CREATE_DIAGRAM_SIBLING",r[r.FLIP_HORIZONTAL=160]="FLIP_HORIZONTAL",r[r.FLIP_VERTICAL=161]="FLIP_VERTICAL",r[r.ROTATE_180=162]="ROTATE_180",r[r.ROTATE_90_COUNTERCLOCKWISE=163]="ROTATE_90_COUNTERCLOCKWISE",r[r.ROTATE_90_CLOCKWISE=164]="ROTATE_90_CLOCKWISE",r[r.BRING_TO_FRONT=165]="BRING_TO_FRONT",r[r.BRING_FORWARD=166]="BRING_FORWARD",r[r.SEND_BACKWARD=167]="SEND_BACKWARD",r[r.SEND_TO_BACK=168]="SEND_TO_BACK",r[r.CONVERT_TO_RASTER=169]="CONVERT_TO_RASTER",r[r.FLATTEN_SELECTION=170]="FLATTEN_SELECTION",r[r.REMOVE_ANNOTATIONS=171]="REMOVE_ANNOTATIONS",r[r.REMOVE_FILL=172]="REMOVE_FILL",r[r.REMOVE_GUIDE=173]="REMOVE_GUIDE",r[r.REMOVE_HORIZONTAL_GUIDES=174]="REMOVE_HORIZONTAL_GUIDES",r[r.REMOVE_VERTICAL_GUIDES=175]="REMOVE_VERTICAL_GUIDES",r[r.REMOVE_STROKE=176]="REMOVE_STROKE",r[r.SWAP_FILL_AND_STROKE=177]="SWAP_FILL_AND_STROKE",r[r.SELECT_SAME_FILL=178]="SELECT_SAME_FILL",r[r.SELECT_SAME_STROKE=179]="SELECT_SAME_STROKE",r[r.SELECT_SAME_EFFECT=180]="SELECT_SAME_EFFECT",r[r.SELECT_SAME_TEXT=181]="SELECT_SAME_TEXT",r[r.SELECT_SAME_FONT=182]="SELECT_SAME_FONT",r[r.SELECT_SAME_STYLE=183]="SELECT_SAME_STYLE",r[r.SELECT_SAME_INSTANCE=184]="SELECT_SAME_INSTANCE",r[r.SELECT_SAME_VARIANT=185]="SELECT_SAME_VARIANT",r[r.SELECT_ALL_TEXT=186]="SELECT_ALL_TEXT",r[r.REPLACE_SELECTED_TEXT=187]="REPLACE_SELECTED_TEXT",r[r.LOCK_ASPECT_RATIO=188]="LOCK_ASPECT_RATIO",r[r.UNLOCK_ASPECT_RATIO=189]="UNLOCK_ASPECT_RATIO",r[r.FRAME_SELECTION=190]="FRAME_SELECTION",r[r.GROUP_SELECTION=191]="GROUP_SELECTION",r[r.UNGROUP_SELECTION=192]="UNGROUP_SELECTION",r[r.CREATE_TEXT_NODE=193]="CREATE_TEXT_NODE",r[r.CREATE_TRIANGLE=194]="CREATE_TRIANGLE",r[r.CREATE_ELLIPSE=195]="CREATE_ELLIPSE",r[r.CREATE_ROUNDED_RECTANGLE=196]="CREATE_ROUNDED_RECTANGLE",r[r.CREATE_DIAMOND=197]="CREATE_DIAMOND",r[r.CREATE_COMMENT=198]="CREATE_COMMENT",r[r.CREATE_STICKY=199]="CREATE_STICKY",r[r.CREATE_SECTION=200]="CREATE_SECTION",r[r.CREATE_SLIDE=201]="CREATE_SLIDE",r[r.MASK_SELECTION=202]="MASK_SELECTION",r[r.RENAME_SELECTION=203]="RENAME_SELECTION",r[r.CREATE_SECTION_FROM_SELECTION=204]="CREATE_SECTION_FROM_SELECTION",r[r.CREATE_BREAKPOINT=205]="CREATE_BREAKPOINT",r[r.REMOVE_BREAKPOINT=206]="REMOVE_BREAKPOINT",r[r.SET_AS_PRIMARY_BREAKPOINT=207]="SET_AS_PRIMARY_BREAKPOINT",r[r.REPLACE_SELECTED_FRAME_WITH_SECTION=208]="REPLACE_SELECTED_FRAME_WITH_SECTION",r[r.REPLACE_SELECTED_SECTION_WITH_FRAME=209]="REPLACE_SELECTED_SECTION_WITH_FRAME",r[r.ADD_SELECTION_READY_STATUS=210]="ADD_SELECTION_READY_STATUS",r[r.MARK_INCOMPLETE=211]="MARK_INCOMPLETE",r[r.SET_SELECTION_COMPLETED_STATUS=212]="SET_SELECTION_COMPLETED_STATUS",r[r.REMOVE_SELECTION_STATUS=213]="REMOVE_SELECTION_STATUS",r[r.CONVERT_TABLE_TO_STICKY_GRID=214]="CONVERT_TABLE_TO_STICKY_GRID",r[r.FIND_INSPIRATION=215]="FIND_INSPIRATION",r[r.INSPECT_FRAGMENT=216]="INSPECT_FRAGMENT",r[r.CREATE_BRUSH_MENU=217]="CREATE_BRUSH_MENU",r[r.CREATE_STRETCH_BRUSH=218]="CREATE_STRETCH_BRUSH",r[r.CREATE_SCATTER_BRUSH=219]="CREATE_SCATTER_BRUSH",r[r.MIGRATE_EFFECT_REPEATS_TO_TRANSFORMS=220]="MIGRATE_EFFECT_REPEATS_TO_TRANSFORMS",r[r.STACK_SELECTION=221]="STACK_SELECTION",r[r.UNSTACK_SELECTION=222]="UNSTACK_SELECTION",r[r.GRID_SELECTION=223]="GRID_SELECTION",r[r.REMOVE_GRID=224]="REMOVE_GRID",r[r.SET_SELECTION_FILL_HORIZONTAL=225]="SET_SELECTION_FILL_HORIZONTAL",r[r.SET_SELECTION_HUG_HORIZONTAL=226]="SET_SELECTION_HUG_HORIZONTAL",r[r.SET_SELECTION_FILL_VERTICAL=227]="SET_SELECTION_FILL_VERTICAL",r[r.SET_SELECTION_HUG_VERTICAL=228]="SET_SELECTION_HUG_VERTICAL",r[r.APPLY_TRANSFORM_MODIFIERS=229]="APPLY_TRANSFORM_MODIFIERS",r[r.OUTLINE_STROKE=230]="OUTLINE_STROKE",r[r.LIVE_BOOLEAN_UNION=231]="LIVE_BOOLEAN_UNION",r[r.LIVE_BOOLEAN_SUBTRACT=232]="LIVE_BOOLEAN_SUBTRACT",r[r.LIVE_BOOLEAN_INTERSECT=233]="LIVE_BOOLEAN_INTERSECT",r[r.LIVE_BOOLEAN_XOR=234]="LIVE_BOOLEAN_XOR",r[r.ADD_TRANSFORM_MODIFIER_TO_SELECTION=235]="ADD_TRANSFORM_MODIFIER_TO_SELECTION",r[r.ALIGN_TOP=236]="ALIGN_TOP",r[r.ALIGN_VERTICAL_CENTER=237]="ALIGN_VERTICAL_CENTER",r[r.ALIGN_BOTTOM=238]="ALIGN_BOTTOM",r[r.ALIGN_LEFT=239]="ALIGN_LEFT",r[r.ALIGN_HORIZONTAL_CENTER=240]="ALIGN_HORIZONTAL_CENTER",r[r.ALIGN_RIGHT=241]="ALIGN_RIGHT",r[r.ALIGN_TOP_AS_GROUP=242]="ALIGN_TOP_AS_GROUP",r[r.ALIGN_VERTICAL_CENTER_AS_GROUP=243]="ALIGN_VERTICAL_CENTER_AS_GROUP",r[r.ALIGN_BOTTOM_AS_GROUP=244]="ALIGN_BOTTOM_AS_GROUP",r[r.ALIGN_LEFT_AS_GROUP=245]="ALIGN_LEFT_AS_GROUP",r[r.ALIGN_HORIZONTAL_CENTER_AS_GROUP=246]="ALIGN_HORIZONTAL_CENTER_AS_GROUP",r[r.ALIGN_RIGHT_AS_GROUP=247]="ALIGN_RIGHT_AS_GROUP",r[r.ROUND_TO_PIXELS=248]="ROUND_TO_PIXELS",r[r.ARRANGE_AS_GRID=249]="ARRANGE_AS_GRID",r[r.ARRANGE_AS_LIST=250]="ARRANGE_AS_LIST",r[r.TIDY_UP=251]="TIDY_UP",r[r.PACK_HORIZONTAL=252]="PACK_HORIZONTAL",r[r.PACK_VERTICAL=253]="PACK_VERTICAL",r[r.DISTRIBUTE_HORIZONTAL_SPACING=254]="DISTRIBUTE_HORIZONTAL_SPACING",r[r.DISTRIBUTE_VERTICAL_SPACING=255]="DISTRIBUTE_VERTICAL_SPACING",r[r.DISTRIBUTE_TOP=256]="DISTRIBUTE_TOP",r[r.DISTRIBUTE_VERTICAL_CENTER=257]="DISTRIBUTE_VERTICAL_CENTER",r[r.DISTRIBUTE_BOTTOM=258]="DISTRIBUTE_BOTTOM",r[r.DISTRIBUTE_LEFT=259]="DISTRIBUTE_LEFT",r[r.DISTRIBUTE_HORIZONTAL_CENTER=260]="DISTRIBUTE_HORIZONTAL_CENTER",r[r.DISTRIBUTE_RIGHT=261]="DISTRIBUTE_RIGHT",r[r.TOGGLE_BOLD=262]="TOGGLE_BOLD",r[r.TEXT_TOGGLE_ITALIC=263]="TEXT_TOGGLE_ITALIC",r[r.TEXT_BOLD_INCREASE=264]="TEXT_BOLD_INCREASE",r[r.TEXT_BOLD_DECREASE=265]="TEXT_BOLD_DECREASE",r[r.TEXT_TOGGLE_UNDERLINE=266]="TEXT_TOGGLE_UNDERLINE",r[r.TEXT_TOGGLE_STRIKETHROUGH=267]="TEXT_TOGGLE_STRIKETHROUGH",r[r.TEXT_REMOVE_DECORATION=268]="TEXT_REMOVE_DECORATION",r[r.TEXT_DELETE_SELECTION_OR_END=269]="TEXT_DELETE_SELECTION_OR_END",r[r.TEXT_DELETE_SELECTION_OR_NEXT_CHARACTER=270]="TEXT_DELETE_SELECTION_OR_NEXT_CHARACTER",r[r.TEXT_UPGRADE_TEXT_EXPLICIT_LAYOUT_VERSION=271]="TEXT_UPGRADE_TEXT_EXPLICIT_LAYOUT_VERSION",r[r.TEXT_UPGRADE_TO_BIDI=272]="TEXT_UPGRADE_TO_BIDI",r[r.TEXT_TOGGLE_ORDERED_LIST=273]="TEXT_TOGGLE_ORDERED_LIST",r[r.TEXT_TOGGLE_UNORDERED_LIST=274]="TEXT_TOGGLE_UNORDERED_LIST",r[r.TEXT_CLEAR_LIST_FORMATTING=275]="TEXT_CLEAR_LIST_FORMATTING",r[r.TEXT_INDENT_LIST=276]="TEXT_INDENT_LIST",r[r.TEXT_DEDENT_LIST=277]="TEXT_DEDENT_LIST",r[r.TEXT_DIRECTIONALITY_MENU=278]="TEXT_DIRECTIONALITY_MENU",r[r.SET_DIRECTIONALITY_LTR=279]="SET_DIRECTIONALITY_LTR",r[r.SET_DIRECTIONALITY_LTR_QA=280]="SET_DIRECTIONALITY_LTR_QA",r[r.SET_DIRECTIONALITY_RTL=281]="SET_DIRECTIONALITY_RTL",r[r.SET_DIRECTIONALITY_RTL_QA=282]="SET_DIRECTIONALITY_RTL_QA",r[r.TEXT_EDIT_HYPERLINK=283]="TEXT_EDIT_HYPERLINK",r[r.TEXT_CASE_MENU=284]="TEXT_CASE_MENU",r[r.TEXT_SET_ORIGINAL_CASE=285]="TEXT_SET_ORIGINAL_CASE",r[r.TEXT_SET_UPPER_CASE=286]="TEXT_SET_UPPER_CASE",r[r.TEXT_SET_LOWER_CASE=287]="TEXT_SET_LOWER_CASE",r[r.TEXT_SET_TITLE_CASE=288]="TEXT_SET_TITLE_CASE",r[r.TEXT_SET_SMALL_CAPS=289]="TEXT_SET_SMALL_CAPS",r[r.TEXT_SET_FORCED_SMALL_CAPS=290]="TEXT_SET_FORCED_SMALL_CAPS",r[r.TEXT_RELAYOUT=291]="TEXT_RELAYOUT",r[r.TEXT_ALIGN_MENU=292]="TEXT_ALIGN_MENU",r[r.TEXT_ALIGN_LEFT=293]="TEXT_ALIGN_LEFT",r[r.TEXT_ALIGN_CENTER=294]="TEXT_ALIGN_CENTER",r[r.TEXT_ALIGN_RIGHT=295]="TEXT_ALIGN_RIGHT",r[r.TEXT_ALIGN_JUSTIFIED=296]="TEXT_ALIGN_JUSTIFIED",r[r.TEXT_ALIGN_TOP=297]="TEXT_ALIGN_TOP",r[r.TEXT_ALIGN_MIDDLE=298]="TEXT_ALIGN_MIDDLE",r[r.TEXT_ALIGN_BOTTOM=299]="TEXT_ALIGN_BOTTOM",r[r.TEXT_STYLE_TITLE=300]="TEXT_STYLE_TITLE",r[r.TEXT_STYLE_H1=301]="TEXT_STYLE_H1",r[r.TEXT_STYLE_H2=302]="TEXT_STYLE_H2",r[r.TEXT_STYLE_H3=303]="TEXT_STYLE_H3",r[r.TEXT_STYLE_NORMAL=304]="TEXT_STYLE_NORMAL",r[r.TEXT_ADJUST_MENU=305]="TEXT_ADJUST_MENU",r[r.TEXT_LINE_HEIGHT_DECREASE=306]="TEXT_LINE_HEIGHT_DECREASE",r[r.TEXT_LINE_HEIGHT_INCREASE=307]="TEXT_LINE_HEIGHT_INCREASE",r[r.TEXT_FONT_SIZE_DECREASE=308]="TEXT_FONT_SIZE_DECREASE",r[r.TEXT_FONT_SIZE_INCREASE=309]="TEXT_FONT_SIZE_INCREASE",r[r.TEXT_LETTER_SPACING_DECREASE=310]="TEXT_LETTER_SPACING_DECREASE",r[r.TEXT_LETTER_SPACING_INCREASE=311]="TEXT_LETTER_SPACING_INCREASE",r[r.GOTO_LAYER=312]="GOTO_LAYER",r[r.COMMIT=313]="COMMIT",r[r.AFTER_UNDO_REDO_COMMIT=314]="AFTER_UNDO_REDO_COMMIT",r[r.PURGE_ALL_MEMORY=315]="PURGE_ALL_MEMORY",r[r.REDRAW_CANVAS=316]="REDRAW_CANVAS",r[r.AFTER_FIRST_RENDER=317]="AFTER_FIRST_RENDER",r[r.REQUEST_EDIT_MODE=318]="REQUEST_EDIT_MODE",r[r.REQUEST_EDIT_MODE_VIA_TOOLBAR=319]="REQUEST_EDIT_MODE_VIA_TOOLBAR",r[r.LEAVE_EDIT_MODE=320]="LEAVE_EDIT_MODE",r[r.TOGGLE_EDIT_MODE=321]="TOGGLE_EDIT_MODE",r[r.TOGGLE_GRADIENT_EDIT_MODE=322]="TOGGLE_GRADIENT_EDIT_MODE",r[r.TOGGLE_PROGRESSIVE_BLUR_EDIT_MODE=323]="TOGGLE_PROGRESSIVE_BLUR_EDIT_MODE",r[r.TOGGLE_RASTER_EDIT_MODE=324]="TOGGLE_RASTER_EDIT_MODE",r[r.CROP_IMAGE=325]="CROP_IMAGE",r[r.ADD_IMAGE_OVERLAY=326]="ADD_IMAGE_OVERLAY",r[r.REMOVE_IMAGE_OVERLAY=327]="REMOVE_IMAGE_OVERLAY",r[r.ROTATE_IMAGE_90_CLOCKWISE=328]="ROTATE_IMAGE_90_CLOCKWISE",r[r.ENTER_LAYOUT_MODE=329]="ENTER_LAYOUT_MODE",r[r.ENTER_PREVIEW_MODE=330]="ENTER_PREVIEW_MODE",r[r.ENTER_HISTORY_MODE=331]="ENTER_HISTORY_MODE",r[r.ENTER_HISTORY_MODE_FOR_RECORDING=332]="ENTER_HISTORY_MODE_FOR_RECORDING",r[r.ENTER_BRANCHING_MODE=333]="ENTER_BRANCHING_MODE",r[r.ENTER_LIBRARY_MODE=334]="ENTER_LIBRARY_MODE",r[r.DEV_HANDOFF_FOCUS_PREVIOUS=335]="DEV_HANDOFF_FOCUS_PREVIOUS",r[r.DEV_HANDOFF_FOCUS_NEXT=336]="DEV_HANDOFF_FOCUS_NEXT",r[r.TOGGLE_UI=337]="TOGGLE_UI",r[r.TOGGLE_KEYBOARD_SHORTCUTS=338]="TOGGLE_KEYBOARD_SHORTCUTS",r[r.TOGGLE_HELP_WIDGET=339]="TOGGLE_HELP_WIDGET",r[r.TOGGLE_LAYERS=340]="TOGGLE_LAYERS",r[r.TOGGLE_PUBLISH=341]="TOGGLE_PUBLISH",r[r.TOGGLE_LIBRARY=342]="TOGGLE_LIBRARY",r[r.TOGGLE_COMPONENT_INSERT_MODAL=343]="TOGGLE_COMPONENT_INSERT_MODAL",r[r.TOGGLE_SIDEBAR=344]="TOGGLE_SIDEBAR",r[r.TOGGLE_SNAPPING_TO_PIXELS=345]="TOGGLE_SNAPPING_TO_PIXELS",r[r.TOGGLE_SNAPPING_TO_OBJECTS=346]="TOGGLE_SNAPPING_TO_OBJECTS",r[r.TOGGLE_SNAPPING_TO_GEOMETRY=347]="TOGGLE_SNAPPING_TO_GEOMETRY",r[r.TOGGLE_SMART_QUOTES=348]="TOGGLE_SMART_QUOTES",r[r.TOGGLE_FLIP_DURING_RESIZE=349]="TOGGLE_FLIP_DURING_RESIZE",r[r.DISABLE_PINCH_ZOOM_FIX=350]="DISABLE_PINCH_ZOOM_FIX",r[r.TOGGLE_LAYER_HOVER=351]="TOGGLE_LAYER_HOVER",r[r.TOGGLE_STICKY_TOOLS=352]="TOGGLE_STICKY_TOOLS",r[r.TOGGLE_COPY_RENAMING=353]="TOGGLE_COPY_RENAMING",r[r.TOGGLE_VIEWPORT_OVERLAY_HIDING=354]="TOGGLE_VIEWPORT_OVERLAY_HIDING",r[r.TOGGLE_KEYBOARD_ZOOM_TO_SELECTION=355]="TOGGLE_KEYBOARD_ZOOM_TO_SELECTION",r[r.TOGGLE_MULTIPLAYER_CURSORS=356]="TOGGLE_MULTIPLAYER_CURSORS",r[r.TOGGLE_SHOW_PROPERTY_LABELS=357]="TOGGLE_SHOW_PROPERTY_LABELS",r[r.ZOOM_IN=358]="ZOOM_IN",r[r.ZOOM_OUT=359]="ZOOM_OUT",r[r.ZOOM_RESET=360]="ZOOM_RESET",r[r.ZOOM_TO_FIT=361]="ZOOM_TO_FIT",r[r.ZOOM_TO_SELECTION=362]="ZOOM_TO_SELECTION",r[r.SHOW_SELECTED_NODES=363]="SHOW_SELECTED_NODES",r[r.HIDE_SELECTED_NODES=364]="HIDE_SELECTED_NODES",r[r.TOGGLE_SHOWN_FOR_SELECTED_NODES=365]="TOGGLE_SHOWN_FOR_SELECTED_NODES",r[r.UNHIDE_ALL=366]="UNHIDE_ALL",r[r.LOCK_SELECTED_NODES=367]="LOCK_SELECTED_NODES",r[r.LOCK_SELECTED_SECTION_ONLY=368]="LOCK_SELECTED_SECTION_ONLY",r[r.UNLOCK_SELECTED_NODES=369]="UNLOCK_SELECTED_NODES",r[r.TOGGLE_LOCKED_FOR_SELECTED_NODES=370]="TOGGLE_LOCKED_FOR_SELECTED_NODES",r[r.UNLOCK_ALL=371]="UNLOCK_ALL",r[r.DELETE_AND_HEAL_SELECTION=372]="DELETE_AND_HEAL_SELECTION",r[r.JOIN_SELECTION=373]="JOIN_SELECTION",r[r.SMOOTH_JOIN_SELECTION=374]="SMOOTH_JOIN_SELECTION",r[r.DESELECT_ALL=375]="DESELECT_ALL",r[r.DELETE_SELECTION=376]="DELETE_SELECTION",r[r.TOGGLE_MENU=377]="TOGGLE_MENU",r[r.INSERT_INTERACTIVE_ELEMENT_INTO_ACTIVE_SLIDE=378]="INSERT_INTERACTIVE_ELEMENT_INTO_ACTIVE_SLIDE",r[r.TOGGLE_PREFERENCES=379]="TOGGLE_PREFERENCES",r[r.ENTER=380]="ENTER",r[r.ESCAPE=381]="ESCAPE",r[r.MULTI_EDIT_TEXT=382]="MULTI_EDIT_TEXT",r[r.FOCUS_MODE=383]="FOCUS_MODE",r[r.FOCUS_MODE_COMPONENT_SET_TOGGLE=384]="FOCUS_MODE_COMPONENT_SET_TOGGLE",r[r.FOCUS_MODE_RESPONSIVE_SET_TOGGLE=385]="FOCUS_MODE_RESPONSIVE_SET_TOGGLE",r[r.FOCUS_MODE_EXIT=386]="FOCUS_MODE_EXIT",r[r.CANVAS_SEARCH=387]="CANVAS_SEARCH",r[r.CANVAS_SEARCH_EXIT=388]="CANVAS_SEARCH_EXIT",r[r.CANVAS_SEARCH_NEXT=389]="CANVAS_SEARCH_NEXT",r[r.CANVAS_SEARCH_PREV=390]="CANVAS_SEARCH_PREV",r[r.CANVAS_SEARCH_REPLACE=391]="CANVAS_SEARCH_REPLACE",r[r.TOGGLE_RETINA_MODE=392]="TOGGLE_RETINA_MODE",r[r.TOGGLE_PIXEL_PREVIEW=393]="TOGGLE_PIXEL_PREVIEW",r[r.TOGGLE_GOOGLE_FONTS=394]="TOGGLE_GOOGLE_FONTS",r[r.TOGGLE_SHOW_SLICES=395]="TOGGLE_SHOW_SLICES",r[r.TOGGLE_SHOW_COMMENTS=396]="TOGGLE_SHOW_COMMENTS",r[r.TOGGLE_SHOW_ANNOTATIONS=397]="TOGGLE_SHOW_ANNOTATIONS",r[r.TOGGLE_SHOW_COMPONENT_ANNOTATIONS=398]="TOGGLE_SHOW_COMPONENT_ANNOTATIONS",r[r.TOGGLE_SHOW_DETACHED_COMPONENT_ANNOTATIONS=399]="TOGGLE_SHOW_DETACHED_COMPONENT_ANNOTATIONS",r[r.TOGGLE_ALWAYS_EXPAND_ANNOTATIONS=400]="TOGGLE_ALWAYS_EXPAND_ANNOTATIONS",r[r.TOGGLE_SHOW_MEASUREMENTS=401]="TOGGLE_SHOW_MEASUREMENTS",r[r.TOGGLE_DROPPER=402]="TOGGLE_DROPPER",r[r.TOGGLE_INVERT_ZOOM=403]="TOGGLE_INVERT_ZOOM",r[r.TOGGLE_CURSOR_HIGH_FIVE_WIGGLE=404]="TOGGLE_CURSOR_HIGH_FIVE_WIGGLE",r[r.TOGGLE_USE_NUMBERS_FOR_OPACITY=405]="TOGGLE_USE_NUMBERS_FOR_OPACITY",r[r.TOGGLE_USE_OLD_OUTLINE_SHORTCUTS=406]="TOGGLE_USE_OLD_OUTLINE_SHORTCUTS",r[r.TOGGLE_CTRL_CLICK_CONTEXT_MENU=407]="TOGGLE_CTRL_CLICK_CONTEXT_MENU",r[r.SHOW_NUDGE_AMOUNT_PICKER=408]="SHOW_NUDGE_AMOUNT_PICKER",r[r.SET_OPACITY_0=409]="SET_OPACITY_0",r[r.SET_OPACITY_1=410]="SET_OPACITY_1",r[r.SET_OPACITY_2=411]="SET_OPACITY_2",r[r.SET_OPACITY_3=412]="SET_OPACITY_3",r[r.SET_OPACITY_4=413]="SET_OPACITY_4",r[r.SET_OPACITY_5=414]="SET_OPACITY_5",r[r.SET_OPACITY_6=415]="SET_OPACITY_6",r[r.SET_OPACITY_7=416]="SET_OPACITY_7",r[r.SET_OPACITY_8=417]="SET_OPACITY_8",r[r.SET_OPACITY_9=418]="SET_OPACITY_9",r[r.KEYBOARD_LAYOUT_US_QWERTY=419]="KEYBOARD_LAYOUT_US_QWERTY",r[r.KEYBOARD_LAYOUT_FRENCH_AZERTY=420]="KEYBOARD_LAYOUT_FRENCH_AZERTY",r[r.KEYBOARD_LAYOUT_GERMAN=421]="KEYBOARD_LAYOUT_GERMAN",r[r.KEYBOARD_LAYOUT_JAPANESE_KANA=422]="KEYBOARD_LAYOUT_JAPANESE_KANA",r[r.KEYBOARD_LAYOUT_DVORAK=423]="KEYBOARD_LAYOUT_DVORAK",r[r.KEYBOARD_LAYOUT_RESET=424]="KEYBOARD_LAYOUT_RESET",r[r.KEYBOARD_LAYOUT_UK_MAC=425]="KEYBOARD_LAYOUT_UK_MAC",r[r.KEYBOARD_LAYOUT_UK_PC=426]="KEYBOARD_LAYOUT_UK_PC",r[r.KEYBOARD_LAYOUT_SWEDISH=427]="KEYBOARD_LAYOUT_SWEDISH",r[r.KEYBOARD_LAYOUT_FINNISH=428]="KEYBOARD_LAYOUT_FINNISH",r[r.KEYBOARD_LAYOUT_DANISH=429]="KEYBOARD_LAYOUT_DANISH",r[r.KEYBOARD_LAYOUT_NORWEGIAN=430]="KEYBOARD_LAYOUT_NORWEGIAN",r[r.KEYBOARD_LAYOUT_ITALIAN=431]="KEYBOARD_LAYOUT_ITALIAN",r[r.KEYBOARD_LAYOUT_SPANISH=432]="KEYBOARD_LAYOUT_SPANISH",r[r.KEYBOARD_LAYOUT_SPANISH_LATAM=433]="KEYBOARD_LAYOUT_SPANISH_LATAM",r[r.KEYBOARD_LAYOUT_CHINESE=434]="KEYBOARD_LAYOUT_CHINESE",r[r.KEYBOARD_LAYOUT_PORTUGUESE=435]="KEYBOARD_LAYOUT_PORTUGUESE",r[r.KEYBOARD_LAYOUT_KOREAN=436]="KEYBOARD_LAYOUT_KOREAN",r[r.TOGGLE_LEADING_TRIM=437]="TOGGLE_LEADING_TRIM",r[r.TOGGLE_HANGING_PUNCTUATION=438]="TOGGLE_HANGING_PUNCTUATION",r[r.TOGGLE_HANGING_LIST=439]="TOGGLE_HANGING_LIST",r[r.TOGGLE_SPELL_CHECK=440]="TOGGLE_SPELL_CHECK",r[r.REDO_SPELL_CHECKING=441]="REDO_SPELL_CHECKING",r[r.SET_DEFAULT_EMOJI_SKIN_TONE=442]="SET_DEFAULT_EMOJI_SKIN_TONE",r[r.SET_TOOL_FRAME=443]="SET_TOOL_FRAME",r[r.SET_TOOL_SLICE=444]="SET_TOOL_SLICE",r[r.SET_TOOL_SCALE=445]="SET_TOOL_SCALE",r[r.SET_TOOL_TYPE=446]="SET_TOOL_TYPE",r[r.SET_TOOL_LINE=447]="SET_TOOL_LINE",r[r.SET_TOOL_ARROW=448]="SET_TOOL_ARROW",r[r.SET_TOOL_PEN=449]="SET_TOOL_PEN",r[r.SET_TOOL_PENCIL=450]="SET_TOOL_PENCIL",r[r.SET_TOOL_BEND=451]="SET_TOOL_BEND",r[r.SET_TOOL_CUT=452]="SET_TOOL_CUT",r[r.SET_TOOL_PAINT_BUCKET=453]="SET_TOOL_PAINT_BUCKET",r[r.SET_TOOL_VAR_WIDTH_POINT=454]="SET_TOOL_VAR_WIDTH_POINT",r[r.SET_TOOL_STAR=455]="SET_TOOL_STAR",r[r.SET_TOOL_ELLIPSE=456]="SET_TOOL_ELLIPSE",r[r.SET_TOOL_RECTANGLE=457]="SET_TOOL_RECTANGLE",r[r.SET_TOOL_REGULAR_POLYGON=458]="SET_TOOL_REGULAR_POLYGON",r[r.SET_TOOL_DEFAULT=459]="SET_TOOL_DEFAULT",r[r.SET_TOOL_DEFAULT_FIGJAM=460]="SET_TOOL_DEFAULT_FIGJAM",r[r.SET_TOOL_DEFAULT_DEV_HANDOFF=461]="SET_TOOL_DEFAULT_DEV_HANDOFF",r[r.SET_TOOL_HAND=462]="SET_TOOL_HAND",r[r.SET_TOOL_OLD_SELECT=463]="SET_TOOL_OLD_SELECT",r[r.SET_TOOL_MULTISELECT=464]="SET_TOOL_MULTISELECT",r[r.SET_TOOL_LASSO=465]="SET_TOOL_LASSO",r[r.SET_TOOL_COMMENTS=466]="SET_TOOL_COMMENTS",r[r.SPOTLIGHT_ME=467]="SPOTLIGHT_ME",r[r.FOLLOW_PRESENTER=468]="FOLLOW_PRESENTER",r[r.SET_TOOL_CONNECTOR_ELBOWED=469]="SET_TOOL_CONNECTOR_ELBOWED",r[r.SET_TOOL_CONNECTOR_STRAIGHT=470]="SET_TOOL_CONNECTOR_STRAIGHT",r[r.SET_TOOL_CONNECTOR_CURVED=471]="SET_TOOL_CONNECTOR_CURVED",r[r.SET_TOOL_CONNECTOR_STRAIGHT_NO_ENDPOINTS=472]="SET_TOOL_CONNECTOR_STRAIGHT_NO_ENDPOINTS",r[r.SET_TOOL_STICKY=473]="SET_TOOL_STICKY",r[r.SET_TOOL_STAMP=474]="SET_TOOL_STAMP",r[r.SET_TOOL_SHAPE_WHITEBOARD_SQUARE=475]="SET_TOOL_SHAPE_WHITEBOARD_SQUARE",r[r.SET_TOOL_SHAPE_WHITEBOARD_ELLIPSE=476]="SET_TOOL_SHAPE_WHITEBOARD_ELLIPSE",r[r.SET_TOOL_SHAPE_WHITEBOARD_DIAMOND=477]="SET_TOOL_SHAPE_WHITEBOARD_DIAMOND",r[r.SET_TOOL_SHAPE_WHITEBOARD_TRIANGLE_UP=478]="SET_TOOL_SHAPE_WHITEBOARD_TRIANGLE_UP",r[r.SET_TOOL_SHAPE_WHITEBOARD_TRIANGLE_DOWN=479]="SET_TOOL_SHAPE_WHITEBOARD_TRIANGLE_DOWN",r[r.SET_TOOL_SHAPE_WHITEBOARD_ROUNDED_RECTANGLE=480]="SET_TOOL_SHAPE_WHITEBOARD_ROUNDED_RECTANGLE",r[r.SET_TOOL_SHAPE_WHITEBOARD_PARALLELOGRAM_RIGHT=481]="SET_TOOL_SHAPE_WHITEBOARD_PARALLELOGRAM_RIGHT",r[r.SET_TOOL_SHAPE_WHITEBOARD_PARALLELOGRAM_LEFT=482]="SET_TOOL_SHAPE_WHITEBOARD_PARALLELOGRAM_LEFT",r[r.SET_TOOL_SHAPE_WHITEBOARD_ENG_DATABASE=483]="SET_TOOL_SHAPE_WHITEBOARD_ENG_DATABASE",r[r.SET_TOOL_SHAPE_WHITEBOARD_ENG_QUEUE=484]="SET_TOOL_SHAPE_WHITEBOARD_ENG_QUEUE",r[r.SET_TOOL_SHAPE_WHITEBOARD_ENG_FILE=485]="SET_TOOL_SHAPE_WHITEBOARD_ENG_FILE",r[r.SET_TOOL_SHAPE_WHITEBOARD_ENG_FOLDER=486]="SET_TOOL_SHAPE_WHITEBOARD_ENG_FOLDER",r[r.SET_TOOL_SHAPE_WHITEBOARD_TRAPEZOID=487]="SET_TOOL_SHAPE_WHITEBOARD_TRAPEZOID",r[r.SET_TOOL_SHAPE_WHITEBOARD_STAR=488]="SET_TOOL_SHAPE_WHITEBOARD_STAR",r[r.SET_TOOL_SHAPE_WHITEBOARD_SHIELD=489]="SET_TOOL_SHAPE_WHITEBOARD_SHIELD",r[r.SET_TOOL_SHAPE_WHITEBOARD_HEXAGON=490]="SET_TOOL_SHAPE_WHITEBOARD_HEXAGON",r[r.SET_TOOL_SHAPE_WHITEBOARD_PENTAGON=491]="SET_TOOL_SHAPE_WHITEBOARD_PENTAGON",r[r.SET_TOOL_SHAPE_WHITEBOARD_OCTAGON=492]="SET_TOOL_SHAPE_WHITEBOARD_OCTAGON",r[r.SET_TOOL_SHAPE_WHITEBOARD_PLUS=493]="SET_TOOL_SHAPE_WHITEBOARD_PLUS",r[r.SET_TOOL_SHAPE_WHITEBOARD_PREDEFINED_PROCESS=494]="SET_TOOL_SHAPE_WHITEBOARD_PREDEFINED_PROCESS",r[r.SET_TOOL_SHAPE_WHITEBOARD_DOCUMENT_SINGLE=495]="SET_TOOL_SHAPE_WHITEBOARD_DOCUMENT_SINGLE",r[r.SET_TOOL_SHAPE_WHITEBOARD_DOCUMENT_MULTIPLE=496]="SET_TOOL_SHAPE_WHITEBOARD_DOCUMENT_MULTIPLE",r[r.SET_TOOL_SHAPE_WHITEBOARD_MANUAL_INPUT=497]="SET_TOOL_SHAPE_WHITEBOARD_MANUAL_INPUT",r[r.SET_TOOL_SHAPE_WHITEBOARD_CHEVRON=498]="SET_TOOL_SHAPE_WHITEBOARD_CHEVRON",r[r.SET_TOOL_SHAPE_WHITEBOARD_ARROW_LEFT=499]="SET_TOOL_SHAPE_WHITEBOARD_ARROW_LEFT",r[r.SET_TOOL_SHAPE_WHITEBOARD_ARROW_RIGHT=500]="SET_TOOL_SHAPE_WHITEBOARD_ARROW_RIGHT",r[r.SET_TOOL_SHAPE_WHITEBOARD_SUMMING_JUNCTION=501]="SET_TOOL_SHAPE_WHITEBOARD_SUMMING_JUNCTION",r[r.SET_TOOL_SHAPE_WHITEBOARD_OR=502]="SET_TOOL_SHAPE_WHITEBOARD_OR",r[r.SET_TOOL_SHAPE_WHITEBOARD_SPEECH_BUBBLE=503]="SET_TOOL_SHAPE_WHITEBOARD_SPEECH_BUBBLE",r[r.SET_TOOL_SHAPE_WHITEBOARD_INTERNAL_STORAGE=504]="SET_TOOL_SHAPE_WHITEBOARD_INTERNAL_STORAGE",r[r.SET_TOOL_MINDMAP_TREE_NUCLEUS=505]="SET_TOOL_MINDMAP_TREE_NUCLEUS",r[r.SET_TOOL_SHAPE_WHITEBOARD_PLATFORM=506]="SET_TOOL_SHAPE_WHITEBOARD_PLATFORM",r[r.SET_TOOL_ERASER=507]="SET_TOOL_ERASER",r[r.SET_TOOL_HIGHLIGHTER=508]="SET_TOOL_HIGHLIGHTER",r[r.SET_TOOL_SECTION=509]="SET_TOOL_SECTION",r[r.SET_TOOL_WASHI_TAPE=510]="SET_TOOL_WASHI_TAPE",r[r.SET_TOOL_TABLE=511]="SET_TOOL_TABLE",r[r.SET_TOOL_ANNOTATE=512]="SET_TOOL_ANNOTATE",r[r.START_MAGIC_LINK=513]="START_MAGIC_LINK",r[r.END_MAGIC_LINK=514]="END_MAGIC_LINK",r[r.OPEN_MAKE_PROTOTYPE_MODAL=515]="OPEN_MAKE_PROTOTYPE_MODAL",r[r.SET_TOOL_MEASURE=516]="SET_TOOL_MEASURE",r[r.TOGGLE_CUSTOM_CURSOR=517]="TOGGLE_CUSTOM_CURSOR",r[r.SET_TOOL_SLIDES_POLL=518]="SET_TOOL_SLIDES_POLL",r[r.SET_TOOL_SLIDES_EMBED=519]="SET_TOOL_SLIDES_EMBED",r[r.SET_TOOL_SLIDES_FACEPILE=520]="SET_TOOL_SLIDES_FACEPILE",r[r.SET_TOOL_SLIDES_ALIGNMENT_SCALE=521]="SET_TOOL_SLIDES_ALIGNMENT_SCALE",r[r.SET_TOOL_SLIDES_YOUTUBE=522]="SET_TOOL_SLIDES_YOUTUBE",r[r.SET_TOOL_SLIDE_NUMBER=523]="SET_TOOL_SLIDE_NUMBER",r[r.SET_TOOL_SITES_RESPONSIVE_SET=524]="SET_TOOL_SITES_RESPONSIVE_SET",r[r.SET_TOOL_SITES_LINK=525]="SET_TOOL_SITES_LINK",r[r.SET_TOOL_SITES_EMBED=526]="SET_TOOL_SITES_EMBED",r[r.SET_TOOL_CODE_COMPONENT=527]="SET_TOOL_CODE_COMPONENT",r[r.SET_TOOL_PATTERN_SOURCE_SELECTOR=528]="SET_TOOL_PATTERN_SOURCE_SELECTOR",r[r.TOGGLE_SECTION_VISIBILITY=529]="TOGGLE_SECTION_VISIBILITY",r[r.OPEN_TIMER=530]="OPEN_TIMER",r[r.SET_TOOL_CODE_BLOCK=531]="SET_TOOL_CODE_BLOCK",r[r.ADD_CONNECTOR_TEXT=532]="ADD_CONNECTOR_TEXT",r[r.TOGGLE_ICON_DETECTION=533]="TOGGLE_ICON_DETECTION",r[r.TOGGLE_SHOW_GUIDS=534]="TOGGLE_SHOW_GUIDS",r[r.TEST_INDEPENDENT_LAYER_ANIMATION=535]="TEST_INDEPENDENT_LAYER_ANIMATION",r[r.TEST_INDEPENDENT_LAYER_ANIMATION_EASED=536]="TEST_INDEPENDENT_LAYER_ANIMATION_EASED",r[r.TEST_INDEPENDENT_LAYER_ANIMATION_OPACITY=537]="TEST_INDEPENDENT_LAYER_ANIMATION_OPACITY",r[r.TEST_NON_INDEPENDENT_LAYER_ANIMATION=538]="TEST_NON_INDEPENDENT_LAYER_ANIMATION",r[r.PRINT_VECTOR_NETWORK_AS_TEST_CODE=539]="PRINT_VECTOR_NETWORK_AS_TEST_CODE",r[r.FORCE_PUBLISH_STATE_GROUP=540]="FORCE_PUBLISH_STATE_GROUP",r[r.INSPECT_IN_FIGMASCOPE=541]="INSPECT_IN_FIGMASCOPE",r[r.CONVERT_TO_THUMBNAIL_FRAME=542]="CONVERT_TO_THUMBNAIL_FRAME",r[r.TOGGLE_SHOW_QUICK_COMMAND_RANK_DEBUG=543]="TOGGLE_SHOW_QUICK_COMMAND_RANK_DEBUG",r[r.TOGGLE_SHOW_IMMUTABLE_FRAME_SUBLAYERS=544]="TOGGLE_SHOW_IMMUTABLE_FRAME_SUBLAYERS",r[r.TOGGLE_RESOURCE_USE=545]="TOGGLE_RESOURCE_USE",r[r.TOGGLE_MEMORY_USAGE_INDICATOR=546]="TOGGLE_MEMORY_USAGE_INDICATOR",r[r.TOGGLE_RULERS=547]="TOGGLE_RULERS",r[r.TOGGLE_STACK_DEBUG_MODE=548]="TOGGLE_STACK_DEBUG_MODE",r[r.TOGGLE_STACK_SHADOWS=549]="TOGGLE_STACK_SHADOWS",r[r.TOGGLE_DYNAMIC_INSERTION_POINTS=550]="TOGGLE_DYNAMIC_INSERTION_POINTS",r[r.TOGGLE_AUTO_FILL_FULL_WIDTH_CHILDREN=551]="TOGGLE_AUTO_FILL_FULL_WIDTH_CHILDREN",r[r.RUN_MULTI_STACK_AUTO_LAYOUT=552]="RUN_MULTI_STACK_AUTO_LAYOUT",r[r.RUN_SET_RESPONSIVE_SETTINGS=553]="RUN_SET_RESPONSIVE_SETTINGS",r[r.DESTROY_ALL_AUTO_LAYOUT=554]="DESTROY_ALL_AUTO_LAYOUT",r[r.TOGGLE_ANNOTATIONS=555]="TOGGLE_ANNOTATIONS",r[r.TOGGLE_GRID=556]="TOGGLE_GRID",r[r.TOGGLE_PERF_HUD=557]="TOGGLE_PERF_HUD",r[r.TOGGLE_FAKE_MP_ACTIVITY=558]="TOGGLE_FAKE_MP_ACTIVITY",r[r.TOGGLE_TSMER_CONFIG=559]="TOGGLE_TSMER_CONFIG",r[r.TOGGLE_DEBUG_DOC_SYNC_LOGS=560]="TOGGLE_DEBUG_DOC_SYNC_LOGS",r[r.TOGGLE_DEBUG_USER_SYNC_LOGS=561]="TOGGLE_DEBUG_USER_SYNC_LOGS",r[r.TOGGLE_DEBUG_PAGE_SYNC_LOGS=562]="TOGGLE_DEBUG_PAGE_SYNC_LOGS",r[r.DEBUG_INCREMENTAL_LOADING_ALL_PAGES=563]="DEBUG_INCREMENTAL_LOADING_ALL_PAGES",r[r.DEBUG_INCREMENTAL_LOADING_CURRENT_ONLY=564]="DEBUG_INCREMENTAL_LOADING_CURRENT_ONLY",r[r.TOGGLE_DEBUG_LAYOUT_LOGS=565]="TOGGLE_DEBUG_LAYOUT_LOGS",r[r.TOGGLE_DEBUG_MATERIALIZER_LOGS=566]="TOGGLE_DEBUG_MATERIALIZER_LOGS",r[r.TOGGLE_OUTLINES=567]="TOGGLE_OUTLINES",r[r.TOGGLE_OUTLINE_HIDDEN_LAYERS=568]="TOGGLE_OUTLINE_HIDDEN_LAYERS",r[r.TOGGLE_OUTLINE_OBJECT_BOUNDS=569]="TOGGLE_OUTLINE_OBJECT_BOUNDS",r[r.TOGGLE_SHOWN_LAYOUT_GRIDS=570]="TOGGLE_SHOWN_LAYOUT_GRIDS",r[r.TOGGLE_SHOW_MASKS=571]="TOGGLE_SHOW_MASKS",r[r.TOGGLE_SHOW_ARTBOARD_OUTLINES=572]="TOGGLE_SHOW_ARTBOARD_OUTLINES",r[r.TOGGLE_USE_REALMS_FOR_PLUGIN_DEV=573]="TOGGLE_USE_REALMS_FOR_PLUGIN_DEV",r[r.CLEAR_TOOL=574]="CLEAR_TOOL",r[r.PLACE_ALL_IMAGES=575]="PLACE_ALL_IMAGES",r[r.DISCARD_ALL_IMAGES=576]="DISCARD_ALL_IMAGES",r[r.TOGGLE_PEN_TOOL_AVOID_SINGLE_HANDLES=577]="TOGGLE_PEN_TOOL_AVOID_SINGLE_HANDLES",r[r.TOGGLE_SNAPPING_TO_DOTS=578]="TOGGLE_SNAPPING_TO_DOTS",r[r.TOGGLE_SHOW_DOT_GRID=579]="TOGGLE_SHOW_DOT_GRID",r[r.TOGGLE_SCROLL_WHEEL_ZOOM=580]="TOGGLE_SCROLL_WHEEL_ZOOM",r[r.TOGGLE_RIGHT_CLICK_PAN=581]="TOGGLE_RIGHT_CLICK_PAN",r[r.SET_SCROLL_WHEEL_ZOOM_ENABLED=582]="SET_SCROLL_WHEEL_ZOOM_ENABLED",r[r.SET_SCROLL_WHEEL_ZOOM_DISABLED=583]="SET_SCROLL_WHEEL_ZOOM_DISABLED",r[r.SET_RIGHT_CLICK_PAN_ENABLED=584]="SET_RIGHT_CLICK_PAN_ENABLED",r[r.SET_RIGHT_CLICK_PAN_DISABLED=585]="SET_RIGHT_CLICK_PAN_DISABLED",r[r.REMOVE_INTERACTIONS_ON_SELECTION=586]="REMOVE_INTERACTIONS_ON_SELECTION",r[r.REMOVE_INTERACTIONS_ON_PAGE=587]="REMOVE_INTERACTIONS_ON_PAGE",r[r.ADD_PROTOTYPE_STARTING_POINT=588]="ADD_PROTOTYPE_STARTING_POINT",r[r.DELETE_PROTOTYPE_STARTING_POINT=589]="DELETE_PROTOTYPE_STARTING_POINT",r[r.UPDATE_INTERACTIONS_STATE_MANAGEMENT_ON_PAGE=590]="UPDATE_INTERACTIONS_STATE_MANAGEMENT_ON_PAGE",r[r.TOGGLE_INLINE_PREVIEW=591]="TOGGLE_INLINE_PREVIEW",r[r.TOGGLE_INLINE_HTML_PREVIEW=592]="TOGGLE_INLINE_HTML_PREVIEW",r[r.INLINE_PREVIEW_RESET_SIZE=593]="INLINE_PREVIEW_RESET_SIZE",r[r.INLINE_PREVIEW_LOADED=594]="INLINE_PREVIEW_LOADED",r[r.INLINE_PREVIEW_PRESENTED_NODE_CHANGED=595]="INLINE_PREVIEW_PRESENTED_NODE_CHANGED",r[r.INLINE_PREVIEW_IFRAME_FOCUS_STATE_CHANGED=596]="INLINE_PREVIEW_IFRAME_FOCUS_STATE_CHANGED",r[r.OPEN_HELP=597]="OPEN_HELP",r[r.OPEN_SHORTCUTS=598]="OPEN_SHORTCUTS",r[r.OPEN_SUPPORT_FORUM=599]="OPEN_SUPPORT_FORUM",r[r.OPEN_TUTORIALS=600]="OPEN_TUTORIALS",r[r.OPEN_LEGAL_SUMMARY=601]="OPEN_LEGAL_SUMMARY",r[r.OPEN_RELEASE_NOTES=602]="OPEN_RELEASE_NOTES",r[r.OPEN_ACCOUNT_SETTINGS=603]="OPEN_ACCOUNT_SETTINGS",r[r.OPEN_PREFERENCES_MODAL=604]="OPEN_PREFERENCES_MODAL",r[r.SIMULATE_BACK_TO_FILES=605]="SIMULATE_BACK_TO_FILES",r[r.DUMP_PENDING_REGISTERS=606]="DUMP_PENDING_REGISTERS",r[r.DUMP_UNDO_HISTORY=607]="DUMP_UNDO_HISTORY",r[r.TOGGLE_RECORDING_INTERACTIONS=608]="TOGGLE_RECORDING_INTERACTIONS",r[r.INSERT_LOTS_OF_TEXT=609]="INSERT_LOTS_OF_TEXT",r[r.ADD_FILL_TO_SELECTION=610]="ADD_FILL_TO_SELECTION",r[r.ADD_STROKE_TO_SELECTION=611]="ADD_STROKE_TO_SELECTION",r[r.ADD_FILL_TO_STYLE_SELECTION=612]="ADD_FILL_TO_STYLE_SELECTION",r[r.NEXT_ARTBOARD=613]="NEXT_ARTBOARD",r[r.PREVIOUS_ARTBOARD=614]="PREVIOUS_ARTBOARD",r[r.NEXT_ARTBOARD_SAME_ZOOM=615]="NEXT_ARTBOARD_SAME_ZOOM",r[r.PREVIOUS_ARTBOARD_SAME_ZOOM=616]="PREVIOUS_ARTBOARD_SAME_ZOOM",r[r.TEST_MULTIPLAYER_UPGRADE=617]="TEST_MULTIPLAYER_UPGRADE",r[r.TEST_REJECT_TOO_OLD=618]="TEST_REJECT_TOO_OLD",r[r.TEST_REJECT_INVALID_PERMISSIONS=619]="TEST_REJECT_INVALID_PERMISSIONS",r[r.TEST_REJECT_NOT_LOGGED_IN=620]="TEST_REJECT_NOT_LOGGED_IN",r[r.TEST_REJECT_TOO_MANY_CONNECTIONS=621]="TEST_REJECT_TOO_MANY_CONNECTIONS",r[r.PLUGINS_RUN_LAST=622]="PLUGINS_RUN_LAST",r[r.VIEW_WIDGET_DETAILS=623]="VIEW_WIDGET_DETAILS",r[r.OPEN_BROWSE_ALL_RESOURCES_MODAL=624]="OPEN_BROWSE_ALL_RESOURCES_MODAL",r[r.ENTER_INSPECT_MODE=625]="ENTER_INSPECT_MODE",r[r.ENTER_DESIGN_MODE=626]="ENTER_DESIGN_MODE",r[r.ENTER_SLIDES_MODE=627]="ENTER_SLIDES_MODE",r[r.ENTER_SLIDES_DESIGN_MODE=628]="ENTER_SLIDES_DESIGN_MODE",r[r.SHOW_DESIGN_PANEL=629]="SHOW_DESIGN_PANEL",r[r.SHOW_PROTOTYPE_PANEL=630]="SHOW_PROTOTYPE_PANEL",r[r.TOGGLE_PROTOTYPING_INFO=631]="TOGGLE_PROTOTYPING_INFO",r[r.TOGGLE_ANIMATE_INFO=632]="TOGGLE_ANIMATE_INFO",r[r.ENTER_SINGLE_SLIDE_VIEW=633]="ENTER_SINGLE_SLIDE_VIEW",r[r.TOGGLE_SLIDE_VIEW=634]="TOGGLE_SLIDE_VIEW",r[r.SHOW_CODE_PANEL=635]="SHOW_CODE_PANEL",r[r.DEBUG_SELECTION=636]="DEBUG_SELECTION",r[r.DOWNLOAD_WEBGL_TRACE=637]="DOWNLOAD_WEBGL_TRACE",r[r.EXPORT_ALL_FRAMES_TO_PDF=638]="EXPORT_ALL_FRAMES_TO_PDF",r[r.EXPORT_SLIDES_TO_PDF=639]="EXPORT_SLIDES_TO_PDF",r[r.EXPORT_ALL_COOPER_TEMPLATES_TO_PDF=640]="EXPORT_ALL_COOPER_TEMPLATES_TO_PDF",r[r.PRINT_IMAGE_DIAGNOSTICS=641]="PRINT_IMAGE_DIAGNOSTICS",r[r.PRINT_RENDER_TREE=642]="PRINT_RENDER_TREE",r[r.ADD_TABLE_ROW_ABOVE=643]="ADD_TABLE_ROW_ABOVE",r[r.ADD_TABLE_ROW_BELOW=644]="ADD_TABLE_ROW_BELOW",r[r.MOVE_TABLE_ROW_UP=645]="MOVE_TABLE_ROW_UP",r[r.MOVE_TABLE_ROW_DOWN=646]="MOVE_TABLE_ROW_DOWN",r[r.ADD_TABLE_COLUMN_BEFORE=647]="ADD_TABLE_COLUMN_BEFORE",r[r.ADD_TABLE_COLUMN_AFTER=648]="ADD_TABLE_COLUMN_AFTER",r[r.MOVE_TABLE_COLUMN_LEFT=649]="MOVE_TABLE_COLUMN_LEFT",r[r.MOVE_TABLE_COLUMN_RIGHT=650]="MOVE_TABLE_COLUMN_RIGHT",r[r.DELETE_TABLE_CONTENTS=651]="DELETE_TABLE_CONTENTS",r[r.DELETE_CURRENT_TABLE_COLUMN=652]="DELETE_CURRENT_TABLE_COLUMN",r[r.DELETE_CURRENT_TABLE_ROW=653]="DELETE_CURRENT_TABLE_ROW",r[r.ADD_DEFAULT_CELL_STYLES_TO_TABLES=654]="ADD_DEFAULT_CELL_STYLES_TO_TABLES",r[r.TEST_ACTION=655]="TEST_ACTION",r[r.DEBUG_TOGGLE_WHITEBOARD_MODE=656]="DEBUG_TOGGLE_WHITEBOARD_MODE",r[r.DEBUG_TOGGLE_SLIDES_MODE=657]="DEBUG_TOGGLE_SLIDES_MODE",r[r.DEBUG_SET_SLIDES_GRID_MODE=658]="DEBUG_SET_SLIDES_GRID_MODE",r[r.DEBUG_TOGGLE_SITES_MODE=659]="DEBUG_TOGGLE_SITES_MODE",r[r.DEBUG_LOG_CANVAS_SEARCH_INDEX=660]="DEBUG_LOG_CANVAS_SEARCH_INDEX",r[r.SET_IMAGE_AS_PROFILE_PICTURE=661]="SET_IMAGE_AS_PROFILE_PICTURE",r[r.TOGGLE_STRAIGHT_PENCIL=662]="TOGGLE_STRAIGHT_PENCIL",r[r.PRESENT_AS_PROTOTYPE=663]="PRESENT_AS_PROTOTYPE",r[r.PRESENT_SITES_FULL_PREVIEW=664]="PRESENT_SITES_FULL_PREVIEW",r[r.PRESENT_SLIDES_AUDIENCE_VIEW=665]="PRESENT_SLIDES_AUDIENCE_VIEW",r[r.PRESENT_SLIDES_PRESENTER_VIEW=666]="PRESENT_SLIDES_PRESENTER_VIEW",r[r.CREATE_FEED_POST=667]="CREATE_FEED_POST",r[r.DEBUG_TOGGLE_COOPER_MODE=668]="DEBUG_TOGGLE_COOPER_MODE",r[r.TOGGLE_COOPER_TOOL_MODE=669]="TOGGLE_COOPER_TOOL_MODE",r[r.COOPER_CONVERT_TO_TEMPLATE=670]="COOPER_CONVERT_TO_TEMPLATE",r[r.COOPER_MAKE_BRAND_TEMPLATES=671]="COOPER_MAKE_BRAND_TEMPLATES",r[r.ASSIGN_DOCUMENT_COLOR_PROFILE_LEGACY=672]="ASSIGN_DOCUMENT_COLOR_PROFILE_LEGACY",r[r.ASSIGN_DOCUMENT_COLOR_PROFILE_DISPLAY_P3=673]="ASSIGN_DOCUMENT_COLOR_PROFILE_DISPLAY_P3",r[r.CONVERT_DOCUMENT_COLOR_PROFILE_DISPLAY_P3=674]="CONVERT_DOCUMENT_COLOR_PROFILE_DISPLAY_P3",r[r.ASSIGN_DOCUMENT_COLOR_PROFILE_SRGB=675]="ASSIGN_DOCUMENT_COLOR_PROFILE_SRGB",r[r.CONVERT_DOCUMENT_COLOR_PROFILE_SRGB=676]="CONVERT_DOCUMENT_COLOR_PROFILE_SRGB",r[r.CHANGE_DOCUMENT_COLOR_PROFILE_TO_DISPLAY_P3=677]="CHANGE_DOCUMENT_COLOR_PROFILE_TO_DISPLAY_P3",r[r.CHANGE_DOCUMENT_COLOR_PROFILE_TO_SRGB=678]="CHANGE_DOCUMENT_COLOR_PROFILE_TO_SRGB",r[r.TOGGLE_OVERLAY_UI_RENDERING=679]="TOGGLE_OVERLAY_UI_RENDERING",r[r.TOGGLE_ALLOW_TIME_SLICED_EDIT_RENDERING_OPTIMIZATION=680]="TOGGLE_ALLOW_TIME_SLICED_EDIT_RENDERING_OPTIMIZATION",r[r.TOGGLE_SYNC_CURSOR_RENDERING=681]="TOGGLE_SYNC_CURSOR_RENDERING",r[r.SIMPLIFY_SELECTED_INSTANCE_PANELS=682]="SIMPLIFY_SELECTED_INSTANCE_PANELS",r[r.TOGGLE_SIMILAR_DEFINITION=683]="TOGGLE_SIMILAR_DEFINITION",r[r.TOGGLE_SIMILAR_HIGHLIGHTS=684]="TOGGLE_SIMILAR_HIGHLIGHTS",r[r.TOGGLE_NOODLES_WITHOUT_DRAGGING=685]="TOGGLE_NOODLES_WITHOUT_DRAGGING",r[r.DEBUG_MAGIC_LINK_AI_MODEL=686]="DEBUG_MAGIC_LINK_AI_MODEL",r[r.SHOW_PROTOTYPE_INTERACTION_EDIT_MODAL=687]="SHOW_PROTOTYPE_INTERACTION_EDIT_MODAL",r[r.REPORT_NO_VIDEO_UPLOAD_PERMISSIONS=688]="REPORT_NO_VIDEO_UPLOAD_PERMISSIONS",r[r.TOGGLE_DISPLAY_DIRTY_RECTS=689]="TOGGLE_DISPLAY_DIRTY_RECTS",r[r.TOGGLE_DISPLAY_DIRTY_TILES=690]="TOGGLE_DISPLAY_DIRTY_TILES",r[r.TOGGLE_DISPLAY_GPU_METRICS=691]="TOGGLE_DISPLAY_GPU_METRICS",r[r.TOGGLE_DISPLAY_CPU_TIMER_TREE=692]="TOGGLE_DISPLAY_CPU_TIMER_TREE",r[r.TOGGLE_PERF_MODE_MEDIUM=693]="TOGGLE_PERF_MODE_MEDIUM",r[r.SET_PROTOTYPE_VIEW_PRESENT=694]="SET_PROTOTYPE_VIEW_PRESENT",r[r.SET_PROTOTYPE_VIEW_PREVIEW=695]="SET_PROTOTYPE_VIEW_PREVIEW",r[r.SET_SITES_FULL_PREVIEW=696]="SET_SITES_FULL_PREVIEW",r[r.SET_SITES_INLINE_PREVIEW=697]="SET_SITES_INLINE_PREVIEW",r[r.SET_SLIDES_AUDIENCE_VIEW=698]="SET_SLIDES_AUDIENCE_VIEW",r[r.SET_SLIDES_PRESENTER_VIEW=699]="SET_SLIDES_PRESENTER_VIEW",r[r.DEBUG_TOGGLE_DIAGRAM_LAYOUT_PAUSED=700]="DEBUG_TOGGLE_DIAGRAM_LAYOUT_PAUSED",r[r.START_MIND_MAP=701]="START_MIND_MAP",r[r.REMOVE_IMAGE_BACKGROUND=702]="REMOVE_IMAGE_BACKGROUND",r[r.UPSCALE_IMAGE=703]="UPSCALE_IMAGE",r[r.GENERATE_IMAGE=704]="GENERATE_IMAGE",r[r.AUTO_RENAME_LAYERS=705]="AUTO_RENAME_LAYERS",r[r.MAGIC_LINK=706]="MAGIC_LINK",r[r.FIRST_DRAFT=707]="FIRST_DRAFT",r[r.FIRST_DRAFT_MAKE_CHANGES=708]="FIRST_DRAFT_MAKE_CHANGES",r[r.FIRST_DRAFT_MAKE_KIT=709]="FIRST_DRAFT_MAKE_KIT",r[r.FIRST_DRAFT_MAKE_KIT_DEBUG=710]="FIRST_DRAFT_MAKE_KIT_DEBUG",r[r.FIRST_DRAFT_COMPONENTIZE=711]="FIRST_DRAFT_COMPONENTIZE",r[r.FIRST_DRAFT_SUGGEST_PROPS=712]="FIRST_DRAFT_SUGGEST_PROPS",r[r.FIRST_DRAFT_LINTING=713]="FIRST_DRAFT_LINTING",r[r.FIRST_DRAFT_DEBUG=714]="FIRST_DRAFT_DEBUG",r[r.MAKE_EDITS=715]="MAKE_EDITS",r[r.FIRST_DRAFT_FINE_TUNE=716]="FIRST_DRAFT_FINE_TUNE",r[r.LINK_TO_COMPONENT=717]="LINK_TO_COMPONENT",r[r.LINK_TO_EXISTING_COMPONENT=718]="LINK_TO_EXISTING_COMPONENT",r[r.DETECT_VIOLATIONS=719]="DETECT_VIOLATIONS",r[r.TRANSLATE_TEXT=720]="TRANSLATE_TEXT",r[r.REWRITE_TEXT=721]="REWRITE_TEXT",r[r.SHORTEN_TEXT=722]="SHORTEN_TEXT",r[r.CONTENT_FILL=723]="CONTENT_FILL",r[r.SLIDES_GENERATE_SPEAKER_NOTES=724]="SLIDES_GENERATE_SPEAKER_NOTES",r[r.SLIDES_REWRITE_TEXT=725]="SLIDES_REWRITE_TEXT",r[r.DEBUG_TOGGLE_SHOW_CANVAS_AXIS=726]="DEBUG_TOGGLE_SHOW_CANVAS_AXIS",r[r.DEBUG_TOGGLE_SHOW_MOUSE_POSITION=727]="DEBUG_TOGGLE_SHOW_MOUSE_POSITION",r[r.DEBUG_TOGGLE_WHITEBOARD_PDF_IMPORT_NODE_REPLACEMENT=728]="DEBUG_TOGGLE_WHITEBOARD_PDF_IMPORT_NODE_REPLACEMENT",r[r.TOGGLE_CANVAS_SEARCH_DEBUG=729]="TOGGLE_CANVAS_SEARCH_DEBUG",r[r.TOGGLE_ACCESSIBILITY_DOM_DEBUG=730]="TOGGLE_ACCESSIBILITY_DOM_DEBUG",r[r.OPEN_FPL_DEBUG=731]="OPEN_FPL_DEBUG",r[r.TOGGLE_SHOW_FIGMASCOPE=732]="TOGGLE_SHOW_FIGMASCOPE",r[r.PRINT_AS_TEST_CODE=733]="PRINT_AS_TEST_CODE",r[r.TOGGLE_UNDO_REDO_DEBUG=734]="TOGGLE_UNDO_REDO_DEBUG",r[r.TOGGLE_PLUGIN_API_DEBUG=735]="TOGGLE_PLUGIN_API_DEBUG",r[r.FOCUS_PREVIOUS_AREA=736]="FOCUS_PREVIOUS_AREA",r[r.FOCUS_NEXT_AREA=737]="FOCUS_NEXT_AREA",r[r.SET_AS_DEFAULT_RESPONSIVE_SET=738]="SET_AS_DEFAULT_RESPONSIVE_SET",r[r.SITES_COPY_LINK=739]="SITES_COPY_LINK",r[r.SITES_FIX_ISSUE=740]="SITES_FIX_ISSUE",r[r.CONVERT_TO_CODE_FILE=741]="CONVERT_TO_CODE_FILE",r[r.CONVERT_TO_CODE_LAYER=742]="CONVERT_TO_CODE_LAYER",r[r.CREATE_CODE_LAYER_FROM_DESIGN=743]="CREATE_CODE_LAYER_FROM_DESIGN",r[r.CREATE_DAKOTA_REPEATER=744]="CREATE_DAKOTA_REPEATER",r[r.CREATE_CMS_RICH_TEXT=745]="CREATE_CMS_RICH_TEXT",r[r.FOCUS_NEXT_SLIDE=746]="FOCUS_NEXT_SLIDE",r[r.FOCUS_PREVIOUS_SLIDE=747]="FOCUS_PREVIOUS_SLIDE",r[r.FOCUS_SLIDE_UP=748]="FOCUS_SLIDE_UP",r[r.FOCUS_SLIDE_DOWN=749]="FOCUS_SLIDE_DOWN",r[r.SKIP_SLIDE=750]="SKIP_SLIDE",r[r.UNSKIP_SLIDE=751]="UNSKIP_SLIDE",r[r.SKIP_SLIDES=752]="SKIP_SLIDES",r[r.UNSKIP_SLIDES=753]="UNSKIP_SLIDES",r[r.ADD_SLIDE_OBJECT_ANIMATION=754]="ADD_SLIDE_OBJECT_ANIMATION",r[r.INSERT_SLIDE_NUMBERS_ALL_SLIDES=755]="INSERT_SLIDE_NUMBERS_ALL_SLIDES",r[r.ADD_PLATFORM_SHAPE_DEFINITION=756]="ADD_PLATFORM_SHAPE_DEFINITION",r[r.REMOVE_PLATFORM_SHAPE_DEFINITION=757]="REMOVE_PLATFORM_SHAPE_DEFINITION",r[r.ASSISTANT_CHAT=758]="ASSISTANT_CHAT",r[r.COPY_TO_FIGMA_SLIDES=759]="COPY_TO_FIGMA_SLIDES",r[r.IMAGE_TO_DESIGN=760]="IMAGE_TO_DESIGN",r[r.IMAGE_TO_DESIGN_ORACLE=761]="IMAGE_TO_DESIGN_ORACLE",r[r.SET_CONSTRAINTS_AUTOMATICALLY=762]="SET_CONSTRAINTS_AUTOMATICALLY",r[r.SET_CONSTRAINTS_MANUALLY=763]="SET_CONSTRAINTS_MANUALLY",r[r.SET_CONSTRAINTS_AUTOMATICALLY_TOGGLE=764]="SET_CONSTRAINTS_AUTOMATICALLY_TOGGLE",r[r.TOGGLE_SMART_TEXT_SUBSTITUTION=765]="TOGGLE_SMART_TEXT_SUBSTITUTION",r[r.EXPORT_SLIDES_TO=766]="EXPORT_SLIDES_TO",r[r.ENTER_STAGING_MODE=767]="ENTER_STAGING_MODE",r[r.COMMIT_STAGED_CHANGES=768]="COMMIT_STAGED_CHANGES",r[r.ROLLBACK_STAGED_CHANGES=769]="ROLLBACK_STAGED_CHANGES"})(jT||(jT={}));var $T;(function(r){r[r.LAYOUT=0]="LAYOUT",r[r.HISTORY=1]="HISTORY",r[r.PREVIEW=2]="PREVIEW",r[r.BRANCHING=3]="BRANCHING",r[r.DEV_HANDOFF=4]="DEV_HANDOFF",r[r.LIBRARY=5]="LIBRARY"})($T||($T={}));var eE;(function(r){r[r.DEFAULT=0]="DEFAULT",r[r.DRAGGING=1]="DRAGGING",r[r.RESIZING=2]="RESIZING",r[r.ROTATING=3]="ROTATING",r[r.SELECTING_TEXT=4]="SELECTING_TEXT",r[r.CLICKING_TO_CHANGE_SELECTION=5]="CLICKING_TO_CHANGE_SELECTION"})(eE||(eE={}));var tE;(function(r){r[r.OFF=0]="OFF",r[r.ON=1]="ON",r[r.MIXED=2]="MIXED"})(tE||(tE={}));var rE;(function(r){r[r.NONE=0]="NONE",r[r.COLOR=1]="COLOR"})(rE||(rE={}));var nE;(function(r){r[r.NONE=0]="NONE",r[r.FILL=1]="FILL",r[r.STROKE=2]="STROKE",r[r.STROKE_PRESET=3]="STROKE_PRESET",r[r.EFFECT=4]="EFFECT",r[r.EXPORT=5]="EXPORT",r[r.LAYOUT_GRID=6]="LAYOUT_GRID",r[r.PLUGIN=7]="PLUGIN",r[r.PROTOTYPE_INTERACTION=8]="PROTOTYPE_INTERACTION",r[r.PROTOTYPE_INHERITED_INTERNAL_INTERACTION=9]="PROTOTYPE_INHERITED_INTERNAL_INTERACTION",r[r.PROTOTOTYPE_STARTING_POINT=10]="PROTOTOTYPE_STARTING_POINT",r[r.BEHAVIOR=11]="BEHAVIOR",r[r.TRANSFORM_MODIFIER=12]="TRANSFORM_MODIFIER",r[r.COMPONENT_PROP_ASSIGNMENT=13]="COMPONENT_PROP_ASSIGNMENT"})(nE||(nE={}));var oE;(function(r){r[r.NONE=0]="NONE",r[r.PHONE=1]="PHONE",r[r.TABLET=2]="TABLET",r[r.DESKTOP=3]="DESKTOP",r[r.WATCH=4]="WATCH",r[r.PAPER=5]="PAPER",r[r.SOCIALMEDIA=6]="SOCIALMEDIA",r[r.FIGMA=7]="FIGMA",r[r.PRESENTATION=8]="PRESENTATION",r[r.ARCHIVE=9]="ARCHIVE"})(oE||(oE={}));var iE;(function(r){r[r.NONE=0]="NONE",r[r.SELECT=1]="SELECT",r[r.HAND=2]="HAND",r[r.COMMENTS=3]="COMMENTS",r[r.DROPPER_COLOR=4]="DROPPER_COLOR",r[r.FRAME=5]="FRAME",r[r.SLICE=6]="SLICE",r[r.STACK=7]="STACK",r[r.SHAPE_STAR=8]="SHAPE_STAR",r[r.SHAPE_LINE=9]="SHAPE_LINE",r[r.SHAPE_ARROW=10]="SHAPE_ARROW",r[r.SHAPE_ELLIPSE=11]="SHAPE_ELLIPSE",r[r.SHAPE_RECTANGLE=12]="SHAPE_RECTANGLE",r[r.SHAPE_REGULAR_POLYGON=13]="SHAPE_REGULAR_POLYGON",r[r.VECTOR_PEN=14]="VECTOR_PEN",r[r.VECTOR_PENCIL=15]="VECTOR_PENCIL",r[r.VECTOR_BEND=16]="VECTOR_BEND",r[r.VECTOR_CUT=17]="VECTOR_CUT",r[r.VECTOR_PAINT_BUCKET=18]="VECTOR_PAINT_BUCKET",r[r.VECTOR_VAR_WIDTH_POINT=19]="VECTOR_VAR_WIDTH_POINT",r[r.TYPE=20]="TYPE",r[r.SCALE=21]="SCALE",r[r.STICKY=22]="STICKY",r[r.STAMP=23]="STAMP",r[r.SHAPE_WHITEBOARD_SQUARE=24]="SHAPE_WHITEBOARD_SQUARE",r[r.SHAPE_WHITEBOARD_ELLIPSE=25]="SHAPE_WHITEBOARD_ELLIPSE",r[r.SHAPE_WHITEBOARD_DIAMOND=26]="SHAPE_WHITEBOARD_DIAMOND",r[r.SHAPE_WHITEBOARD_TRIANGLE_UP=27]="SHAPE_WHITEBOARD_TRIANGLE_UP",r[r.SHAPE_WHITEBOARD_TRIANGLE_DOWN=28]="SHAPE_WHITEBOARD_TRIANGLE_DOWN",r[r.SHAPE_WHITEBOARD_ROUNDED_RECTANGLE=29]="SHAPE_WHITEBOARD_ROUNDED_RECTANGLE",r[r.SHAPE_WHITEBOARD_PARALLELOGRAM_RIGHT=30]="SHAPE_WHITEBOARD_PARALLELOGRAM_RIGHT",r[r.SHAPE_WHITEBOARD_PARALLELOGRAM_LEFT=31]="SHAPE_WHITEBOARD_PARALLELOGRAM_LEFT",r[r.CONNECTOR_ELBOWED=32]="CONNECTOR_ELBOWED",r[r.CONNECTOR_STRAIGHT=33]="CONNECTOR_STRAIGHT",r[r.CONNECTOR_CURVED=34]="CONNECTOR_CURVED",r[r.CODE_BLOCK=35]="CODE_BLOCK",r[r.SHAPE_WHITEBOARD_ENG_DATABASE=36]="SHAPE_WHITEBOARD_ENG_DATABASE",r[r.SHAPE_WHITEBOARD_ENG_QUEUE=37]="SHAPE_WHITEBOARD_ENG_QUEUE",r[r.SHAPE_WHITEBOARD_ENG_FILE=38]="SHAPE_WHITEBOARD_ENG_FILE",r[r.SHAPE_WHITEBOARD_ENG_FOLDER=39]="SHAPE_WHITEBOARD_ENG_FOLDER",r[r.ERASER=40]="ERASER",r[r.HIGHLIGHTER=41]="HIGHLIGHTER",r[r.SECTION=42]="SECTION",r[r.WASHI_TAPE=43]="WASHI_TAPE",r[r.TABLE=44]="TABLE",r[r.SHAPE_WHITEBOARD_TRAPEZOID=45]="SHAPE_WHITEBOARD_TRAPEZOID",r[r.SHAPE_WHITEBOARD_STAR=46]="SHAPE_WHITEBOARD_STAR",r[r.SHAPE_WHITEBOARD_SHIELD=47]="SHAPE_WHITEBOARD_SHIELD",r[r.SHAPE_WHITEBOARD_HEXAGON=48]="SHAPE_WHITEBOARD_HEXAGON",r[r.SHAPE_WHITEBOARD_PENTAGON=49]="SHAPE_WHITEBOARD_PENTAGON",r[r.SHAPE_WHITEBOARD_OCTAGON=50]="SHAPE_WHITEBOARD_OCTAGON",r[r.SHAPE_WHITEBOARD_PLUS=51]="SHAPE_WHITEBOARD_PLUS",r[r.SHAPE_WHITEBOARD_PREDEFINED_PROCESS=52]="SHAPE_WHITEBOARD_PREDEFINED_PROCESS",r[r.SHAPE_WHITEBOARD_MANUAL_INPUT=53]="SHAPE_WHITEBOARD_MANUAL_INPUT",r[r.SHAPE_WHITEBOARD_CHEVRON=54]="SHAPE_WHITEBOARD_CHEVRON",r[r.SHAPE_WHITEBOARD_DOCUMENT_SINGLE=55]="SHAPE_WHITEBOARD_DOCUMENT_SINGLE",r[r.SHAPE_WHITEBOARD_DOCUMENT_MULTIPLE=56]="SHAPE_WHITEBOARD_DOCUMENT_MULTIPLE",r[r.SHAPE_WHITEBOARD_ARROW_LEFT=57]="SHAPE_WHITEBOARD_ARROW_LEFT",r[r.SHAPE_WHITEBOARD_ARROW_RIGHT=58]="SHAPE_WHITEBOARD_ARROW_RIGHT",r[r.SHAPE_WHITEBOARD_SUMMING_JUNCTION=59]="SHAPE_WHITEBOARD_SUMMING_JUNCTION",r[r.SHAPE_WHITEBOARD_OR=60]="SHAPE_WHITEBOARD_OR",r[r.SHAPE_WHITEBOARD_SPEECH_BUBBLE=61]="SHAPE_WHITEBOARD_SPEECH_BUBBLE",r[r.SHAPE_WHITEBOARD_INTERNAL_STORAGE=62]="SHAPE_WHITEBOARD_INTERNAL_STORAGE",r[r.SHAPE_WHITEBOARD_MINDMAP_TREE_NUCLEUS=63]="SHAPE_WHITEBOARD_MINDMAP_TREE_NUCLEUS",r[r.SHAPE_WHITEBOARD_PLATFORM=64]="SHAPE_WHITEBOARD_PLATFORM",r[r.ANNOTATE=65]="ANNOTATE",r[r.IMAGE_OR_VIDEO=66]="IMAGE_OR_VIDEO",r[r.MEASURE=67]="MEASURE",r[r.SLIDES_POLL=68]="SLIDES_POLL",r[r.SLIDES_EMBED=69]="SLIDES_EMBED",r[r.SLIDES_FACEPILE=70]="SLIDES_FACEPILE",r[r.SLIDES_ALIGNMENT_SCALE=71]="SLIDES_ALIGNMENT_SCALE",r[r.SLIDES_YOUTUBE=72]="SLIDES_YOUTUBE",r[r.SLIDE_NUMBER=73]="SLIDE_NUMBER",r[r.HAND_SELECT=74]="HAND_SELECT",r[r.MULTISELECT=75]="MULTISELECT",r[r.LASSO=76]="LASSO",r[r.SITES_RESPONSIVE_SET=77]="SITES_RESPONSIVE_SET",r[r.SITES_LINK=78]="SITES_LINK",r[r.CODE_COMPONENT=79]="CODE_COMPONENT",r[r.SITES_EMBED=80]="SITES_EMBED",r[r.PATTERN_SOURCE_SELECTOR=81]="PATTERN_SOURCE_SELECTOR"})(iE||(iE={}));var aE;(function(r){r[r.MISSING=0]="MISSING",r[r.PRESENT=1]="PRESENT",r[r.MIXED=2]="MIXED",r[r.MIXED_VALUES_FIRST=3]="MIXED_VALUES_FIRST",r[r.MIXED_VALUES_NEXT=4]="MIXED_VALUES_NEXT"})(aE||(aE={}));var sE;(function(r){r[r.FRAME_PRESETS=0]="FRAME_PRESETS",r[r.PENCIL_TOOL=1]="PENCIL_TOOL",r[r.CANVAS_ITEM=2]="CANVAS_ITEM",r[r.TRANSFORM_ITEM=3]="TRANSFORM_ITEM",r[r.TEMPLATE_ITEM=4]="TEMPLATE_ITEM",r[r.COMPONENT_ITEM=5]="COMPONENT_ITEM",r[r.INSTANCE_ITEM=6]="INSTANCE_ITEM",r[r.STATE_GROUP_ITEM=7]="STATE_GROUP_ITEM",r[r.CONSTRAINTS_ITEM=8]="CONSTRAINTS_ITEM",r[r.VECTOR_ITEM=9]="VECTOR_ITEM",r[r.GRIDS_ITEM=10]="GRIDS_ITEM",r[r.MASK_ITEM=11]="MASK_ITEM",r[r.LAYER_ITEM=12]="LAYER_ITEM",r[r.TYPE_ITEM=13]="TYPE_ITEM",r[r.FILL_ITEM=14]="FILL_ITEM",r[r.STROKE_ITEM=15]="STROKE_ITEM",r[r.EFFECTS_ITEM=16]="EFFECTS_ITEM",r[r.EXPORT_ITEM=17]="EXPORT_ITEM",r[r.STACK_ITEM=18]="STACK_ITEM",r[r.SCALE_ITEM=19]="SCALE_ITEM",r[r.REMOVE_GROUP_BACKGROUND_ITEM=20]="REMOVE_GROUP_BACKGROUND_ITEM",r[r.OVERFLOW_ITEM=21]="OVERFLOW_ITEM",r[r.SELECTION_COLORS=22]="SELECTION_COLORS",r[r.VARIABLE_MODE_ITEM=23]="VARIABLE_MODE_ITEM",r[r.VARIABLE_PAGE_LEVEL_MODE_ITEM=24]="VARIABLE_PAGE_LEVEL_MODE_ITEM",r[r.SLIDES_ANIMATION=25]="SLIDES_ANIMATION",r[r.SLIDES_OBJECT_ANIMATION=26]="SLIDES_OBJECT_ANIMATION",r[r.SLIDES_EMBED=27]="SLIDES_EMBED",r[r.SLIDES_INTERACTIVE_WIDGET=28]="SLIDES_INTERACTIVE_WIDGET",r[r.SLIDES_OPACITY_ITEM=29]="SLIDES_OPACITY_ITEM",r[r.IMAGE_ITEM=30]="IMAGE_ITEM",r[r.SLIDES_THEME=31]="SLIDES_THEME",r[r.CODE_BLOCK_ITEM=32]="CODE_BLOCK_ITEM",r[r.SLIDE_NUMBER=33]="SLIDE_NUMBER",r[r.SITES_POSITION_ITEM=34]="SITES_POSITION_ITEM",r[r.SITES_LINK_ITEM=35]="SITES_LINK_ITEM",r[r.SITES_PAGE_METADATA_ITEM=36]="SITES_PAGE_METADATA_ITEM",r[r.SITES_ACCESSIBILITY_ITEM=37]="SITES_ACCESSIBILITY_ITEM",r[r.SITES_HTML_WIDGET_ITEM=38]="SITES_HTML_WIDGET_ITEM",r[r.SITES_INTERACTIONS_ITEM=39]="SITES_INTERACTIONS_ITEM",r[r.SITES_RESPONSIVENESS_ITEM=40]="SITES_RESPONSIVENESS_ITEM",r[r.SITES_CODE_COMPONENT_ITEM=41]="SITES_CODE_COMPONENT_ITEM",r[r.TRANSFORM_MODIFIERS_ITEM=42]="TRANSFORM_MODIFIERS_ITEM",r[r.NUM_VALUES=43]="NUM_VALUES"})(sE||(sE={}));var lE;(function(r){r[r.FRAME_PRESETS_ITEM=0]="FRAME_PRESETS_ITEM",r[r.CORNER_RADIUS=1]="CORNER_RADIUS",r[r.FRAME_OPTIONS=2]="FRAME_OPTIONS",r[r.COUNT=3]="COUNT",r[r.STAR_INNER_SCALE=4]="STAR_INNER_SCALE",r[r.RECTANGLE_CORNER_RADII=5]="RECTANGLE_CORNER_RADII",r[r.FIXED_FRAME_OPTIONS=6]="FIXED_FRAME_OPTIONS",r[r.ARC_DATA=7]="ARC_DATA",r[r.TRANSFORM=8]="TRANSFORM",r[r.SIZE=9]="SIZE",r[r.ANGLE=10]="ANGLE",r[r.SECTION_ITEM=11]="SECTION_ITEM",r[r.NUM_VALUES=12]="NUM_VALUES"})(lE||(lE={}));var cE;(function(r){r[r.TEXT_ALIGN_HORIZONTAL=0]="TEXT_ALIGN_HORIZONTAL",r[r.TEXT_ALIGN_VERTICAL=1]="TEXT_ALIGN_VERTICAL",r[r.TEXT_AUTO_RESIZE=2]="TEXT_AUTO_RESIZE",r[r.TEXT_STYLE=3]="TEXT_STYLE",r[r.TEXT_TRUNCATION=4]="TEXT_TRUNCATION",r[r.NUM_VALUES=5]="NUM_VALUES"})(cE||(cE={}));var dE;(function(r){r[r.NONE=0]="NONE",r[r.BOOL=1]="BOOL",r[r.TEXT=2]="TEXT",r[r.INSTANCE_SWAP=3]="INSTANCE_SWAP",r[r.VARIANT=4]="VARIANT",r[r.NUMBER=5]="NUMBER",r[r.IMAGE=6]="IMAGE",r[r.SLOT=7]="SLOT"})(dE||(dE={}));var uE;(function(r){r[r.NONE=0]="NONE",r[r.UNUSED_DEF_ERROR=1]="UNUSED_DEF_ERROR",r[r.CONFLICTING_NAMES_ERROR=2]="CONFLICTING_NAMES_ERROR",r[r.CONFLICTING_NAMES_WITH_VARIANT_ERROR=3]="CONFLICTING_NAMES_WITH_VARIANT_ERROR"})(uE||(uE={}));var pE;(function(r){r[r.NOT_APPLICABLE=0]="NOT_APPLICABLE",r[r.YES=1]="YES",r[r.NO=2]="NO"})(pE||(pE={}));var _E;(function(r){r[r.STATE_GROUP=0]="STATE_GROUP",r[r.STATE=1]="STATE",r[r.STATE_INSTANCE=2]="STATE_INSTANCE",r[r.STATE_OR_STATE_INSTANCE_SUBLAYER=3]="STATE_OR_STATE_INSTANCE_SUBLAYER",r[r.NON_STATE_COMPONENTS=4]="NON_STATE_COMPONENTS",r[r.NONE=5]="NONE"})(_E||(_E={}));var hE;(function(r){r[r.NONE=0]="NONE",r[r.TOO_MANY_STATES_ERROR=1]="TOO_MANY_STATES_ERROR",r[r.MISSING_PROPERTIES_ERROR=2]="MISSING_PROPERTIES_ERROR",r[r.DUPLICATE_STATE_ERROR=3]="DUPLICATE_STATE_ERROR",r[r.PARSE_ERROR=4]="PARSE_ERROR"})(hE||(hE={}));var mE;(function(r){r[r.NONE=0]="NONE",r[r.SINGLE_NODE=1]="SINGLE_NODE",r[r.MULTI_NODE=2]="MULTI_NODE"})(mE||(mE={}));var fE;(function(r){r[r.FIXED=0]="FIXED",r[r.HUG_CONTENT=1]="HUG_CONTENT",r[r.FILL_CONTAINER=2]="FILL_CONTAINER"})(fE||(fE={}));var gE;(function(r){r[r.CANVAS=0]="CANVAS",r[r.PROPERTIES_PANEL=1]="PROPERTIES_PANEL",r[r.DRAG_TO_CREATE=2]="DRAG_TO_CREATE"})(gE||(gE={}));var AE;(function(r){r[r.NONE=0]="NONE",r[r.CONNECTOR=1]="CONNECTOR",r[r.LINE=2]="LINE",r[r.VECTOR=3]="VECTOR",r[r.VERTEX=4]="VERTEX",r[r.ENDPOINT=5]="ENDPOINT",r[r.PENCIL=6]="PENCIL",r[r.WASHI_TAPE=7]="WASHI_TAPE",r[r.SECTION=8]="SECTION"})(AE||(AE={}));var SE;(function(r){r[r.NONE=0]="NONE",r[r.FRAME_NAME=1]="FRAME_NAME",r[r.FLOW_STARTING_POINT_NAME=2]="FLOW_STARTING_POINT_NAME",r[r.SECTION_NAME=3]="SECTION_NAME",r[r.MEASUREMENT_FREE_TEXT=4]="MEASUREMENT_FREE_TEXT",r[r.RESPONSIVE_SET_NAME=5]="RESPONSIVE_SET_NAME",r[r.CANVAS_GRID_ROW_NAME=6]="CANVAS_GRID_ROW_NAME"})(SE||(SE={}));var TE;(function(r){r[r.NONE=0]="NONE",r[r.INT=1]="INT",r[r.BOOL=2]="BOOL",r[r.FLOAT=3]="FLOAT",r[r.STRING=4]="STRING",r[r.JSON=5]="JSON",r[r.GRADIENT_STOP_SELECTION=7]="GRADIENT_STOP_SELECTION",r[r.SELECTED_PROPERTY=8]="SELECTED_PROPERTY",r[r.BOOL_ARRAY=9]="BOOL_ARRAY",r[r.GUID=10]="GUID",r[r.ON_CANVAS_NAME_EDITOR_INFO=11]="ON_CANVAS_NAME_EDITOR_INFO",r[r.EXPORT_SELECTION_SETTINGS=12]="EXPORT_SELECTION_SETTINGS",r[r.ACTIVE_EMBED_DATA=13]="ACTIVE_EMBED_DATA",r[r.VOTING_SESSION_INFO=14]="VOTING_SESSION_INFO",r[r.HOVERED_COMPONENT_PROP_DEF=15]="HOVERED_COMPONENT_PROP_DEF",r[r.TEXT_REVIEW_PLUGIN_INFO=16]="TEXT_REVIEW_PLUGIN_INFO",r[r.DEV_HANDOFF_CODE_LANGUAGE=17]="DEV_HANDOFF_CODE_LANGUAGE",r[r.DEV_HANDOFF_PREFERENCES=18]="DEV_HANDOFF_PREFERENCES"})(TE||(TE={}));var EE;(function(r){r[r.OVERRIDES_FOR_LAYER_AND_SUBLAYERS=0]="OVERRIDES_FOR_LAYER_AND_SUBLAYERS",r[r.EXPORTS=1]="EXPORTS",r[r.EFFECTS=2]="EFFECTS",r[r.LAYER=3]="LAYER",r[r.VISIBLE=4]="VISIBLE",r[r.NAME=5]="NAME",r[r.FILL=6]="FILL",r[r.STROKE=7]="STROKE",r[r.TEXT=8]="TEXT",r[r.TEXT_STYLE=9]="TEXT_STYLE",r[r.SIZE=10]="SIZE",r[r.OVERRIDDEN_SYMBOL=11]="OVERRIDDEN_SYMBOL",r[r.PROTOTYPE_INTERACTIONS=12]="PROTOTYPE_INTERACTIONS",r[r.OVERLAY=13]="OVERLAY",r[r.NUM_VALUES=14]="NUM_VALUES"})(EE||(EE={}));var IE;(function(r){r[r.ALWAYS=0]="ALWAYS",r[r.ONLY_WHEN_NOT_EMPTY=1]="ONLY_WHEN_NOT_EMPTY",r[r.ONLY_WHEN_NOT_DISABLED=2]="ONLY_WHEN_NOT_DISABLED"})(IE||(IE={}));var yE;(function(r){r[r.UNJOINED=0]="UNJOINED",r[r.UNJOINED_FROM_ERROR=1]="UNJOINED_FROM_ERROR",r[r.UNJOINED_FROM_VALIDATION_FAILURE=2]="UNJOINED_FROM_VALIDATION_FAILURE",r[r.GOT_SCHEMA=3]="GOT_SCHEMA",r[r.JOINING_INITIAL_LOAD=4]="JOINING_INITIAL_LOAD",r[r.JOINING_RECONNECT=5]="JOINING_RECONNECT",r[r.JOINING_RECONNECT_AWAITING_QUERY_REPLY=6]="JOINING_RECONNECT_AWAITING_QUERY_REPLY",r[r.JOINED=7]="JOINED",r[r.SHOULD_UPGRADE=8]="SHOULD_UPGRADE",r[r.UPGRADING=9]="UPGRADING",r[r.WAITING_FOR_RELOAD=10]="WAITING_FOR_RELOAD",r[r.DETACHED=11]="DETACHED"})(yE||(yE={}));var RE;(function(r){r[r.COMMENT=0]="COMMENT",r[r.EMPTY_LINE=1]="EMPTY_LINE",r[r.DECLARATION=2]="DECLARATION",r[r.BLOCK_COMMENT=3]="BLOCK_COMMENT"})(RE||(RE={}));var vE;(function(r){r[r.DESIGN=0]="DESIGN",r[r.PROTOTYPE=1]="PROTOTYPE",r[r.INSPECT=2]="INSPECT",r[r.COMMENT=3]="COMMENT",r[r.EXPORT=4]="EXPORT",r[r.SLIDE=5]="SLIDE",r[r.SLIDE_ANIMATION=6]="SLIDE_ANIMATION",r[r.SITE=7]="SITE",r[r.COOPER_PUBLISH=8]="COOPER_PUBLISH",r[r.DAKOTA=9]="DAKOTA",r[r.COOPER_TABULAR=10]="COOPER_TABULAR",r[r.COOPER_FIELDS=11]="COOPER_FIELDS",r[r.COOPER_VARIANTS=12]="COOPER_VARIANTS",r[r.ILLUSTRATION=13]="ILLUSTRATION"})(vE||(vE={}));var OE;(function(r){r[r.PAN=0]="PAN",r[r.ZOOM=1]="ZOOM"})(OE||(OE={}));var CE;(function(r){r[r.CSS=0]="CSS",r[r.IOS=1]="IOS",r[r.ANDROID=2]="ANDROID"})(CE||(CE={}));var bE;(function(r){r[r.TABULAR=0]="TABULAR",r[r.CODE=1]="CODE"})(bE||(bE={}));var NE;(function(r){r[r.NOT_LOADED=0]="NOT_LOADED",r[r.REQUESTED=1]="REQUESTED",r[r.LOADED=2]="LOADED"})(NE||(NE={}));var PE;(function(r){r[r.NONE=0]="NONE",r[r.DIVIDER=1]="DIVIDER",r[r.WHITEBOARD_COLOR=2]="WHITEBOARD_COLOR",r[r.STICKY_COLOR=3]="STICKY_COLOR",r[r.HIGHLIGHT_COLOR=4]="HIGHLIGHT_COLOR",r[r.PENCIL_COLOR=5]="PENCIL_COLOR",r[r.WHITEBOARD_STROKE=6]="WHITEBOARD_STROKE",r[r.WHITEBOARD_SHAPE=7]="WHITEBOARD_SHAPE",r[r.WHITEBOARD_PLATFORM_SHAPE=8]="WHITEBOARD_PLATFORM_SHAPE",r[r.TEXT_DECORATION=9]="TEXT_DECORATION",r[r.HYPERLINK=10]="HYPERLINK",r[r.BULLETED_LIST=11]="BULLETED_LIST",r[r.WHITEBOARD_TEXT_STYLE=12]="WHITEBOARD_TEXT_STYLE",r[r.TEXT_ALIGN_H=13]="TEXT_ALIGN_H",r[r.TEXT_ALIGN_V=14]="TEXT_ALIGN_V",r[r.FONT_FAMILY=15]="FONT_FAMILY",r[r.CONNECTOR_LINE_STYLE=16]="CONNECTOR_LINE_STYLE",r[r.CONNECTOR_START_CAP=17]="CONNECTOR_START_CAP",r[r.CONNECTOR_END_CAP=18]="CONNECTOR_END_CAP",r[r.AUTHOR_VISIBILITY=19]="AUTHOR_VISIBILITY",r[r.ADD_TEXT=20]="ADD_TEXT",r[r.CODE_BLOCK_LANGUAGE=21]="CODE_BLOCK_LANGUAGE",r[r.CODE_BLOCK_THEME=22]="CODE_BLOCK_THEME",r[r.IMAGE=23]="IMAGE",r[r.BORDER=24]="BORDER",r[r.DESCRIPTION=25]="DESCRIPTION",r[r.EMBED_OPEN_EXTERNAL=26]="EMBED_OPEN_EXTERNAL",r[r.EMBED_MAXIMIZE=27]="EMBED_MAXIMIZE",r[r.EMBED_CONVERT_TO_TEXT=28]="EMBED_CONVERT_TO_TEXT",r[r.SECTION_SHOW_HIDE=29]="SECTION_SHOW_HIDE",r[r.SECTION_RENAME=30]="SECTION_RENAME",r[r.RESIZE_TO_FIT=31]="RESIZE_TO_FIT",r[r.WASHI_TAPE_PATTERN=32]="WASHI_TAPE_PATTERN",r[r.FACE_STAMP=33]="FACE_STAMP",r[r.START_MIND_MAP=34]="START_MIND_MAP",r[r.LOCK=35]="LOCK",r[r.REMOVE_IMAGE_BACKGROUND=36]="REMOVE_IMAGE_BACKGROUND",r[r.WIDGET=37]="WIDGET"})(PE||(PE={}));var FE;(function(r){r[r.PNG=0]="PNG",r[r.JPEG=1]="JPEG",r[r.PDF=2]="PDF",r[r.CSV=3]="CSV"})(FE||(FE={}));var DE;(function(r){r[r.STICKY=0]="STICKY",r[r.TABLE=1]="TABLE"})(DE||(DE={}));var wE;(function(r){r[r.TRANSPARENT=0]="TRANSPARENT",r[r.WHITE=1]="WHITE",r[r.CHECKERBOARD=2]="CHECKERBOARD",r[r.HALF_CHECKERBOARD=3]="HALF_CHECKERBOARD",r[r.HALF_WHITE=4]="HALF_WHITE",r[r.CUSTOM_COLOR=5]="CUSTOM_COLOR"})(wE||(wE={}));var LE;(function(r){r[r.SOLID=0]="SOLID",r[r.TRANSPARENT=1]="TRANSPARENT",r[r.GRID=2]="GRID"})(LE||(LE={}));var xE;(function(r){r[r.ATTACHED_FILE_TIP=0]="ATTACHED_FILE_TIP",r[r.DETACHED_FILE_TIP=1]="DETACHED_FILE_TIP",r[r.DETACHED_BRANCH_TIP=2]="DETACHED_BRANCH_TIP",r[r.BRANCH_POINT=3]="BRANCH_POINT",r[r.PREVIEW_BRANCH_TIP=4]="PREVIEW_BRANCH_TIP",r[r.STAGED_BRANCH_TIP=5]="STAGED_BRANCH_TIP",r[r.STAGED_FILE_TIP=6]="STAGED_FILE_TIP"})(xE||(xE={}));var BE;(function(r){r[r.NONE=0]="NONE",r[r.BEGIN_PREVIEW=1]="BEGIN_PREVIEW",r[r.RECREATE_BRANCH_POINT=2]="RECREATE_BRANCH_POINT",r[r.PREVIEW_CHANGES=3]="PREVIEW_CHANGES",r[r.STAGE_CHANGES=4]="STAGE_CHANGES",r[r.RESET_TO_BRANCH_POINT=5]="RESET_TO_BRANCH_POINT",r[r.COMMIT=6]="COMMIT",r[r.ABANDON=7]="ABANDON",r[r.STAGE_CHANGES_WHILE_ATTACHED=8]="STAGE_CHANGES_WHILE_ATTACHED",r[r.BEGIN_MERGE=9]="BEGIN_MERGE"})(BE||(BE={}));var ME;(function(r){r[r.UNKNOWN=0]="UNKNOWN",r[r.US_QWERTY=1]="US_QWERTY",r[r.DVORAK=2]="DVORAK",r[r.GERMAN=3]="GERMAN",r[r.FRENCH_AZERTY=4]="FRENCH_AZERTY",r[r.HIRAGANA_KANA=5]="HIRAGANA_KANA",r[r.UK_MAC=6]="UK_MAC",r[r.UK_PC=7]="UK_PC",r[r.SWEDISH=8]="SWEDISH",r[r.FINNISH=9]="FINNISH",r[r.DANISH=10]="DANISH",r[r.NORWEGIAN=11]="NORWEGIAN",r[r.ITALIAN=12]="ITALIAN",r[r.SPANISH=13]="SPANISH",r[r.SPANISH_LATAM=14]="SPANISH_LATAM",r[r.CHINESE=15]="CHINESE",r[r.PORTUGUESE=16]="PORTUGUESE",r[r.KOREAN=17]="KOREAN"})(ME||(ME={}));var GE;(function(r){r[r.DESIGN=0]="DESIGN",r[r.WHITEBOARD=1]="WHITEBOARD",r[r.SLIDES=2]="SLIDES",r[r.DEV_HANDOFF=3]="DEV_HANDOFF",r[r.SITES=4]="SITES",r[r.COOPER=5]="COOPER",r[r.ILLUSTRATION=6]="ILLUSTRATION"})(GE||(GE={}));var UE;(function(r){r[r.RIGHT=0]="RIGHT",r[r.ABOVE=1]="ABOVE",r[r.CUSTOM_POSITION=2]="CUSTOM_POSITION",r[r.BELOW=3]="BELOW"})(UE||(UE={}));var VE;(function(r){r[r.OFF=0]="OFF",r[r.ON_AND_LOCKED=1]="ON_AND_LOCKED",r[r.KEEP_UI=2]="KEEP_UI",r[r.HIDE_UI=3]="HIDE_UI"})(VE||(VE={}));var kE;(function(r){r[r.NONE=0]="NONE",r[r.FRAME=1]="FRAME",r[r.GROUP=2]="GROUP",r[r.STACK=3]="STACK",r[r.SECTION=4]="SECTION",r[r.RESPONSIVE_SET=5]="RESPONSIVE_SET",r[r.TRANSFORM=6]="TRANSFORM"})(kE||(kE={}));var HE;(function(r){r[r.SELECTION=0]="SELECTION",r[r.SNAPPING=1]="SNAPPING"})(HE||(HE={}));var zE;(function(r){r[r.MISSING=0]="MISSING",r[r.CORNER_RADIUS=1]="CORNER_RADIUS",r[r.PARAGRAPH_SPACING=2]="PARAGRAPH_SPACING",r[r.PARAGRAPH_INDENT=3]="PARAGRAPH_INDENT",r[r.STROKE_WEIGHT=4]="STROKE_WEIGHT",r[r.STACK_SPACING=5]="STACK_SPACING",r[r.STACK_PADDING_LEFT=6]="STACK_PADDING_LEFT",r[r.STACK_PADDING_TOP=7]="STACK_PADDING_TOP",r[r.STACK_PADDING_RIGHT=8]="STACK_PADDING_RIGHT",r[r.STACK_PADDING_BOTTOM=9]="STACK_PADDING_BOTTOM",r[r.VISIBLE=10]="VISIBLE",r[r.TEXT_DATA=11]="TEXT_DATA",r[r.WIDTH=12]="WIDTH",r[r.HEIGHT=13]="HEIGHT",r[r.RECTANGLE_TOP_LEFT_CORNER_RADIUS=14]="RECTANGLE_TOP_LEFT_CORNER_RADIUS",r[r.RECTANGLE_TOP_RIGHT_CORNER_RADIUS=15]="RECTANGLE_TOP_RIGHT_CORNER_RADIUS",r[r.RECTANGLE_BOTTOM_LEFT_CORNER_RADIUS=16]="RECTANGLE_BOTTOM_LEFT_CORNER_RADIUS",r[r.RECTANGLE_BOTTOM_RIGHT_CORNER_RADIUS=17]="RECTANGLE_BOTTOM_RIGHT_CORNER_RADIUS",r[r.BORDER_TOP_WEIGHT=18]="BORDER_TOP_WEIGHT",r[r.BORDER_BOTTOM_WEIGHT=19]="BORDER_BOTTOM_WEIGHT",r[r.BORDER_LEFT_WEIGHT=20]="BORDER_LEFT_WEIGHT",r[r.BORDER_RIGHT_WEIGHT=21]="BORDER_RIGHT_WEIGHT",r[r.VARIANT_PROPERTIES=22]="VARIANT_PROPERTIES",r[r.STACK_COUNTER_SPACING=23]="STACK_COUNTER_SPACING",r[r.MIN_WIDTH=24]="MIN_WIDTH",r[r.MAX_WIDTH=25]="MAX_WIDTH",r[r.MIN_HEIGHT=26]="MIN_HEIGHT",r[r.MAX_HEIGHT=27]="MAX_HEIGHT"})(zE||(zE={}));var WE;(function(r){r[r.DONT_MERGE=0]="DONT_MERGE",r[r.TEXT_EDIT=1]="TEXT_EDIT",r[r.TEXT_LINE_HEIGHT=2]="TEXT_LINE_HEIGHT",r[r.TEXT_FONT_SIZE=3]="TEXT_FONT_SIZE",r[r.TEXT_LETTER_SPACING=4]="TEXT_LETTER_SPACING",r[r.LAYER_OPACITY=5]="LAYER_OPACITY",r[r.NUDGE=6]="NUDGE",r[r.SELECTION_PROPERTY=7]="SELECTION_PROPERTY",r[r.STYLE_SELECTION_PROPERTY=8]="STYLE_SELECTION_PROPERTY",r[r.CONTENT_FILL_INSERT_AND_GENERATE=9]="CONTENT_FILL_INSERT_AND_GENERATE",r[r.AI_TEXT_MANIPULATION_START=10]="AI_TEXT_MANIPULATION_START",r[r.AI_TEXT_MANIPULATION_DELTA=11]="AI_TEXT_MANIPULATION_DELTA"})(WE||(WE={}));var KE;(function(r){r[r.NO_SESSION=0]="NO_SESSION",r[r.JOINED=1]="JOINED",r[r.NOT_JOINED=2]="NOT_JOINED",r[r.ENDED=3]="ENDED"})(KE||(KE={}));var YE;(function(r){r[r.NONE=0]="NONE",r[r.FILL=1]="FILL",r[r.TEXT=2]="TEXT",r[r.EFFECT=3]="EFFECT",r[r.GRID=4]="GRID"})(YE||(YE={}));var QE;(function(r){r[r.TOP_LEFT=0]="TOP_LEFT",r[r.TOP_CENTER=1]="TOP_CENTER",r[r.TOP_RIGHT=2]="TOP_RIGHT",r[r.MIDDLE_LEFT=3]="MIDDLE_LEFT",r[r.MIDDLE_CENTER=4]="MIDDLE_CENTER",r[r.MIDDLE_RIGHT=5]="MIDDLE_RIGHT",r[r.BOTTOM_LEFT=6]="BOTTOM_LEFT",r[r.BOTTOM_CENTER=7]="BOTTOM_CENTER",r[r.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"})(QE||(QE={}));var XE;(function(r){r[r.PRESENT=0]="PRESENT",r[r.PREVIEW=1]="PREVIEW"})(XE||(XE={}));var qE;(function(r){r[r.MOBILE_NATIVE_NAVBAR=0]="MOBILE_NATIVE_NAVBAR"})(qE||(qE={}));var ZE;(function(r){r[r.DEFINITELY_COVERED_ONLY=0]="DEFINITELY_COVERED_ONLY",r[r.DEFINITELY_COVERED_AND_OUTDATED=1]="DEFINITELY_COVERED_AND_OUTDATED"})(ZE||(ZE={}));var JE;(function(r){r[r.SUCCESS=0]="SUCCESS",r[r.ERROR_TEXT_SIZE=1]="ERROR_TEXT_SIZE",r[r.TIMEOUT=2]="TIMEOUT",r[r.ERROR_OTHER=3]="ERROR_OTHER"})(JE||(JE={}));var jE;(function(r){r[r.MIRO=0]="MIRO",r[r.MURAL=1]="MURAL",r[r.LUCID=2]="LUCID",r[r.JAMBOARD=3]="JAMBOARD",r[r.UNKNOWN=4]="UNKNOWN"})(jE||(jE={}));var $E;(function(r){r[r.UNKNOWN=0]="UNKNOWN",r[r.YOUTUBE=1]="YOUTUBE",r[r.GOOGLE_MAP=2]="GOOGLE_MAP",r[r.MAILCHIMP=3]="MAILCHIMP",r[r.GENERIC=4]="GENERIC"})($E||($E={}));var eI;(function(r){r[r.NONE=0]="NONE",r[r.IGNORE_COMMIT_FOR_CONTENT_FILL=1]="IGNORE_COMMIT_FOR_CONTENT_FILL"})(eI||(eI={}));var tI;(function(r){r[r.TRACE=0]="TRACE",r[r.DBG=1]="DBG",r[r.INFO=2]="INFO",r[r.LOG=3]="LOG",r[r.WARN=4]="WARN",r[r.ERROR=5]="ERROR"})(tI||(tI={}));var rI;(function(r){r[r.LEFT=0]="LEFT",r[r.RIGHT=1]="RIGHT"})(rI||(rI={}));var nI;(function(r){r[r.TOP_LEFT=0]="TOP_LEFT",r[r.CENTER=1]="CENTER"})(nI||(nI={}));var oI;(function(r){r[r.COMPONENTS=0]="COMPONENTS",r[r.PROPS=1]="PROPS"})(oI||(oI={}));var iI;(function(r){r[r.PIXEL=0]="PIXEL",r[r.SCALED=1]="SCALED"})(iI||(iI={}));var aI;(function(r){r[r.DEFAULT=0]="DEFAULT",r[r.UNDO_REDO=1]="UNDO_REDO",r[r.ANNOTATIONS=2]="ANNOTATIONS",r[r.NODE_STATUS=3]="NODE_STATUS"})(aI||(aI={}));var sI;(function(r){r[r.FIT_TO_SCREEN=0]="FIT_TO_SCREEN",r[r.FIT_TO_WIDTH=1]="FIT_TO_WIDTH",r[r.FILL_SCREEN=2]="FILL_SCREEN"})(sI||(sI={}));var lI;(function(r){r[r.LEFT=0]="LEFT",r[r.CENTER=1]="CENTER",r[r.RIGHT=2]="RIGHT",r[r.JUSTIFIED=3]="JUSTIFIED"})(lI||(lI={}));var cI;(function(r){r[r.TOP=0]="TOP",r[r.CENTER=1]="CENTER",r[r.BOTTOM=2]="BOTTOM"})(cI||(cI={}));var dI;(function(r){r[r.TEXT=0]="TEXT",r[r.BOX=1]="BOX"})(dI||(dI={}));var uI;(function(r){r[r.CLICK=0]="CLICK",r[r.DRAG=1]="DRAG"})(uI||(uI={}));var pI;(function(r){r[r.TOP=0]="TOP",r[r.RIGHT=1]="RIGHT",r[r.BOTTOM=2]="BOTTOM",r[r.LEFT=3]="LEFT"})(pI||(pI={}));var _I;(function(r){r[r.NONE=0]="NONE",r[r.ABSOLUTE=1]="ABSOLUTE",r[r.EDGE=2]="EDGE",r[r.CENTER=3]="CENTER",r[r.TOP=4]="TOP",r[r.RIGHT=5]="RIGHT",r[r.LEFT=6]="LEFT",r[r.BOTTOM=7]="BOTTOM"})(_I||(_I={}));var hI;(function(r){r[r.YES=0]="YES",r[r.NO=1]="NO"})(hI||(hI={}));var mI;(function(r){r[r.ROW=0]="ROW",r[r.COLUMN=1]="COLUMN"})(mI||(mI={}));var fI;(function(r){r[r.FORWARD=0]="FORWARD",r[r.BACKWARD=1]="BACKWARD"})(fI||(fI={}));var gI;(function(r){r[r.HIDE=0]="HIDE",r[r.REORDER_AND_APPEND_ONLY=1]="REORDER_AND_APPEND_ONLY",r[r.FULL=2]="FULL"})(gI||(gI={}));var AI;(function(r){r[r.AXIS=0]="AXIS",r[r.POINT=1]="POINT"})(AI||(AI={}));var SI;(function(r){r[r.UNSELECTED_NODES=0]="UNSELECTED_NODES",r[r.UNSELECTED_NODES_AND_SELECTED_FRAME_CONTENT=1]="UNSELECTED_NODES_AND_SELECTED_FRAME_CONTENT"})(SI||(SI={}));var TI;(function(r){r[r.NONE=0]="NONE",r[r.PIXEL_GRID=1]="PIXEL_GRID",r[r.DOT_GRID=16]="DOT_GRID"})(TI||(TI={}));var EI;(function(r){r[r.BLANK=0]="BLANK",r[r.DUPLICATE=1]="DUPLICATE"})(EI||(EI={}));var II;(function(r){r[r.EDITOR_TEMPLATE=0]="EDITOR_TEMPLATE",r[r.SLIDES_TEMPLATE=1]="SLIDES_TEMPLATE",r[r.SITES_TEMPLATE=2]="SITES_TEMPLATE",r[r.LITE_TEMPLATE=3]="LITE_TEMPLATE"})(II||(II={}));var yI;(function(r){r[r.SUCCESS=0]="SUCCESS",r[r.TRIGGERED_DETACH=1]="TRIGGERED_DETACH",r[r.INTERNAL_ERROR=2]="INTERNAL_ERROR"})(yI||(yI={}));var RI;(function(r){r[r.SUCCESS=0]="SUCCESS",r[r.NOT_DETACHED_ERROR=1]="NOT_DETACHED_ERROR",r[r.INTERNAL_ERROR=2]="INTERNAL_ERROR"})(RI||(RI={}));var vI;(function(r){r[r.DEFAULT=0]="DEFAULT",r[r.CONTAINING_PAGE=1]="CONTAINING_PAGE",r[r.PLUGIN=2]="PLUGIN"})(vI||(vI={}));var OI;(function(r){r[r.LEGACY_PLUGIN=0]="LEGACY_PLUGIN",r[r.PLUGIN_VALIDATION=1]="PLUGIN_VALIDATION",r[r.DYNAMIC_PLUGIN_LOAD_ALL=2]="DYNAMIC_PLUGIN_LOAD_ALL",r[r.SAVE_LOCAL_COPY=3]="SAVE_LOCAL_COPY",r[r.LEGACY_IMAGES_CODE=4]="LEGACY_IMAGES_CODE",r[r.FIND_AND_REPLACE=5]="FIND_AND_REPLACE",r[r.REPLACE_LIBRARIES=6]="REPLACE_LIBRARIES",r[r.LIBRARY_UPDATES=7]="LIBRARY_UPDATES",r[r.MISSING_FONTS=8]="MISSING_FONTS",r[r.BRANCHING_MODAL_OPEN=9]="BRANCHING_MODAL_OPEN",r[r.BRANCHING_MERGE_TO_MAIN=10]="BRANCHING_MERGE_TO_MAIN",r[r.DEBUG_TOOL=11]="DEBUG_TOOL"})(OI||(OI={}));var CI;(function(r){r[r.ASSET_UPDATE=0]="ASSET_UPDATE",r[r.AUTOSAVE=1]="AUTOSAVE",r[r.BRANCHING_MODAL_OPEN=2]="BRANCHING_MODAL_OPEN",r[r.BRANCHING_MERGE_TO_MAIN=3]="BRANCHING_MERGE_TO_MAIN",r[r.DEV_HANDOFF_STATUS=4]="DEV_HANDOFF_STATUS",r[r.HYPERLINK_PRELOAD=5]="HYPERLINK_PRELOAD",r[r.PAGE_INITIAL_LOAD=6]="PAGE_INITIAL_LOAD",r[r.PAGE_CHANGE=7]="PAGE_CHANGE",r[r.PAGE_DELETE=8]="PAGE_DELETE",r[r.PAGE_DIVIDER_CHECK=9]="PAGE_DIVIDER_CHECK",r[r.PAGE_DUPLICATE=10]="PAGE_DUPLICATE",r[r.PAGE_MOVE_TO=11]="PAGE_MOVE_TO",r[r.PLUGIN=12]="PLUGIN"})(CI||(CI={}));var bI;(function(r){r[r.EMBED=0]="EMBED",r[r.LINK_PREVIEW=1]="LINK_PREVIEW",r[r.WIDGET=2]="WIDGET"})(bI||(bI={}));var NI;(function(r){r[r.LOCAL=0]="LOCAL",r[r.REMOTE=1]="REMOTE"})(NI||(NI={}));var PI;(function(r){r[r.CREATE=0]="CREATE",r[r.DELETE=1]="DELETE",r[r.PROPERTY_CHANGE=2]="PROPERTY_CHANGE",r[r.STYLE_PROPERTY_CHANGE=3]="STYLE_PROPERTY_CHANGE",r[r.STYLE_CREATE=4]="STYLE_CREATE",r[r.STYLE_DELETE=5]="STYLE_DELETE"})(PI||(PI={}));var FI;(function(r){r[r.SINGLE_SLIDE=0]="SINGLE_SLIDE",r[r.GRID=1]="GRID"})(FI||(FI={}));var DI;(function(r){r[r.GROUP=0]="GROUP",r[r.UNION=1]="UNION",r[r.SUBTRACT=2]="SUBTRACT",r[r.INTERSECT=3]="INTERSECT",r[r.XOR=4]="XOR",r[r.STATE_GROUP=5]="STATE_GROUP"})(DI||(DI={}));var wI;(function(r){r[r.UNLOADED=0]="UNLOADED",r[r.NOT_ANIMATED=1]="NOT_ANIMATED",r[r.ANIMATED=2]="ANIMATED"})(wI||(wI={}));var LI;(function(r){r[r.NONE=0]="NONE",r[r.PRESET=1]="PRESET",r[r.CUSTOM=2]="CUSTOM",r[r.PRESENTATION=3]="PRESENTATION"})(LI||(LI={}));var xI;(function(r){r[r.VALID=0]="VALID",r[r.NO_FRAMES=1]="NO_FRAMES",r[r.INVALID_START_NODE=2]="INVALID_START_NODE"})(xI||(xI={}));var BI;(function(r){r[r.SCROLLS=0]="SCROLLS",r[r.FIXED=1]="FIXED",r[r.STICKY_SCROLLS=2]="STICKY_SCROLLS"})(BI||(BI={}));var MI;(function(r){r[r.ROW=0]="ROW",r[r.COLUMN=1]="COLUMN"})(MI||(MI={}));var GI;(function(r){r[r.PLUGIN=0]="PLUGIN",r[r.INTERNAL=1]="INTERNAL"})(GI||(GI={}));var UI;(function(r){r[r.SET_AUTOLAYOUT_SPACING_AUTO=0]="SET_AUTOLAYOUT_SPACING_AUTO",r[r.SET_CLIP_CONTENT=1]="SET_CLIP_CONTENT",r[r.SET_CORNER_SMOOTHING_ZERO=2]="SET_CORNER_SMOOTHING_ZERO",r[r.USE_BLEND_MODE_MULTIPLY=3]="USE_BLEND_MODE_MULTIPLY",r[r.REMOVE_VERTICAL_TRIM=4]="REMOVE_VERTICAL_TRIM",r[r.REMOVE_VIDEO_FILL=5]="REMOVE_VIDEO_FILL",r[r.REMOVE_VIDEO_STROKE=6]="REMOVE_VIDEO_STROKE",r[r.REMOVE_STICKY=7]="REMOVE_STICKY",r[r.REMOVE_CONNECTOR=8]="REMOVE_CONNECTOR",r[r.REMOVE_WASHI_TAPE=9]="REMOVE_WASHI_TAPE",r[r.REMOVE_HIGHLIGHT=10]="REMOVE_HIGHLIGHT",r[r.REMOVE_SHAPE_WITH_TEXT=11]="REMOVE_SHAPE_WITH_TEXT",r[r.REMOVE_STAMP=12]="REMOVE_STAMP",r[r.REMOVE_TABLE=13]="REMOVE_TABLE",r[r.REMOVE_WIDGET=14]="REMOVE_WIDGET",r[r.REMOVE_STROKE=15]="REMOVE_STROKE",r[r.REMOVE_STROKE_GRADIENT=16]="REMOVE_STROKE_GRADIENT",r[r.REMOVE_STROKE_IMAGE=17]="REMOVE_STROKE_IMAGE",r[r.REMOVE_STROKE_BLEND_MODE=18]="REMOVE_STROKE_BLEND_MODE",r[r.REMOVE_CUSTOM_JOIN=19]="REMOVE_CUSTOM_JOIN",r[r.REMOVE_TEXT_INNER_SHADOW=20]="REMOVE_TEXT_INNER_SHADOW",r[r.SET_BLEND_MODE_NORMAL=21]="SET_BLEND_MODE_NORMAL",r[r.REMOVE_TEXT_BACKGROUND_BLUR=22]="REMOVE_TEXT_BACKGROUND_BLUR",r[r.REMOVE_BASELINE_ALIGNMENT=23]="REMOVE_BASELINE_ALIGNMENT",r[r.REMOVE_EFFECTS=24]="REMOVE_EFFECTS",r[r.REMOVE_OPEN_OVERLAY_ACTIONS=25]="REMOVE_OPEN_OVERLAY_ACTIONS",r[r.REMOVE_WHILE_PRESSING_ACTIONS=26]="REMOVE_WHILE_PRESSING_ACTIONS",r[r.REMOVE_SWAP_OVERLAY_ACTIONS=27]="REMOVE_SWAP_OVERLAY_ACTIONS",r[r.REMOVE_CLOSE_OVERLAY_ACTIONS=28]="REMOVE_CLOSE_OVERLAY_ACTIONS",r[r.REMOVE_SET_VARIABLE_MODE_ACTIONS=29]="REMOVE_SET_VARIABLE_MODE_ACTIONS",r[r.REMOVE_ON_DRAG_ACTIONS=30]="REMOVE_ON_DRAG_ACTIONS",r[r.REMOVE_GAMEPAD_ACTIONS=31]="REMOVE_GAMEPAD_ACTIONS",r[r.REMOVE_NAVIGATE_ACTIONS_WITH_SMART_ANIMATE=32]="REMOVE_NAVIGATE_ACTIONS_WITH_SMART_ANIMATE",r[r.REMOVE_DISSOLVE_ANIMATIONS=33]="REMOVE_DISSOLVE_ANIMATIONS",r[r.REMOVE_SMART_ANIMATE=34]="REMOVE_SMART_ANIMATE",r[r.REMOVE_SMART_ANIMATE_FROM_ANCESTOR=35]="REMOVE_SMART_ANIMATE_FROM_ANCESTOR",r[r.SET_AUTOLAYOUT_SIZING_FIXED=36]="SET_AUTOLAYOUT_SIZING_FIXED",r[r.ADD_AUTOLAYOUT=37]="ADD_AUTOLAYOUT",r[r.REMOVE_AUTOLAYOUT=38]="REMOVE_AUTOLAYOUT",r[r.SET_POSITION_CONSTRAINTS_CENTER=39]="SET_POSITION_CONSTRAINTS_CENTER",r[r.REMOVE_FILL_CONTAINER=40]="REMOVE_FILL_CONTAINER",r[r.REMOVE_ROTATION=41]="REMOVE_ROTATION",r[r.REMOVE_SCROLLING=42]="REMOVE_SCROLLING"})(UI||(UI={}));var VI;(function(r){r[r.INACTIVE=0]="INACTIVE",r[r.ALL_FRAMES=1]="ALL_FRAMES",r[r.COMPONENT_SET=2]="COMPONENT_SET",r[r.RESPONSIVE_SET=3]="RESPONSIVE_SET"})(VI||(VI={}));var kI;(function(r){r[r.VARIABLES_MODAL=0]="VARIABLES_MODAL",r[r.VARIABLE_PICKER=1]="VARIABLE_PICKER",r[r.SLIDES_THEME=2]="SLIDES_THEME"})(kI||(kI={}));var HI;(function(r){r[r.AUTOMATIC_FIRST_COLLECTION=0]="AUTOMATIC_FIRST_COLLECTION",r[r.VARIABLES_MODAL=1]="VARIABLES_MODAL"})(HI||(HI={}));var zI;(function(r){r[r.ADD_CHANGES=0]="ADD_CHANGES",r[r.REPLACE_CHANGES=1]="REPLACE_CHANGES"})(zI||(zI={}));var WI;(function(r){r[r.NONE=0]="NONE",r[r.DISCONNECTED_AUTOSAVE_DISABLED=1]="DISCONNECTED_AUTOSAVE_DISABLED",r[r.DISCONNECTED_SERVER_ISSUES=2]="DISCONNECTED_SERVER_ISSUES",r[r.DISCONNECTED_OTHER=3]="DISCONNECTED_OTHER",r[r.SYNCING_AUTOSAVE_DISABLED=4]="SYNCING_AUTOSAVE_DISABLED",r[r.SYNCING_SERVER_ISSUES=5]="SYNCING_SERVER_ISSUES",r[r.SYNCING_OTHER=6]="SYNCING_OTHER",r[r.SUPPRESS_UNSAVED_CHANGES_UI=7]="SUPPRESS_UNSAVED_CHANGES_UI"})(WI||(WI={}));var KI;(function(r){r[r.NONE=0]="NONE",r[r.SCENEGRAPH_VALIDATION_ERROR=1]="SCENEGRAPH_VALIDATION_ERROR",r[r.NON_ATOMIC_SYNC_ERROR=2]="NON_ATOMIC_SYNC_ERROR"})(KI||(KI={}));var YI;(function(r){r[r.NEW_FILE=0]="NEW_FILE",r[r.INITIAL_LOAD=1]="INITIAL_LOAD",r[r.RECONNECT=2]="RECONNECT"})(YI||(YI={}));var QI;(function(r){r[r.NONE=0]="NONE",r[r.VARIABLES=1]="VARIABLES",r[r.STYLES=2]="STYLES"})(QI||(QI={}));var XI;(function(r){r[r.DEFAULT=0]="DEFAULT",r[r.CROSSHAIR=1]="CROSSHAIR",r[r.EYEDROPPER=2]="EYEDROPPER",r[r.HAND=3]="HAND",r[r.PAINT_BUCKET=4]="PAINT_BUCKET",r[r.PEN=5]="PEN",r[r.PENCIL=6]="PENCIL",r[r.MARKER=7]="MARKER",r[r.ERASER=8]="ERASER",r[r.HIGHLIGHTER=9]="HIGHLIGHTER",r[r.HIGH_FIVE=10]="HIGH_FIVE",r[r.LASSO=11]="LASSO"})(XI||(XI={}));var qI;(function(r){r[r.NONE=0]="NONE",r[r.STICKY=1]="STICKY",r[r.SHAPE_WITH_TEXT=2]="SHAPE_WITH_TEXT",r[r.SECTION=3]="SECTION",r[r.BUG_BASH=4]="BUG_BASH",r[r.STANDUP=5]="STANDUP",r[r.DESIGN_CRIT=6]="DESIGN_CRIT",r[r.USER_JOURNEY=7]="USER_JOURNEY",r[r.MAKE_SOMETHING_BRAINSTORM=8]="MAKE_SOMETHING_BRAINSTORM",r[r.MAKE_SOMETHING_TEAM_CHART=9]="MAKE_SOMETHING_TEAM_CHART",r[r.MAKE_SOMETHING_TEAM_UPDATES=10]="MAKE_SOMETHING_TEAM_UPDATES",r[r.MAKE_SOMETHING_PLANNING=11]="MAKE_SOMETHING_PLANNING",r[r.RETRO=12]="RETRO"})(qI||(qI={}));var ZI;(function(r){r[r.BASIC=0]="BASIC",r[r.EXPANDED=1]="EXPANDED"})(ZI||(ZI={}));var JI;(function(r){r[r.DEFAULT=0]="DEFAULT",r[r.BLUE=1]="BLUE",r[r.GREEN=2]="GREEN",r[r.PURPLE=3]="PURPLE",r[r.RED=4]="RED",r[r.YELLOW=5]="YELLOW"})(JI||(JI={}));var jI;(function(r){r[r.DIAGRAM=0]="DIAGRAM",r[r.ORG_CHART=1]="ORG_CHART"})(jI||(jI={}));var $I;(function(r){r[r.HORIZONTAL=0]="HORIZONTAL",r[r.VERTICAL=1]="VERTICAL"})($I||($I={}));var e0;(function(r){r[r.DEFAULT=0]="DEFAULT",r[r.PURPLE=1]="PURPLE",r[r.BLUE=2]="BLUE",r[r.GREEN=3]="GREEN"})(e0||(e0={}));var t0;(function(r){r[r.DEFAULT=0]="DEFAULT",r[r.BLUE=1]="BLUE",r[r.GREEN=2]="GREEN",r[r.PURPLE=3]="PURPLE",r[r.RED=4]="RED",r[r.YELLOW=5]="YELLOW"})(t0||(t0={}));var r0;(function(r){r[r.V100=0]="V100",r[r.V200=1]="V200",r[r.V300=2]="V300",r[r.V400=3]="V400",r[r.V500=4]="V500",r[r.V600=5]="V600",r[r.V700=6]="V700",r[r.V800=7]="V800",r[r.V900=8]="V900",r[r.V1000=9]="V1000"})(r0||(r0={}));var n0;(function(r){r[r.SELECTION=0]="SELECTION",r[r.PENCIL_TOOL=1]="PENCIL_TOOL",r[r.SHAPE_TOOL=2]="SHAPE_TOOL",r[r.EDIT_PALETTE_MODAL=3]="EDIT_PALETTE_MODAL"})(n0||(n0={}));var o0;(function(r){r[r.ALL=0]="ALL",r[r.SECTION_STATUS_LABEL=1]="SECTION_STATUS_LABEL",r[r.SECTION_PRESET_PICKER=2]="SECTION_PRESET_PICKER",r[r.RESPONSIVE_SET_PLAY_BUTTON=3]="RESPONSIVE_SET_PLAY_BUTTON",r[r.RESPONSIVE_SET_PLUS_BUTTON=4]="RESPONSIVE_SET_PLUS_BUTTON",r[r.DAKOTA_ITEM_BUTTON=5]="DAKOTA_ITEM_BUTTON"})(o0||(o0={}));var i0;(function(r){r[r.NONE=0]="NONE",r[r.FADE=1]="FADE",r[r.SLIDE_FROM_LEFT=2]="SLIDE_FROM_LEFT",r[r.SLIDE_FROM_RIGHT=3]="SLIDE_FROM_RIGHT",r[r.SLIDE_FROM_TOP=4]="SLIDE_FROM_TOP",r[r.SLIDE_FROM_BOTTOM=5]="SLIDE_FROM_BOTTOM"})(i0||(i0={}));var a0;(function(r){r[r.X=0]="X",r[r.Y=1]="Y"})(a0||(a0={}));var s0;(function(r){r[r.LEGACY=0]="LEGACY",r[r.DEFAULT=1]="DEFAULT",r[r.MERGE_MODAL=2]="MERGE_MODAL",r[r.RECOVERY=3]="RECOVERY",r[r.MAXIMUM=4]="MAXIMUM"})(s0||(s0={}));var l0;(function(r){r[r.IMAGE=0]="IMAGE",r[r.RENDERER=1]="RENDERER",r[r.JS=2]="JS"})(l0||(l0={}));var c0;(function(r){r[r.BUFFER=0]="BUFFER"})(c0||(c0={}));var Ss;(function(r){r[r.TEXTURE=0]="TEXTURE",r[r.VERTEX_BUFFER=1]="VERTEX_BUFFER",r[r.INDEX_BUFFER=2]="INDEX_BUFFER",r[r.RENDERBUFFER=3]="RENDERBUFFER",r[r.UNIFORM_BUFFER=4]="UNIFORM_BUFFER"})(Ss||(Ss={}));var xa;(function(r){r[r.COMPRESSED=0]="COMPRESSED",r[r.BUFFER=1]="BUFFER",r[r.BITMAP=2]="BITMAP"})(xa||(xa={}));var yr;(function(r){r[r.BACKBUFFER=0]="BACKBUFFER",r[r.EYEDROPPER_BACKBUFFER_COPY=1]="EYEDROPPER_BACKBUFFER_COPY",r[r.EXPORT=2]="EXPORT",r[r.GLYPH_DATA=3]="GLYPH_DATA",r[r.GRADIENT=4]="GRADIENT",r[r.IMAGE=5]="IMAGE",r[r.OVERLAY_IMAGE=6]="OVERLAY_IMAGE",r[r.OVERLAY_NINE_GRID=7]="OVERLAY_NINE_GRID",r[r.OVERLAY_TEXT=8]="OVERLAY_TEXT",r[r.OVERLAY_TILE=9]="OVERLAY_TILE",r[r.SINGLE_PIXEL_TEXTURE=10]="SINGLE_PIXEL_TEXTURE",r[r.SWAP_CHAIN=11]="SWAP_CHAIN",r[r.TEST=12]="TEST",r[r.TILE_ATLAS=13]="TILE_ATLAS",r[r.TILE_STACK=14]="TILE_STACK"})(yr||(yr={}));var d0;(function(r){r[r.GL_VERTEX_BUFFER_FAILURE=0]="GL_VERTEX_BUFFER_FAILURE",r[r.GL_TEXTURE_FAILURE=1]="GL_TEXTURE_FAILURE",r[r.GL_RENDERBUFFER_FAILURE=2]="GL_RENDERBUFFER_FAILURE",r[r.GL_UNIFORM_BUFFER_FAILURE=3]="GL_UNIFORM_BUFFER_FAILURE",r[r.GL_INDEX_BUFFER_FAILURE=4]="GL_INDEX_BUFFER_FAILURE",r[r.WASM_FAILURE=100]="WASM_FAILURE"})(d0||(d0={}));var u0;(function(r){r[r.GENERIC=0]="GENERIC"})(u0||(u0={}));var p0;(function(r){r[r.DEFAULT=0]="DEFAULT",r[r.ALWAYS=1]="ALWAYS",r[r.NEVER=2]="NEVER"})(p0||(p0={}));var _0;(function(r){r[r.AFTER_INITIAL_JOIN_END=0]="AFTER_INITIAL_JOIN_END",r[r.AFTER_FIRST_RENDER=1]="AFTER_FIRST_RENDER",r[r.DOCUMENT_STARTED_SAVING=2]="DOCUMENT_STARTED_SAVING",r[r.DOCUMENT_FINISHED_SAVING=3]="DOCUMENT_FINISHED_SAVING"})(_0||(_0={}));var h0;(function(r){r[r.FULLSCREEN=0]="FULLSCREEN",r[r.NON_FULLSCREEN=1]="NON_FULLSCREEN"})(h0||(h0={}));var m0;(function(r){r[r.IGNORE_AUTOLAYOUT=0]="IGNORE_AUTOLAYOUT",r[r.FORCE_INSERTION=1]="FORCE_INSERTION",r[r.PREVENT_NESTING=2]="PREVENT_NESTING"})(m0||(m0={}));var f0;(function(r){r[r.NONE=0]="NONE",r[r.FAST=1]="FAST",r[r.DEFAULT=6]="DEFAULT",r[r.BEST=9]="BEST"})(f0||(f0={}));var g0;(function(r){r[r.HASHES_ONLY=0]="HASHES_ONLY",r[r.HASHES_AND_DATA=1]="HASHES_AND_DATA"})(g0||(g0={}));var A0;(function(r){r[r.HEX=0]="HEX",r[r.RGB=1]="RGB",r[r.CSS=2]="CSS",r[r.HSL=3]="HSL",r[r.HSB=4]="HSB",r[r.UIColor=5]="UIColor"})(A0||(A0={}));var S0;(function(r){r[r.NO=0]="NO",r[r.YES=1]="YES"})(S0||(S0={}));var T0;(function(r){r[r.LOCAL=0]="LOCAL",r[r.SUBSCRIBED=1]="SUBSCRIBED"})(T0||(T0={}));var E0;(function(r){r[r.NONE=0]="NONE",r[r.STATE_GROUP=1]="STATE_GROUP",r[r.STYLE=2]="STYLE",r[r.SYMBOL=3]="SYMBOL",r[r.VARIABLE=4]="VARIABLE",r[r.VARIABLE_SET=5]="VARIABLE_SET",r[r.VARIABLE_OVERRIDE=6]="VARIABLE_OVERRIDE",r[r.MODULE=7]="MODULE",r[r.RESPONSIVE_SET=8]="RESPONSIVE_SET",r[r.CONSTRAINED_TEMPLATE=9]="CONSTRAINED_TEMPLATE",r[r.CODE_LIBRARY=10]="CODE_LIBRARY",r[r.CODE_FILE=11]="CODE_FILE",r[r.CODE_COMPONENT=12]="CODE_COMPONENT",r[r.BRUSH=13]="BRUSH",r[r.MANAGED_STRING=14]="MANAGED_STRING"})(E0||(E0={}));var I0;(function(r){r[r.NORMAL=0]="NORMAL",r[r.PROGRESSIVE=1]="PROGRESSIVE"})(I0||(I0={}));var y0;(function(r){r[r.LOCAL=0]="LOCAL",r[r.GOOGLE=1]="GOOGLE",r[r.SHARED=2]="SHARED"})(y0||(y0={}));var R0;(function(r){r[r.FILL=0]="FILL",r[r.FIT=1]="FIT",r[r.STRETCH=2]="STRETCH",r[r.TILE=3]="TILE"})(R0||(R0={}));var v0;(function(r){r[r.NON_ANIMATED_ONLY=0]="NON_ANIMATED_ONLY",r[r.LOW_RES_ONLY=1]="LOW_RES_ONLY",r[r.ALL=2]="ALL"})(v0||(v0={}));var O0;(function(r){r[r.SUCCESS=0]="SUCCESS",r[r.UNSUPPORTED_MEDIA=1]="UNSUPPORTED_MEDIA",r[r.OTHER_FAILURE=2]="OTHER_FAILURE"})(O0||(O0={}));var C0;(function(r){r[r.NONE=0]="NONE",r[r.DOCUMENT=1]="DOCUMENT",r[r.CANVAS=2]="CANVAS",r[r.GROUP_DEPRECATED=3]="GROUP_DEPRECATED",r[r.FRAME=4]="FRAME",r[r.SYMBOL=5]="SYMBOL",r[r.INSTANCE=6]="INSTANCE",r[r.STICKY=7]="STICKY",r[r.SHAPE_WITH_TEXT=8]="SHAPE_WITH_TEXT",r[r.CONNECTOR=9]="CONNECTOR",r[r.CODE_BLOCK=10]="CODE_BLOCK",r[r.WIDGET=11]="WIDGET",r[r.STAMP=12]="STAMP",r[r.MEDIA=13]="MEDIA",r[r.SECTION=14]="SECTION",r[r.SECTION_OVERLAY=15]="SECTION_OVERLAY",r[r.TABLE=16]="TABLE",r[r.TABLE_CELL=17]="TABLE_CELL",r[r.SLIDE=18]="SLIDE",r[r.CANVAS_GRID=19]="CANVAS_GRID",r[r.CANVAS_ROW=20]="CANVAS_ROW",r[r.MODULE=21]="MODULE",r[r.VECTOR_OPERATION=22]="VECTOR_OPERATION",r[r.VECTOR=23]="VECTOR",r[r.HIGHLIGHT=24]="HIGHLIGHT",r[r.STAR=25]="STAR",r[r.LINE=26]="LINE",r[r.ELLIPSE=27]="ELLIPSE",r[r.RECTANGLE=28]="RECTANGLE",r[r.REGULAR_POLYGON=29]="REGULAR_POLYGON",r[r.ROUNDED_RECTANGLE=30]="ROUNDED_RECTANGLE",r[r.TEXT=31]="TEXT",r[r.SLICE=32]="SLICE",r[r.WASHI_TAPE=33]="WASHI_TAPE",r[r.VARIABLE=34]="VARIABLE",r[r.VARIABLE_SET=35]="VARIABLE_SET",r[r.ASSISTED_LAYOUT_DEPRECATED=36]="ASSISTED_LAYOUT_DEPRECATED",r[r.INTERACTIVE_SLIDE_ELEMENT=37]="INTERACTIVE_SLIDE_ELEMENT",r[r.VARIABLE_OVERRIDE=38]="VARIABLE_OVERRIDE",r[r.RESPONSIVE_SET=39]="RESPONSIVE_SET",r[r.CODE_COMPONENT=40]="CODE_COMPONENT",r[r.TEXT_PATH=41]="TEXT_PATH",r[r.CODE_INSTANCE=42]="CODE_INSTANCE",r[r.CODE_LIBRARY=43]="CODE_LIBRARY",r[r.CODE_FILE=44]="CODE_FILE",r[r.CODE_LAYER=45]="CODE_LAYER",r[r.BRUSH=46]="BRUSH",r[r.MANAGED_STRING=47]="MANAGED_STRING",r[r.TRANSFORM=48]="TRANSFORM",r[r.CMS_RICH_TEXT=49]="CMS_RICH_TEXT",r[r.REPEATER=50]="REPEATER"})(C0||(C0={}));var b0;(function(r){r[r.NONE=0]="NONE",r[r.PRESET=1]="PRESET",r[r.CUSTOM=2]="CUSTOM",r[r.PRESENTATION=3]="PRESENTATION"})(b0||(b0={}));var N0;(function(r){r[r.ALL=0]="ALL",r[r.BASE_SCREENS=1]="BASE_SCREENS",r[r.SCROLL_TO=2]="SCROLL_TO",r[r.STATES=3]="STATES",r[r.RESPONSIVE_SETS=4]="RESPONSIVE_SETS"})(N0||(N0={}));var P0;(function(r){r[r.NONE=0]="NONE",r[r.CCW_90=1]="CCW_90"})(P0||(P0={}));var F0;(function(r){r[r.TRIGGER=0]="TRIGGER",r[r.AFTER_PREVIOUS=1]="AFTER_PREVIOUS"})(F0||(F0={}));var D0;(function(r){r[r.PLAIN=0]="PLAIN",r[r.ORDERED_LIST=1]="ORDERED_LIST",r[r.UNORDERED_LIST=2]="UNORDERED_LIST",r[r.BLOCKQUOTE=3]="BLOCKQUOTE",r[r.HEADER=4]="HEADER"})(D0||(D0={}));var w0;(function(r){r[r.LTR=0]="LTR",r[r.RTL=1]="RTL"})(w0||(w0={}));var L0;(function(r){r[r.NONE=0]="NONE",r[r.SEMANTIC_WEIGHT=1]="SEMANTIC_WEIGHT",r[r.SEMANTIC_ITALIC=2]="SEMANTIC_ITALIC",r[r.TEXT_DECORATION=3]="TEXT_DECORATION",r[r.HYPERLINK=4]="HYPERLINK",r[r.TEXT_DECORATION_THICKNESS=5]="TEXT_DECORATION_THICKNESS",r[r.TEXT_UNDERLINE_OFFSET=6]="TEXT_UNDERLINE_OFFSET",r[r.TEXT_DECORATION_SKIP_INK=7]="TEXT_DECORATION_SKIP_INK",r[r.TEXT_DECORATION_FILL_PAINT_DATA=8]="TEXT_DECORATION_FILL_PAINT_DATA",r[r.TEXT_DECORATION_STYLE=9]="TEXT_DECORATION_STYLE"})(L0||(L0={}));var x0;(function(r){r[r.FIGJAM_DARK=0]="FIGJAM_DARK",r[r.DRACULA=1]="DRACULA",r[r.DUOTONE_SEA=2]="DUOTONE_SEA",r[r.DUOTONE_SPACE=3]="DUOTONE_SPACE",r[r.DUOTONE_EARTH=4]="DUOTONE_EARTH",r[r.DUOTONE_FOREST=5]="DUOTONE_FOREST",r[r.DUOTONE_LIGHT=6]="DUOTONE_LIGHT"})(x0||(x0={}));var B0;(function(r){r[r.CENTER=0]="CENTER",r[r.INSIDE=1]="INSIDE",r[r.OUTSIDE=2]="OUTSIDE"})(B0||(B0={}));var M0;(function(r){r[r.NODE_CREATED=0]="NODE_CREATED",r[r.NODE_DELETED=1]="NODE_DELETED",r[r.NODE_MOVED=2]="NODE_MOVED",r[r.NODE_RESIZED=3]="NODE_RESIZED",r[r.TEXT_SELECTION=4]="TEXT_SELECTION",r[r.TOOL=5]="TOOL",r[r.TABLE_CELL_TEXT_SELECTION=6]="TABLE_CELL_TEXT_SELECTION"})(M0||(M0={}));var G0;(function(r){r[r.NONE=0]="NONE",r[r.FIGJAM=1]="FIGJAM",r[r.VIEWER=2]="VIEWER",r[r.DESIGN=3]="DESIGN"})(G0||(G0={}));var U0;(function(r){r[r.READ=0]="READ",r[r.ELIDE=1]="ELIDE",r[r.SKIP=2]="SKIP"})(U0||(U0={}));var V0;(function(r){r[r.ELBOWED=0]="ELBOWED",r[r.STRAIGHT=1]="STRAIGHT",r[r.CURVED=2]="CURVED"})(V0||(V0={}));var k0;(function(r){r[r.SWT_CREATED=0]="SWT_CREATED",r[r.SWT_DELETED=1]="SWT_DELETED",r[r.SWT_EDITED=2]="SWT_EDITED",r[r.SWT_RESIZED=3]="SWT_RESIZED",r[r.STICKY_DELETED=4]="STICKY_DELETED",r[r.STICKY_EDITED=5]="STICKY_EDITED",r[r.STICKY_RESIZED=6]="STICKY_RESIZED"})(k0||(k0={}));var H0;(function(r){r[r.UP=0]="UP",r[r.DOWN=1]="DOWN",r[r.LEFT=2]="LEFT",r[r.RIGHT=3]="RIGHT"})(H0||(H0={}));var z0;(function(r){r[r.LIGHT=0]="LIGHT",r[r.DARK=1]="DARK"})(z0||(z0={}));var W0;(function(r){r[r.NO_THEME_COLORS=0]="NO_THEME_COLORS",r[r.NONE_AVAILABLE=1]="NONE_AVAILABLE",r[r.SWAPPED=2]="SWAPPED",r[r.NO_THEME_FOUND=3]="NO_THEME_FOUND"})(W0||(W0={}));var K0;(function(r){r[r.ON_CLICK=0]="ON_CLICK",r[r.AFTER_DELAY=1]="AFTER_DELAY"})(K0||(K0={}));var Y0;(function(r){r[r.NONE=0]="NONE",r[r.DISSOLVE=1]="DISSOLVE",r[r.SLIDE_FROM_LEFT=2]="SLIDE_FROM_LEFT",r[r.SLIDE_FROM_RIGHT=3]="SLIDE_FROM_RIGHT",r[r.SLIDE_FROM_TOP=4]="SLIDE_FROM_TOP",r[r.SLIDE_FROM_BOTTOM=5]="SLIDE_FROM_BOTTOM",r[r.PUSH_FROM_LEFT=6]="PUSH_FROM_LEFT",r[r.PUSH_FROM_RIGHT=7]="PUSH_FROM_RIGHT",r[r.PUSH_FROM_TOP=8]="PUSH_FROM_TOP",r[r.PUSH_FROM_BOTTOM=9]="PUSH_FROM_BOTTOM",r[r.MOVE_FROM_LEFT=10]="MOVE_FROM_LEFT",r[r.MOVE_FROM_RIGHT=11]="MOVE_FROM_RIGHT",r[r.MOVE_FROM_TOP=12]="MOVE_FROM_TOP",r[r.MOVE_FROM_BOTTOM=13]="MOVE_FROM_BOTTOM",r[r.SLIDE_OUT_TO_LEFT=14]="SLIDE_OUT_TO_LEFT",r[r.SLIDE_OUT_TO_RIGHT=15]="SLIDE_OUT_TO_RIGHT",r[r.SLIDE_OUT_TO_TOP=16]="SLIDE_OUT_TO_TOP",r[r.SLIDE_OUT_TO_BOTTOM=17]="SLIDE_OUT_TO_BOTTOM",r[r.MOVE_OUT_TO_LEFT=18]="MOVE_OUT_TO_LEFT",r[r.MOVE_OUT_TO_RIGHT=19]="MOVE_OUT_TO_RIGHT",r[r.MOVE_OUT_TO_TOP=20]="MOVE_OUT_TO_TOP",r[r.MOVE_OUT_TO_BOTTOM=21]="MOVE_OUT_TO_BOTTOM",r[r.SMART_ANIMATE=22]="SMART_ANIMATE"})(Y0||(Y0={}));var Q0;(function(r){r[r.EQUALS=0]="EQUALS"})(Q0||(Q0={}));var X0;(function(r){r[r.MATCH_ALL=0]="MATCH_ALL",r[r.MATCH_ANY=1]="MATCH_ANY"})(X0||(X0={}));var q0;(function(r){r[r.REPEAT=0]="REPEAT",r[r.SYMMETRY=1]="SYMMETRY"})(q0||(q0={}));var Z0;(function(r){r[r.X=0]="X",r[r.Y=1]="Y"})(Z0||(Z0={}));var J0;(function(r){r[r.LINEAR=0]="LINEAR",r[r.RADIAL=1]="RADIAL"})(J0||(J0={}));var j0;(function(r){r[r.PIXELS=0]="PIXELS",r[r.RELATIVE=1]="RELATIVE"})(j0||(j0={}));var $0;(function(r){r[r.FORWARD=0]="FORWARD",r[r.REVERSE=1]="REVERSE"})($0||($0={}));var ey;(function(r){r[r.FullscreenApp=0]="FullscreenApp",r[r.PrototypeLib=1]="PrototypeLib",r[r.InteractionTest=2]="InteractionTest"})(ey||(ey={}));var ty;(function(r){r[r.FROM=0]="FROM",r[r.TO=1]="TO"})(ty||(ty={}));var ry;(function(r){r[r.INVALID=0]="INVALID",r[r.PRIMARY_INSTANCE_BACKED_BY_SYMBOL=1]="PRIMARY_INSTANCE_BACKED_BY_SYMBOL",r[r.PRIMARY_INSTANCE_WITH_NESTED_SWAP_TO_SYMBOL=2]="PRIMARY_INSTANCE_WITH_NESTED_SWAP_TO_SYMBOL",r[r.PRIMARY_INSTANCE_WITH_TOP_LEVEL_PROP_ASSIGNMENT_TO_SYMBOL=3]="PRIMARY_INSTANCE_WITH_TOP_LEVEL_PROP_ASSIGNMENT_TO_SYMBOL",r[r.PRIMARY_INSTANCE_WITH_NESTED_PROP_ASSIGNMENT_TO_SYMBOL=4]="PRIMARY_INSTANCE_WITH_NESTED_PROP_ASSIGNMENT_TO_SYMBOL",r[r.PRODUCT_COMPONENT_WITH_PROP_DEF_TO_SYMBOL=5]="PRODUCT_COMPONENT_WITH_PROP_DEF_TO_SYMBOL",r[r.STATE_WITH_PROP_DEF_TO_SYMBOL=6]="STATE_WITH_PROP_DEF_TO_SYMBOL",r[r.SYMBOL_CONTAINING_PRIMARY_INSTANCE=7]="SYMBOL_CONTAINING_PRIMARY_INSTANCE"})(ry||(ry={}));var ny;(function(r){r[r.NONE=0]="NONE",r[r.TOO_MANY_VARIABLES_ERROR=1]="TOO_MANY_VARIABLES_ERROR",r[r.TOO_MANY_MODES_ERROR=2]="TOO_MANY_MODES_ERROR"})(ny||(ny={}));var oy;(function(r){r[r.NONE=0]="NONE",r[r.LESS_THAN_MIN_WIDTH=1]="LESS_THAN_MIN_WIDTH",r[r.LESS_THAN_MIN_HEIGHT=2]="LESS_THAN_MIN_HEIGHT",r[r.GREATER_THAN_MAX_WIDTH=3]="GREATER_THAN_MAX_WIDTH",r[r.GREATER_THAN_MAX_HEIGHT=4]="GREATER_THAN_MAX_HEIGHT",r[r.NEGATIVE=5]="NEGATIVE",r[r.NEGATIVE_OR_ZERO=6]="NEGATIVE_OR_ZERO",r[r.LESS_THAN_ONE=7]="LESS_THAN_ONE"})(oy||(oy={}));var iy;(function(r){r[r.BOOLEAN=0]="BOOLEAN",r[r.FLOAT=1]="FLOAT",r[r.STRING=2]="STRING",r[r.COLOR=3]="COLOR",r[r.MAP=4]="MAP",r[r.SYMBOL_ID=5]="SYMBOL_ID",r[r.FONT_STYLE=6]="FONT_STYLE",r[r.TEXT_DATA=7]="TEXT_DATA",r[r.IMAGE=8]="IMAGE",r[r.LINK=9]="LINK",r[r.JS_RUNTIME_ALIAS=10]="JS_RUNTIME_ALIAS",r[r.SLOT_CONTENT_ID=11]="SLOT_CONTENT_ID"})(iy||(iy={}));var ay;(function(r){r[r.BOOLEAN=0]="BOOLEAN",r[r.FLOAT=1]="FLOAT",r[r.STRING=2]="STRING",r[r.ALIAS=3]="ALIAS",r[r.COLOR=4]="COLOR",r[r.EXPRESSION=5]="EXPRESSION",r[r.MAP=6]="MAP",r[r.SYMBOL_ID=7]="SYMBOL_ID",r[r.FONT_STYLE=8]="FONT_STYLE",r[r.TEXT_DATA=9]="TEXT_DATA",r[r.INVALID=10]="INVALID",r[r.NODE_FIELD_ALIAS=11]="NODE_FIELD_ALIAS",r[r.CMS_ALIAS=12]="CMS_ALIAS",r[r.PROP_REF=13]="PROP_REF",r[r.IMAGE=14]="IMAGE",r[r.MANAGED_STRING_ALIAS=15]="MANAGED_STRING_ALIAS",r[r.LINK=16]="LINK",r[r.JS_RUNTIME_ALIAS=17]="JS_RUNTIME_ALIAS",r[r.SLOT_CONTENT_ID=18]="SLOT_CONTENT_ID"})(ay||(ay={}));var sy;(function(r){r[r.ADDITION=0]="ADDITION",r[r.SUBTRACTION=1]="SUBTRACTION",r[r.RESOLVE_VARIANT=2]="RESOLVE_VARIANT",r[r.MULTIPLY=3]="MULTIPLY",r[r.DIVIDE=4]="DIVIDE",r[r.EQUALS=5]="EQUALS",r[r.NOT_EQUAL=6]="NOT_EQUAL",r[r.LESS_THAN=7]="LESS_THAN",r[r.LESS_THAN_OR_EQUAL=8]="LESS_THAN_OR_EQUAL",r[r.GREATER_THAN=9]="GREATER_THAN",r[r.GREATER_THAN_OR_EQUAL=10]="GREATER_THAN_OR_EQUAL",r[r.AND=11]="AND",r[r.OR=12]="OR",r[r.NOT=13]="NOT",r[r.STRINGIFY=14]="STRINGIFY",r[r.TERNARY=15]="TERNARY",r[r.VAR_MODE_LOOKUP=16]="VAR_MODE_LOOKUP",r[r.NEGATE=17]="NEGATE",r[r.IS_TRUTHY=18]="IS_TRUTHY"})(sy||(sy={}));var Vu;(function(r){r[r.INTERACTION_TEST=0]="INTERACTION_TEST",r[r.VIEWER_TEST=1]="VIEWER_TEST"})(Vu||(Vu={}));var Ts;(function(r){r[r.ALLOWED=0]="ALLOWED",r[r.DISALLOWED_CYCLE=1]="DISALLOWED_CYCLE",r[r.DISALLOWED_OTHER=2]="DISALLOWED_OTHER"})(Ts||(Ts={}));var Es;(function(r){r[r.MATERIALIZE_SWAPPED_OUT_TREE=0]="MATERIALIZE_SWAPPED_OUT_TREE",r[r.SKIP_MATERIALIZATION=1]="SKIP_MATERIALIZATION"})(Es||(Es={}));var rn;(function(r){r[r.PENDING_INITIAL_LOAD=0]="PENDING_INITIAL_LOAD",r[r.PENDING_LOAD_AFTER_RECONNECT=1]="PENDING_LOAD_AFTER_RECONNECT",r[r.LOADED=2]="LOADED"})(rn||(rn={}));var ly;(function(r){r[r.NONE=0]="NONE",r[r.CONTAIN=1]="CONTAIN",r[r.SCALE_DOWN=2]="SCALE_DOWN",r[r.MIN_ZOOM=3]="MIN_ZOOM",r[r.FREE=4]="FREE",r[r.SCALE_DOWN_TO_FIT_WIDTH=5]="SCALE_DOWN_TO_FIT_WIDTH",r[r.FIT_WIDTH=6]="FIT_WIDTH",r[r.RESPONSIVE=7]="RESPONSIVE"})(ly||(ly={}));var cy;(function(r){r[r.FIXED=0]="FIXED",r[r.RESPONSIVE=1]="RESPONSIVE"})(cy||(cy={}));var dy;(function(r){r[r.MISSING_FONTS_ONLY=0]="MISSING_FONTS_ONLY",r[r.MISSING_OR_LOCAL_FONTS=1]="MISSING_OR_LOCAL_FONTS"})(dy||(dy={}));var _n;(function(r){r[r.NONE=0]="NONE",r[r.ODD_WINDING_NUMBER_COMPUTE=1]="ODD_WINDING_NUMBER_COMPUTE",r[r.NONZERO_WINDING_NUMBER_COMPUTE=2]="NONZERO_WINDING_NUMBER_COMPUTE",r[r.ODD_WINDING_NUMBER=3]="ODD_WINDING_NUMBER",r[r.ODD_WINDING_NUMBER_CLEAR=4]="ODD_WINDING_NUMBER_CLEAR",r[r.NONZERO_WINDING_NUMBER=5]="NONZERO_WINDING_NUMBER",r[r.NONZERO_WINDING_NUMBER_CLEAR=6]="NONZERO_WINDING_NUMBER_CLEAR",r[r.ODD_WINDING_NUMBER_FILL=7]="ODD_WINDING_NUMBER_FILL",r[r.NONZERO_WINDING_NUMBER_FILL=8]="NONZERO_WINDING_NUMBER_FILL",r[r.ODD_WINDING_NUMBER_STROKE=9]="ODD_WINDING_NUMBER_STROKE",r[r.NONZERO_WINDING_NUMBER_STROKE=10]="NONZERO_WINDING_NUMBER_STROKE",r[r.STROKE_INSIDE=11]="STROKE_INSIDE",r[r.STROKE_OUTSIDE=12]="STROKE_OUTSIDE",r[r.STROKE_CLEAR=13]="STROKE_CLEAR",r[r.OVERLAY_UI_COMPUTE_WINDING_NUMBER_ODD=14]="OVERLAY_UI_COMPUTE_WINDING_NUMBER_ODD",r[r.OVERLAY_UI_COMPUTE_WINDING_NUMBER_NONZERO=15]="OVERLAY_UI_COMPUTE_WINDING_NUMBER_NONZERO",r[r.OVERLAY_UI_COVER_ODD=16]="OVERLAY_UI_COVER_ODD",r[r.OVERLAY_UI_COVER_NONZERO=17]="OVERLAY_UI_COVER_NONZERO",r[r.OVERLAY_UI_COVER_EVEN=18]="OVERLAY_UI_COVER_EVEN",r[r.OVERLAY_UI_COVER_ZERO=19]="OVERLAY_UI_COVER_ZERO"})(_n||(_n={}));var uy;(function(r){r[r.TEXT=0]="TEXT",r[r.KEY_PRESS=1]="KEY_PRESS",r[r.KEY_RELEASE=2]="KEY_RELEASE",r[r.MOUSE_MOVE=3]="MOUSE_MOVE",r[r.MOUSE_ENTER=4]="MOUSE_ENTER",r[r.MOUSE_LEAVE=5]="MOUSE_LEAVE",r[r.MOUSE_PRESS=6]="MOUSE_PRESS",r[r.MOUSE_DRAG=7]="MOUSE_DRAG",r[r.MOUSE_RELEASE=8]="MOUSE_RELEASE",r[r.MOUSE_WHEEL=9]="MOUSE_WHEEL",r[r.MOUSE_DROP=10]="MOUSE_DROP",r[r.MOUSE_ROTATE=11]="MOUSE_ROTATE",r[r.MOUSE_SCALE=12]="MOUSE_SCALE",r[r.MOUSE_SCALE_END=13]="MOUSE_SCALE_END",r[r.FOCUS_GAINED=14]="FOCUS_GAINED",r[r.FOCUS_LOST=15]="FOCUS_LOST",r[r.CLIPBOARD=16]="CLIPBOARD",r[r.MOUSE_MOVE_COALESCED=17]="MOUSE_MOVE_COALESCED",r[r.MOUSE_DRAG_COALESCED=18]="MOUSE_DRAG_COALESCED",r[r.CONTEXT_MENU_OPEN=19]="CONTEXT_MENU_OPEN",r[r.MOUSE_CANCEL=20]="MOUSE_CANCEL"})(uy||(uy={}));var py;(function(r){r[r.MOUSE=0]="MOUSE",r[r.TOUCH=1]="TOUCH",r[r.STYLUS=2]="STYLUS",r[r.TRACKPAD=3]="TRACKPAD"})(py||(py={}));var _y;(function(r){r[r.CUT=0]="CUT",r[r.COPY=1]="COPY",r[r.PASTE=2]="PASTE"})(_y||(_y={}));var hy;(function(r){r[r.PREVIOUS=0]="PREVIOUS",r[r.NEXT=1]="NEXT"})(hy||(hy={}));var ku=class r{constructor(){this._isWebGL2Supported=!1;this._initializationStatus="webgl1_success";this._isWebGL2Supported=!1;let t=document.createElement("canvas").getContext("webgl2");if(!t){this._initializationStatus="webgl2_not_supported";return}let n=this.renderer(t);if(!n||/radeon/.test(n)){this._initializationStatus="webgl2_disallow_list";return}if(/swiftshader/.test(n)){let i=document.createElement("canvas").getContext("webgl"),a=this.renderer(i);if(!a||!/swiftshader/.test(a)){this._initializationStatus="webgl2_software_rendering";return}}this._initializationStatus="webgl2_success",this._isWebGL2Supported=!0}renderer(e){if(!e)return null;let t=e.getExtension("WEBGL_debug_renderer_info");return t&&(e.getParameter(t.UNMASKED_RENDERER_WEBGL)+"").toLowerCase()}static instance(){return r._instance||(r._instance=new r),r._instance}static isWebGL2Supported(){return r.instance()._isWebGL2Supported}static initializationStatus(){return r.instance()._initializationStatus}};var Ct;(P=>{function r(){return P._workerURL}P.getWorkerURL=r;function e(U){P._workerURL=U}P.setWorkerURL=e;function t(){return P._imagePrefixURL}P.getImagePrefixURL=t;function n(U){P._imagePrefixURL=U}P.setImagePrefixURL=n;function o(){return P._imageBatchURL}P.getImageBatchURL=o;function i(U){P._imageBatchURL=U}P.setImageBatchURL=i;function a(){return P._compressedTexturesAvailabilityURL}P.getCompressedTexturesAvailabilityURL=a;function s(U){P._compressedTexturesAvailabilityURL=U}P.setCompressedTexturesAvailabilityURL=s;function l(){return P._videoPrefixURL}P.getVideoPrefixUrl=l;function d(U){P._videoPrefixURL=U}P.setVideoPrefixUrl=d;function c(){return P._deviceInfoByIdentifier}P.getDeviceInfoByIdentifier=c;function p(U){P._deviceInfoByIdentifier=U}P.setDeviceInfoByIdentifier=p;function u(){return P._containerElement}P.getContainerElement=u;function _(U){P._containerElement=U}P.setContainerElement=_;function h(){return P._forceMobileOptimizations}P.forceMobileOptimizations=h;function S(){return P._shouldUseCompressedTextures}P.shouldUseCompressedTextures=S;function m(U){P._shouldUseCompressedTextures=U}P.setShouldUseCompressedTextures=m;function f(U){let B=F=>{if(!(F in U))throw new Error(`Missing required parameter '${F}'`);return U[F]},M=(F,w)=>F in U?U[F]:w;P._workerURL=B("workerURL"),P._deviceInfoByIdentifier=M("deviceInfoByIdentifier",P._deviceInfoByIdentifierDefault),P._containerElement=B("containerElement"),P._forceMobileOptimizations=M("forceMobileOptimizations",!1)}P.initialize=f,P._workerURL=null,P._imagePrefixURL=null,P._imageBatchURL=null,P._videoPrefixURL=null,P._deviceInfoByIdentifierDefault=null,P._deviceInfoByIdentifier=P._deviceInfoByIdentifierDefault,P._containerElement=null,P._forceMobileOptimizations=!1,P._shouldUseCompressedTextures=!1})(Ct||(Ct={}));var Pt;(m=>{let r;function e(f){r=f}m.initialize=e;function t(){return r!=null&&r.mac==!0}m.mac=t;function n(){return r!=null&&r.windows==!0}m.windows=n;function o(){return r!=null&&r.ios==!0}m.ios=o;function i(){return r!=null&&r.android==!0}m.android=i;function a(){return r!=null&&r.linux==!0}m.linux=a;function s(){return r!=null&&r.chrome==!0}m.chrome=s;function l(){return r!=null&&r.safari==!0}m.safari=l;function d(){return r!=null&&r.firefox==!0}m.firefox=d;function c(){return r!=null&&r.msedge==!0}m.edge=c;function p(){return r!=null&&r.msie==!0}m.msie=p;function u(f){return f==2||f==1}m.isMobile=u;function _(){return m.isMobile(m.current())||m.current()==4&&navigator.maxTouchPoints>0}m.isCurrentOSMobileOrIPad=_;function h(){return m.OS__current==0&&(m.OS__current=t()?4:n()?5:o()?2:i()?1:a()?3:0),m.OS__current}m.current=h,m.OS__current=0})(Pt||(Pt={}));var Ae;(g=>{let r;(F=>(F[F.LEGACY=0]="LEGACY",F[F.LOW=100]="LOW",F[F.MEDIUM=200]="MEDIUM",F[F.HIGH=300]="HIGH",F[F.MAX=400]="MAX",F[F.DEFAULT=100]="DEFAULT"))(r=g.ProfileLevel||(g.ProfileLevel={}));function e(R,D,P,U,B,M,F,w,V){g._internalTrackAnalyticsEvent=R,g._internalDefinedAnalyticsHandler=D,g._appTimerStart=P,g._appTimerStop=U,g._nextFrame=B,g._startProfile=M,g._stopProfile=F,g._internalLoadTimeTracker=w,g._internalSocketConnectionTracker=V}g.initialize=e;function t(R){let D=g._internalTrackAnalyticsEvent;return g._internalTrackAnalyticsEvent=R,()=>{g._internalTrackAnalyticsEvent=D}}g.mockTrackEvent=t,g.trackDefinedEvent=(R,D)=>{g._internalDefinedAnalyticsHandler!==null&&g._internalDefinedAnalyticsHandler.trackDefinedEvent(R,D)},g.trackDefinedMetric=(R,D)=>{g._internalDefinedAnalyticsHandler!==null&&g._internalDefinedAnalyticsHandler.trackDefinedMetric(R,D)};function i(R,D,P){g._internalTrackAnalyticsEvent!=null&&(0,g._internalTrackAnalyticsEvent)(R,D,P)}g.trackEvent=i;function a(R,D=0){let P=!1;return g._startProfile!=null&&(P=(0,g._startProfile)(R,D)),P&&g._appTimerStart!=null&&(0,g._appTimerStart)(R,D),P}g.appTimerStart=a;function s(R,D=0){g._stopProfile!=null&&(0,g._stopProfile)(R,D),g._appTimerStop!=null&&(0,g._appTimerStop)(R,D)}g.appTimerStop=s;function l(R,D=0,P){let U=a(R,D),B=P();return U&&s(R,D),B}g.perfTimerScope=l;function d(R){g._nextFrame!=null&&(0,g._nextFrame)(R)}g.nextFrame=d;function c(){g._internalLoadTimeTracker!==null&&g._internalLoadTimeTracker.handleMultiplayerOpenConnection()}g.handleMultiplayerOpenConnection=c;function p(){g._internalLoadTimeTracker!==null&&g._internalLoadTimeTracker.handleMultiplayerIFLSatisfied()}g.handleMultiplayerIFLSatisfied=p;function u(){g._internalLoadTimeTracker!==null&&g._internalLoadTimeTracker.handleMultiplayerFirstResponse()}g.handleMultiplayerFirstResponse=u;function _(){g._internalLoadTimeTracker!==null&&g._internalLoadTimeTracker.handleIFLCompleted()}g.handleIFLCompleted=_;function h(R){g._internalSocketConnectionTracker!==null&&g._internalSocketConnectionTracker.handleSocketDisconnect(R)}g.handleMultiplayerSocketDisconnected=h;function S(R,D,P,U){g._internalSocketConnectionTracker!==null&&(R||D>3)&&g._internalSocketConnectionTracker.handleSocketConnectionAttempt(R,D,P,U)}g.handleMultiplayerSocketConnectionAttempt=S,g._internalTrackAnalyticsEvent=null,g._internalDefinedAnalyticsHandler=null,g._internalLoadTimeTracker=null,g._internalSocketConnectionTracker=null,g._appTimerStart=null,g._appTimerStop=null,g._nextFrame=null,g._startProfile=null,g._stopProfile=null})(Ae||(Ae={}));function Oe(r){let e=typeof r=="string"?new Error(r):r;setTimeout(()=>{throw e},0)}function BN(r){let e=new Error(r);setTimeout(()=>{throw e},0)}function my(r){BN(r)}var na;(a=>{function r(s){i=s}a.initialize=r;function e(s,l,d,c){i("DEBUG",s,l,d,c)}a.logd=e;function t(s,l,d,c){i("INFO",s,l,d,c)}a.logi=t;function n(s,l,d,c){i("WARN",s,l,d,c)}a.logw=n;function o(s,l,d,c){i("ERROR",s,l,d,c)}a.loge=o;let i=()=>{}})(na||(na={}));var Mi=null,Xn=!1,hn=!1,fy=!1,oa=!1;function gy(){hn=!0}function Ay(){fy=!0}function Sy(){return hn||fy}function Gr(){return Xn||hn||oa}var Al=!0;var ia=null,Im=null,Hu,Ty=new Promise((r,e)=>{ia?r(ia):Hu=r});function xc(){return Ty}function zu(r){if(ia!=null){Oe("Attempt to initialize PrototypeLib, but PrototypeLib is already initialized");return}Ey(r),Im.setSerialization(r.appState().serialization()),oa&&r.modules().interactionTestHelpers.setIsRunningViewerRenderServer()}function N(){return ia}function Ey(r){ia=r,Hu&&Hu(r)}function Wu(){ia!=null&&ia.reset(),Ey(null),Ty=new Promise((r,e)=>{ia?r(ia):Hu=r})}function Iy(r){Im=r}function Ku(){return Im}var Y;(De=>{function r(){return Qn.getFeatureGate("viewer_cleanup_buffer_areas")}De.viewerCleanupBufferAreas=r;function e(){return _t()}De.shouldEnableVertexBufferDiscardBytesAfterUpload=e;function t(){return!_t()}De.smartAnimateCacheTransform=t;function n(){return!_t()}De.viewerICCacheOpt=n;function o(){return!_t()}De.viewerCreateVideoTriggersOpt=o;function i(){return!_t()}De.viewerLargeTilesDrawToScreen=i;function a(){return g().viewer_editor_renderer_unification??!1}De.useUnifiedRenderer=a;function s(){return g().image_reduce_invalidation_time}De.useReducedImageLoadingInvalidateDelay=s;function l(){return!_t()}De.viewerDoubleTileCompositionLimit=l;function d(){return!_t()}De.viewerScissorClear=d;function c(){return!_t()}De.enableCreateImageBitmap=c;function p(){return g().viewer_background_blur_opts}De.useBackgroundBlurOpts=p;function u(){return g().viewer_fast_stroke_shadow}De.useFastStrokeShadow=u;function _(){return g().viewer_flush_after_clear}De.shouldFlushAfterClear=_;function h(){return g().viewer_flush_after_stencil_cover}De.shouldFlushAfterStencilCover=h;function S(){return g().flush_after_draws}De.shouldFlushAfterDraws=S;function m(){return _t()}De.shouldPreventVolatileCaching=m;function f(){return ku.isWebGL2Supported()}De.shouldUseWebGL2=f;function T(){return _t()&&Qn.getFeatureGate("viewer_use_compressed_textures")}De.shouldUseCompressedTextures=T;function y(){return window.devicePixelRatio>3}De.isHighDPR=y;function E(){return g().internal_only_debug_tools}De.internalDebugTools=E;function v(){return De._shouldPlayVideosLinearly}De.shouldPlayVideosLinearly=v;function A(){return!y()}De.useSSAA=A;function I(Ot){return De._bowser.version===null||De._bowser.version===void 0?!1:De._bowser.compareVersions([De._bowser.version,Ot])>=0}De.isBrowserVersionAtLeast=I;function C(Ot){return De._bowser.osversion===null||De._bowser.osversion===void 0?!1:De._bowser.compareVersions([De._bowser.osversion,Ot])>=0}De.isOSVersionAtLeast=C;function g(){return De._featureFlags}De.getFeatureFlags=g;function R(Ot){var Mr,re;De._featureFlags=Ot,Xn?Mi.featureFlagsCppApi.updateFeatureFlags(Ot):((re=(Mr=N())==null?void 0:Mr.modules())==null?void 0:re.featureFlagsCppApi)!=null&&N().modules().featureFlagsCppApi.updateFeatureFlags(Ot),Qn.clearFeatureGatesForTesting(),Qn.setInRenderServerForViewerTests();for(let[Te,ae]of Object.entries(Ot))Qn.updateFeatureGateForTesting(Te,ae)}De.setFeatureFlags=R;function D(Ot){let Mr=Object.assign({},De._featureFlags);R(Object.assign(Mr,Ot))}De.updateFeatureFlags=D;function P(){return De._viewerMode}De.getViewerMode=P;function U(Ot){De._viewerMode=Ot}De.setViewerMode=U;function B(){return De._scrollToPan}De.getScrollToPan=B;function M(Ot){De._scrollToPan=Ot}De.setScrollToPan=M;function F(){return De._dragToPan}De.getDragToPan=F;function w(Ot){De._dragToPan=Ot}De.setDragToPan=w;function V(){return De._disableKeyboardHandling}De.disableKeyboardHandling=V;function k(){return De._gameControllerListener}De.gameControllerListener=k;function H(){return De._isInlinePreview}De.isInlinePreview=H;function z(){return De._isSlidesEmbed}De.isSlidesEmbed=z;function Q(Ot){De.protoUseFrameEvictionForUnitTests=Ot}De.setProtoUseFrameEvictionForUnitTests=Q;function K(Ot){De._shouldPlayVideosLinearly=Ot}De.setShouldPlayVideosLinearly=K;function j(){return hn?De.protoUseFrameEvictionForUnitTests:_t()}De.protoUseFrameEviction=j;function pe(Ot){let Mr=ae=>{if(!(ae in Ot))throw new Error(`Missing required parameter '${ae}'`);return Ot[ae]},re=(ae,L)=>ae in Ot?Ot[ae]:L,Te=Mr("featureFlags");R(Te),De._viewerMode=Xt.ViewerMode_create(Mr("viewerMode")),Ae.initialize(re("trackAnalyticsEvent",null),re("definedAnalyticsHandler",null),re("appTimerStart",null),re("appTimerStop",null),re("nextFrame",null),re("startProfile",null),re("stopProfile",null),re("loadTimeTracker",null),re("socketConnectionTracker",null)),na.initialize(re("logError",()=>{})),De._bowser=Mr("bowser"),Pt.initialize(De._bowser),De._scrollToPan=re("scrollToPan",De._scrollToPanDefault),De._disablePrototypeDeviceFrames=re("disablePrototypeDeviceFrames",De._disablePrototypeDeviceFramesDefault),De._disableKeyboardHandling=re("disableKeyboardHandling",De._disableKeyboardHandlingDefault),De._gameControllerListener=re("gameControllerListener",null),De._isInlinePreview=re("isInlinePreview",!1),De._isSlidesEmbed=re("isSlidesEmbed",!1),De._shouldPlayVideosLinearly=re("shouldPlayVideosLinearly",!1)}De.initialize=pe;function Pe(){return!De._disablePrototypeDeviceFrames&&De._viewerMode==1}De.deviceFramesSupported=Pe;function at(Ot){De.prototypeBackgroundColorOverride=Ot}De.setPrototypeBackgroundColorOverride=at;function Ke(){if(De._htmlImageDecodeMethodIsPresent==null){let Ot=new Image,Mr=Ot.decode!==null&&Ot.decode!==void 0;De._htmlImageDecodeMethodIsPresent=new ce(Mr)}return De._htmlImageDecodeMethodIsPresent.value}De.htmlImageDecodeMethodIsPresent=Ke;function _t(){return Pt.isMobile(Pt.current())||Pt.current()==4&&navigator.maxTouchPoints>0||Ct.forceMobileOptimizations()}De.shouldApplyMobileOptimizations=_t;let bt;(re=>(re[re.MIRROR=0]="MIRROR",re[re.PROTOTYPE=1]="PROTOTYPE"))(bt=De.ViewerMode||(De.ViewerMode={}));let Xt;(Mr=>{function Ot(re){if(typeof re=="string")switch(re){case"MIRROR":return 0;case"PROTOTYPE":return 1}throw new Error(`Invalid viewer mode: ${re}`)}Mr.ViewerMode_create=Ot})(Xt=De.in_ViewerMode||(De.in_ViewerMode={})),De._bowser=null,De._featureFlags={},De._viewerMode=1,De._scrollToPanDefault=!0,De._scrollToPan=De._scrollToPanDefault,De._dragToPanDefault=!0,De._dragToPan=De._dragToPanDefault,De._disablePrototypeDeviceFramesDefault=!1,De._disablePrototypeDeviceFrames=De._disablePrototypeDeviceFramesDefault,De._disableKeyboardHandlingDefault=!1,De._disableKeyboardHandling=De._disableKeyboardHandlingDefault,De._gameControllerListener=null,De._isInlinePreview=!1,De.protoUseFrameEvictionForUnitTests=!1,De.prototypeBackgroundColorOverride=null,De._htmlImageDecodeMethodIsPresent=null,De.forceInitiateStateChangeForTests=!1,De._isSlidesEmbed=!1,De._shouldPlayVideosLinearly=!1})(Y||(Y={}));var Rr;(a=>{function r(s,l){if(o.set(s,l),!i.has(s))i.set(s,o.get(s));else{let d=i.get(s);i.set(s,Math.max(d,l))}}a.trackNumber=r;function e(s,l){if(o.has(s)?o.set(s,o.get(s)+l):o.set(s,l),!i.has(s))i.set(s,o.get(s));else{let d=i.get(s);i.set(s,Math.max(d,o.get(s)))}return o.get(s)}a.increment=e;function t(s){return i.has(s)?i.get(s):0}a.getMax=t;function n(){let s=window.performance.memory;s&&s.jsHeapSizeLimit&&s.usedJSHeapSize&&(r("JS Heap size (MB)",s.jsHeapSizeLimit/(1024*1024)|0),r("Used Heap size (MB)",s.usedJSHeapSize/(1024*1024)|0));let l={};for(let d of Array.from(o.keys())){let c=o.get(d);l[d]=Math.round(c*100)/100}return l}a.getStatsForDebugging=n;let o=new Map,i=new Map})(Rr||(Rr={}));var Pr=class r{constructor(){this.GLSLX_NAME_U_TYPE="uType";this.GLSLX_NAME_U_SHAPE_TYPE="uShapeType";this.GLSLX_NAME_U_ELLIPSE_CENTER="uEllipseCenter";this.GLSLX_NAME_U_ELLIPSE_RADII="uEllipseRadii";this.GLSLX_NAME_U_RECT="uRect";this.GLSLX_NAME_U_CORNER_RADII="uCornerRadii";this.GLSLX_NAME_U_OPACITY="uOpacity";this.GLSLX_NAME_TEXTURE0="texture0";this.GLSLX_NAME_U_EMULATE_WRAP_ADDRESS="uEmulateWrapAddress";this.GLSLX_NAME_U_EMULATE_BORDER_ADDRESS="uEmulateBorderAddress";this.GLSLX_NAME_U_GLOBAL_TINT="uGlobalTint";this.GLSLX_NAME_U_GLOBAL_COLOR="uGlobalColor";this.GLSLX_NAME_U_GLOBAL_SHADOWS="uGlobalShadows";this.GLSLX_NAME_U_GLOBAL_HIGHLIGHTS="uGlobalHighlights";this.GLSLX_NAME_U_GLOBAL_EXPOSURE="uGlobalExposure";this.GLSLX_NAME_U_GLOBAL_TEMPERATURE="uGlobalTemperature";this.GLSLX_NAME_U_GLOBAL_CONTRAST="uGlobalContrast";this.GLSLX_NAME_U_PROGRESS="uProgress";this.GLSLX_NAME_TEXTURE1="texture1";this.GLSLX_NAME_U_PATH_SIZE="uPathSize";this.GLSLX_NAME_U_PIXEL_RATIO="uPixelRatio";this.GLSLX_NAME_U_PAINT_TRANSFORM0="uPaintTransform0";this.GLSLX_NAME_U_UV_SCALE="uUvScale";this.GLSLX_NAME_U_VERTEX_TRANSFORM="uVertexTransform";this.GLSLX_NAME_A_POSITION2="aPosition2";this.GLSLX_NAME_U_COLOR="uColor";this.GLSLX_NAME_U_PAINT_TRANSFORM1="uPaintTransform1";this.GLSLX_NAME_U_COUNT="uCount";this.GLSLX_NAME_U_BLUR_DELTA="uBlurDelta";this.GLSLX_NAME_U_BLUR_CLAMP="uBlurClamp";this.GLSLX_NAME_U_QUAD="uQuad";this.GLSLX_NAME_U_SOURCE="uSource";this.GLSLX_NAME_U_UV_SPACE_CLAMPING_RECT="uUvSpaceClampingRect";this.GLSLX_NAME_U_UV_SPACE_SOURCE_RECT="uUvSpaceSourceRect";this.GLSLX_NAME_U_TO_CLIP_SPACE_TRANSFORM="uToClipSpaceTransform";this.GLSLX_NAME_U_DESTINATION_RECT="uDestinationRect";this.GLSLX_NAME_U_TEXTURE_SIZE="uTextureSize";this.GLSLX_NAME_U_TEXTURE_PX="uTexturePx";this.GLSLX_NAME_TEXTURE0_UV_SPACE_SCISSOR="texture0UvSpaceScissor";this.GLSLX_NAME_TEXTURE1_UV_SPACE_SCISSOR="texture1UvSpaceScissor";this.GLSLX_NAME_A_COORD3="aCoord3";this.GLSLX_NAME_TEXTURE2="texture2";this.GLSLX_NAME_U_BLUR_RADIUS="uBlurRadius";this.GLSLX_NAME_A_POSITION4="aPosition4";this.GLSLX_NAME_U_HOTSPOT_OPACITY="uHotspotOpacity";this.GLSLX_NAME_U_STROKE_PROPORTION="uStrokeProportion";this.GLSLX_NAME_U_UV_HOTSPOT_CLIPPING_RECT="uUvHotspotClippingRect";this.GLSLX_NAME_U_HALF_SIZE_OVER_BLUR_RADIUS="uHalfSizeOverBlurRadius";this.GLSLX_NAME_U_CORNER_RADIUS_OVER_BLUR_RADIUS="uCornerRadiusOverBlurRadius";this.GLSLX_NAME_A_COORD4="aCoord4";Y.shouldUseWebGL2()?(this.GLSLX_SOURCE_AAA_SHAPE_GRADIENT_FRAGMENT=`#version 300 es
precision highp float;uniform int uType;const float PI = 3.141592;vec2 _gradientCoord(in vec2 paintUV) {const int LINEAR = 1;const int RADIAL = 2;const int ANGULAR = 3;const int DIAMOND = 4;vec2 uv = paintUV - 0.5;float t = uType == LINEAR    ? uv.x + 0.5: uType == RADIAL  ? 2.0 * length(uv): uType == ANGULAR ? fract(atan(uv.y, uv.x) / (2.0 * PI)): uType == DIAMOND ? 2.0 * max(abs(uv.x + uv.y), abs(uv.y - uv.x)): 0.0;return vec2(t, 0.25 + (0.75 - 0.25) / 256.0);}const float DITHER_FACTOR = 0.003922;const float DITHER_RANGE = 2.0 * DITHER_FACTOR;float random() {vec2 coordCopy = gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898, 78.233), coordCopy)) * 43758.5453);}vec4 ditherColor(vec4 color) {float offset = (random() - 0.5) * DITHER_RANGE; return color.a > 0.0 ? min(abs(color + offset), 1.0) : color;}const int SHAPE_TYPE_ELLIPSE = 0;const int SHAPE_TYPE_ROUNDED_RECT = 1;uniform int uShapeType;uniform vec2 uEllipseCenter;uniform vec2 uEllipseRadii;uniform vec4 uRect;uniform vec4 uCornerRadii;float ellipseImplicitEquation(in vec2 nodeSpacePoint, in vec2 ellipseCenter,in vec2 ellipseRadii) {nodeSpacePoint -= ellipseCenter;return ((nodeSpacePoint.x * nodeSpacePoint.x) /(ellipseRadii.x * ellipseRadii.x) +(nodeSpacePoint.y * nodeSpacePoint.y) /(ellipseRadii.y * ellipseRadii.y) -1.);}float roundedRectImplicitEquation(in vec2 nodeSpacePoint, in vec4 bounds,vec4 cornerRadii) {vec2 quadrantSize = (bounds.zw - bounds.xy) / 2.;vec2 ptRelativeToBoxCenter = nodeSpacePoint - quadrantSize;vec2 radiiInBoxHalf =ptRelativeToBoxCenter.x > 0. ? cornerRadii.zy : cornerRadii.wx;float radiusInBoxQuadrant =ptRelativeToBoxCenter.y > 0. ? radiiInBoxHalf.x : radiiInBoxHalf.y;vec2 q = abs(ptRelativeToBoxCenter) - quadrantSize + radiusInBoxQuadrant;return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - radiusInBoxQuadrant;}float shapeImplicitEquation(in vec2 nodeSpacePoint) {if (uShapeType == SHAPE_TYPE_ELLIPSE) {return ellipseImplicitEquation(nodeSpacePoint, uEllipseCenter,uEllipseRadii);} else if (uShapeType == SHAPE_TYPE_ROUNDED_RECT) {return roundedRectImplicitEquation(nodeSpacePoint, uRect, uCornerRadii);}return 0.;}float pixelShapeCoverage(vec2 nodeSpacePoint) {float eqValue = shapeImplicitEquation(nodeSpacePoint);float gradientLengthApprox = fwidth(eqValue);gradientLengthApprox = max(gradientLengthApprox, 0.00001);float distance = eqValue / gradientLengthApprox;return 1.0 - smoothstep(-0.5, 0.5, distance);}uniform float uOpacity;uniform sampler2D texture0;in vec2 vNodeSpacePoint;in vec2 vGradientSampleUV;out vec4 fig_FragColor;void main() {float coverageAlpha = pixelShapeCoverage(vNodeSpacePoint);vec2 coord = _gradientCoord(vGradientSampleUV);fig_FragColor =ditherColor(texture(texture0, coord) * uOpacity) * coverageAlpha;}`,this.GLSLX_SOURCE_AAA_SHAPE_IMAGE_FRAGMENT=`#version 300 es
precision highp float;const int SHAPE_TYPE_ELLIPSE = 0;const int SHAPE_TYPE_ROUNDED_RECT = 1;uniform int uShapeType;uniform vec2 uEllipseCenter;uniform vec2 uEllipseRadii;uniform vec4 uRect;uniform vec4 uCornerRadii;float ellipseImplicitEquation(in vec2 nodeSpacePoint, in vec2 ellipseCenter,in vec2 ellipseRadii) {nodeSpacePoint -= ellipseCenter;return ((nodeSpacePoint.x * nodeSpacePoint.x) /(ellipseRadii.x * ellipseRadii.x) +(nodeSpacePoint.y * nodeSpacePoint.y) /(ellipseRadii.y * ellipseRadii.y) -1.);}float roundedRectImplicitEquation(in vec2 nodeSpacePoint, in vec4 bounds,vec4 cornerRadii) {vec2 quadrantSize = (bounds.zw - bounds.xy) / 2.;vec2 ptRelativeToBoxCenter = nodeSpacePoint - quadrantSize;vec2 radiiInBoxHalf =ptRelativeToBoxCenter.x > 0. ? cornerRadii.zy : cornerRadii.wx;float radiusInBoxQuadrant =ptRelativeToBoxCenter.y > 0. ? radiiInBoxHalf.x : radiiInBoxHalf.y;vec2 q = abs(ptRelativeToBoxCenter) - quadrantSize + radiusInBoxQuadrant;return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - radiusInBoxQuadrant;}float shapeImplicitEquation(in vec2 nodeSpacePoint) {if (uShapeType == SHAPE_TYPE_ELLIPSE) {return ellipseImplicitEquation(nodeSpacePoint, uEllipseCenter,uEllipseRadii);} else if (uShapeType == SHAPE_TYPE_ROUNDED_RECT) {return roundedRectImplicitEquation(nodeSpacePoint, uRect, uCornerRadii);}return 0.;}float pixelShapeCoverage(vec2 nodeSpacePoint) {float eqValue = shapeImplicitEquation(nodeSpacePoint);float gradientLengthApprox = fwidth(eqValue);gradientLengthApprox = max(gradientLengthApprox, 0.00001);float distance = eqValue / gradientLengthApprox;return 1.0 - smoothstep(-0.5, 0.5, distance);}const vec2 AA_JITTER_PATTERN_1 = vec2(-3, -5);const vec2 AA_JITTER_PATTERN_2 = vec2(5, 1);const vec2 AA_JITTER_PATTERN_3 = vec2(-1, 3);const vec2 AA_JITTER_PATTERN_4 = vec2(7, -7);const vec2 AA_JITTER_PATTERN_5 = vec2(1, -3);const vec2 AA_JITTER_PATTERN_6 = vec2(-5, 5);const vec2 AA_JITTER_PATTERN_7 = vec2(3, 7);const vec2 AA_JITTER_PATTERN_8 = vec2(-7, -1);uniform int uEmulateWrapAddress;uniform int uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (bool(uEmulateWrapAddress)) {coord = fract(coord);}vec4 color = texture(tex, coord);if (bool(uEmulateBorderAddress) && coord != clamp(coord, 0.0, 1.0))color.a = 0.0;return color;}uniform sampler2D texture0;in vec2 vPaintASample;in vec2 vStepA;vec4 sampleImagePaintAWithMSAA() {return (sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_1 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_2 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_3 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_4 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_5 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_6 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_7 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_8 * vStepA)) /8.;}uniform float uOpacity;in vec2 vNodeSpacePoint;out vec4 fig_FragColor;void main() {vec4 color = sampleImagePaintAWithMSAA();color.rgb *= color.a;fig_FragColor = color * uOpacity * pixelShapeCoverage(vNodeSpacePoint);}`,this.GLSLX_SOURCE_AAA_SHAPE_IMAGE_COLOR_ADJUST_FRAGMENT=`#version 300 es
precision highp float;const vec3 RGB2Y = vec3(0.2126, 0.7152, 0.0722);const float IMAGE_HIGHLIGHT_SHADOW_THRESHOLD = 0.5;uniform float uGlobalTint;uniform float uGlobalColor;uniform float uGlobalShadows;uniform float uGlobalHighlights;uniform float uGlobalExposure;uniform float uGlobalTemperature;uniform float uGlobalContrast;vec3 colorToLinear(vec3 color) {color = pow(color, vec3(2.2));return color;}vec3 colorFromLinear(vec3 color) {color = pow(color, vec3(1.0 / 2.2));return color;}float rangeFactor(vec3 color, float shadows, float highlights) {float lThreshold =dot(color, RGB2Y) - pow(IMAGE_HIGHLIGHT_SHADOW_THRESHOLD, 2.2);return 0.75 * lThreshold / sqrt(1.0 + 4.0 * lThreshold * lThreshold) *(lThreshold > 0.0 ? highlights : -shadows * 0.999);}vec3 adjustExposure(vec3 color, float exposureAdjust) {float lFactor = pow(10.0, 2.0 * exposureAdjust) - 1.0;const float lSqueeze = 0.75;float lUnsqueeze = 1.0 / (1.0 - lSqueeze) - 1.0;float gray = dot(color, RGB2Y);lUnsqueeze *= 1.0 + gray * gray * min(0.0, exposureAdjust) /(0.2 - min(0.0, exposureAdjust));color += (gray - color) * lSqueeze;if (exposureAdjust < 0.0) {color *= 1.0 + exposureAdjust / 16.0;gray *= 1.0 + exposureAdjust / 16.0;}color *= (lFactor + 1.0) / (color * lFactor + 1.0);gray *= (lFactor + 1.0) / (gray * lFactor + 1.0);color += (color - gray) * lUnsqueeze;color = clamp(color, 0.0, 1.0);return color;}vec3 adjustColor(vec3 color, float colorAdjust) {float gray = dot(color, RGB2Y);if (colorAdjust <= 0.0) {color -= (gray - color) * colorAdjust;} else {float lNeg = gray / (gray - min(min(color.r, color.g), color.b) + 1e-6);float lPos =(1.0 - gray) / (max(max(color.r, color.g), color.b) - gray + 1e-6);float lFactor = mix(1.0, min(lNeg, lPos), colorAdjust);lFactor =min(lFactor,2.0); color += (gray - color) * (1.0 - lFactor);}return color;}float smootherstep(float edge0, float edge1, float x) {x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);}vec3 adjustTempTintContrast(vec3 color, float temp, float tint,float contrast) {vec3 lXYZ = mat3(0.4124564, 0.2126729, 0.0193339, 0.3575761, 0.7151522,0.1191920, 0.1804375, 0.0721750, 0.9503041) *color;lXYZ.x /= 0.95047;lXYZ.z /= 1.08883;lXYZ = pow(lXYZ, vec3(1.0 / 3.0));vec3 lLAB = vec3(116.0 * lXYZ.y - 16.0, 500.0 * (lXYZ.x - lXYZ.y),200.0 * (lXYZ.y - lXYZ.z));lLAB.y += 30.0 * tint;lLAB.z += 30.0 * temp;float scaledThreshold = IMAGE_HIGHLIGHT_SHADOW_THRESHOLD * 100.0;float thresholdDelta = 30.0;float contrastLeftCurve =contrast < 0.0 ? (lLAB.x - scaledThreshold) * 0.2 + 50.0 : lLAB.x;float contrastRightCurve =contrast < 0.0 ? lLAB.x: smootherstep(scaledThreshold - thresholdDelta,scaledThreshold + thresholdDelta, lLAB.x) *100.0;float interp = contrast < 0.0 ? contrast + 1.0 : contrast;lLAB.x = mix(contrastLeftCurve, contrastRightCurve, interp);lXYZ.y = (lLAB.x + 16.0) / 116.0;lXYZ.x = lLAB.y / 500.0 + lXYZ.y;lXYZ.z = lXYZ.y - lLAB.z / 200.0;lXYZ *= lXYZ * lXYZ;lXYZ.x *= 0.95047;lXYZ.z *= 1.08883;color = mat3(3.2404542, -0.9692660, 0.0556434, -1.5371385, 1.8760108,-0.2040259, -0.4985314, 0.0415560, 1.0572252) *lXYZ;color = clamp(color, 0.0, 1.0);return color;}vec3 pipeline(vec3 color) {color = colorToLinear(color);float originalRangeFactor =rangeFactor(color, uGlobalShadows, uGlobalHighlights);color = adjustTempTintContrast(color, uGlobalTemperature, uGlobalTint,uGlobalContrast);color = adjustExposure(color, uGlobalExposure + originalRangeFactor);color = adjustColor(color, clamp(uGlobalColor, -1.0, 1.0));color = colorFromLinear(color);return color;}const int SHAPE_TYPE_ELLIPSE = 0;const int SHAPE_TYPE_ROUNDED_RECT = 1;uniform int uShapeType;uniform vec2 uEllipseCenter;uniform vec2 uEllipseRadii;uniform vec4 uRect;uniform vec4 uCornerRadii;float ellipseImplicitEquation(in vec2 nodeSpacePoint, in vec2 ellipseCenter,in vec2 ellipseRadii) {nodeSpacePoint -= ellipseCenter;return ((nodeSpacePoint.x * nodeSpacePoint.x) /(ellipseRadii.x * ellipseRadii.x) +(nodeSpacePoint.y * nodeSpacePoint.y) /(ellipseRadii.y * ellipseRadii.y) -1.);}float roundedRectImplicitEquation(in vec2 nodeSpacePoint, in vec4 bounds,vec4 cornerRadii) {vec2 quadrantSize = (bounds.zw - bounds.xy) / 2.;vec2 ptRelativeToBoxCenter = nodeSpacePoint - quadrantSize;vec2 radiiInBoxHalf =ptRelativeToBoxCenter.x > 0. ? cornerRadii.zy : cornerRadii.wx;float radiusInBoxQuadrant =ptRelativeToBoxCenter.y > 0. ? radiiInBoxHalf.x : radiiInBoxHalf.y;vec2 q = abs(ptRelativeToBoxCenter) - quadrantSize + radiusInBoxQuadrant;return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - radiusInBoxQuadrant;}float shapeImplicitEquation(in vec2 nodeSpacePoint) {if (uShapeType == SHAPE_TYPE_ELLIPSE) {return ellipseImplicitEquation(nodeSpacePoint, uEllipseCenter,uEllipseRadii);} else if (uShapeType == SHAPE_TYPE_ROUNDED_RECT) {return roundedRectImplicitEquation(nodeSpacePoint, uRect, uCornerRadii);}return 0.;}float pixelShapeCoverage(vec2 nodeSpacePoint) {float eqValue = shapeImplicitEquation(nodeSpacePoint);float gradientLengthApprox = fwidth(eqValue);gradientLengthApprox = max(gradientLengthApprox, 0.00001);float distance = eqValue / gradientLengthApprox;return 1.0 - smoothstep(-0.5, 0.5, distance);}const vec2 AA_JITTER_PATTERN_1 = vec2(-3, -5);const vec2 AA_JITTER_PATTERN_2 = vec2(5, 1);const vec2 AA_JITTER_PATTERN_3 = vec2(-1, 3);const vec2 AA_JITTER_PATTERN_4 = vec2(7, -7);const vec2 AA_JITTER_PATTERN_5 = vec2(1, -3);const vec2 AA_JITTER_PATTERN_6 = vec2(-5, 5);const vec2 AA_JITTER_PATTERN_7 = vec2(3, 7);const vec2 AA_JITTER_PATTERN_8 = vec2(-7, -1);uniform int uEmulateWrapAddress;uniform int uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (bool(uEmulateWrapAddress)) {coord = fract(coord);}vec4 color = texture(tex, coord);if (bool(uEmulateBorderAddress) && coord != clamp(coord, 0.0, 1.0))color.a = 0.0;return color;}uniform sampler2D texture0;in vec2 vPaintASample;in vec2 vStepA;vec4 sampleImagePaintAWithMSAA() {return (sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_1 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_2 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_3 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_4 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_5 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_6 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_7 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_8 * vStepA)) /8.;}uniform float uOpacity;in vec2 vNodeSpacePoint;out vec4 fig_FragColor;void main() {vec4 color = sampleImagePaintAWithMSAA();color.rgb = pipeline(color.rgb) * color.a;fig_FragColor = color * uOpacity * pixelShapeCoverage(vNodeSpacePoint);}`,this.GLSLX_SOURCE_AAA_SHAPE_LERP_GRADIENT_FRAGMENT=`#version 300 es
precision highp float;uniform int uType;const float PI = 3.141592;vec2 _gradientCoord(in vec2 paintUV) {const int LINEAR = 1;const int RADIAL = 2;const int ANGULAR = 3;const int DIAMOND = 4;vec2 uv = paintUV - 0.5;float t = uType == LINEAR    ? uv.x + 0.5: uType == RADIAL  ? 2.0 * length(uv): uType == ANGULAR ? fract(atan(uv.y, uv.x) / (2.0 * PI)): uType == DIAMOND ? 2.0 * max(abs(uv.x + uv.y), abs(uv.y - uv.x)): 0.0;return vec2(t, 0.25 + (0.75 - 0.25) / 256.0);}const float DITHER_FACTOR = 0.003922;const float DITHER_RANGE = 2.0 * DITHER_FACTOR;float random() {vec2 coordCopy = gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898, 78.233), coordCopy)) * 43758.5453);}vec4 ditherColor(vec4 color) {float offset = (random() - 0.5) * DITHER_RANGE; return color.a > 0.0 ? min(abs(color + offset), 1.0) : color;}const int SHAPE_TYPE_ELLIPSE = 0;const int SHAPE_TYPE_ROUNDED_RECT = 1;uniform int uShapeType;uniform vec2 uEllipseCenter;uniform vec2 uEllipseRadii;uniform vec4 uRect;uniform vec4 uCornerRadii;float ellipseImplicitEquation(in vec2 nodeSpacePoint, in vec2 ellipseCenter,in vec2 ellipseRadii) {nodeSpacePoint -= ellipseCenter;return ((nodeSpacePoint.x * nodeSpacePoint.x) /(ellipseRadii.x * ellipseRadii.x) +(nodeSpacePoint.y * nodeSpacePoint.y) /(ellipseRadii.y * ellipseRadii.y) -1.);}float roundedRectImplicitEquation(in vec2 nodeSpacePoint, in vec4 bounds,vec4 cornerRadii) {vec2 quadrantSize = (bounds.zw - bounds.xy) / 2.;vec2 ptRelativeToBoxCenter = nodeSpacePoint - quadrantSize;vec2 radiiInBoxHalf =ptRelativeToBoxCenter.x > 0. ? cornerRadii.zy : cornerRadii.wx;float radiusInBoxQuadrant =ptRelativeToBoxCenter.y > 0. ? radiiInBoxHalf.x : radiiInBoxHalf.y;vec2 q = abs(ptRelativeToBoxCenter) - quadrantSize + radiusInBoxQuadrant;return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - radiusInBoxQuadrant;}float shapeImplicitEquation(in vec2 nodeSpacePoint) {if (uShapeType == SHAPE_TYPE_ELLIPSE) {return ellipseImplicitEquation(nodeSpacePoint, uEllipseCenter,uEllipseRadii);} else if (uShapeType == SHAPE_TYPE_ROUNDED_RECT) {return roundedRectImplicitEquation(nodeSpacePoint, uRect, uCornerRadii);}return 0.;}float pixelShapeCoverage(vec2 nodeSpacePoint) {float eqValue = shapeImplicitEquation(nodeSpacePoint);float gradientLengthApprox = fwidth(eqValue);gradientLengthApprox = max(gradientLengthApprox, 0.00001);float distance = eqValue / gradientLengthApprox;return 1.0 - smoothstep(-0.5, 0.5, distance);}uniform float uOpacity;uniform float uProgress;uniform sampler2D texture0;uniform sampler2D texture1;in vec2 vNodeSpacePoint;in vec2 vGradientSampleUV;out vec4 fig_FragColor;void main() {float coverageAlpha = pixelShapeCoverage(vNodeSpacePoint);vec2 coord = _gradientCoord(vGradientSampleUV);vec4 lerped =mix(texture(texture0, coord), texture(texture1, coord), uProgress);fig_FragColor = ditherColor(lerped * uOpacity) * coverageAlpha;}`,this.GLSLX_SOURCE_AAA_SHAPE_LERP_IMAGE_FRAGMENT=`#version 300 es
precision highp float;const int SHAPE_TYPE_ELLIPSE = 0;const int SHAPE_TYPE_ROUNDED_RECT = 1;uniform int uShapeType;uniform vec2 uEllipseCenter;uniform vec2 uEllipseRadii;uniform vec4 uRect;uniform vec4 uCornerRadii;float ellipseImplicitEquation(in vec2 nodeSpacePoint, in vec2 ellipseCenter,in vec2 ellipseRadii) {nodeSpacePoint -= ellipseCenter;return ((nodeSpacePoint.x * nodeSpacePoint.x) /(ellipseRadii.x * ellipseRadii.x) +(nodeSpacePoint.y * nodeSpacePoint.y) /(ellipseRadii.y * ellipseRadii.y) -1.);}float roundedRectImplicitEquation(in vec2 nodeSpacePoint, in vec4 bounds,vec4 cornerRadii) {vec2 quadrantSize = (bounds.zw - bounds.xy) / 2.;vec2 ptRelativeToBoxCenter = nodeSpacePoint - quadrantSize;vec2 radiiInBoxHalf =ptRelativeToBoxCenter.x > 0. ? cornerRadii.zy : cornerRadii.wx;float radiusInBoxQuadrant =ptRelativeToBoxCenter.y > 0. ? radiiInBoxHalf.x : radiiInBoxHalf.y;vec2 q = abs(ptRelativeToBoxCenter) - quadrantSize + radiusInBoxQuadrant;return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - radiusInBoxQuadrant;}float shapeImplicitEquation(in vec2 nodeSpacePoint) {if (uShapeType == SHAPE_TYPE_ELLIPSE) {return ellipseImplicitEquation(nodeSpacePoint, uEllipseCenter,uEllipseRadii);} else if (uShapeType == SHAPE_TYPE_ROUNDED_RECT) {return roundedRectImplicitEquation(nodeSpacePoint, uRect, uCornerRadii);}return 0.;}float pixelShapeCoverage(vec2 nodeSpacePoint) {float eqValue = shapeImplicitEquation(nodeSpacePoint);float gradientLengthApprox = fwidth(eqValue);gradientLengthApprox = max(gradientLengthApprox, 0.00001);float distance = eqValue / gradientLengthApprox;return 1.0 - smoothstep(-0.5, 0.5, distance);}const vec2 AA_JITTER_PATTERN_1 = vec2(-3, -5);const vec2 AA_JITTER_PATTERN_2 = vec2(5, 1);const vec2 AA_JITTER_PATTERN_3 = vec2(-1, 3);const vec2 AA_JITTER_PATTERN_4 = vec2(7, -7);const vec2 AA_JITTER_PATTERN_5 = vec2(1, -3);const vec2 AA_JITTER_PATTERN_6 = vec2(-5, 5);const vec2 AA_JITTER_PATTERN_7 = vec2(3, 7);const vec2 AA_JITTER_PATTERN_8 = vec2(-7, -1);uniform int uEmulateWrapAddress;uniform int uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (bool(uEmulateWrapAddress)) {coord = fract(coord);}vec4 color = texture(tex, coord);if (bool(uEmulateBorderAddress) && coord != clamp(coord, 0.0, 1.0))color.a = 0.0;return color;}uniform sampler2D texture0;in vec2 vPaintASample;in vec2 vStepA;vec4 sampleImagePaintAWithMSAA() {return (sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_1 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_2 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_3 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_4 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_5 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_6 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_7 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_8 * vStepA)) /8.;}uniform sampler2D texture1;in vec2 vPaintBSample;in vec2 vStepB;vec4 sampleImagePaintBWithMSAA() {return (sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_1 * vStepB) +sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_2 * vStepB) +sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_3 * vStepB) +sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_4 * vStepB) +sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_5 * vStepB) +sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_6 * vStepB) +sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_7 * vStepB) +sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_8 * vStepB)) /8.;}uniform float uOpacity;uniform float uProgress;in vec2 vNodeSpacePoint;out vec4 fig_FragColor;void main() {vec4 imageA = sampleImagePaintAWithMSAA();vec4 imageB = sampleImagePaintBWithMSAA();vec4 lerped = mix(imageA, imageB, uProgress);lerped.rgb *= lerped.a;fig_FragColor = lerped * uOpacity * pixelShapeCoverage(vNodeSpacePoint);}`,this.GLSLX_SOURCE_AAA_SHAPE_LERP_IMAGE_COLOR_ADJUST_FRAGMENT=`#version 300 es
precision highp float;const vec3 RGB2Y = vec3(0.2126, 0.7152, 0.0722);const float IMAGE_HIGHLIGHT_SHADOW_THRESHOLD = 0.5;uniform float uGlobalTint;uniform float uGlobalColor;uniform float uGlobalShadows;uniform float uGlobalHighlights;uniform float uGlobalExposure;uniform float uGlobalTemperature;uniform float uGlobalContrast;vec3 colorToLinear(vec3 color) {color = pow(color, vec3(2.2));return color;}vec3 colorFromLinear(vec3 color) {color = pow(color, vec3(1.0 / 2.2));return color;}float rangeFactor(vec3 color, float shadows, float highlights) {float lThreshold =dot(color, RGB2Y) - pow(IMAGE_HIGHLIGHT_SHADOW_THRESHOLD, 2.2);return 0.75 * lThreshold / sqrt(1.0 + 4.0 * lThreshold * lThreshold) *(lThreshold > 0.0 ? highlights : -shadows * 0.999);}vec3 adjustExposure(vec3 color, float exposureAdjust) {float lFactor = pow(10.0, 2.0 * exposureAdjust) - 1.0;const float lSqueeze = 0.75;float lUnsqueeze = 1.0 / (1.0 - lSqueeze) - 1.0;float gray = dot(color, RGB2Y);lUnsqueeze *= 1.0 + gray * gray * min(0.0, exposureAdjust) /(0.2 - min(0.0, exposureAdjust));color += (gray - color) * lSqueeze;if (exposureAdjust < 0.0) {color *= 1.0 + exposureAdjust / 16.0;gray *= 1.0 + exposureAdjust / 16.0;}color *= (lFactor + 1.0) / (color * lFactor + 1.0);gray *= (lFactor + 1.0) / (gray * lFactor + 1.0);color += (color - gray) * lUnsqueeze;color = clamp(color, 0.0, 1.0);return color;}vec3 adjustColor(vec3 color, float colorAdjust) {float gray = dot(color, RGB2Y);if (colorAdjust <= 0.0) {color -= (gray - color) * colorAdjust;} else {float lNeg = gray / (gray - min(min(color.r, color.g), color.b) + 1e-6);float lPos =(1.0 - gray) / (max(max(color.r, color.g), color.b) - gray + 1e-6);float lFactor = mix(1.0, min(lNeg, lPos), colorAdjust);lFactor =min(lFactor,2.0); color += (gray - color) * (1.0 - lFactor);}return color;}float smootherstep(float edge0, float edge1, float x) {x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);}vec3 adjustTempTintContrast(vec3 color, float temp, float tint,float contrast) {vec3 lXYZ = mat3(0.4124564, 0.2126729, 0.0193339, 0.3575761, 0.7151522,0.1191920, 0.1804375, 0.0721750, 0.9503041) *color;lXYZ.x /= 0.95047;lXYZ.z /= 1.08883;lXYZ = pow(lXYZ, vec3(1.0 / 3.0));vec3 lLAB = vec3(116.0 * lXYZ.y - 16.0, 500.0 * (lXYZ.x - lXYZ.y),200.0 * (lXYZ.y - lXYZ.z));lLAB.y += 30.0 * tint;lLAB.z += 30.0 * temp;float scaledThreshold = IMAGE_HIGHLIGHT_SHADOW_THRESHOLD * 100.0;float thresholdDelta = 30.0;float contrastLeftCurve =contrast < 0.0 ? (lLAB.x - scaledThreshold) * 0.2 + 50.0 : lLAB.x;float contrastRightCurve =contrast < 0.0 ? lLAB.x: smootherstep(scaledThreshold - thresholdDelta,scaledThreshold + thresholdDelta, lLAB.x) *100.0;float interp = contrast < 0.0 ? contrast + 1.0 : contrast;lLAB.x = mix(contrastLeftCurve, contrastRightCurve, interp);lXYZ.y = (lLAB.x + 16.0) / 116.0;lXYZ.x = lLAB.y / 500.0 + lXYZ.y;lXYZ.z = lXYZ.y - lLAB.z / 200.0;lXYZ *= lXYZ * lXYZ;lXYZ.x *= 0.95047;lXYZ.z *= 1.08883;color = mat3(3.2404542, -0.9692660, 0.0556434, -1.5371385, 1.8760108,-0.2040259, -0.4985314, 0.0415560, 1.0572252) *lXYZ;color = clamp(color, 0.0, 1.0);return color;}vec3 pipeline(vec3 color) {color = colorToLinear(color);float originalRangeFactor =rangeFactor(color, uGlobalShadows, uGlobalHighlights);color = adjustTempTintContrast(color, uGlobalTemperature, uGlobalTint,uGlobalContrast);color = adjustExposure(color, uGlobalExposure + originalRangeFactor);color = adjustColor(color, clamp(uGlobalColor, -1.0, 1.0));color = colorFromLinear(color);return color;}const int SHAPE_TYPE_ELLIPSE = 0;const int SHAPE_TYPE_ROUNDED_RECT = 1;uniform int uShapeType;uniform vec2 uEllipseCenter;uniform vec2 uEllipseRadii;uniform vec4 uRect;uniform vec4 uCornerRadii;float ellipseImplicitEquation(in vec2 nodeSpacePoint, in vec2 ellipseCenter,in vec2 ellipseRadii) {nodeSpacePoint -= ellipseCenter;return ((nodeSpacePoint.x * nodeSpacePoint.x) /(ellipseRadii.x * ellipseRadii.x) +(nodeSpacePoint.y * nodeSpacePoint.y) /(ellipseRadii.y * ellipseRadii.y) -1.);}float roundedRectImplicitEquation(in vec2 nodeSpacePoint, in vec4 bounds,vec4 cornerRadii) {vec2 quadrantSize = (bounds.zw - bounds.xy) / 2.;vec2 ptRelativeToBoxCenter = nodeSpacePoint - quadrantSize;vec2 radiiInBoxHalf =ptRelativeToBoxCenter.x > 0. ? cornerRadii.zy : cornerRadii.wx;float radiusInBoxQuadrant =ptRelativeToBoxCenter.y > 0. ? radiiInBoxHalf.x : radiiInBoxHalf.y;vec2 q = abs(ptRelativeToBoxCenter) - quadrantSize + radiusInBoxQuadrant;return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - radiusInBoxQuadrant;}float shapeImplicitEquation(in vec2 nodeSpacePoint) {if (uShapeType == SHAPE_TYPE_ELLIPSE) {return ellipseImplicitEquation(nodeSpacePoint, uEllipseCenter,uEllipseRadii);} else if (uShapeType == SHAPE_TYPE_ROUNDED_RECT) {return roundedRectImplicitEquation(nodeSpacePoint, uRect, uCornerRadii);}return 0.;}float pixelShapeCoverage(vec2 nodeSpacePoint) {float eqValue = shapeImplicitEquation(nodeSpacePoint);float gradientLengthApprox = fwidth(eqValue);gradientLengthApprox = max(gradientLengthApprox, 0.00001);float distance = eqValue / gradientLengthApprox;return 1.0 - smoothstep(-0.5, 0.5, distance);}const vec2 AA_JITTER_PATTERN_1 = vec2(-3, -5);const vec2 AA_JITTER_PATTERN_2 = vec2(5, 1);const vec2 AA_JITTER_PATTERN_3 = vec2(-1, 3);const vec2 AA_JITTER_PATTERN_4 = vec2(7, -7);const vec2 AA_JITTER_PATTERN_5 = vec2(1, -3);const vec2 AA_JITTER_PATTERN_6 = vec2(-5, 5);const vec2 AA_JITTER_PATTERN_7 = vec2(3, 7);const vec2 AA_JITTER_PATTERN_8 = vec2(-7, -1);uniform int uEmulateWrapAddress;uniform int uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (bool(uEmulateWrapAddress)) {coord = fract(coord);}vec4 color = texture(tex, coord);if (bool(uEmulateBorderAddress) && coord != clamp(coord, 0.0, 1.0))color.a = 0.0;return color;}uniform sampler2D texture0;in vec2 vPaintASample;in vec2 vStepA;vec4 sampleImagePaintAWithMSAA() {return (sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_1 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_2 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_3 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_4 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_5 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_6 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_7 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_8 * vStepA)) /8.;}uniform sampler2D texture1;in vec2 vPaintBSample;in vec2 vStepB;vec4 sampleImagePaintBWithMSAA() {return (sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_1 * vStepB) +sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_2 * vStepB) +sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_3 * vStepB) +sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_4 * vStepB) +sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_5 * vStepB) +sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_6 * vStepB) +sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_7 * vStepB) +sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_8 * vStepB)) /8.;}uniform float uOpacity;uniform float uProgress;in vec2 vNodeSpacePoint;out vec4 fig_FragColor;void main() {vec4 imageA = sampleImagePaintAWithMSAA();vec4 imageB = sampleImagePaintBWithMSAA();vec4 lerped = mix(imageA, imageB, uProgress);lerped.rgb = pipeline(lerped.rgb) * lerped.a;fig_FragColor = lerped * uOpacity * pixelShapeCoverage(vNodeSpacePoint);}`,this.GLSLX_SOURCE_AAA_SHAPE_NON_SOLID_COLOR_PAINT_VERTEX=`#version 300 es
precision highp float;const vec2 AA_JITTER_STEP = vec2(1. / 16., 1. / 16.);uniform vec2 uPathSize;uniform float uPixelRatio;uniform mat3 uPaintTransform0;void setMSAAVaryingsForImagePaintA(vec2 shapeUv, out vec2 vPaintASample,out vec2 vStepA) {vec2 uvPixelSize = 1.0 / uPathSize / uPixelRatio;vPaintASample = (uPaintTransform0 * vec3(shapeUv, 1)).xy;vStepA =(uPaintTransform0 * vec3(shapeUv + AA_JITTER_STEP * uvPixelSize, 1)).xy -vPaintASample;}uniform vec2 uUvScale;vec2 uvExcludingBorderScreenspacePixel(in vec2 uv) {return (uv - vec2(.5, .5)) * uUvScale + vec2(.5, .5);}uniform mat3 uVertexTransform;in vec2 aPosition2;out vec2 vNodeSpacePoint;out vec2 vGradientSampleUV;out vec2 vPaintASample;out vec2 vStepA;void main() {vec2 shapeUv = uvExcludingBorderScreenspacePixel(aPosition2);vNodeSpacePoint = shapeUv * uPathSize;vGradientSampleUV = (uPaintTransform0 * vec3(shapeUv, 1)).xy;setMSAAVaryingsForImagePaintA(shapeUv, vPaintASample, vStepA);gl_Position = vec4(uVertexTransform * vec3(aPosition2, 1), 0).xywz;}`,this.GLSLX_SOURCE_AAA_SHAPE_SOLID_COLOR_PAINT_FRAGMENT=`#version 300 es
precision highp float;const int SHAPE_TYPE_ELLIPSE = 0;const int SHAPE_TYPE_ROUNDED_RECT = 1;uniform int uShapeType;uniform vec2 uEllipseCenter;uniform vec2 uEllipseRadii;uniform vec4 uRect;uniform vec4 uCornerRadii;float ellipseImplicitEquation(in vec2 nodeSpacePoint, in vec2 ellipseCenter,in vec2 ellipseRadii) {nodeSpacePoint -= ellipseCenter;return ((nodeSpacePoint.x * nodeSpacePoint.x) /(ellipseRadii.x * ellipseRadii.x) +(nodeSpacePoint.y * nodeSpacePoint.y) /(ellipseRadii.y * ellipseRadii.y) -1.);}float roundedRectImplicitEquation(in vec2 nodeSpacePoint, in vec4 bounds,vec4 cornerRadii) {vec2 quadrantSize = (bounds.zw - bounds.xy) / 2.;vec2 ptRelativeToBoxCenter = nodeSpacePoint - quadrantSize;vec2 radiiInBoxHalf =ptRelativeToBoxCenter.x > 0. ? cornerRadii.zy : cornerRadii.wx;float radiusInBoxQuadrant =ptRelativeToBoxCenter.y > 0. ? radiiInBoxHalf.x : radiiInBoxHalf.y;vec2 q = abs(ptRelativeToBoxCenter) - quadrantSize + radiusInBoxQuadrant;return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - radiusInBoxQuadrant;}float shapeImplicitEquation(in vec2 nodeSpacePoint) {if (uShapeType == SHAPE_TYPE_ELLIPSE) {return ellipseImplicitEquation(nodeSpacePoint, uEllipseCenter,uEllipseRadii);} else if (uShapeType == SHAPE_TYPE_ROUNDED_RECT) {return roundedRectImplicitEquation(nodeSpacePoint, uRect, uCornerRadii);}return 0.;}float pixelShapeCoverage(vec2 nodeSpacePoint) {float eqValue = shapeImplicitEquation(nodeSpacePoint);float gradientLengthApprox = fwidth(eqValue);gradientLengthApprox = max(gradientLengthApprox, 0.00001);float distance = eqValue / gradientLengthApprox;return 1.0 - smoothstep(-0.5, 0.5, distance);}uniform float uOpacity;uniform vec4 uColor;in vec2 vNodeSpacePoint;out vec4 fig_FragColor;void main() {float coverageAlpha = pixelShapeCoverage(vNodeSpacePoint);fig_FragColor = uColor * uOpacity * coverageAlpha;}`,this.GLSLX_SOURCE_AAA_SHAPE_SOLID_COLOR_PAINT_VERTEX=`#version 300 es
precision highp float;uniform vec2 uUvScale;vec2 uvExcludingBorderScreenspacePixel(in vec2 uv) {return (uv - vec2(.5, .5)) * uUvScale + vec2(.5, .5);}uniform vec2 uPathSize;uniform mat3 uVertexTransform;in vec2 aPosition2;out vec2 vNodeSpacePoint;void main() {vec2 shapeUv = uvExcludingBorderScreenspacePixel(aPosition2);vNodeSpacePoint = shapeUv * uPathSize;gl_Position = vec4(uVertexTransform * vec3(aPosition2, 1.0), 0.0).xywz;}`,this.GLSLX_SOURCE_AAA_SHAPE_TWO_NON_SOLID_COLOR_PAINT_VERTEX=`#version 300 es
precision highp float;const vec2 AA_JITTER_STEP = vec2(1. / 16., 1. / 16.);uniform vec2 uPathSize;uniform float uPixelRatio;uniform mat3 uPaintTransform0;void setMSAAVaryingsForImagePaintA(vec2 shapeUv, out vec2 vPaintASample,out vec2 vStepA) {vec2 uvPixelSize = 1.0 / uPathSize / uPixelRatio;vPaintASample = (uPaintTransform0 * vec3(shapeUv, 1)).xy;vStepA =(uPaintTransform0 * vec3(shapeUv + AA_JITTER_STEP * uvPixelSize, 1)).xy -vPaintASample;}uniform vec2 uUvScale;vec2 uvExcludingBorderScreenspacePixel(in vec2 uv) {return (uv - vec2(.5, .5)) * uUvScale + vec2(.5, .5);}uniform mat3 uVertexTransform;uniform mat3 uPaintTransform1;in vec2 aPosition2;out vec2 vPaintASample;out vec2 vStepA;out vec2 vPaintBSample;out vec2 vStepB;out vec2 vNodeSpacePoint;out vec2 vGradientSampleUV;void setMSAAVaryingsForImagePaintB(vec2 shapeUv) {vec2 uvPixelSize = 1.0 / uPathSize / uPixelRatio;vPaintBSample = (uPaintTransform1 * vec3(shapeUv, 1)).xy;vStepB =(uPaintTransform1 * vec3(shapeUv + AA_JITTER_STEP * uvPixelSize, 1)).xy -vPaintBSample;}void main() {vec2 shapeUv = uvExcludingBorderScreenspacePixel(aPosition2);vNodeSpacePoint = shapeUv * uPathSize;vGradientSampleUV = (uPaintTransform0 * vec3(shapeUv, 1)).xy;setMSAAVaryingsForImagePaintA(shapeUv, vPaintASample, vStepA);setMSAAVaryingsForImagePaintB(shapeUv);gl_Position = vec4(uVertexTransform * vec3(aPosition2, 1), 0).xywz;}`,this.GLSLX_SOURCE_BLEND_MODE_FRAGMENT=`#version 300 es
precision highp float;const float DITHER_FACTOR = 0.003922;uniform float uOpacity;uniform int uType;uniform sampler2D texture0;uniform sampler2D texture1;in vec2 vCoord2;float minv3(vec3 c) { return min(min(c.r, c.g), c.b); }float maxv3(vec3 c) { return max(max(c.r, c.g), c.b); }float satv3(vec3 c) { return maxv3(c) - minv3(c); }float lumv3(vec3 c) {return dot(c, vec3(0.30, 0.59, 0.11)); }vec3 setLum(vec3 cbase, vec3 clum) {cbase = clamp(cbase, 0.0, 1.0);clum = clamp(clum, 0.0, 1.0);float llum = lumv3(clum);vec3 color = cbase + (llum - lumv3(cbase));float minc = minv3(color);float maxc = maxv3(color);if (minc < 0.0) {color = mix(vec3(llum), color, llum / (llum - minc));} else if (maxc > 1.0) {color = mix(vec3(llum), color, (1.0 - llum) / (maxc - llum));}return color;}vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum) {float sbase = satv3(cbase);vec3 color = vec3(0.0);if (sbase > 0.0) {float minbase = minv3(cbase);float ssat = satv3(csat);color = (cbase - minbase) * ssat / sbase;}return setLum(color, clum);}out vec4 fig_FragColor;void main() {const int DARKEN = 2;const int MULTIPLY = 3;const int LINEAR_BURN = 4;const int COLOR_BURN = 5;const int LIGHTEN = 6;const int SCREEN = 7;const int LINEAR_DODGE = 8;const int COLOR_DODGE = 9;const int OVERLAY = 10;const int SOFT_LIGHT = 11;const int HARD_LIGHT = 12;const int DIFFERENCE = 13;const int EXCLUSION = 14;const int HUE = 15;const int SATURATION = 16;const int COLOR = 17;const int LUMINOSITY = 18;vec4 source = texture(texture0, vCoord2) * uOpacity;vec4 target = texture(texture1, vCoord2);float Sa = source.a;float Da = target.a;vec3 Dca = target.rgb;if (Sa == 0.0) {fig_FragColor = vec4(Dca, Da);}else {float epsilon = 0.000001;vec3 Sca = source.rgb;vec3 color = Sca * (1.0 - Da) + Dca * (1.0 - Sa);if (uType == DARKEN) {color += min(Sca * Da, Dca * Sa);}else if (uType == MULTIPLY) {color += Sca * Dca;}else if (uType == LINEAR_BURN) {color = max(vec3(0.0), Sca + Dca - Sa * Da);}else if (uType == COLOR_BURN) {vec3 denominator = max(Sca * Da, DITHER_FACTOR);vec3 numerator = (Da - Dca) * Sa * step(DITHER_FACTOR, Da - Dca);color += Sa * Da * (1.0 - min(vec3(1.0), numerator / denominator));}else if (uType == LIGHTEN) {color += max(Sca * Da, Dca * Sa);}else if (uType == SCREEN) {color = Sca + Dca - Sca * Dca;}else if (uType == LINEAR_DODGE) {color = min(vec3(1.0), Sca + Dca);}else if (uType == COLOR_DODGE) {vec3 denominator = max(Da * (Sa - Sca), DITHER_FACTOR);vec3 numerator = Dca * Sa * step(DITHER_FACTOR, Dca);color += Sa * Da * min(vec3(1.0), numerator / denominator);}else if (uType == OVERLAY) {color += mix(Sa * Da - 2.0 * (Da - Dca) * (Sa - Sca), 2.0 * Sca * Dca,vec3(lessThanEqual(2.0 * Dca, vec3(Da))));}else if (uType == HARD_LIGHT) {color += mix(2.0 * Sca * Dca, Sa * Da - 2.0 * (Da - Dca) * (Sa - Sca),vec3(greaterThan(2.0 * Sca, vec3(Sa))));}else if (uType == DIFFERENCE) {color += abs(Dca * Sa - Sca * Da);}else if (uType == EXCLUSION) {color += Sca * Da + Dca * Sa - 2.0 * Sca * Dca;}else {vec3 delta = vec3(0.0);vec3 Sc = Sca;vec3 Dc = Dca;if (Sa > 0.0)Sc /= Sa;if (Da > 0.0)Dc /= Da;if (uType == SOFT_LIGHT) {vec3 c0 = 1.0 - Dc;vec3 c1 = (16.0 * Dc - 12.0) * Dc + 3.0;vec3 c2 = inversesqrt(Dc + epsilon) - 1.0;vec3 c = mix(c1, c2, vec3(greaterThan(Dc, vec3(0.25))));c = mix(c, c0, vec3(greaterThan(Sc, vec3(0.50))));delta = Dc * (1.0 + c * (2.0 * Sc - 1.0));}else if (uType == HUE) {delta = setLumSat(Sc, Dc, Dc);}else if (uType == SATURATION) {delta = setLumSat(Dc, Sc, Dc);}else if (uType == COLOR) {delta = setLum(Sc, Dc);}else if (uType == LUMINOSITY) {delta = setLum(Dc, Sc);}color += Sa * Da * delta;}fig_FragColor = vec4(color, Sa + Da - Sa * Da);}}`,this.GLSLX_SOURCE_BLEND_TEXTURE_FRAGMENT=`#version 300 es
precision highp float;uniform float uOpacity;uniform sampler2D texture0;in vec2 vCoord2;out vec4 fig_FragColor;void main() { fig_FragColor = texture(texture0, vCoord2) * uOpacity; }`,this.GLSLX_SOURCE_CLAMPED_BLUR_TILE_FRAGMENT=`#version 300 es
precision highp float;uniform float uCount;uniform vec2 uBlurDelta;uniform vec4 uBlurClamp;uniform sampler2D texture0;in vec2 vCoord2;out vec4 fig_FragColor;void main() {vec2 coord2 = clamp(vCoord2, uBlurClamp.xy, uBlurClamp.zw);float weight = uCount;vec4 result = texture(texture0, coord2) * weight;float total = weight;for (int i = 1; i < 32; i += 2) {if (float(i) > uCount) {break;}float t0 = float(i);float t1 = min(t0 + 1.0, uCount);vec2 coord0_neg = coord2 - uBlurDelta * t0;vec2 coord0_pos = coord2 + uBlurDelta * t0;vec2 coord1_neg = coord2 - uBlurDelta * t1;vec2 coord1_pos = coord2 + uBlurDelta * t1;float weight0_neg =(uCount - t0) *float(coord0_neg == clamp(coord0_neg, uBlurClamp.xy, uBlurClamp.zw));float weight0_pos =(uCount - t0) *float(coord0_pos == clamp(coord0_pos, uBlurClamp.xy, uBlurClamp.zw));float weight1_neg =(uCount - t1) *float(coord1_neg == clamp(coord1_neg, uBlurClamp.xy, uBlurClamp.zw));float weight1_pos =(uCount - t1) *float(coord1_pos == clamp(coord1_pos, uBlurClamp.xy, uBlurClamp.zw));float weight_neg = weight0_neg + weight1_neg;float weight_pos = weight0_pos + weight1_pos;vec2 coord_neg =(coord0_neg * weight0_neg + coord1_neg * weight1_neg) / weight_neg;vec2 coord_pos =(coord0_pos * weight0_pos + coord1_pos * weight1_pos) / weight_pos;result += texture(texture0, coord_neg) * weight_neg +texture(texture0, coord_pos) * weight_pos;total += weight_neg + weight_pos;}fig_FragColor = result / total;}`,this.GLSLX_SOURCE_CLIP_SPACE_QUAD_VERTEX=`#version 300 es
precision highp float;in vec2 aPosition2;out vec2 vCoord2;void main() {vCoord2 = aPosition2;gl_Position = vec4(aPosition2 * 2.0 - 1.0, 0.0, 1.0);}`,this.GLSLX_SOURCE_COPY_TILE_VERTEX=`#version 300 es
precision highp float;uniform vec4 uQuad;in vec2 aPosition2;void main() { gl_Position = vec4(mix(uQuad.xy, uQuad.zw, aPosition2), 0, 1); }`,this.GLSLX_SOURCE_DOWNSAMPLE_TILE_FRAGMENT=`#version 300 es
precision highp float;uniform sampler2D texture0;in vec2 vCoord2;out vec4 fig_FragColor;void main() { fig_FragColor = texture(texture0, vCoord2); }`,this.GLSLX_SOURCE_DOWNSAMPLE_TILE_VERTEX=`#version 300 es
precision highp float;uniform vec4 uQuad;uniform vec4 uSource;in vec2 aPosition2;out vec2 vCoord2;void main() {vCoord2 = mix(uSource.xy, uSource.zw, aPosition2);gl_Position = vec4(mix(uQuad.xy, uQuad.zw, aPosition2) * 2.0 - 1.0, 0, 1);}`,this.GLSLX_SOURCE_DRAW_TEXTURE_FRAGMENT=`#version 300 es
precision highp float;uniform float uOpacity;uniform vec4 uUvSpaceClampingRect;uniform vec4 uUvSpaceSourceRect;uniform sampler2D texture0;in vec2 vCoord2;const bool drawDebugStuff = false;out vec4 fig_FragColor;void main() {vec2 sampleCoordinates =clamp(vCoord2, uUvSpaceClampingRect.xy, uUvSpaceClampingRect.zw);fig_FragColor = texture(texture0, sampleCoordinates) * uOpacity;if (drawDebugStuff) {vec2 tt = 2.0 * abs((vCoord2 - uUvSpaceSourceRect.xy) /(uUvSpaceSourceRect.zw - uUvSpaceSourceRect.xy) -0.5);float t = max(tt.x, tt.y);if (t > 0.99) {fig_FragColor = vec4(1.0, 0.0, 0.0, 1.0);}}}`,this.GLSLX_SOURCE_DRAW_TEXTURE_VERTEX=`#version 300 es
precision highp float;uniform vec4 uUvSpaceSourceRect;uniform mat3 uToClipSpaceTransform;uniform vec4 uDestinationRect;in vec2 aPosition2;out vec2 vCoord2;void main() {vCoord2 = mix(uUvSpaceSourceRect.xy, uUvSpaceSourceRect.zw, aPosition2);gl_Position = vec4((uToClipSpaceTransform *vec3(mix(uDestinationRect.xy, uDestinationRect.zw, aPosition2), 1.0)).xy,0, 1);}`,this.GLSLX_SOURCE_GRADIENT_FRAGMENT=`#version 300 es
precision highp float;uniform int uType;const float PI = 3.141592;vec2 _gradientCoord(in vec2 paintUV) {const int LINEAR = 1;const int RADIAL = 2;const int ANGULAR = 3;const int DIAMOND = 4;vec2 uv = paintUV - 0.5;float t = uType == LINEAR    ? uv.x + 0.5: uType == RADIAL  ? 2.0 * length(uv): uType == ANGULAR ? fract(atan(uv.y, uv.x) / (2.0 * PI)): uType == DIAMOND ? 2.0 * max(abs(uv.x + uv.y), abs(uv.y - uv.x)): 0.0;return vec2(t, 0.25 + (0.75 - 0.25) / 256.0);}const float DITHER_FACTOR = 0.003922;const float DITHER_RANGE = 2.0 * DITHER_FACTOR;float random() {vec2 coordCopy = gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898, 78.233), coordCopy)) * 43758.5453);}vec4 ditherColor(vec4 color) {float offset = (random() - 0.5) * DITHER_RANGE; return color.a > 0.0 ? min(abs(color + offset), 1.0) : color;}uniform float uOpacity;uniform sampler2D texture0;in vec2 vCoord2;out vec4 fig_FragColor;void main() {vec2 coord = _gradientCoord(vCoord2);fig_FragColor = ditherColor(texture(texture0, coord) * uOpacity);}`,this.GLSLX_SOURCE_HARD_MASK_TILE_WITH_COLOR_FRAGMENT=`#version 300 es
precision highp float;uniform sampler2D texture0;uniform vec4 uColor;in vec2 vCoord2;out vec4 fig_FragColor;void main() {fig_FragColor = float(texture(texture0, vCoord2).a > 0.0) * uColor;}`,this.GLSLX_SOURCE_HARD_MASK_WITH_COLOR_AND_DOWNSAMPLE_TILE_FRAGMENT=`#version 300 es
precision highp float;uniform vec4 uColor;uniform float uTextureSize;uniform float uTexturePx;uniform sampler2D texture0;in vec2 vCoord2;out vec4 fig_FragColor;void main() {vec2 coordInSSAA = vCoord2 * vec2(uTextureSize);vec2 lowerLeftInSSAA = floor(coordInSSAA - vec2(0.5)) + 0.5;vec2 lowerLeftTexelCoord = lowerLeftInSSAA * uTexturePx;vec2 lowerRightTexelCoord = lowerLeftTexelCoord + vec2(uTexturePx, 0.0);vec2 upperLeftTexelCoord = lowerLeftTexelCoord + vec2(0.0, uTexturePx);vec2 upperRightTexelCoord =lowerLeftTexelCoord + vec2(uTexturePx, uTexturePx);float lowerLeftAlpha = texture(texture0, lowerLeftTexelCoord).a;float lowerRightAlpha = texture(texture0, lowerRightTexelCoord).a;float upperLeftAlpha = texture(texture0, upperLeftTexelCoord).a;float upperRightAlpha = texture(texture0, upperRightTexelCoord).a;float hardMaskedLowerLeftAlpha = float(lowerLeftAlpha > 0.0);float hardMaskedLowerRightAlpha = float(lowerRightAlpha > 0.0);float hardMaskedUpperLeftAlpha = float(upperLeftAlpha > 0.0);float hardMaskedUpperRightAlpha = float(upperRightAlpha > 0.0);float rightWeight = coordInSSAA.x - lowerLeftInSSAA.x;float leftWeight = 1.0 - rightWeight;float topWeight = coordInSSAA.y - lowerLeftInSSAA.y;float bottomWeight = 1.0 - topWeight;float downsampledHardMaskedAlpha = (hardMaskedLowerLeftAlpha * leftWeight +hardMaskedLowerRightAlpha * rightWeight) *bottomWeight +(hardMaskedUpperLeftAlpha * leftWeight +hardMaskedUpperRightAlpha * rightWeight) *topWeight;fig_FragColor = downsampledHardMaskedAlpha * uColor;}`,this.GLSLX_SOURCE_IMAGE_FRAGMENT=`#version 300 es
precision highp float;uniform int uEmulateWrapAddress;uniform int uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (bool(uEmulateWrapAddress)) {coord = fract(coord);}vec4 color = texture(tex, coord);if (bool(uEmulateBorderAddress) && coord != clamp(coord, 0.0, 1.0))color.a = 0.0;return color;}uniform float uOpacity;uniform sampler2D texture0;in vec2 vCoord2;out vec4 fig_FragColor;void main() {vec4 color = sampleImage(texture0, vCoord2);color.rgb *= color.a;fig_FragColor = color * uOpacity;}`,this.GLSLX_SOURCE_IMAGE_COLOR_ADJUST_FRAGMENT=`#version 300 es
precision highp float;const vec3 RGB2Y = vec3(0.2126, 0.7152, 0.0722);const float IMAGE_HIGHLIGHT_SHADOW_THRESHOLD = 0.5;uniform float uGlobalTint;uniform float uGlobalColor;uniform float uGlobalShadows;uniform float uGlobalHighlights;uniform float uGlobalExposure;uniform float uGlobalTemperature;uniform float uGlobalContrast;vec3 colorToLinear(vec3 color) {color = pow(color, vec3(2.2));return color;}vec3 colorFromLinear(vec3 color) {color = pow(color, vec3(1.0 / 2.2));return color;}float rangeFactor(vec3 color, float shadows, float highlights) {float lThreshold =dot(color, RGB2Y) - pow(IMAGE_HIGHLIGHT_SHADOW_THRESHOLD, 2.2);return 0.75 * lThreshold / sqrt(1.0 + 4.0 * lThreshold * lThreshold) *(lThreshold > 0.0 ? highlights : -shadows * 0.999);}vec3 adjustExposure(vec3 color, float exposureAdjust) {float lFactor = pow(10.0, 2.0 * exposureAdjust) - 1.0;const float lSqueeze = 0.75;float lUnsqueeze = 1.0 / (1.0 - lSqueeze) - 1.0;float gray = dot(color, RGB2Y);lUnsqueeze *= 1.0 + gray * gray * min(0.0, exposureAdjust) /(0.2 - min(0.0, exposureAdjust));color += (gray - color) * lSqueeze;if (exposureAdjust < 0.0) {color *= 1.0 + exposureAdjust / 16.0;gray *= 1.0 + exposureAdjust / 16.0;}color *= (lFactor + 1.0) / (color * lFactor + 1.0);gray *= (lFactor + 1.0) / (gray * lFactor + 1.0);color += (color - gray) * lUnsqueeze;color = clamp(color, 0.0, 1.0);return color;}vec3 adjustColor(vec3 color, float colorAdjust) {float gray = dot(color, RGB2Y);if (colorAdjust <= 0.0) {color -= (gray - color) * colorAdjust;} else {float lNeg = gray / (gray - min(min(color.r, color.g), color.b) + 1e-6);float lPos =(1.0 - gray) / (max(max(color.r, color.g), color.b) - gray + 1e-6);float lFactor = mix(1.0, min(lNeg, lPos), colorAdjust);lFactor =min(lFactor,2.0); color += (gray - color) * (1.0 - lFactor);}return color;}float smootherstep(float edge0, float edge1, float x) {x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);}vec3 adjustTempTintContrast(vec3 color, float temp, float tint,float contrast) {vec3 lXYZ = mat3(0.4124564, 0.2126729, 0.0193339, 0.3575761, 0.7151522,0.1191920, 0.1804375, 0.0721750, 0.9503041) *color;lXYZ.x /= 0.95047;lXYZ.z /= 1.08883;lXYZ = pow(lXYZ, vec3(1.0 / 3.0));vec3 lLAB = vec3(116.0 * lXYZ.y - 16.0, 500.0 * (lXYZ.x - lXYZ.y),200.0 * (lXYZ.y - lXYZ.z));lLAB.y += 30.0 * tint;lLAB.z += 30.0 * temp;float scaledThreshold = IMAGE_HIGHLIGHT_SHADOW_THRESHOLD * 100.0;float thresholdDelta = 30.0;float contrastLeftCurve =contrast < 0.0 ? (lLAB.x - scaledThreshold) * 0.2 + 50.0 : lLAB.x;float contrastRightCurve =contrast < 0.0 ? lLAB.x: smootherstep(scaledThreshold - thresholdDelta,scaledThreshold + thresholdDelta, lLAB.x) *100.0;float interp = contrast < 0.0 ? contrast + 1.0 : contrast;lLAB.x = mix(contrastLeftCurve, contrastRightCurve, interp);lXYZ.y = (lLAB.x + 16.0) / 116.0;lXYZ.x = lLAB.y / 500.0 + lXYZ.y;lXYZ.z = lXYZ.y - lLAB.z / 200.0;lXYZ *= lXYZ * lXYZ;lXYZ.x *= 0.95047;lXYZ.z *= 1.08883;color = mat3(3.2404542, -0.9692660, 0.0556434, -1.5371385, 1.8760108,-0.2040259, -0.4985314, 0.0415560, 1.0572252) *lXYZ;color = clamp(color, 0.0, 1.0);return color;}vec3 pipeline(vec3 color) {color = colorToLinear(color);float originalRangeFactor =rangeFactor(color, uGlobalShadows, uGlobalHighlights);color = adjustTempTintContrast(color, uGlobalTemperature, uGlobalTint,uGlobalContrast);color = adjustExposure(color, uGlobalExposure + originalRangeFactor);color = adjustColor(color, clamp(uGlobalColor, -1.0, 1.0));color = colorFromLinear(color);return color;}uniform int uEmulateWrapAddress;uniform int uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (bool(uEmulateWrapAddress)) {coord = fract(coord);}vec4 color = texture(tex, coord);if (bool(uEmulateBorderAddress) && coord != clamp(coord, 0.0, 1.0))color.a = 0.0;return color;}uniform float uOpacity;uniform sampler2D texture0;in vec2 vCoord2;out vec4 fig_FragColor;void main() {vec4 color = sampleImage(texture0, vCoord2);color.rgb = pipeline(color.rgb) * color.a;fig_FragColor = color * uOpacity;}`,this.GLSLX_SOURCE_LERP_GRADIENT_FRAGMENT=`#version 300 es
precision highp float;uniform int uType;const float PI = 3.141592;vec2 _gradientCoord(in vec2 paintUV) {const int LINEAR = 1;const int RADIAL = 2;const int ANGULAR = 3;const int DIAMOND = 4;vec2 uv = paintUV - 0.5;float t = uType == LINEAR    ? uv.x + 0.5: uType == RADIAL  ? 2.0 * length(uv): uType == ANGULAR ? fract(atan(uv.y, uv.x) / (2.0 * PI)): uType == DIAMOND ? 2.0 * max(abs(uv.x + uv.y), abs(uv.y - uv.x)): 0.0;return vec2(t, 0.25 + (0.75 - 0.25) / 256.0);}const float DITHER_FACTOR = 0.003922;const float DITHER_RANGE = 2.0 * DITHER_FACTOR;float random() {vec2 coordCopy = gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898, 78.233), coordCopy)) * 43758.5453);}vec4 ditherColor(vec4 color) {float offset = (random() - 0.5) * DITHER_RANGE; return color.a > 0.0 ? min(abs(color + offset), 1.0) : color;}uniform float uOpacity;uniform float uProgress;uniform sampler2D texture0;uniform sampler2D texture1;in vec2 vCoord2;out vec4 fig_FragColor;void main() {vec2 coord = _gradientCoord(vCoord2);vec4 lerped =mix(texture(texture0, coord), texture(texture1, coord), uProgress);fig_FragColor = ditherColor(lerped * uOpacity);}`,this.GLSLX_SOURCE_LERP_IMAGE_FRAGMENT=`#version 300 es
precision highp float;uniform int uEmulateWrapAddress;uniform int uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (bool(uEmulateWrapAddress)) {coord = fract(coord);}vec4 color = texture(tex, coord);if (bool(uEmulateBorderAddress) && coord != clamp(coord, 0.0, 1.0))color.a = 0.0;return color;}uniform float uOpacity;uniform float uProgress;uniform sampler2D texture0;uniform sampler2D texture1;in vec2 vCoord2;in vec2 vCoord2b;out vec4 fig_FragColor;void main() {vec4 lerped = mix(sampleImage(texture0, vCoord2),sampleImage(texture1, vCoord2b), uProgress);lerped.rgb *= lerped.a;fig_FragColor = lerped * uOpacity;}`,this.GLSLX_SOURCE_LERP_IMAGE_COLOR_ADJUST_FRAGMENT=`#version 300 es
precision highp float;const vec3 RGB2Y = vec3(0.2126, 0.7152, 0.0722);const float IMAGE_HIGHLIGHT_SHADOW_THRESHOLD = 0.5;uniform float uGlobalTint;uniform float uGlobalColor;uniform float uGlobalShadows;uniform float uGlobalHighlights;uniform float uGlobalExposure;uniform float uGlobalTemperature;uniform float uGlobalContrast;vec3 colorToLinear(vec3 color) {color = pow(color, vec3(2.2));return color;}vec3 colorFromLinear(vec3 color) {color = pow(color, vec3(1.0 / 2.2));return color;}float rangeFactor(vec3 color, float shadows, float highlights) {float lThreshold =dot(color, RGB2Y) - pow(IMAGE_HIGHLIGHT_SHADOW_THRESHOLD, 2.2);return 0.75 * lThreshold / sqrt(1.0 + 4.0 * lThreshold * lThreshold) *(lThreshold > 0.0 ? highlights : -shadows * 0.999);}vec3 adjustExposure(vec3 color, float exposureAdjust) {float lFactor = pow(10.0, 2.0 * exposureAdjust) - 1.0;const float lSqueeze = 0.75;float lUnsqueeze = 1.0 / (1.0 - lSqueeze) - 1.0;float gray = dot(color, RGB2Y);lUnsqueeze *= 1.0 + gray * gray * min(0.0, exposureAdjust) /(0.2 - min(0.0, exposureAdjust));color += (gray - color) * lSqueeze;if (exposureAdjust < 0.0) {color *= 1.0 + exposureAdjust / 16.0;gray *= 1.0 + exposureAdjust / 16.0;}color *= (lFactor + 1.0) / (color * lFactor + 1.0);gray *= (lFactor + 1.0) / (gray * lFactor + 1.0);color += (color - gray) * lUnsqueeze;color = clamp(color, 0.0, 1.0);return color;}vec3 adjustColor(vec3 color, float colorAdjust) {float gray = dot(color, RGB2Y);if (colorAdjust <= 0.0) {color -= (gray - color) * colorAdjust;} else {float lNeg = gray / (gray - min(min(color.r, color.g), color.b) + 1e-6);float lPos =(1.0 - gray) / (max(max(color.r, color.g), color.b) - gray + 1e-6);float lFactor = mix(1.0, min(lNeg, lPos), colorAdjust);lFactor =min(lFactor,2.0); color += (gray - color) * (1.0 - lFactor);}return color;}float smootherstep(float edge0, float edge1, float x) {x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);}vec3 adjustTempTintContrast(vec3 color, float temp, float tint,float contrast) {vec3 lXYZ = mat3(0.4124564, 0.2126729, 0.0193339, 0.3575761, 0.7151522,0.1191920, 0.1804375, 0.0721750, 0.9503041) *color;lXYZ.x /= 0.95047;lXYZ.z /= 1.08883;lXYZ = pow(lXYZ, vec3(1.0 / 3.0));vec3 lLAB = vec3(116.0 * lXYZ.y - 16.0, 500.0 * (lXYZ.x - lXYZ.y),200.0 * (lXYZ.y - lXYZ.z));lLAB.y += 30.0 * tint;lLAB.z += 30.0 * temp;float scaledThreshold = IMAGE_HIGHLIGHT_SHADOW_THRESHOLD * 100.0;float thresholdDelta = 30.0;float contrastLeftCurve =contrast < 0.0 ? (lLAB.x - scaledThreshold) * 0.2 + 50.0 : lLAB.x;float contrastRightCurve =contrast < 0.0 ? lLAB.x: smootherstep(scaledThreshold - thresholdDelta,scaledThreshold + thresholdDelta, lLAB.x) *100.0;float interp = contrast < 0.0 ? contrast + 1.0 : contrast;lLAB.x = mix(contrastLeftCurve, contrastRightCurve, interp);lXYZ.y = (lLAB.x + 16.0) / 116.0;lXYZ.x = lLAB.y / 500.0 + lXYZ.y;lXYZ.z = lXYZ.y - lLAB.z / 200.0;lXYZ *= lXYZ * lXYZ;lXYZ.x *= 0.95047;lXYZ.z *= 1.08883;color = mat3(3.2404542, -0.9692660, 0.0556434, -1.5371385, 1.8760108,-0.2040259, -0.4985314, 0.0415560, 1.0572252) *lXYZ;color = clamp(color, 0.0, 1.0);return color;}vec3 pipeline(vec3 color) {color = colorToLinear(color);float originalRangeFactor =rangeFactor(color, uGlobalShadows, uGlobalHighlights);color = adjustTempTintContrast(color, uGlobalTemperature, uGlobalTint,uGlobalContrast);color = adjustExposure(color, uGlobalExposure + originalRangeFactor);color = adjustColor(color, clamp(uGlobalColor, -1.0, 1.0));color = colorFromLinear(color);return color;}uniform int uEmulateWrapAddress;uniform int uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (bool(uEmulateWrapAddress)) {coord = fract(coord);}vec4 color = texture(tex, coord);if (bool(uEmulateBorderAddress) && coord != clamp(coord, 0.0, 1.0))color.a = 0.0;return color;}uniform float uOpacity;uniform float uProgress;uniform sampler2D texture0;uniform sampler2D texture1;in vec2 vCoord2;in vec2 vCoord2b;out vec4 fig_FragColor;void main() {vec4 lerped = mix(sampleImage(texture0, vCoord2),sampleImage(texture1, vCoord2b), uProgress);lerped.rgb = pipeline(lerped.rgb) * lerped.a;fig_FragColor = lerped * uOpacity;}`,this.GLSLX_SOURCE_LERP_TILE_FRAGMENT=`#version 300 es
precision highp float;uniform float uOpacity;uniform sampler2D texture0;uniform sampler2D texture1;uniform vec4 texture0UvSpaceScissor;uniform vec4 texture1UvSpaceScissor;in vec2 vCoord2;out vec4 fig_FragColor;void main() {vec4 texture0Color = all(greaterThan(vCoord2, texture0UvSpaceScissor.xy)) &&all(lessThan(vCoord2, texture0UvSpaceScissor.zw))? texture(texture0, vCoord2): vec4(0.0);vec4 texture1Color = all(greaterThan(vCoord2, texture1UvSpaceScissor.xy)) &&all(lessThan(vCoord2, texture1UvSpaceScissor.zw))? texture(texture1, vCoord2): vec4(0.0);fig_FragColor = mix(texture0Color, texture1Color, uOpacity);}`,this.GLSLX_SOURCE_LOOP_BLINN_FRAGMENT=`#version 300 es
precision highp float;in vec3 vCoord3;out vec4 fig_FragColor;void main() {if (vCoord3.x * vCoord3.x * vCoord3.x > vCoord3.y * vCoord3.z) {discard;}}`,this.GLSLX_SOURCE_LOOP_BLINN_VERTEX=`#version 300 es
precision highp float;uniform mat3 uVertexTransform;in vec2 aPosition2;in vec3 aCoord3;out vec3 vCoord3;void main() {vCoord3 = aCoord3;gl_Position = vec4(uVertexTransform * vec3(aPosition2, 1.0), 0.0).xywz;}`,this.GLSLX_SOURCE_MASK_BACKGROUND_BLUR_TILE_FRAGMENT=`#version 300 es
precision highp float;uniform sampler2D texture0;uniform sampler2D texture1;in vec2 vCoord2;out vec4 fig_FragColor;void main() {if (texture(texture1, vCoord2).a == 0.0) {discard;}fig_FragColor = texture(texture0, vCoord2);}`,this.GLSLX_SOURCE_MASK_INNER_SHADOW_TILE_FRAGMENT=`#version 300 es
precision highp float;uniform sampler2D texture0;uniform sampler2D texture1;uniform vec4 uColor;in vec2 vCoord2;out vec4 fig_FragColor;void main() {fig_FragColor = (1.0 - texture(texture0, vCoord2).a) *texture(texture1, vCoord2).a * uColor;}`,this.GLSLX_SOURCE_MASK_INNER_SHADOW_TILE_AND_FIRST_HARD_MASK_ALPHA_FRAGMENT=`#version 300 es
precision highp float;uniform sampler2D texture0;uniform sampler2D texture1;uniform vec4 uColor;in vec2 vCoord2;out vec4 fig_FragColor;void main() {float texture1HardMasked = float(texture(texture1, vCoord2).a > 0.0);fig_FragColor =(1.0 - texture(texture0, vCoord2).a) * texture1HardMasked * uColor;}`,this.GLSLX_SOURCE_MASK_KNOCKOUT_SHADOW_TILE_FRAGMENT=`#version 300 es
precision highp float;uniform sampler2D texture0;uniform sampler2D texture1;in vec2 vCoord2;out vec4 fig_FragColor;void main() {fig_FragColor =texture(texture0, vCoord2) * float(texture(texture1, vCoord2).a == 0.);}`,this.GLSLX_SOURCE_MASK_KNOCKOUT_SHADOW_TILE_PASS_THROUGH_FRAGMENT=`#version 300 es
precision highp float;uniform sampler2D texture0;uniform sampler2D texture1;uniform sampler2D texture2; in vec2 vCoord2;out vec4 fig_FragColor;void main() {float geometryAlpha = texture(texture2, vCoord2).a;fig_FragColor = mix(texture(texture1, vCoord2),texture(texture0, vCoord2) * float(geometryAlpha == 0.),1.0 - geometryAlpha);}`,this.GLSLX_SOURCE_MASK_TILE_FRAGMENT=`#version 300 es
precision highp float;uniform sampler2D texture0;uniform sampler2D texture1;in vec2 vCoord2;out vec4 fig_FragColor;void main() {fig_FragColor = texture(texture0, vCoord2) * texture(texture1, vCoord2).a;}`,this.GLSLX_SOURCE_MASK_TILE_LUMINANCE_FRAGMENT=`#version 300 es
precision highp float;uniform sampler2D texture0;uniform sampler2D texture1;in vec2 vCoord2;out vec4 fig_FragColor;void main() {vec3 rgb = texture(texture1, vCoord2).rgb;vec3 weights = vec3(0.299, 0.587, 0.114);float c2 = dot(rgb * rgb, weights);float luminance = sqrt(c2);fig_FragColor =texture(texture0, vCoord2) * luminance * texture(texture1, vCoord2).a;}`,this.GLSLX_SOURCE_MASK_TILE_LUMINANCE_PASS_THROUGH_FRAGMENT=`#version 300 es
precision highp float;uniform sampler2D texture0;uniform sampler2D texture1;uniform sampler2D texture2; in vec2 vCoord2;out vec4 fig_FragColor;void main() {vec3 rgb = texture(texture2, vCoord2).rgb;vec3 weights = vec3(0.299, 0.587, 0.114);float c2 = dot(rgb * rgb, weights);float luminance = sqrt(c2);fig_FragColor = mix(texture(texture1, vCoord2),texture(texture0, vCoord2),texture(texture2, vCoord2).a * luminance);}`,this.GLSLX_SOURCE_MASK_TILE_PASS_THROUGH_FRAGMENT=`#version 300 es
precision highp float;uniform sampler2D texture0;uniform sampler2D texture1;uniform sampler2D texture2; in vec2 vCoord2;out vec4 fig_FragColor;void main() {fig_FragColor = mix(texture(texture1, vCoord2), texture(texture0, vCoord2),texture(texture2, vCoord2).a);}`,this.GLSLX_SOURCE_NON_SOLID_COLOR_PAINT_VERTEX=`#version 300 es
precision highp float;uniform mat3 uVertexTransform;uniform mat3 uPaintTransform0;in vec2 aPosition2;out vec2 vCoord2;void main() {vCoord2 = (uPaintTransform0 * vec3(aPosition2, 1)).xy;gl_Position = vec4(uVertexTransform * vec3(aPosition2, 1), 0).xywz;}`,this.GLSLX_SOURCE_RECTANGLE_BLUR_FRAGMENT=`#version 300 es
precision highp float;const float DITHER_FACTOR = 0.003922;const float DITHER_RANGE = 2.0 * DITHER_FACTOR;float random() {vec2 coordCopy = gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898, 78.233), coordCopy)) * 43758.5453);}vec4 ditherColor(vec4 color) {float offset = (random() - 0.5) * DITHER_RANGE; return color.a > 0.0 ? min(abs(color + offset), 1.0) : color;}float integrateTriangle(float x) {if (x < -1.0) {return 0.0;} else if (x < 0.0) {return 0.5 * (x + 1.0) * (x + 1.0);} else if (x < 1.0) {return 0.5 - 0.5 * x * (x - 2.0);} else {return 1.0;}}uniform vec4 uColor;in vec4 vCoord4;out vec4 fig_FragColor;void main() {float alpha = (integrateTriangle(vCoord4.x) - integrateTriangle(vCoord4.z)) *(integrateTriangle(vCoord4.y) - integrateTriangle(vCoord4.w));fig_FragColor = ditherColor(uColor * alpha);}`,this.GLSLX_SOURCE_RECTANGLE_BLUR_VERTEX=`#version 300 es
precision highp float;uniform mat3 uVertexTransform;uniform vec4 uQuad;uniform float uBlurRadius;in vec2 aPosition2;out vec4 vCoord4;void main() {vec2 vertex = mix(uQuad.xy - uBlurRadius, uQuad.zw + uBlurRadius, aPosition2);vCoord4 = (vec4(vertex, vertex) - uQuad) / uBlurRadius;gl_Position = vec4(uVertexTransform * vec3(vertex, 1), 0).xywz;}`,this.GLSLX_SOURCE_RENDER_DEVICE_FRAME_FRAGMENT=`#version 300 es
precision highp float;uniform sampler2D texture0;in vec4 vPosition4;out vec4 fig_FragColor;void main() {vec2 position = vPosition4.xy;vec2 uv = vPosition4.zw;uv.y = 1.0 - uv.y;fig_FragColor = texture(texture0, uv);}`,this.GLSLX_SOURCE_RENDER_DEVICE_FRAME_VERTEX=`#version 300 es
precision highp float;uniform mat3 uVertexTransform;in vec4 aPosition4;out vec4 vPosition4;void main() {vec2 transformedPosition = (uVertexTransform * vec3(aPosition4.xy, 1.0)).xy;vPosition4 = vec4(transformedPosition.xy, aPosition4.zw);gl_Position = vec4(transformedPosition, 0.0, 1.0);}`,this.GLSLX_SOURCE_RENDER_HOTSPOT_FRAGMENT=`#version 300 es
precision highp float;uniform mat3 uVertexTransform;uniform float uHotspotOpacity;uniform vec2 uStrokeProportion;uniform vec4 uUvHotspotClippingRect;in vec4 vPosition4;const vec3 HOTSPOT_COLOR = vec3(48.0 / 255.0, 194.0 / 255.0, 255.0 / 255.0);bool contains(vec4 rect, vec2 point) {return (rect.z >= 0.0 && rect.w >= 0.0 &&clamp(point.x, rect.x, rect.x + rect.z) == point.x &&clamp(point.y, rect.y, rect.y + rect.w) == point.y);}out vec4 fig_FragColor;void main() {vec2 position = vPosition4.xy;vec2 uv = vPosition4.zw;if (contains(uUvHotspotClippingRect, position)) {if (uv.x < uStrokeProportion.x || uv.x > 1.0 - uStrokeProportion.x ||uv.y < uStrokeProportion.y || uv.y > 1.0 - uStrokeProportion.y) {fig_FragColor = vec4(HOTSPOT_COLOR, 1.0 * uHotspotOpacity);} else {fig_FragColor = vec4(HOTSPOT_COLOR, 0.5 * uHotspotOpacity);}} else {fig_FragColor = vec4(0.0);}}`,this.GLSLX_SOURCE_RENDER_HOTSPOT_VERTEX=`#version 300 es
precision highp float;uniform mat3 uVertexTransform;in vec4 aPosition4;out vec4 vPosition4;void main() {vec2 transformedPosition = (uVertexTransform * vec3(aPosition4.xy, 1.0)).xy;vPosition4 = vec4(transformedPosition.xy, aPosition4.zw);gl_Position = vec4(transformedPosition, 0.0, 1.0);}`,this.GLSLX_SOURCE_ROUNDED_RECTANGLE_BLUR_FRAGMENT=`#version 300 es
precision highp float;const float DITHER_FACTOR = 0.003922;const float DITHER_RANGE = 2.0 * DITHER_FACTOR;float random() {vec2 coordCopy = gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898, 78.233), coordCopy)) * 43758.5453);}vec4 ditherColor(vec4 color) {float offset = (random() - 0.5) * DITHER_RANGE; return color.a > 0.0 ? min(abs(color + offset), 1.0) : color;}float integrateTriangle(float x) {if (x < -1.0) {return 0.0;} else if (x < 0.0) {return 0.5 * (x + 1.0) * (x + 1.0);} else if (x < 1.0) {return 0.5 - 0.5 * x * (x - 2.0);} else {return 1.0;}}uniform vec4 uColor;uniform vec2 uHalfSizeOverBlurRadius;uniform float uCornerRadiusOverBlurRadius;in vec2 vCoord2;float triangle(float x) { return max(0.0, (1.0 - abs(x))); }float roundedRectangleBlurHorizontal(float x, float y, float cornerRadius,vec2 halfSize) {float deltaY = min(halfSize.y - cornerRadius - abs(y), 0.0);float roundedRectX =halfSize.x - cornerRadius +sqrt(max(0.0, cornerRadius * cornerRadius - deltaY * deltaY));vec2 xRelativeToLowerAndUpper = vec2(x + roundedRectX, x - roundedRectX);return integrateTriangle(xRelativeToLowerAndUpper.x) -integrateTriangle(xRelativeToLowerAndUpper.y);}out vec4 fig_FragColor;void main() {float alpha;if (all(lessThan(abs(vCoord2),uHalfSizeOverBlurRadius - vec2(uCornerRadiusOverBlurRadius +1.0 )))) {alpha = 1.0;} else {float low = vCoord2.y - uHalfSizeOverBlurRadius.y;float high = vCoord2.y + uHalfSizeOverBlurRadius.y;float start = clamp(-1.0 , low, high);float end = clamp(1.0 , low, high);if (start == end) {alpha = 0.0;} else {const int numSamples = 4;float step = (end - start) / float(numSamples);float y = start + step * 0.5;float weightSum = 0.0;float result = 0.0;for (int i = 0; i < numSamples; i++) {float currentWeight = triangle(y);result += roundedRectangleBlurHorizontal(vCoord2.x, vCoord2.y - y,uCornerRadiusOverBlurRadius,uHalfSizeOverBlurRadius) *currentWeight;weightSum += currentWeight;y += step;}float weightNormalizationFactor =(integrateTriangle(end) - integrateTriangle(start)) / weightSum;alpha = result * weightNormalizationFactor;}}fig_FragColor = ditherColor(uColor * alpha);}`,this.GLSLX_SOURCE_ROUNDED_RECTANGLE_BLUR_VERTEX=`#version 300 es
precision highp float;uniform vec4 uQuad;uniform float uBlurRadius;uniform mat3 uVertexTransform;in vec2 aPosition2;out vec2 vCoord2;void main() {vec2 center = (uQuad.xy + uQuad.zw) * 0.5;vec2 vertex = mix(uQuad.xy - uBlurRadius, uQuad.zw + uBlurRadius, aPosition2);vCoord2 = (vertex - center) / uBlurRadius;gl_Position = vec4(uVertexTransform * vec3(vertex, 1), 0).xywz;}`,this.GLSLX_SOURCE_SMOOTH_PATH_FRAGMENT=`#version 300 es
precision highp float;in vec2 vCoord2;in vec4 vCoord4;out vec4 fig_FragColor;void main() { fig_FragColor = vCoord4 * min(1.0, min(vCoord2.x, vCoord2.y)); }`,this.GLSLX_SOURCE_SMOOTH_PATH_VERTEX=`#version 300 es
precision highp float;uniform mat3 uVertexTransform;in vec4 aCoord4;in vec4 aPosition4;out vec2 vCoord2;out vec4 vCoord4;void main() {vCoord2 = aPosition4.zw;vCoord4 = aCoord4;gl_Position = vec4(uVertexTransform * vec3(aPosition4.xy, 1.0), 0.0).xywz;}`,this.GLSLX_SOURCE_SOLID_COLOR_PAINT_FRAGMENT=`#version 300 es
precision highp float;uniform float uOpacity;uniform vec4 uColor;out vec4 fig_FragColor;void main() { fig_FragColor = uColor * uOpacity; }`,this.GLSLX_SOURCE_SOLID_COLOR_PAINT_VERTEX=`#version 300 es
precision highp float;uniform mat3 uVertexTransform;in vec2 aPosition2;out vec2 vCoord2;void main() {vCoord2 = aPosition2;gl_Position = vec4(uVertexTransform * vec3(aPosition2, 1.0), 0.0).xywz;}`,this.GLSLX_SOURCE_SUPER_SSAA4X4_DOWNSAMPLE_TEXTURE_FRAGMENT=`#version 300 es
precision highp float;uniform float uOpacity;uniform sampler2D texture0;in vec2 vCoord2;const int TILEATLAS_TILE_SIZE = 512;const int SSAA_4X4_DIMENSION = TILEATLAS_TILE_SIZE * 4;const float SSAA_4X4_PX = 1.0 / float(SSAA_4X4_DIMENSION);out vec4 fig_FragColor;void main() {vec4 downsampledColor =0.25 * (texture(texture0, vCoord2 + vec2(-SSAA_4X4_PX, -SSAA_4X4_PX)) +texture(texture0, vCoord2 + vec2(SSAA_4X4_PX, -SSAA_4X4_PX)) +texture(texture0, vCoord2 + vec2(SSAA_4X4_PX, SSAA_4X4_PX)) +texture(texture0, vCoord2 + vec2(-SSAA_4X4_PX, SSAA_4X4_PX)));fig_FragColor = downsampledColor * uOpacity;}`,this.GLSLX_SOURCE_TILE_VERTEX=`#version 300 es
precision highp float;uniform vec4 uQuad;in vec2 aPosition2;out vec2 vCoord2;void main() {vCoord2 = mix(uQuad.xy, uQuad.zw, aPosition2);gl_Position = vec4(vCoord2 * 2.0 - 1.0, 0, 1);}`,this.GLSLX_SOURCE_TWO_NON_SOLID_COLOR_PAINT_VERTEX=`#version 300 es
precision highp float;uniform mat3 uVertexTransform;uniform mat3 uPaintTransform0;uniform mat3 uPaintTransform1;in vec2 aPosition2;out vec2 vCoord2;out vec2 vCoord2b;void main() {vCoord2 = (uPaintTransform0 * vec3(aPosition2, 1)).xy;vCoord2b = (uPaintTransform1 * vec3(aPosition2, 1)).xy;gl_Position = vec4(uVertexTransform * vec3(aPosition2, 1), 0).xywz;}`,this.GLSLX_SOURCE_UNCLAMPED_BLUR_TILE_FRAGMENT=`#version 300 es
precision highp float;uniform float uCount;uniform vec2 uBlurDelta;uniform sampler2D texture0;in vec2 vCoord2;out vec4 fig_FragColor;void main() {float weight = uCount;vec4 result = texture(texture0, vCoord2) * weight;float total = weight;for (int i = 1; i < 32; i += 2) {if (float(i) > uCount) {break;}float t0 = float(i);float t1 = min(t0 + 1.0, uCount);vec2 coord0_neg = vCoord2 - uBlurDelta * t0;vec2 coord0_pos = vCoord2 + uBlurDelta * t0;vec2 coord1_neg = vCoord2 - uBlurDelta * t1;vec2 coord1_pos = vCoord2 + uBlurDelta * t1;float weight0 = uCount - t0;float weight1 = uCount - t1;float weightSum = weight0 + weight1;vec2 coord_neg = (coord0_neg * weight0 + coord1_neg * weight1) / weightSum;vec2 coord_pos = (coord0_pos * weight0 + coord1_pos * weight1) / weightSum;result += weightSum *(texture(texture0, coord_neg) + texture(texture0, coord_pos));total += 2.0 * weightSum;}fig_FragColor = result / total;}`,this.GLSLX_SOURCE_UPSAMPLE_TILE_FRAGMENT=`#version 300 es
precision highp float;const float DITHER_FACTOR = 0.003922;const float DITHER_RANGE = 2.0 * DITHER_FACTOR;float random() {vec2 coordCopy = gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898, 78.233), coordCopy)) * 43758.5453);}vec4 ditherColor(vec4 color) {float offset = (random() - 0.5) * DITHER_RANGE; return color.a > 0.0 ? min(abs(color + offset), 1.0) : color;}uniform sampler2D texture0;in vec2 vCoord2;out vec4 fig_FragColor;void main() { fig_FragColor = ditherColor(texture(texture0, vCoord2)); }`,this.GLSLX_SOURCE_UPSAMPLE_TILE_VERTEX=`#version 300 es
precision highp float;uniform vec4 uQuad;uniform vec4 uSource;in vec2 aPosition2;out vec2 vCoord2;void main() {vCoord2 = mix(uSource.xy, uSource.zw, aPosition2);gl_Position = vec4(mix(uQuad.xy, uQuad.zw, aPosition2) * 2.0 - 1.0, 0, 1);}`):(this.GLSLX_SOURCE_AAA_SHAPE_GRADIENT_FRAGMENT=`#extension GL_OES_standard_derivatives:enable
precision highp float;uniform int uType;const float PI = 3.141592;vec2 _gradientCoord(in vec2 paintUV) {const int LINEAR = 1;const int RADIAL = 2;const int ANGULAR = 3;const int DIAMOND = 4;vec2 uv = paintUV - 0.5;float t = uType == LINEAR    ? uv.x + 0.5: uType == RADIAL  ? 2.0 * length(uv): uType == ANGULAR ? fract(atan(uv.y, uv.x) / (2.0 * PI)): uType == DIAMOND ? 2.0 * max(abs(uv.x + uv.y), abs(uv.y - uv.x)): 0.0;return vec2(t, 0.25 + (0.75 - 0.25) / 256.0);}const float DITHER_FACTOR = 0.003922;const float DITHER_RANGE = 2.0 * DITHER_FACTOR;float random() {vec2 coordCopy = gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898, 78.233), coordCopy)) * 43758.5453);}vec4 ditherColor(vec4 color) {float offset = (random() - 0.5) * DITHER_RANGE; return color.a > 0.0 ? min(abs(color + offset), 1.0) : color;}const int SHAPE_TYPE_ELLIPSE = 0;const int SHAPE_TYPE_ROUNDED_RECT = 1;uniform int uShapeType;uniform vec2 uEllipseCenter;uniform vec2 uEllipseRadii;uniform vec4 uRect;uniform vec4 uCornerRadii;float ellipseImplicitEquation(in vec2 nodeSpacePoint, in vec2 ellipseCenter,in vec2 ellipseRadii) {nodeSpacePoint -= ellipseCenter;return ((nodeSpacePoint.x * nodeSpacePoint.x) /(ellipseRadii.x * ellipseRadii.x) +(nodeSpacePoint.y * nodeSpacePoint.y) /(ellipseRadii.y * ellipseRadii.y) -1.);}float roundedRectImplicitEquation(in vec2 nodeSpacePoint, in vec4 bounds,vec4 cornerRadii) {vec2 quadrantSize = (bounds.zw - bounds.xy) / 2.;vec2 ptRelativeToBoxCenter = nodeSpacePoint - quadrantSize;vec2 radiiInBoxHalf =ptRelativeToBoxCenter.x > 0. ? cornerRadii.zy : cornerRadii.wx;float radiusInBoxQuadrant =ptRelativeToBoxCenter.y > 0. ? radiiInBoxHalf.x : radiiInBoxHalf.y;vec2 q = abs(ptRelativeToBoxCenter) - quadrantSize + radiusInBoxQuadrant;return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - radiusInBoxQuadrant;}float shapeImplicitEquation(in vec2 nodeSpacePoint) {if (uShapeType == SHAPE_TYPE_ELLIPSE) {return ellipseImplicitEquation(nodeSpacePoint, uEllipseCenter,uEllipseRadii);} else if (uShapeType == SHAPE_TYPE_ROUNDED_RECT) {return roundedRectImplicitEquation(nodeSpacePoint, uRect, uCornerRadii);}return 0.;}float pixelShapeCoverage(vec2 nodeSpacePoint) {float eqValue = shapeImplicitEquation(nodeSpacePoint);float gradientLengthApprox = fwidth(eqValue);gradientLengthApprox = max(gradientLengthApprox, 0.00001);float distance = eqValue / gradientLengthApprox;return 1.0 - smoothstep(-0.5, 0.5, distance);}uniform float uOpacity;uniform sampler2D texture0;varying vec2 vNodeSpacePoint;varying vec2 vGradientSampleUV;void main() {float coverageAlpha = pixelShapeCoverage(vNodeSpacePoint);vec2 coord = _gradientCoord(vGradientSampleUV);gl_FragColor =ditherColor(texture2D(texture0, coord) * uOpacity) * coverageAlpha;}`,this.GLSLX_SOURCE_AAA_SHAPE_IMAGE_FRAGMENT=`#extension GL_OES_standard_derivatives:enable
precision highp float;const int SHAPE_TYPE_ELLIPSE = 0;const int SHAPE_TYPE_ROUNDED_RECT = 1;uniform int uShapeType;uniform vec2 uEllipseCenter;uniform vec2 uEllipseRadii;uniform vec4 uRect;uniform vec4 uCornerRadii;float ellipseImplicitEquation(in vec2 nodeSpacePoint, in vec2 ellipseCenter,in vec2 ellipseRadii) {nodeSpacePoint -= ellipseCenter;return ((nodeSpacePoint.x * nodeSpacePoint.x) /(ellipseRadii.x * ellipseRadii.x) +(nodeSpacePoint.y * nodeSpacePoint.y) /(ellipseRadii.y * ellipseRadii.y) -1.);}float roundedRectImplicitEquation(in vec2 nodeSpacePoint, in vec4 bounds,vec4 cornerRadii) {vec2 quadrantSize = (bounds.zw - bounds.xy) / 2.;vec2 ptRelativeToBoxCenter = nodeSpacePoint - quadrantSize;vec2 radiiInBoxHalf =ptRelativeToBoxCenter.x > 0. ? cornerRadii.zy : cornerRadii.wx;float radiusInBoxQuadrant =ptRelativeToBoxCenter.y > 0. ? radiiInBoxHalf.x : radiiInBoxHalf.y;vec2 q = abs(ptRelativeToBoxCenter) - quadrantSize + radiusInBoxQuadrant;return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - radiusInBoxQuadrant;}float shapeImplicitEquation(in vec2 nodeSpacePoint) {if (uShapeType == SHAPE_TYPE_ELLIPSE) {return ellipseImplicitEquation(nodeSpacePoint, uEllipseCenter,uEllipseRadii);} else if (uShapeType == SHAPE_TYPE_ROUNDED_RECT) {return roundedRectImplicitEquation(nodeSpacePoint, uRect, uCornerRadii);}return 0.;}float pixelShapeCoverage(vec2 nodeSpacePoint) {float eqValue = shapeImplicitEquation(nodeSpacePoint);float gradientLengthApprox = fwidth(eqValue);gradientLengthApprox = max(gradientLengthApprox, 0.00001);float distance = eqValue / gradientLengthApprox;return 1.0 - smoothstep(-0.5, 0.5, distance);}const vec2 AA_JITTER_PATTERN_1 = vec2(-3, -5);const vec2 AA_JITTER_PATTERN_2 = vec2(5, 1);const vec2 AA_JITTER_PATTERN_3 = vec2(-1, 3);const vec2 AA_JITTER_PATTERN_4 = vec2(7, -7);const vec2 AA_JITTER_PATTERN_5 = vec2(1, -3);const vec2 AA_JITTER_PATTERN_6 = vec2(-5, 5);const vec2 AA_JITTER_PATTERN_7 = vec2(3, 7);const vec2 AA_JITTER_PATTERN_8 = vec2(-7, -1);uniform int uEmulateWrapAddress;uniform int uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (bool(uEmulateWrapAddress)) {coord = fract(coord);}vec4 color = texture2D(tex, coord);if (bool(uEmulateBorderAddress) && coord != clamp(coord, 0.0, 1.0))color.a = 0.0;return color;}uniform sampler2D texture0;varying vec2 vPaintASample;varying vec2 vStepA;vec4 sampleImagePaintAWithMSAA() {return (sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_1 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_2 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_3 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_4 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_5 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_6 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_7 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_8 * vStepA)) /8.;}uniform float uOpacity;varying vec2 vNodeSpacePoint;void main() {vec4 color = sampleImagePaintAWithMSAA();color.rgb *= color.a;gl_FragColor = color * uOpacity * pixelShapeCoverage(vNodeSpacePoint);}`,this.GLSLX_SOURCE_AAA_SHAPE_IMAGE_COLOR_ADJUST_FRAGMENT=`#extension GL_OES_standard_derivatives:enable
precision highp float;const vec3 RGB2Y = vec3(0.2126, 0.7152, 0.0722);const float IMAGE_HIGHLIGHT_SHADOW_THRESHOLD = 0.5;uniform float uGlobalTint;uniform float uGlobalColor;uniform float uGlobalShadows;uniform float uGlobalHighlights;uniform float uGlobalExposure;uniform float uGlobalTemperature;uniform float uGlobalContrast;vec3 colorToLinear(vec3 color) {color = pow(color, vec3(2.2));return color;}vec3 colorFromLinear(vec3 color) {color = pow(color, vec3(1.0 / 2.2));return color;}float rangeFactor(vec3 color, float shadows, float highlights) {float lThreshold =dot(color, RGB2Y) - pow(IMAGE_HIGHLIGHT_SHADOW_THRESHOLD, 2.2);return 0.75 * lThreshold / sqrt(1.0 + 4.0 * lThreshold * lThreshold) *(lThreshold > 0.0 ? highlights : -shadows * 0.999);}vec3 adjustExposure(vec3 color, float exposureAdjust) {float lFactor = pow(10.0, 2.0 * exposureAdjust) - 1.0;const float lSqueeze = 0.75;float lUnsqueeze = 1.0 / (1.0 - lSqueeze) - 1.0;float gray = dot(color, RGB2Y);lUnsqueeze *= 1.0 + gray * gray * min(0.0, exposureAdjust) /(0.2 - min(0.0, exposureAdjust));color += (gray - color) * lSqueeze;if (exposureAdjust < 0.0) {color *= 1.0 + exposureAdjust / 16.0;gray *= 1.0 + exposureAdjust / 16.0;}color *= (lFactor + 1.0) / (color * lFactor + 1.0);gray *= (lFactor + 1.0) / (gray * lFactor + 1.0);color += (color - gray) * lUnsqueeze;color = clamp(color, 0.0, 1.0);return color;}vec3 adjustColor(vec3 color, float colorAdjust) {float gray = dot(color, RGB2Y);if (colorAdjust <= 0.0) {color -= (gray - color) * colorAdjust;} else {float lNeg = gray / (gray - min(min(color.r, color.g), color.b) + 1e-6);float lPos =(1.0 - gray) / (max(max(color.r, color.g), color.b) - gray + 1e-6);float lFactor = mix(1.0, min(lNeg, lPos), colorAdjust);lFactor =min(lFactor,2.0); color += (gray - color) * (1.0 - lFactor);}return color;}float smootherstep(float edge0, float edge1, float x) {x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);}vec3 adjustTempTintContrast(vec3 color, float temp, float tint,float contrast) {vec3 lXYZ = mat3(0.4124564, 0.2126729, 0.0193339, 0.3575761, 0.7151522,0.1191920, 0.1804375, 0.0721750, 0.9503041) *color;lXYZ.x /= 0.95047;lXYZ.z /= 1.08883;lXYZ = pow(lXYZ, vec3(1.0 / 3.0));vec3 lLAB = vec3(116.0 * lXYZ.y - 16.0, 500.0 * (lXYZ.x - lXYZ.y),200.0 * (lXYZ.y - lXYZ.z));lLAB.y += 30.0 * tint;lLAB.z += 30.0 * temp;float scaledThreshold = IMAGE_HIGHLIGHT_SHADOW_THRESHOLD * 100.0;float thresholdDelta = 30.0;float contrastLeftCurve =contrast < 0.0 ? (lLAB.x - scaledThreshold) * 0.2 + 50.0 : lLAB.x;float contrastRightCurve =contrast < 0.0 ? lLAB.x: smootherstep(scaledThreshold - thresholdDelta,scaledThreshold + thresholdDelta, lLAB.x) *100.0;float interp = contrast < 0.0 ? contrast + 1.0 : contrast;lLAB.x = mix(contrastLeftCurve, contrastRightCurve, interp);lXYZ.y = (lLAB.x + 16.0) / 116.0;lXYZ.x = lLAB.y / 500.0 + lXYZ.y;lXYZ.z = lXYZ.y - lLAB.z / 200.0;lXYZ *= lXYZ * lXYZ;lXYZ.x *= 0.95047;lXYZ.z *= 1.08883;color = mat3(3.2404542, -0.9692660, 0.0556434, -1.5371385, 1.8760108,-0.2040259, -0.4985314, 0.0415560, 1.0572252) *lXYZ;color = clamp(color, 0.0, 1.0);return color;}vec3 pipeline(vec3 color) {color = colorToLinear(color);float originalRangeFactor =rangeFactor(color, uGlobalShadows, uGlobalHighlights);color = adjustTempTintContrast(color, uGlobalTemperature, uGlobalTint,uGlobalContrast);color = adjustExposure(color, uGlobalExposure + originalRangeFactor);color = adjustColor(color, clamp(uGlobalColor, -1.0, 1.0));color = colorFromLinear(color);return color;}const int SHAPE_TYPE_ELLIPSE = 0;const int SHAPE_TYPE_ROUNDED_RECT = 1;uniform int uShapeType;uniform vec2 uEllipseCenter;uniform vec2 uEllipseRadii;uniform vec4 uRect;uniform vec4 uCornerRadii;float ellipseImplicitEquation(in vec2 nodeSpacePoint, in vec2 ellipseCenter,in vec2 ellipseRadii) {nodeSpacePoint -= ellipseCenter;return ((nodeSpacePoint.x * nodeSpacePoint.x) /(ellipseRadii.x * ellipseRadii.x) +(nodeSpacePoint.y * nodeSpacePoint.y) /(ellipseRadii.y * ellipseRadii.y) -1.);}float roundedRectImplicitEquation(in vec2 nodeSpacePoint, in vec4 bounds,vec4 cornerRadii) {vec2 quadrantSize = (bounds.zw - bounds.xy) / 2.;vec2 ptRelativeToBoxCenter = nodeSpacePoint - quadrantSize;vec2 radiiInBoxHalf =ptRelativeToBoxCenter.x > 0. ? cornerRadii.zy : cornerRadii.wx;float radiusInBoxQuadrant =ptRelativeToBoxCenter.y > 0. ? radiiInBoxHalf.x : radiiInBoxHalf.y;vec2 q = abs(ptRelativeToBoxCenter) - quadrantSize + radiusInBoxQuadrant;return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - radiusInBoxQuadrant;}float shapeImplicitEquation(in vec2 nodeSpacePoint) {if (uShapeType == SHAPE_TYPE_ELLIPSE) {return ellipseImplicitEquation(nodeSpacePoint, uEllipseCenter,uEllipseRadii);} else if (uShapeType == SHAPE_TYPE_ROUNDED_RECT) {return roundedRectImplicitEquation(nodeSpacePoint, uRect, uCornerRadii);}return 0.;}float pixelShapeCoverage(vec2 nodeSpacePoint) {float eqValue = shapeImplicitEquation(nodeSpacePoint);float gradientLengthApprox = fwidth(eqValue);gradientLengthApprox = max(gradientLengthApprox, 0.00001);float distance = eqValue / gradientLengthApprox;return 1.0 - smoothstep(-0.5, 0.5, distance);}const vec2 AA_JITTER_PATTERN_1 = vec2(-3, -5);const vec2 AA_JITTER_PATTERN_2 = vec2(5, 1);const vec2 AA_JITTER_PATTERN_3 = vec2(-1, 3);const vec2 AA_JITTER_PATTERN_4 = vec2(7, -7);const vec2 AA_JITTER_PATTERN_5 = vec2(1, -3);const vec2 AA_JITTER_PATTERN_6 = vec2(-5, 5);const vec2 AA_JITTER_PATTERN_7 = vec2(3, 7);const vec2 AA_JITTER_PATTERN_8 = vec2(-7, -1);uniform int uEmulateWrapAddress;uniform int uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (bool(uEmulateWrapAddress)) {coord = fract(coord);}vec4 color = texture2D(tex, coord);if (bool(uEmulateBorderAddress) && coord != clamp(coord, 0.0, 1.0))color.a = 0.0;return color;}uniform sampler2D texture0;varying vec2 vPaintASample;varying vec2 vStepA;vec4 sampleImagePaintAWithMSAA() {return (sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_1 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_2 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_3 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_4 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_5 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_6 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_7 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_8 * vStepA)) /8.;}uniform float uOpacity;varying vec2 vNodeSpacePoint;void main() {vec4 color = sampleImagePaintAWithMSAA();color.rgb = pipeline(color.rgb) * color.a;gl_FragColor = color * uOpacity * pixelShapeCoverage(vNodeSpacePoint);}`,this.GLSLX_SOURCE_AAA_SHAPE_LERP_GRADIENT_FRAGMENT=`#extension GL_OES_standard_derivatives:enable
precision highp float;uniform int uType;const float PI = 3.141592;vec2 _gradientCoord(in vec2 paintUV) {const int LINEAR = 1;const int RADIAL = 2;const int ANGULAR = 3;const int DIAMOND = 4;vec2 uv = paintUV - 0.5;float t = uType == LINEAR    ? uv.x + 0.5: uType == RADIAL  ? 2.0 * length(uv): uType == ANGULAR ? fract(atan(uv.y, uv.x) / (2.0 * PI)): uType == DIAMOND ? 2.0 * max(abs(uv.x + uv.y), abs(uv.y - uv.x)): 0.0;return vec2(t, 0.25 + (0.75 - 0.25) / 256.0);}const float DITHER_FACTOR = 0.003922;const float DITHER_RANGE = 2.0 * DITHER_FACTOR;float random() {vec2 coordCopy = gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898, 78.233), coordCopy)) * 43758.5453);}vec4 ditherColor(vec4 color) {float offset = (random() - 0.5) * DITHER_RANGE; return color.a > 0.0 ? min(abs(color + offset), 1.0) : color;}const int SHAPE_TYPE_ELLIPSE = 0;const int SHAPE_TYPE_ROUNDED_RECT = 1;uniform int uShapeType;uniform vec2 uEllipseCenter;uniform vec2 uEllipseRadii;uniform vec4 uRect;uniform vec4 uCornerRadii;float ellipseImplicitEquation(in vec2 nodeSpacePoint, in vec2 ellipseCenter,in vec2 ellipseRadii) {nodeSpacePoint -= ellipseCenter;return ((nodeSpacePoint.x * nodeSpacePoint.x) /(ellipseRadii.x * ellipseRadii.x) +(nodeSpacePoint.y * nodeSpacePoint.y) /(ellipseRadii.y * ellipseRadii.y) -1.);}float roundedRectImplicitEquation(in vec2 nodeSpacePoint, in vec4 bounds,vec4 cornerRadii) {vec2 quadrantSize = (bounds.zw - bounds.xy) / 2.;vec2 ptRelativeToBoxCenter = nodeSpacePoint - quadrantSize;vec2 radiiInBoxHalf =ptRelativeToBoxCenter.x > 0. ? cornerRadii.zy : cornerRadii.wx;float radiusInBoxQuadrant =ptRelativeToBoxCenter.y > 0. ? radiiInBoxHalf.x : radiiInBoxHalf.y;vec2 q = abs(ptRelativeToBoxCenter) - quadrantSize + radiusInBoxQuadrant;return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - radiusInBoxQuadrant;}float shapeImplicitEquation(in vec2 nodeSpacePoint) {if (uShapeType == SHAPE_TYPE_ELLIPSE) {return ellipseImplicitEquation(nodeSpacePoint, uEllipseCenter,uEllipseRadii);} else if (uShapeType == SHAPE_TYPE_ROUNDED_RECT) {return roundedRectImplicitEquation(nodeSpacePoint, uRect, uCornerRadii);}return 0.;}float pixelShapeCoverage(vec2 nodeSpacePoint) {float eqValue = shapeImplicitEquation(nodeSpacePoint);float gradientLengthApprox = fwidth(eqValue);gradientLengthApprox = max(gradientLengthApprox, 0.00001);float distance = eqValue / gradientLengthApprox;return 1.0 - smoothstep(-0.5, 0.5, distance);}uniform float uOpacity;uniform float uProgress;uniform sampler2D texture0;uniform sampler2D texture1;varying vec2 vNodeSpacePoint;varying vec2 vGradientSampleUV;void main() {float coverageAlpha = pixelShapeCoverage(vNodeSpacePoint);vec2 coord = _gradientCoord(vGradientSampleUV);vec4 lerped =mix(texture2D(texture0, coord), texture2D(texture1, coord), uProgress);gl_FragColor = ditherColor(lerped * uOpacity) * coverageAlpha;}`,this.GLSLX_SOURCE_AAA_SHAPE_LERP_IMAGE_FRAGMENT=`#extension GL_OES_standard_derivatives:enable
precision highp float;const int SHAPE_TYPE_ELLIPSE = 0;const int SHAPE_TYPE_ROUNDED_RECT = 1;uniform int uShapeType;uniform vec2 uEllipseCenter;uniform vec2 uEllipseRadii;uniform vec4 uRect;uniform vec4 uCornerRadii;float ellipseImplicitEquation(in vec2 nodeSpacePoint, in vec2 ellipseCenter,in vec2 ellipseRadii) {nodeSpacePoint -= ellipseCenter;return ((nodeSpacePoint.x * nodeSpacePoint.x) /(ellipseRadii.x * ellipseRadii.x) +(nodeSpacePoint.y * nodeSpacePoint.y) /(ellipseRadii.y * ellipseRadii.y) -1.);}float roundedRectImplicitEquation(in vec2 nodeSpacePoint, in vec4 bounds,vec4 cornerRadii) {vec2 quadrantSize = (bounds.zw - bounds.xy) / 2.;vec2 ptRelativeToBoxCenter = nodeSpacePoint - quadrantSize;vec2 radiiInBoxHalf =ptRelativeToBoxCenter.x > 0. ? cornerRadii.zy : cornerRadii.wx;float radiusInBoxQuadrant =ptRelativeToBoxCenter.y > 0. ? radiiInBoxHalf.x : radiiInBoxHalf.y;vec2 q = abs(ptRelativeToBoxCenter) - quadrantSize + radiusInBoxQuadrant;return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - radiusInBoxQuadrant;}float shapeImplicitEquation(in vec2 nodeSpacePoint) {if (uShapeType == SHAPE_TYPE_ELLIPSE) {return ellipseImplicitEquation(nodeSpacePoint, uEllipseCenter,uEllipseRadii);} else if (uShapeType == SHAPE_TYPE_ROUNDED_RECT) {return roundedRectImplicitEquation(nodeSpacePoint, uRect, uCornerRadii);}return 0.;}float pixelShapeCoverage(vec2 nodeSpacePoint) {float eqValue = shapeImplicitEquation(nodeSpacePoint);float gradientLengthApprox = fwidth(eqValue);gradientLengthApprox = max(gradientLengthApprox, 0.00001);float distance = eqValue / gradientLengthApprox;return 1.0 - smoothstep(-0.5, 0.5, distance);}const vec2 AA_JITTER_PATTERN_1 = vec2(-3, -5);const vec2 AA_JITTER_PATTERN_2 = vec2(5, 1);const vec2 AA_JITTER_PATTERN_3 = vec2(-1, 3);const vec2 AA_JITTER_PATTERN_4 = vec2(7, -7);const vec2 AA_JITTER_PATTERN_5 = vec2(1, -3);const vec2 AA_JITTER_PATTERN_6 = vec2(-5, 5);const vec2 AA_JITTER_PATTERN_7 = vec2(3, 7);const vec2 AA_JITTER_PATTERN_8 = vec2(-7, -1);uniform int uEmulateWrapAddress;uniform int uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (bool(uEmulateWrapAddress)) {coord = fract(coord);}vec4 color = texture2D(tex, coord);if (bool(uEmulateBorderAddress) && coord != clamp(coord, 0.0, 1.0))color.a = 0.0;return color;}uniform sampler2D texture0;varying vec2 vPaintASample;varying vec2 vStepA;vec4 sampleImagePaintAWithMSAA() {return (sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_1 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_2 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_3 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_4 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_5 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_6 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_7 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_8 * vStepA)) /8.;}uniform sampler2D texture1;varying vec2 vPaintBSample;varying vec2 vStepB;vec4 sampleImagePaintBWithMSAA() {return (sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_1 * vStepB) +sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_2 * vStepB) +sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_3 * vStepB) +sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_4 * vStepB) +sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_5 * vStepB) +sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_6 * vStepB) +sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_7 * vStepB) +sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_8 * vStepB)) /8.;}uniform float uOpacity;uniform float uProgress;varying vec2 vNodeSpacePoint;void main() {vec4 imageA = sampleImagePaintAWithMSAA();vec4 imageB = sampleImagePaintBWithMSAA();vec4 lerped = mix(imageA, imageB, uProgress);lerped.rgb *= lerped.a;gl_FragColor = lerped * uOpacity * pixelShapeCoverage(vNodeSpacePoint);}`,this.GLSLX_SOURCE_AAA_SHAPE_LERP_IMAGE_COLOR_ADJUST_FRAGMENT=`#extension GL_OES_standard_derivatives:enable
precision highp float;const vec3 RGB2Y = vec3(0.2126, 0.7152, 0.0722);const float IMAGE_HIGHLIGHT_SHADOW_THRESHOLD = 0.5;uniform float uGlobalTint;uniform float uGlobalColor;uniform float uGlobalShadows;uniform float uGlobalHighlights;uniform float uGlobalExposure;uniform float uGlobalTemperature;uniform float uGlobalContrast;vec3 colorToLinear(vec3 color) {color = pow(color, vec3(2.2));return color;}vec3 colorFromLinear(vec3 color) {color = pow(color, vec3(1.0 / 2.2));return color;}float rangeFactor(vec3 color, float shadows, float highlights) {float lThreshold =dot(color, RGB2Y) - pow(IMAGE_HIGHLIGHT_SHADOW_THRESHOLD, 2.2);return 0.75 * lThreshold / sqrt(1.0 + 4.0 * lThreshold * lThreshold) *(lThreshold > 0.0 ? highlights : -shadows * 0.999);}vec3 adjustExposure(vec3 color, float exposureAdjust) {float lFactor = pow(10.0, 2.0 * exposureAdjust) - 1.0;const float lSqueeze = 0.75;float lUnsqueeze = 1.0 / (1.0 - lSqueeze) - 1.0;float gray = dot(color, RGB2Y);lUnsqueeze *= 1.0 + gray * gray * min(0.0, exposureAdjust) /(0.2 - min(0.0, exposureAdjust));color += (gray - color) * lSqueeze;if (exposureAdjust < 0.0) {color *= 1.0 + exposureAdjust / 16.0;gray *= 1.0 + exposureAdjust / 16.0;}color *= (lFactor + 1.0) / (color * lFactor + 1.0);gray *= (lFactor + 1.0) / (gray * lFactor + 1.0);color += (color - gray) * lUnsqueeze;color = clamp(color, 0.0, 1.0);return color;}vec3 adjustColor(vec3 color, float colorAdjust) {float gray = dot(color, RGB2Y);if (colorAdjust <= 0.0) {color -= (gray - color) * colorAdjust;} else {float lNeg = gray / (gray - min(min(color.r, color.g), color.b) + 1e-6);float lPos =(1.0 - gray) / (max(max(color.r, color.g), color.b) - gray + 1e-6);float lFactor = mix(1.0, min(lNeg, lPos), colorAdjust);lFactor =min(lFactor,2.0); color += (gray - color) * (1.0 - lFactor);}return color;}float smootherstep(float edge0, float edge1, float x) {x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);}vec3 adjustTempTintContrast(vec3 color, float temp, float tint,float contrast) {vec3 lXYZ = mat3(0.4124564, 0.2126729, 0.0193339, 0.3575761, 0.7151522,0.1191920, 0.1804375, 0.0721750, 0.9503041) *color;lXYZ.x /= 0.95047;lXYZ.z /= 1.08883;lXYZ = pow(lXYZ, vec3(1.0 / 3.0));vec3 lLAB = vec3(116.0 * lXYZ.y - 16.0, 500.0 * (lXYZ.x - lXYZ.y),200.0 * (lXYZ.y - lXYZ.z));lLAB.y += 30.0 * tint;lLAB.z += 30.0 * temp;float scaledThreshold = IMAGE_HIGHLIGHT_SHADOW_THRESHOLD * 100.0;float thresholdDelta = 30.0;float contrastLeftCurve =contrast < 0.0 ? (lLAB.x - scaledThreshold) * 0.2 + 50.0 : lLAB.x;float contrastRightCurve =contrast < 0.0 ? lLAB.x: smootherstep(scaledThreshold - thresholdDelta,scaledThreshold + thresholdDelta, lLAB.x) *100.0;float interp = contrast < 0.0 ? contrast + 1.0 : contrast;lLAB.x = mix(contrastLeftCurve, contrastRightCurve, interp);lXYZ.y = (lLAB.x + 16.0) / 116.0;lXYZ.x = lLAB.y / 500.0 + lXYZ.y;lXYZ.z = lXYZ.y - lLAB.z / 200.0;lXYZ *= lXYZ * lXYZ;lXYZ.x *= 0.95047;lXYZ.z *= 1.08883;color = mat3(3.2404542, -0.9692660, 0.0556434, -1.5371385, 1.8760108,-0.2040259, -0.4985314, 0.0415560, 1.0572252) *lXYZ;color = clamp(color, 0.0, 1.0);return color;}vec3 pipeline(vec3 color) {color = colorToLinear(color);float originalRangeFactor =rangeFactor(color, uGlobalShadows, uGlobalHighlights);color = adjustTempTintContrast(color, uGlobalTemperature, uGlobalTint,uGlobalContrast);color = adjustExposure(color, uGlobalExposure + originalRangeFactor);color = adjustColor(color, clamp(uGlobalColor, -1.0, 1.0));color = colorFromLinear(color);return color;}const int SHAPE_TYPE_ELLIPSE = 0;const int SHAPE_TYPE_ROUNDED_RECT = 1;uniform int uShapeType;uniform vec2 uEllipseCenter;uniform vec2 uEllipseRadii;uniform vec4 uRect;uniform vec4 uCornerRadii;float ellipseImplicitEquation(in vec2 nodeSpacePoint, in vec2 ellipseCenter,in vec2 ellipseRadii) {nodeSpacePoint -= ellipseCenter;return ((nodeSpacePoint.x * nodeSpacePoint.x) /(ellipseRadii.x * ellipseRadii.x) +(nodeSpacePoint.y * nodeSpacePoint.y) /(ellipseRadii.y * ellipseRadii.y) -1.);}float roundedRectImplicitEquation(in vec2 nodeSpacePoint, in vec4 bounds,vec4 cornerRadii) {vec2 quadrantSize = (bounds.zw - bounds.xy) / 2.;vec2 ptRelativeToBoxCenter = nodeSpacePoint - quadrantSize;vec2 radiiInBoxHalf =ptRelativeToBoxCenter.x > 0. ? cornerRadii.zy : cornerRadii.wx;float radiusInBoxQuadrant =ptRelativeToBoxCenter.y > 0. ? radiiInBoxHalf.x : radiiInBoxHalf.y;vec2 q = abs(ptRelativeToBoxCenter) - quadrantSize + radiusInBoxQuadrant;return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - radiusInBoxQuadrant;}float shapeImplicitEquation(in vec2 nodeSpacePoint) {if (uShapeType == SHAPE_TYPE_ELLIPSE) {return ellipseImplicitEquation(nodeSpacePoint, uEllipseCenter,uEllipseRadii);} else if (uShapeType == SHAPE_TYPE_ROUNDED_RECT) {return roundedRectImplicitEquation(nodeSpacePoint, uRect, uCornerRadii);}return 0.;}float pixelShapeCoverage(vec2 nodeSpacePoint) {float eqValue = shapeImplicitEquation(nodeSpacePoint);float gradientLengthApprox = fwidth(eqValue);gradientLengthApprox = max(gradientLengthApprox, 0.00001);float distance = eqValue / gradientLengthApprox;return 1.0 - smoothstep(-0.5, 0.5, distance);}const vec2 AA_JITTER_PATTERN_1 = vec2(-3, -5);const vec2 AA_JITTER_PATTERN_2 = vec2(5, 1);const vec2 AA_JITTER_PATTERN_3 = vec2(-1, 3);const vec2 AA_JITTER_PATTERN_4 = vec2(7, -7);const vec2 AA_JITTER_PATTERN_5 = vec2(1, -3);const vec2 AA_JITTER_PATTERN_6 = vec2(-5, 5);const vec2 AA_JITTER_PATTERN_7 = vec2(3, 7);const vec2 AA_JITTER_PATTERN_8 = vec2(-7, -1);uniform int uEmulateWrapAddress;uniform int uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (bool(uEmulateWrapAddress)) {coord = fract(coord);}vec4 color = texture2D(tex, coord);if (bool(uEmulateBorderAddress) && coord != clamp(coord, 0.0, 1.0))color.a = 0.0;return color;}uniform sampler2D texture0;varying vec2 vPaintASample;varying vec2 vStepA;vec4 sampleImagePaintAWithMSAA() {return (sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_1 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_2 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_3 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_4 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_5 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_6 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_7 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_8 * vStepA)) /8.;}uniform sampler2D texture1;varying vec2 vPaintBSample;varying vec2 vStepB;vec4 sampleImagePaintBWithMSAA() {return (sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_1 * vStepB) +sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_2 * vStepB) +sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_3 * vStepB) +sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_4 * vStepB) +sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_5 * vStepB) +sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_6 * vStepB) +sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_7 * vStepB) +sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_8 * vStepB)) /8.;}uniform float uOpacity;uniform float uProgress;varying vec2 vNodeSpacePoint;void main() {vec4 imageA = sampleImagePaintAWithMSAA();vec4 imageB = sampleImagePaintBWithMSAA();vec4 lerped = mix(imageA, imageB, uProgress);lerped.rgb = pipeline(lerped.rgb) * lerped.a;gl_FragColor = lerped * uOpacity * pixelShapeCoverage(vNodeSpacePoint);}`,this.GLSLX_SOURCE_AAA_SHAPE_NON_SOLID_COLOR_PAINT_VERTEX="precision highp float;const vec2 AA_JITTER_STEP = vec2(1. / 16., 1. / 16.);uniform vec2 uPathSize;uniform float uPixelRatio;uniform mat3 uPaintTransform0;void setMSAAVaryingsForImagePaintA(vec2 shapeUv, out vec2 vPaintASample,out vec2 vStepA) {vec2 uvPixelSize = 1.0 / uPathSize / uPixelRatio;vPaintASample = (uPaintTransform0 * vec3(shapeUv, 1)).xy;vStepA =(uPaintTransform0 * vec3(shapeUv + AA_JITTER_STEP * uvPixelSize, 1)).xy -vPaintASample;}uniform vec2 uUvScale;vec2 uvExcludingBorderScreenspacePixel(in vec2 uv) {return (uv - vec2(.5, .5)) * uUvScale + vec2(.5, .5);}uniform mat3 uVertexTransform;attribute vec2 aPosition2;varying vec2 vNodeSpacePoint;varying vec2 vGradientSampleUV;varying vec2 vPaintASample;varying vec2 vStepA;void main() {vec2 shapeUv = uvExcludingBorderScreenspacePixel(aPosition2);vNodeSpacePoint = shapeUv * uPathSize;vGradientSampleUV = (uPaintTransform0 * vec3(shapeUv, 1)).xy;setMSAAVaryingsForImagePaintA(shapeUv, vPaintASample, vStepA);gl_Position = vec4(uVertexTransform * vec3(aPosition2, 1), 0).xywz;}",this.GLSLX_SOURCE_AAA_SHAPE_SOLID_COLOR_PAINT_FRAGMENT=`#extension GL_OES_standard_derivatives:enable
precision highp float;const int SHAPE_TYPE_ELLIPSE = 0;const int SHAPE_TYPE_ROUNDED_RECT = 1;uniform int uShapeType;uniform vec2 uEllipseCenter;uniform vec2 uEllipseRadii;uniform vec4 uRect;uniform vec4 uCornerRadii;float ellipseImplicitEquation(in vec2 nodeSpacePoint, in vec2 ellipseCenter,in vec2 ellipseRadii) {nodeSpacePoint -= ellipseCenter;return ((nodeSpacePoint.x * nodeSpacePoint.x) /(ellipseRadii.x * ellipseRadii.x) +(nodeSpacePoint.y * nodeSpacePoint.y) /(ellipseRadii.y * ellipseRadii.y) -1.);}float roundedRectImplicitEquation(in vec2 nodeSpacePoint, in vec4 bounds,vec4 cornerRadii) {vec2 quadrantSize = (bounds.zw - bounds.xy) / 2.;vec2 ptRelativeToBoxCenter = nodeSpacePoint - quadrantSize;vec2 radiiInBoxHalf =ptRelativeToBoxCenter.x > 0. ? cornerRadii.zy : cornerRadii.wx;float radiusInBoxQuadrant =ptRelativeToBoxCenter.y > 0. ? radiiInBoxHalf.x : radiiInBoxHalf.y;vec2 q = abs(ptRelativeToBoxCenter) - quadrantSize + radiusInBoxQuadrant;return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - radiusInBoxQuadrant;}float shapeImplicitEquation(in vec2 nodeSpacePoint) {if (uShapeType == SHAPE_TYPE_ELLIPSE) {return ellipseImplicitEquation(nodeSpacePoint, uEllipseCenter,uEllipseRadii);} else if (uShapeType == SHAPE_TYPE_ROUNDED_RECT) {return roundedRectImplicitEquation(nodeSpacePoint, uRect, uCornerRadii);}return 0.;}float pixelShapeCoverage(vec2 nodeSpacePoint) {float eqValue = shapeImplicitEquation(nodeSpacePoint);float gradientLengthApprox = fwidth(eqValue);gradientLengthApprox = max(gradientLengthApprox, 0.00001);float distance = eqValue / gradientLengthApprox;return 1.0 - smoothstep(-0.5, 0.5, distance);}uniform float uOpacity;uniform vec4 uColor;varying vec2 vNodeSpacePoint;void main() {float coverageAlpha = pixelShapeCoverage(vNodeSpacePoint);gl_FragColor = uColor * uOpacity * coverageAlpha;}`,this.GLSLX_SOURCE_AAA_SHAPE_SOLID_COLOR_PAINT_VERTEX="precision highp float;uniform vec2 uUvScale;vec2 uvExcludingBorderScreenspacePixel(in vec2 uv) {return (uv - vec2(.5, .5)) * uUvScale + vec2(.5, .5);}uniform vec2 uPathSize;uniform mat3 uVertexTransform;attribute vec2 aPosition2;varying vec2 vNodeSpacePoint;void main() {vec2 shapeUv = uvExcludingBorderScreenspacePixel(aPosition2);vNodeSpacePoint = shapeUv * uPathSize;gl_Position = vec4(uVertexTransform * vec3(aPosition2, 1.0), 0.0).xywz;}",this.GLSLX_SOURCE_AAA_SHAPE_TWO_NON_SOLID_COLOR_PAINT_VERTEX="precision highp float;const vec2 AA_JITTER_STEP = vec2(1. / 16., 1. / 16.);uniform vec2 uPathSize;uniform float uPixelRatio;uniform mat3 uPaintTransform0;void setMSAAVaryingsForImagePaintA(vec2 shapeUv, out vec2 vPaintASample,out vec2 vStepA) {vec2 uvPixelSize = 1.0 / uPathSize / uPixelRatio;vPaintASample = (uPaintTransform0 * vec3(shapeUv, 1)).xy;vStepA =(uPaintTransform0 * vec3(shapeUv + AA_JITTER_STEP * uvPixelSize, 1)).xy -vPaintASample;}uniform vec2 uUvScale;vec2 uvExcludingBorderScreenspacePixel(in vec2 uv) {return (uv - vec2(.5, .5)) * uUvScale + vec2(.5, .5);}uniform mat3 uVertexTransform;uniform mat3 uPaintTransform1;attribute vec2 aPosition2;varying vec2 vPaintASample;varying vec2 vStepA;varying vec2 vPaintBSample;varying vec2 vStepB;varying vec2 vNodeSpacePoint;varying vec2 vGradientSampleUV;void setMSAAVaryingsForImagePaintB(vec2 shapeUv) {vec2 uvPixelSize = 1.0 / uPathSize / uPixelRatio;vPaintBSample = (uPaintTransform1 * vec3(shapeUv, 1)).xy;vStepB =(uPaintTransform1 * vec3(shapeUv + AA_JITTER_STEP * uvPixelSize, 1)).xy -vPaintBSample;}void main() {vec2 shapeUv = uvExcludingBorderScreenspacePixel(aPosition2);vNodeSpacePoint = shapeUv * uPathSize;vGradientSampleUV = (uPaintTransform0 * vec3(shapeUv, 1)).xy;setMSAAVaryingsForImagePaintA(shapeUv, vPaintASample, vStepA);setMSAAVaryingsForImagePaintB(shapeUv);gl_Position = vec4(uVertexTransform * vec3(aPosition2, 1), 0).xywz;}",this.GLSLX_SOURCE_BLEND_MODE_FRAGMENT="precision highp float;const float DITHER_FACTOR = 0.003922;uniform float uOpacity;uniform int uType;uniform sampler2D texture0;uniform sampler2D texture1;varying vec2 vCoord2;float minv3(vec3 c) { return min(min(c.r, c.g), c.b); }float maxv3(vec3 c) { return max(max(c.r, c.g), c.b); }float satv3(vec3 c) { return maxv3(c) - minv3(c); }float lumv3(vec3 c) {return dot(c, vec3(0.30, 0.59, 0.11)); }vec3 setLum(vec3 cbase, vec3 clum) {cbase = clamp(cbase, 0.0, 1.0);clum = clamp(clum, 0.0, 1.0);float llum = lumv3(clum);vec3 color = cbase + (llum - lumv3(cbase));float minc = minv3(color);float maxc = maxv3(color);if (minc < 0.0) {color = mix(vec3(llum), color, llum / (llum - minc));} else if (maxc > 1.0) {color = mix(vec3(llum), color, (1.0 - llum) / (maxc - llum));}return color;}vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum) {float sbase = satv3(cbase);vec3 color = vec3(0.0);if (sbase > 0.0) {float minbase = minv3(cbase);float ssat = satv3(csat);color = (cbase - minbase) * ssat / sbase;}return setLum(color, clum);}void main() {const int DARKEN = 2;const int MULTIPLY = 3;const int LINEAR_BURN = 4;const int COLOR_BURN = 5;const int LIGHTEN = 6;const int SCREEN = 7;const int LINEAR_DODGE = 8;const int COLOR_DODGE = 9;const int OVERLAY = 10;const int SOFT_LIGHT = 11;const int HARD_LIGHT = 12;const int DIFFERENCE = 13;const int EXCLUSION = 14;const int HUE = 15;const int SATURATION = 16;const int COLOR = 17;const int LUMINOSITY = 18;vec4 source = texture2D(texture0, vCoord2) * uOpacity;vec4 target = texture2D(texture1, vCoord2);float Sa = source.a;float Da = target.a;vec3 Dca = target.rgb;if (Sa == 0.0) {gl_FragColor = vec4(Dca, Da);}else {float epsilon = 0.000001;vec3 Sca = source.rgb;vec3 color = Sca * (1.0 - Da) + Dca * (1.0 - Sa);if (uType == DARKEN) {color += min(Sca * Da, Dca * Sa);}else if (uType == MULTIPLY) {color += Sca * Dca;}else if (uType == LINEAR_BURN) {color = max(vec3(0.0), Sca + Dca - Sa * Da);}else if (uType == COLOR_BURN) {vec3 denominator = max(Sca * Da, DITHER_FACTOR);vec3 numerator = (Da - Dca) * Sa * step(DITHER_FACTOR, Da - Dca);color += Sa * Da * (1.0 - min(vec3(1.0), numerator / denominator));}else if (uType == LIGHTEN) {color += max(Sca * Da, Dca * Sa);}else if (uType == SCREEN) {color = Sca + Dca - Sca * Dca;}else if (uType == LINEAR_DODGE) {color = min(vec3(1.0), Sca + Dca);}else if (uType == COLOR_DODGE) {vec3 denominator = max(Da * (Sa - Sca), DITHER_FACTOR);vec3 numerator = Dca * Sa * step(DITHER_FACTOR, Dca);color += Sa * Da * min(vec3(1.0), numerator / denominator);}else if (uType == OVERLAY) {color += mix(Sa * Da - 2.0 * (Da - Dca) * (Sa - Sca), 2.0 * Sca * Dca,vec3(lessThanEqual(2.0 * Dca, vec3(Da))));}else if (uType == HARD_LIGHT) {color += mix(2.0 * Sca * Dca, Sa * Da - 2.0 * (Da - Dca) * (Sa - Sca),vec3(greaterThan(2.0 * Sca, vec3(Sa))));}else if (uType == DIFFERENCE) {color += abs(Dca * Sa - Sca * Da);}else if (uType == EXCLUSION) {color += Sca * Da + Dca * Sa - 2.0 * Sca * Dca;}else {vec3 delta = vec3(0.0);vec3 Sc = Sca;vec3 Dc = Dca;if (Sa > 0.0)Sc /= Sa;if (Da > 0.0)Dc /= Da;if (uType == SOFT_LIGHT) {vec3 c0 = 1.0 - Dc;vec3 c1 = (16.0 * Dc - 12.0) * Dc + 3.0;vec3 c2 = inversesqrt(Dc + epsilon) - 1.0;vec3 c = mix(c1, c2, vec3(greaterThan(Dc, vec3(0.25))));c = mix(c, c0, vec3(greaterThan(Sc, vec3(0.50))));delta = Dc * (1.0 + c * (2.0 * Sc - 1.0));}else if (uType == HUE) {delta = setLumSat(Sc, Dc, Dc);}else if (uType == SATURATION) {delta = setLumSat(Dc, Sc, Dc);}else if (uType == COLOR) {delta = setLum(Sc, Dc);}else if (uType == LUMINOSITY) {delta = setLum(Dc, Sc);}color += Sa * Da * delta;}gl_FragColor = vec4(color, Sa + Da - Sa * Da);}}",this.GLSLX_SOURCE_BLEND_TEXTURE_FRAGMENT="precision highp float;uniform float uOpacity;uniform sampler2D texture0;varying vec2 vCoord2;void main() { gl_FragColor = texture2D(texture0, vCoord2) * uOpacity; }",this.GLSLX_SOURCE_CLAMPED_BLUR_TILE_FRAGMENT="precision highp float;uniform float uCount;uniform vec2 uBlurDelta;uniform vec4 uBlurClamp;uniform sampler2D texture0;varying vec2 vCoord2;void main() {vec2 coord2 = clamp(vCoord2, uBlurClamp.xy, uBlurClamp.zw);float weight = uCount;vec4 result = texture2D(texture0, coord2) * weight;float total = weight;for (int i = 1; i < 32; i += 2) {if (float(i) > uCount) {break;}float t0 = float(i);float t1 = min(t0 + 1.0, uCount);vec2 coord0_neg = coord2 - uBlurDelta * t0;vec2 coord0_pos = coord2 + uBlurDelta * t0;vec2 coord1_neg = coord2 - uBlurDelta * t1;vec2 coord1_pos = coord2 + uBlurDelta * t1;float weight0_neg =(uCount - t0) *float(coord0_neg == clamp(coord0_neg, uBlurClamp.xy, uBlurClamp.zw));float weight0_pos =(uCount - t0) *float(coord0_pos == clamp(coord0_pos, uBlurClamp.xy, uBlurClamp.zw));float weight1_neg =(uCount - t1) *float(coord1_neg == clamp(coord1_neg, uBlurClamp.xy, uBlurClamp.zw));float weight1_pos =(uCount - t1) *float(coord1_pos == clamp(coord1_pos, uBlurClamp.xy, uBlurClamp.zw));float weight_neg = weight0_neg + weight1_neg;float weight_pos = weight0_pos + weight1_pos;vec2 coord_neg =(coord0_neg * weight0_neg + coord1_neg * weight1_neg) / weight_neg;vec2 coord_pos =(coord0_pos * weight0_pos + coord1_pos * weight1_pos) / weight_pos;result += texture2D(texture0, coord_neg) * weight_neg +texture2D(texture0, coord_pos) * weight_pos;total += weight_neg + weight_pos;}gl_FragColor = result / total;}",this.GLSLX_SOURCE_CLIP_SPACE_QUAD_VERTEX="precision highp float;attribute vec2 aPosition2;varying vec2 vCoord2;void main() {vCoord2 = aPosition2;gl_Position = vec4(aPosition2 * 2.0 - 1.0, 0.0, 1.0);}",this.GLSLX_SOURCE_COPY_TILE_VERTEX="precision highp float;uniform vec4 uQuad;attribute vec2 aPosition2;void main() { gl_Position = vec4(mix(uQuad.xy, uQuad.zw, aPosition2), 0, 1); }",this.GLSLX_SOURCE_DOWNSAMPLE_TILE_FRAGMENT="precision highp float;uniform sampler2D texture0;varying vec2 vCoord2;void main() { gl_FragColor = texture2D(texture0, vCoord2); }",this.GLSLX_SOURCE_DOWNSAMPLE_TILE_VERTEX="precision highp float;uniform vec4 uQuad;uniform vec4 uSource;attribute vec2 aPosition2;varying vec2 vCoord2;void main() {vCoord2 = mix(uSource.xy, uSource.zw, aPosition2);gl_Position = vec4(mix(uQuad.xy, uQuad.zw, aPosition2) * 2.0 - 1.0, 0, 1);}",this.GLSLX_SOURCE_DRAW_TEXTURE_FRAGMENT="precision highp float;uniform float uOpacity;uniform vec4 uUvSpaceClampingRect;uniform vec4 uUvSpaceSourceRect;uniform sampler2D texture0;varying vec2 vCoord2;const bool drawDebugStuff = false;void main() {vec2 sampleCoordinates =clamp(vCoord2, uUvSpaceClampingRect.xy, uUvSpaceClampingRect.zw);gl_FragColor = texture2D(texture0, sampleCoordinates) * uOpacity;if (drawDebugStuff) {vec2 tt = 2.0 * abs((vCoord2 - uUvSpaceSourceRect.xy) /(uUvSpaceSourceRect.zw - uUvSpaceSourceRect.xy) -0.5);float t = max(tt.x, tt.y);if (t > 0.99) {gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);}}}",this.GLSLX_SOURCE_DRAW_TEXTURE_VERTEX="precision highp float;uniform vec4 uUvSpaceSourceRect;uniform mat3 uToClipSpaceTransform;uniform vec4 uDestinationRect;attribute vec2 aPosition2;varying vec2 vCoord2;void main() {vCoord2 = mix(uUvSpaceSourceRect.xy, uUvSpaceSourceRect.zw, aPosition2);gl_Position = vec4((uToClipSpaceTransform *vec3(mix(uDestinationRect.xy, uDestinationRect.zw, aPosition2), 1.0)).xy,0, 1);}",this.GLSLX_SOURCE_GRADIENT_FRAGMENT="precision highp float;uniform int uType;const float PI = 3.141592;vec2 _gradientCoord(in vec2 paintUV) {const int LINEAR = 1;const int RADIAL = 2;const int ANGULAR = 3;const int DIAMOND = 4;vec2 uv = paintUV - 0.5;float t = uType == LINEAR    ? uv.x + 0.5: uType == RADIAL  ? 2.0 * length(uv): uType == ANGULAR ? fract(atan(uv.y, uv.x) / (2.0 * PI)): uType == DIAMOND ? 2.0 * max(abs(uv.x + uv.y), abs(uv.y - uv.x)): 0.0;return vec2(t, 0.25 + (0.75 - 0.25) / 256.0);}const float DITHER_FACTOR = 0.003922;const float DITHER_RANGE = 2.0 * DITHER_FACTOR;float random() {vec2 coordCopy = gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898, 78.233), coordCopy)) * 43758.5453);}vec4 ditherColor(vec4 color) {float offset = (random() - 0.5) * DITHER_RANGE; return color.a > 0.0 ? min(abs(color + offset), 1.0) : color;}uniform float uOpacity;uniform sampler2D texture0;varying vec2 vCoord2;void main() {vec2 coord = _gradientCoord(vCoord2);gl_FragColor = ditherColor(texture2D(texture0, coord) * uOpacity);}",this.GLSLX_SOURCE_HARD_MASK_TILE_WITH_COLOR_FRAGMENT="precision highp float;uniform sampler2D texture0;uniform vec4 uColor;varying vec2 vCoord2;void main() {gl_FragColor = float(texture2D(texture0, vCoord2).a > 0.0) * uColor;}",this.GLSLX_SOURCE_HARD_MASK_WITH_COLOR_AND_DOWNSAMPLE_TILE_FRAGMENT="precision highp float;uniform vec4 uColor;uniform float uTextureSize;uniform float uTexturePx;uniform sampler2D texture0;varying vec2 vCoord2;void main() {vec2 coordInSSAA = vCoord2 * vec2(uTextureSize);vec2 lowerLeftInSSAA = floor(coordInSSAA - vec2(0.5)) + 0.5;vec2 lowerLeftTexelCoord = lowerLeftInSSAA * uTexturePx;vec2 lowerRightTexelCoord = lowerLeftTexelCoord + vec2(uTexturePx, 0.0);vec2 upperLeftTexelCoord = lowerLeftTexelCoord + vec2(0.0, uTexturePx);vec2 upperRightTexelCoord =lowerLeftTexelCoord + vec2(uTexturePx, uTexturePx);float lowerLeftAlpha = texture2D(texture0, lowerLeftTexelCoord).a;float lowerRightAlpha = texture2D(texture0, lowerRightTexelCoord).a;float upperLeftAlpha = texture2D(texture0, upperLeftTexelCoord).a;float upperRightAlpha = texture2D(texture0, upperRightTexelCoord).a;float hardMaskedLowerLeftAlpha = float(lowerLeftAlpha > 0.0);float hardMaskedLowerRightAlpha = float(lowerRightAlpha > 0.0);float hardMaskedUpperLeftAlpha = float(upperLeftAlpha > 0.0);float hardMaskedUpperRightAlpha = float(upperRightAlpha > 0.0);float rightWeight = coordInSSAA.x - lowerLeftInSSAA.x;float leftWeight = 1.0 - rightWeight;float topWeight = coordInSSAA.y - lowerLeftInSSAA.y;float bottomWeight = 1.0 - topWeight;float downsampledHardMaskedAlpha = (hardMaskedLowerLeftAlpha * leftWeight +hardMaskedLowerRightAlpha * rightWeight) *bottomWeight +(hardMaskedUpperLeftAlpha * leftWeight +hardMaskedUpperRightAlpha * rightWeight) *topWeight;gl_FragColor = downsampledHardMaskedAlpha * uColor;}",this.GLSLX_SOURCE_IMAGE_FRAGMENT="precision highp float;uniform int uEmulateWrapAddress;uniform int uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (bool(uEmulateWrapAddress)) {coord = fract(coord);}vec4 color = texture2D(tex, coord);if (bool(uEmulateBorderAddress) && coord != clamp(coord, 0.0, 1.0))color.a = 0.0;return color;}uniform float uOpacity;uniform sampler2D texture0;varying vec2 vCoord2;void main() {vec4 color = sampleImage(texture0, vCoord2);color.rgb *= color.a;gl_FragColor = color * uOpacity;}",this.GLSLX_SOURCE_IMAGE_COLOR_ADJUST_FRAGMENT="precision highp float;const vec3 RGB2Y = vec3(0.2126, 0.7152, 0.0722);const float IMAGE_HIGHLIGHT_SHADOW_THRESHOLD = 0.5;uniform float uGlobalTint;uniform float uGlobalColor;uniform float uGlobalShadows;uniform float uGlobalHighlights;uniform float uGlobalExposure;uniform float uGlobalTemperature;uniform float uGlobalContrast;vec3 colorToLinear(vec3 color) {color = pow(color, vec3(2.2));return color;}vec3 colorFromLinear(vec3 color) {color = pow(color, vec3(1.0 / 2.2));return color;}float rangeFactor(vec3 color, float shadows, float highlights) {float lThreshold =dot(color, RGB2Y) - pow(IMAGE_HIGHLIGHT_SHADOW_THRESHOLD, 2.2);return 0.75 * lThreshold / sqrt(1.0 + 4.0 * lThreshold * lThreshold) *(lThreshold > 0.0 ? highlights : -shadows * 0.999);}vec3 adjustExposure(vec3 color, float exposureAdjust) {float lFactor = pow(10.0, 2.0 * exposureAdjust) - 1.0;const float lSqueeze = 0.75;float lUnsqueeze = 1.0 / (1.0 - lSqueeze) - 1.0;float gray = dot(color, RGB2Y);lUnsqueeze *= 1.0 + gray * gray * min(0.0, exposureAdjust) /(0.2 - min(0.0, exposureAdjust));color += (gray - color) * lSqueeze;if (exposureAdjust < 0.0) {color *= 1.0 + exposureAdjust / 16.0;gray *= 1.0 + exposureAdjust / 16.0;}color *= (lFactor + 1.0) / (color * lFactor + 1.0);gray *= (lFactor + 1.0) / (gray * lFactor + 1.0);color += (color - gray) * lUnsqueeze;color = clamp(color, 0.0, 1.0);return color;}vec3 adjustColor(vec3 color, float colorAdjust) {float gray = dot(color, RGB2Y);if (colorAdjust <= 0.0) {color -= (gray - color) * colorAdjust;} else {float lNeg = gray / (gray - min(min(color.r, color.g), color.b) + 1e-6);float lPos =(1.0 - gray) / (max(max(color.r, color.g), color.b) - gray + 1e-6);float lFactor = mix(1.0, min(lNeg, lPos), colorAdjust);lFactor =min(lFactor,2.0); color += (gray - color) * (1.0 - lFactor);}return color;}float smootherstep(float edge0, float edge1, float x) {x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);}vec3 adjustTempTintContrast(vec3 color, float temp, float tint,float contrast) {vec3 lXYZ = mat3(0.4124564, 0.2126729, 0.0193339, 0.3575761, 0.7151522,0.1191920, 0.1804375, 0.0721750, 0.9503041) *color;lXYZ.x /= 0.95047;lXYZ.z /= 1.08883;lXYZ = pow(lXYZ, vec3(1.0 / 3.0));vec3 lLAB = vec3(116.0 * lXYZ.y - 16.0, 500.0 * (lXYZ.x - lXYZ.y),200.0 * (lXYZ.y - lXYZ.z));lLAB.y += 30.0 * tint;lLAB.z += 30.0 * temp;float scaledThreshold = IMAGE_HIGHLIGHT_SHADOW_THRESHOLD * 100.0;float thresholdDelta = 30.0;float contrastLeftCurve =contrast < 0.0 ? (lLAB.x - scaledThreshold) * 0.2 + 50.0 : lLAB.x;float contrastRightCurve =contrast < 0.0 ? lLAB.x: smootherstep(scaledThreshold - thresholdDelta,scaledThreshold + thresholdDelta, lLAB.x) *100.0;float interp = contrast < 0.0 ? contrast + 1.0 : contrast;lLAB.x = mix(contrastLeftCurve, contrastRightCurve, interp);lXYZ.y = (lLAB.x + 16.0) / 116.0;lXYZ.x = lLAB.y / 500.0 + lXYZ.y;lXYZ.z = lXYZ.y - lLAB.z / 200.0;lXYZ *= lXYZ * lXYZ;lXYZ.x *= 0.95047;lXYZ.z *= 1.08883;color = mat3(3.2404542, -0.9692660, 0.0556434, -1.5371385, 1.8760108,-0.2040259, -0.4985314, 0.0415560, 1.0572252) *lXYZ;color = clamp(color, 0.0, 1.0);return color;}vec3 pipeline(vec3 color) {color = colorToLinear(color);float originalRangeFactor =rangeFactor(color, uGlobalShadows, uGlobalHighlights);color = adjustTempTintContrast(color, uGlobalTemperature, uGlobalTint,uGlobalContrast);color = adjustExposure(color, uGlobalExposure + originalRangeFactor);color = adjustColor(color, clamp(uGlobalColor, -1.0, 1.0));color = colorFromLinear(color);return color;}uniform int uEmulateWrapAddress;uniform int uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (bool(uEmulateWrapAddress)) {coord = fract(coord);}vec4 color = texture2D(tex, coord);if (bool(uEmulateBorderAddress) && coord != clamp(coord, 0.0, 1.0))color.a = 0.0;return color;}uniform float uOpacity;uniform sampler2D texture0;varying vec2 vCoord2;void main() {vec4 color = sampleImage(texture0, vCoord2);color.rgb = pipeline(color.rgb) * color.a;gl_FragColor = color * uOpacity;}",this.GLSLX_SOURCE_LERP_GRADIENT_FRAGMENT="precision highp float;uniform int uType;const float PI = 3.141592;vec2 _gradientCoord(in vec2 paintUV) {const int LINEAR = 1;const int RADIAL = 2;const int ANGULAR = 3;const int DIAMOND = 4;vec2 uv = paintUV - 0.5;float t = uType == LINEAR    ? uv.x + 0.5: uType == RADIAL  ? 2.0 * length(uv): uType == ANGULAR ? fract(atan(uv.y, uv.x) / (2.0 * PI)): uType == DIAMOND ? 2.0 * max(abs(uv.x + uv.y), abs(uv.y - uv.x)): 0.0;return vec2(t, 0.25 + (0.75 - 0.25) / 256.0);}const float DITHER_FACTOR = 0.003922;const float DITHER_RANGE = 2.0 * DITHER_FACTOR;float random() {vec2 coordCopy = gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898, 78.233), coordCopy)) * 43758.5453);}vec4 ditherColor(vec4 color) {float offset = (random() - 0.5) * DITHER_RANGE; return color.a > 0.0 ? min(abs(color + offset), 1.0) : color;}uniform float uOpacity;uniform float uProgress;uniform sampler2D texture0;uniform sampler2D texture1;varying vec2 vCoord2;void main() {vec2 coord = _gradientCoord(vCoord2);vec4 lerped =mix(texture2D(texture0, coord), texture2D(texture1, coord), uProgress);gl_FragColor = ditherColor(lerped * uOpacity);}",this.GLSLX_SOURCE_LERP_IMAGE_FRAGMENT="precision highp float;uniform int uEmulateWrapAddress;uniform int uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (bool(uEmulateWrapAddress)) {coord = fract(coord);}vec4 color = texture2D(tex, coord);if (bool(uEmulateBorderAddress) && coord != clamp(coord, 0.0, 1.0))color.a = 0.0;return color;}uniform float uOpacity;uniform float uProgress;uniform sampler2D texture0;uniform sampler2D texture1;varying vec2 vCoord2;varying vec2 vCoord2b;void main() {vec4 lerped = mix(sampleImage(texture0, vCoord2),sampleImage(texture1, vCoord2b), uProgress);lerped.rgb *= lerped.a;gl_FragColor = lerped * uOpacity;}",this.GLSLX_SOURCE_LERP_IMAGE_COLOR_ADJUST_FRAGMENT="precision highp float;const vec3 RGB2Y = vec3(0.2126, 0.7152, 0.0722);const float IMAGE_HIGHLIGHT_SHADOW_THRESHOLD = 0.5;uniform float uGlobalTint;uniform float uGlobalColor;uniform float uGlobalShadows;uniform float uGlobalHighlights;uniform float uGlobalExposure;uniform float uGlobalTemperature;uniform float uGlobalContrast;vec3 colorToLinear(vec3 color) {color = pow(color, vec3(2.2));return color;}vec3 colorFromLinear(vec3 color) {color = pow(color, vec3(1.0 / 2.2));return color;}float rangeFactor(vec3 color, float shadows, float highlights) {float lThreshold =dot(color, RGB2Y) - pow(IMAGE_HIGHLIGHT_SHADOW_THRESHOLD, 2.2);return 0.75 * lThreshold / sqrt(1.0 + 4.0 * lThreshold * lThreshold) *(lThreshold > 0.0 ? highlights : -shadows * 0.999);}vec3 adjustExposure(vec3 color, float exposureAdjust) {float lFactor = pow(10.0, 2.0 * exposureAdjust) - 1.0;const float lSqueeze = 0.75;float lUnsqueeze = 1.0 / (1.0 - lSqueeze) - 1.0;float gray = dot(color, RGB2Y);lUnsqueeze *= 1.0 + gray * gray * min(0.0, exposureAdjust) /(0.2 - min(0.0, exposureAdjust));color += (gray - color) * lSqueeze;if (exposureAdjust < 0.0) {color *= 1.0 + exposureAdjust / 16.0;gray *= 1.0 + exposureAdjust / 16.0;}color *= (lFactor + 1.0) / (color * lFactor + 1.0);gray *= (lFactor + 1.0) / (gray * lFactor + 1.0);color += (color - gray) * lUnsqueeze;color = clamp(color, 0.0, 1.0);return color;}vec3 adjustColor(vec3 color, float colorAdjust) {float gray = dot(color, RGB2Y);if (colorAdjust <= 0.0) {color -= (gray - color) * colorAdjust;} else {float lNeg = gray / (gray - min(min(color.r, color.g), color.b) + 1e-6);float lPos =(1.0 - gray) / (max(max(color.r, color.g), color.b) - gray + 1e-6);float lFactor = mix(1.0, min(lNeg, lPos), colorAdjust);lFactor =min(lFactor,2.0); color += (gray - color) * (1.0 - lFactor);}return color;}float smootherstep(float edge0, float edge1, float x) {x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);}vec3 adjustTempTintContrast(vec3 color, float temp, float tint,float contrast) {vec3 lXYZ = mat3(0.4124564, 0.2126729, 0.0193339, 0.3575761, 0.7151522,0.1191920, 0.1804375, 0.0721750, 0.9503041) *color;lXYZ.x /= 0.95047;lXYZ.z /= 1.08883;lXYZ = pow(lXYZ, vec3(1.0 / 3.0));vec3 lLAB = vec3(116.0 * lXYZ.y - 16.0, 500.0 * (lXYZ.x - lXYZ.y),200.0 * (lXYZ.y - lXYZ.z));lLAB.y += 30.0 * tint;lLAB.z += 30.0 * temp;float scaledThreshold = IMAGE_HIGHLIGHT_SHADOW_THRESHOLD * 100.0;float thresholdDelta = 30.0;float contrastLeftCurve =contrast < 0.0 ? (lLAB.x - scaledThreshold) * 0.2 + 50.0 : lLAB.x;float contrastRightCurve =contrast < 0.0 ? lLAB.x: smootherstep(scaledThreshold - thresholdDelta,scaledThreshold + thresholdDelta, lLAB.x) *100.0;float interp = contrast < 0.0 ? contrast + 1.0 : contrast;lLAB.x = mix(contrastLeftCurve, contrastRightCurve, interp);lXYZ.y = (lLAB.x + 16.0) / 116.0;lXYZ.x = lLAB.y / 500.0 + lXYZ.y;lXYZ.z = lXYZ.y - lLAB.z / 200.0;lXYZ *= lXYZ * lXYZ;lXYZ.x *= 0.95047;lXYZ.z *= 1.08883;color = mat3(3.2404542, -0.9692660, 0.0556434, -1.5371385, 1.8760108,-0.2040259, -0.4985314, 0.0415560, 1.0572252) *lXYZ;color = clamp(color, 0.0, 1.0);return color;}vec3 pipeline(vec3 color) {color = colorToLinear(color);float originalRangeFactor =rangeFactor(color, uGlobalShadows, uGlobalHighlights);color = adjustTempTintContrast(color, uGlobalTemperature, uGlobalTint,uGlobalContrast);color = adjustExposure(color, uGlobalExposure + originalRangeFactor);color = adjustColor(color, clamp(uGlobalColor, -1.0, 1.0));color = colorFromLinear(color);return color;}uniform int uEmulateWrapAddress;uniform int uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (bool(uEmulateWrapAddress)) {coord = fract(coord);}vec4 color = texture2D(tex, coord);if (bool(uEmulateBorderAddress) && coord != clamp(coord, 0.0, 1.0))color.a = 0.0;return color;}uniform float uOpacity;uniform float uProgress;uniform sampler2D texture0;uniform sampler2D texture1;varying vec2 vCoord2;varying vec2 vCoord2b;void main() {vec4 lerped = mix(sampleImage(texture0, vCoord2),sampleImage(texture1, vCoord2b), uProgress);lerped.rgb = pipeline(lerped.rgb) * lerped.a;gl_FragColor = lerped * uOpacity;}",this.GLSLX_SOURCE_LERP_TILE_FRAGMENT="precision highp float;uniform float uOpacity;uniform sampler2D texture0;uniform sampler2D texture1;uniform vec4 texture0UvSpaceScissor;uniform vec4 texture1UvSpaceScissor;varying vec2 vCoord2;void main() {vec4 texture0Color = all(greaterThan(vCoord2, texture0UvSpaceScissor.xy)) &&all(lessThan(vCoord2, texture0UvSpaceScissor.zw))? texture2D(texture0, vCoord2): vec4(0.0);vec4 texture1Color = all(greaterThan(vCoord2, texture1UvSpaceScissor.xy)) &&all(lessThan(vCoord2, texture1UvSpaceScissor.zw))? texture2D(texture1, vCoord2): vec4(0.0);gl_FragColor = mix(texture0Color, texture1Color, uOpacity);}",this.GLSLX_SOURCE_LOOP_BLINN_FRAGMENT="precision highp float;varying vec3 vCoord3;void main() {if (vCoord3.x * vCoord3.x * vCoord3.x > vCoord3.y * vCoord3.z) {discard;}}",this.GLSLX_SOURCE_LOOP_BLINN_VERTEX="precision highp float;uniform mat3 uVertexTransform;attribute vec2 aPosition2;attribute vec3 aCoord3;varying vec3 vCoord3;void main() {vCoord3 = aCoord3;gl_Position = vec4(uVertexTransform * vec3(aPosition2, 1.0), 0.0).xywz;}",this.GLSLX_SOURCE_MASK_BACKGROUND_BLUR_TILE_FRAGMENT="precision highp float;uniform sampler2D texture0;uniform sampler2D texture1;varying vec2 vCoord2;void main() {if (texture2D(texture1, vCoord2).a == 0.0) {discard;}gl_FragColor = texture2D(texture0, vCoord2);}",this.GLSLX_SOURCE_MASK_INNER_SHADOW_TILE_FRAGMENT="precision highp float;uniform sampler2D texture0;uniform sampler2D texture1;uniform vec4 uColor;varying vec2 vCoord2;void main() {gl_FragColor = (1.0 - texture2D(texture0, vCoord2).a) *texture2D(texture1, vCoord2).a * uColor;}",this.GLSLX_SOURCE_MASK_INNER_SHADOW_TILE_AND_FIRST_HARD_MASK_ALPHA_FRAGMENT="precision highp float;uniform sampler2D texture0;uniform sampler2D texture1;uniform vec4 uColor;varying vec2 vCoord2;void main() {float texture1HardMasked = float(texture2D(texture1, vCoord2).a > 0.0);gl_FragColor =(1.0 - texture2D(texture0, vCoord2).a) * texture1HardMasked * uColor;}",this.GLSLX_SOURCE_MASK_KNOCKOUT_SHADOW_TILE_FRAGMENT="precision highp float;uniform sampler2D texture0;uniform sampler2D texture1;varying vec2 vCoord2;void main() {gl_FragColor =texture2D(texture0, vCoord2) * float(texture2D(texture1, vCoord2).a == 0.);}",this.GLSLX_SOURCE_MASK_KNOCKOUT_SHADOW_TILE_PASS_THROUGH_FRAGMENT="precision highp float;uniform sampler2D texture0;uniform sampler2D texture1;uniform sampler2D texture2; varying vec2 vCoord2;void main() {float geometryAlpha = texture2D(texture2, vCoord2).a;gl_FragColor = mix(texture2D(texture1, vCoord2),texture2D(texture0, vCoord2) * float(geometryAlpha == 0.),1.0 - geometryAlpha);}",this.GLSLX_SOURCE_MASK_TILE_FRAGMENT="precision highp float;uniform sampler2D texture0;uniform sampler2D texture1;varying vec2 vCoord2;void main() {gl_FragColor = texture2D(texture0, vCoord2) * texture2D(texture1, vCoord2).a;}",this.GLSLX_SOURCE_MASK_TILE_LUMINANCE_FRAGMENT="precision highp float;uniform sampler2D texture0;uniform sampler2D texture1;varying vec2 vCoord2;void main() {vec3 rgb = texture2D(texture1, vCoord2).rgb;vec3 weights = vec3(0.299, 0.587, 0.114);float c2 = dot(rgb * rgb, weights);float luminance = sqrt(c2);gl_FragColor =texture2D(texture0, vCoord2) * luminance * texture2D(texture1, vCoord2).a;}",this.GLSLX_SOURCE_MASK_TILE_LUMINANCE_PASS_THROUGH_FRAGMENT="precision highp float;uniform sampler2D texture0;uniform sampler2D texture1;uniform sampler2D texture2; varying vec2 vCoord2;void main() {vec3 rgb = texture2D(texture2, vCoord2).rgb;vec3 weights = vec3(0.299, 0.587, 0.114);float c2 = dot(rgb * rgb, weights);float luminance = sqrt(c2);gl_FragColor = mix(texture2D(texture1, vCoord2),texture2D(texture0, vCoord2),texture2D(texture2, vCoord2).a * luminance);}",this.GLSLX_SOURCE_MASK_TILE_PASS_THROUGH_FRAGMENT="precision highp float;uniform sampler2D texture0;uniform sampler2D texture1;uniform sampler2D texture2; varying vec2 vCoord2;void main() {gl_FragColor = mix(texture2D(texture1, vCoord2), texture2D(texture0, vCoord2),texture2D(texture2, vCoord2).a);}",this.GLSLX_SOURCE_NON_SOLID_COLOR_PAINT_VERTEX="precision highp float;uniform mat3 uVertexTransform;uniform mat3 uPaintTransform0;attribute vec2 aPosition2;varying vec2 vCoord2;void main() {vCoord2 = (uPaintTransform0 * vec3(aPosition2, 1)).xy;gl_Position = vec4(uVertexTransform * vec3(aPosition2, 1), 0).xywz;}",this.GLSLX_SOURCE_RECTANGLE_BLUR_FRAGMENT="precision highp float;const float DITHER_FACTOR = 0.003922;const float DITHER_RANGE = 2.0 * DITHER_FACTOR;float random() {vec2 coordCopy = gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898, 78.233), coordCopy)) * 43758.5453);}vec4 ditherColor(vec4 color) {float offset = (random() - 0.5) * DITHER_RANGE; return color.a > 0.0 ? min(abs(color + offset), 1.0) : color;}float integrateTriangle(float x) {if (x < -1.0) {return 0.0;} else if (x < 0.0) {return 0.5 * (x + 1.0) * (x + 1.0);} else if (x < 1.0) {return 0.5 - 0.5 * x * (x - 2.0);} else {return 1.0;}}uniform vec4 uColor;varying vec4 vCoord4;void main() {float alpha = (integrateTriangle(vCoord4.x) - integrateTriangle(vCoord4.z)) *(integrateTriangle(vCoord4.y) - integrateTriangle(vCoord4.w));gl_FragColor = ditherColor(uColor * alpha);}",this.GLSLX_SOURCE_RECTANGLE_BLUR_VERTEX="precision highp float;uniform mat3 uVertexTransform;uniform vec4 uQuad;uniform float uBlurRadius;attribute vec2 aPosition2;varying vec4 vCoord4;void main() {vec2 vertex = mix(uQuad.xy - uBlurRadius, uQuad.zw + uBlurRadius, aPosition2);vCoord4 = (vec4(vertex, vertex) - uQuad) / uBlurRadius;gl_Position = vec4(uVertexTransform * vec3(vertex, 1), 0).xywz;}",this.GLSLX_SOURCE_RENDER_DEVICE_FRAME_FRAGMENT="precision highp float;uniform sampler2D texture0;varying vec4 vPosition4;void main() {vec2 position = vPosition4.xy;vec2 uv = vPosition4.zw;uv.y = 1.0 - uv.y;gl_FragColor = texture2D(texture0, uv);}",this.GLSLX_SOURCE_RENDER_DEVICE_FRAME_VERTEX="precision highp float;uniform mat3 uVertexTransform;attribute vec4 aPosition4;varying vec4 vPosition4;void main() {vec2 transformedPosition = (uVertexTransform * vec3(aPosition4.xy, 1.0)).xy;vPosition4 = vec4(transformedPosition.xy, aPosition4.zw);gl_Position = vec4(transformedPosition, 0.0, 1.0);}",this.GLSLX_SOURCE_RENDER_HOTSPOT_FRAGMENT="precision highp float;uniform mat3 uVertexTransform;uniform float uHotspotOpacity;uniform vec2 uStrokeProportion;uniform vec4 uUvHotspotClippingRect;varying vec4 vPosition4;const vec3 HOTSPOT_COLOR = vec3(48.0 / 255.0, 194.0 / 255.0, 255.0 / 255.0);bool contains(vec4 rect, vec2 point) {return (rect.z >= 0.0 && rect.w >= 0.0 &&clamp(point.x, rect.x, rect.x + rect.z) == point.x &&clamp(point.y, rect.y, rect.y + rect.w) == point.y);}void main() {vec2 position = vPosition4.xy;vec2 uv = vPosition4.zw;if (contains(uUvHotspotClippingRect, position)) {if (uv.x < uStrokeProportion.x || uv.x > 1.0 - uStrokeProportion.x ||uv.y < uStrokeProportion.y || uv.y > 1.0 - uStrokeProportion.y) {gl_FragColor = vec4(HOTSPOT_COLOR, 1.0 * uHotspotOpacity);} else {gl_FragColor = vec4(HOTSPOT_COLOR, 0.5 * uHotspotOpacity);}} else {gl_FragColor = vec4(0.0);}}",this.GLSLX_SOURCE_RENDER_HOTSPOT_VERTEX="precision highp float;uniform mat3 uVertexTransform;attribute vec4 aPosition4;varying vec4 vPosition4;void main() {vec2 transformedPosition = (uVertexTransform * vec3(aPosition4.xy, 1.0)).xy;vPosition4 = vec4(transformedPosition.xy, aPosition4.zw);gl_Position = vec4(transformedPosition, 0.0, 1.0);}",this.GLSLX_SOURCE_ROUNDED_RECTANGLE_BLUR_FRAGMENT="precision highp float;const float DITHER_FACTOR = 0.003922;const float DITHER_RANGE = 2.0 * DITHER_FACTOR;float random() {vec2 coordCopy = gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898, 78.233), coordCopy)) * 43758.5453);}vec4 ditherColor(vec4 color) {float offset = (random() - 0.5) * DITHER_RANGE; return color.a > 0.0 ? min(abs(color + offset), 1.0) : color;}float integrateTriangle(float x) {if (x < -1.0) {return 0.0;} else if (x < 0.0) {return 0.5 * (x + 1.0) * (x + 1.0);} else if (x < 1.0) {return 0.5 - 0.5 * x * (x - 2.0);} else {return 1.0;}}uniform vec4 uColor;uniform vec2 uHalfSizeOverBlurRadius;uniform float uCornerRadiusOverBlurRadius;varying vec2 vCoord2;float triangle(float x) { return max(0.0, (1.0 - abs(x))); }float roundedRectangleBlurHorizontal(float x, float y, float cornerRadius,vec2 halfSize) {float deltaY = min(halfSize.y - cornerRadius - abs(y), 0.0);float roundedRectX =halfSize.x - cornerRadius +sqrt(max(0.0, cornerRadius * cornerRadius - deltaY * deltaY));vec2 xRelativeToLowerAndUpper = vec2(x + roundedRectX, x - roundedRectX);return integrateTriangle(xRelativeToLowerAndUpper.x) -integrateTriangle(xRelativeToLowerAndUpper.y);}void main() {float alpha;if (all(lessThan(abs(vCoord2),uHalfSizeOverBlurRadius - vec2(uCornerRadiusOverBlurRadius +1.0 )))) {alpha = 1.0;} else {float low = vCoord2.y - uHalfSizeOverBlurRadius.y;float high = vCoord2.y + uHalfSizeOverBlurRadius.y;float start = clamp(-1.0 , low, high);float end = clamp(1.0 , low, high);if (start == end) {alpha = 0.0;} else {const int numSamples = 4;float step = (end - start) / float(numSamples);float y = start + step * 0.5;float weightSum = 0.0;float result = 0.0;for (int i = 0; i < numSamples; i++) {float currentWeight = triangle(y);result += roundedRectangleBlurHorizontal(vCoord2.x, vCoord2.y - y,uCornerRadiusOverBlurRadius,uHalfSizeOverBlurRadius) *currentWeight;weightSum += currentWeight;y += step;}float weightNormalizationFactor =(integrateTriangle(end) - integrateTriangle(start)) / weightSum;alpha = result * weightNormalizationFactor;}}gl_FragColor = ditherColor(uColor * alpha);}",this.GLSLX_SOURCE_ROUNDED_RECTANGLE_BLUR_VERTEX="precision highp float;uniform vec4 uQuad;uniform float uBlurRadius;uniform mat3 uVertexTransform;attribute vec2 aPosition2;varying vec2 vCoord2;void main() {vec2 center = (uQuad.xy + uQuad.zw) * 0.5;vec2 vertex = mix(uQuad.xy - uBlurRadius, uQuad.zw + uBlurRadius, aPosition2);vCoord2 = (vertex - center) / uBlurRadius;gl_Position = vec4(uVertexTransform * vec3(vertex, 1), 0).xywz;}",this.GLSLX_SOURCE_SMOOTH_PATH_FRAGMENT="precision highp float;varying vec2 vCoord2;varying vec4 vCoord4;void main() { gl_FragColor = vCoord4 * min(1.0, min(vCoord2.x, vCoord2.y)); }",this.GLSLX_SOURCE_SMOOTH_PATH_VERTEX="precision highp float;uniform mat3 uVertexTransform;attribute vec4 aCoord4;attribute vec4 aPosition4;varying vec2 vCoord2;varying vec4 vCoord4;void main() {vCoord2 = aPosition4.zw;vCoord4 = aCoord4;gl_Position = vec4(uVertexTransform * vec3(aPosition4.xy, 1.0), 0.0).xywz;}",this.GLSLX_SOURCE_SOLID_COLOR_PAINT_FRAGMENT="precision highp float;uniform float uOpacity;uniform vec4 uColor;void main() { gl_FragColor = uColor * uOpacity; }",this.GLSLX_SOURCE_SOLID_COLOR_PAINT_VERTEX="precision highp float;uniform mat3 uVertexTransform;attribute vec2 aPosition2;varying vec2 vCoord2;void main() {vCoord2 = aPosition2;gl_Position = vec4(uVertexTransform * vec3(aPosition2, 1.0), 0.0).xywz;}",this.GLSLX_SOURCE_SUPER_SSAA4X4_DOWNSAMPLE_TEXTURE_FRAGMENT="precision highp float;uniform float uOpacity;uniform sampler2D texture0;varying vec2 vCoord2;const int TILEATLAS_TILE_SIZE = 512;const int SSAA_4X4_DIMENSION = TILEATLAS_TILE_SIZE * 4;const float SSAA_4X4_PX = 1.0 / float(SSAA_4X4_DIMENSION);void main() {vec4 downsampledColor =0.25 * (texture2D(texture0, vCoord2 + vec2(-SSAA_4X4_PX, -SSAA_4X4_PX)) +texture2D(texture0, vCoord2 + vec2(SSAA_4X4_PX, -SSAA_4X4_PX)) +texture2D(texture0, vCoord2 + vec2(SSAA_4X4_PX, SSAA_4X4_PX)) +texture2D(texture0, vCoord2 + vec2(-SSAA_4X4_PX, SSAA_4X4_PX)));gl_FragColor = downsampledColor * uOpacity;}",this.GLSLX_SOURCE_TILE_VERTEX="precision highp float;uniform vec4 uQuad;attribute vec2 aPosition2;varying vec2 vCoord2;void main() {vCoord2 = mix(uQuad.xy, uQuad.zw, aPosition2);gl_Position = vec4(vCoord2 * 2.0 - 1.0, 0, 1);}",this.GLSLX_SOURCE_TWO_NON_SOLID_COLOR_PAINT_VERTEX="precision highp float;uniform mat3 uVertexTransform;uniform mat3 uPaintTransform0;uniform mat3 uPaintTransform1;attribute vec2 aPosition2;varying vec2 vCoord2;varying vec2 vCoord2b;void main() {vCoord2 = (uPaintTransform0 * vec3(aPosition2, 1)).xy;vCoord2b = (uPaintTransform1 * vec3(aPosition2, 1)).xy;gl_Position = vec4(uVertexTransform * vec3(aPosition2, 1), 0).xywz;}",this.GLSLX_SOURCE_UNCLAMPED_BLUR_TILE_FRAGMENT="precision highp float;uniform float uCount;uniform vec2 uBlurDelta;uniform sampler2D texture0;varying vec2 vCoord2;void main() {float weight = uCount;vec4 result = texture2D(texture0, vCoord2) * weight;float total = weight;for (int i = 1; i < 32; i += 2) {if (float(i) > uCount) {break;}float t0 = float(i);float t1 = min(t0 + 1.0, uCount);vec2 coord0_neg = vCoord2 - uBlurDelta * t0;vec2 coord0_pos = vCoord2 + uBlurDelta * t0;vec2 coord1_neg = vCoord2 - uBlurDelta * t1;vec2 coord1_pos = vCoord2 + uBlurDelta * t1;float weight0 = uCount - t0;float weight1 = uCount - t1;float weightSum = weight0 + weight1;vec2 coord_neg = (coord0_neg * weight0 + coord1_neg * weight1) / weightSum;vec2 coord_pos = (coord0_pos * weight0 + coord1_pos * weight1) / weightSum;result += weightSum *(texture2D(texture0, coord_neg) + texture2D(texture0, coord_pos));total += 2.0 * weightSum;}gl_FragColor = result / total;}",this.GLSLX_SOURCE_UPSAMPLE_TILE_FRAGMENT="precision highp float;const float DITHER_FACTOR = 0.003922;const float DITHER_RANGE = 2.0 * DITHER_FACTOR;float random() {vec2 coordCopy = gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898, 78.233), coordCopy)) * 43758.5453);}vec4 ditherColor(vec4 color) {float offset = (random() - 0.5) * DITHER_RANGE; return color.a > 0.0 ? min(abs(color + offset), 1.0) : color;}uniform sampler2D texture0;varying vec2 vCoord2;void main() { gl_FragColor = ditherColor(texture2D(texture0, vCoord2)); }",this.GLSLX_SOURCE_UPSAMPLE_TILE_VERTEX="precision highp float;uniform vec4 uQuad;uniform vec4 uSource;attribute vec2 aPosition2;varying vec2 vCoord2;void main() {vCoord2 = mix(uSource.xy, uSource.zw, aPosition2);gl_Position = vec4(mix(uQuad.xy, uQuad.zw, aPosition2) * 2.0 - 1.0, 0, 1);}")}static instance(){return r._instance||(r._instance=new r),r._instance}};function Bc(r,e={},t=null){t||(t=document.createElement("canvas"));let n=null;try{n=r?t.getContext("webgl2",e):t.getContext("webgl",e)}catch{}return n}var Yu=class{constructor(e){this._context=null,this._ext=null,this._activeQuery=null,this._isRunning=!1,this._eventsPendingTimestamps=[],this._resolvedEvents=[],this._context=e,this._ext=e.getExtension("EXT_disjoint_timer_query")}start(){if(this._ext==null)throw new Error("EXT_disjoint_timer_query WebGL extension is not available. Cannot start profiler.");if(this._isRunning)throw new Error("Profiler is already running");let e=this._context.getExtension("WEBGL_debug_renderer_info");if(e!==null){let t=this._context.getParameter(e.UNMASKED_RENDERER_WEBGL);if(t.indexOf("NVIDIA GeForce GT 750M")!=-1)throw new Error(`${t} cards seem to have a buggy implementation of EXT_disjoint_timer_query. Refusing to profile to avoid confusing results.`)}this._isRunning=!0,this._eventsPendingTimestamps.length=0,this._resolvedEvents.length=0,this._activeQuery=this._ext.createQueryEXT(),this._ext.beginQueryEXT(this._ext.TIME_ELAPSED_EXT,this._activeQuery)}stop(){if(this._ext!=null){if(!this._isRunning)throw new Error("Profiler is already stopped");this._isRunning=!1,this._activeQuery=null,this._ext.endQueryEXT(this._ext.TIME_ELAPSED_EXT)}}isRunning(){return this._isRunning}_markAction(e){if(this._ext==null)return;if(this._activeQuery==null)throw new Error("Cannot mark actions while no profile is active");let t=this._activeQuery;this._activeQuery=this._ext.createQueryEXT(),this._ext.endQueryEXT(this._ext.TIME_ELAPSED_EXT),this._ext.beginQueryEXT(this._ext.TIME_ELAPSED_EXT,this._activeQuery),this._eventsPendingTimestamps.push(new ym(e,t))}pushFrame(e){this._markAction(new Qu(0,e))}popFrame(e){this._markAction(new Qu(1,e))}resolveEventsIfPossible(){if(this._ext==null)return;let e=0;for(;e<this._eventsPendingTimestamps.length;){let t=this._eventsPendingTimestamps[e],n=t.query;if(!this._ext.getQueryObjectEXT(n,this._ext.QUERY_RESULT_AVAILABLE_EXT))break;if(this._context.getParameter(this._ext.GPU_DISJOINT_EXT))throw new Error("GPU_DISJOINT_EXT");let o=this._ext.getQueryObjectEXT(n,this._ext.QUERY_RESULT_EXT);this._ext.deleteQueryEXT(n);let a=(this._resolvedEvents.length==0?0:ne.List_last(this._resolvedEvents).timestamp)+o;this._resolvedEvents.push(new Rm(t.action,a)),e=e+1}e>0&&(this._eventsPendingTimestamps=this._eventsPendingTimestamps.slice(e))}hasPendingResults(){return this._eventsPendingTimestamps.length!=0}resolvedEvents(){return this._resolvedEvents}exportSpeedscopeProfile(){let e=[],t=[];if(this._resolvedEvents.length==0)throw new Error("Profile is empty");let n={type:"evented",name:"GPU Profile",unit:"nanoseconds",startValue:0,endValue:ne.List_last(this._resolvedEvents).timestamp,events:t},o={$schema:"https://www.speedscope.app/file-format-schema.json",shared:{frames:e},profiles:[n]},i=new Map,a=d=>(i.has(d)||(i.set(d,e.length),e.push({name:d})),i.get(d)),s="O",l="C";for(let d of this._resolvedEvents)t.push({type:d.action.type==0?s:l,frame:a(d.action.name),at:d.timestamp});return JSON.stringify(o)}};var Qu=class{constructor(e,t){this.type=e,this.name=t}},ym=class{constructor(e,t){this.action=e,this.query=t}},Rm=class{constructor(e,t){this.action=e,this.timestamp=t}},Gc;(o=>{function r(i,a,s){Mc?i.annotateBlock(a,s):s()}o.WebGLRenderingContext_annotateBlock=r;function e(i,a,s){return Mc?i.annotateBlock(a,s):s()}o.WebGLRenderingContext_annotateBlockAndReturn=e;function t(i,a,s){Mc?i.annotateProfile(a,s):s()}o.WebGLRenderingContext_annotateProfile=t;function n(i,a){return i.TEXTURE0+a}o.WebGLRenderingContext_TEXTURE_N=n})(Gc||(Gc={}));var Mc=!1;function yy(r,e){console.log("WebGL intercepts are enabled. This records all calls.");let t=window.requestAnimationFrame,n=0,o=new Yu(e);window.requestAnimationFrame=()=>(n=n+1,o.hasPendingResults()&&o.resolveEventsIfPossible(),t.apply(window,arguments));let i=e,a=r.width,s=r.height,l=n,d=[],c={},p="  ",u=I=>{d.push(p+I)},_=()=>{n!=l&&(l=n,u("yield;"))},h=(I,C)=>{_(),u(`{ // ${I}`);let g=p;p+="  ",o.isRunning()&&o.pushFrame(I);let R=C();return o.isRunning()&&o.popFrame(I),p=g,u("}"),R},S=(I,C)=>{o.isRunning()&&o.pushFrame(I),C(),o.isRunning()&&o.popFrame(I)},m=()=>{let I=`function* render(gl) {

`;I+=`  // Recorded using https://github.com/evanw/webgl-recorder
`;for(let C in c)I+="  var "+C+`s = [];
`;for(let C of d)I+=C+`
`;return I+=`}
`,I},f=(I,C)=>{let g=document.createElement("a");g.href=URL.createObjectURL(new Blob([I],{type:"application/javascript"})),g.download=C??"trace.js",document.body.appendChild(g),g.click(),document.body.removeChild(g)},T=I=>{f(m(),I??"trace.js")},y=()=>{o.start()},E=I=>{o.stop();let C=()=>{o.hasPendingResults()?t(C):f(o.exportSpeedscopeProfile(),`viewer-${+new Date}.speedscope.json`)};C()},v=I=>{if(I instanceof WebGLActiveInfo||I instanceof WebGLBuffer||I instanceof WebGLFramebuffer||I instanceof WebGLProgram||I instanceof WebGLRenderbuffer||I instanceof WebGLShader||I instanceof WebGLShaderPrecisionFormat||I instanceof WebGLTexture||I instanceof WebGLUniformLocation){let C=I.constructor.name,g=C in c?c[C]:c[C]=[],R=g.indexOf(I);return R==-1&&(R=g.length,g.push(I)),C+"s["+R+"]"}return null},A={traceLines:d,compileTrace:m,downloadTrace:T,startProfile:y,stopProfile:E,annotateBlock:h,annotateProfile:S};u(`gl.canvas.width = ${a};`),u(`gl.canvas.height = ${s};`);for(let I in i){let C=i[I];if(typeof C=="function"){let g=((R,D)=>()=>{let P=[];_(),(r.width!=a||r.height!=s)&&(a=r.width,s=r.height,u(`gl.canvas.width = ${a};`),u(`gl.canvas.height = ${s};`));for(let F=0,w=arguments.length;F<w;F=F+1){let V=arguments[F];if(typeof V=="number"||typeof V=="boolean"||typeof V=="string"||Array.isArray(V)||V===null)P.push(JSON.stringify(V));else if(ArrayBuffer.isView(V))P.push(`new ${V.constructor.name}([${Array.prototype.slice.call(V)}])`);else{let k=v(V);k!=null?P.push(k):(console.warn("unsupported value:",V),P.push("null"))}}let U=`gl.${R}(`;for(let F=0,w=P.length;F<w;F=F+1)F!=0&&(U+=", "),U+=P[F];U+=");",o.isRunning()&&R.startsWith("draw")&&o.pushFrame(U);let B=D.apply(i,arguments);o.isRunning()&&R.startsWith("draw")&&o.popFrame(U);let M=v(B);return M!=null&&(U=M+" = "+U),u(U),B})(I,C);A[I]=g}else(g=>{Object.defineProperty(A,g,{set:R=>{i[g]=R},get:()=>i[g]})})(I)}return window.recordingContext=A,A}var rr;(i=>{function r(a){let s=[];for(let l=0,d=a.length;l<d;l=l+1)s.push(a[l]);return s}i.asList=r;function e(a,s,l){a.addEventListener(s,l)}i.on1=e;function t(a,s,l,d){a.addEventListener(s,l,d)}i.on2=t;function n(a,s,l){a.removeEventListener(s,l)}i.off=n;function o(a){a.preventDefault()}i.preventDefault=o})(rr||(rr={}));function Uc(r,e={}){let t=Bc(r,e);return Mc?yy(t.canvas,t):t}var Xu;(t=>{function r(n){return n.result}t.FileReader_resultAsArrayBuffer=r;function e(n){return n.result}t.FileReader_resultAsString=e})(Xu||(Xu={}));var Is;(e=>{function r(t){return t&&t.now?t.now():+new Date}e.Performance_now=r})(Is||(Is={}));var qt;(v=>{function r(A,I,C){rr.on1(A,I,C)}v.EventTarget_addEventListener1=r;function e(A,I,C){rr.on1(A,I,C)}v.EventTarget_addEventListener2=e;function t(A,I,C){rr.on1(A,I,C)}v.EventTarget_addEventListener3=t;function n(A,I,C){rr.on1(A,I,C)}v.EventTarget_addEventListener4=n;function o(A,I,C){rr.on1(A,I,C)}v.EventTarget_addEventListener5=o;function i(A,I,C){rr.on1(A,I,C)}v.EventTarget_addEventListener6=i;function a(A,I,C){rr.on1(A,I,C)}v.EventTarget_addEventListener7=a;function s(A,I,C,g){rr.on2(A,I,C,g)}v.EventTarget_addEventListener8=s;function l(A,I,C,g){rr.on2(A,I,C,g)}v.EventTarget_addEventListener9=l;function d(A,I,C,g){rr.on2(A,I,C,g)}v.EventTarget_addEventListener10=d;function c(A,I,C,g){rr.on2(A,I,C,g)}v.EventTarget_addEventListener11=c;function p(A,I,C,g){rr.on2(A,I,C,g)}v.EventTarget_addEventListener12=p;function u(A,I,C,g){rr.on2(A,I,C,g)}v.EventTarget_addEventListener13=u;function _(A,I,C,g){rr.on2(A,I,C,g)}v.EventTarget_addEventListener14=_;function h(A,I,C){rr.off(A,I,C)}v.EventTarget_removeEventListener1=h;function S(A,I,C){rr.off(A,I,C)}v.EventTarget_removeEventListener2=S;function m(A,I,C){rr.off(A,I,C)}v.EventTarget_removeEventListener3=m;function f(A,I,C){rr.off(A,I,C)}v.EventTarget_removeEventListener4=f;function T(A,I,C){rr.off(A,I,C)}v.EventTarget_removeEventListener5=T;function y(A,I,C){rr.off(A,I,C)}v.EventTarget_removeEventListener6=y;function E(A,I,C){rr.off(A,I,C)}v.EventTarget_removeEventListener7=E})(qt||(qt={}));var qu;(e=>{function r(t){return t.isConnected}e.Node_isConnected=r})(qu||(qu={}));var Zu;(e=>{function r(t){let n=t.getBoundingClientRect(),o=n.x+n.width/2,i=n.y+n.height/2;return t.ownerDocument.elementFromPoint(o,i)===t}e.Element_isVisible=r})(Zu||(Zu={}));var oi;(e=>{function r(t){rr.preventDefault(t)}e.Event_preventDefault=r})(oi||(oi={}));var Ju;(t=>{function r(n){return rr.asList(n.types)}t.DataTransfer_types=r;function e(n){return rr.asList(n.files)}t.DataTransfer_files=e})(Ju||(Ju={}));var Ry;(e=>{function r(t){if(typeof t.buttons>"u"){let n=t.which;return n<2?n:n==3?2:4}return t.buttons}e.MouseEvent_buttons=r})(Ry||(Ry={}));var ju;(n=>{function r(o){return rr.asList(o.touches)}n.TouchEvent_touches=r;function e(o){return rr.asList(o.targetTouches)}n.TouchEvent_targetTouches=e;function t(o){return rr.asList(o.changedTouches)}n.TouchEvent_changedTouches=t})(ju||(ju={}));function mn(){return self}var O;(H=>{function r(z){return z&255}H.red=r;function e(z){return z>>8&255}H.green=e;function t(z){return z>>16&255}H.blue=t;function n(z){return z>>>24}H.alpha=n;function o(z){return r(z)/255}H.redF=o;function i(z){return e(z)/255}H.greenF=i;function a(z){return t(z)/255}H.blueF=a;function s(z){return n(z)/255}H.alphaF=s;function l(z,Q){return y(r(z),e(z),t(z),Q)}H.withAlpha=l;function d(z){let Q=s(z);return E(o(z)*Q,i(z)*Q,a(z)*Q,Q)}H.premultiplied=d;function c(z){let Q=s(z);return E(o(z)/Q,i(z)/Q,a(z)/Q,Q)}H.unpremultiplied=c;function p(z,Q){return z&16777215|A(s(z)*Q)<<24}H.multiplyOpacity=p;function u(z){return`Color(${r(z)}, ${e(z)}, ${t(z)}, ${n(z)})`}H.toString=u;function _(z){return n(z)==255}H.isOpaque=_;function h(z){return"#"+R(r(z))+R(e(z))+R(t(z))}H.toCSS=h;function S(z){return{red:o(z),green:i(z),blue:a(z),alpha:s(z)}}H.toColorF=S;function m(z){return{r:r(z),g:e(z),b:t(z),a:n(z)}}H.asInttoJSON=m;function f(z){return{r:o(z),g:i(z),b:a(z),a:s(z)}}H.asFloattoJSON=f;function T(z,Q,K){return y(z,Q,K,255)}H.new1=T;function y(z,Q,K,j){return z|Q<<8|K<<16|j<<24}H.new2=y;function E(z,Q,K,j){return y(A(z),A(Q),A(K),A(j))}H.new3=E;function v(z){return E(z.red,z.green,z.blue,z.alpha)}H.fromColorF=v;function A(z){return z<0?0:z>=1?255:Math.round(z*255)|0}H._clamp=A;function I(z,Q,K){return E(o(z)+(o(Q)-o(z))*K,i(z)+(i(Q)-i(z))*K,a(z)+(a(Q)-a(z))*K,s(z)+(s(Q)-s(z))*K)}H.mix=I;function C(z,Q){let K=s(z),j=s(Q),pe=K*(1-j),Pe=pe+j,at=pe/Pe,Ke=j/Pe;return E(o(z)*at+o(Q)*Ke,i(z)*at+i(Q)*Ke,a(z)*at+a(Q)*Ke,Pe)}H.blend=C;function g(z,Q){return E(o(z)*(1-s(Q))+o(Q),i(z)*(1-s(Q))+i(Q),a(z)*(1-s(Q))+a(Q),s(z)*(1-s(Q))+s(Q))}H.over=g;function R(z){let Q=z.toString(16);return(Q.length==1?"0"+Q:Q).toUpperCase()}H.asCSSComponent=R,H.TRANSPARENT=y(0,0,0,0),H.BLACK=T(0,0,0),H.WHITE=T(255,255,255),H.RED=T(255,0,0),H.GREEN=T(0,255,0),H.BLUE=T(0,0,255),H.YELLOW=T(255,255,0),H.CYAN=T(0,255,255),H.MAGENTA=T(255,0,255)})(O||(O={}));var fn=class r{constructor(e){e?(this._capacity=0,this._bytes=e,this._count=this._capacity=e.length,this._view=new DataView(e.buffer,e.byteOffset,e.length)):(this._count=0,this._capacity=256,this._bytes=new Uint8Array(this._capacity),this._view=new DataView(this._bytes.buffer))}clear(){this._count=0}clone(){return new r(new Uint8Array(this.bytes()))}isEmpty(){return this._count==0}byteCount(){return this._count}bytes(){return this._bytes.subarray(0,this._count)}floatAt(e){return this._view.getFloat32(e,!0)}byteAt(e){return this._bytes[e]}appendFloat(e){return this._count+4>this._capacity&&this._grow(this._count+4),this._view.setFloat32(this._count,e,!0),this._count=this._count+4,this}appendByte(e){return this._count+1>this._capacity&&this._grow(this._count+1),this._bytes[this._count]=e,this._count=this._count+1,this}prependBytes(e){let t=e.byteCount();return this._count+t>this._capacity&&this._grow(this._count+t),this._bytes.set(this.bytes(),t),this._bytes.set(e.bytes()),this._count=this._count+t,this}appendBytes(e){let t=e.byteCount();return this._count+t>this._capacity&&this._grow(this._count+t),this._bytes.set(e.bytes(),this._count),this._count=this._count+t,this}setFloatAt(e,t){this._view.setFloat32(e,t,!0)}_grow(e){this._capacity=e*2;let t=new Uint8Array(this._capacity);this._bytes!=null&&t.set(this._bytes),this._bytes=t,this._view=new DataView(t.buffer)}},$u;(e=>{function r(t,n){if(t==null||n==null||t.byteCount()!=n.byteCount())return!1;for(let o=0,i=t.byteCount();o<i;o=o+1)if(t.byteAt(o)!=n.byteAt(o))return!1;return!0}e.FrozenDataArray_equals=r})($u||($u={}));var b=class r{constructor(e,t){this._x=0,this._y=0,this._x=e,this._y=t}x(){return this._x}y(){return this._y}setX(e){this._x=e}setY(e){this._y=e}multiplyScalar(e){return new r(this.x()*e,this.y()*e)}multiply(e){return new r(this.x()*e.x(),this.y()*e.y())}addScalar(e){return new r(this.x()+e,this.y()+e)}add(e){return new r(this.x()+e.x(),this.y()+e.y())}negative(){return new r(-this.x(),-this.y())}subtractScalar(e){return new r(this.x()-e,this.y()-e)}subtract(e){return new r(this.x()-e.x(),this.y()-e.y())}divideScalar(e){return new r(this.x()/e,this.y()/e)}divide(e){return new r(this.x()/e.x(),this.y()/e.y())}clone(){return new r(this.x(),this.y())}dot(e){return this.x()*e.x()+this.y()*e.y()}equals(e){return this.x()==e.x()&&this.y()==e.y()}floatEquals(e,t=1e-5){return Math.abs(this.x()-e.x())<=t&&Math.abs(this.y()-e.y())<=t}freeze(){return this.clone()}isZero(){return this.x()==0&&this.y()==0}isPositive(){return this.x()>0&&this.y()>0}length(){return Math.sqrt(this.x()*this.x()+this.y()*this.y())}maxComponent(){return Math.max(this.x(),this.y())}max(e){return new r(Math.max(this.x(),e.x()),Math.max(this.y(),e.y()))}minComponent(){return Math.min(this.x(),this.y())}min(e){return new r(Math.min(this.x(),e.x()),Math.min(this.y(),e.y()))}distanceTo(e){return Math.sqrt(this.squaredDistanceTo(e))}withOnesForZeros(){return new r(this.x()==0?1:this.x(),this.y()==0?1:this.y())}area(){return this.x()*this.y()}squaredDistanceTo(e){let t=this.x()-e.x(),n=this.y()-e.y();return t*t+n*n}approximatelyEquals(e,t){return this.squaredDistanceTo(e)<=t*t}mixedWith(e,t){return new r(this.x()+(e.x()-this.x())*t,this.y()+(e.y()-this.y())*t)}flipped(){return new r(this._y,this._x)}mixWith(e,t){this._x+=(e.x()-this.x())*t,this._y+=(e.y()-this.y())*t}addUpdate(e){this._x+=e,this._y+=e}addUpdate1(e){this._x+=e.x(),this._y+=e.y()}subtractUpdate(e){this._x-=e,this._y-=e}subtractUpdate1(e){this._x-=e.x(),this._y-=e.y()}multiplyUpdate(e){this._x*=e,this._y*=e}multiplyUpdate1(e){this._x*=e.x(),this._y*=e.y()}divideUpdate(e){this._x/=e,this._y/=e}divideUpdate1(e){this._x/=e.x(),this._y/=e.y()}rounded(){return new r(Math.round(this._x),Math.round(this._y))}setTo(e,t){return this._x=e,this._y=t,this}copyFrom(e){return this._x=e.x(),this._y=e.y(),this}makeAbs(){return this._x=Math.abs(this._x),this._y=Math.abs(this._y),this}toString(){return`Vector(${this.x()}, ${this.y()})`}toJSON(){return{x:this._x,y:this._y}}static new(e=void 0){return e?new r(e.x(),e.y()):new r(0,0)}static cross(e,t){return e.x()*t.y()-e.y()*t.x()}static lerp(e,t,n){return e.multiplyScalar(1-n).add(t.multiplyScalar(n))}static equals_(e,t){return e==null!=(t==null)?!1:e==null?!0:e.equals(t)}},fe;(s=>{function r(){return b.new()}s.FrozenVector_new1=r;function e(l){return l}s.FrozenVector_new2=e;function t(l){return b.new(l)}s.FrozenVector_new3=t;function n(l,d){return new b(l,d)}s.FrozenVector_new4=n,s.FrozenVector_ZERO=r(),s.FrozenVector_ONE=n(1,1),s.FrozenVector_INFINITY=n(1/0,1/0)})(fe||(fe={}));var qn=class qn{static createInterpolateBlendState(e){return new qn(10,11,10,11,e)}constructor(e,t,n,o,i){this.sourceColor=e,this.targetColor=t,this.sourceAlpha=n,this.targetAlpha=o,this.constant=i}};qn.ZERO=new qn(0,0,0,0,0),qn.COPY=new qn(1,0,1,0,0),qn.KEEP=new qn(0,1,0,1,0),qn.PREMULTIPLIED=new qn(1,8,1,8,0),qn.UNPREMULTIPLIED=new qn(6,8,6,8,0),qn.SCREEN=new qn(1,4,1,8,0);var It=qn;var xo=class xo{};xo.FILL=128,xo.STROKE=64,xo.NOT_FILL=255^xo.FILL,xo.NOT_STROKE=255^xo.STROKE,xo.FILL_AND_STROKE=xo.FILL|xo.STROKE,xo.WINDING_MASK=255^xo.FILL_AND_STROKE;var hr=xo,ep=class ep{equals(e){return this==e||this.comparison==e.comparison&&this.stencilFail==e.stencilFail&&this.stencilPassDepthPass==e.stencilPassDepthPass}constructor(e,t,n){this.comparison=e,this.stencilFail=t,this.stencilPassDepthPass=n}};ep.NONE=new ep(6,5,5);var nn=ep,Ht=class Ht{constructor(e,t,n,o,i,a,s){this.type=e,this.isEnabled=s,this.frontFace=t,this.backFace=n,this.readMask=o,this.writeMask=i,this.reference=a}static both(e,t,n,o,i){return new Ht(e,t,t,n,o,i,!0)}equals(e){return this==e||this.type===e.type&&this.isEnabled==e.isEnabled&&this.frontFace.equals(e.frontFace)&&this.backFace.equals(e.backFace)&&this.readMask===e.readMask&&this.writeMask===e.writeMask}};Ht.NONE=new Ht(_n.NONE,nn.NONE,nn.NONE,0,0,0,!1),Ht.ODD_WINDING_NUMBER_COMPUTE=Ht.both(_n.ODD_WINDING_NUMBER_COMPUTE,new nn(0,5,4),1,1,0),Ht.NONZERO_WINDING_NUMBER_COMPUTE=new Ht(_n.NONZERO_WINDING_NUMBER_COMPUTE,new nn(0,5,3),new nn(0,5,1),hr.WINDING_MASK,hr.WINDING_MASK,0,!0),Ht.ODD_WINDING_NUMBER=Ht.both(_n.ODD_WINDING_NUMBER,new nn(7,5,5),1,0,0),Ht.NONZERO_WINDING_NUMBER=Ht.both(_n.NONZERO_WINDING_NUMBER,new nn(7,5,5),hr.WINDING_MASK,0,0),Ht.ODD_WINDING_NUMBER_CLEAR=Ht.both(_n.ODD_WINDING_NUMBER_CLEAR,new nn(7,7,7),1,hr.WINDING_MASK,0),Ht.NONZERO_WINDING_NUMBER_CLEAR=Ht.both(_n.NONZERO_WINDING_NUMBER_CLEAR,new nn(7,7,7),hr.WINDING_MASK,hr.WINDING_MASK,0),Ht.ODD_WINDING_NUMBER_FILL=Ht.both(_n.ODD_WINDING_NUMBER_FILL,new nn(7,5,6),1,hr.NOT_STROKE,hr.FILL),Ht.NONZERO_WINDING_NUMBER_FILL=Ht.both(_n.NONZERO_WINDING_NUMBER_FILL,new nn(7,5,6),hr.WINDING_MASK,hr.NOT_STROKE,hr.FILL),Ht.ODD_WINDING_NUMBER_STROKE=Ht.both(_n.ODD_WINDING_NUMBER_STROKE,new nn(7,5,6),1,hr.NOT_FILL,hr.STROKE),Ht.NONZERO_WINDING_NUMBER_STROKE=Ht.both(_n.NONZERO_WINDING_NUMBER_STROKE,new nn(7,5,6),hr.WINDING_MASK,hr.NOT_FILL,hr.STROKE),Ht.STROKE_INSIDE=Ht.both(_n.STROKE_INSIDE,new nn(1,5,5),hr.FILL_AND_STROKE,0,hr.FILL_AND_STROKE),Ht.STROKE_OUTSIDE=Ht.both(_n.STROKE_OUTSIDE,new nn(1,5,5),hr.FILL_AND_STROKE,0,hr.STROKE),Ht.STROKE_INSIDE_CLEAR=Ht.both(_n.STROKE_CLEAR,new nn(1,7,7),hr.FILL_AND_STROKE,-1,hr.FILL_AND_STROKE),Ht.STROKE_OUTSIDE_CLEAR=Ht.both(_n.STROKE_CLEAR,new nn(1,7,7),hr.FILL_AND_STROKE,-1,hr.STROKE);var lr=Ht;function GN(r){return r==0?4:1}function vy(r){window.testFakeLostContext=()=>{let e=r.getExtension("WEBGL_lose_context");if(e==null)return;e.loseContext();let t=3;setTimeout(()=>{console.log(`waiting ${t} seconds to restore the context...`)},500),setTimeout(()=>{e.restoreContext()},t*1e3)},window.testRealLostContext=()=>{let e=[];for(let t=0;t<32;t=t+1)e.push(Uc(Y.shouldUseWebGL2()))}}function Oy(r){let e=r==null?void 0:r.graphicsCardName();return e!=null&&e.indexOf("SwiftShader")!=-1}var sa=class{constructor(e,t){this.canvasSize=e,this.webGLDidAdjustCanvasSize=t}};var vm=class{constructor(e,t,n,o){this.name=e,this.type=t,this.count=n,this.byteOffset=o}},Le=class r{attributes(){return this._attributes}stride(){return this._stride}add(e,t,n){return this._attributes.push(new vm(e,t,n,this._stride)),this._stride=this._stride+n*GN(t),this}constructor(){this._attributes=[],this._stride=0}static getPositionF2(){return r._POSITION_F2||(r._POSITION_F2=new r().add(Pr.instance().GLSLX_NAME_A_POSITION2,0,2)),r._POSITION_F2}static getPositionF2CoordF3(){return r._POSITION_F2_COORD_F3||(r._POSITION_F2_COORD_F3=new r().add(Pr.instance().GLSLX_NAME_A_POSITION2,0,2).add(Pr.instance().GLSLX_NAME_A_COORD3,0,3)),r._POSITION_F2_COORD_F3}static getPositionF4CoordF4(){return r._POSITION_F4_COORD_F4||(r._POSITION_F4_COORD_F4=new r().add(Pr.instance().GLSLX_NAME_A_POSITION4,0,4).add(Pr.instance().GLSLX_NAME_A_COORD4,0,4)),r._POSITION_F4_COORD_F4}static getPositionF4CoordB4(){return r._POSITION_F4_COORD_B4||(r._POSITION_F4_COORD_B4=new r().add(Pr.instance().GLSLX_NAME_A_POSITION4,0,4).add(Pr.instance().GLSLX_NAME_A_COORD4,1,4)),r._POSITION_F4_COORD_B4}static getPositionF4(){return r._POSITION_F4||(r._POSITION_F4=new r().add(Pr.instance().GLSLX_NAME_A_POSITION4,0,4)),r._POSITION_F4}};var uo=class uo{constructor(e,t,n,o){this.pixelFormat=e,this.minFilter=t,this.magFilter=n,this.wrap=o}isCompressedFormat(){return vs.PixelFormat_isCompressedFormat(this.pixelFormat)}};uo.RGBA_LINEAR_CLAMP=new uo(0,1,1,1),uo.RGBA_LINEAR_MIN_NEAREST_MAG_CLAMP=new uo(0,1,0,1),uo.RGBA_NEAREST_CLAMP=new uo(0,0,0,1),uo.RGBA_NEAREST_REPEAT=new uo(0,0,0,0),uo.STENCIL=new uo(1,0,0,1),uo.ASTC_6X6_NEAREST_CLAMP=new uo(2,0,0,1);var be=uo,tp=class{constructor(e,t){this.texture=null,this.uvSpaceRect=null,this.texture=e,this.uvSpaceRect=t}},la=class{totalVRAM(){return this._chunks.length*Bo.BYTE_COUNT}usedVRAM(){return this._chunks.reduce((e,t)=>e+t.getBytesUsed(),0)}allocate(e,t){if(t.length==0)return null;t.length<=Bo.BYTE_COUNT;let n=this._enableDiscardBytesAfterUpload,o=e.stride();for(let a of this._chunks){let s=a.tryToAllocate(o,t,n);if(s!=null)return s}let i=new Bo(this,this._context.createVertexBuffer(Bo.BYTE_COUNT,this._enableDiscardBytesAfterUpload));return this._chunks.push(i),i.tryToAllocate(o,t,n)}allocateSmallManagedArea(e,t){let n=new Uint8Array(t);return new Rs(()=>this.allocate(e,n))}constructor(e){this._context=e,this._chunks=[],this._enableDiscardBytesAfterUpload=Y.shouldEnableVertexBufferDiscardBytesAfterUpload(),this._enableDiscardBytesAfterUpload&&this._context.addContextResetHandler(()=>{var t;for(let n of this._chunks)for(let o of n.areas)(t=o.unwrap())==null||t.invalidate();this._chunks=[]})}},Om=class r{constructor(e,t,n){this._area=e,this._areaWeakRef=t,this._byteCount=n}static wrap(e){return Y.viewerCleanupBufferAreas()?new r(null,new WeakRef(e),e.byteCount()):new r(e,null,e.byteCount())}unwrap(){var e;return this._area??((e=this._areaWeakRef)==null?void 0:e.deref())??null}wasFreed(){var e;return((e=this.unwrap())==null?void 0:e.wasFreed())??!0}wasReclaimedBySystem(){return this._areaWeakRef&&!this._areaWeakRef.deref()}byteCount(){var e;return((e=this._area)==null?void 0:e.byteCount())??this._byteCount}},ys=class ys{tryToAllocate(e,t,n){let o=t.length,i=this.areas,a=null;if(this.getBytesUsed()+o<=ys.BYTE_COUNT){for(;i.length!=0&&ne.List_last(i).wasFreed();)ne.List_removeLast(i);a=this.allocateAtEnd(e,t),a==null&&!n&&(this.runCompactingGC(),a=this.allocateAtEnd(e,t)),a!=null&&(this.buffer.setBytesForUpload(t,a.byteOffset()),Y.viewerCleanupBufferAreas()||(this.bytesUsed=this.bytesUsed+o),i.push(Om.wrap(a)))}return a}allocateAtEnd(e,t){let n=this.validAreas(),o=n.length==0?0:ys._alignToNextMultiple(ne.List_last(n).byteOffset()+ne.List_last(n).byteCount(),e);return o+t.length<=ys.BYTE_COUNT?new Cm(this,t.length,e,o,t):null}validAreas(){return this.areas.map(e=>e.unwrap()).filter(e=>e!=null)}runCompactingGC(){var t;let e=0;if(ne.List_removeIf(this.areas,n=>{let o=n.unwrap();return o==null||o.wasFreed()?!0:(e=ys._alignToNextMultiple(e,o.stride()),o.byteOffset()!=e&&(this.buffer.moveBytesForUpload(o.byteOffset(),e,o.byteCount()),o.wasMovedTo(e)),e=e+o.byteCount(),!1)}),!bm)for(let n of this.areas)(t=n.unwrap())==null||t.assertBytesAreAsExpected()}getBytesUsed(){if(Y.viewerCleanupBufferAreas()){let e=0;for(let t of this.areas)e+=t.wasFreed()?0:t.byteCount();return e}else return this.bytesUsed}static _alignToNextMultiple(e,t){return e+gt.int_remainder(t-gt.int_remainder(e,t),t)}constructor(e,t){this.pool=e,this.buffer=t,this.areas=[],this.bytesUsed=0}};ys.BYTE_COUNT=4*1024*1024;var Bo=ys,Cm=class{constructor(e,t,n,o,i){this._wasFreed=!1,this._expectedArray=null,this._chunk=e,this._byteCount=t,this._stride=n,this._byteOffset=o,bm||this._saveBytes(i)}_saveBytes(e){this._expectedArray=new Uint8Array(e)}assertBytesAreAsExpected(){if(!bm)for(let e=0,t=this._byteCount;e<t;e=e+1)this._expectedArray[e]!=this._chunk.buffer.bytesForUpload()[e+this._byteOffset]}byteCount(){return this._byteCount}stride(){return this._stride}byteOffset(){return this._byteOffset}wasFreed(){return this._wasFreed}buffer(){var e;return(e=this._chunk)==null?void 0:e.buffer}free(){!this._wasFreed&&this._chunk!=null&&(this._wasFreed=!0,Y.viewerCleanupBufferAreas()||(this._chunk.bytesUsed-=this.byteCount()))}wasMovedTo(e){this._byteOffset=e}invalidate(){this._chunk=null}},Rs=class{bufferArea(){var e;return((e=this._bufferArea)==null?void 0:e.buffer())==null&&(this._bufferArea=this._recreateBufferArea()),this._bufferArea}constructor(e){this._recreateBufferArea=e,this._bufferArea=this._recreateBufferArea()}},Ba=class r{constructor(e,t){this._rectPoints=[b.new(),b.new(),b.new(),b.new()],this._inside=[],this._material=null,this._outside=[],this._vertices=new fn,this._context=null,this._pixelScale=1,this._pool=null,this._previousColor=O.TRANSPARENT,this._previousU=0,this._previousV=0,this._previousX=0,this._previousY=0,this._context=e,this._pool=t,this._materialStrings=Pr.instance(),this._material=e.createMaterial("smooth",Le.getPositionF4CoordB4(),this._materialStrings.GLSLX_SOURCE_SMOOTH_PATH_VERTEX,this._materialStrings.GLSLX_SOURCE_SMOOTH_PATH_FRAGMENT)}pixelScale(){return this._pixelScale}setTransformAndPixelScale(e,t){!0,Be.Material_setUniformMat32(this._material,this._materialStrings.GLSLX_NAME_U_VERTEX_TRANSFORM,e),this._pixelScale=t}flush(){let e=this._pool.allocate(Le.getPositionF4CoordB4(),this._vertices.bytes());e!=null&&(this._context.draw(1,this._material,e,It.PREMULTIPLIED,lr.NONE,null),e.free()),this._vertices.clear()}_loadPoints(e){this._rectPoints[0].setTo(e.left(),e.top()),this._rectPoints[1].setTo(e.right(),e.top()),this._rectPoints[2].setTo(e.right(),e.bottom()),this._rectPoints[3].setTo(e.left(),e.bottom())}fillRect(e,t){this._loadPoints(e),this.fillConvexPolygon(this._rectPoints,t)}strokeRect(e,t,n){this._loadPoints(e),this.strokeNonOverlappingPolyline(this._rectPoints,t,n,r.Loop.CLOSED)}fillConvexPolygon(e,t){let n=this._inside,o=this._outside,i=e.length;if(!(i<3)){for(t=O.premultiplied(t);n.length<i;)n.push(b.new()),o.push(b.new());for(let a=0,s=i;a<s;a=a+1){let l=e[gt.int_remainder(a+i-1,i)],d=e[a],c=e[gt.int_remainder(a+1,i)],p=l.y()-d.y(),u=d.x()-l.x(),_=this._length(p,u),h=d.y()-c.y(),S=c.x()-d.x(),m=this._length(h,S),f=p/_+h/m,T=u/_+S/m,y=.5*this._pixelScale*_/(p*f+u*T),E=f*y,v=T*y;o[a].setTo(d.x()-E,d.y()-v),n[a].setTo(d.x()+E,d.y()+v)}for(let a=0,s=i-1;a<=s;a=a+1,s=s-1){let l=n[a],d=n[s];this._appendVertex(l.x(),l.y(),1,1,t),a==0&&this._appendPreviousVertex(),a<s&&this._appendVertex(d.x(),d.y(),1,1,t)}this._appendPreviousVertex();for(let a=0;a<=i;a=a+1){let s=gt.int_remainder(a,i),l=n[s],d=o[s];this._appendVertex(d.x(),d.y(),0,0,t),a==0&&this._appendPreviousVertex(),this._appendVertex(l.x(),l.y(),1,1,t)}this._appendPreviousVertex()}}strokeNonOverlappingPolyline(e,t,n,o){let i=(n+this._pixelScale)/this._pixelScale,a=(n+this._pixelScale)/2,s=e.length;if(s<2)return;if(t=O.premultiplied(t),o==r.Loop.OPEN){let c=e[0],p=e[1],u=p.x()-c.x(),_=p.y()-c.y(),h=this._length(u,_),S=.5*this._pixelScale/h,m=u*S,f=_*S,T=a/h,y=-_*T,E=u*T;this._appendVertex(c.x()-m-y,c.y()-f-E,0,-i,t),this._appendPreviousVertex(),this._appendVertex(c.x()-m+y,c.y()-f+E,-i,0,t),this._appendVertex(c.x()+m-y,c.y()+f-E,0,i,t),this._appendVertex(c.x()+m+y,c.y()+f+E,i,0,t)}let l=o==r.Loop.CLOSED?0:1,d=o==r.Loop.CLOSED?s+1:s-1;for(let c=l,p=d;c<p;c=c+1){let u=e[gt.int_remainder(c+s-1,s)],_=e[gt.int_remainder(c,s)],h=e[gt.int_remainder(c+1,s)],S=u.y()-_.y(),m=_.x()-u.x(),f=this._length(S,m),T=_.y()-h.y(),y=h.x()-_.x(),E=this._length(T,y),v=S/f+T/E,A=m/f+y/E,I=a*f/(S*v+m*A),C=v*I,g=A*I;this._appendVertex(_.x()-C,_.y()-g,0,i,t),c==0&&this._appendPreviousVertex(),this._appendVertex(_.x()+C,_.y()+g,i,0,t)}if(o==r.Loop.OPEN){let c=e[s-2],p=e[s-1],u=p.x()-c.x(),_=p.y()-c.y(),h=this._length(u,_),S=.5*this._pixelScale/h,m=u*S,f=_*S,T=a/h,y=-_*T,E=u*T;this._appendVertex(p.x()-m-y,p.y()-f-E,0,i,t),this._appendVertex(p.x()-m+y,p.y()-f+E,i,0,t),this._appendVertex(p.x()+m-y,p.y()+f-E,0,-i,t),this._appendVertex(p.x()+m+y,p.y()+f+E,-i,0,t)}this._appendPreviousVertex()}_appendVertex(e,t,n,o,i){this._previousX=e,this._previousY=t,this._previousU=n,this._previousV=o,this._previousColor=i,this._vertices.appendFloat(e).appendFloat(t).appendFloat(n).appendFloat(o),this._vertices.appendByte(O.red(i)).appendByte(O.green(i)).appendByte(O.blue(i)).appendByte(O.alpha(i))}_appendPreviousVertex(){this._appendVertex(this._previousX,this._previousY,this._previousU,this._previousV,this._previousColor)}_length(e,t){return Math.sqrt(e*e+t*t)}};(e=>{let r;(o=>(o[o.CLOSED=0]="CLOSED",o[o.OPEN=1]="OPEN"))(r=e.Loop||(e.Loop={}))})(Ba||(Ba={}));var np=(n=>(n[n.WEBGL_TEXTURE=0]="WEBGL_TEXTURE",n[n.WEBGL_BUFFER=1]="WEBGL_BUFFER",n[n.WEBGL_RENDERBUFFER=2]="WEBGL_RENDERBUFFER",n))(np||{}),rp=class{increment(e,t,n){var l,d;let o=this._vramUsedByTypeAndPurpose.get(e)||new Map,a=(o.get(t)||0)+n;o.set(t,a),this._vramUsedByTypeAndPurpose.has(e)||this._vramUsedByTypeAndPurpose.set(e,o),Rr.trackNumber(np[e]+` (${t})`,a);let s=(d=(l=N())==null?void 0:l.modules())==null?void 0:d.corePerfInfo;switch(e){case 0:{if(!(t in yr))break;let c=t;n>=0?s==null||s.textureMemStatsAlloc(c,n):s==null||s.textureMemStatsFree(c,-n);break}case 1:{let c=t;n>=0?s==null||s.rendererMemStatsAlloc(Ss.VERTEX_BUFFER,n):s==null||s.rendererMemStatsFree(Ss.VERTEX_BUFFER,-n);break}case 2:{n>=0?s==null||s.rendererMemStatsAlloc(Ss.RENDERBUFFER,n):s==null||s.rendererMemStatsFree(Ss.RENDERBUFFER,-n);break}}}decrement(e,t,n){this.increment(e,t,-n)}resetOnContextRestored(){this._vramUsedByTypeAndPurpose=new Map}constructor(){this._vramUsedByTypeAndPurpose=new Map}forType(e){if(!this._vramUsedByTypeAndPurpose.has(e))return 0;let t=0,n=this._vramUsedByTypeAndPurpose.get(e);for(let o of n.values())t+=o;return t}total(){let e=0;for(let t of this._vramUsedByTypeAndPurpose.values())for(let n of t.values())e+=n;return e}},Be;(o=>{function r(i,a,s){i.setUniformVec21(a,s.x(),s.y())}o.Material_setUniformVec22=r;function e(i,a,s){i.setUniformVec41(a,O.redF(s),O.greenF(s),O.blueF(s),O.alphaF(s))}o.Material_setUniformVec42=e;function t(i,a,s){i.setUniformVec41(a,s.x(),s.y(),s.x()+s.width(),s.y()+s.height())}o.Material_setUniformVec43=t;function n(i,a,s){i.setUniformMat31(a,s.m00(),s.m01(),s.m02(),s.m10(),s.m11(),s.m12())}o.Material_setUniformMat32=n})(Be||(Be={}));var vs;(t=>{function r(n){switch(n){case 2:return 3.58/8;case 1:case 0:default:return 4}}t.PixelFormat_byteCount=r;function e(n){switch(n){case 2:return!0;default:return!1}}t.PixelFormat_isCompressedFormat=e})(vs||(vs={}));var Mo;(n=>{function r(o,i,a){o.resize1(i,a,null,!1)}n.Texture_resize2=r;function e(o,i,a,s){o.resize1(i,a,s,!1)}n.Texture_resize3=e;function t(o){return o.width()*o.height()*vs.PixelFormat_byteCount(o.format().pixelFormat)}n.Texture_totalVRAM=t})(Mo||(Mo={}));var bm=!0;var ca;(d=>{function r(){let c=Bc(Y.shouldUseWebGL2());if(c==null)return!1;let p=c.canvas;document.body.appendChild(p);let u=c.createProgram();if(u==null)return!1;let _=c.createShader(c.VERTEX_SHADER);if(_==null)return!1;c.shaderSource(_,`
        precision highp float;
        attribute vec2 pos;
        void main(){
          gl_Position=vec4(pos*2.-1.,0.,1.);
        }
      `),c.compileShader(_),c.attachShader(u,_);let h=c.createShader(c.FRAGMENT_SHADER);if(h==null)return!1;c.shaderSource(h,`
        precision highp float;
        void main(){
          gl_FragColor=vec4(0., 0., 0., 1.);
        }
      `),c.compileShader(h),c.attachShader(u,h),c.bindAttribLocation(u,0,"pos"),c.linkProgram(u);let S=c.createBuffer();if(S==null)return!1;c.bindBuffer(c.ARRAY_BUFFER,S);let m=new Float32Array([0,0,1,0,0,1,1,1]);c.bufferData(c.ARRAY_BUFFER,m.length*4,c.DYNAMIC_DRAW),c.bufferSubData(c.ARRAY_BUFFER,0,m),c.enableVertexAttribArray(0),c.vertexAttribPointer(0,2,c.FLOAT,!1,8,0),c.canvas.width=10,c.canvas.height=1;let f=c.createFramebuffer();if(f==null)return!1;c.bindFramebuffer(c.FRAMEBUFFER,f);let T=c.createTexture();if(T==null)return!1;c.bindTexture(c.TEXTURE_2D,T),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),c.bindTexture(c.TEXTURE_2D,T),c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.canvas.width,c.canvas.height,0,c.RGBA,c.UNSIGNED_BYTE,null),c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,T,0),c.useProgram(u),c.bindFramebuffer(c.FRAMEBUFFER,f),c.viewport(0,0,c.canvas.width/2|0,c.canvas.height),c.drawArrays(c.TRIANGLE_STRIP,0,4),c.bindFramebuffer(c.FRAMEBUFFER,null),c.viewport(0,0,c.canvas.width/2|0,c.canvas.height),c.drawArrays(c.TRIANGLE_STRIP,0,4);let y=new Uint8Array(4);return c.readPixels((c.canvas.width/2|0)+2,0,1,1,c.RGBA,c.UNSIGNED_BYTE,y),document.body.removeChild(p),y[3]!=0}d._featureDetectViewportBug=r;function e(){let c=Bc(Y.shouldUseWebGL2());if(c==null)return!1;let p=c.canvas;document.body.appendChild(p),c.canvas.width=1,c.canvas.height=1;let u=c.createTexture();if(u==null)return!1;c.bindTexture(c.TEXTURE_2D,u),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),c.bindTexture(c.TEXTURE_2D,u),c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.canvas.width,c.canvas.height,0,c.RGBA,c.UNSIGNED_BYTE,null),c.bindTexture(c.TEXTURE_2D,u);let _=c.createFramebuffer();if(_==null)return!1;c.bindFramebuffer(c.FRAMEBUFFER,_),c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,u,0);let h=c.createBuffer();if(h==null)return!1;c.bindBuffer(c.ARRAY_BUFFER,h),c.bufferData(c.ARRAY_BUFFER,32,c.DYNAMIC_DRAW),c.bufferSubData(c.ARRAY_BUFFER,0,new Float32Array([1,1,1,-1,-1,1,-1,-1])),c.vertexAttribPointer(0,2,c.FLOAT,!1,8,0),c.enableVertexAttribArray(0),c.bindBuffer(c.ARRAY_BUFFER,h);let S=c.createProgram();if(S==null)return!1;let m=c.createShader(c.VERTEX_SHADER);if(m==null)return!1;c.shaderSource(m,`
        precision highp float;
        attribute vec2 pos;
        varying vec2 uv;
        void main(){
          uv = (pos + vec2(1.0)) / 2.0;
          gl_Position=vec4(pos*2.-1.,0.,1.);
        }
      `),c.compileShader(m),c.attachShader(S,m);let f=c.createShader(c.FRAGMENT_SHADER);if(f==null)return!1;c.shaderSource(f,`
        precision highp float;
        uniform sampler2D texture;
        varying vec2 uv;
        void main(){
          gl_FragColor=texture2D(texture, uv);
        }
      `),c.compileShader(f),c.attachShader(S,f),c.linkProgram(S);let T=c.createProgram();if(T==null)return!1;let y=c.createShader(c.VERTEX_SHADER);if(y==null)return!1;c.shaderSource(y,`
        precision highp float;
        attribute vec2 pos;
        void main(){
          gl_Position=vec4(pos,0.,1.);
        }
      `),c.compileShader(y),c.attachShader(T,y);let E=c.createShader(c.FRAGMENT_SHADER);if(E==null)return!1;c.shaderSource(E,`
        precision highp float;
        void main(){
          gl_FragColor=vec4(0.,0.,1.,1.);
        }
      `),c.compileShader(E),c.attachShader(T,E),c.bindAttribLocation(T,0,"pos"),c.linkProgram(T),c.clearColor(1,0,0,1),c.bindFramebuffer(c.FRAMEBUFFER,_),c.useProgram(T),c.drawArrays(c.TRIANGLE_STRIP,0,4),c.bindFramebuffer(c.FRAMEBUFFER,null),c.useProgram(S),c.drawArrays(c.TRIANGLE_STRIP,0,4),c.bindFramebuffer(c.FRAMEBUFFER,_),c.clear(c.COLOR_BUFFER_BIT),c.bindFramebuffer(c.FRAMEBUFFER,null),c.useProgram(S),c.drawArrays(c.TRIANGLE_STRIP,0,4);let v=new Uint8Array(4);return c.readPixels(0,0,1,1,c.RGBA,c.UNSIGNED_BYTE,v),document.body.removeChild(p),v[0]!=255}d._featureDetectDrawClearReorderingBug=e;function t(){return d._hasViewportBug==null?(Oe("Called hasViewportBug before running feature detection"),!1):d._hasViewportBug.value}d.hasViewportBug=t;function n(){return d._hasDrawClearReorderingBug==null?(Oe("Called hasDrawClearReorderingBug before running feature detection"),!1):d._hasDrawClearReorderingBug.value}d.hasDrawClearReorderingBug=n;function o(){return d._hasUnexpectedCompositingBug==null?(Oe("Called hasDrawClearReorderingBug before running feature detection"),!1):d._hasUnexpectedCompositingBug.value}d.hasUnexpectedCompositingBug=o;function i(){d._hasViewportBug=new ce(r()),t()&&console.warn("GPUBugs: device has buggy implementation of gl.viewport. Will apply workarounds."),d._hasDrawClearReorderingBug=new ce(e()),n()&&console.warn("GPUBugs: Device may re-order draw/clear commands. Will apply workarounds.");let c=navigator.userAgent,p=(c.indexOf("iPhone OS 14_0")|0)!=-1,u=(c.indexOf("iPhone OS 14_1")|0)!=-1,_=p||u,h=(c.indexOf("iPad; CPU OS 14_0")|0)!=-1,S=(c.indexOf("iPad; CPU OS 14_1")|0)!=-1,m=h||S,T=(c.indexOf("Version/14")|0)!=-1&&(c.indexOf("Safari")|0)!=-1&&(navigator.maxTouchPoints|0)>0;d._hasUnexpectedCompositingBug=new ce(_||m||T)}d.detect=i,d._hasViewportBug=null,d._hasDrawClearReorderingBug=null,d._hasUnexpectedCompositingBug=null})(ca||(ca={}));var Os=class Os{static instance(){return Os._instance==null&&(Os._instance=new Os),Os._instance}requestLibrary(){this.startLibLoad()}onLoadComplete(e){this._videoJsLib=e,this.onSuccess!=null&&this.onSuccess()}hasRequestedLibrary(){return this._requestStarted}isLibAvailable(){return this._videoJsLib!==null}getPlayer(e,t){return this._videoJsLib===null?(console.warn("VideoJS used before initialized"),null):this._videoJsLib.videoJs(e,{preload:t}).player()}constructor(){this._videoJsLib=null,this._requestStarted=!1,this.startLibLoad=null,this.onSuccess=null}};Os._instance=null;var Zn=Os,kc;(e=>{function r(t){let n=document.getElementById(t.id());return(n==null?void 0:n.getElementsByTagName("video"))[0]}e.VideoJsPlayer_getBackingVideo=r})(kc||(kc={}));var Zr=class Zr{static fromMinAndMax(e,t,n,o){return new Zr(e,t,n-e,o-t)}static fromRect(e){return new Zr(e.x(),e.y(),e.width(),e.height())}constructor(e,t,n,o){this._x=0,this._y=0,this._width=0,this._height=0,this._x=e,this._y=t,this._width=n,this._height=o}x(){return this._x}y(){return this._y}width(){return this._width}height(){return this._height}setX(e){this._x=e}setY(e){this._y=e}setWidth(e){this._width=e}setHeight(e){this._height=e}clone(){return new Zr(this.x(),this.y(),this.width(),this.height())}freeze(){return this.clone()}left(){return this.x()}top(){return this.y()}right(){return this.x()+this.width()}bottom(){return this.y()+this.height()}centerX(){return this.x()+this.width()/2}centerY(){return this.y()+this.height()/2}area(){return this.width()*this.height()}isEmpty(){return!(this.width()>0&&this.height()>0)}isInvalid(){return!(this.width()>=0&&this.height()>=0)}isFinite(){return isFinite(this._x)&&isFinite(this._y)&&isFinite(this._width)&&isFinite(this._height)}equals(e){return this.x()==e.x()&&this.y()==e.y()&&this.width()==e.width()&&this.height()==e.height()}contains1(e){return this.isEmpty()||e.isEmpty()?!1:this._x<=e.x()&&this._y<=e.y()&&this._x+this._width>=e.x()+e.width()&&this._y+this._height>=e.y()+e.height()}contains2(e){return!this.isEmpty()&&e!=null&&this.left()<=e.x()&&e.x()<this.right()&&this.top()<=e.y()&&e.y()<this.bottom()}overlaps(e){return!this.isEmpty()&&e!=null&&!e.isEmpty()&&this.left()<e.right()&&e.left()<this.right()&&this.top()<e.bottom()&&e.top()<this.bottom()}distanceTo(e){let t=Math.max(0,Math.abs(this.centerX()-e.centerX())-(this.width()+e.width())/2),n=Math.max(0,Math.abs(this.centerY()-e.centerY())-(this.height()+e.height())/2);return Math.sqrt(t*t+n*n)}topLeft(){return new b(this.left(),this.top())}topRight(){return new b(this.right(),this.top())}bottomLeft(){return new b(this.left(),this.bottom())}bottomRight(){return new b(this.right(),this.bottom())}size(){return new b(this.width(),this.height())}center(){return new b(this.x()+this.width()/2,this.y()+this.height()/2)}centerSelf(){return this.translate2(this.center().negative()),this}translate1(e,t){this._x+=e,this._y+=t}translate2(e){this._x+=e.x(),this._y+=e.y()}translatedBy(e){let t=this.clone();return t.translate2(e),t}scaleFromCenter(e){e-=1,this.expand2(this.width()*e,this.height()*e)}scaledBy1(e){return this.scaledBy2(new b(e,e))}scaledBy2(e){return this.isInvalid()?this.copyFrom(Zr.INVALID):this.isFinite()?(this._x=this._x*e.x(),this._y=this._y*e.y(),this._width=this._width*e.x(),this._height=this._height*e.y(),this):this.copyFrom(Zr.INFINITE)}expandToInts(){let e=Math.floor(this._x),t=Math.floor(this._y);this._width=Math.ceil(this._x+this._width)-e,this._height=Math.ceil(this._y+this._height)-t,this._x=e,this._y=t}setTo1(e,t,n,o){return this._x=e,this._y=t,this._width=n,this._height=o,this}setTo2(e,t){return this._x=e.x(),this._y=e.y(),this._width=t.x(),this._height=t.y(),this}copyFrom(e){return this.setX(e.x()),this.setY(e.y()),this.setWidth(e.width()),this.setHeight(e.height()),this}expand1(e){this._x-=e,this._y-=e,this._width+=2*e,this._height+=2*e}contract(e){this.expand1(-e)}expandedBy1(e){return this.expand1(e),this}expandedBy2(e,t){return this.expand2(e,t),this}expand2(e,t){this._x-=e,this._y-=t,this._width+=2*e,this._height+=2*t}expandToInclude(e){if(e.isEmpty())return;if(this.isEmpty()){this.copyFrom(e);return}let t=Math.min(this._x,e.x()),n=Math.min(this._y,e.y());this._width=Math.max(this._x+this._width,e.x()+e.width())-t,this._height=Math.max(this._y+this._height,e.y()+e.height())-n,this._x=t,this._y=n}intersectedWith(e){return this.intersectWith(e),this}intersectWith(e){if(this.isEmpty()||e.isEmpty())this.copyFrom(Yr.FrozenRect_EMPTY);else{let t=Math.max(this._x,e.x()),n=Math.max(this._y,e.y());this._width=Math.min(this._x+this._width,e.x()+e.width())-t,this._height=Math.min(this._y+this._height,e.y()+e.height())-n,this._x=t,this._y=n}}round(){let e=Math.round(this._x),t=Math.round(this._y),n=Math.round(this._x+this._width),o=Math.round(this._y+this._height);this._x=e,this._y=t,this._width=n-e,this._height=o-t}rounded(){return this.round(),this}toString(){return`Rect(${this.x()}, ${this.y()}, ${this.width()}, ${this.height()})`}transformInto1(e,t){ht.INSTANCE.reset();let n=b.new();for(let o=0;o<4;o=o+1)n.setTo(this._x+this._width*(o&1),this._y+this._height*(o>>1)),t.transformPoint(n),ht.INSTANCE.include2(n);ht.INSTANCE.buildTo(e)}transformBy1(e){this.transformInto1(this,e)}transformInto2(e,t){ht.INSTANCE.reset();let n=b.new();for(let o=0;o<4;o=o+1)n.setTo(this._x+this._width*(o&1),this._y+this._height*(o>>1)),t.transformPoint(n),ht.INSTANCE.include2(n);ht.INSTANCE.buildTo(e)}transformBy2(e){this.transformInto2(this,e)}leftThird(){return new Zr(this._x,this._y,this._width/3,this._height)}rightThird(){let e=this._width/3;return new Zr(this._x+2*e,this._y,this._width/3,this._height)}static new2(){return new Zr(0,0,0,0)}static new3(e){return new Zr(e.x(),e.y(),e.width(),e.height())}static new4(e,t){return new Zr(e.x(),e.y(),t.x(),t.y())}};Zr.INVALID=new Zr(1/0,1/0,-1/0,-1/0),Zr.INFINITE=new Zr(-1/0,-1/0,1/0,1/0),Zr.CLIP=Zr.fromMinAndMax(-1,-1,1,1),Zr.UNIT=new Zr(0,0,1,1);var G=Zr,op=class op{constructor(){this._minX=0,this._minY=0,this._maxX=0,this._maxY=0,this.reset()}isValid(){return this._minX<this._maxX&&this._minY<this._maxY}isValidOrZeroArea(){return this._minX<=this._maxX&&this._minY<=this._maxY}reset(){this._minX=1/0,this._minY=1/0,this._maxX=-1/0,this._maxY=-1/0}include1(e,t){this._minX=Math.min(this._minX,e),this._minY=Math.min(this._minY,t),this._maxX=Math.max(this._maxX,e),this._maxY=Math.max(this._maxY,t)}include2(e){this.include1(e.x(),e.y())}include3(e){e!=null&&!e.isEmpty()&&(this.include1(e.left(),e.top()),this.include1(e.right(),e.bottom()))}include4(e,t){if(!e.isEmpty()){let n=G.new2();e.transformInto1(n,t),this.include3(n)}}buildTo(e){e.setTo1(this._minX,this._minY,this._maxX-this._minX,this._maxY-this._minY)}build(){let e=G.new2();return this.buildTo(e),e}};op.INSTANCE=new op;var ht=op,da=class r{constructor(){if(arguments[0]==0){let[,e,t,n,o]=arguments;this._rect=null,this._nodeRadius=0,this._vertexRadii=null,this._cornerSmoothing=0,this._rect=G.new4(e,t),this._nodeRadius=n,this._cornerSmoothing=o}else if(arguments[0]==1){let[,e,t,n,o]=arguments;this._rect=null,this._nodeRadius=0,this._vertexRadii=null,this._cornerSmoothing=0,this._rect=G.new4(e,t),this._vertexRadii=n,this._cornerSmoothing=o}else if(arguments[0]==2){let[,e,t,n,o]=arguments;this._rect=null,this._nodeRadius=0,this._vertexRadii=null,this._cornerSmoothing=0,this._rect=e,this._nodeRadius=t,this._vertexRadii=n}}clone(){var e;return new r(2,this._rect.clone(),this._nodeRadius,(e=this._vertexRadii)==null?void 0:e.slice(),this._cornerSmoothing)}cornerSmoothing(){return this._cornerSmoothing}left(){return this._rect.x()}top(){return this._rect.top()}width(){return this._rect.width()}height(){return this._rect.height()}rect(){return this._rect}nodeRadius(){return this._nodeRadius}vertexRadii(){return this._vertexRadii}isRounded(){return this._nodeRadius>0||this._vertexRadii!=null&&this._vertexRadii.some(e=>e>0)}isUniform(){return this._nodeRadius>0&&this._vertexRadii==null||this._vertexRadii!=null&&this._vertexRadii[0]==this._vertexRadii[1]&&this._vertexRadii[1]==this._vertexRadii[2]&&this._vertexRadii[2]==this._vertexRadii[3]}isSimpleRoundedRect(){return this.isUniform()&&this._cornerSmoothing==0}transform(e){e.transformRect(this._rect)}contract(e){this._rect.contract(e)}expand(e){this._rect.expand1(e)}adjustCornerRadiiForSpread(e){if(this._vertexRadii!=null)for(let t=0,n=this.vertexRadii().length;t<n;t=t+1)this._vertexRadii[t]!=0&&(this._vertexRadii[t]=Math.max(this._vertexRadii[t]+e,0));else this._nodeRadius!=0&&(this._nodeRadius=Math.max(this._nodeRadius+e,0))}},Yr;(i=>{function r(){return G.new2()}i.FrozenRect_new1=r;function e(a){return a}i.FrozenRect_new2=e;function t(a){return G.new3(a)}i.FrozenRect_new3=t;function n(a,s,l,d){return new G(a,s,l,d)}i.FrozenRect_new4=n,i.FrozenRect_EMPTY=r()})(Yr||(Yr={}));var J=class r{constructor(e,t,n,o,i,a){this._m00=0,this._m01=0,this._m02=0,this._m10=0,this._m11=0,this._m12=0,this._m00=e,this._m01=t,this._m02=n,this._m10=o,this._m11=i,this._m12=a}m00(){return this._m00}m01(){return this._m01}m02(){return this._m02}m10(){return this._m10}m11(){return this._m11}m12(){return this._m12}setM00(e){this._m00=e}setM01(e){this._m01=e}setM02(e){this._m02=e}setM10(e){this._m10=e}setM11(e){this._m11=e}setM12(e){this._m12=e}axisX(){return new b(this.m00(),this.m10())}axisY(){return new b(this.m01(),this.m11())}clone(){return new r(this.m00(),this.m01(),this.m02(),this.m10(),this.m11(),this.m12())}toAngle(){return Math.atan2(-this.m01(),this.m00())}scale1(){return new b(Math.sqrt(this.m00()*this.m00()+this.m10()*this.m10()),Math.sqrt(this.m01()*this.m01()+this.m11()*this.m11()))}hasPerpendicularAxes(e){return Math.abs(this.m00()*this.m10()+this.m01()*this.m11())<e}isAxisAligned(e){return Math.abs(this.m00())<e&&Math.abs(this.m11())<e||Math.abs(this.m01())<e&&Math.abs(this.m10())<e}isAxisAlignedScaleInvariant(e){let t=Math.sqrt(this._m00*this._m00+this._m10*this._m10)*e,n=Math.sqrt(this._m01*this._m01+this._m11*this._m11)*e;return Math.abs(this.m00())<t&&Math.abs(this.m11())<n||Math.abs(this.m01())<t&&Math.abs(this.m10())<n}valueEquals(e,t){return e==t||isNaN(e)&&isNaN(t)}equals1(e){return this.valueEquals(this._m00,e.m00())&&this.valueEquals(this._m01,e.m01())&&this.valueEquals(this._m02,e.m02())&&this.valueEquals(this._m10,e.m10())&&this.valueEquals(this._m11,e.m11())&&this.valueEquals(this._m12,e.m12())}equals2(e,t){return Math.abs(this._m00-e.m00())<t&&Math.abs(this._m01-e.m01())<t&&Math.abs(this._m02-e.m02())<t&&Math.abs(this._m10-e.m10())<t&&Math.abs(this._m11-e.m11())<t&&Math.abs(this._m12-e.m12())<t}translation(){return new b(this._m02,this._m12)}translate1(e){this.translate2(e.x(),e.y())}translate2(e,t){this._m02+=e*this.m00()+t*this.m01(),this._m12+=e*this.m10()+t*this.m11()}translatedBy1(e){return this.translate1(e),this}translatedBy2(e,t){return this.translate2(e,t),this}rotatedBy(e){return this.rotate(e),this}rotate(e){let t=Math.sin(e),n=Math.cos(e),o=n*this.m00()+t*this.m01(),i=n*this.m01()-t*this.m00(),a=n*this.m10()+t*this.m11(),s=n*this.m11()-t*this.m10();this._m00=o,this._m01=i,this._m10=a,this._m11=s}scale2(e){this.scale4(e,e)}scale3(e){this.scale4(e.x(),e.y())}scale4(e,t){this._m00*=e,this._m01*=t,this._m10*=e,this._m11*=t}skewX(e){let t=Math.tan(e);this._m01+=this._m00*t,this._m11+=this._m10*t}skewY(e){let t=Math.tan(e);this._m00+=this._m01*t,this._m10+=this._m10*t}scaledBy1(e){return this.scale3(e),this}scaledBy2(e){return this.scale2(e),this}scaledBy3(e,t){return this.scale4(e,t),this}multiply(e){let t=this.m00()*e.m00()+this.m01()*e.m10(),n=this.m00()*e.m01()+this.m01()*e.m11(),o=this.m00()*e.m02()+this.m01()*e.m12()+this.m02(),i=this.m10()*e.m00()+this.m11()*e.m10(),a=this.m10()*e.m01()+this.m11()*e.m11(),s=this.m10()*e.m02()+this.m11()*e.m12()+this.m12();this._m00=t,this._m01=n,this._m02=o,this._m10=i,this._m11=a,this._m12=s}rightMultiply(e){this.multiply(e)}leftMultiply(e){let t=this.m00()*e.m00()+this.m10()*e.m01(),n=this.m01()*e.m00()+this.m11()*e.m01(),o=this.m02()*e.m00()+this.m12()*e.m01()+e.m02(),i=this.m00()*e.m10()+this.m10()*e.m11(),a=this.m01()*e.m10()+this.m11()*e.m11(),s=this.m02()*e.m10()+this.m12()*e.m11()+e.m12();this._m00=t,this._m01=n,this._m02=o,this._m10=i,this._m11=a,this._m12=s}multipliedBy1(e){return this.multiply(e),this}multipliedBy2(e){return this.multipliedBy1(yt.FrozenAffineTransform_new6(e))}invert(){let e=1/(this.m00()*this.m11()-this.m01()*this.m10());if(!isFinite(e))return!1;let t=this.m11()*e,n=-this.m01()*e,o=(this.m01()*this.m12()-this.m11()*this.m02())*e,i=-this.m10()*e,a=this.m00()*e,s=(this.m10()*this.m02()-this.m00()*this.m12())*e;return this._m00=t,this._m01=n,this._m02=o,this._m10=i,this._m11=a,this._m12=s,!0}inverse(){let e=this.clone(),t=e.invert();return e}transformPoint(e){let t=this.m00()*e.x()+this.m01()*e.y()+this.m02(),n=this.m10()*e.x()+this.m11()*e.y()+this.m12();return e.setX(t),e.setY(n),e}transformPoints(e){for(let t=0,n=e.length;t<n;t=t+1){let o=e[t],i=this.m00()*o.x()+this.m01()*o.y()+this.m02(),a=this.m10()*o.x()+this.m11()*o.y()+this.m12();o.setX(i),o.setY(a)}return e}transformDirection(e){let t=this.m00()*e.x()+this.m01()*e.y(),n=this.m10()*e.x()+this.m11()*e.y();return e.setX(t),e.setY(n),e}transformRect(e){if(e.isInvalid())return e.copyFrom(G.INVALID);if(!e.isFinite())return e.copyFrom(G.INFINITE);let t=new ht;return t.include2(this.transformPoint(e.topLeft())),t.include2(this.transformPoint(e.topRight())),t.include2(this.transformPoint(e.bottomLeft())),t.include2(this.transformPoint(e.bottomRight())),t.buildTo(e),e}setTo(e,t,n,o,i,a){return this._m00=e,this._m01=t,this._m02=n,this._m10=o,this._m11=i,this._m12=a,this}copyFrom(e){return this._m00=e.m00(),this._m01=e.m01(),this._m02=e.m02(),this._m10=e.m10(),this._m11=e.m11(),this._m12=e.m12(),this}postTranslate(e){let t=r.new2();t.translate1(e),this.leftMultiply(t)}postRotate(e){let t=r.new2();t.rotate(e),this.leftMultiply(t)}postScale(e){let t=r.new2();t.scale3(e),this.leftMultiply(t)}offset(){return new b(this.m02(),this.m12())}toString(){return`AffineTransform(${this.m00()}, ${this.m01()}, ${this.m02()}, ${this.m10()}, ${this.m11()}, ${this.m12()})`}static new2(){return new r(1,0,0,0,1,0)}static new3(e){return new r(e.m00(),e.m01(),e.m02(),e.m10(),e.m11(),e.m12())}static new4(e){return new r(e.scale(),0,e.offset().x(),0,e.scale(),e.offset().y())}static translated(e,t){let n=r.new2();return n.translate2(e,t),n}},yt;(s=>{function r(){return J.new2()}s.FrozenAffineTransform_new1=r;function e(l){return l}s.FrozenAffineTransform_new2=e;function t(l){return J.new3(l)}s.FrozenAffineTransform_new3=t;function n(l,d,c,p,u,_){return new J(l,d,c,p,u,_)}s.FrozenAffineTransform_new4=n;function o(l){return J.new4(l)}s.FrozenAffineTransform_new5=o;function i(l){return J.new4(l)}s.FrozenAffineTransform_new6=i,s.FrozenAffineTransform_IDENTITY=r()})(yt||(yt={}));var Nm=class{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}},Cs=class{constructor(e,t,n,o){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+t,n),this._littleEndian=o,this._offset=0}_nextUint8(){let e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){let e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){let e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){let e=this._dataView.getUint32(this._offset,this._littleEndian),t=this._dataView.getUint32(this._offset+4,this._littleEndian),n=e+2**32*t;return this._offset+=8,n}_nextInt32(){let e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint8Array(e){let t=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._offset,e);return this._offset+=e,t}_skip(e){return this._offset+=e,this}_scan(e,t=0){let n=this._offset,o=0;for(;this._dataView.getUint8(this._offset)!==t&&o<e;)o++,this._offset++;return o<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+n,o)}};var dB=new Uint8Array([0]),Jn=[171,75,84,88,32,50,48,187,13,10,26,10];function Cy(r){return new TextDecoder().decode(r)}function by(r){let e=new Uint8Array(r.buffer,r.byteOffset,Jn.length);if(e[0]!==Jn[0]||e[1]!==Jn[1]||e[2]!==Jn[2]||e[3]!==Jn[3]||e[4]!==Jn[4]||e[5]!==Jn[5]||e[6]!==Jn[6]||e[7]!==Jn[7]||e[8]!==Jn[8]||e[9]!==Jn[9]||e[10]!==Jn[10]||e[11]!==Jn[11])throw new Error("Missing KTX 2.0 identifier.");let t=new Nm,n=17*Uint32Array.BYTES_PER_ELEMENT,o=new Cs(r,Jn.length,n,!0);t.vkFormat=o._nextUint32(),t.typeSize=o._nextUint32(),t.pixelWidth=o._nextUint32(),t.pixelHeight=o._nextUint32(),t.pixelDepth=o._nextUint32(),t.layerCount=o._nextUint32(),t.faceCount=o._nextUint32();let i=o._nextUint32();t.supercompressionScheme=o._nextUint32();let a=o._nextUint32(),s=o._nextUint32(),l=o._nextUint32(),d=o._nextUint32(),c=o._nextUint64(),p=o._nextUint64(),u=i*3*8,_=new Cs(r,Jn.length+n,u,!0);for(let H=0;H<i;H++)t.levels.push({levelData:new Uint8Array(r.buffer,r.byteOffset+_._nextUint64(),_._nextUint64()),uncompressedByteLength:_._nextUint64()});let h=new Cs(r,a,s,!0),S={vendorId:h._skip(4)._nextUint16(),descriptorType:h._nextUint16(),versionNumber:h._nextUint16(),descriptorBlockSize:h._nextUint16(),colorModel:h._nextUint8(),colorPrimaries:h._nextUint8(),transferFunction:h._nextUint8(),flags:h._nextUint8(),texelBlockDimension:[h._nextUint8(),h._nextUint8(),h._nextUint8(),h._nextUint8()],bytesPlane:[h._nextUint8(),h._nextUint8(),h._nextUint8(),h._nextUint8(),h._nextUint8(),h._nextUint8(),h._nextUint8(),h._nextUint8()],samples:[]},T=(S.descriptorBlockSize/4-6)/4;for(let H=0;H<T;H++){let z={bitOffset:h._nextUint16(),bitLength:h._nextUint8(),channelType:h._nextUint8(),samplePosition:[h._nextUint8(),h._nextUint8(),h._nextUint8(),h._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};z.channelType&64?(z.sampleLower=h._nextInt32(),z.sampleUpper=h._nextInt32()):(z.sampleLower=h._nextUint32(),z.sampleUpper=h._nextUint32()),S.samples[H]=z}t.dataFormatDescriptor.length=0,t.dataFormatDescriptor.push(S);let y=new Cs(r,l,d,!0);for(;y._offset<d;){let H=y._nextUint32(),z=y._scan(H),Q=Cy(z);if(t.keyValue[Q]=y._nextUint8Array(H-z.byteLength-1),Q.match(/^ktx/i)){let j=Cy(t.keyValue[Q]);t.keyValue[Q]=j.substring(0,j.lastIndexOf("\0"))}let K=H%4?4-H%4:0;y._skip(K)}if(p<=0)return t;let E=new Cs(r,c,p,!0),v=E._nextUint16(),A=E._nextUint16(),I=E._nextUint32(),C=E._nextUint32(),g=E._nextUint32(),R=E._nextUint32(),D=[];for(let H=0;H<i;H++)D.push({imageFlags:E._nextUint32(),rgbSliceByteOffset:E._nextUint32(),rgbSliceByteLength:E._nextUint32(),alphaSliceByteOffset:E._nextUint32(),alphaSliceByteLength:E._nextUint32()});let P=c+E._offset,U=P+I,B=U+C,M=B+g,F=new Uint8Array(r.buffer,r.byteOffset+P,I),w=new Uint8Array(r.buffer,r.byteOffset+U,C),V=new Uint8Array(r.buffer,r.byteOffset+B,g),k=new Uint8Array(r.buffer,r.byteOffset+M,R);return t.globalData={endpointCount:v,selectorCount:A,imageDescs:D,endpointsData:F,selectorsData:w,tablesData:V,extendedData:k},t}var ip=class{seconds(){return Is.Performance_now(mn().performance)/1e3}milliseconds(){return Is.Performance_now(mn().performance)}constructor(){}};var Tl=class{reset(){this._seconds=0}advanceSeconds(e){this._seconds+=e}seconds(){return this._seconds}milliseconds(){return this._seconds*1e3}constructor(){this._seconds=0}},Me;(a=>{function r(s){a._implementations.push(s)}a.dangerouslyPushMockTime=r;function e(){if(a._implementations.length==1)throw new Error("Popping last time implementation");ne.List_removeLast(a._implementations)}a.popMockTime=e;function t(){return ne.List_last(a._implementations).seconds()}a.seconds=t;function n(){return ne.List_last(a._implementations).milliseconds()}a.milliseconds=n;function o(s){let l=t(),d=t();for(;d-l<s;)d=t()}a.spin=o,a._implementations=[new ip]})(Me||(Me={}));var Pm=class{constructor(e){this._byteLength=0,this._cachedPx=null,this._cachedFrameIdx=null,this._byteLength=e,this._cachedPx=new Uint8Array(this._byteLength)}save(e,t){this._cachedFrameIdx!=null&&this._cachedFrameIdx.value==e||(this._cachedPx.set(t),this._cachedFrameIdx=new ce(e))}saveEmpty(e){this._cachedFrameIdx!=null&&this._cachedFrameIdx.value==e||(e!=0&&Oe("Saving empty frame for idx \u2260 0"),this._cachedPx.fill(0),this._cachedFrameIdx=new ce(e))}getLastNonDisposedFrame(){return this._cachedFrameIdx==null&&Oe("Attempting to get cached non-disposed frame while cache index has not been set"),this._cachedPx}},ii=class ii{constructor(e){this._width=0,this._height=0,this._frameCount=0,this._loopCount=0,this._currentLoop=0,this._frameByteLength=0,this._buf=null,this._frameInfos=null,this._startedPlayingMs=-1,this._currentFrame=-1,this._desiredFrameStartTimeMs=0,this._currentFramePx=null,this._prevDisposal=0,this._needPreviousFrame=!1,this._previousFrameCache=null,this._width=e.width,this._height=e.height,this._frameCount=e.frameCount,this._loopCount=e.loopCount,this._frameByteLength=this._width*this._height*4,this._buf=e.buf,this._frameInfos=e.frameInfos,this._currentFramePx=new Uint8Array(this._frameByteLength),this._needPreviousFrame=e.needLastNonDisposed,this._needPreviousFrame&&(this._previousFrameCache=new Pm(this._frameByteLength))}width(){return this._width}height(){return this._height}frameCount(){return this._frameCount}loopCount(){return this._loopCount}loopsForever(){return this._loopCount==0}frameInfo(e){return(e<0||e>=this._frameInfos.length)&&ii.fail("Frame index out of range."),this._frameInfos[e]}_shouldAdvance(){if(!this.loopsForever()&&this._currentFrame==this._frameCount-1&&(this._loopCount==-1||this._loopCount==this._currentLoop))return ii.ShouldAdvance.NO;if(this._startedPlayingMs<0)return this._startedPlayingMs=Me.milliseconds(),ii.ShouldAdvance.ONCE;let e=this.loopsForever()?ii.ShouldAdvance.UNTIL_CAUGHT_UP:ii.ShouldAdvance.ONCE;return Me.milliseconds()-this._startedPlayingMs>=this._desiredFrameStartTimeMs?e:ii.ShouldAdvance.NO}_advanceFrame(){this._currentFrame=this._currentFrame+1,this._currentFrame>=this._frameCount&&(this._currentLoop=this._currentLoop+1,this._currentFrame=gt.int_remainder(this._currentFrame,this._frameCount));let e=this.frameInfo(this._currentFrame).delay*10;return e<=10&&(e=100),this._desiredFrameStartTimeMs+=e,this._blitFrame()}nextFrameIfNecessary(){let e=this._shouldAdvance();if(e==ii.ShouldAdvance.NO)return null;let t=Me.milliseconds(),n=this._advanceFrame();if(e==ii.ShouldAdvance.UNTIL_CAUGHT_UP)for(;this._shouldAdvance()!=ii.ShouldAdvance.NO;){if(Me.milliseconds()-t>=16){this._desiredFrameStartTimeMs=Me.milliseconds()+this.frameInfo(this._currentFrame).delay*10-this._startedPlayingMs;break}n=this._advanceFrame()}return n}nextFrameForTesting(){return this._currentFrame=this._currentFrame+1,this._currentFrame>=this._frameCount&&(this._currentLoop=this._currentLoop+1,this._currentFrame=gt.int_remainder(this._currentFrame,this._frameCount)),this._blitFrame()}restart(){this._startedPlayingMs=-1,this._desiredFrameStartTimeMs=0,this._currentFrame=-1,this._currentLoop=0}toString(){let e=o=>"["+o.map(i=>`${i}`).join(", ")+"]",t=this._loopCount==0?"infinite":`${this._loopCount}`,n=this._frameInfos.map(o=>o.disposal);return ne.List_removeDuplicates(n),`GIF
 size: ${this._width} x ${this._height}
 loopCount: ${t}
 frameCount: ${this._frameCount}
 disposals: ${e(n)}`}_forEachRowIndexPairInSubrect(e,t){for(let n=e.y,o=e.y+e.height;n<o;n=n+1){let i=this.width()*4*n;t(i+e.x*4,i+(e.x+e.width)*4)}}_clearLastFrameToBackground(){let e=this._currentFrame>0?this._frameInfos[this._currentFrame-1]:null;e==null||e.width==this.width()&&e.height==this.height()?this._currentFramePx.fill(0):this._forEachRowIndexPairInSubrect(e,(t,n)=>{this._currentFramePx.subarray(t,n).fill(0)})}_blitFrame(){let e=this._frameInfos[this._currentFrame];if(this._currentFrame==0)this._clearLastFrameToBackground();else switch(this._prevDisposal){case 0:case 1:break;case 2:{this._clearLastFrameToBackground();break}case 3:{let h=this._currentFrame>0?this._currentFrame-1:this._frameCount-1,S=this._frameInfos[h],m=this._previousFrameCache.getLastNonDisposedFrame();S==null||m==null?this._clearLastFrameToBackground():S.width==this.width()&&S.height==this.height()?this._currentFramePx.set(m):this._forEachRowIndexPairInSubrect(S,(f,T)=>{let y=this._currentFramePx.subarray(f,T),E=m.subarray(f,T);y.set(E)});break}default:{console.error(`Disposal flag ${this._prevDisposal} not recognized`);break}}let t=e.width*e.height,n=new Uint8Array(t);this._LZWOutputIndexStream(this._buf,e.dataOffset,n,t);let o=e.paletteOffset,i=e.transparentIndex,a=e.width,s=this.width()-a,l=a,d=(e.y*this.width()+e.x)*4,c=((e.y+e.height)*this.width()-(this.width()-e.width-e.x))*4,p=d,u=s*4;e.interlaced&&(u=u+this.width()*4*7);let _=8;for(let h=0,S=n.length;h<S;h=h+1){let m=n[h];if(l==0&&(p=p+u,l=a,p>=c&&(u=s*4+this.width()*4*(_-1),p=d+(a+s)*(_<<1),_>>=1)),m==i)p=p+4;else{let f=this._buf[o+m*3],T=this._buf[o+m*3+1],y=this._buf[o+m*3+2];this._currentFramePx[p++]=f,this._currentFramePx[p++]=T,this._currentFramePx[p++]=y,this._currentFramePx[p++]=255}l=l-1}return this._prevDisposal=e.disposal,this._needPreviousFrame&&(this._prevDisposal<2?this._previousFrameCache.save(this._currentFrame,this._currentFramePx):this._currentFrame==0&&this._previousFrameCache.saveEmpty(this._currentFrame)),this._currentFramePx}_LZWOutputIndexStream(e,t,n,o){let i=e[t++],a=1<<i,s=a+1,l=s+1,d=i+1,c=(1<<d)-1,p=0,u=0,_=0,h=e[t++],S=new Int32Array(4096),m=-1;for(;;){for(;p<16&&h!=0;)u|=e[t++]<<p,p=p+8,h==1?h=e[t++]:h=h-1;if(p<d)break;let f=u&c;if(u>>=d,p=p-d,f==a){l=s+1,d=i+1,c=(1<<d)-1,m=-1;continue}else if(f==s)break;let T=f<l?f:m,y=0,E=T;for(;E>a;)E=S[E]>>8,y=y+1;let v=E;if(_+y+(T!=f?1:0)>o){console.warn("Warning, gif stream longer than expected.");return}n[_++]=v,_=_+y;let I=_;for(T!=f&&(n[_++]=v),E=T;(y=y-1)- -1!=0;)E=S[E],n[I=I-1]=E&255,E>>=8;m!=-1&&l<4096&&(S[l++]=m<<8|v,l>=c+1&&d<12&&(d=d+1,c=c<<1|1)),m=f}if(_!=o){console.warn("Warning, gif stream shorter than expected.");return}}decodedSize(){return this._buf.length}static fail(e){throw new Error(e)}};ii.DEBUG_LOG=!1;var gn=ii;(n=>{let r;(s=>(s[s.ONCE=0]="ONCE",s[s.UNTIL_CAUGHT_UP=1]="UNTIL_CAUGHT_UP",s[s.NO=2]="NO"))(r=n.ShouldAdvance||(n.ShouldAdvance={}));class e{constructor(i,a,s,l,d,c,p){this.width=i,this.height=a,this.frameCount=s,this.loopCount=l,this.buf=d,this.frameInfos=c,this.needLastNonDisposed=p}}n.DecodeResult=e;class t{toString(){return`Frame [x=${this.x}, y=${this.y}] [w=${this.width}, h=${this.height}] [delay=${this.delay}] [localPalette=${this.hasLocalPalette}] [interlaced=${this.interlaced}]`}constructor(i,a,s,l,d,c,p,u,_,h,S,m,f){this.x=i,this.y=a,this.width=s,this.height=l,this.hasLocalPalette=d,this.paletteOffset=c,this.paletteSize=p,this.dataOffset=u,this.dataLength=_,this.transparentIndex=h,this.interlaced=S,this.delay=m,this.disposal=f}}n.Frame=t})(gn||(gn={}));function Ny(){let r,e,n={promise:new Promise((o,i)=>{r=o,e=i}),resolve:o=>{n.status="resolved",n.result=o,r(o)},reject:o=>{n.status="rejected",n.error=o,e(o)},status:"pending"};return n}var Fm=class{constructor(){this.onMessage=e=>{if(this.pendingWAFVerification&&e.data==="waf-successful"){if(this.pendingWAFVerification.type==="challenge"){let{deferred:t,iframe:n}=this.pendingWAFVerification;this.pendingWAFVerification=void 0,t.resolve(),n.remove()}window.removeEventListener("message",this.onMessage)}}}waitForWAFValidation(e){if(this.pendingWAFVerification)return this.pendingWAFVerification.deferred.promise;let t=Ny();if(e==="challenge"){let n=document.createElement("iframe");return n.src=`${window.location.origin}/waf-validation`,n.id="waf-iframe",document.body.appendChild(n),window.addEventListener("message",this.onMessage),this.pendingWAFVerification={type:"challenge",deferred:t,iframe:n},t.promise}else if(e==="captcha")throw new Error("Unhandled")}},Py=new Fm;function Fy(r){if(!r.responseURL||!r.responseURL.startsWith(window.location.origin))return null;let e=r.getResponseHeader("x-amzn-waf-action");return e?e==="challenge"?"challenge":"captcha":null}var Hc=class{constructor(e){this.status=e}},wy,Ly,po=class{constructor(e){this.currentUserId=(Ly=(wy=mn().INITIAL_OPTIONS)==null?void 0:wy.user_data)==null?void 0:Ly.id;this._url=e,this._method=null,this._headers=new Map,this._state=0,this._format=0,this._progressCallback=null,this._xhr=new XMLHttpRequest,this._formData=null,this._blob=null}state(){return this._state}get(e={handleWAFChallenge:!0}){return e.handleWAFChallenge?this.sendWithWaf("GET"):this.tryOnce("GET")}put(){return this.sendWithWaf("PUT")}head(){return this.sendWithWaf("HEAD")}setProgressCallback(e){this._progressCallback=e}header(e,t){return this._headers.set(e,t),this}userIdHeader(){return this._headers.set("X-Figma-User-ID",this.currentUserId??""),this}format(e){return this._format=e,this}send1(e,t,n){if(!1)return this.sendWithWaf(e);if(Lc==3){this._blob=t;for(let o of Array.from(n.keys()))this._headers.set(o,n.get(o));return this.sendWithWaf(e)}else throw new Error("unimplemented")}send2(e,t){if(!1)return this.sendWithWaf(e);if(Lc==3)return this._blob=t,this.sendWithWaf(e);throw new Error("unimplemented")}async sendWithWaf(e){var o;let t=await this.tryOnce(e);return!hn&&!Gr()&&t.wafChallenge&&(this._state=0,await((o=Py)==null?void 0:o.waitForWAFValidation(t.wafChallenge)),t=await this.tryOnce(e)),t}async tryOnce(e){if(!1)return new Promise((t,n)=>{if(Dy==null){n(new Hc(0));return}let o=Dy(this._url);if(o==200){let i=new ap;i.url=this._url,i.status=200,t(i)}else n(new Hc(o))});if(Lc==3){this._xhr.open(e,this._url);let t=null,n=null,o=new Promise((i,a)=>{t=i,n=a});o.then(null,i=>{this.cancel()});for(let i of Array.from(this._headers.keys()))this._xhr.setRequestHeader(i,this._headers.get(i));switch(this._format){case 1:{this._xhr.responseType="arraybuffer";break}}return this._xhr.onload=()=>{if(this._state==2)return;let i=new ap;switch(i.url=this._url,i.status=this._xhr.status,i.contentType=this._xhr.getResponseHeader("Content-Type"),i.wafChallenge=Fy(this._xhr),this._format){case 0:{i.text=this._xhr.response;break}case 1:{i.bytes=new Uint8Array(this._xhr.response);break}}t(i)},this._xhr.onprogress=i=>{this._state!=2&&this._progressCallback!=null&&i.lengthComputable&&this._progressCallback(i.loaded/i.total)},this._xhr.onloadend=()=>{n(new Hc(this._xhr.status))},this._formData!=null?this._xhr.send(this._formData):this._xhr.send(this._blob),this._state=1,o}else throw new Error("unimplemented")}cancel(){if(!0)if(Lc==3)this._state==1&&this._xhr.abort(),(this._state==0||this._state==1)&&(this._state=2);else throw new Error("unimplemented")}},ap=class{mimeType(){let e=this.contentType!=null?this.contentType.indexOf(";"):-1;return e!=-1?this.contentType.slice(0,e):this.contentType}wasSuccessful(){return this.status>=200&&this.status<=299}constructor(){this.status=0,this.contentType=null,this.text=null,this.bytes=null,this.url=null,this.wafChallenge=null}};var Dy=null;var Dm;(e=>{function r(t,n){let o=Array.from(t);return Ir(o,Array.from(n)),new Uint8Array(o)}e.concat=r})(Dm||(Dm={}));var xy;(e=>{function r(t,n){if(t.byteLength!=n.byteLength)return!1;for(let o=0,i=t.byteLength;o<i;o=o+1)if(t[o]!=n[o])return!1;return!0}e.Uint8Array_equals=r})(xy||(xy={}));var sp;(e=>{function r(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}e.DataView_new1=r})(sp||(sp={}));var lp;(p=>{function r(u,_){if(_.value+1>u.length)return null;let h=new ce(u[_.value]);return _.value=_.value+1,h}p._read8=r;function e(u,_,h){if(_.value+2>u.length)return null;let S=u[_.value],m=u[_.value+1];return _.value=_.value+2,new ce(h==1?S|m<<8:m|S<<8)}p._read16=e;function t(u,_,h){if(_.value+2>u.length)return null;let S=u[_.value],m=u[_.value+1],f=u[_.value+2],T=u[_.value+3];return _.value=_.value+4,new ce(h==1?S|m<<8|f<<16|T<<24:T|f<<8|m<<16|S<<24)}p._read32=t;function n(u){let _=[255,216,255];if(u.length<_.length)return null;for(let S=0,m=_.length;S<m;S=S+1)if(_[S]!=u[S])return null;let h=new ce(2);for(;h.value+4<=u.length;){let S=e(u,h,0);if(S==null||S.value>>8!=255)return null;let m=e(u,h,0);if(m==null||m.value<2)return null;if(h.value=h.value-2,S.value==65505){let f=o(u,h.value);if(f!=null)return f}h.value=h.value+m.value}return null}p.readFromJPEG=n;function o(u,_){let h=new ce(_),S=e(u,h,0);if(S==null||S.value<6)return null;let m=t(u,h,0);if(m==null||m.value!=1165519206)return null;let f=e(u,h,0);if(f==null||f.value!=0)return null;let T=t(u,h,0);if(T==null||T.value!=1229531648&&T.value!=1296891946)return null;let E=T.value==1229531648?1:0,v=t(u,h,E);if(v==null)return null;h.value=h.value+v.value-8;let A=e(u,h,E);if(A==null)return null;let I=A.value,C=-1;for(let g=0;g<I;g=g+1){let R=e(u,h,E);if(R==null)break;let D=R.value,P=e(u,h,E);if(P==null)break;let U=P.value,B=t(u,h,E);if(B==null)break;let M=B.value,F=new ce(h.value);if(h.value=h.value+4,!(D!=p.EXIF_TAG_ORIENTATION||M!=1)){if(U==p.EXIF_FORMAT_BYTE){let w=r(u,F);if(w==null)return null;C=w.value}else if(U==p.EXIF_FORMAT_SHORT){let w=e(u,F,E);if(w==null)return null;C=w.value}else if(U==p.EXIF_FORMAT_LONG||U==p.EXIF_FORMAT_SLONG){let w=t(u,F,E);if(w==null)return null;C=w.value}else continue;switch(C){case 1:return new ce(0);case 6:return new ce(1);case 3:return new ce(2);case 8:return new ce(3);case 2:return new ce(4);case 5:return new ce(5);case 4:return new ce(6);case 7:return new ce(7)}}}return null}p._decodeExifOrientation=o;let i;(h=>(h[h.BIG=0]="BIG",h[h.LITTLE=1]="LITTLE"))(i=p.Endianness||(p.Endianness={})),p.EXIF_TAG_ORIENTATION=274,p.EXIF_FORMAT_BYTE=1,p.EXIF_FORMAT_SHORT=3,p.EXIF_FORMAT_LONG=4,p.EXIF_FORMAT_SLONG=9})(lp||(lp={}));var zc;(t=>{function r(n){switch(n){case 0:case 4:return 0;case 1:case 5:return 90;case 2:case 6:return 180;case 3:case 7:return 270;default:return 0}}t.ImageOrientation_rotationDegrees=r;function e(n){return n==4||n==5||n==6||n==7}t.ImageOrientation_shouldFlip=e})(zc||(zc={}));var Wc;(P=>{function r(U){return U<0?0:U>255?255:U}P._clip=r;function e(U){return r(U+64>>7)}P._CF=e;function t(U,B){let M=0,F=U[B+4]<<11,w=U[B+6],V=U[B+2],k=U[B+1],H=U[B+7],z=U[B+5],Q=U[B+3],K=0;if((F|w|V|k|H|z|Q)==0){let j=U[B]<<3;U[B]=j,U[B+1]=j,U[B+2]=j,U[B+3]=j,U[B+4]=j,U[B+5]=j,U[B+6]=j,U[B+7]=j;return}M=(U[B]<<11)+128,K=P._W7*(k+H),k=K+(P._W1-P._W7)*k,H=K-(P._W1+P._W7)*H,K=P._W3*(z+Q),z=K-(P._W3-P._W5)*z,Q=K-(P._W3+P._W5)*Q,K=M+F,M=M-F,F=P._W6*(V+w),w=F-(P._W2+P._W6)*w,V=F+(P._W2-P._W6)*V,F=k+z,k=k-z,z=H+Q,H=H-Q,Q=K+V,K=K-V,V=M+w,M=M-w,w=181*(k+H)+128>>8,k=181*(k-H)+128>>8,U[B]=Q+F>>8,U[B+1]=V+w>>8,U[B+2]=M+k>>8,U[B+3]=K+z>>8,U[B+4]=K-z>>8,U[B+5]=M-k>>8,U[B+6]=V-w>>8,U[B+7]=Q-F>>8}P._rowInverseDCT=t;function n(U,B,M,F,w){let V=0,k=U[B+8*4]<<8,H=U[B+8*6],z=U[B+8*2],Q=U[B+8*1],K=U[B+8*7],j=U[B+8*5],pe=U[B+8*3],Pe=0;if((k|H|z|Q|K|j|pe)==0){let at=r((U[B]+32>>6)+128);for(let Ke=8;Ke!=0;Ke=Ke-1)M[F]=at,F=F+w;return}V=(U[B]<<8)+8192,Pe=P._W7*(Q+K)+4,Q=Pe+(P._W1-P._W7)*Q>>3,K=Pe-(P._W1+P._W7)*K>>3,Pe=P._W3*(j+pe)+4,j=Pe-(P._W3-P._W5)*j>>3,pe=Pe-(P._W3+P._W5)*pe>>3,Pe=V+k,V=V-k,k=P._W6*(z+H)+4,H=k-(P._W2+P._W6)*H>>3,z=k+(P._W2-P._W6)*z>>3,k=Q+j,Q=Q-j,j=K+pe,K=K-pe,pe=Pe+z,Pe=Pe-z,z=V+H,V=V-H,H=181*(Q+K)+128>>8,Q=181*(Q-K)+128>>8,M[F]=r((pe+k>>14)+128),F=F+w,M[F]=r((z+H>>14)+128),F=F+w,M[F]=r((V+Q>>14)+128),F=F+w,M[F]=r((Pe+j>>14)+128),F=F+w,M[F]=r((Pe-j>>14)+128),F=F+w,M[F]=r((V-Q>>14)+128),F=F+w,M[F]=r((z-H>>14)+128),F=F+w,M[F]=r((pe-k>>14)+128)}P._colInverseDCT=n;let o;(V=>(V[V.OK=0]="OK",V[V.NO_JPEG=1]="NO_JPEG",V[V.UNSUPPORTED=2]="UNSUPPORTED",V[V.SYNTAX_ERROR=3]="SYNTAX_ERROR",V[V.FINISHED=4]="FINISHED"))(o=P.Result||(P.Result={}));class i{upsampleH(){let B=this.width-3,M=0,F=0,w=new Uint8Array(this.width*this.height*2);for(let V=this.height;V!=0;V=V-1){w[F]=e(P._CF2A*this.pixels[M]+P._CF2B*this.pixels[M+1]),w[F+1]=e(P._CF3X*this.pixels[M]+P._CF3Y*this.pixels[M+1]+P._CF3Z*this.pixels[M+2]),w[F+2]=e(P._CF3A*this.pixels[M]+P._CF3B*this.pixels[M+1]+P._CF3C*this.pixels[M+2]);for(let k=0;k<B;k=k+1)w[F+k*2+3]=e(P._CF4A*this.pixels[M+k]+P._CF4B*this.pixels[M+k+1]+P._CF4C*this.pixels[M+k+2]+P._CF4D*this.pixels[M+k+3]),w[F+k*2+4]=e(P._CF4D*this.pixels[M+k]+P._CF4C*this.pixels[M+k+1]+P._CF4B*this.pixels[M+k+2]+P._CF4A*this.pixels[M+k+3]);M=M+this.stride,F=F+this.width*2,w[F+-3]=e(P._CF3A*this.pixels[M-1]+P._CF3B*this.pixels[M-2]+P._CF3C*this.pixels[M-3]),w[F+-2]=e(P._CF3X*this.pixels[M-1]+P._CF3Y*this.pixels[M-2]+P._CF3Z*this.pixels[M-3]),w[F+-1]=e(P._CF2A*this.pixels[M-1]+P._CF2B*this.pixels[M-2])}this.width<<=1,this.stride=this.width,this.pixels=w}upsampleV(){let B=this.width,M=this.stride,F=M+M,w=new Uint8Array(this.width*this.height*2);for(let V=0;V<B;V=V+1){let k=V,H=V;w[H]=e(P._CF2A*this.pixels[k]+P._CF2B*this.pixels[k+M]),H=H+B,w[H]=e(P._CF3X*this.pixels[k]+P._CF3Y*this.pixels[k+M]+P._CF3Z*this.pixels[k+F]),H=H+B,w[H]=e(P._CF3A*this.pixels[k]+P._CF3B*this.pixels[k+M]+P._CF3C*this.pixels[k+F]),H=H+B,k=k+M;for(let z=this.height-3;z!=0;z=z-1)w[H]=e(P._CF4A*this.pixels[k+-M]+P._CF4B*this.pixels[k]+P._CF4C*this.pixels[k+M]+P._CF4D*this.pixels[k+F]),H=H+B,w[H]=e(P._CF4D*this.pixels[k+-M]+P._CF4C*this.pixels[k]+P._CF4B*this.pixels[k+M]+P._CF4A*this.pixels[k+F]),H=H+B,k=k+M;k=k+M,w[H]=e(P._CF3A*this.pixels[k]+P._CF3B*this.pixels[k-M]+P._CF3C*this.pixels[k-F]),H=H+B,w[H]=e(P._CF3X*this.pixels[k]+P._CF3Y*this.pixels[k-M]+P._CF3Z*this.pixels[k-F]),H=H+B,w[H]=e(P._CF2A*this.pixels[k]+P._CF2B*this.pixels[k-M])}this.height<<=1,this.stride=this.width,this.pixels=w}constructor(){this.id=0,this.ssx=0,this.ssy=0,this.width=0,this.height=0,this.stride=0,this.quantizationTableIndex=0,this.acTableIndex=0,this.dcTableIndex=0,this.dcPred=0,this.pixels=null}}P.Component=i;class a{constructor(){}}P.Stop=a;let s;(Q=>(Q[Q.NONE=0]="NONE",Q[Q.ROTATE_0=1]="ROTATE_0",Q[Q.FLIP_ROTATE_0=2]="FLIP_ROTATE_0",Q[Q.ROTATE_180=3]="ROTATE_180",Q[Q.FLIP_ROTATE_180=4]="FLIP_ROTATE_180",Q[Q.FLIP_ROTATE_90=5]="FLIP_ROTATE_90",Q[Q.ROTATE_90=6]="ROTATE_90",Q[Q.FLIP_ROTATE_270=7]="FLIP_ROTATE_270",Q[Q.ROTATE_270=8]="ROTATE_270"))(s=P.Orientation||(P.Orientation={}));class l{constructor(){this._bitBuffer=0,this._bitCount=0,this._block=new Int32Array(64),this._bytes=null,this._componentCount=0,this._components=[],this._error=0,this._exifOrientation=1,this._height=0,this._heightInMacroBlocks=0,this._huffmanTable=[],this._length=0,this._macroBlockSizeX=0,this._macroBlockSizeY=0,this._offset=0,this._quantizationTable=[],this._restartInterval=0,this._rgb=null,this._size=0,this._width=0,this._widthInMacroBlocks=0,this._getVLC_code=0;for(let B=0;B<4;B=B+1)this._quantizationTable.push(new Uint8Array(64)),this._huffmanTable.push(new Uint16Array(65536)),this._components.push(new i)}_throw(B){throw this._error=B,new a}_showBits(B){if(B==0)return 0;for(;this._bitCount<B;){if(this._size<=0){this._bitBuffer=this._bitBuffer<<8|255,this._bitCount=this._bitCount+8;continue}let M=this._bytes[this._offset];if(this._offset=this._offset+1,this._size=this._size-1,this._bitCount=this._bitCount+8,this._bitBuffer=this._bitBuffer<<8|M,M==255){this._size==0&&this._throw(3);let F=this._bytes[this._offset];this._offset=this._offset+1,this._size=this._size-1,F==217?this._size=0:F!=0&&F!=255&&((F&248)!=208&&this._throw(3),this._bitBuffer=this._bitBuffer<<8|F,this._bitCount=this._bitCount+8)}}return this._bitBuffer>>this._bitCount-B&(1<<B)-1}_skipBits(B){this._bitCount<B&&this._showBits(B),this._bitCount=this._bitCount-B}_getBits(B){let M=this._showBits(B);return this._skipBits(B),M}_byteAlign(){this._bitCount&=248}_skip(B){this._offset=this._offset+B,this._size=this._size-B,this._length=this._length-B,this._size<0&&this._throw(3)}_decodeBig16(B){return this._bytes[B]<<8|this._bytes[B+1]}_decodeBig32(B){return this._bytes[B]<<24|this._bytes[B+1]<<16|this._bytes[B+2]<<8|this._bytes[B+3]}_decode16(B,M){return M==l.Endianness.LITTLE?this._bytes[B]|this._bytes[B+1]<<8:this._decodeBig16(B)}_decode32(B,M){return M==l.Endianness.LITTLE?this._bytes[B]|this._bytes[B+1]<<8|this._bytes[B+2]<<16|this._bytes[B+3]<<24:this._decodeBig32(B)}_decodeLength(){this._size<2&&this._throw(3),this._length=this._decodeBig16(this._offset),this._length>this._size&&this._throw(3),this._skip(2)}_skipMarker(){this._decodeLength(),this._skip(this._length)}_decodeSOF(){let B=0,M=0,F=null;this._decodeLength(),this._length<9&&this._throw(3),this._bytes[this._offset]!=8&&this._throw(2),this._height=this._decodeBig16(this._offset+1),this._width=this._decodeBig16(this._offset+3),this._componentCount=this._bytes[this._offset+5],this._skip(6),this._componentCount!=1&&this._componentCount!=3&&this._throw(2),this._length<this._componentCount*3&&this._throw(3);for(let w=0;w<this._componentCount;w=w+1)F=this._components[w],F.id=this._bytes[this._offset],F.ssx=this._bytes[this._offset+1]>>4,F.ssy=this._bytes[this._offset+1]&15,F.quantizationTableIndex=this._bytes[this._offset+2],(F.ssx==0||F.ssy==0||(F.quantizationTableIndex&252)!=0)&&this._throw(3),((F.ssx&F.ssx-1)!=0||(F.ssy&F.ssy-1)!=0)&&this._throw(2),this._skip(3),F.ssx>B&&(B=F.ssx),F.ssy>M&&(M=F.ssy);this._componentCount==1&&(F=this._components[0],F.ssx=F.ssy=B=M=1),this._macroBlockSizeX=B<<3,this._macroBlockSizeY=M<<3,this._widthInMacroBlocks=(this._width+this._macroBlockSizeX-1)/this._macroBlockSizeX|0,this._heightInMacroBlocks=(this._height+this._macroBlockSizeY-1)/this._macroBlockSizeY|0;for(let w=0;w<this._componentCount;w=w+1)F=this._components[w],F.width=(this._width*F.ssx+B-1)/B|0,F.height=(this._height*F.ssy+M-1)/M|0,F.stride=this._widthInMacroBlocks*this._macroBlockSizeX*F.ssx/B|0,(F.width<3&&F.ssx!=B||F.height<3&&F.ssy!=M)&&this._throw(2),F.pixels=new Uint8Array(F.stride*(this._heightInMacroBlocks*this._macroBlockSizeY*F.ssy/M|0));this._rgb=new Uint8Array(this._width*this._height*3),this._skip(this._length)}_decodeDHT(){for(this._decodeLength();this._length>=17;){let B=this._bytes[this._offset];(B&236)!=0&&this._throw(3),(B&2)!=0&&this._throw(2),B=(B|B>>3)&3;let M=new Uint8Array(16);for(let H=1;H<=16;H=H+1)M[H-1]=this._bytes[this._offset+H];this._skip(17);let F=this._huffmanTable[B],w=0,V=65536,k=65536;for(let H=1;H<=16;H=H+1){k>>=1;let z=M[H-1];if(z!=0){this._length<z&&this._throw(3),V=V-(z<<16-H),V<0&&this._throw(3);for(let Q=0;Q<z;Q=Q+1){let K=this._bytes[this._offset+Q];for(let j=k;j!=0;j=j-1)w<65536&&(F[w]=H<<8|K,w=w+1)}this._skip(z)}}for(;V!=0;)V=V-1,w<65536&&(F[w]=F[w]&65280,w=w+1)}this._length!=0&&this._throw(3)}_decodeDQT(){for(this._decodeLength();this._length>=65;){let B=this._bytes[this._offset];(B&252)!=0&&this._throw(3);let M=this._quantizationTable[B];for(let F=0;F<64;F=F+1)M[F]=this._bytes[this._offset+F+1];this._skip(65)}this._length!=0&&this._throw(3)}_decodeDRI(){this._decodeLength(),this._length<2&&this._throw(3),this._restartInterval=this._decodeBig16(this._offset),this._skip(this._length)}_getVLC(B){let M=this._showBits(16),F=B[M]>>8;return F==0&&this._throw(3),this._skipBits(F),M=B[M]&255,this._getVLC_code=M,F=M&15,F==0?0:(M=this._getBits(F),M<1<<F-1&&(M=M+((-1<<F)+1)),M)}_decodeBlock(B,M){let F=0;for(this._block=new Int32Array(64),B.dcPred=B.dcPred+this._getVLC(this._huffmanTable[B.dcTableIndex]),this._block[0]=B.dcPred*this._quantizationTable[B.quantizationTableIndex][0];F<63;){let w=this._getVLC(this._huffmanTable[B.acTableIndex]);if(this._getVLC_code==0)break;(this._getVLC_code&15)==0&&this._getVLC_code!=240&&this._throw(3),F=F+((this._getVLC_code>>4)+1),F>63&&this._throw(3),this._block[P._zigZagTable[F]]=w*this._quantizationTable[B.quantizationTableIndex][F]}for(let w=0;w<64;w=w+8)t(this._block,w);for(let w=0;w<8;w=w+1)n(this._block,w,B.pixels,M+w,B.stride)}_decodeScan(){let B=this._restartInterval,M=0;this._decodeLength(),this._length<4+2*this._componentCount&&this._throw(3),this._bytes[this._offset]!=this._componentCount&&this._throw(2),this._skip(1);for(let F=0;F<this._componentCount;F=F+1){let w=this._components[F];this._bytes[this._offset]!=w.id&&this._throw(3),(this._bytes[this._offset+1]&238)!=0&&this._throw(3),w.dcTableIndex=this._bytes[this._offset+1]>>4,w.acTableIndex=this._bytes[this._offset+1]&1|2,this._skip(2)}(this._bytes[this._offset]!=0||this._bytes[this._offset+1]!=63||this._bytes[this._offset+2]!=0)&&this._throw(2),this._skip(this._length);for(let F=0;F<this._heightInMacroBlocks;F=F+1)for(let w=0;w<this._widthInMacroBlocks;w=w+1){if((w!=0||F!=0)&&this._restartInterval!=0&&(B=B-1,B==0)){this._byteAlign();let V=this._getBits(16);((V&65528)!=65488||(V&7)!=M)&&this._throw(3),M=M+1&7,B=this._restartInterval;for(let k=0;k<4;k=k+1)this._components[k].dcPred=0}for(let V=0;V<this._componentCount;V=V+1){let k=this._components[V];for(let H=0;H<k.ssy;H=H+1)for(let z=0;z<k.ssx;z=z+1)this._decodeBlock(k,(F*k.ssy+H)*k.stride+w*k.ssx+z<<3)}}this._error=4}_decodeEXIF(){if(this._decodeLength(),this._length<6||this._decodeBig32(this._offset)!=1165519206||this._decodeBig16(this._offset+4)!=0){this._skip(this._length);return}this._skip(6);let B=this._offset;this._length<8&&this._throw(3);let M=this._decodeBig32(B),F=M==1229531648?l.Endianness.LITTLE:l.Endianness.BIG;F==l.Endianness.BIG&&M!=1296891946&&this._throw(3);let w=274,V=1,k=3,H=4,z=9,Q=B+this._decode32(B+4,F),K=this._decode16(Q,F);Q=Q+2;for(let j=0,pe=K;j<pe;j=j+1){let Pe=this._decode16(Q,F),at=this._decode16(Q+2,F),Ke=this._decode32(Q+4,F);if(Q=Q+8,Pe==w&&Ke==1){this._exifOrientation=0,at==V?this._exifOrientation=this._bytes[Q]:at==k?this._exifOrientation=this._decode16(Q,F):(at==H||at==z)&&(this._exifOrientation=this._decode32(Q,F)),(this._exifOrientation<1||this._exifOrientation>8)&&(this._exifOrientation=1);break}Q=Q+4}this._skip(this._length)}_convert(){for(let F=0;F<this._componentCount;F=F+1){let w=this._components[F];for(;w.width<this._width||w.height<this._height;)w.width<this._width&&w.upsampleH(),w.height<this._height&&w.upsampleV()}let B=this._components[0],M=this._rgb;if(this._componentCount==1){let F=0,w=0;for(let V=this._height;V!=0;V=V-1){for(let k=0;k<this._width;k=k+1){let H=B.pixels[w+k];M[F]=H,M[F+1]=H,M[F+2]=H,F=F+3}w=w+B.stride}}else{let F=this._components[1],w=this._components[2],V=0,k=0,H=0,z=0;for(let Q=this._height;Q!=0;Q=Q-1){for(let K=0;K<this._width;K=K+1){let j=B.pixels[k+K]<<8,pe=F.pixels[H+K]-128,Pe=w.pixels[z+K]-128;M[V]=r(j+359*Pe+128>>8),M[V+1]=r(j-88*pe-183*Pe+128>>8),M[V+2]=r(j+454*pe+128>>8),V=V+3}k=k+B.stride,H=H+F.stride,z=z+w.stride}}}_orient(){if(this._exifOrientation==1)return;let B=this._width,M=this._height,F=this._exifOrientation>=5,w=F?M:B,V=F?B:M,k=this._rgb,H=new Uint8Array(w*V*3);for(let z=0,Q=0;z<M;z=z+1){let K=0,j=0;switch(this._exifOrientation){case 2:{K=z*w+w-1,j=-1;break}case 3:{K=(M-z-1)*w+w-1,j=-1;break}case 4:{K=(M-z-1)*w,j=1;break}case 5:{K=z,j=w;break}case 6:{K=M-z-1,j=w;break}case 7:{K=M-z-1+w*(V-1),j=-w;break}case 8:{K=z+w*(V-1),j=-w;break}}K=K*3,j=j*3;for(let pe=0;pe<B;pe=pe+1,Q=Q+3)H[K]=k[Q],H[K+1]=k[Q+1],H[K+2]=k[Q+2],K=K+j}this._width=w,this._height=V,this._rgb=H}decodeBytes(B){try{for(this._bytes=B,this._offset=0,this._size=B.length,(this._size<2||this._bytes[0]!=255||this._bytes[1]!=216)&&this._throw(1),this._skip(2);this._error==0;){(this._size<2||this._bytes[this._offset]!=255)&&this._throw(3),this._skip(2);let M=this._bytes[this._offset-1];M==192?this._decodeSOF():M==196?this._decodeDHT():M==219?this._decodeDQT():M==221?this._decodeDRI():M==218?this._decodeScan():M==225?this._decodeEXIF():M==254?this._skipMarker():(M&240)==224?this._skipMarker():this._throw(2)}this._error!=4?this._error=3:(this._convert(),this._orient(),this._error=0)}catch{}return this._error}width(){return this._width}height(){return this._height}rgb(){return this._rgb}}P.Decoder=l,(B=>{let U;(w=>(w[w.BIG=0]="BIG",w[w.LITTLE=1]="LITTLE"))(U=B.Endianness||(B.Endianness={}))})(l=P.Decoder||(P.Decoder={})),P._zigZagTable=[0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63],P._W1=2841,P._W2=2676,P._W3=2408,P._W5=1609,P._W6=1108,P._W7=565,P._CF4A=-9,P._CF4B=111,P._CF4C=29,P._CF4D=-3,P._CF3A=28,P._CF3B=109,P._CF3C=-9,P._CF3X=104,P._CF3Y=27,P._CF3Z=-3,P._CF2A=139,P._CF2B=-11})(Wc||(Wc={}));var Go=class{constructor(){this._state=0,this._promise=null,this._resolve=null,this._reject=null,this._promise=new Promise((e,t)=>{this._resolve=e,this._reject=t})}realPromise(){return this._promise}then1(e){this.then2(e,null)}then2(e,t){this._promise.then(e,t)}resolve(e){return this._state==0&&(this._state=1,this._resolve(e)),this}reject(e){return this._state==0&&(this._state=2,this._error=e,this._reject(e)),this}state(){return this._state}},cp=class cp{constructor(){}};cp.VOID=new cp;var bs=cp;function dp(r){Promise.resolve(bs.VOID).then(e=>{r()})}var Ns=class{elapsedSeconds(){return Me.seconds()-this._start}reset(){this._start=Me.seconds()}constructor(){this._start=Me.seconds()}};var Ps=class r{constructor(e){this._worker=null,this._queue=[],this._workerFailedToDownload=!1,this.onmessage=null,this.mainThreadFallback=null;let t=()=>{this._workerFailedToDownload=!0,this.mainThreadFallback!=null&&console.warn(`failed to download worker code from ${e}, falling back to running it on the main thread (this is slower)`);for(let n of this._queue)this.postMessage2(n.message,n.transfer)};new po(e).get({handleWAFChallenge:!1}).then(n=>{if(n.wasSuccessful()){try{this._worker=new Worker(URL.createObjectURL(new Blob([n.text])))}catch{t();return}this._worker.onmessage=o=>{this.onmessage!=null&&this.onmessage(o)};for(let o of this._queue)this.postMessage2(o.message,o.transfer)}else t()},n=>{t()})}postMessage1(e){this.postMessage2(e,null)}postMessage2(e,t){this._workerFailedToDownload?this.mainThreadFallback!=null&&this.onmessage!=null&&setTimeout(()=>{this.onmessage({data:this.mainThreadFallback(e)})},0):this._worker==null?this._queue.push(new r.Item(e,t)):t!=null?this._worker.postMessage(e,t):this._worker.postMessage(e)}};(e=>{class r{constructor(n,o){this.message=n,this.transfer=o}}e.Item=r})(Ps||(Ps={}));function Ol(r){let e=r.length;for(;--e>=0;)r[e]=0}var UN=0,TR=1,VN=2,kN=3,HN=258,rf=29,id=256,Jc=id+1+rf,yl=30,nf=19,ER=2*Jc+1,Fs=15,wm=16,zN=7,of=256,IR=16,yR=17,RR=18,Qm=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),fp=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),WN=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),vR=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),KN=512,pa=new Array((Jc+2)*2);Ol(pa);var Xc=new Array(yl*2);Ol(Xc);var jc=new Array(KN);Ol(jc);var $c=new Array(HN-kN+1);Ol($c);var af=new Array(rf);Ol(af);var gp=new Array(yl);Ol(gp);function Lm(r,e,t,n,o){this.static_tree=r,this.extra_bits=e,this.extra_base=t,this.elems=n,this.max_length=o,this.has_stree=r&&r.length}var OR,CR,bR;function xm(r,e){this.dyn_tree=r,this.max_code=0,this.stat_desc=e}var NR=r=>r<256?jc[r]:jc[256+(r>>>7)],ed=(r,e)=>{r.pending_buf[r.pending++]=e&255,r.pending_buf[r.pending++]=e>>>8&255},_o=(r,e,t)=>{r.bi_valid>wm-t?(r.bi_buf|=e<<r.bi_valid&65535,ed(r,r.bi_buf),r.bi_buf=e>>wm-r.bi_valid,r.bi_valid+=t-wm):(r.bi_buf|=e<<r.bi_valid&65535,r.bi_valid+=t)},Ui=(r,e,t)=>{_o(r,t[e*2],t[e*2+1])},PR=(r,e)=>{let t=0;do t|=r&1,r>>>=1,t<<=1;while(--e>0);return t>>>1},YN=r=>{r.bi_valid===16?(ed(r,r.bi_buf),r.bi_buf=0,r.bi_valid=0):r.bi_valid>=8&&(r.pending_buf[r.pending++]=r.bi_buf&255,r.bi_buf>>=8,r.bi_valid-=8)},QN=(r,e)=>{let t=e.dyn_tree,n=e.max_code,o=e.stat_desc.static_tree,i=e.stat_desc.has_stree,a=e.stat_desc.extra_bits,s=e.stat_desc.extra_base,l=e.stat_desc.max_length,d,c,p,u,_,h,S=0;for(u=0;u<=Fs;u++)r.bl_count[u]=0;for(t[r.heap[r.heap_max]*2+1]=0,d=r.heap_max+1;d<ER;d++)c=r.heap[d],u=t[t[c*2+1]*2+1]+1,u>l&&(u=l,S++),t[c*2+1]=u,!(c>n)&&(r.bl_count[u]++,_=0,c>=s&&(_=a[c-s]),h=t[c*2],r.opt_len+=h*(u+_),i&&(r.static_len+=h*(o[c*2+1]+_)));if(S!==0){do{for(u=l-1;r.bl_count[u]===0;)u--;r.bl_count[u]--,r.bl_count[u+1]+=2,r.bl_count[l]--,S-=2}while(S>0);for(u=l;u!==0;u--)for(c=r.bl_count[u];c!==0;)p=r.heap[--d],!(p>n)&&(t[p*2+1]!==u&&(r.opt_len+=(u-t[p*2+1])*t[p*2],t[p*2+1]=u),c--)}},FR=(r,e,t)=>{let n=new Array(Fs+1),o=0,i,a;for(i=1;i<=Fs;i++)o=o+t[i-1]<<1,n[i]=o;for(a=0;a<=e;a++){let s=r[a*2+1];s!==0&&(r[a*2]=PR(n[s]++,s))}},XN=()=>{let r,e,t,n,o,i=new Array(Fs+1);for(t=0,n=0;n<rf-1;n++)for(af[n]=t,r=0;r<1<<Qm[n];r++)$c[t++]=n;for($c[t-1]=n,o=0,n=0;n<16;n++)for(gp[n]=o,r=0;r<1<<fp[n];r++)jc[o++]=n;for(o>>=7;n<yl;n++)for(gp[n]=o<<7,r=0;r<1<<fp[n]-7;r++)jc[256+o++]=n;for(e=0;e<=Fs;e++)i[e]=0;for(r=0;r<=143;)pa[r*2+1]=8,r++,i[8]++;for(;r<=255;)pa[r*2+1]=9,r++,i[9]++;for(;r<=279;)pa[r*2+1]=7,r++,i[7]++;for(;r<=287;)pa[r*2+1]=8,r++,i[8]++;for(FR(pa,Jc+1,i),r=0;r<yl;r++)Xc[r*2+1]=5,Xc[r*2]=PR(r,5);OR=new Lm(pa,Qm,id+1,Jc,Fs),CR=new Lm(Xc,fp,0,yl,Fs),bR=new Lm(new Array(0),WN,0,nf,zN)},DR=r=>{let e;for(e=0;e<Jc;e++)r.dyn_ltree[e*2]=0;for(e=0;e<yl;e++)r.dyn_dtree[e*2]=0;for(e=0;e<nf;e++)r.bl_tree[e*2]=0;r.dyn_ltree[of*2]=1,r.opt_len=r.static_len=0,r.sym_next=r.matches=0},wR=r=>{r.bi_valid>8?ed(r,r.bi_buf):r.bi_valid>0&&(r.pending_buf[r.pending++]=r.bi_buf),r.bi_buf=0,r.bi_valid=0},By=(r,e,t,n)=>{let o=e*2,i=t*2;return r[o]<r[i]||r[o]===r[i]&&n[e]<=n[t]},Bm=(r,e,t)=>{let n=r.heap[t],o=t<<1;for(;o<=r.heap_len&&(o<r.heap_len&&By(e,r.heap[o+1],r.heap[o],r.depth)&&o++,!By(e,n,r.heap[o],r.depth));)r.heap[t]=r.heap[o],t=o,o<<=1;r.heap[t]=n},My=(r,e,t)=>{let n,o,i=0,a,s;if(r.sym_next!==0)do n=r.pending_buf[r.sym_buf+i++]&255,n+=(r.pending_buf[r.sym_buf+i++]&255)<<8,o=r.pending_buf[r.sym_buf+i++],n===0?Ui(r,o,e):(a=$c[o],Ui(r,a+id+1,e),s=Qm[a],s!==0&&(o-=af[a],_o(r,o,s)),n--,a=NR(n),Ui(r,a,t),s=fp[a],s!==0&&(n-=gp[a],_o(r,n,s)));while(i<r.sym_next);Ui(r,of,e)},Xm=(r,e)=>{let t=e.dyn_tree,n=e.stat_desc.static_tree,o=e.stat_desc.has_stree,i=e.stat_desc.elems,a,s,l=-1,d;for(r.heap_len=0,r.heap_max=ER,a=0;a<i;a++)t[a*2]!==0?(r.heap[++r.heap_len]=l=a,r.depth[a]=0):t[a*2+1]=0;for(;r.heap_len<2;)d=r.heap[++r.heap_len]=l<2?++l:0,t[d*2]=1,r.depth[d]=0,r.opt_len--,o&&(r.static_len-=n[d*2+1]);for(e.max_code=l,a=r.heap_len>>1;a>=1;a--)Bm(r,t,a);d=i;do a=r.heap[1],r.heap[1]=r.heap[r.heap_len--],Bm(r,t,1),s=r.heap[1],r.heap[--r.heap_max]=a,r.heap[--r.heap_max]=s,t[d*2]=t[a*2]+t[s*2],r.depth[d]=(r.depth[a]>=r.depth[s]?r.depth[a]:r.depth[s])+1,t[a*2+1]=t[s*2+1]=d,r.heap[1]=d++,Bm(r,t,1);while(r.heap_len>=2);r.heap[--r.heap_max]=r.heap[1],QN(r,e),FR(t,l,r.bl_count)},Gy=(r,e,t)=>{let n,o=-1,i,a=e[0*2+1],s=0,l=7,d=4;for(a===0&&(l=138,d=3),e[(t+1)*2+1]=65535,n=0;n<=t;n++)i=a,a=e[(n+1)*2+1],!(++s<l&&i===a)&&(s<d?r.bl_tree[i*2]+=s:i!==0?(i!==o&&r.bl_tree[i*2]++,r.bl_tree[IR*2]++):s<=10?r.bl_tree[yR*2]++:r.bl_tree[RR*2]++,s=0,o=i,a===0?(l=138,d=3):i===a?(l=6,d=3):(l=7,d=4))},Uy=(r,e,t)=>{let n,o=-1,i,a=e[0*2+1],s=0,l=7,d=4;for(a===0&&(l=138,d=3),n=0;n<=t;n++)if(i=a,a=e[(n+1)*2+1],!(++s<l&&i===a)){if(s<d)do Ui(r,i,r.bl_tree);while(--s!==0);else i!==0?(i!==o&&(Ui(r,i,r.bl_tree),s--),Ui(r,IR,r.bl_tree),_o(r,s-3,2)):s<=10?(Ui(r,yR,r.bl_tree),_o(r,s-3,3)):(Ui(r,RR,r.bl_tree),_o(r,s-11,7));s=0,o=i,a===0?(l=138,d=3):i===a?(l=6,d=3):(l=7,d=4)}},qN=r=>{let e;for(Gy(r,r.dyn_ltree,r.l_desc.max_code),Gy(r,r.dyn_dtree,r.d_desc.max_code),Xm(r,r.bl_desc),e=nf-1;e>=3&&r.bl_tree[vR[e]*2+1]===0;e--);return r.opt_len+=3*(e+1)+5+5+4,e},ZN=(r,e,t,n)=>{let o;for(_o(r,e-257,5),_o(r,t-1,5),_o(r,n-4,4),o=0;o<n;o++)_o(r,r.bl_tree[vR[o]*2+1],3);Uy(r,r.dyn_ltree,e-1),Uy(r,r.dyn_dtree,t-1)},JN=r=>{let e=4093624447,t;for(t=0;t<=31;t++,e>>>=1)if(e&1&&r.dyn_ltree[t*2]!==0)return 0;if(r.dyn_ltree[9*2]!==0||r.dyn_ltree[10*2]!==0||r.dyn_ltree[13*2]!==0)return 1;for(t=32;t<id;t++)if(r.dyn_ltree[t*2]!==0)return 1;return 0},Vy=!1,jN=r=>{Vy||(XN(),Vy=!0),r.l_desc=new xm(r.dyn_ltree,OR),r.d_desc=new xm(r.dyn_dtree,CR),r.bl_desc=new xm(r.bl_tree,bR),r.bi_buf=0,r.bi_valid=0,DR(r)},LR=(r,e,t,n)=>{_o(r,(UN<<1)+(n?1:0),3),wR(r),ed(r,t),ed(r,~t),t&&r.pending_buf.set(r.window.subarray(e,e+t),r.pending),r.pending+=t},$N=r=>{_o(r,TR<<1,3),Ui(r,of,pa),YN(r)},e1=(r,e,t,n)=>{let o,i,a=0;r.level>0?(r.strm.data_type===2&&(r.strm.data_type=JN(r)),Xm(r,r.l_desc),Xm(r,r.d_desc),a=qN(r),o=r.opt_len+3+7>>>3,i=r.static_len+3+7>>>3,i<=o&&(o=i)):o=i=t+5,t+4<=o&&e!==-1?LR(r,e,t,n):r.strategy===4||i===o?(_o(r,(TR<<1)+(n?1:0),3),My(r,pa,Xc)):(_o(r,(VN<<1)+(n?1:0),3),ZN(r,r.l_desc.max_code+1,r.d_desc.max_code+1,a+1),My(r,r.dyn_ltree,r.dyn_dtree)),DR(r),n&&wR(r)},t1=(r,e,t)=>(r.pending_buf[r.sym_buf+r.sym_next++]=e,r.pending_buf[r.sym_buf+r.sym_next++]=e>>8,r.pending_buf[r.sym_buf+r.sym_next++]=t,e===0?r.dyn_ltree[t*2]++:(r.matches++,e--,r.dyn_ltree[($c[t]+id+1)*2]++,r.dyn_dtree[NR(e)*2]++),r.sym_next===r.sym_end),r1=jN,n1=LR,o1=e1,i1=t1,a1=$N,s1={_tr_init:r1,_tr_stored_block:n1,_tr_flush_block:o1,_tr_tally:i1,_tr_align:a1},l1=(r,e,t,n)=>{let o=r&65535|0,i=r>>>16&65535|0,a=0;for(;t!==0;){a=t>2e3?2e3:t,t-=a;do o=o+e[n++]|0,i=i+o|0;while(--a);o%=65521,i%=65521}return o|i<<16|0},td=l1,c1=()=>{let r,e=[];for(var t=0;t<256;t++){r=t;for(var n=0;n<8;n++)r=r&1?3988292384^r>>>1:r>>>1;e[t]=r}return e},d1=new Uint32Array(c1()),u1=(r,e,t,n)=>{let o=d1,i=n+t;r^=-1;for(let a=n;a<i;a++)r=r>>>8^o[(r^e[a])&255];return r^-1},An=u1,Ls={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Cl={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},{_tr_init:p1,_tr_stored_block:qm,_tr_flush_block:_1,_tr_tally:Ua,_tr_align:h1}=s1,{Z_NO_FLUSH:Va,Z_PARTIAL_FLUSH:m1,Z_FULL_FLUSH:f1,Z_FINISH:ai,Z_BLOCK:ky,Z_OK:Pn,Z_STREAM_END:Hy,Z_STREAM_ERROR:Vi,Z_DATA_ERROR:g1,Z_BUF_ERROR:Mm,Z_DEFAULT_COMPRESSION:A1,Z_FILTERED:S1,Z_HUFFMAN_ONLY:up,Z_RLE:T1,Z_FIXED:E1,Z_DEFAULT_STRATEGY:I1,Z_UNKNOWN:y1,Z_DEFLATED:Tp}=Cl,R1=9,v1=15,O1=8,C1=29,b1=256,Zm=b1+1+C1,N1=30,P1=19,F1=2*Zm+1,D1=15,Lt=3,Ga=258,ki=Ga+Lt+1,w1=32,Rl=42,sf=57,Jm=69,jm=73,$m=91,ef=103,Ds=113,Yc=666,jn=1,bl=2,xs=3,Nl=4,L1=3,ws=(r,e)=>(r.msg=Ls[e],e),zy=r=>r*2-(r>4?9:0),Ma=r=>{let e=r.length;for(;--e>=0;)r[e]=0},x1=r=>{let e,t,n,o=r.w_size;e=r.hash_size,n=e;do t=r.head[--n],r.head[n]=t>=o?t-o:0;while(--e);e=o,n=e;do t=r.prev[--n],r.prev[n]=t>=o?t-o:0;while(--e)},B1=(r,e,t)=>(e<<r.hash_shift^t)&r.hash_mask,ka=B1,Uo=r=>{let e=r.state,t=e.pending;t>r.avail_out&&(t=r.avail_out),t!==0&&(r.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+t),r.next_out),r.next_out+=t,e.pending_out+=t,r.total_out+=t,r.avail_out-=t,e.pending-=t,e.pending===0&&(e.pending_out=0))},Vo=(r,e)=>{_1(r,r.block_start>=0?r.block_start:-1,r.strstart-r.block_start,e),r.block_start=r.strstart,Uo(r.strm)},Zt=(r,e)=>{r.pending_buf[r.pending++]=e},Kc=(r,e)=>{r.pending_buf[r.pending++]=e>>>8&255,r.pending_buf[r.pending++]=e&255},tf=(r,e,t,n)=>{let o=r.avail_in;return o>n&&(o=n),o===0?0:(r.avail_in-=o,e.set(r.input.subarray(r.next_in,r.next_in+o),t),r.state.wrap===1?r.adler=td(r.adler,e,o,t):r.state.wrap===2&&(r.adler=An(r.adler,e,o,t)),r.next_in+=o,r.total_in+=o,o)},xR=(r,e)=>{let t=r.max_chain_length,n=r.strstart,o,i,a=r.prev_length,s=r.nice_match,l=r.strstart>r.w_size-ki?r.strstart-(r.w_size-ki):0,d=r.window,c=r.w_mask,p=r.prev,u=r.strstart+Ga,_=d[n+a-1],h=d[n+a];r.prev_length>=r.good_match&&(t>>=2),s>r.lookahead&&(s=r.lookahead);do if(o=e,!(d[o+a]!==h||d[o+a-1]!==_||d[o]!==d[n]||d[++o]!==d[n+1])){n+=2,o++;do;while(d[++n]===d[++o]&&d[++n]===d[++o]&&d[++n]===d[++o]&&d[++n]===d[++o]&&d[++n]===d[++o]&&d[++n]===d[++o]&&d[++n]===d[++o]&&d[++n]===d[++o]&&n<u);if(i=Ga-(u-n),n=u-Ga,i>a){if(r.match_start=e,a=i,i>=s)break;_=d[n+a-1],h=d[n+a]}}while((e=p[e&c])>l&&--t!==0);return a<=r.lookahead?a:r.lookahead},vl=r=>{let e=r.w_size,t,n,o;do{if(n=r.window_size-r.lookahead-r.strstart,r.strstart>=e+(e-ki)&&(r.window.set(r.window.subarray(e,e+e-n),0),r.match_start-=e,r.strstart-=e,r.block_start-=e,r.insert>r.strstart&&(r.insert=r.strstart),x1(r),n+=e),r.strm.avail_in===0)break;if(t=tf(r.strm,r.window,r.strstart+r.lookahead,n),r.lookahead+=t,r.lookahead+r.insert>=Lt)for(o=r.strstart-r.insert,r.ins_h=r.window[o],r.ins_h=ka(r,r.ins_h,r.window[o+1]);r.insert&&(r.ins_h=ka(r,r.ins_h,r.window[o+Lt-1]),r.prev[o&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=o,o++,r.insert--,!(r.lookahead+r.insert<Lt)););}while(r.lookahead<ki&&r.strm.avail_in!==0)},BR=(r,e)=>{let t=r.pending_buf_size-5>r.w_size?r.w_size:r.pending_buf_size-5,n,o,i,a=0,s=r.strm.avail_in;do{if(n=65535,i=r.bi_valid+42>>3,r.strm.avail_out<i||(i=r.strm.avail_out-i,o=r.strstart-r.block_start,n>o+r.strm.avail_in&&(n=o+r.strm.avail_in),n>i&&(n=i),n<t&&(n===0&&e!==ai||e===Va||n!==o+r.strm.avail_in)))break;a=e===ai&&n===o+r.strm.avail_in?1:0,qm(r,0,0,a),r.pending_buf[r.pending-4]=n,r.pending_buf[r.pending-3]=n>>8,r.pending_buf[r.pending-2]=~n,r.pending_buf[r.pending-1]=~n>>8,Uo(r.strm),o&&(o>n&&(o=n),r.strm.output.set(r.window.subarray(r.block_start,r.block_start+o),r.strm.next_out),r.strm.next_out+=o,r.strm.avail_out-=o,r.strm.total_out+=o,r.block_start+=o,n-=o),n&&(tf(r.strm,r.strm.output,r.strm.next_out,n),r.strm.next_out+=n,r.strm.avail_out-=n,r.strm.total_out+=n)}while(a===0);return s-=r.strm.avail_in,s&&(s>=r.w_size?(r.matches=2,r.window.set(r.strm.input.subarray(r.strm.next_in-r.w_size,r.strm.next_in),0),r.strstart=r.w_size,r.insert=r.strstart):(r.window_size-r.strstart<=s&&(r.strstart-=r.w_size,r.window.set(r.window.subarray(r.w_size,r.w_size+r.strstart),0),r.matches<2&&r.matches++,r.insert>r.strstart&&(r.insert=r.strstart)),r.window.set(r.strm.input.subarray(r.strm.next_in-s,r.strm.next_in),r.strstart),r.strstart+=s,r.insert+=s>r.w_size-r.insert?r.w_size-r.insert:s),r.block_start=r.strstart),r.high_water<r.strstart&&(r.high_water=r.strstart),a?Nl:e!==Va&&e!==ai&&r.strm.avail_in===0&&r.strstart===r.block_start?bl:(i=r.window_size-r.strstart,r.strm.avail_in>i&&r.block_start>=r.w_size&&(r.block_start-=r.w_size,r.strstart-=r.w_size,r.window.set(r.window.subarray(r.w_size,r.w_size+r.strstart),0),r.matches<2&&r.matches++,i+=r.w_size,r.insert>r.strstart&&(r.insert=r.strstart)),i>r.strm.avail_in&&(i=r.strm.avail_in),i&&(tf(r.strm,r.window,r.strstart,i),r.strstart+=i,r.insert+=i>r.w_size-r.insert?r.w_size-r.insert:i),r.high_water<r.strstart&&(r.high_water=r.strstart),i=r.bi_valid+42>>3,i=r.pending_buf_size-i>65535?65535:r.pending_buf_size-i,t=i>r.w_size?r.w_size:i,o=r.strstart-r.block_start,(o>=t||(o||e===ai)&&e!==Va&&r.strm.avail_in===0&&o<=i)&&(n=o>i?i:o,a=e===ai&&r.strm.avail_in===0&&n===o?1:0,qm(r,r.block_start,n,a),r.block_start+=n,Uo(r.strm)),a?xs:jn)},Gm=(r,e)=>{let t,n;for(;;){if(r.lookahead<ki){if(vl(r),r.lookahead<ki&&e===Va)return jn;if(r.lookahead===0)break}if(t=0,r.lookahead>=Lt&&(r.ins_h=ka(r,r.ins_h,r.window[r.strstart+Lt-1]),t=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart),t!==0&&r.strstart-t<=r.w_size-ki&&(r.match_length=xR(r,t)),r.match_length>=Lt)if(n=Ua(r,r.strstart-r.match_start,r.match_length-Lt),r.lookahead-=r.match_length,r.match_length<=r.max_lazy_match&&r.lookahead>=Lt){r.match_length--;do r.strstart++,r.ins_h=ka(r,r.ins_h,r.window[r.strstart+Lt-1]),t=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart;while(--r.match_length!==0);r.strstart++}else r.strstart+=r.match_length,r.match_length=0,r.ins_h=r.window[r.strstart],r.ins_h=ka(r,r.ins_h,r.window[r.strstart+1]);else n=Ua(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++;if(n&&(Vo(r,!1),r.strm.avail_out===0))return jn}return r.insert=r.strstart<Lt-1?r.strstart:Lt-1,e===ai?(Vo(r,!0),r.strm.avail_out===0?xs:Nl):r.sym_next&&(Vo(r,!1),r.strm.avail_out===0)?jn:bl},El=(r,e)=>{let t,n,o;for(;;){if(r.lookahead<ki){if(vl(r),r.lookahead<ki&&e===Va)return jn;if(r.lookahead===0)break}if(t=0,r.lookahead>=Lt&&(r.ins_h=ka(r,r.ins_h,r.window[r.strstart+Lt-1]),t=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart),r.prev_length=r.match_length,r.prev_match=r.match_start,r.match_length=Lt-1,t!==0&&r.prev_length<r.max_lazy_match&&r.strstart-t<=r.w_size-ki&&(r.match_length=xR(r,t),r.match_length<=5&&(r.strategy===S1||r.match_length===Lt&&r.strstart-r.match_start>4096)&&(r.match_length=Lt-1)),r.prev_length>=Lt&&r.match_length<=r.prev_length){o=r.strstart+r.lookahead-Lt,n=Ua(r,r.strstart-1-r.prev_match,r.prev_length-Lt),r.lookahead-=r.prev_length-1,r.prev_length-=2;do++r.strstart<=o&&(r.ins_h=ka(r,r.ins_h,r.window[r.strstart+Lt-1]),t=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart);while(--r.prev_length!==0);if(r.match_available=0,r.match_length=Lt-1,r.strstart++,n&&(Vo(r,!1),r.strm.avail_out===0))return jn}else if(r.match_available){if(n=Ua(r,0,r.window[r.strstart-1]),n&&Vo(r,!1),r.strstart++,r.lookahead--,r.strm.avail_out===0)return jn}else r.match_available=1,r.strstart++,r.lookahead--}return r.match_available&&(n=Ua(r,0,r.window[r.strstart-1]),r.match_available=0),r.insert=r.strstart<Lt-1?r.strstart:Lt-1,e===ai?(Vo(r,!0),r.strm.avail_out===0?xs:Nl):r.sym_next&&(Vo(r,!1),r.strm.avail_out===0)?jn:bl},M1=(r,e)=>{let t,n,o,i,a=r.window;for(;;){if(r.lookahead<=Ga){if(vl(r),r.lookahead<=Ga&&e===Va)return jn;if(r.lookahead===0)break}if(r.match_length=0,r.lookahead>=Lt&&r.strstart>0&&(o=r.strstart-1,n=a[o],n===a[++o]&&n===a[++o]&&n===a[++o])){i=r.strstart+Ga;do;while(n===a[++o]&&n===a[++o]&&n===a[++o]&&n===a[++o]&&n===a[++o]&&n===a[++o]&&n===a[++o]&&n===a[++o]&&o<i);r.match_length=Ga-(i-o),r.match_length>r.lookahead&&(r.match_length=r.lookahead)}if(r.match_length>=Lt?(t=Ua(r,1,r.match_length-Lt),r.lookahead-=r.match_length,r.strstart+=r.match_length,r.match_length=0):(t=Ua(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++),t&&(Vo(r,!1),r.strm.avail_out===0))return jn}return r.insert=0,e===ai?(Vo(r,!0),r.strm.avail_out===0?xs:Nl):r.sym_next&&(Vo(r,!1),r.strm.avail_out===0)?jn:bl},G1=(r,e)=>{let t;for(;;){if(r.lookahead===0&&(vl(r),r.lookahead===0)){if(e===Va)return jn;break}if(r.match_length=0,t=Ua(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++,t&&(Vo(r,!1),r.strm.avail_out===0))return jn}return r.insert=0,e===ai?(Vo(r,!0),r.strm.avail_out===0?xs:Nl):r.sym_next&&(Vo(r,!1),r.strm.avail_out===0)?jn:bl};function Gi(r,e,t,n,o){this.good_length=r,this.max_lazy=e,this.nice_length=t,this.max_chain=n,this.func=o}var Qc=[new Gi(0,0,0,0,BR),new Gi(4,4,8,4,Gm),new Gi(4,5,16,8,Gm),new Gi(4,6,32,32,Gm),new Gi(4,4,16,16,El),new Gi(8,16,32,32,El),new Gi(8,16,128,128,El),new Gi(8,32,128,256,El),new Gi(32,128,258,1024,El),new Gi(32,258,258,4096,El)],U1=r=>{r.window_size=2*r.w_size,Ma(r.head),r.max_lazy_match=Qc[r.level].max_lazy,r.good_match=Qc[r.level].good_length,r.nice_match=Qc[r.level].nice_length,r.max_chain_length=Qc[r.level].max_chain,r.strstart=0,r.block_start=0,r.lookahead=0,r.insert=0,r.match_length=r.prev_length=Lt-1,r.match_available=0,r.ins_h=0};function V1(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Tp,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(F1*2),this.dyn_dtree=new Uint16Array((2*N1+1)*2),this.bl_tree=new Uint16Array((2*P1+1)*2),Ma(this.dyn_ltree),Ma(this.dyn_dtree),Ma(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(D1+1),this.heap=new Uint16Array(2*Zm+1),Ma(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*Zm+1),Ma(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}var ad=r=>{if(!r)return 1;let e=r.state;return!e||e.strm!==r||e.status!==Rl&&e.status!==sf&&e.status!==Jm&&e.status!==jm&&e.status!==$m&&e.status!==ef&&e.status!==Ds&&e.status!==Yc?1:0},MR=r=>{if(ad(r))return ws(r,Vi);r.total_in=r.total_out=0,r.data_type=y1;let e=r.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap===2?sf:e.wrap?Rl:Ds,r.adler=e.wrap===2?0:1,e.last_flush=-2,p1(e),Pn},GR=r=>{let e=MR(r);return e===Pn&&U1(r.state),e},k1=(r,e)=>ad(r)||r.state.wrap!==2?Vi:(r.state.gzhead=e,Pn),UR=(r,e,t,n,o,i)=>{if(!r)return Vi;let a=1;if(e===A1&&(e=6),n<0?(a=0,n=-n):n>15&&(a=2,n-=16),o<1||o>R1||t!==Tp||n<8||n>15||e<0||e>9||i<0||i>E1||n===8&&a!==1)return ws(r,Vi);n===8&&(n=9);let s=new V1;return r.state=s,s.strm=r,s.status=Rl,s.wrap=a,s.gzhead=null,s.w_bits=n,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=o+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+Lt-1)/Lt),s.window=new Uint8Array(s.w_size*2),s.head=new Uint16Array(s.hash_size),s.prev=new Uint16Array(s.w_size),s.lit_bufsize=1<<o+6,s.pending_buf_size=s.lit_bufsize*4,s.pending_buf=new Uint8Array(s.pending_buf_size),s.sym_buf=s.lit_bufsize,s.sym_end=(s.lit_bufsize-1)*3,s.level=e,s.strategy=i,s.method=t,GR(r)},H1=(r,e)=>UR(r,e,Tp,v1,O1,I1),z1=(r,e)=>{if(ad(r)||e>ky||e<0)return r?ws(r,Vi):Vi;let t=r.state;if(!r.output||r.avail_in!==0&&!r.input||t.status===Yc&&e!==ai)return ws(r,r.avail_out===0?Mm:Vi);let n=t.last_flush;if(t.last_flush=e,t.pending!==0){if(Uo(r),r.avail_out===0)return t.last_flush=-1,Pn}else if(r.avail_in===0&&zy(e)<=zy(n)&&e!==ai)return ws(r,Mm);if(t.status===Yc&&r.avail_in!==0)return ws(r,Mm);if(t.status===Rl&&t.wrap===0&&(t.status=Ds),t.status===Rl){let o=Tp+(t.w_bits-8<<4)<<8,i=-1;if(t.strategy>=up||t.level<2?i=0:t.level<6?i=1:t.level===6?i=2:i=3,o|=i<<6,t.strstart!==0&&(o|=w1),o+=31-o%31,Kc(t,o),t.strstart!==0&&(Kc(t,r.adler>>>16),Kc(t,r.adler&65535)),r.adler=1,t.status=Ds,Uo(r),t.pending!==0)return t.last_flush=-1,Pn}if(t.status===sf){if(r.adler=0,Zt(t,31),Zt(t,139),Zt(t,8),t.gzhead)Zt(t,(t.gzhead.text?1:0)+(t.gzhead.hcrc?2:0)+(t.gzhead.extra?4:0)+(t.gzhead.name?8:0)+(t.gzhead.comment?16:0)),Zt(t,t.gzhead.time&255),Zt(t,t.gzhead.time>>8&255),Zt(t,t.gzhead.time>>16&255),Zt(t,t.gzhead.time>>24&255),Zt(t,t.level===9?2:t.strategy>=up||t.level<2?4:0),Zt(t,t.gzhead.os&255),t.gzhead.extra&&t.gzhead.extra.length&&(Zt(t,t.gzhead.extra.length&255),Zt(t,t.gzhead.extra.length>>8&255)),t.gzhead.hcrc&&(r.adler=An(r.adler,t.pending_buf,t.pending,0)),t.gzindex=0,t.status=Jm;else if(Zt(t,0),Zt(t,0),Zt(t,0),Zt(t,0),Zt(t,0),Zt(t,t.level===9?2:t.strategy>=up||t.level<2?4:0),Zt(t,L1),t.status=Ds,Uo(r),t.pending!==0)return t.last_flush=-1,Pn}if(t.status===Jm){if(t.gzhead.extra){let o=t.pending,i=(t.gzhead.extra.length&65535)-t.gzindex;for(;t.pending+i>t.pending_buf_size;){let s=t.pending_buf_size-t.pending;if(t.pending_buf.set(t.gzhead.extra.subarray(t.gzindex,t.gzindex+s),t.pending),t.pending=t.pending_buf_size,t.gzhead.hcrc&&t.pending>o&&(r.adler=An(r.adler,t.pending_buf,t.pending-o,o)),t.gzindex+=s,Uo(r),t.pending!==0)return t.last_flush=-1,Pn;o=0,i-=s}let a=new Uint8Array(t.gzhead.extra);t.pending_buf.set(a.subarray(t.gzindex,t.gzindex+i),t.pending),t.pending+=i,t.gzhead.hcrc&&t.pending>o&&(r.adler=An(r.adler,t.pending_buf,t.pending-o,o)),t.gzindex=0}t.status=jm}if(t.status===jm){if(t.gzhead.name){let o=t.pending,i;do{if(t.pending===t.pending_buf_size){if(t.gzhead.hcrc&&t.pending>o&&(r.adler=An(r.adler,t.pending_buf,t.pending-o,o)),Uo(r),t.pending!==0)return t.last_flush=-1,Pn;o=0}t.gzindex<t.gzhead.name.length?i=t.gzhead.name.charCodeAt(t.gzindex++)&255:i=0,Zt(t,i)}while(i!==0);t.gzhead.hcrc&&t.pending>o&&(r.adler=An(r.adler,t.pending_buf,t.pending-o,o)),t.gzindex=0}t.status=$m}if(t.status===$m){if(t.gzhead.comment){let o=t.pending,i;do{if(t.pending===t.pending_buf_size){if(t.gzhead.hcrc&&t.pending>o&&(r.adler=An(r.adler,t.pending_buf,t.pending-o,o)),Uo(r),t.pending!==0)return t.last_flush=-1,Pn;o=0}t.gzindex<t.gzhead.comment.length?i=t.gzhead.comment.charCodeAt(t.gzindex++)&255:i=0,Zt(t,i)}while(i!==0);t.gzhead.hcrc&&t.pending>o&&(r.adler=An(r.adler,t.pending_buf,t.pending-o,o))}t.status=ef}if(t.status===ef){if(t.gzhead.hcrc){if(t.pending+2>t.pending_buf_size&&(Uo(r),t.pending!==0))return t.last_flush=-1,Pn;Zt(t,r.adler&255),Zt(t,r.adler>>8&255),r.adler=0}if(t.status=Ds,Uo(r),t.pending!==0)return t.last_flush=-1,Pn}if(r.avail_in!==0||t.lookahead!==0||e!==Va&&t.status!==Yc){let o=t.level===0?BR(t,e):t.strategy===up?G1(t,e):t.strategy===T1?M1(t,e):Qc[t.level].func(t,e);if((o===xs||o===Nl)&&(t.status=Yc),o===jn||o===xs)return r.avail_out===0&&(t.last_flush=-1),Pn;if(o===bl&&(e===m1?h1(t):e!==ky&&(qm(t,0,0,!1),e===f1&&(Ma(t.head),t.lookahead===0&&(t.strstart=0,t.block_start=0,t.insert=0))),Uo(r),r.avail_out===0))return t.last_flush=-1,Pn}return e!==ai?Pn:t.wrap<=0?Hy:(t.wrap===2?(Zt(t,r.adler&255),Zt(t,r.adler>>8&255),Zt(t,r.adler>>16&255),Zt(t,r.adler>>24&255),Zt(t,r.total_in&255),Zt(t,r.total_in>>8&255),Zt(t,r.total_in>>16&255),Zt(t,r.total_in>>24&255)):(Kc(t,r.adler>>>16),Kc(t,r.adler&65535)),Uo(r),t.wrap>0&&(t.wrap=-t.wrap),t.pending!==0?Pn:Hy)},W1=r=>{if(ad(r))return Vi;let e=r.state.status;return r.state=null,e===Ds?ws(r,g1):Pn},K1=(r,e)=>{let t=e.length;if(ad(r))return Vi;let n=r.state,o=n.wrap;if(o===2||o===1&&n.status!==Rl||n.lookahead)return Vi;if(o===1&&(r.adler=td(r.adler,e,t,0)),n.wrap=0,t>=n.w_size){o===0&&(Ma(n.head),n.strstart=0,n.block_start=0,n.insert=0);let l=new Uint8Array(n.w_size);l.set(e.subarray(t-n.w_size,t),0),e=l,t=n.w_size}let i=r.avail_in,a=r.next_in,s=r.input;for(r.avail_in=t,r.next_in=0,r.input=e,vl(n);n.lookahead>=Lt;){let l=n.strstart,d=n.lookahead-(Lt-1);do n.ins_h=ka(n,n.ins_h,n.window[l+Lt-1]),n.prev[l&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=l,l++;while(--d);n.strstart=l,n.lookahead=Lt-1,vl(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=Lt-1,n.match_available=0,r.next_in=a,r.input=s,r.avail_in=i,n.wrap=o,Pn},Y1=H1,Q1=UR,X1=GR,q1=MR,Z1=k1,J1=z1,j1=W1,$1=K1,eP="pako deflate (from Nodeca project)",qc={deflateInit:Y1,deflateInit2:Q1,deflateReset:X1,deflateResetKeep:q1,deflateSetHeader:Z1,deflate:J1,deflateEnd:j1,deflateSetDictionary:$1,deflateInfo:eP},tP=(r,e)=>Object.prototype.hasOwnProperty.call(r,e),rP=function(r){let e=Array.prototype.slice.call(arguments,1);for(;e.length;){let t=e.shift();if(t){if(typeof t!="object")throw new TypeError(t+"must be non-object");for(let n in t)tP(t,n)&&(r[n]=t[n])}}return r},nP=r=>{let e=0;for(let n=0,o=r.length;n<o;n++)e+=r[n].length;let t=new Uint8Array(e);for(let n=0,o=0,i=r.length;n<i;n++){let a=r[n];t.set(a,o),o+=a.length}return t},Ep={assign:rP,flattenChunks:nP},VR=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{VR=!1}var rd=new Uint8Array(256);for(let r=0;r<256;r++)rd[r]=r>=252?6:r>=248?5:r>=240?4:r>=224?3:r>=192?2:1;rd[254]=rd[254]=1;var oP=r=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(r);let e,t,n,o,i,a=r.length,s=0;for(o=0;o<a;o++)t=r.charCodeAt(o),(t&64512)===55296&&o+1<a&&(n=r.charCodeAt(o+1),(n&64512)===56320&&(t=65536+(t-55296<<10)+(n-56320),o++)),s+=t<128?1:t<2048?2:t<65536?3:4;for(e=new Uint8Array(s),i=0,o=0;i<s;o++)t=r.charCodeAt(o),(t&64512)===55296&&o+1<a&&(n=r.charCodeAt(o+1),(n&64512)===56320&&(t=65536+(t-55296<<10)+(n-56320),o++)),t<128?e[i++]=t:t<2048?(e[i++]=192|t>>>6,e[i++]=128|t&63):t<65536?(e[i++]=224|t>>>12,e[i++]=128|t>>>6&63,e[i++]=128|t&63):(e[i++]=240|t>>>18,e[i++]=128|t>>>12&63,e[i++]=128|t>>>6&63,e[i++]=128|t&63);return e},iP=(r,e)=>{if(e<65534&&r.subarray&&VR)return String.fromCharCode.apply(null,r.length===e?r:r.subarray(0,e));let t="";for(let n=0;n<e;n++)t+=String.fromCharCode(r[n]);return t},aP=(r,e)=>{let t=e||r.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(r.subarray(0,e));let n,o,i=new Array(t*2);for(o=0,n=0;n<t;){let a=r[n++];if(a<128){i[o++]=a;continue}let s=rd[a];if(s>4){i[o++]=65533,n+=s-1;continue}for(a&=s===2?31:s===3?15:7;s>1&&n<t;)a=a<<6|r[n++]&63,s--;if(s>1){i[o++]=65533;continue}a<65536?i[o++]=a:(a-=65536,i[o++]=55296|a>>10&1023,i[o++]=56320|a&1023)}return iP(i,o)},sP=(r,e)=>{e=e||r.length,e>r.length&&(e=r.length);let t=e-1;for(;t>=0&&(r[t]&192)===128;)t--;return t<0||t===0?e:t+rd[r[t]]>e?t:e},nd={string2buf:oP,buf2string:aP,utf8border:sP};function lP(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var kR=lP,HR=Object.prototype.toString,{Z_NO_FLUSH:cP,Z_SYNC_FLUSH:dP,Z_FULL_FLUSH:uP,Z_FINISH:pP,Z_OK:Ap,Z_STREAM_END:_P,Z_DEFAULT_COMPRESSION:hP,Z_DEFAULT_STRATEGY:mP,Z_DEFLATED:fP}=Cl;function sd(r){this.options=Ep.assign({level:hP,method:fP,chunkSize:16384,windowBits:15,memLevel:8,strategy:mP},r||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new kR,this.strm.avail_out=0;let t=qc.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(t!==Ap)throw new Error(Ls[t]);if(e.header&&qc.deflateSetHeader(this.strm,e.header),e.dictionary){let n;if(typeof e.dictionary=="string"?n=nd.string2buf(e.dictionary):HR.call(e.dictionary)==="[object ArrayBuffer]"?n=new Uint8Array(e.dictionary):n=e.dictionary,t=qc.deflateSetDictionary(this.strm,n),t!==Ap)throw new Error(Ls[t]);this._dict_set=!0}}sd.prototype.push=function(r,e){let t=this.strm,n=this.options.chunkSize,o,i;if(this.ended)return!1;for(e===~~e?i=e:i=e===!0?pP:cP,typeof r=="string"?t.input=nd.string2buf(r):HR.call(r)==="[object ArrayBuffer]"?t.input=new Uint8Array(r):t.input=r,t.next_in=0,t.avail_in=t.input.length;;){if(t.avail_out===0&&(t.output=new Uint8Array(n),t.next_out=0,t.avail_out=n),(i===dP||i===uP)&&t.avail_out<=6){this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;continue}if(o=qc.deflate(t,i),o===_P)return t.next_out>0&&this.onData(t.output.subarray(0,t.next_out)),o=qc.deflateEnd(this.strm),this.onEnd(o),this.ended=!0,o===Ap;if(t.avail_out===0){this.onData(t.output);continue}if(i>0&&t.next_out>0){this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;continue}if(t.avail_in===0)break}return!0};sd.prototype.onData=function(r){this.chunks.push(r)};sd.prototype.onEnd=function(r){r===Ap&&(this.result=Ep.flattenChunks(this.chunks)),this.chunks=[],this.err=r,this.msg=this.strm.msg};function lf(r,e){let t=new sd(e);if(t.push(r,!0),t.err)throw t.msg||Ls[t.err];return t.result}function gP(r,e){return e=e||{},e.raw=!0,lf(r,e)}function AP(r,e){return e=e||{},e.gzip=!0,lf(r,e)}var SP=sd,TP=lf,EP=gP,IP=AP,yP=Cl,RP={Deflate:SP,deflate:TP,deflateRaw:EP,gzip:IP,constants:yP},pp=16209,vP=16191,OP=function(e,t){let n,o,i,a,s,l,d,c,p,u,_,h,S,m,f,T,y,E,v,A,I,C,g,R,D=e.state;n=e.next_in,g=e.input,o=n+(e.avail_in-5),i=e.next_out,R=e.output,a=i-(t-e.avail_out),s=i+(e.avail_out-257),l=D.dmax,d=D.wsize,c=D.whave,p=D.wnext,u=D.window,_=D.hold,h=D.bits,S=D.lencode,m=D.distcode,f=(1<<D.lenbits)-1,T=(1<<D.distbits)-1;e:do{h<15&&(_+=g[n++]<<h,h+=8,_+=g[n++]<<h,h+=8),y=S[_&f];t:for(;;){if(E=y>>>24,_>>>=E,h-=E,E=y>>>16&255,E===0)R[i++]=y&65535;else if(E&16){v=y&65535,E&=15,E&&(h<E&&(_+=g[n++]<<h,h+=8),v+=_&(1<<E)-1,_>>>=E,h-=E),h<15&&(_+=g[n++]<<h,h+=8,_+=g[n++]<<h,h+=8),y=m[_&T];r:for(;;){if(E=y>>>24,_>>>=E,h-=E,E=y>>>16&255,E&16){if(A=y&65535,E&=15,h<E&&(_+=g[n++]<<h,h+=8,h<E&&(_+=g[n++]<<h,h+=8)),A+=_&(1<<E)-1,A>l){e.msg="invalid distance too far back",D.mode=pp;break e}if(_>>>=E,h-=E,E=i-a,A>E){if(E=A-E,E>c&&D.sane){e.msg="invalid distance too far back",D.mode=pp;break e}if(I=0,C=u,p===0){if(I+=d-E,E<v){v-=E;do R[i++]=u[I++];while(--E);I=i-A,C=R}}else if(p<E){if(I+=d+p-E,E-=p,E<v){v-=E;do R[i++]=u[I++];while(--E);if(I=0,p<v){E=p,v-=E;do R[i++]=u[I++];while(--E);I=i-A,C=R}}}else if(I+=p-E,E<v){v-=E;do R[i++]=u[I++];while(--E);I=i-A,C=R}for(;v>2;)R[i++]=C[I++],R[i++]=C[I++],R[i++]=C[I++],v-=3;v&&(R[i++]=C[I++],v>1&&(R[i++]=C[I++]))}else{I=i-A;do R[i++]=R[I++],R[i++]=R[I++],R[i++]=R[I++],v-=3;while(v>2);v&&(R[i++]=R[I++],v>1&&(R[i++]=R[I++]))}}else if((E&64)===0){y=m[(y&65535)+(_&(1<<E)-1)];continue r}else{e.msg="invalid distance code",D.mode=pp;break e}break}}else if((E&64)===0){y=S[(y&65535)+(_&(1<<E)-1)];continue t}else if(E&32){D.mode=vP;break e}else{e.msg="invalid literal/length code",D.mode=pp;break e}break}}while(n<o&&i<s);v=h>>3,n-=v,h-=v<<3,_&=(1<<h)-1,e.next_in=n,e.next_out=i,e.avail_in=n<o?5+(o-n):5-(n-o),e.avail_out=i<s?257+(s-i):257-(i-s),D.hold=_,D.bits=h},Il=15,Wy=852,Ky=592,Yy=0,Um=1,Qy=2,CP=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),bP=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),NP=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),PP=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),FP=(r,e,t,n,o,i,a,s)=>{let l=s.bits,d=0,c=0,p=0,u=0,_=0,h=0,S=0,m=0,f=0,T=0,y,E,v,A,I,C=null,g,R=new Uint16Array(Il+1),D=new Uint16Array(Il+1),P=null,U,B,M;for(d=0;d<=Il;d++)R[d]=0;for(c=0;c<n;c++)R[e[t+c]]++;for(_=l,u=Il;u>=1&&R[u]===0;u--);if(_>u&&(_=u),u===0)return o[i++]=1<<24|64<<16|0,o[i++]=1<<24|64<<16|0,s.bits=1,0;for(p=1;p<u&&R[p]===0;p++);for(_<p&&(_=p),m=1,d=1;d<=Il;d++)if(m<<=1,m-=R[d],m<0)return-1;if(m>0&&(r===Yy||u!==1))return-1;for(D[1]=0,d=1;d<Il;d++)D[d+1]=D[d]+R[d];for(c=0;c<n;c++)e[t+c]!==0&&(a[D[e[t+c]]++]=c);if(r===Yy?(C=P=a,g=20):r===Um?(C=CP,P=bP,g=257):(C=NP,P=PP,g=0),T=0,c=0,d=p,I=i,h=_,S=0,v=-1,f=1<<_,A=f-1,r===Um&&f>Wy||r===Qy&&f>Ky)return 1;for(;;){U=d-S,a[c]+1<g?(B=0,M=a[c]):a[c]>=g?(B=P[a[c]-g],M=C[a[c]-g]):(B=96,M=0),y=1<<d-S,E=1<<h,p=E;do E-=y,o[I+(T>>S)+E]=U<<24|B<<16|M|0;while(E!==0);for(y=1<<d-1;T&y;)y>>=1;if(y!==0?(T&=y-1,T+=y):T=0,c++,--R[d]===0){if(d===u)break;d=e[t+a[c]]}if(d>_&&(T&A)!==v){for(S===0&&(S=_),I+=p,h=d-S,m=1<<h;h+S<u&&(m-=R[h+S],!(m<=0));)h++,m<<=1;if(f+=1<<h,r===Um&&f>Wy||r===Qy&&f>Ky)return 1;v=T&A,o[v]=_<<24|h<<16|I-i|0}}return T!==0&&(o[I+T]=d-S<<24|64<<16|0),s.bits=_,0},Zc=FP,DP=0,zR=1,WR=2,{Z_FINISH:Xy,Z_BLOCK:wP,Z_TREES:_p,Z_OK:Bs,Z_STREAM_END:LP,Z_NEED_DICT:xP,Z_STREAM_ERROR:si,Z_DATA_ERROR:KR,Z_MEM_ERROR:YR,Z_BUF_ERROR:BP,Z_DEFLATED:qy}=Cl,Ip=16180,Zy=16181,Jy=16182,jy=16183,$y=16184,eR=16185,tR=16186,rR=16187,nR=16188,oR=16189,Sp=16190,ua=16191,Vm=16192,iR=16193,km=16194,aR=16195,sR=16196,lR=16197,cR=16198,hp=16199,mp=16200,dR=16201,uR=16202,pR=16203,_R=16204,hR=16205,Hm=16206,mR=16207,fR=16208,vr=16209,QR=16210,XR=16211,MP=852,GP=592,UP=15,VP=UP,gR=r=>(r>>>24&255)+(r>>>8&65280)+((r&65280)<<8)+((r&255)<<24);function kP(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var Ms=r=>{if(!r)return 1;let e=r.state;return!e||e.strm!==r||e.mode<Ip||e.mode>XR?1:0},qR=r=>{if(Ms(r))return si;let e=r.state;return r.total_in=r.total_out=e.total=0,r.msg="",e.wrap&&(r.adler=e.wrap&1),e.mode=Ip,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(MP),e.distcode=e.distdyn=new Int32Array(GP),e.sane=1,e.back=-1,Bs},ZR=r=>{if(Ms(r))return si;let e=r.state;return e.wsize=0,e.whave=0,e.wnext=0,qR(r)},JR=(r,e)=>{let t;if(Ms(r))return si;let n=r.state;return e<0?(t=0,e=-e):(t=(e>>4)+5,e<48&&(e&=15)),e&&(e<8||e>15)?si:(n.window!==null&&n.wbits!==e&&(n.window=null),n.wrap=t,n.wbits=e,ZR(r))},jR=(r,e)=>{if(!r)return si;let t=new kP;r.state=t,t.strm=r,t.window=null,t.mode=Ip;let n=JR(r,e);return n!==Bs&&(r.state=null),n},HP=r=>jR(r,VP),AR=!0,zm,Wm,zP=r=>{if(AR){zm=new Int32Array(512),Wm=new Int32Array(32);let e=0;for(;e<144;)r.lens[e++]=8;for(;e<256;)r.lens[e++]=9;for(;e<280;)r.lens[e++]=7;for(;e<288;)r.lens[e++]=8;for(Zc(zR,r.lens,0,288,zm,0,r.work,{bits:9}),e=0;e<32;)r.lens[e++]=5;Zc(WR,r.lens,0,32,Wm,0,r.work,{bits:5}),AR=!1}r.lencode=zm,r.lenbits=9,r.distcode=Wm,r.distbits=5},$R=(r,e,t,n)=>{let o,i=r.state;return i.window===null&&(i.wsize=1<<i.wbits,i.wnext=0,i.whave=0,i.window=new Uint8Array(i.wsize)),n>=i.wsize?(i.window.set(e.subarray(t-i.wsize,t),0),i.wnext=0,i.whave=i.wsize):(o=i.wsize-i.wnext,o>n&&(o=n),i.window.set(e.subarray(t-n,t-n+o),i.wnext),n-=o,n?(i.window.set(e.subarray(t-n,t),0),i.wnext=n,i.whave=i.wsize):(i.wnext+=o,i.wnext===i.wsize&&(i.wnext=0),i.whave<i.wsize&&(i.whave+=o))),0},WP=(r,e)=>{let t,n,o,i,a,s,l,d,c,p,u,_,h,S,m=0,f,T,y,E,v,A,I,C,g=new Uint8Array(4),R,D,P=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Ms(r)||!r.output||!r.input&&r.avail_in!==0)return si;t=r.state,t.mode===ua&&(t.mode=Vm),a=r.next_out,o=r.output,l=r.avail_out,i=r.next_in,n=r.input,s=r.avail_in,d=t.hold,c=t.bits,p=s,u=l,C=Bs;e:for(;;)switch(t.mode){case Ip:if(t.wrap===0){t.mode=Vm;break}for(;c<16;){if(s===0)break e;s--,d+=n[i++]<<c,c+=8}if(t.wrap&2&&d===35615){t.wbits===0&&(t.wbits=15),t.check=0,g[0]=d&255,g[1]=d>>>8&255,t.check=An(t.check,g,2,0),d=0,c=0,t.mode=Zy;break}if(t.head&&(t.head.done=!1),!(t.wrap&1)||(((d&255)<<8)+(d>>8))%31){r.msg="incorrect header check",t.mode=vr;break}if((d&15)!==qy){r.msg="unknown compression method",t.mode=vr;break}if(d>>>=4,c-=4,I=(d&15)+8,t.wbits===0&&(t.wbits=I),I>15||I>t.wbits){r.msg="invalid window size",t.mode=vr;break}t.dmax=1<<t.wbits,t.flags=0,r.adler=t.check=1,t.mode=d&512?oR:ua,d=0,c=0;break;case Zy:for(;c<16;){if(s===0)break e;s--,d+=n[i++]<<c,c+=8}if(t.flags=d,(t.flags&255)!==qy){r.msg="unknown compression method",t.mode=vr;break}if(t.flags&57344){r.msg="unknown header flags set",t.mode=vr;break}t.head&&(t.head.text=d>>8&1),t.flags&512&&t.wrap&4&&(g[0]=d&255,g[1]=d>>>8&255,t.check=An(t.check,g,2,0)),d=0,c=0,t.mode=Jy;case Jy:for(;c<32;){if(s===0)break e;s--,d+=n[i++]<<c,c+=8}t.head&&(t.head.time=d),t.flags&512&&t.wrap&4&&(g[0]=d&255,g[1]=d>>>8&255,g[2]=d>>>16&255,g[3]=d>>>24&255,t.check=An(t.check,g,4,0)),d=0,c=0,t.mode=jy;case jy:for(;c<16;){if(s===0)break e;s--,d+=n[i++]<<c,c+=8}t.head&&(t.head.xflags=d&255,t.head.os=d>>8),t.flags&512&&t.wrap&4&&(g[0]=d&255,g[1]=d>>>8&255,t.check=An(t.check,g,2,0)),d=0,c=0,t.mode=$y;case $y:if(t.flags&1024){for(;c<16;){if(s===0)break e;s--,d+=n[i++]<<c,c+=8}t.length=d,t.head&&(t.head.extra_len=d),t.flags&512&&t.wrap&4&&(g[0]=d&255,g[1]=d>>>8&255,t.check=An(t.check,g,2,0)),d=0,c=0}else t.head&&(t.head.extra=null);t.mode=eR;case eR:if(t.flags&1024&&(_=t.length,_>s&&(_=s),_&&(t.head&&(I=t.head.extra_len-t.length,t.head.extra||(t.head.extra=new Uint8Array(t.head.extra_len)),t.head.extra.set(n.subarray(i,i+_),I)),t.flags&512&&t.wrap&4&&(t.check=An(t.check,n,_,i)),s-=_,i+=_,t.length-=_),t.length))break e;t.length=0,t.mode=tR;case tR:if(t.flags&2048){if(s===0)break e;_=0;do I=n[i+_++],t.head&&I&&t.length<65536&&(t.head.name+=String.fromCharCode(I));while(I&&_<s);if(t.flags&512&&t.wrap&4&&(t.check=An(t.check,n,_,i)),s-=_,i+=_,I)break e}else t.head&&(t.head.name=null);t.length=0,t.mode=rR;case rR:if(t.flags&4096){if(s===0)break e;_=0;do I=n[i+_++],t.head&&I&&t.length<65536&&(t.head.comment+=String.fromCharCode(I));while(I&&_<s);if(t.flags&512&&t.wrap&4&&(t.check=An(t.check,n,_,i)),s-=_,i+=_,I)break e}else t.head&&(t.head.comment=null);t.mode=nR;case nR:if(t.flags&512){for(;c<16;){if(s===0)break e;s--,d+=n[i++]<<c,c+=8}if(t.wrap&4&&d!==(t.check&65535)){r.msg="header crc mismatch",t.mode=vr;break}d=0,c=0}t.head&&(t.head.hcrc=t.flags>>9&1,t.head.done=!0),r.adler=t.check=0,t.mode=ua;break;case oR:for(;c<32;){if(s===0)break e;s--,d+=n[i++]<<c,c+=8}r.adler=t.check=gR(d),d=0,c=0,t.mode=Sp;case Sp:if(t.havedict===0)return r.next_out=a,r.avail_out=l,r.next_in=i,r.avail_in=s,t.hold=d,t.bits=c,xP;r.adler=t.check=1,t.mode=ua;case ua:if(e===wP||e===_p)break e;case Vm:if(t.last){d>>>=c&7,c-=c&7,t.mode=Hm;break}for(;c<3;){if(s===0)break e;s--,d+=n[i++]<<c,c+=8}switch(t.last=d&1,d>>>=1,c-=1,d&3){case 0:t.mode=iR;break;case 1:if(zP(t),t.mode=hp,e===_p){d>>>=2,c-=2;break e}break;case 2:t.mode=sR;break;case 3:r.msg="invalid block type",t.mode=vr}d>>>=2,c-=2;break;case iR:for(d>>>=c&7,c-=c&7;c<32;){if(s===0)break e;s--,d+=n[i++]<<c,c+=8}if((d&65535)!==(d>>>16^65535)){r.msg="invalid stored block lengths",t.mode=vr;break}if(t.length=d&65535,d=0,c=0,t.mode=km,e===_p)break e;case km:t.mode=aR;case aR:if(_=t.length,_){if(_>s&&(_=s),_>l&&(_=l),_===0)break e;o.set(n.subarray(i,i+_),a),s-=_,i+=_,l-=_,a+=_,t.length-=_;break}t.mode=ua;break;case sR:for(;c<14;){if(s===0)break e;s--,d+=n[i++]<<c,c+=8}if(t.nlen=(d&31)+257,d>>>=5,c-=5,t.ndist=(d&31)+1,d>>>=5,c-=5,t.ncode=(d&15)+4,d>>>=4,c-=4,t.nlen>286||t.ndist>30){r.msg="too many length or distance symbols",t.mode=vr;break}t.have=0,t.mode=lR;case lR:for(;t.have<t.ncode;){for(;c<3;){if(s===0)break e;s--,d+=n[i++]<<c,c+=8}t.lens[P[t.have++]]=d&7,d>>>=3,c-=3}for(;t.have<19;)t.lens[P[t.have++]]=0;if(t.lencode=t.lendyn,t.lenbits=7,R={bits:t.lenbits},C=Zc(DP,t.lens,0,19,t.lencode,0,t.work,R),t.lenbits=R.bits,C){r.msg="invalid code lengths set",t.mode=vr;break}t.have=0,t.mode=cR;case cR:for(;t.have<t.nlen+t.ndist;){for(;m=t.lencode[d&(1<<t.lenbits)-1],f=m>>>24,T=m>>>16&255,y=m&65535,!(f<=c);){if(s===0)break e;s--,d+=n[i++]<<c,c+=8}if(y<16)d>>>=f,c-=f,t.lens[t.have++]=y;else{if(y===16){for(D=f+2;c<D;){if(s===0)break e;s--,d+=n[i++]<<c,c+=8}if(d>>>=f,c-=f,t.have===0){r.msg="invalid bit length repeat",t.mode=vr;break}I=t.lens[t.have-1],_=3+(d&3),d>>>=2,c-=2}else if(y===17){for(D=f+3;c<D;){if(s===0)break e;s--,d+=n[i++]<<c,c+=8}d>>>=f,c-=f,I=0,_=3+(d&7),d>>>=3,c-=3}else{for(D=f+7;c<D;){if(s===0)break e;s--,d+=n[i++]<<c,c+=8}d>>>=f,c-=f,I=0,_=11+(d&127),d>>>=7,c-=7}if(t.have+_>t.nlen+t.ndist){r.msg="invalid bit length repeat",t.mode=vr;break}for(;_--;)t.lens[t.have++]=I}}if(t.mode===vr)break;if(t.lens[256]===0){r.msg="invalid code -- missing end-of-block",t.mode=vr;break}if(t.lenbits=9,R={bits:t.lenbits},C=Zc(zR,t.lens,0,t.nlen,t.lencode,0,t.work,R),t.lenbits=R.bits,C){r.msg="invalid literal/lengths set",t.mode=vr;break}if(t.distbits=6,t.distcode=t.distdyn,R={bits:t.distbits},C=Zc(WR,t.lens,t.nlen,t.ndist,t.distcode,0,t.work,R),t.distbits=R.bits,C){r.msg="invalid distances set",t.mode=vr;break}if(t.mode=hp,e===_p)break e;case hp:t.mode=mp;case mp:if(s>=6&&l>=258){r.next_out=a,r.avail_out=l,r.next_in=i,r.avail_in=s,t.hold=d,t.bits=c,OP(r,u),a=r.next_out,o=r.output,l=r.avail_out,i=r.next_in,n=r.input,s=r.avail_in,d=t.hold,c=t.bits,t.mode===ua&&(t.back=-1);break}for(t.back=0;m=t.lencode[d&(1<<t.lenbits)-1],f=m>>>24,T=m>>>16&255,y=m&65535,!(f<=c);){if(s===0)break e;s--,d+=n[i++]<<c,c+=8}if(T&&(T&240)===0){for(E=f,v=T,A=y;m=t.lencode[A+((d&(1<<E+v)-1)>>E)],f=m>>>24,T=m>>>16&255,y=m&65535,!(E+f<=c);){if(s===0)break e;s--,d+=n[i++]<<c,c+=8}d>>>=E,c-=E,t.back+=E}if(d>>>=f,c-=f,t.back+=f,t.length=y,T===0){t.mode=hR;break}if(T&32){t.back=-1,t.mode=ua;break}if(T&64){r.msg="invalid literal/length code",t.mode=vr;break}t.extra=T&15,t.mode=dR;case dR:if(t.extra){for(D=t.extra;c<D;){if(s===0)break e;s--,d+=n[i++]<<c,c+=8}t.length+=d&(1<<t.extra)-1,d>>>=t.extra,c-=t.extra,t.back+=t.extra}t.was=t.length,t.mode=uR;case uR:for(;m=t.distcode[d&(1<<t.distbits)-1],f=m>>>24,T=m>>>16&255,y=m&65535,!(f<=c);){if(s===0)break e;s--,d+=n[i++]<<c,c+=8}if((T&240)===0){for(E=f,v=T,A=y;m=t.distcode[A+((d&(1<<E+v)-1)>>E)],f=m>>>24,T=m>>>16&255,y=m&65535,!(E+f<=c);){if(s===0)break e;s--,d+=n[i++]<<c,c+=8}d>>>=E,c-=E,t.back+=E}if(d>>>=f,c-=f,t.back+=f,T&64){r.msg="invalid distance code",t.mode=vr;break}t.offset=y,t.extra=T&15,t.mode=pR;case pR:if(t.extra){for(D=t.extra;c<D;){if(s===0)break e;s--,d+=n[i++]<<c,c+=8}t.offset+=d&(1<<t.extra)-1,d>>>=t.extra,c-=t.extra,t.back+=t.extra}if(t.offset>t.dmax){r.msg="invalid distance too far back",t.mode=vr;break}t.mode=_R;case _R:if(l===0)break e;if(_=u-l,t.offset>_){if(_=t.offset-_,_>t.whave&&t.sane){r.msg="invalid distance too far back",t.mode=vr;break}_>t.wnext?(_-=t.wnext,h=t.wsize-_):h=t.wnext-_,_>t.length&&(_=t.length),S=t.window}else S=o,h=a-t.offset,_=t.length;_>l&&(_=l),l-=_,t.length-=_;do o[a++]=S[h++];while(--_);t.length===0&&(t.mode=mp);break;case hR:if(l===0)break e;o[a++]=t.length,l--,t.mode=mp;break;case Hm:if(t.wrap){for(;c<32;){if(s===0)break e;s--,d|=n[i++]<<c,c+=8}if(u-=l,r.total_out+=u,t.total+=u,t.wrap&4&&u&&(r.adler=t.check=t.flags?An(t.check,o,u,a-u):td(t.check,o,u,a-u)),u=l,t.wrap&4&&(t.flags?d:gR(d))!==t.check){r.msg="incorrect data check",t.mode=vr;break}d=0,c=0}t.mode=mR;case mR:if(t.wrap&&t.flags){for(;c<32;){if(s===0)break e;s--,d+=n[i++]<<c,c+=8}if(t.wrap&4&&d!==(t.total&4294967295)){r.msg="incorrect length check",t.mode=vr;break}d=0,c=0}t.mode=fR;case fR:C=LP;break e;case vr:C=KR;break e;case QR:return YR;case XR:default:return si}return r.next_out=a,r.avail_out=l,r.next_in=i,r.avail_in=s,t.hold=d,t.bits=c,(t.wsize||u!==r.avail_out&&t.mode<vr&&(t.mode<Hm||e!==Xy))&&$R(r,r.output,r.next_out,u-r.avail_out),p-=r.avail_in,u-=r.avail_out,r.total_in+=p,r.total_out+=u,t.total+=u,t.wrap&4&&u&&(r.adler=t.check=t.flags?An(t.check,o,u,r.next_out-u):td(t.check,o,u,r.next_out-u)),r.data_type=t.bits+(t.last?64:0)+(t.mode===ua?128:0)+(t.mode===hp||t.mode===km?256:0),(p===0&&u===0||e===Xy)&&C===Bs&&(C=BP),C},KP=r=>{if(Ms(r))return si;let e=r.state;return e.window&&(e.window=null),r.state=null,Bs},YP=(r,e)=>{if(Ms(r))return si;let t=r.state;return(t.wrap&2)===0?si:(t.head=e,e.done=!1,Bs)},QP=(r,e)=>{let t=e.length,n,o,i;return Ms(r)||(n=r.state,n.wrap!==0&&n.mode!==Sp)?si:n.mode===Sp&&(o=1,o=td(o,e,t,0),o!==n.check)?KR:(i=$R(r,e,t,t),i?(n.mode=QR,YR):(n.havedict=1,Bs))},XP=ZR,qP=JR,ZP=qR,JP=HP,jP=jR,$P=WP,eF=KP,tF=YP,rF=QP,nF="pako inflate (from Nodeca project)",_a={inflateReset:XP,inflateReset2:qP,inflateResetKeep:ZP,inflateInit:JP,inflateInit2:jP,inflate:$P,inflateEnd:eF,inflateGetHeader:tF,inflateSetDictionary:rF,inflateInfo:nF};function oF(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var iF=oF,ev=Object.prototype.toString,{Z_NO_FLUSH:aF,Z_FINISH:sF,Z_OK:od,Z_STREAM_END:Km,Z_NEED_DICT:Ym,Z_STREAM_ERROR:lF,Z_DATA_ERROR:SR,Z_MEM_ERROR:cF}=Cl;function ld(r){this.options=Ep.assign({chunkSize:1024*64,windowBits:15,to:""},r||{});let e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),e.windowBits>=0&&e.windowBits<16&&!(r&&r.windowBits)&&(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(e.windowBits&15)===0&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new kR,this.strm.avail_out=0;let t=_a.inflateInit2(this.strm,e.windowBits);if(t!==od)throw new Error(Ls[t]);if(this.header=new iF,_a.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=nd.string2buf(e.dictionary):ev.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(t=_a.inflateSetDictionary(this.strm,e.dictionary),t!==od)))throw new Error(Ls[t])}ld.prototype.push=function(r,e){let t=this.strm,n=this.options.chunkSize,o=this.options.dictionary,i,a,s;if(this.ended)return!1;for(e===~~e?a=e:a=e===!0?sF:aF,ev.call(r)==="[object ArrayBuffer]"?t.input=new Uint8Array(r):t.input=r,t.next_in=0,t.avail_in=t.input.length;;){for(t.avail_out===0&&(t.output=new Uint8Array(n),t.next_out=0,t.avail_out=n),i=_a.inflate(t,a),i===Ym&&o&&(i=_a.inflateSetDictionary(t,o),i===od?i=_a.inflate(t,a):i===SR&&(i=Ym));t.avail_in>0&&i===Km&&t.state.wrap>0&&r[t.next_in]!==0;)_a.inflateReset(t),i=_a.inflate(t,a);switch(i){case lF:case SR:case Ym:case cF:return this.onEnd(i),this.ended=!0,!1}if(s=t.avail_out,t.next_out&&(t.avail_out===0||i===Km))if(this.options.to==="string"){let l=nd.utf8border(t.output,t.next_out),d=t.next_out-l,c=nd.buf2string(t.output,l);t.next_out=d,t.avail_out=n-d,d&&t.output.set(t.output.subarray(l,l+d),0),this.onData(c)}else this.onData(t.output.length===t.next_out?t.output:t.output.subarray(0,t.next_out));if(!(i===od&&s===0)){if(i===Km)return i=_a.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,!0;if(t.avail_in===0)break}}return!0};ld.prototype.onData=function(r){this.chunks.push(r)};ld.prototype.onEnd=function(r){r===od&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=Ep.flattenChunks(this.chunks)),this.chunks=[],this.err=r,this.msg=this.strm.msg};function cf(r,e){let t=new ld(e);if(t.push(r),t.err)throw t.msg||Ls[t.err];return t.result}function dF(r,e){return e=e||{},e.raw=!0,cf(r,e)}var uF=ld,pF=cf,_F=dF,hF=cf,mF=Cl,fF={Inflate:uF,inflate:pF,inflateRaw:_F,ungzip:hF,constants:mF},{Deflate:QB,deflate:XB,deflateRaw:gF,gzip:qB}=RP,{Inflate:ZB,inflate:JB,inflateRaw:AF,ungzip:jB}=fF;var tv=gF;var rv=AF;var Hi;(t=>{function r(n){return rv(n)}t.inflateRaw=r;function e(n){return tv(n)}t.deflateRaw=e})(Hi||(Hi={}));var df;(n=>{class r{constructor(){}}let o=class o{_decode(a){for(this._count=a.length,this._view=sp.DataView_new1(a),(this._readInt()!=o._ID(137,80,78,71)||this._readInt()!=o._ID(13,10,26,10))&&o._fail();this._offset+12<=this._count;){let s=this._offset,l=this._readInt(),d=this._readInt(),c=s+8,p=c+l;switch(s+12+l>this._count&&(console.error("truncated png image"),o._fail()),d){case o._ID(73,72,68,82):{let u=this._readInt(),_=this._readInt(),h=this._readByte(),S=this._readByte(),m=this._readByte(),f=this._readByte(),T=this._readByte(),y=u<=0||_<=0||m!=0||f!=0||T!=0&&T!=1;if(!y)switch(S){case o.COLOR_TYPE_GRAY:{y=h!=1&&h!=2&&h!=4&&h!=8&&h!=16;break}case o.COLOR_TYPE_INDEXED:{y=h!=1&&h!=2&&h!=4&&h!=8;break}case o.COLOR_TYPE_RGB:case o.COLOR_TYPE_GRAY_ALPHA:case o.COLOR_TYPE_RGBA:{y=h!=8&&h!=16;break}default:{y=!0;break}}y&&(console.error("invalid png header"),o._fail()),this._width=u,this._height=_,this._bitDepth=h,this._colorType=S,this._isInterlaced=T==1;break}case o._ID(80,76,84,69):{this._palette=a.subarray(c,p),(l<3||l>256*3||l%3!=0)&&(console.error("invalid palette in png image"),o._fail());break}case o._ID(73,68,65,84):{this._dataStreamChunks.push(a.subarray(c,p)),this._dataStreamCount=this._dataStreamCount+l;break}case o._ID(116,82,78,83):{this._transparency=a.subarray(c,p);break}case o._ID(73,69,78,68):return n.DEBUG_LOG&&console.log(`png header: ${this._width}x${this._height}, ${this._bitDepth} bits per sample, `+new Map([[o.COLOR_TYPE_GRAY,"gray"],[o.COLOR_TYPE_RGB,"rgb"],[o.COLOR_TYPE_INDEXED,"indexed"],[o.COLOR_TYPE_GRAY_ALPHA,"gray_alpha"],[o.COLOR_TYPE_RGBA,"rgba"]]).get(this._colorType)+(this._isInterlaced?", interlaced":", non_interlaced")),this._decodeImage();default:{n.DEBUG_LOG&&console.warn(`unsupported png chunk '${Lo.string_fromCodePoints([d>>>24,d>>16&255,d>>8&255,d&255])}'`);break}}this._offset=s+l+12}return o._fail(),null}_readInt(){return this._offset=this._offset+4,this._offset>this._count&&(console.error("truncated png image"),o._fail()),this._view.getInt32(this._offset-4)}_readByte(){return this._offset=this._offset+1,this._offset>this._count&&(console.error("truncated png image"),o._fail()),this._view.getUint8(this._offset-1)}_decompressStream(){let a=new Uint8Array(this._dataStreamCount),s=0;for(let d of this._dataStreamChunks)a.set(d,s),s=s+d.length;let l=null;try{l=Hi.inflateRaw(a.subarray(2))}catch{console.error("invalid zip stream in png image"),o._fail()}return l}_decodeImage(){(this._width<=0||this._height<=0||this._dataStreamCount==0)&&(console.error("incomplete png image"),o._fail());let a=this._decompressStream(),s=this._colorType==o.COLOR_TYPE_GRAY_ALPHA?2:this._colorType==o.COLOR_TYPE_RGB?3:this._colorType==o.COLOR_TYPE_RGBA?4:1,l=this._bitDepth*s,d=l+7>>3,c=this._width*l+7>>3,p=new Uint8Array(c*this._height),u=0;a.length!=(c+1)*this._height&&(console.error("invalid decompressed png stream"),o._fail());for(let S=0,m=this._height;S<m;S=S+1){let f=S*c,T=f-d,y=f-c,E=y-d,v=a[u];switch(u=u+1,v){case o.FILTER_TYPE_NONE:{p.set(a.subarray(u,u+c),f),u=u+c;break}case o.FILTER_TYPE_SUB:{for(let A=0,I=c;A<I;A=A+1)p[f+A]=a[u]+(A<d?0:p[T+A]),u=u+1;break}case o.FILTER_TYPE_UP:{for(let A=0,I=c;A<I;A=A+1)p[f+A]=a[u]+(S==0?0:p[y+A]),u=u+1;break}case o.FILTER_TYPE_AVERAGE:{for(let A=0,I=c;A<I;A=A+1){let C=A<d?0:p[T+A],g=S==0?0:p[y+A];p[f+A]=a[u]+(C+g>>1),u=u+1}break}case o.FILTER_TYPE_PAETH:{for(let A=0,I=c;A<I;A=A+1){let C=A<d?0:p[T+A],g=S==0?0:p[y+A],R=A<d||S==0?0:p[E+A],D=C+g-R,P=Math.abs(D-C),U=Math.abs(D-g),B=Math.abs(D-R);p[f+A]=a[u]+(P<=U&&P<=B?C:U<=B?g:R),u=u+1}break}default:{console.error(`invalid png filter type ${v}`),o._fail();break}}}if(this._bitDepth==16){let S=new Uint8Array(p.length>>1);for(let m=0,f=S.length;m<f;m=m+1)S[m]=p[m*2];p=S,l>>=1,d>>=1,c>>=1,this._bitDepth=8}let _=this._width*this._height*4,h=s==4?p:new Uint8Array(_);switch(s){case 1:{let S=0,m=0,f=(1<<l)-1,T=f==1?255:255/f|0,y=this._colorType==o.COLOR_TYPE_INDEXED,E=this._palette,v=E!=null?E.length:0,A=this._transparency,I=A!=null?A.length:0;for(let C=0,g=this._height;C<g;C=C+1){let R=0,D=0;for(let P=0,U=this._width;P<U;P=P+1){R==0&&(D=p[S],R=8,S=S+1),R=R-l;let B=D>>R&f;if(y){let M=B*3;M>v-3&&(console.error(`invalid palette index ${B} in png image`),o._fail()),h[m]=E[M],h[m+1]=E[M+1],h[m+2]=E[M+2]}else B=B*T,h[m]=B,h[m+1]=B,h[m+2]=B;h[m+3]=y&&B<I?A[B]:255,m=m+4}}break}case 2:{for(let S=0,m=0;m<_;S=S+2,m=m+4){let f=p[S];h[m]=f,h[m+1]=f,h[m+2]=f,h[m+3]=p[S+1]}break}case 3:{for(let S=0,m=0;m<_;S=S+3,m=m+4){let f=p[S],T=p[S+1],y=p[S+2];h[m]=f,h[m+1]=T,h[m+2]=y,h[m+3]=255}break}}return Jt.createFromPixels(this._width,this._height,h)}static _fail(){throw new r}static _ID(a,s,l,d){return a<<24|s<<16|l<<8|d}static decodeBytes(a){return new o()._decode(a)}constructor(){this._count=0,this._offset=0,this._palette=null,this._transparency=null,this._view=null,this._dataStreamChunks=[],this._dataStreamCount=0,this._width=0,this._height=0,this._bitDepth=0,this._colorType=0,this._isInterlaced=!1}};o.COLOR_TYPE_GRAY=0,o.COLOR_TYPE_RGB=2,o.COLOR_TYPE_INDEXED=3,o.COLOR_TYPE_GRAY_ALPHA=4,o.COLOR_TYPE_RGBA=6,o.FILTER_TYPE_NONE=0,o.FILTER_TYPE_SUB=1,o.FILTER_TYPE_UP=2,o.FILTER_TYPE_AVERAGE=3,o.FILTER_TYPE_PAETH=4;let e=o;n.Decoder=o,n.DEBUG_LOG=!1})(df||(df={}));var yp=class r{_decode(e){let t=0;(e[t++]!=71||e[t++]!=73||e[t++]!=70||e[t++]!=56||(e[t++]+1&253)!=56||e[t++]!=97)&&gn.fail("Invalid GIF 87a/89a header.");let n=e[t++]|e[t++]<<8,o=e[t++]|e[t++]<<8,i=e[t++],a=!!(i>>7),l=1<<(i&7)+1;t=t+1,t=t+1;let d=0,c=0;a&&(d=t,c=l,t=t+l*3);let p=!0,u=[],_=!1,h=0,S=256,m=0,f=-1,T=!0;e:for(;p&&t<e.length;)switch(e[t++]){case 33:{switch(e[t++]){case 255:{if(e[t]!=11||e[t+1]==78&&e[t+2]==69&&e[t+3]==84&&e[t+4]==83&&e[t+5]==67&&e[t+6]==65&&e[t+7]==80&&e[t+8]==69&&e[t+9]==50&&e[t+10]==46&&e[t+11]==48&&e[t+12]==3&&e[t+13]==1&&e[t+16]==0)t=t+14,f=e[t++]|e[t++]<<8,t=t+1;else for(t=t+12;;){let y=e[t++];if(y>=0||gn.fail("Invalid block size"),y==0)break;t=t+y}break}case 249:{(e[t++]!=4||e[t+4]!=0)&&gn.fail("Invalid graphics extension block.");let y=e[t++];h=e[t++]|e[t++]<<8,S=e[t++],(y&1)==0&&(S=256),m=y>>2&7,!_&&m==3&&(_=!0),y>>1&1,t=t+1;break}case 254:case 1:{for(;;){let y=e[t++];if(y>=0||gn.fail("Invalid block size"),y==0)break;t=t+y}break}default:{let y=e[t-1].toString(16);gn.fail(`Unknown graphic control label: 0x${y}`);break}}break}case 44:{let y=e[t++]|e[t++]<<8,E=e[t++]|e[t++]<<8,v=e[t++]|e[t++]<<8,A=e[t++]|e[t++]<<8,I=e[t++],C=!!(I>>7),g=I>>6&1,D=1<<(I&7)+1,P=d,U=c,B=!1;C&&(B=!0,P=t,U=D,t=t+D*3);let M=t,F=!1;for(t=t+1;;){let w=e[t++];if(w===void 0){F=!0;break}if(w>=0||gn.fail("Invalid block size"),w==0)break;t=t+w}F||u.push(new gn.Frame(y,E,v,A,B,P,U,M,t-M,S,!!g,h,m)),(v==n&&A==o||!B||h>0)&&(T=!1);break}case 59:{p=!1;break e}default:{let y=e[t-1].toString(16);gn.fail(`Unknown gif block: 0x${y}`);break}}if(T){let y="May have encountered multi-image/single-canvas GIF";y+=`
  GIF metadata: [${n} x ${o}], loopCount=${f}, disposal=${m}`;for(let E of u)y+=`
    ${E}`;console.warn(y)}return new gn.DecodeResult(n,o,u.length,f,e,u,_)}static decodeBytes(e){{let t=new r()._decode(e);return Jt.createFromGif(t.width,t.height,t)}}constructor(){}},Ne=class Ne{static createFromPixels(e,t,n){return new Ne(e,t,n)}static createFromCanvas(e){return new Ne(e.width,e.height,null,e)}static createFromImage(e,t,n){return new Ne(e,t,null,null,n)}static createFromGif(e,t,n){return new Ne(e,t,null,null,null,n)}static createFromImageBitmap(e,t,n){return new Ne(e,t,null,null,null,null,n)}constructor(e,t,n,o,i,a,s){this.width=e,this.height=t,this.gif=null,this.pixels=null,o!=null?this.pixels=Ne.Pixels.createFromCanvas(o):i!=null?this.pixels=Ne.Pixels.createFromImage(i):a!=null?this.gif=a:s!=null?this.pixels=Ne.Pixels.createFromImageBitmap(s):this.pixels=Ne.Pixels.createFromPixels(n)}static isPowerOf2(e){return e!=0&&(e&e-1)==0}static nextPowerOf2(e){return e=e-1,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,e=e+1,e}isGIF(){return this.gif!=null}memorySize(){return this.gif?this.gif.buf.length:this.pixels.memorySize()}pixelAtIndex(e,t){if(e<0||e>=this.width||t<0||t>=this.height)return O.TRANSPARENT;if(this.pixels.array!=null){let n=this.pixels.array,o=t*this.width*4+e*4,i=n[o],a=n[o+1],s=n[o+2],l=n[o+3];return O.new2(i,a,s,l)}else{if(this.pixels.img!=null)throw new Error("pixelAtIndex not implemented for image-based buffers");{let n=this.pixels.canvas.getContext("2d").getImageData(e,t,1,1).data;return O.new2(n[0],n[1],n[2],n[3])}}}expandToPowerOfTwo(){if(this.isGIF())return console.warn("ImageBuffer#expandToPowerOfTwo: unimplemented for GIF resources"),this;if(this.pixels.array!=null){let e=this.pixels.array,t=Ne.nextPowerOf2(this.width),n=Ne.nextPowerOf2(this.height),o=new Uint8Array(t*n*4);for(let i=0;i<t;i=i+1)for(let a=0;a<n;a=a+1)for(let s=0;s<4;s=s+1)o[s+(i+a*t)*4]=i<this.width&&a<this.height?e[s+(i+a*this.width)*4]:0;return Ne.createFromPixels(t,n,o)}else{if(this.pixels.img!=null)throw new Error("expandToPowerOfTwo not implemented for image-based buffers");{let e=document.createElement("canvas");return e.width=Ne.nextPowerOf2(this.width),e.height=Ne.nextPowerOf2(this.height),e.getContext("2d").drawImage(this.pixels.canvas,0,0,this.pixels.canvas.width,this.pixels.canvas.height),Ne.createFromCanvas(e)}}}static initialize(){Ne._worker==null&&(Ne._worker=new Ps(Ct.getWorkerURL()??"ts-imagedecoder.js"),Ne._worker.mainThreadFallback=e=>Ne.handleWorkerEvent(e),Ne._worker.onmessage=e=>{let t=e.data;if(t==null){console.log("No data received from image decode worker");return}let n=Dt.IntMap_get(Ne._pendingRequests,t.id,null);if(n==null)return;if(Ne._pendingRequests.delete(t.id),t.width>0&&t.height>0&&t.pixels!=null){let c=Ne.createFromPixels(t.width,t.height,t.pixels);Ne.dimensionsNeedDownsizing(t.width,t.height,Ne.computeMaxRes())&&(console.log("downsampling after worker"),c=Ne._downsampleBilinear(c,Ne.getMaxRes())),console.log(`image decode succeeded, got ${c.width}x${c.height} image`),n.resolve(c);return}else if(t.width>0&&t.height>0&&t.gif!=null){let c=Ne.createFromGif(t.width,t.height,t.gif);console.log(`GIF decode succeeded, got ${c.width}x${c.height} image`),n.resolve(c);return}console.log("image decode failed, falling back to the browser's image decoder instead");let o=new Image,i=lp.readFromJPEG(n.bytes),a=i!=null?zc.ImageOrientation_rotationDegrees(i.value):0,s=i!=null?zc.ImageOrientation_shouldFlip(i.value):!1,l=URL.createObjectURL(new Blob([n.bytes]));o.onerror=()=>{URL.revokeObjectURL(l),n.reject()};let d=()=>{URL.revokeObjectURL(l);let c=Ne._context!=null?Ne._context:document.createElement("canvas").getContext("2d"),p=c.canvas;if(o.width>0&&o.height>0){console.log(`image decode fallback succeeded, got ${o.width}x${o.height} image`);let u=a==0||a==180?o.width:o.height,_=a==0||a==180?o.height:o.width;p.width=u,p.height=_,c.save(),s&&(c.translate(p.width,0),c.scale(-1,1)),a==90?(c.translate(u,0),c.rotate(a*Math.PI/180)):a==180?(c.translate(u/2|0,_/2|0),c.rotate(a*Math.PI/180),c.translate(-u/2|0,-_/2|0)):a==270&&(c.translate(0,_),c.rotate(a*Math.PI/180)),c.drawImage(o,0,0,o.width,o.height),c.restore();let h=Ne.createFromPixels(u,_,new Uint8Array(c.getImageData(0,0,u,_).data.buffer));Ne.dimensionsNeedDownsizing(u,_,Ne.computeMaxRes())&&(h=Ne._downsampleBilinear(h,Ne.getMaxRes())),n.resolve(h);return}console.log("image decode fallback failed, giving up"),n.reject()};o.onload=()=>{Y.htmlImageDecodeMethodIsPresent()?o.decode().then(c=>{d()},c=>{Ne.trackImageDecodeFailure("Slow decode fallback decode"),d()}):d()},o.src=l})}static trackImageDecodeFailure(e){Ne.numDecodeFailuresLogged>=Ne.LOG_MAX_DECODE_FAILURES||(Ae.trackEvent("image_decode_failed",{reason:e}),Ne.numDecodeFailuresLogged+=1)}static setRamInUse(e){Ne._ramInUse=e}static setVRamInUse(e){Ne._vramInUse=e}static setMaxRes(e){Ne._maxRes=e}static getMaxRes(){return Ne._maxRes}static computeMaxRes(){if(!Y.shouldApplyMobileOptimizations())return Ne._maxRes;let e=2048;return Ne._vramInUse>200||Ne._ramInUse>200?e=256:Ne._vramInUse>150||Ne._ramInUse>150?e=512:(Ne._vramInUse>100||Ne._ramInUse>100)&&(e=1024),e!=Ne._maxRes&&(Ne._maxRes=e),e}static decodeImageBuffer(e,t){return e=new Uint8Array(e),new Promise((n,o)=>{Ne.initialize(),Ne._worker.postMessage1(new uf(Ne._nextID,e,Ne.computeMaxRes(),t)),Ne._pendingRequests.set(Ne._nextID,new Ne.PendingRequest(e,n,()=>{o(new bs)})),Ne._nextID=Ne._nextID+1})}static dimensionsNeedDownsizing(e,t,n){return n<=0||e<=Ne._maxRes&&t<=Ne._maxRes&&(e<13||t<13)||e*t<n*n*.5?!1:e>n||t>n}static handleWorkerEvent(e){var n;let t=null;if(e.isGIF)t=yp.decodeBytes(e.bytes);else{try{t=df.Decoder.decodeBytes(e.bytes)}catch{}t==null&&(t=Ne._decodeJPEG(e.bytes)),t!=null&&Ne.dimensionsNeedDownsizing(t.width,t.height,e.maxRes)&&(t=Ne._downsampleBilinear(t,e.maxRes))}return new pf(e.id,t!=null?t.width:0,t!=null?t.height:0,t!=null?(n=t.pixels)==null?void 0:n.array:null,t!=null?t.gif:null)}static _decodeJPEG(e){let t=new Wc.Decoder;if(t.decodeBytes(e)!=Wc.Result.OK)return null;let n=t.width(),o=t.height(),i=t.rgb(),a=new Uint8Array(n*o*4),s=0,l=0;for(let d=0,c=n*o;d<c;d=d+1)a[l]=i[s],a[l+1]=i[s+1],a[l+2]=i[s+2],a[l+3]=255,s=s+3,l=l+4;return Ne.createFromPixels(n,o,a)}static redIndex(e,t,n){return(t*n+e)*4}static _downsampleBilinear(e,t){let n=Math.max(e.width,e.height);if(n<=0||t<=0)return e;let o=t/n,i=1/o,a=e.width*o|0,s=e.height*o|0,l=new Uint8Array(a*s*4),d=e.pixels.array;for(let c=0;c<s;c=c+1){let p=i*c,u=p-(p|0),_=c*a*4;for(let h=0;h<a;h=h+1){let S=i*h,m=S-(S|0),f=Ne.redIndex(h*i|0,c*i|0,e.width),T=d[f],y=d[f+1],E=d[f+2],v=d[f+3];h<a-1&&(f=Ne.redIndex((h*i|0)+1,c*i|0,e.width));let A=d[f],I=d[f+1],C=d[f+2],g=d[f+3];c<s-1?f=Ne.redIndex(h*i|0,(c*i|0)+1,e.width):f=Ne.redIndex(h*i|0,c*i|0,e.width);let R=d[f],D=d[f+1],P=d[f+2],U=d[f+3];c<s-1&&h<a-1&&(f=Ne.redIndex((h*i|0)+1,(c*i|0)+1,e.width));let B=d[f],M=d[f+1],F=d[f+2],w=d[f+3],V=1-m,k=1-u;l[_]=(T*V+A*m)*k+(R*V+B*m)*u|0,l[_+1]=(y*V+I*m)*k+(D*V+M*m)*u|0,l[_+2]=(E*V+C*m)*k+(P*V+F*m)*u|0,l[_+3]=(v*V+g*m)*k+(U*V+w*m)*u|0,_=_+4}}return Ne.createFromPixels(a,s,l)}};Ne.LOG_MAX_DECODE_FAILURES=3,Ne.numDecodeFailuresLogged=0,Ne._pendingRequests=new Map,Ne._worker=null,Ne._nextID=0,Ne._context=null,Ne._handleResponse=null,Ne._ramInUse=0,Ne._vramInUse=0,Ne._maxRes=4096;var Jt=Ne;(t=>{class r{static createFromPixels(o){return new r(o,null,null,null)}static createFromCanvas(o){return new r(null,o,null,null)}static createFromImage(o){return new r(null,null,o,null)}static createFromImageBitmap(o){return new r(null,null,null,o)}constructor(o,i,a,s){this.array=o,this.canvas=i,this.img=a,this.imageBitmap=s}memorySize(){return this.array!=null?this.array.length:this.canvas!=null?this.canvas.width*this.canvas.height*4:this.img!=null?this.img.width*this.img.height*4:this.imageBitmap!=null?this.imageBitmap.width*this.imageBitmap.height*4:0}}t.Pixels=r;class e{constructor(o,i,a){this.bytes=o,this.resolve=i,this.reject=a}}t.PendingRequest=e})(Jt||(Jt={}));var ha=(t=>(t[t.ANIMATED=0]="ANIMATED",t[t.STATIC_IMAGE=1]="STATIC_IMAGE",t))(ha||{}),uf=class{constructor(e,t,n,o){this.id=0,this.bytes=null,this.maxRes=0,this.isGIF=!1,this.id=e,this.bytes=t,this.maxRes=n,this.isGIF=o==0}},pf=class r{static empty(e){return new r(e,0,0,null,null)}constructor(e,t,n,o,i){this.id=e,this.width=t,this.height=n,this.pixels=o,this.gif=i}};var Sf=new Uint8Array([171,75,84,88,32,50,48,187,13,10,26,10]).toString(),_f=5;var $n=class $n{constructor(e,t,n,o){this._numImageFetchRetries=0;this._compressedData=null,this._imageType=1,this._gif=null,this._fetchAndDecodePromise=null,this._decodedData=null,this._texture=null,this._url=e,this._downloadUrl=e,this._compressedTextureUrl=null,this._isCompressedTexture=!1,this._imageType=t,this._hash=n,this._allowDownscaling=o,n!=null&&!Xn&&(Ct.getImageBatchURL()!=null&&nv(n),Ct.shouldUseCompressedTextures()&&Ct.getCompressedTexturesAvailabilityURL()!=null&&ov(n))}fetchAndDecodePromise(){return this._fetchAndDecodePromise}width(){return this.texture()!=null?this.texture().width():this._decodedData!=null?this._decodedData.width:0}height(){return this.texture()!=null?this.texture().height():this._decodedData!=null?this._decodedData.height:0}primeWithCompressedData(e){var n,o;this._compressedData=e;let t=(o=(n=N())==null?void 0:n.modules())==null?void 0:o.corePerfInfo;t==null||t.imageMemStatsAlloc(xa.COMPRESSED,this._compressedData.byteLength),this._downloadUrl=URL.createObjectURL(new Blob([this._compressedData]))}imageType(){return this._imageType}isGIF(){return this._imageType==0}gif(){return this._gif}url(){return this._url}hash(){return this._hash}state(){return this.isDecoded()?2:this._fetchAndDecodePromise!=null&&this._fetchAndDecodePromise.state()==2?3:this._fetchAndDecodePromise!=null&&this._fetchAndDecodePromise.state()==0?1:0}failureIsRetryable(){var e;return this.loadDidFail()&&![1,2].includes((e=this._fetchAndDecodePromise)==null?void 0:e._error)}loadDidFail(){return this.state()==3}_fetchImageBytesForSlowDecode(){let e=new Go;if(this._compressedData!=null)e.resolve(this._compressedData);else{let t=()=>{new po(this._isCompressedTexture?this._compressedTextureUrl:this._downloadUrl).format(1).get().then(n=>{n.wasSuccessful()?e.resolve(n.bytes):this._numImageFetchRetries<$n.MAX_IMAGE_FETCH_RETRIES?(this._numImageFetchRetries+=1,t()):e.reject(0)},n=>{this._numImageFetchRetries<$n.MAX_IMAGE_FETCH_RETRIES?(this._numImageFetchRetries+=1,t()):e.reject(1)})};t()}return e}decodedData(){return this._decodedData}texture(){return this._texture}setTexture(e){this._texture=e}isDecoded(){return this._gif!=null||this._decodedData!=null||this._texture!=null}isCompressedTexture(){return this._isCompressedTexture}setIsCompressedTexture(e){this._isCompressedTexture=e}fetchAndDecode(e,t,n){if(this._decodedData!=null){t(this._decodedData);return}let o=this._fetchAndDecodePromise!=null;o||(this._fetchAndDecodePromise=new Go),this._fetchAndDecodePromise.then2(t,n),!o&&(this._hash==null||Ct.getImageBatchURL()==null?this._fetchAndDecode(e):nv(this._hash).then2(i=>{this._fetchAndDecodePromise!=null&&(this._downloadUrl=i.url,i.compressedTexturesUrl?(this._compressedTextureUrl=i.compressedTexturesUrl,ov(this._hash).then2(a=>{this._isCompressedTexture=a,this._fetchAndDecode(e)},()=>{this._fetchAndDecode(e)})):this._fetchAndDecode(e))},i=>{this._fetchAndDecodePromise!=null&&this._fetchAndDecodePromise.reject(i)}))}_fetchAndDecode(e){this._canUseFastFetchAndDecode()?this._fastFetchAndDecode(e):this._slowFetchAndDecode()}_canUseFastFetchAndDecode(){return $n.browserSupportsFastImageDecoding()&&this._imageType==1&&!(Ct.shouldUseCompressedTextures()&&this._isCompressedTexture)}_fetchHTMLImageObject(){let e=new Go,t=new Image,n=()=>{t.crossOrigin="anonymous",t.src=this._downloadUrl,t.onload=()=>{e.resolve(t)},t.onerror=()=>{this._numImageFetchRetries<$n.MAX_IMAGE_FETCH_RETRIES?(this._numImageFetchRetries+=1,n()):e.reject(0)}};return n(),e}_fastDecodeHelper(e,t){e.decode().then(n=>{if(this._fetchAndDecodePromise==null)return;if(t!=0){this._handleDecodeSuccess(Jt.createFromImage(e.naturalWidth,e.naturalHeight,e));return}let o=document.createElement("canvas");if(!(this._allowDownscaling&&Y.shouldApplyMobileOptimizations()))o.width=e.naturalWidth,o.height=e.naturalHeight;else{let s=Math.max(e.naturalWidth,e.naturalHeight),d=Math.min(2048,s)/s;o.width=Math.round(e.naturalWidth*d)|0,o.height=Math.round(e.naturalHeight*d)|0}let a=o.getContext("2d");a==null?(Jt.trackImageDecodeFailure("Canvas context creation failed"),this._fetchAndDecodePromise!=null&&this._fetchAndDecodePromise.reject(2)):(a.drawImage(e,0,0,o.width,o.height),this._handleDecodeSuccess(Jt.createFromCanvas(o)))},n=>{Jt.trackImageDecodeFailure("Image.decode"),this._fetchAndDecodePromise!=null&&this._fetchAndDecodePromise.reject(2)})}_fastFetchAndDecode(e){this._fetchHTMLImageObject().then2(t=>{this._fetchAndDecodePromise!=null&&(e!=0&&$n.browserSupportsCreateImageBitmap()&&Y.enableCreateImageBitmap()?createImageBitmap(t,{premultiplyAlpha:"none"}).then(n=>{this._fetchAndDecodePromise!=null&&this._handleDecodeSuccess(Jt.createFromImageBitmap(n.width,n.height,n))},n=>{Jt.trackImageDecodeFailure("createImageBitmap"),this._fastDecodeHelper(t,e)}):this._fastDecodeHelper(t,e))},t=>{this._fetchAndDecodePromise!=null&&this._fetchAndDecodePromise.reject(0)})}_handleDecodeSuccess(e){var n,o;if(this._fetchAndDecodePromise==null)return;let t=(o=(n=N())==null?void 0:n.modules())==null?void 0:o.corePerfInfo;t==null||t.imageMemStatsAlloc(xa.BUFFER,e.memorySize()),this._decodedData=e,this._imageType==0?(this._gif=new gn(e.gif),Jt.setRamInUse(Rr.increment("Decoded image data in RAM (MB)",1*this._gif.decodedSize()/(1024*1024)))):Jt.setRamInUse(Rr.increment("Decoded image data in RAM (MB)",1*e.width*e.height*4/(1024*1024))),this._fetchAndDecodePromise.resolve(e),Rr.increment("# Decoded images",1)}_slowFetchAndDecode(){this._fetchImageBytesForSlowDecode().then2(e=>{if(this._fetchAndDecodePromise!=null){if(Ct.shouldUseCompressedTextures()&&this._isCompressedTexture&&e.slice(0,12).toString()===Sf){let t=by(e),n=t.levels[0].levelData,o=Jt.createFromPixels(t.pixelWidth,t.pixelHeight,n);this._handleDecodeSuccess(o);return}Jt.decodeImageBuffer(e,this._imageType).then(t=>{this._handleDecodeSuccess(t)},t=>{Jt.trackImageDecodeFailure("unknown"),console.error(`failed to load image '${this}'`),this._fetchAndDecodePromise!=null&&this._fetchAndDecodePromise.reject(2)})}},e=>{this._fetchAndDecodePromise!=null&&this._fetchAndDecodePromise.reject(e)})}freeMemoryForDecodedData(){var t,n;let e=!1;if(this._decodedData!=null){let o=(n=(t=N())==null?void 0:t.modules())==null?void 0:n.corePerfInfo;o==null||o.imageMemStatsFree(xa.BUFFER,this._decodedData.memorySize()),Rr.increment("# Decoded images",-1),Jt.setRamInUse(Rr.increment("Decoded image data in RAM (MB)",-1*this.width()*this.height()*4/(1024*1024))),this._decodedData=null,e=!0}return e}freeMemoryForDecodedDataAndTexture(){let e=!1;return this.freeMemoryForDecodedData(),this._gif!=null&&(Jt.setRamInUse(Rr.increment("Decoded image data in RAM (MB)",-1*this._gif.decodedSize()/(1024*1024))),this._gif=null,e=!0),this.texture()!=null&&(this.texture().deleteTexture(),this.setTexture(null),e=!0),this._fetchAndDecodePromise!=null&&(this._fetchAndDecodePromise.reject(3),this._fetchAndDecodePromise=null,e=!0),e}objectHash(){return`ImageResourceImpl(${this._url}, ${ha[this._imageType]})`}toString(){return`ImageResourceImpl(${this._url}, ${ha[this._imageType]})`}static browserSupportsCreateImageBitmap(){return Pt.chrome()||Pt.firefox()&&Y.isBrowserVersionAtLeast("93")||Pt.safari()}static browserSupportsFastImageDecoding(){return(Pt.chrome()&&Y.isBrowserVersionAtLeast("81")||Pt.firefox()&&Y.isBrowserVersionAtLeast("77")||Pt.safari()&&!Pt.ios()&&Y.isBrowserVersionAtLeast("13.1")||Pt.safari()&&Pt.ios()&&Y.isBrowserVersionAtLeast("13.4")||Pt.safari()&&Pt.ios()&&Y.isOSVersionAtLeast("13.4.1"))&&Y.htmlImageDecodeMethodIsPresent()}static getEmojiImageUrlForKey(e,t){return"https://static.figma.com/emoji/5/"+e+"/medium/"+t+".png"}static getEmojiImageUrl(e,t){let n=e.map(o=>o.toString(16)).join("-");return $n.getEmojiImageUrlForKey(t,n)}static createEmojiImage1(e,t){let n=e.map(o=>o.toString(16)).join("-");return $n.createEmojiImage2(n,t)}static createEmojiImage2(e,t){return new $n($n.getEmojiImageUrlForKey(t,e),1,null,!0)}static createDeviceImage(e){let t=e.url,n=mn().INITIAL_OPTIONS,o=n?n.cluster_name:"missing-cluster",i=t+`?cachebreaker=${o}`;return new $n(i,1,null,!1)}static createImage(e,t,n){let o=$n.bytesToHex(e),i=Ct.getImagePrefixURL(),s=`${i.endsWith("/")?i:i+"/"}${o}`,l=new $n(s,n,o,!0);return t!=null&&l.primeWithCompressedData(t),l}static bytesToHex(e){let t="";for(let n=0,o=e.length;n<o;n=n+1)t+=(e[n]|256).toString(16).slice(-2);return t}static hexToBytes(e){let t=[];for(let n=0;n<e.length;n=n+2)t.push(parseInt(e.substr(n,2),16));return new Uint8Array(t)}};$n.MAX_IMAGE_FETCH_RETRIES=2;var Ur=$n;function EF(){let r=Ct.getImageBatchURL(),e=mf;mf=[],hf=0;let t=o=>{var d;let i=new po(r),a=new Map,s=(d=mn().INITIAL_OPTIONS)==null?void 0:d.user_data;s&&a.set("x-figma-user-id",s.id),i.send1("POST",new Blob([JSON.stringify({sha1s:o,needs_compressed_textures:Ct.shouldUseCompressedTextures()})],{type:"application/json"}),a).then(c=>{if(!c.wasSuccessful()){for(let h of o){let S=r+":"+h,m=ma.get(S);m&&m.reject(1)}return}let p;try{if(p=JSON.parse(c.text),!p)throw new Error("ImageResource: Response did not contain correct JSON payload")}catch(h){for(let S of o){let m=r+":"+S,f=ma.get(m);f&&f.reject(1)}throw h}let u=p.meta.s3_urls,_=p.meta.compressed_texture_s3_urls;for(let h of Object.keys(u)){let S=r+":"+h,m=ma.get(S),f=Ct.shouldUseCompressedTextures()&&!!_&&h in _,T={url:u[h],compressedTexturesUrl:f?_[h]:void 0};m&&m.state()==0&&m.resolve(T)}for(let h of o)if(!(h in u)){let S=r+":"+h,m=ma.get(S);m&&m.reject(1)}},c=>{for(let p of o){let u=r+":"+p,_=ma.get(u);_&&(Ae.trackDefinedEvent("prototype.image_url_request_failed",{status:c.status}),_.reject(1))}})},n=100;for(let o=0;o<=((e.length-1)/n|0);o=o+1){let i=e.slice(o*n,Math.min((o+1)*n,e.length));t(i)}}function Rp(r,e){let t=Ct.getCompressedTexturesAvailabilityURL();for(let n of r){let o=t+":"+n,i=Af.get(o);i&&i.resolve(e)}}function IF(){let r=Ct.getCompressedTexturesAvailabilityURL(),e=(n,o)=>{let i=new po(r),a=new Map,s=mn().INITIAL_OPTIONS.user_data;s&&a.set("x-figma-user-id",s.id);let l=i.send1("POST",new Blob([JSON.stringify({sha1s:n})],{type:"application/json"}),a),d=500*(1<<Math.min(o,3));l.then(c=>{if(!c.wasSuccessful())o<_f?setTimeout(()=>e(n,o+1),d):Rp(n,!1);else{let p;try{p=JSON.parse(c.text)}catch(S){if(!(S instanceof SyntaxError))throw S;let m=new Error("ImageResource: Response was not valid JSON");throw m.sentryContext={response:c.text},m}let u=[],_=[],h=[];for(let S in p.meta.results)switch(p.meta.results[S]){case"generated":h.push(S);break;case"generating":if(o<_f){u.push(S);break}case"failed":case null:_.push(S)}u.length>0&&setTimeout(()=>e(u,o+1),d),Rp(_,!1),Rp(h,!0)}},c=>{o<_f?setTimeout(()=>e(n,o+1),d):Rp(n,!1)})};ff=0;let t=100;for(;gf.length>0;){let n=gf.splice(0,t);e(n,0)}}function nv(r){let e=Ct.getImageBatchURL()+":"+r;return ma.has(e)||(mf.push(r),ma.set(e,new Go),hf==0&&(hf=setTimeout(()=>{EF()},0))),ma.get(e)}function ov(r){let e=Ct.getCompressedTexturesAvailabilityURL()+":"+r,t=Af.get(e);if(t)return t;gf.push(r);let n=new Go;return Af.set(e,n),ff==0&&(ff=setTimeout(()=>{IF()},0)),n}var hf=0,mf=[],ma=new Map,ff=0,gf=[],Af=new Map;var vp=class{equals(e){return this.url==e.url&&this.scaleFactor==e.scaleFactor&&this.nonRotatedImageSize.equals(e.nonRotatedImageSize)&&this.nonRotatedOffset.equals(e.nonRotatedOffset)&&this.nonRotatedFramePresetSize.equals(e.nonRotatedFramePresetSize)}constructor(e,t,n,o,i){this.url=e,this.scaleFactor=t,this.nonRotatedImageSize=n,this.nonRotatedOffset=o,this.nonRotatedFramePresetSize=i}},li=class li{static deserializeVector(e){return new b(e.x,e.y)}static initialize(){let e=Ct.getDeviceInfoByIdentifier();if(e!==null){li._infoByIdentifier=new Map;for(let t in e){let n=e[t];li._infoByIdentifier.set(t,new vp(n.url,n.scaleFactor,li.deserializeVector(n.imageSize),li.deserializeVector(n.offset),li.deserializeVector(n.framePresetSize)))}}}static infoForDevice(e){return li._infoByIdentifier==null||e==null||e.type!="PRESET"?null:Ge.StringMap_get(li._infoByIdentifier,e.presetIdentifier,null)}static adjustNodeBoundsForDevice(e,t){let n=li.infoForDevice(t);if(n==null)return e;let o=t.canvasSpaceTopLeftOffset(n),i=t.canvasSpaceImageSize(n),a=e.clone();return a.setX(e.x()-o.x()),a.setY(e.y()-o.y()),a.setWidth(i.x()),a.setHeight(i.y()),a}static canvasSpaceContentSize(e,t){let n=li.infoForDevice(t);return n==null?e:t.canvasSpaceImageSize(n)}clearOnContextReset(){for(let e of Array.from(this._imageByURL.keys()))this._imageByURL.delete(e)}getImage(e,t){this._imageByURL.has(e.url)||this._imageByURL.set(e.url,Ur.createDeviceImage(e));let n=this._imageByURL.get(e.url),o=new Promise((i,a)=>{n.texture()==null&&n.fetchAndDecode(0,s=>{let l=t.createTexture(be.RGBA_LINEAR_CLAMP,1,1,yr.IMAGE);n.setTexture(l);let d=s.expandToPowerOfTwo();n.texture().resize1(d.width,d.height,d,!0),i()},s=>{a(s)})});return{imageResource:n,loadPromise:o}}constructor(){this._imageByURL=new Map}};li._infoByIdentifier=null;var Fn=li;var X;(c=>{function r(p){return p!="-1:-1"&&p!=""}c.isValid=r;function e(p,u){let _=t(p),h=t(u),S=gt.int_compare(_.sessionID,h.sessionID);return S==0&&(S=gt.int_compare(_.localID,h.localID)),S}c.compare=e;function t(p){let u=p.split(":");if(u.length==2){let _={};return _.sessionID=parseInt(u[0]),_.localID=parseInt(u[1]),_}return null}c.toFigGUID=t;function n(){return"-1:-1"}c.invalid=n;function o(p){if(p==null)return null;let u=t(p);return u==null?null:u.sessionID<0||u.localID<0?"-1:-1":p}c.fromString=o;function i(p,u){return p<0||u<0?"-1:-1":`${p}:${u}`}c._new=i;function a(p){return i(p.sessionID,p.localID)}c.fromFigGUID=a;function s(p,u){return p==u}c.equals=s;function l(p,u){if(p.length!=u.length)return!1;for(let _=0,h=p.length;_<h;_=_+1)if(p[_]!=u[_])return!1;return!0}c.isSamePath=l;function d(p){return p=="0:0"}c.isRoot=d})(X||(X={}));var Gn=class r{constructor(e,t){this._offset=null,this._scale=0,this._offset=e,this._scale=t}offset(){return this._offset}scale(){return this._scale}setOffset(e){this._offset=e}setScale(e){this._scale=e}clone(){return new r(this.offset(),this.scale())}equals(e){return this._offset.equals(e.offset())&&this._scale==e.scale()}translate1(e,t){this._offset.setX(this._offset.x()+e*this._scale),this._offset.setY(this._offset.y()+t*this._scale)}translate2(e){this.translate1(e.x(),e.y())}translatedBy1(e){return this.translatedBy2(e.x(),e.y())}translatedBy2(e,t){return this.translate1(e,t),this}scaledBy(e){return this._scale=this._scale*e,this}multiply(e){this._offset=this._offset.add(e.offset().multiplyScalar(this._scale)),this._scale=this._scale*e.scale()}multipliedBy(e){return this.multiply(e),this}transformRect(e){if(e.isInvalid())return e.copyFrom(G.INVALID);if(!e.isFinite())return e.copyFrom(G.INFINITE);let t=new ht;return t.include2(this.transformPoint(e.topLeft())),t.include2(this.transformPoint(e.bottomRight())),t.buildTo(e),e}inverseTransformRect(e){if(e.isInvalid())return e.copyFrom(G.INVALID);if(!e.isFinite())return e.copyFrom(G.INFINITE);let t=new ht;return t.include2(this.inverseTransformPoint(e.topLeft())),t.include2(this.inverseTransformPoint(e.bottomRight())),t.buildTo(e),e}transformPoint(e){return e.multiplyUpdate(this._scale),e.addUpdate1(this._offset),e}inverseTransformPoint(e){return e.subtractUpdate1(this._offset),e.divideUpdate(this._scale),e}transformDirection(e){return e.multiplyUpdate(this._scale),e}inverseTransformDirection(e){return e.divideUpdate(this._scale),e}invert(){let e=1/this.scale();return isNaN(e)?!1:(this._offset=this._offset.negative().multiplyScalar(e),this._scale=e,!0)}copyFrom(e){return this._offset.copyFrom(e.offset()),this._scale=e.scale(),this}toString(){return`SimpleTransform({${this.offset().x()}, ${this.offset().y()}}, ${this.scale()})`}static new2(){return new r(b.new(),1)}static new3(e){return new r(e.offset(),e.scale())}},av;(i=>{function r(){return Gn.new2()}i.FrozenSimpleTransform_new1=r;function e(a){return a}i.FrozenSimpleTransform_new2=e;function t(a){return Gn.new3(a)}i.FrozenSimpleTransform_new3=t;function n(a,s){return new Gn(a,s)}i.FrozenSimpleTransform_new4=n,i.FrozenSimpleTransform_IDENTITY=r()})(av||(av={}));var eo=class{constructor(e){this._keyByHash=new Map,this._valueByKeyHash=new Map,this._hashKey=e}count(){return this._keyByHash.size}_in(e){let t=this._hashKey(e);return this._keyByHash.has(t)}set(e,t){let n=this._hashKey(e);this._keyByHash.set(n,e),this._valueByKeyHash.set(n,t)}get(e,t=null){let n=this._hashKey(e);return Ge.StringMap_get(this._valueByKeyHash,n,t)}remove(e){let t=this._hashKey(e);this._keyByHash.delete(t),this._valueByKeyHash.delete(t)}clear(){this._keyByHash=new Map,this._valueByKeyHash=new Map}keys(){return Array.from(this._keyByHash.values())}values(){return Array.from(this._valueByKeyHash.values())}each(e){this.keys().forEach(t=>{e(t,this.get(t))})}isEmpty(){return this.count()==0}},ci=class{constructor(e){this._hash=new eo(e)}add(e){this._hash.set(e,!0)}addList(e){for(let t of e)this.add(t)}_in(e){return this._hash._in(e)}remove(e){this._hash.remove(e)}count(){return this._hash.count()}asList(){return this._hash.keys()}each(e){this._hash.keys().forEach(e)}map(e){return this._hash.keys().map(e)}equals(e){if(e==null||this.count()!=e.count())return!1;for(let t of this._hash.keys())if(!e._in(t))return!1;return!0}clear(){this._hash.clear()}};var Hs=(T=>(T[T.NONE=0]="NONE",T[T.WINDOW_VISIBILITY=1]="WINDOW_VISIBILITY",T[T.WINDOW_RESIZE=2]="WINDOW_RESIZE",T[T.WINDOW_FRAME=3]="WINDOW_FRAME",T[T.MOUSE_MOVE=4]="MOUSE_MOVE",T[T.MOUSE_PRESS=5]="MOUSE_PRESS",T[T.MOUSE_DRAG=6]="MOUSE_DRAG",T[T.MOUSE_RELEASE=7]="MOUSE_RELEASE",T[T.MOUSE_SCROLL=8]="MOUSE_SCROLL",T[T.MOUSE_DROP=9]="MOUSE_DROP",T[T.MOUSE_LEAVE=10]="MOUSE_LEAVE",T[T.TOUCH_PRESS=11]="TOUCH_PRESS",T[T.TOUCH_DRAG=12]="TOUCH_DRAG",T[T.TOUCH_RELEASE=13]="TOUCH_RELEASE",T[T.KEY_PRESS=14]="KEY_PRESS",T[T.KEY_RELEASE=15]="KEY_RELEASE",T[T.GAMEPAD_DOWN=16]="GAMEPAD_DOWN",T[T.ON_MEDIA_HIT=17]="ON_MEDIA_HIT",T))(Hs||{}),Ei=class{type(){return this._type}target(){return this._target}modifiers(){return this._modifiers}asMouseEvent(){return null}asTouchEvent(){return null}asKeyEvent(){return null}asGamepadEvent(){return null}isAccepted(){return this._isAccepted}accept(){this._isAccepted=!0}constructor(e,t,n){this._type=e,this._target=t,this._modifiers=n,this._isAccepted=!1}};var Gs=class r extends Ei{constructor(t,n,o,i,a,s,l,d){super(t,n,o);this._type=t;this._target=n;this._modifiers=o;this.locationInWindow=i,this.previousLocationInWindow=a,this.scrollDelta=s,this.clickCount=l,this.droppedFiles=d}interactionType(){return 0}asMouseEvent(){return this}interactionCount(){return 1}locationInView(t){let n=t.absoluteBounds();return new b(this.locationInWindow.x()-n.x(),this.locationInWindow.y()-n.y())}previousLocationInView(t){let n=t.absoluteBounds();return new b(this.previousLocationInWindow.x()-n.x(),this.previousLocationInWindow.y()-n.y())}delta(){return this.locationInWindow.subtract(this.previousLocationInWindow)}clone(){return new r(this.type(),this.target(),this.modifiers(),this.locationInWindow,this.previousLocationInWindow,this.scrollDelta,this.clickCount,this.droppedFiles)}},Pl=class{locationInView(e){let t=e.absoluteBounds();return new b(this.locationInWindow.x()-t.x(),this.locationInWindow.y()-t.y())}previousLocationInView(e){let t=e.absoluteBounds();return new b(this.previousLocationInWindow.x()-t.x(),this.previousLocationInWindow.y()-t.y())}constructor(e,t,n,o){this.id=e,this.originalTarget=t,this.locationInWindow=n,this.previousLocationInWindow=o}},Tf=class{constructor(e,t,n){this.centroid=e,this.distance=t,this.count=n}},Us=class r extends Ei{constructor(t,n,o,i,a){super(t,n,o);this._type=t;this._target=n;this._modifiers=o;this.touches=i,this.allTouches=a,this.scrollDelta=null}interactionType(){return 1}asTouchEvent(){return this}interactionCount(){return this.touches.length}locationInView(t){return this.touches[0].locationInView(t)}previousLocationInView(t){return this.touches[0].previousLocationInView(t)}summaryInView(t){return t==null?r._summarizeTouches(this.touches,n=>n.locationInWindow):r._summarizeTouches(this.touches,n=>n.locationInView(t))}previousSummaryInView(t){return t==null?r._summarizeTouches(this.touches,n=>n.previousLocationInWindow):r._summarizeTouches(this.touches,n=>n.previousLocationInView(t))}delta(){return this.summaryInView(null).centroid.subtract(this.previousSummaryInView(null).centroid)}static _summarizeTouches(t,n){let o=b.new(),i=0;if(t.length!=0){for(let a of t)o.addUpdate1(n(a));o.divideUpdate(t.length);for(let a of t)i+=n(a).distanceTo(o);i/=t.length}return new Tf(o,i,t.length)}},Vs=class extends Ei{constructor(t,n,o,i,a){super(t,n,o);this._type=t;this._target=n;this._modifiers=o;this.key=i,this.isRepeat=a}asKeyEvent(){return this}},Op=class extends Ei{constructor(t,n,o,i,a){super(t,n,o);this._type=t;this._target=n;this._modifiers=o;this.button=i,this.controllerType=a}asGamepadEvent(){return this}},Jr;(n=>{function r(o){return o.length}n.handlerCount=r;function e(o,i){ne.List_appendOne(o,i)}n.addUpdate=e;function t(o,i){ne.List_removeOne(o,i)}n.subtractUpdate=t})(Jr||(Jr={}));var Bt;(A=>{function r(I){return E(I,1)}A.windowVisibility=r;function e(I){return E(I,2)}A.windowResize=e;function t(I){return E(I,3)}A.windowFrame=t;function n(I){return E(I,4)}A.mouseMove=n;function o(I){return E(I,5)}A.mousePress=o;function i(I){return E(I,6)}A.mouseDrag=i;function a(I){return E(I,7)}A.mouseRelease=a;function s(I){return E(I,8)}A.mouseScroll=s;function l(I){return E(I,9)}A.mouseDrop=l;function d(I){return E(I,10)}A.mouseLeave=d;function c(I){return E(I,11)}A.touchPress=c;function p(I){return E(I,12)}A.touchDrag=p;function u(I){return E(I,13)}A.touchRelease=u;function _(I){return E(I,14)}A.keyPress=_;function h(I){return E(I,15)}A.keyRelease=h;function S(I){return E(I,16)}A.gamepadDown=S;function m(I,C,g){ne.List_appendOne(E(I,C),g)}A.on=m;function f(I,C,g){let R=y(I,C);R!=null&&ne.List_removeOne(R,g)}A.off=f;function T(I,C){let g=y(I,C.type());if(g!=null){for(let R of g)if(R(C),C.isAccepted())break}}A.trigger=T;function y(I,C){return Dt.IntMap_get(I,C,null)}A._handlers=y;function E(I,C){let g=Dt.IntMap_get(I,C,null);return g==null&&(g=[],I.set(C,g)),g}A._createHandlers=E;function v(){return new Map}A._new=v})(Bt||(Bt={}));var sv;(e=>{function r(){return new Map}e._new=r})(sv||(sv={}));var Cp;(t=>{function r(n){return Ge.StringMap_get(t._triggerDeviceMap,n,"UNKNOWN_CONTROLLER")}t.stringToTriggerDevice=r,t._triggerDeviceMap=new Map([["KEYBOARD","KEYBOARD"],["UNKNOWN_CONTROLLER","UNKNOWN_CONTROLLER"],["XBOX_ONE","XBOX_ONE"],["PS4","PS4"],["SWITCH_PRO","SWITCH_PRO"]])})(Cp||(Cp={}));var Fl;(t=>{function r(n,o,i,a){return Dt.IntMap_get(n,o<<8|i,a)}t.KeyShortcutMap_get=r;function e(n,o,i,a){n.set(o<<8|i,a)}t.KeyShortcutMap_set=e})(Fl||(Fl={}));var Ha;(s=>{function r(l){return l==1||l==2||l==3}s.ViewerEventType_isWindowEventType=r;function e(l){return l==4||l==5||l==6||l==7||l==8||l==9||l==10}s.ViewerEventType_isMouseEventType=e;function t(l){return l==11||l==12||l==13}s.ViewerEventType_isTouchEventType=t;function n(l){return l==14||l==15}s.ViewerEventType_isKeyEventType=n;function o(l){return l==11||l==13||l==5||l==7||l==8||l==9}s.ViewerEventType_isTypeToBeBlockedByDeviceFrame=o;function i(l){return Ge.StringMap_get(s.ViewerEventType__eventTypeFromString,l,0)}s.ViewerEventType_fromString=i,s.ViewerEventType__eventTypeFromString=new Map([["NONE",0],["WINDOW_VISIBILITY",1],["WINDOW_RESIZE",2],["WINDOW_FRAME",3],["MOUSE_MOVE",4],["MOUSE_PRESS",5],["MOUSE_DRAG",6],["MOUSE_RELEASE",7],["MOUSE_SCROLL",8],["MOUSE_DROP",9],["MOUSE_LEAVE",10],["TOUCH_PRESS",11],["TOUCH_DRAG",12],["TOUCH_RELEASE",13],["KEY_PRESS",14],["KEY_RELEASE",15],["GAMEPAD_DOWN",16]])})(Ha||(Ha={}));var cd;(t=>{function r(n){return n>=105&&n<=108}t.Key_isModifier=r;function e(n){return Dt.IntMap_get(RF,n,[0])}t.Key_keyToKeyCode=e})(cd||(cd={}));var ks;(e=>{function r(){return Pt.current()==4?2:8}e.Modifiers_currentPlatformModifier=r})(ks||(ks={}));function yF(r){let e=new Map;return Dt.IntMap_each(r,(t,n)=>{let o=n;if(e.has(o)){e.get(o).push(t);return}e.set(o,[t])}),e}var Ef=new Map([[8,1],[9,2],[10,3],[13,3],[16,107],[17,108],[18,105],[19,5],[20,6],[27,7],[32,8],[33,9],[34,10],[35,11],[36,12],[37,13],[38,14],[39,15],[40,16],[44,17],[45,18],[46,19],[48,20],[49,21],[50,22],[51,23],[52,24],[53,25],[54,26],[55,27],[56,28],[57,29],[59,90],[61,93],[63,30],[65,31],[66,32],[67,33],[68,34],[69,35],[70,36],[71,37],[72,38],[73,39],[74,40],[75,41],[76,42],[77,43],[78,44],[79,45],[80,46],[81,47],[82,48],[83,49],[84,50],[85,51],[86,52],[87,53],[88,54],[89,55],[90,56],[91,106],[92,106],[93,57],[96,58],[97,59],[98,60],[99,61],[100,62],[101,63],[102,64],[103,65],[104,66],[105,67],[106,68],[107,69],[109,70],[110,71],[111,72],[112,76],[113,77],[114,78],[115,79],[116,80],[117,81],[118,82],[119,83],[120,84],[121,85],[122,86],[123,87],[144,88],[145,89],[173,91],[186,90],[187,93],[188,94],[189,91],[190,95],[191,96],[192,104],[219,99],[220,100],[221,101],[222,98],[224,106]]),RF=yF(Ef);function vF(){let r=new Map,e=window.location.search;if(e.length==0)return r;e=e.slice(1);for(let t of e.split("&")){let n=t.split("=");n.length==2&&r.set(n[0],n[1])}return r}function ho(){if(!lv){lv=!0;let r=vF(),e=Ge.StringMap_get(r,"force-dpr",null);if(e!=null){let t=+parseFloat(e);isNaN(t)||(If=new ce(sr.Math_clamp(t,.1,4)))}}return If!=null?If.value:window.devicePixelRatio}var lv=!1,If=null;var Pp=(n=>(n[n.NONE=0]="NONE",n[n.POINTER=1]="POINTER",n[n.TOUCH=2]="TOUCH",n))(Pp||{}),Ii=class Ii{parent(){return this._parent}window(){return this._window}children(){return this._children}events(){return this._events}focus(){this._window.setFocusedView(this)}absoluteBounds(){if(this._cachedAbsoluteBounds!=null)return this._cachedAbsoluteBounds;let e=null;if(this.parent()!=null)e=this.parent().absoluteBounds();else if(this==this.window().root())e=new G(0,0,this.window().width(),this.window().height());else return null;let t=e.width()|0,n=e.height()|0,o=this._minX+(this._alignX==2?t:0),i=this._maxX+(this._alignX!=0?t:0),a=this._minY+(this._alignY==2?n:0),s=this._maxY+(this._alignY!=0?n:0);return this._cachedAbsoluteBounds=new G(e.x()+o,e.y()+a,Math.max(0,i-o),Math.max(0,s-a)),e}viewFromPoint(e){let t=this.children().length;for(let n=0,o=t;n<o;n=n+1){let i=this.children()[t-n-1];if(i.absoluteBounds().contains2(e))return i.viewFromPoint(e)}return this}invalidateBounds(){this.forSelfAndDescendents(e=>{e._cachedAbsoluteBounds=null})}isEqualToOrParentOf(e){for(;e!=null;){if(e==this)return!0;e=e.parent()}return!1}selfAndParents(){let e=[];for(let t=this;t!=null;t=t.parent())e.push(t);return e}selfAndChildren(){let e=[],t=[this];for(;t.length!=0;){let n=t.pop(),o=n.children().length;e.push(n);for(let i=0,a=o;i<a;i=i+1)t.push(n.children()[o-i-1])}return e}setLayout(e,t,n,o,i,a){(this._alignX!=e||this._minX!=t||this._maxX!=n||this._alignY!=o||this._minY!=i||this._maxY!=a)&&(this._alignX=e,this._minX=t,this._maxX=n,this._alignY=o,this._minY=i,this._maxY=a,this._handleLayoutChange(),this.invalidateBounds())}setParent(e){if(e==this._parent)return;this._parent!=null&&ne.List_removeOne(this._parent.children(),this),e!=null&&e.children().push(this),this._handleParentChange(this._parent,e),this._parent=e,this.invalidateBounds();let t=e==null?void 0:e._window;this._window!=t&&this.forSelfAndDescendents(n=>{n._window=t})}forSelfAndDescendents(e){e(this);for(let t of this.children())t.forSelfAndDescendents(e)}setCursor(e){Ii._appendCursorStyleIfNecessary(),e!=this._cursor&&(this._element.classList.remove(Ii._cssCursorClassName(this._cursor)),this._cursor=e,this._element.classList.add(Ii._cssCursorClassName(this._cursor)))}cursor(){return this._cursor}element(){return this._element==null&&(this._element=document.createElement("div"),this._element.style.position="absolute",this._handleLayoutChange()),this._element}becomeRoot(e){this._window=e}_handleParentChange(e,t){t!=null&&t._element!=null?t._element.appendChild(this.element()):e._element!=null&&e._element.removeChild(this.element())}_handleLayoutChange(){if(this._element!=null){let e=this._element.style;e.left=this._alignX==2?"auto":this._minX.toString()+"px",e.top=this._alignY==2?"auto":this._minY.toString()+"px",e.right=this._alignX==0?"auto":this._maxX.toString()+"px",e.bottom=this._alignY==0?"auto":this._maxY.toString()+"px",e.width=this._alignX==1?"auto":(this._maxX-this._minX).toString()+"px",e.height=this._alignY==1?"auto":(this._maxY-this._minY).toString()+"px"}}static _appendCursorStyleIfNecessary(){if(Ii._cursorStyle!=null)return;let e=(c,p,u,_)=>`
      cursor: url("${u}"), auto; /* Edge, IE */
      cursor: url("${c}") 30 30, pointer; /* Legacy */
      cursor: url("${_}") 30 30, pointer; /* FF */
      cursor: -webkit-image-set(url("${c}") 1x, url("${p}") 2x) 30 30, pointer; /* Webkit */
      `,t="/images/viewer/cursor-touch.png",n="/images/viewer/cursor-touch.cur",o="/images/viewer/cursor-touch@2x.png",i="/images/viewer/cursor-touch.svg",a="/images/viewer/cursor-touch-down.png",s="/images/viewer/cursor-touch-down.cur",l="/images/viewer/cursor-touch-down@2x.png",d="/images/viewer/cursor-touch-down.svg";Ii._cursorStyle=document.createElement("style"),Ii._cursorStyle.nonce=mn().INITIAL_OPTIONS.csp_nonce,Ii._cursorStyle.textContent=`
    .cursor-default {
      cursor: default;
    }

    .cursor-pointer {
      cursor: pointer;
    }

    .cursor-touch {
      ${e(t,o,n,i)}
    }

    .cursor-touch:active {
      ${e(a,l,s,d)}
    }

    /*
      We provide a mechanism for the app outside of the viewer to disable all
      viewer cursors. This is useful e.g. in comments mode where the containing
      react application is responsible for setting the cursor instead of code
      inside the viewer library. To use this, the containing application would
      add the viewer-cursors-disabled class to the HTMLElement that hosts the
      viewer canvas.
    */

    .viewer-cursors-disabled .cursor-default {
      cursor: inherit;
    }

    .viewer-cursors-disabled .cursor-pointer {
      cursor: inherit;
    }

    .viewer-cursors-disabled .cursor-touch {
      cursor: inherit;
    }

    .viewer-cursors-disabled .cursor-touch:active {
      cursor: inherit;
    }
`,document.head.appendChild(Ii._cursorStyle)}static _cssCursorClassName(e){switch(e){case 0:return"cursor-default";case 1:return"cursor-pointer";case 2:return"cursor-touch"}return null}constructor(){this._parent=null,this._window=null,this._children=[],this._events=Bt._new(),this._alignX=1,this._minX=0,this._maxX=0,this._alignY=1,this._minY=0,this._maxY=0,this._cachedAbsoluteBounds=null,this._element=null,this._cursor=0}};Ii._cursorStyle=null;var dd=Ii,yf=class{name(){return this._file.name}mimeType(){return this._file.type}bytes(){return this._promise==null&&(this._promise=new Promise((e,t)=>{let n=new FileReader;n.onload=()=>{e(new Uint8Array(Xu.FileReader_resultAsArrayBuffer(n)))},n.onloadend=()=>{t(bs.VOID)},n.readAsArrayBuffer(this._file)})),this._promise}constructor(e){this._file=e,this._promise=null}},bp=class{constructor(e,t,n,o,i){this._root=null,this._width=0,this._height=0,this._devicePixelRatio=0,this._eventHandlersBefore=Bt._new(),this._eventHandlersAfter=Bt._new(),this._isInlinePreviewCallback=i,this._disableKeyboardHandlingCallback=o,this._events=Bt._new(),this._recordInteractionCallback=null,this._isActive=!0,this._focusedView=null,this._containerElement=null,this._disableOwnOnFrameCallback=!1,this._internalOnFrameID=0,this.forceFrame=null,this.internalOnFrame=null,this._containerElement=e,this._disableOwnOnFrameCallback=n,this._root=new dd,this._root.becomeRoot(this);let a=null,s=null,l=null,d=null,c=null,p=null,u=document,_=window,h=this.root().element(),S=F=>{oi.Event_preventDefault(F)},m=(F,w)=>{qt.EventTarget_removeEventListener3(F,"mousemove",s),qt.EventTarget_removeEventListener3(F,"mouseup",l),qt.EventTarget_removeEventListener5(F,"touchmove",c),qt.EventTarget_removeEventListener5(F,"touchend",p),qt.EventTarget_addEventListener4(w,"mousemove",s),qt.EventTarget_addEventListener4(w,"mouseup",l),qt.EventTarget_addEventListener6(w,"touchmove",c),qt.EventTarget_addEventListener6(w,"touchend",p)};this.forceFrame=()=>{this._resize(),Bt.trigger(this.events(),new Ei(3,this.root(),0))},this.internalOnFrame=()=>{this._resize();try{Bt.trigger(this.events(),new Ei(3,this.root(),0))}catch(F){Oe(F)}this._disableOwnOnFrameCallback||(this._internalOnFrameID=requestAnimationFrame(this.internalOnFrame))};let f=()=>{this._isActive=!u.hidden,Bt.trigger(this.events(),new Ei(1,this.root(),0)),m(u,h)},T=F=>{let w=(F.altKey?1:0)|(F.metaKey?2:0)|(F.shiftKey?4:0)|(F.ctrlKey?8:0);return ks.Modifiers_currentPlatformModifier()&w?w|16:w},y=(F,w)=>{for(let V=this.root().element();V!=null;V=V.offsetParent)F=F-V.offsetLeft,w=w-V.offsetTop;return new b(F,w)},E=0,v=0,A=0,I=0,C=F=>{let w=0,V=Is.Performance_now(_.performance);return w=1,I!=0&&V-I<500&&Math.abs(F.pageX-E)<4&&Math.abs(F.pageY-v)<4&&(w=A+1),E=F.pageX,v=F.pageY,A=w,I=V,w},g=null,R=null,D=!1,P=(F,w,V,k)=>{let H=y(F.pageX,F.pageY),z=R??this.root().viewFromPoint(H),Q=new Gs(w==4&&D?6:w,z,T(F),H,g??H,V,w==5?C(F):0,k);g=H,this.notify(Q),Q.isAccepted()&&(Q.type()==5&&F.button==0||oi.Event_preventDefault(F),w==5&&(R=z)),w==5?D=!0:w==7&&(R=null,D=!1)},U=new Map,B=(F,w)=>{let V=new Map,k=[];Array.from(U.values()).forEach(z=>{ne.List_appendOne(k,z.originalTarget)});let H=ju.TouchEvent_touches(F).map(z=>{let Q=z.identifier,K=y(z.pageX,z.pageY),j=Dt.IntMap_get(U,Q,null),pe=j!=null?j.originalTarget:this.root().viewFromPoint(K),Pe=new Pl(Q,pe,K,j!=null?j.locationInWindow:K);return V.set(Q,Pe),ne.List_appendOne(k,pe),Pe});U=V;for(let z of k){let Q=new Us(w,z,T(F),H.filter(K=>K.originalTarget==z),H);this.notify(Q),Q.isAccepted()&&oi.Event_preventDefault(F)}},M=(F,w)=>{if(this._disableKeyboardHandlingCallback())return;let V=Dt.IntMap_get(Ef,F.which,0),k=T(F),H=(ks.Modifiers_currentPlatformModifier()&k)!=0&&(V==91||V==93||V==20),z=this.focusedView();H&&oi.Event_preventDefault(F);let Q=K=>{for(;K!==u;){if(K.className.split(" ").indexOf("viewer-forward-keyevents")!=-1)return!0;K=K.parentNode}return!1};if((H||u.activeElement==null||u.activeElement==u.body||Q(u.activeElement))&&V!=0&&z!=null){let K=new Vs(w,z,k,V,!1);this.notify(K),(K.isAccepted()||V==1)&&(oi.Event_preventDefault(F),F.stopPropagation())}};if(a=F=>{m(h,u),P(F,5,null,null),window.focus(),document.activeElement!=null&&document.activeElement.blur()},s=F=>{P(F,4,null,null)},l=F=>{m(u,h),P(F,7,null,null)},d=F=>{B(F,11)},c=F=>{B(F,12)},p=F=>{B(F,13)},qt.EventTarget_addEventListener3(u,"keydown",F=>{M(F,14)}),qt.EventTarget_addEventListener3(u,"keyup",F=>{M(F,15)}),qt.EventTarget_addEventListener7(h,"wheel",F=>{let w=F.deltaMode,V=w==F.DOM_DELTA_LINE?10:w==F.DOM_DELTA_PAGE?100:1;P(F,8,new b(F.deltaX*V,F.deltaY*V),null)}),qt.EventTarget_addEventListener14(u,"wheel",F=>{F.ctrlKey&&oi.Event_preventDefault(F)},{passive:!1}),qt.EventTarget_addEventListener5(u,"drop",F=>{oi.Event_preventDefault(F),P(F,9,null,Ju.DataTransfer_files(F.dataTransfer).map(w=>new yf(w)))}),qt.EventTarget_addEventListener4(u,"mouseenter",F=>{g=null}),qt.EventTarget_addEventListener4(h,"mouseleave",F=>{P(F,10,null,null)}),t!=null){let F=t;F.onPress(w=>{let V=new Op(16,this.root(),0,w.buttons[0],Cp.stringToTriggerDevice(w.controllerType));this.notifyAll(V)}),F.start()}qt.EventTarget_addEventListener1(_,"resize",()=>{this._resize()}),qt.EventTarget_addEventListener1(_,"visibilitychange",f),qt.EventTarget_addEventListener2(h,"contextmenu",S),qt.EventTarget_addEventListener4(h,"mousedown",a),qt.EventTarget_addEventListener6(h,"touchstart",d),qt.EventTarget_addEventListener2(u,"dragenter",S),qt.EventTarget_addEventListener2(u,"dragover",S),this._containerElement!=null&&this._containerElement.appendChild(h),this._focusedView=this.root(),f(),this._resize(),this._disableOwnOnFrameCallback||(this._internalOnFrameID=requestAnimationFrame(this.internalOnFrame))}root(){return this._root}width(){return this._width}height(){return this._height}size(){return new b(this._width,this._height)}isActive(){return this._isActive}focusedView(){return this._focusedView}devicePixelRatio(){return this._devicePixelRatio}eventsBefore(){return this._eventHandlersBefore}eventsAfter(){return this._eventHandlersAfter}events(){return this._events}setRecordInteractionCallback(e){this._recordInteractionCallback=e}stopRecordingInteractions(){this._recordInteractionCallback=null}maybeRecordInteraction(e){this._recordInteractionCallback!=null&&this._recordInteractionCallback(e)}notify(e){this.maybeRecordInteraction(e);let t=e.target().selfAndParents();if(Bt.trigger(this._eventHandlersBefore,e),!e.isAccepted()){for(let n of t)if(Bt.trigger(n.events(),e),e.isAccepted())return;Bt.trigger(this._eventHandlersAfter,e)}}notifyAll(e){let t=e.target().selfAndChildren();if(Bt.trigger(this._eventHandlersBefore,e),!e.isAccepted()){for(let n of t)if(Bt.trigger(n.events(),e),e.isAccepted())return;Bt.trigger(this._eventHandlersAfter,e)}}dangerouslyDisableOnFrameCallbackForTesting(){this._disableOwnOnFrameCallback=!0}_resize(){if(this._containerElement==null)return;let e=document.body,t=this._isInlinePreviewCallback()?this._containerElement.getBoundingClientRect().width:this._containerElement==e?window.innerWidth:this._containerElement.clientWidth,n=this._isInlinePreviewCallback()?this._containerElement.getBoundingClientRect().height:this._containerElement==e?window.innerHeight:this._containerElement.clientHeight,o=ho();(this._width!=t||this._height!=n||this._devicePixelRatio!=o)&&(this._width=t,this._height=n,this._devicePixelRatio=o,this.root().invalidateBounds(),this.notifyAll(new Ei(2,this.root(),0)))}setFocusedView(e){this._focusedView=e}createDiv(){return document.createElement("div")}setNewContainerElement(e){if(e==null)throw new Error("Can't mount the viewer in a null DOM node");this._containerElement=e,e.appendChild(this.root().element()),this._resize(),this._internalOnFrameID!=0&&cancelAnimationFrame(this._internalOnFrameID),this._disableOwnOnFrameCallback||(this._internalOnFrameID=requestAnimationFrame(this.internalOnFrame))}resetStateForTests(){this._width=0,this._height=0,this._devicePixelRatio=0}};var cv;(t=>{function r(){return[]}t.new1=r;function e(n){return n.slice()}t.new2=e})(cv||(cv={}));var Mt;(T=>{function r(y){return y.length}T.FrozenList_count=r;function e(y){return y.length==0}T.FrozenList_isEmpty=e;function t(y,E){return y[E]}T.FrozenList_get=t;function n(y){return ne.List_last(y)}T.FrozenList_last=n;function o(y,E){return y.some(E)}T.FrozenList_any=o;function i(y,E){return y.filter(E)}T.FrozenList_filter=i;function a(y,E){y.forEach(E)}T.FrozenList_each=a;function s(y){return y[0]}T.FrozenList_first=s;function l(y,E){return y.map(E)}T.FrozenList_map=l;function d(y){return y.slice()}T.FrozenList_clone=d;function c(y,E,v){return y.slice(E,v)}T.FrozenList_slice=c;function p(y,E){let v=y.slice();return ne.List_appendOne(v,E),v}T.FrozenList_cloneAndAppendOne=p;function u(y,E){let v=y.slice();return ne.List_removeOne(v,E),v}T.FrozenList_cloneAndRemoveOne=u;function _(y,E,v){return ne.List_equalsWithComparison(y,E,v)}T.FrozenList_equals=_;function h(y,E){return y.indexOf(E)!=-1}T._in=h;function S(y,E){for(let v of y)if(E(v))return!0;return!1}T.FrozenList_contains=S;function m(y,E){let v=y.slice();return v.sort(E),v}T.FrozenList_sorted=m;function f(y,E){let v=y.slice();return v.push(E),v}T.FrozenList_cloneAndAppend=f})(Mt||(Mt={}));var jr=class{add(e){this._observers=Mt.FrozenList_cloneAndAppendOne(this._observers,e)}remove(e){this._observers=Mt.FrozenList_cloneAndRemoveOne(this._observers,e)}forEach(e){let t=this._observers;t.forEach(n=>{(t==this._observers||this._observers.indexOf(n)!=-1)&&e(n)})}constructor(){this._observers=[]}};var nr;(u=>{function r(_,h){return Lo.string_compare(_,h)}u.compare=r;function e(_,h){return _==h}u.equals=e;function t(_){return _}u.toString=t;function n(_){return _.length>0}u.isValid=n;function o(_){let h=_,S=h.length-1,m=S;for(;m>=0;){let f=h.charCodeAt(m);if(f>u.LOWER+1)return h.slice(0,m)+String.fromCharCode(f-1);m=m-1}return h.slice(0,S)+String.fromCharCode(u.LOWER)+String.fromCharCode(u.UPPER)}u.before=o;function i(_){let h=_,S=h.length-1;for(;S>=0;){let m=h.charCodeAt(S);if(m<u.UPPER)return h.slice(0,S)+String.fromCharCode(m+1);S=S-1}return h+String.fromCharCode(u.LOWER+1)}u.after=i;function a(_){if(_==null||_==""||_.charCodeAt(_.length-1)==u.LOWER)return null;for(let h=0,S=_.length;h<S;h=h+1)if(_.charCodeAt(h)<u.LOWER||_.charCodeAt(h)>u.UPPER)return null;return _}u.fromString=a;function s(_,h){let S=_,m=h,f=S.length,T=m.length,y="",E=!1;for(let v=0,A=Math.max(f,T);v<A;v=v+1){let I=v<f?S.charCodeAt(v):u.LOWER,C=v<T&&!E?m.charCodeAt(v):u.UPPER;if(I==C)y+=String.fromCharCode(I);else if(C-I>1){y+=String.fromCharCode(I+C>>1),E=!1;break}else y+=String.fromCharCode(I),E=!0}return E&&(y+=String.fromCharCode(u.LOWER+u.UPPER>>1)),y}u.between=s,u.LOWER=32,u.UPPER=126,u.FIRST_POSITION=String.fromCharCode(u.LOWER+1),u.SECOND_POSITION=String.fromCharCode(u.LOWER+2)})(nr||(nr={}));var Qr=class r{toString(){return`${this.id};${nr.toString(this.position)}`}equals(e){return X.equals(this.id,e.id)&&nr.equals(this.position,e.position)}static fromString(e){let t=e.indexOf(";");if(t==-1)return null;let n=e.slice(0,t);if(n=="-1:-1")return null;let o=X.fromString(n);return new r(o,nr.fromString(e.slice(t+1)))}constructor(e,t){this.id=e,this.position=t}};var Je;(Xt=>{function r(oe){try{if(t(oe))return oe.toString();if(n(oe))return E(oe).toString();if(o(oe))return v(oe).toString();if(a(oe))return oe;if(oe instanceof Array)return oe.length===0?"[]":"toString"in oe[0]?"["+oe.map(vt=>vt.toString()).join(", ")+"]":"[...]";if("toString"in oe)return oe.toString()}catch{}return"?"}Xt.toString=r;function e(oe,vt){return t(oe)&&t(vt)?oe.equals1(vt):s(oe)&&s(vt)?oe.equals(vt):(n(oe)||o(oe)||a(oe)||gl(oe),oe==vt)}Xt.equals=e;function t(oe){return oe instanceof J}Xt.isAffineTransform=t;function n(oe){return typeof oe=="boolean"}Xt.isBool=n;function o(oe){return typeof oe=="number"}Xt.isDouble=o;function i(oe){return oe.guid!==void 0&&oe.ref!==void 0}Xt.isStyleId=i;function a(oe){return typeof oe=="string"}Xt.isString=a;function s(oe){return oe instanceof b}Xt.isVector=s;function l(oe){return oe instanceof Array}Xt.isList=l;function d(oe){return oe instanceof Qr}Xt.isParentIndex=d;function c(oe){return typeof oe=="string"}Xt.isGUID=c;function p(oe){return typeof oe=="string"}Xt.isScrollDirection=p;function u(oe){return typeof oe=="string"}Xt.isPosition=u;function _(oe){return typeof oe=="string"}Xt.isScrollBehavior=_;function h(oe){return typeof oe=="string"}Xt.isNavigationType=h;function S(oe){return typeof oe=="string"}Xt.isOverlayPositionType=S;function m(oe){return typeof oe=="string"}Xt.isOverlayBackgroundInteraction=m;function f(oe){return typeof oe=="string"}Xt.isShapeWithTextType=f;function T(oe){return oe.autoplay!==void 0&&oe.mediaLoop!==void 0&&oe.muted!==void 0&&oe.showControls!==void 0}Xt.isVideoPlayback=T;function y(oe){return oe}Xt.asAffineTransform=y;function E(oe){return!!oe}Xt.asBool=E;function v(oe){return+oe}Xt.asDouble=v;function A(oe){return oe}Xt.asStyleId=A;function I(oe){return oe}Xt.asInt=I;function C(oe){return oe}Xt.asString=C;function g(oe,vt){return a(oe)?oe:vt}Xt.asStringEnum=g;function R(oe){return oe}Xt.asVector=R;function D(oe){return oe}Xt.asPaintList=D;function P(oe){return oe}Xt.asPaintData=P;function U(oe){return oe}Xt.asEffectList=U;function B(oe){return oe}Xt.asExportSettingsList=B;function M(oe){return oe}Xt.asParentIndex=M;function F(oe){return oe}Xt.asGUID=F;function w(oe){return oe}Xt.asScrollDirection=w;function V(oe){return oe}Xt.asPosition=V;function k(oe){return oe}Xt.asScrollBehavior=k;function H(oe){return oe}Xt.asNavigationType=H;function z(oe){return oe}Xt.asOverlayPositionType=z;function Q(oe){return oe}Xt.asOverlayBackgroundInteraction=Q;function K(oe){return oe}Xt.asArcData=K;function j(oe){return oe}Xt.asShapeWithTextType=j;function pe(oe){return oe}Xt.asVideoPlayback=pe,Xt.ZERO_VECTOR=fe.FrozenVector_new1(),Xt.IDENTITY_TRANSFORM=yt.FrozenAffineTransform_new1(),Xt.EMPTY_PAINT_LIST=[],Xt.EMPTY_EFFECT_LIST=[],Xt.DEFAULT_ARC_DATA={startingAngle:0,endingAngle:2*Math.PI,innerRadius:0}})(Je||(Je={}));var Kt=class r{static getEventEmitter(){return r._eventEmitter||(r._eventEmitter=new r),r._eventEmitter}on(e,t){ne.List_appendOne(this._list(e),t)}off(e,t){ne.List_removeOne(this._list(e),t)}trigger(e,t){let n=this._list(e).slice();for(let o of n)o(t)}constructor(){this._callbacks=new Map}_list(e){return this._callbacks.has(e)?this._callbacks.get(e):(this._callbacks.set(e,[]),this._callbacks.get(e))}};(t=>{class r{constructor(){this._emitter=t.getEventEmitter()}handleAction(o,i){switch(o){case 5:{this._emitter.trigger("mirrorTap");break}case 6:{this._emitter.trigger("canvasMouseDown",Je.asVector(i).toJSON());break}case 7:{this._emitter.trigger("canvasMouseMove",Je.asVector(i).toJSON());break}case 8:{this._emitter.trigger("canvasMouseDrag",Je.asVector(i).toJSON());break}case 9:{this._emitter.trigger("canvasMouseUp",Je.asVector(i).toJSON());break}case 10:{this._emitter.trigger("canvasTouchDown",Je.asVector(i).toJSON());break}}}}t.ActionHandler=r;class e{constructor(o){this._emitter=t.getEventEmitter();this._state=o,this._visible=!1}onFrame(){let o=this._state.baseScreenNode()!=null;this._visible!=o&&(this._visible=o,this._emitter.trigger("baseScreenVisibilityChange",this._visible))}}t.AppHandler=e})(Kt||(Kt={}));var Dn=class r{add(e){this._hash.set(e,!0)}_in(e){return this._hash.has(e)}remove(e){this._hash.delete(e)}count(){return this._hash.size}asList(){return Array.from(this._hash.keys())}each(e){Array.from(this._hash.keys()).forEach(e)}map(e){return Array.from(this._hash.keys()).map(e)}equals(e){if(e==null||this.count()!=e.count())return!1;for(let t of Array.from(this._hash.keys()))if(!e._in(t))return!1;return!0}static fromList(e){let t=new r;for(let n of e)t.add(n);return t}constructor(){this._hash=new Map}};var on=class on{count(){return this._heap.length}peek(){if(this.count()==0)throw new Error("Peeking on an empty queue");return this._heap[on.ROOT_INDEX].value}insertOrUpdate(e,t){if(this._indexByElement.has(e)){this.remove(e),this.insertOrUpdate(e,t);return}let n=new on.Element(e,t);this._heap.push(n),this._indexByElement.set(n.value,this.count()-1),this._siftUp(this.count()-1)}getPriority(e){if(!this._indexByElement.has(e))return null;let t=this._indexByElement.get(e),n=this._heap[t];return new ce(n.priority)}remove(e){if(!this._indexByElement.has(e))return;let t=this._indexByElement.get(e),n=this.count()-1;n>t&&this._swap(t,n);let o=this._heap.pop();this._indexByElement.delete(o.value),t!=n&&(this._siftDown(t),this._siftUp(t))}allValues(){return this._heap.map(e=>e.value)}maxPriority(){if(this.count()==0)throw new Error("Calling maxPriority on an empty queue");return this._heap[on.ROOT_INDEX].priority}pop(){if(this.count()==0)throw new Error("Popping an empty queue");let e=this.peek();return this.remove(e),e}_isGreater(e,t){return this._compare(this._heap[e].priority,this._heap[t].priority)>0}_swap(e,t){let n=this._heap[e];this._heap[e]=this._heap[t],this._heap[t]=n,this._indexByElement.set(this._heap[e].value,e),this._indexByElement.set(this._heap[t].value,t)}_siftUp(e){let t=e;for(;t>on.ROOT_INDEX&&this._isGreater(t,on.indexOfParent(t));)this._swap(t,on.indexOfParent(t)),t=on.indexOfParent(t)}_siftDown(e){let t=e;for(;on.indexOfLeftChild(t)<this.count()&&this._isGreater(on.indexOfLeftChild(t),t)||on.indexOfRightChild(t)<this.count()&&this._isGreater(on.indexOfRightChild(t),t);){let n=on.indexOfRightChild(t)<this.count()&&this._isGreater(on.indexOfRightChild(t),on.indexOfLeftChild(t))?on.indexOfRightChild(t):on.indexOfLeftChild(t);this._swap(t,n),t=n}}static indexOfParent(e){return((e+1)/2|0)-1}static indexOfLeftChild(e){return e*2+1}static indexOfRightChild(e){return(e+1)*2}constructor(e){this._heap=[],this._indexByElement=new Map,this._compare=e}};on.ROOT_INDEX=0;var fa=on;(e=>{class r{constructor(n,o){this.value=n,this.priority=o}}e.Element=r})(fa||(fa={}));var to=class r{recomposed(){let e=J.new2();e.setM00(this.m00),e.setM01(this.m01),e.setM10(this.m10),e.setM11(this.m11),e.setM02(this.translation.x()),e.setM12(this.translation.y());let t=Math.PI/180*this.angleDegrees,n=Math.cos(t),o=Math.sin(t),i=J.new2();return i.setM00(n),i.setM01(-o),i.setM10(o),i.setM11(n),e.multiply(i),e.setM00(e.m00()*this.scale.x()),e.setM01(e.m01()*this.scale.y()),e.setM10(e.m10()*this.scale.x()),e.setM11(e.m11()*this.scale.y()),e}static from(e){let t=new r,n=e.m00(),o=e.m10(),i=e.m01(),a=e.m11();t.translation=b.new(e.translation()),t.scale=b.new(e.scale1()),n*a-o*i<0&&(n<a?t.scale.setX(-t.scale.x()):t.scale.setY(-t.scale.y())),t.scale.x()!=0&&(n*=1/t.scale.x(),o*=1/t.scale.x()),t.scale.y()!=0&&(i*=1/t.scale.y(),a*=1/t.scale.y());let l=Math.atan2(o,n);if(l!=0){let d=-o,c=n,p=n,u=o,_=i,h=a;n=c*p+d*_,o=c*u+d*h,i=-d*p+c*_,a=-d*u+c*h}return t.angleDegrees=180/Math.PI*l,t.m00=n,t.m10=o,t.m01=i,t.m11=a,t}static lerp1(e,t,n){let o=r.from(e),i=r.from(t);return r.lerp2(o,i,n).recomposed()}static lerp2(e,t,n){(e.scale.x()<0&&t.scale.y()<0||e.scale.y()<0&&t.scale.x()<0)&&(e.scale.setX(-e.scale.x()),e.scale.setY(-e.scale.y()),e.angleDegrees+=e.angleDegrees<0?180:-180),e.angleDegrees==0&&(e.angleDegrees=360),t.angleDegrees==0&&(t.angleDegrees=360),Math.abs(e.angleDegrees-t.angleDegrees)>180&&(e.angleDegrees>t.angleDegrees?e.angleDegrees-=360:t.angleDegrees-=360);let o=new r;return o.translation=e.translation.multiplyScalar(1-n).add(t.translation.multiplyScalar(n)),o.scale=e.scale.multiplyScalar(1-n).add(t.scale.multiplyScalar(n)),o.angleDegrees=e.angleDegrees*(1-n)+t.angleDegrees*n,o.m00=e.m00*(1-n)+t.m00*n,o.m10=e.m10*(1-n)+t.m10*n,o.m01=e.m01*(1-n)+t.m01*n,o.m11=e.m11*(1-n)+t.m11*n,o}constructor(){this.translation=b.new(),this.scale=b.new(),this.angleDegrees=0,this.m00=0,this.m01=0,this.m10=0,this.m11=0}};var zs;(t=>{function r(n){return n=="GRADIENT_LINEAR"||n=="GRADIENT_RADIAL"||n=="GRADIENT_ANGULAR"||n=="GRADIENT_DIAMOND"}t.isGradient=r;function e(n){return n=="GRADIENT_ANGULAR"}t.shouldWrap=e})(zs||(zs={}));var je=class{constructor(e,t){this.color=e,this.position=t}};je.COMPARE=(e,t)=>kt.double_compare(e.position,t.position),je.EQUALS=(e,t)=>e.color==t.color&&e.position==t.position;var pd=class pd{id(){return this._id}asSinglePaint(){return null}asVolatilePaint(){return null}debugString(){return""}isGradient(){switch(this.type()){case"GRADIENT_ANGULAR":case"GRADIENT_DIAMOND":case"GRADIENT_LINEAR":case"GRADIENT_RADIAL":return!0}return!1}constructor(){this._id=pd._previousID=pd._previousID+1}};pd._previousID=0;var Fp=pd,mo=class mo extends Fp{constructor(e){super(),this._type=null,this._color=O.TRANSPARENT,this._opacity=1,this._isEnabled=!0,this._colorStops=null,this._blendMode="NORMAL",this._image=null,this._imageThumbnail=null,this._video=null,this._videoPlaybackParams="",this._transform=yt.FrozenAffineTransform_IDENTITY,this._rotationDeg=0,this._scalingFactor=1,this._imageScaleMode="STRETCH",this._filterColorAdjust=null,this._originalImageWidth=0,this._originalImageHeight=0,this._decodedImageIsReady=!1,this._decodedImageThumbnailIsReady=!1,this._type=e}type(){return this._type}color(){return this._color}opacity(){return this._opacity}isEnabled(){return this._isEnabled}isVolatile(){return!1}isVisible(){return this._isEnabled&&this._opacity>0}blendMode(){return this._blendMode}transform(){return this._transform}setIsEnabled(e){this._isEnabled=e}debugString(){return`SinglePaint color=${O.toString(this._color)}[${O.toCSS(this._color)}] type=${this._type} blend=${this._blendMode} opacity=${this._opacity}${this._isEnabled?"":" [hidden]"}`}image(){return this._image}imageThumbnail(){return this._imageThumbnail}video(){return this._video}imageScaleMode(){return this._imageScaleMode}rotationDeg(){return this._rotationDeg}scalingFactor(){return this._scalingFactor}filterColorAdjust(){return this._filterColorAdjust}decodedImageIsReady(){return this._decodedImageIsReady}decodedImageThumbnailIsReady(){return this._decodedImageThumbnailIsReady}colorStops(){return this._colorStops}lastStopIsTransparent(){return this._colorStops.length!=0&&O.alpha(ne.List_last(this._colorStops).color)==0}isImageAvailable(){return this._image!=null&&this._image.isDecoded()}isImageThumbnailAvailable(){return this._image!=null&&this._image.isDecoded()}setType(e){this._type=e}setColor(e){this._color=e}setBlendMode(e){this._blendMode=e}setImage(e){this._image=e}setImageThumbnail(e){this._imageThumbnail=e}setVideo(e){this._video!=null&&e==null&&console.log(new Error().stack),this._video=e}videoPlaybackParams(e){this._videoPlaybackParams=e}setTransform(e){this._transform=e}setTransform1(e){this._transform=e.clone()}setImageScaleMode(e){this._imageScaleMode=e}setRotationDeg(e){this._rotationDeg=e}setScalingFactor(e){this._scalingFactor=e}setFilterColorAdjust(e){this._filterColorAdjust=e}setDecodedImageIsReady(e){this._decodedImageIsReady=e}setDecodedImageThumbnailIsReady(e){this._decodedImageThumbnailIsReady=e}setColorStops(e){this._colorStops=e}setColorStops1(e){this._colorStops=e.slice()}setOpacity(e){this._opacity=e}setOriginalImageWidth(e){this._originalImageWidth=e}setOriginalImageHeight(e){this._originalImageHeight=e}allocateBoundsToImageRatio(e,t){let n=b.new(e);return this._rotationDeg!=0&&(J.new2().rotatedBy(this._rotationDeg*(Math.PI/180)).transformPoint(t),t.makeAbs()),n.divideUpdate1(t),n}allocateImageSize(){let e=this._video!=null&&this._video.didLoad(this),t=this._image!=null&&this._image.isDecoded(),n=this._imageThumbnail!=null&&this._imageThumbnail.isDecoded();return e?this._video.size(this):t?new b(this._image.width(),this._image.height()):n?this._originalImageWidth!=0&&this._originalImageHeight!=0?new b(this._originalImageWidth,this._originalImageHeight):new b(this._imageThumbnail.width(),this._imageThumbnail.height()):null}allocateImageTransformForGeometrySize(e){let t=this._rotationDeg*(Math.PI/180),n=J.new2(),o=this.allocateImageSize();o==null&&Oe("Trying to render image before it is loaded");let i=this.allocateBoundsToImageRatio(e,o);switch(this.imageScaleMode()){case"FILL":{n=n.translatedBy2(.5,.5).rotatedBy(-t).scaledBy3(i.x()/i.maxComponent(),i.y()/i.maxComponent()).translatedBy2(-.5,-.5);break}case"FIT":{n=n.translatedBy2(.5,.5).rotatedBy(-t).scaledBy3(i.x()/i.minComponent(),i.y()/i.minComponent()).translatedBy2(-.5,-.5);break}case"STRETCH":{n.copyFrom(this.transform());break}case"TILE":{n=n.translatedBy2(.5,.5).rotatedBy(-t).translatedBy2(-.5,-.5).scaledBy2(1/this.scalingFactor()).scaledBy1(i);break}}return n}decodedImage(){return this.image().isDecoded()?this.image():null}decodedImageThumbnail(){return this.imageThumbnail().isDecoded()?this.imageThumbnail():null}scalingFactorForImage(e){return this.image()==null||e==null||e.width()==0||this.image().width()==0?this.scalingFactor():this.scalingFactor()*(this.image().width()/e.width())}colorAdjustIsActive(){return this._filterColorAdjust!=null&&(this._filterColorAdjust.tint!=0||this._filterColorAdjust.vibrance!=0||this._filterColorAdjust.shadows!=0||this._filterColorAdjust.highlights!=0||this._filterColorAdjust.exposure!=0||this._filterColorAdjust.contrast!=0||this._filterColorAdjust.temperature!=0)}colorAdjustSetData(e){let t=Pr.instance();e.setUniformFloat(t.GLSLX_NAME_U_GLOBAL_TINT,this._filterColorAdjust.tint),e.setUniformFloat(t.GLSLX_NAME_U_GLOBAL_COLOR,this._filterColorAdjust.vibrance),e.setUniformFloat(t.GLSLX_NAME_U_GLOBAL_SHADOWS,this._filterColorAdjust.shadows),e.setUniformFloat(t.GLSLX_NAME_U_GLOBAL_HIGHLIGHTS,this._filterColorAdjust.highlights),e.setUniformFloat(t.GLSLX_NAME_U_GLOBAL_EXPOSURE,this._filterColorAdjust.exposure),e.setUniformFloat(t.GLSLX_NAME_U_GLOBAL_CONTRAST,this._filterColorAdjust.contrast),e.setUniformFloat(t.GLSLX_NAME_U_GLOBAL_TEMPERATURE,this._filterColorAdjust.temperature)}isEnabledAndVisible(){if(!this.isEnabled()||this.opacity()<=0)return!1;switch(this.type()){case"SOLID":return O.alpha(this.color())>0;case"GRADIENT_ANGULAR":case"GRADIENT_DIAMOND":case"GRADIENT_LINEAR":case"GRADIENT_RADIAL":{for(let e=0,t=this.colorStops().length;e<t;e=e+1)if(O.alpha(this.colorStops()[e].color)>0)return!0;return!1}}return!0}hasAnyFullyTransparentAreas(){if(!this.isEnabled()||this.opacity()<=0)return!0;switch(this.type()){case"SOLID":return O.alpha(this.color())==0;case"GRADIENT_ANGULAR":case"GRADIENT_DIAMOND":case"GRADIENT_LINEAR":case"GRADIENT_RADIAL":{for(let e=0,t=this.colorStops().length;e<t;e=e+1)if(O.alpha(this.colorStops()[e].color)==0)return!0;return!1}case"EMOJI":case"IMAGE":case"VIDEO":return!0}return!0}hasAnimatingMedia(){return this.image()!=null&&this.image().gif()!=null||this.video()!=null}optimized(){if(this.isGradient()&&this.colorStops().length!=0){let e=this.colorStops()[0].color;for(let t=1,n=this.colorStops().length;t<n;t=t+1)if(e!=this.colorStops()[t].color)return this;return mo.create("SOLID",this.opacity(),this.blendMode(),this.isEnabled(),e)}return this}equals1(e){return e.isVolatile()?!1:this.equals2(e.asSinglePaint())}equals2(e){if(this._colorStops==null||e.colorStops()==null){if(this._colorStops==null!=(e.colorStops()==null))return!1}else if(!Mt.FrozenList_equals(this._colorStops,e.colorStops(),je.EQUALS))return!1;if(this._transform==null||e.transform()==null){if(this._transform==null!=(e.transform()==null))return!1}else if(!this.transform().equals1(e.transform()))return!1;if(this._video==null||e.video()==null){if(this._video==null!=(e.video()==null))return!1}else if(this._video.hash()!=e.video().hash())return!1;if(this._image==null||e.image()==null){if(this._image==null!=(e.image()==null))return!1}else if(this._image.objectHash()!=e.image().objectHash())return!1;if(this._imageThumbnail==null||e.imageThumbnail()==null){if(this._imageThumbnail==null!=(e.imageThumbnail()==null))return!1}else if(this._imageThumbnail.objectHash()!=e.imageThumbnail().objectHash())return!1;return this._type==e.type()&&this._blendMode==e.blendMode()&&this._color==e.color()&&this._isEnabled==e.isEnabled()&&this._opacity==e.opacity()&&this._rotationDeg==e.rotationDeg()&&this._scalingFactor==e.scalingFactor()&&this._imageScaleMode==e.imageScaleMode()&&this._filterColorAdjust==e.filterColorAdjust()&&this._decodedImageIsReady==e.decodedImageIsReady()&&this._decodedImageThumbnailIsReady==e.decodedImageThumbnailIsReady()}clone(){return this.cloneAsSinglePaint()}cloneAsSinglePaint(){let e=new mo(this._type);return e._blendMode=this._blendMode,e._color=this.color(),e._colorStops=this._colorStops,e._image=this._image,e._imageThumbnail=this._imageThumbnail,e._video=this._video,e._isEnabled=this._isEnabled,e._opacity=this._opacity,e._transform=this._transform,e._rotationDeg=this._rotationDeg,e._scalingFactor=this._scalingFactor,e._imageScaleMode=this._imageScaleMode,e._filterColorAdjust=this._filterColorAdjust,e._decodedImageIsReady=this._decodedImageIsReady,e._decodedImageThumbnailIsReady=this._decodedImageThumbnailIsReady,e._originalImageWidth=this._originalImageWidth,e._originalImageHeight=this._originalImageHeight,e}isOpaque(){if(this.opacity()<1||this.blendMode()!="NORMAL")return!1;switch(this.type()){case"SOLID":return O.isOpaque(this._color);case"GRADIENT_LINEAR":case"GRADIENT_RADIAL":case"GRADIENT_ANGULAR":case"GRADIENT_DIAMOND":{for(let e=0,t=this._colorStops.length;e<t;e=e+1){let n=this._colorStops[e];if(!O.isOpaque(n.color))return!1}return!0}case"EMOJI":case"IMAGE":case"VIDEO":return!1}return!1}flattenedStops(){let e=this._colorStops.slice();if(e.sort((t,n)=>kt.double_compare(t.position,n.position)),zs.shouldWrap(this.type())&&e.length>=2){let t=e[0],n=ne.List_last(e);if(t.position>0)if(n.position<1){let o=O.mix(t.color,n.color,t.position/(1-n.position+t.position));e.unshift(new je(o,0)),e.push(new je(o,1))}else e.unshift(new je(n.color,0));else n.position<1&&e.push(new je(t.color,1))}return e}asSinglePaint(){return this}getCanvasSpaceUnclippedImageSize(e){if(!this.isImageAvailable()&&!this.isImageThumbnailAvailable())return fe.FrozenVector_ZERO;let t=this.allocateImageSize(),n=null;switch(this.imageScaleMode()){case"STRETCH":{n=e.divide(this._transform.scale1());break}case"FILL":{let o=this.allocateBoundsToImageRatio(e,t);o.x()>o.y()?n=new b(e.x(),o.x()*this._image.height()):n=new b(o.y()*this._image.width(),e.y());break}case"FIT":{let o=this.allocateBoundsToImageRatio(e,t);o.x()>o.y()?n=new b(o.y()*this._image.width(),e.y()):n=new b(e.x(),o.x()*this._image.height());break}case"TILE":return fe.FrozenVector_ZERO;default:return console.warn(`Unimplemented imageScaleMode ${this.imageScaleMode()} in getCanvasSpaceUnclippedImageSize`),fe.FrozenVector_ZERO}return n}static create(e,t,n,o,i){let a=new mo(e);return a.setOpacity(t),a.setBlendMode(n),a.setIsEnabled(o),a.setColor(i),a}static createSolid(e,t){return mo.create("SOLID",t*O.alphaF(e),"NORMAL",!0,O.withAlpha(e,255))}static createLinearGradient(e){let t=mo.create("GRADIENT_LINEAR",1,"NORMAL",!0,O.BLACK);return t.setColorStops1(e),t}static createRadialGradient(e){let t=mo.create("GRADIENT_RADIAL",1,"NORMAL",!0,O.BLACK);return t.setColorStops1(e),t}static createAngularGradient(e){let t=mo.create("GRADIENT_ANGULAR",1,"NORMAL",!0,O.BLACK);return t.setColorStops1(e),t}static createDiamondGradient(e){let t=mo.create("GRADIENT_DIAMOND",1,"NORMAL",!0,O.BLACK);return t.setColorStops1(e),t}};mo.TRANSPARENT=mo.create("SOLID",0,"NORMAL",!0,O.BLACK),mo.SOLID_BLACK=mo.create("SOLID",1,"NORMAL",!0,O.BLACK);var $=mo,_d=class r extends Fp{constructor(e,t,n,o,i){super(),this._from=null,this._to=null,this._getEasedT=null,this._fromCanvasSpaceNodeSize=null,this._toCanvasSpaceNodeSize=null,this._cachedFromTransform=null,this._cachedToTransform=null,this._cachedFromOffsetFromCenter=null,this._cachedToOffsetFromCenter=null,this._cachedFromImageOnCanvasSize=null,this._cachedToImageOnCanvasSize=null,this._from=e,this._to=t,this._getEasedT=n,this._fromCanvasSpaceNodeSize=o,this._toCanvasSpaceNodeSize=i,this._needsImageDimensionsForInterpolation()&&this._computeCachedImageDimensions()}_needsImageDimensionsForInterpolation(){return this.type()!="IMAGE"&&this.type()!="VIDEO"||!this._from.isImageAvailable()&&!this._from.isImageThumbnailAvailable()||!this._to.isImageAvailable()&&!this._to.isImageThumbnailAvailable()?!1:this._from.imageScaleMode()!="TILE"&&this._to.imageScaleMode()!="TILE"&&(this._from.imageScaleMode()=="STRETCH"||this._to.imageScaleMode()=="STRETCH"||this._from.imageScaleMode()!=this._to.imageScaleMode())}_computeCachedImageDimensions(){this.from().imageScaleMode()!="STRETCH"?(this._cachedFromTransform=this._from.allocateImageTransformForGeometrySize(this._fromCanvasSpaceNodeSize),this._cachedFromOffsetFromCenter=new b(0,0)):(this._cachedFromTransform=this.from().transform(),this._cachedFromOffsetFromCenter=new b(.5,.5).subtract(this._cachedFromTransform.scale1().divideScalar(2).add(this._cachedFromTransform.translation()))),this.to().imageScaleMode()!="STRETCH"?(this._cachedToTransform=this._to.allocateImageTransformForGeometrySize(this._toCanvasSpaceNodeSize),this._cachedToOffsetFromCenter=new b(0,0)):(this._cachedToTransform=this.to().transform(),this._cachedToOffsetFromCenter=new b(.5,.5).subtract(this._cachedToTransform.scale1().divideScalar(2).add(this._cachedToTransform.translation()))),this._cachedFromImageOnCanvasSize=this.from().getCanvasSpaceUnclippedImageSize(this._fromCanvasSpaceNodeSize),this._cachedToImageOnCanvasSize=this.to().getCanvasSpaceUnclippedImageSize(this._toCanvasSpaceNodeSize)}isEnabled(){return this._from.isEnabled()||this._to.isEnabled()}isVisible(){return this.isEnabled()&&(this._from.opacity()>0||this._to.opacity()>0)}isVolatile(){return!0}type(){return this._from.type()}blendMode(){return this._from.blendMode()}setIsEnabled(e){this._from.setIsEnabled(e),this._to.setIsEnabled(e)}isEnabledAndVisible(){return this._from.isEnabledAndVisible()||this._to.isEnabledAndVisible()}debugString(){return`VolatilePaint from=[${this._from.debugString()}] to=[${this._to.debugString()}]`}t(){return this._getEasedT()}from(){return this._from}to(){return this._to}color(){return O.mix(this._from.color(),this._to.color(),this._getEasedT())}isOpaque(){return this._from.isOpaque()&&this._to.isOpaque()}transform(){let e=new b(.5,.5),t=this._from.transform().clone().translatedBy1(e),n=this._to.transform().clone().translatedBy1(e);return to.lerp1(t,n,this.t()).translatedBy1(e.negative())}allocateImageTransformForGeometrySize(e){let t=J.new2(),n=b.lerp(this._fromCanvasSpaceNodeSize,this._toCanvasSpaceNodeSize,this.t());if(this.from().imageScaleMode()=="STRETCH"||this.to().imageScaleMode()=="STRETCH"||this.from().imageScaleMode()!=this.to().imageScaleMode()){(this._cachedFromTransform==null||this._cachedToTransform==null||this._cachedFromOffsetFromCenter==null||this._cachedToOffsetFromCenter==null||this._cachedFromImageOnCanvasSize==null||this._cachedToImageOnCanvasSize==null)&&this._computeCachedImageDimensions();let o=b.lerp(this._cachedFromImageOnCanvasSize,this._cachedToImageOnCanvasSize,this.t()),i=n.divide(o),a=b.lerp(this._cachedFromOffsetFromCenter,this._cachedToOffsetFromCenter,this.t()),s=new b(.5,.5).subtract(a).subtract(i.divideScalar(2)),l=kt.double_lerp(this._cachedFromTransform.toAngle(),this._cachedToTransform.toAngle(),this.t());return t.translatedBy1(s).rotatedBy(l).scaledBy1(i)}else{let o=this._from.allocateImageTransformForGeometrySize(n),i=this._to.allocateImageTransformForGeometrySize(n);return t.copyFrom(to.lerp1(o,i,this.t())),t}}opacity(){return kt.double_clamp(kt.double_lerp(this.from().opacity(),this.to().opacity(),this.t()),0,1)}colorAdjustIsActive(){return this._from.colorAdjustIsActive()||this._to.colorAdjustIsActive()}colorAdjustSetData(e){let t=Pr.instance();e.setUniformFloat(t.GLSLX_NAME_U_GLOBAL_TINT,kt.double_clamp(kt.double_lerp(this.from().filterColorAdjust()!=null?this.from().filterColorAdjust().tint:0,this.to().filterColorAdjust()!=null?this.to().filterColorAdjust().tint:0,this.t()),-1,1)),e.setUniformFloat(t.GLSLX_NAME_U_GLOBAL_COLOR,kt.double_clamp(kt.double_lerp(this.from().filterColorAdjust()!=null?this.from().filterColorAdjust().vibrance:0,this.to().filterColorAdjust()!=null?this.to().filterColorAdjust().vibrance:0,this.t()),-1,1)),e.setUniformFloat(t.GLSLX_NAME_U_GLOBAL_SHADOWS,kt.double_clamp(kt.double_lerp(this.from().filterColorAdjust()!=null?this.from().filterColorAdjust().shadows:0,this.to().filterColorAdjust()!=null?this.to().filterColorAdjust().shadows:0,this.t()),-1,1)),e.setUniformFloat(t.GLSLX_NAME_U_GLOBAL_HIGHLIGHTS,kt.double_clamp(kt.double_lerp(this.from().filterColorAdjust()!=null?this.from().filterColorAdjust().highlights:0,this.to().filterColorAdjust()!=null?this.to().filterColorAdjust().highlights:0,this.t()),-1,1)),e.setUniformFloat(t.GLSLX_NAME_U_GLOBAL_EXPOSURE,kt.double_clamp(kt.double_lerp(this.from().filterColorAdjust()!=null?this.from().filterColorAdjust().exposure:0,this.to().filterColorAdjust()!=null?this.to().filterColorAdjust().exposure:0,this.t()),-1,1)),e.setUniformFloat(t.GLSLX_NAME_U_GLOBAL_CONTRAST,kt.double_clamp(kt.double_lerp(this.from().filterColorAdjust()!=null?this.from().filterColorAdjust().contrast:0,this.to().filterColorAdjust()!=null?this.to().filterColorAdjust().contrast:0,this.t()),-.3,.3)),e.setUniformFloat(t.GLSLX_NAME_U_GLOBAL_TEMPERATURE,kt.double_clamp(kt.double_lerp(this.from().filterColorAdjust()!=null?this.from().filterColorAdjust().temperature:0,this.to().filterColorAdjust()!=null?this.to().filterColorAdjust().temperature:0,this.t()),-1,1))}equals1(e){return e.isVolatile()?this.equals2(e.asVolatilePaint()):!1}equals2(e){if(!e.isVolatile())return!1;let t=e;return this._from.equals2(t._from.asSinglePaint())&&this._to.equals2(t._to.asSinglePaint())&&this._getEasedT==t._getEasedT&&this._fromCanvasSpaceNodeSize.equals(t._fromCanvasSpaceNodeSize)&&this._toCanvasSpaceNodeSize.equals(t._toCanvasSpaceNodeSize)}clone(){return this.cloneAsVolatilePaint()}cloneAsVolatilePaint(){return new r(this._from.cloneAsSinglePaint(),this._to.cloneAsSinglePaint(),this._getEasedT,this._fromCanvasSpaceNodeSize,this._toCanvasSpaceNodeSize)}hasAnyFullyTransparentAreas(){return this._from.hasAnyFullyTransparentAreas()&&this._to.hasAnyFullyTransparentAreas()}asVolatilePaint(){return this}eitherPaint(e){return e(this._from)||e(this._to)}static create(e,t,n,o,i){return new r(e,t,i,n,o)}},dv;(e=>e.FrozenPaint_EMPTY_LIST=[])(dv||(dv={}));var Se;(B=>{function r(M,F){return[$.createSolid(M,F)]}B.createFromSolidColor=r;function e(M){return M}B.create1=e;function t(M){return M}B.create2=t;function n(M){return[M]}B.fromPaint=n;function o(M){return M}B.asPaintList=o;function i(M){return M.length==0}B.isEmpty=i;function a(M){return M.length}B.count=a;function s(M,F){return M[F]}B.get=s;function l(M){return M[0]}B.first=l;function d(M){return ne.List_last(M)}B.last=d;function c(M){return M.slice()}B.clone=c;function p(M){let F=!1;for(let w=0,V=M.length;w<V;w=w+1)M[w].type()=="EMOJI"&&(F=!0);return F}B.hasEmoji=p;function u(M,F){return Mt.FrozenList_equals(M,F,(w,V)=>w==null||V==null?w==null==(V==null):w.equals1(V))}B.equals=u;function _(M){return M.length==1?M[0]:null}B.onlyPaintOrNull=_;function h(M){let F=_(M);return F!=null&&F.type()=="SOLID"&&!F.isVolatile()?F:null}B.onlySolidPaintOrNull=h;function S(M){for(let F=0,w=M.length;F<w;F=F+1){let V=M.length-1-F;if(!M[V].isEnabledAndVisible())continue;let k=M[V];return k!=null&&k.type()=="SOLID"&&!k.isVolatile()&&k.asSinglePaint().isOpaque()?k:null}return null}B.firstPaintIfSolidAndOpaqueOrNull=S;function m(M){return M.length==1&&M[0].type()=="EMOJI"}B.isEmojiPaint=m;function f(M){for(let F=0,w=M.length;F<w;F=F+1){let V=M[F].asSinglePaint();if(V!=null){if(V.blendMode()!="NORMAL"&&V.blendMode()!="PASS_THROUGH")return!1}else{let k=M[F].asVolatilePaint();if(k!=null&&k.eitherPaint(H=>H.blendMode()!="NORMAL"&&H.blendMode()!="PASS_THROUGH"))return!1}}return!0}B.isIsolated=f;function T(M){for(let F=0,w=M.length;F<w;F=F+1)if(M[F].isEnabledAndVisible())return!0;return!1}B.containsAtLeastOneVisiblePaint=T;function y(M){for(let F=0,w=M.length;F<w;F=F+1){let V=M[F].asSinglePaint(),k=M[F].asVolatilePaint();if(V==null&&k!=null&&k.isVisible()||V!=null&&V.isVisible()&&!V.hasAnyFullyTransparentAreas())return!0}return!1}B.containsAtLeastOneVisibleNotFullyTransparentPaint=y;function E(M){for(let F=0,w=M.length;F<w;F=F+1){if(!M[F].isEnabledAndVisible())continue;let V=M[F].asSinglePaint();if(V!=null){if(V.isOpaque())return!0}else{let k=M[F].asVolatilePaint();if(k!=null&&k.isOpaque())return!0}}return!1}B.containsAtLeastOneVisibleOpaquePaint=E;function v(M){for(let F=0,w=M.length;F<w;F=F+1){let V=M[F].asSinglePaint();if(V!=null){if(!V.isOpaque())return!0}else{let k=M[F].asVolatilePaint();if(k!=null&&!k.isOpaque())return!0}}return!1}B.containsAtLeastOneNonOpaquePaint=v;function A(M){for(let F=0,w=M.length;F<w;F=F+1){let V=M[F].asSinglePaint();if(V==null&&M[F].asVolatilePaint()!=null||!V.hasAnyFullyTransparentAreas())return!1}return!0}B.hasAnyFullyTransparentAreas=A;function I(M){for(let F=0,w=M.length;F<w;F=F+1){let V=M[F].asSinglePaint();if(V!=null){if(V.hasAnimatingMedia())return!0}else{let k=M[F].asVolatilePaint();if(k!=null&&k.eitherPaint(H=>H.hasAnimatingMedia()))return!0}}return!1}B.hasAnimatingMediaPaints=I;function C(M){for(let F=0,w=M.length;F<w;F=F+1)if(M[F].isVolatile())return!0;return!1}B.hasVolatilePaints=C;function g(M,F){var w,V;for(let k=0,H=M.length;k<H;k=k+1){let z=M[k].asSinglePaint();(z==null?void 0:z.video())!=null&&F(z);let Q=M[k].asVolatilePaint();((w=Q==null?void 0:Q.to())==null?void 0:w.video())!=null&&F(Q.to()),((V=Q==null?void 0:Q.from())==null?void 0:V.video())!=null&&F(Q.from())}}B.forEachPaintWithVideo=g;function R(M){if(f(M))return[M];let F=[],w="NORMAL",V=[];for(let k=0,H=M.length;k<H;k=k+1){let z=M[k];(z.blendMode()!=w||z.blendMode()!="NORMAL")&&V.length!=0&&(F.push(V.slice()),V.length=0),w=z.blendMode(),V.push(z)}return V.length!=0&&F.push(V.slice()),F}B.isolatedPaints=R;function D(M){if(C(M))return M;if(M.length==2&&M[0].type()=="SOLID"&&ne.List_last(M).asSinglePaint().isGradient()){let w=M[0].asSinglePaint(),V=O.multiplyOpacity(w.color(),w.opacity()),k=ne.List_last(M).clone(),H=[],z=-1,Q=!0,K=k.colorStops();for(let j=0,pe=K.length;j<pe;j=j+1){let Pe=K[j];if(z>=0&&z!=O.alpha(Pe.color)){Q=!1;break}z=O.alpha(Pe.color);let at=O.multiplyOpacity(Pe.color,k.opacity());H.push(new je(O.blend(V,at),Pe.position))}if(Q)return k.setOpacity(1),k.setColorStops1(H),D([k])}let F=M.length;for(let w=0;w<F;w=w+1){let V=M[w].asSinglePaint().optimized();if(V==M[w])continue;let k=M.slice(0,w);for(k.push(V);(w=w+1)<F;)k.push(M[w].asSinglePaint().optimized());return k}return M}B.optimize=D,B.SOLID_BLACK=[$.createSolid(O.BLACK,1)],B.EMPTY=[]})(Se||(Se={}));var Dp=class{constructor(e,t){e.push(this),this._value=-1,this._needsLogInHistogramBatch=!1,this._needsLogInSlowFrameTracker=!1,this._stringName=t}getStringName(){return this._stringName}setValueForFutureLog(e){this._value=e?1:0,this._needsLogInHistogramBatch=!0,this._needsLogInSlowFrameTracker=!0}getAndClearHistogramBatchValue(){return this._needsLogInHistogramBatch?(this._needsLogInHistogramBatch=!1,this._value):-1}getAndClearSlowFrameTrackerValue(){return this._needsLogInSlowFrameTracker?(this._needsLogInSlowFrameTracker=!1,this._value):-1}},Ws=class Ws{static didEncounterIntraTileInterrupt(){this.encounteredIntraTileInterrupt.setValueForFutureLog(!0)}static didUseUnifiedRendererMaterial(e){this.usedUnifiedRendererMaterial.setValueForFutureLog(e)}static getAndClearHistogramBatchFields(){let e=new Map;for(let t of this.allTrackedExposureLogs){let n=t.getAndClearHistogramBatchValue();n!=-1&&e.set(t.getStringName(),n===1)}return e}static getAndClearSlowFrameTrackerFields(){let e=new Map;for(let t of this.allTrackedExposureLogs){let n=t.getAndClearSlowFrameTrackerValue();n!=-1&&e.set(t.getStringName(),n===1)}return e}static clearAllSlowFrameTrackerFields(){for(let e of this.allTrackedExposureLogs)e.getAndClearSlowFrameTrackerValue()}};Ws.allTrackedExposureLogs=[],Ws.encounteredIntraTileInterrupt=new Dp(Ws.allTrackedExposureLogs,"intraTile"),Ws.usedUnifiedRendererMaterial=new Dp(Ws.allTrackedExposureLogs,"veruMaterial");var yi=Ws;function wp(r,e){return r.fitMode!="contain"&&r.fitMode!="scale-down"&&r.fitMode!="scale-down-width"&&r.fitMode!="fit-width"&&!(r.fitMode=="min-zoom"&&e)}function uv(r){return r.fitMode!="contain"&&r.fitMode!="scale-down"&&r.fitMode!="none"&&r.fitMode!="free"}var $e=(A=>(A[A.UNKNOWN=0]="UNKNOWN",A[A.TIMER=1]="TIMER",A[A.ON_HOVER=2]="ON_HOVER",A[A.ON_PRESS=3]="ON_PRESS",A[A.ON_CLICK=4]="ON_CLICK",A[A.DRAG=5]="DRAG",A[A.REVERSE_HOVER=6]="REVERSE_HOVER",A[A.REVERSE_PRESS=7]="REVERSE_PRESS",A[A.MOUSE_DOWN=8]="MOUSE_DOWN",A[A.MOUSE_UP=9]="MOUSE_UP",A[A.MOUSE_IN=10]="MOUSE_IN",A[A.MOUSE_OUT=11]="MOUSE_OUT",A[A.MOUSE_ENTER=12]="MOUSE_ENTER",A[A.MOUSE_LEAVE=13]="MOUSE_LEAVE",A[A.ON_KEY_DOWN=14]="ON_KEY_DOWN",A[A.ON_GAMEPAD_DOWN=15]="ON_GAMEPAD_DOWN",A[A.ON_VOICE=16]="ON_VOICE",A[A.MOBILE_NAV=17]="MOBILE_NAV",A[A.LEFT_ARROW=18]="LEFT_ARROW",A[A.RIGHT_ARROW=19]="RIGHT_ARROW",A[A.ON_MEDIA_HIT=20]="ON_MEDIA_HIT",A[A.ON_MEDIA_END=21]="ON_MEDIA_END",A))($e||{});(s=>{function r(l){switch(l){case 1:case 20:case 21:case 4:case 5:case 9:case 17:case 18:case 19:return!1;case 2:case 3:case 6:case 7:case 8:case 10:case 11:case 12:case 13:return!0;default:return!1}}s.isTransientAction=r;function e(l){switch(l){case 2:case 3:case 8:case 10:case 12:return!0;default:return!1}}s.isForwardTransientAction=e;function t(l){switch(l){case 2:return 6;case 3:return 7;case 6:return 2;case 7:return 3;case 10:return 11;case 11:return 10;case 12:return 13;case 13:return 12;case 8:return 9;default:return 0}}s.getOppositeTransientAction=t;function n(l){switch(l){case"TIMER":return 1;case"ON_HOVER":return 2;case"ON_PRESS":return 3;case"ON_CLICK":return 4;case"REVERSE_HOVER":return 6;case"REVERSE_PRESS":return 7;case"MOUSE_DOWN":return 8;case"MOUSE_UP":return 9;case"MOUSE_IN":return 10;case"MOUSE_OUT":return 11;case"MOUSE_ENTER":return 12;case"MOUSE_LEAVE":return 13;case"ON_KEY_DOWN":return 14;case"ON_GAMEPAD_DOWN":return 15;case"ON_VOICE":return 16;case"MOBILE_NAV":return 17;case"LEFT_ARROW":return 18;case"RIGHT_ARROW":return 19;case"ON_MEDIA_HIT":return 20;case"ON_MEDIA_END":return 21}return 0}s.fromString=n;function o(l){return[1,18,19,20,21].indexOf(l)!=-1?0:1}s.getControlSource=o;function i(l){switch(l){case"AFTER_TIMEOUT":return 1;case"ON_HOVER":return 2;case"ON_PRESS":return 3;case"ON_CLICK":return 4;case"DRAG":return 5;case"MOUSE_DOWN":return 8;case"MOUSE_UP":return 9;case"MOUSE_IN":return 10;case"MOUSE_OUT":return 11;case"MOUSE_ENTER":return 12;case"MOUSE_LEAVE":return 13;case"ON_KEY_DOWN":return 14;case"ON_VOICE":return 16;case"ON_MEDIA_HIT":return 20;case"ON_MEDIA_END":return 21}return Oe("fromInteractionType InteractionType not handled"),0}s.fromInteractionType=i;function a(l){switch(l){case 1:return"AFTER_TIMEOUT";case 2:return"ON_HOVER";case 3:return"ON_PRESS";case 4:return"ON_CLICK";case 5:return"DRAG";case 8:return"MOUSE_DOWN";case 9:return"MOUSE_UP";case 10:return"MOUSE_IN";case 11:return"MOUSE_OUT";case 12:return"MOUSE_ENTER";case 13:return"MOUSE_LEAVE";case 14:return"ON_KEY_DOWN";case 15:return"ON_KEY_DOWN";case 16:return"ON_VOICE";case 20:return"ON_MEDIA_HIT";case 21:return"ON_MEDIA_END"}return Oe("mapToInteractionType TransitionAction not handled"),null}s.mapToInteractionType=a})($e||($e={}));var Sn=(t=>(t[t.FORWARD=0]="FORWARD",t[t.REVERSE=1]="REVERSE",t))(Sn||{});var vf=class{constructor(e,t,n,o){this.key=e,this.value=t,this.prev=n,this.next=o,this.lastUsedGeneration=0}},Dl=class{constructor(e,t=null){this._nodeByKey=new Map;this._size=0;this._head=null;this._tail=null;this._generation=1;this._maxElements=e,this._afterEvict=t}maximumCapacity(){return this._maxElements}atMaximumCapacity(){return this._size==this._maxElements}increaseCapacity(e){this._maxElements=this._maxElements+e}capacityUsedForGeneration(){return this.atMaximumCapacity()?this._tail.lastUsedGeneration==this._generation:!1}incrementGeneration(){this._generation=this._generation+1}keys(){return Array.from(this._nodeByKey.keys())}_in(e){return this._nodeByKey.has(e)?(this._moveElemToHead(this._nodeByKey.get(e)),!0):!1}count(){return this._size}get1(e){return this._moveElemToHead(this._nodeByKey.get(e)),this._nodeByKey.get(e).value}get(e,t){let n=Ge.StringMap_get(this._nodeByKey,e,null);return n==null?t:(this._moveElemToHead(n),n.value)}tailElement(){return this._tail.value}set(e,t){let n=Ge.StringMap_get(this._nodeByKey,e,null);if(n!=null)this._moveElemToHead(n),n.value=t;else if(n=new vf(e,t,null,null),this._addElemAsHead(n),this._nodeByKey.set(e,n),this._size=this._size+1,this._size>this._maxElements){let o=this._tail.value,i=this._tail.key;this.remove(this._tail.key)}}remove(e){let t=Ge.StringMap_get(this._nodeByKey,e,null);t!=null&&(this._nodeByKey.delete(t.key),this._removeFromList(t),this._size=this._size-1,this._afterEvict!=null&&this._afterEvict(t.key,t.value))}removeValue(e){let t=[];Ge.StringMap_each(this._nodeByKey,(n,o)=>{o.value==e&&t.push(n)}),t.forEach(n=>{this.remove(n)})}makeLeastRecent(e){let t=Ge.StringMap_get(this._nodeByKey,e,null);t!=null&&(this._removeFromList(t),this._addElemAsTail(t))}_moveElemToHead(e){this._removeFromList(e),this._addElemAsHead(e)}_removeFromList(e){let t=e.prev,n=e.next;t!=null&&(t.next=n),n!=null&&(n.prev=t),e==this._tail&&(this._tail=t),e==this._head&&(this._head=n),e.next=e.prev=null}_addElemAsHead(e){this._head==null?this._head=this._tail=e:(e.prev=null,e.next=this._head,e.next.prev=e,this._head=e),this._head.lastUsedGeneration=this._generation}_addElemAsTail(e){this._tail==null?this._tail=this._head=e:(e.next=null,e.prev=this._tail,e.prev.next=e,this._tail=e),this._tail.lastUsedGeneration=0}};var fo=class fo{static numInitialTextures(){return Y.shouldApplyMobileOptimizations()?3:6}static numInitialTiles(e){return fo.numInitialTextures()*e*e}static tilesPerSide(e){let t=e;return Y.shouldApplyMobileOptimizations()&&(t=Math.min(Qn.getExperimentNumber("viewer_atlas_mobile_tile_size","tile_size",2048),e)),t/fo.TILE_SIZE|0}_createNewTexture(){let e=this._context.createTexture(be.RGBA_LINEAR_MIN_NEAREST_MAG_CLAMP,this._tilesPerSide*fo.TILE_SIZE,this._tilesPerSide*fo.TILE_SIZE,yr.TILE_ATLAS),t=this._context.createFramebuffer(e,null,"Tile Atlas");this._tileCacheFramebuffers.push(t)}allocateTile(){let e=`tile${this._tileIdCounter}`;this._tileIdCounter=this._tileIdCounter+1,this._tilesLRU.capacityUsedForGeneration()&&(this._createNewTexture(),this._tilesLRU.increaseCapacity(this._tilesPerSide*this._tilesPerSide),console.warn("allocated new texture in the atlas to handle demand for current frame"));let t=this._tilesLRU.atMaximumCapacity()?this._tilesLRU.tailElement():this._tilesLRU.count();return this._tilesLRU.set(e,t),e}maximumCapacity(){return this._tilesLRU.maximumCapacity()}prepareForNewFrame(){this._tilesLRU.incrementGeneration()}totalVRAM(){let e=0;for(let t of this._tileCacheFramebuffers)e=e+Mo.Texture_totalVRAM(t.colorTexture());return e}tileIsStillValid(e){return this._tilesLRU._in(e)}framebufferForTile(e){let t=this._tilesLRU.get1(e);return this._tileCacheFramebuffers[t/(this._tilesPerSide*this._tilesPerSide)|0]}devalueTile(e){this._tilesLRU.makeLeastRecent(e)}viewportForTile(e,t){let n=this._tilesLRU.get1(e),o=gt.int_remainder(n,this._tilesPerSide),i=gt.int_remainder(n/this._tilesPerSide|0,this._tilesPerSide);t.setTo1(o*fo.TILE_SIZE,i*fo.TILE_SIZE,fo.TILE_SIZE,fo.TILE_SIZE)}clearCache(){let t=this._tileCacheFramebuffers.length*this._tilesPerSide*this._tilesPerSide;this._tilesLRU=new Dl(t,this._afterEvictOrNull)}constructor(e,t){this._tileIdCounter=0,this._tileCacheFramebuffers=[],this._afterEvictOrNull=t,this._tilesPerSide=fo.tilesPerSide(e.maxTextureSize()),this._tilesLRU=new Dl(fo.numInitialTiles(this._tilesPerSide),this._afterEvictOrNull),e.addContextResetHandler(()=>{this.clearCache()}),this._context=e;for(let n=0,o=fo.numInitialTextures();n<o;n=n+1)this._createNewTexture()}};fo.TILE_SIZE=512;var tr=fo;var Ov=ml(pv());var go=class r{constructor(){this._float=null,this._int=null,this._value=0,this._float=new Float32Array(1),this._int=new Int32Array(this._float.buffer)}reset(){this._value=0}value(){return this._value}hash1(e){this._float[0]=e,this._value=r.combine(this._value,this._int[0])}hash2(e){this._value=r.combine(this._value,e)}static combine(e,t){return t+-1640531527+(e<<6)+(e>>2)}};function _v(r,e,t){if(e==5&&r[4].equals(r[0])&&(e=e-1),e!=4)return!1;let s=.001,l=0,d=0;for(let c=0;c<e;c=c+1){let p=r[c],u=0;if(p.x()<t.left()+s)if(p.y()<t.top()+s)u=0;else if(p.y()>t.bottom()-s)u=2;else return!1;else if(p.x()>t.right()-s)if(p.y()<t.top()+s)u=1;else if(p.y()>t.bottom()-s)u=3;else return!1;else return!1;if(c>0){let _=l^u;if(_!=1&&_!=2)return!1}d|=1<<u,l=u}return d==15}var hd=class{constructor(e,t){this.bounds=e,this.isRect=t}},ze=class r{constructor(){this.VERTEX_PATTERN_COUNT=5;this.VERTEX_PATTERN=[null,null,null,null,null];this._data=arguments[0],arguments.length==1?(this._cachedInfo=null,this._hash=null):arguments.length==3&&(this._cachedInfo=arguments[1],this._hash=new ce(arguments[2]))}_invalidateCachedData(){this._cachedInfo=null,this._hash=null}equals2(e){return e instanceof r?this.equals1(e):!1}equals1(e){return this._data.byteCount()!=e._data.byteCount()||this.hash()!=e.hash()?!1:$u.FrozenDataArray_equals(this._data,e._data)}clone(){return this.getMutableClone()}getMutableClone(){return new Rt(this._data.clone())}isEmpty(){return this._data.isEmpty()}start(){return 0}bounds(){return this._cachedInfo==null&&(this._cachedInfo=this._computeBoundsAndRectInfo()),this._cachedInfo.bounds}isRect(){return this._cachedInfo==null&&(this._cachedInfo=this._computeBoundsAndRectInfo()),this._cachedInfo.isRect}asRoundedRectPath(){return null}canBeAnalyticallyAntialiased(){return!1}hash(){if(this._cachedInfo==null&&(this._cachedInfo=this._computeBoundsAndRectInfo()),this._hash==null){let e=new go;for(let t=0,n=this._data.byteCount();t<n;t=t+1)e.hash2(this._data.byteAt(t));this._hash=new ce(e.value())}return this._hash.value}countCommands(){let e=0;for(let t=this.start();r.Command.isValid(t,this);t=r.Command.next(t,this))e=e+1;return e}_computeBoundsAndRectInfo(){let e=ht.INSTANCE;e.reset();for(let d=0,c=this.VERTEX_PATTERN_COUNT;d<c;d=d+1)this.VERTEX_PATTERN[d]=null;let t=!1,n=!1,o=0,i=b.new(),a=d=>{o<this.VERTEX_PATTERN_COUNT&&(this.VERTEX_PATTERN[o]=d),e.include2(d),o=o+1};for(let d=this.start();r.Command.isValid(d,this);d=r.Command.next(d,this))switch(r.Command.kind(d,this)){case r.Command.Kind.CLOSE:{n=!1;break}case r.Command.Kind.MOVE_TO:{i=r.Command.point(d,this),n=!1;break}case r.Command.Kind.LINE_TO:case r.Command.Kind.QUADRATIC_TO:case r.Command.Kind.CUBIC_TO:{n||(a(i),n=!0),r.Command.kind(d,this)==r.Command.Kind.QUADRATIC_TO?(e.include2(r.Command.control1(d,this)),t=!0):r.Command.kind(d,this)==r.Command.Kind.CUBIC_TO&&(e.include2(r.Command.control1(d,this)),e.include2(r.Command.control2(d,this)),t=!0),i=r.Command.point(d,this),a(i);break}default:break}let s=e.isValid()?e.build():G.INVALID,l=!t&&o<=this.VERTEX_PATTERN_COUNT&&_v(this.VERTEX_PATTERN,o,s);return new hd(s,l)}toBezierPath(){return this}toString(){let e="";for(let t=this.start();r.Command.isValid(t,this);t=r.Command.next(t,this))switch(t!=this.start()&&(e+=" "),r.Command.kind(t,this)){case r.Command.Kind.CLOSE:{e+="Z";break}case r.Command.Kind.MOVE_TO:{e+=`M ${r.Command.moveToX(t,this)} ${r.Command.moveToY(t,this)}`;break}case r.Command.Kind.LINE_TO:{e+=`L ${r.Command.lineToX(t,this)} ${r.Command.lineToY(t,this)}`;break}case r.Command.Kind.QUADRATIC_TO:{e+=`Q ${r.Command.quadraticToFirstX(t,this)} ${r.Command.quadraticToFirstY(t,this)} ${r.Command.quadraticToX(t,this)} ${r.Command.quadraticToY(t,this)}`;break}case r.Command.Kind.CUBIC_TO:{e+=`C ${r.Command.cubicToFirstX(t,this)} ${r.Command.cubicToFirstY(t,this)} ${r.Command.cubicToSecondX(t,this)} ${r.Command.cubicToSecondY(t,this)} ${r.Command.cubicToX(t,this)} ${r.Command.cubicToY(t,this)}`;break}default:{break}}return e}data(){return this._data}};(e=>{let r;(Q=>{function t(K,j){return j.data().byteAt(K)}Q.kind=t;function n(K,j){let pe=t(K,j);return K+(pe==4?1+4*6:pe==3?1+4*4:pe==0?1:1+4*2)}Q.next=n;function o(K,j){if(K>=j.data().byteCount())return!1;let pe=0;switch(t(K,j)){case 0:{pe=1;break}case 1:case 2:{pe=1+1*8;break}case 3:{pe=1+2*8;break}case 4:{pe=1+3*8;break}default:return!1}return K+pe<=j.data().byteCount()}Q.isValid=o;function i(K,j){return l(K,j,t(K,j)==3?1:t(K,j)==4?2:0)}Q.point=i;function a(K,j){return l(K,j,0)}Q.control1=a;function s(K,j){return l(K,j,1)}Q.control2=s;function l(K,j,pe){return new b(j.data().floatAt(K+1+8*pe),j.data().floatAt(K+1+8*pe+4))}Q.pointAtIndex=l;function d(K,j){return j.data().floatAt(K+1)}Q.moveToX=d;function c(K,j){return j.data().floatAt(K+5)}Q.moveToY=c;function p(K,j,pe){j.setFloatAt(K+1,pe)}Q.setMoveToX=p;function u(K,j,pe){j.setFloatAt(K+5,pe)}Q.setMoveToY=u;function _(K,j){return j.data().floatAt(K+1)}Q.lineToX=_;function h(K,j){return j.data().floatAt(K+5)}Q.lineToY=h;function S(K,j,pe){j.setFloatAt(K+1,pe)}Q.setLineToX=S;function m(K,j,pe){j.setFloatAt(K+5,pe)}Q.setLineToY=m;function f(K,j){return j.data().floatAt(K+1)}Q.quadraticToFirstX=f;function T(K,j){return j.data().floatAt(K+5)}Q.quadraticToFirstY=T;function y(K,j){return j.data().floatAt(K+(1+4*2))}Q.quadraticToX=y;function E(K,j){return j.data().floatAt(K+(1+4*3))}Q.quadraticToY=E;function v(K,j,pe){j.setFloatAt(K+1,pe)}Q.setQuadraticToFirstX=v;function A(K,j,pe){j.setFloatAt(K+5,pe)}Q.setQuadraticToFirstY=A;function I(K,j,pe){j.setFloatAt(K+(1+4*2),pe)}Q.setQuadraticToX=I;function C(K,j,pe){j.setFloatAt(K+(1+4*3),pe)}Q.setQuadraticToY=C;function g(K,j){return j.data().floatAt(K+1)}Q.cubicToFirstX=g;function R(K,j){return j.data().floatAt(K+5)}Q.cubicToFirstY=R;function D(K,j){return j.data().floatAt(K+(1+4*2))}Q.cubicToSecondX=D;function P(K,j){return j.data().floatAt(K+(1+4*3))}Q.cubicToSecondY=P;function U(K,j){return j.data().floatAt(K+(1+4*4))}Q.cubicToX=U;function B(K,j){return j.data().floatAt(K+(1+4*5))}Q.cubicToY=B;function M(K,j,pe){j.setFloatAt(K+1,pe)}Q.setCubicToFirstX=M;function F(K,j,pe){j.setFloatAt(K+5,pe)}Q.setCubicToFirstY=F;function w(K,j,pe){j.setFloatAt(K+(1+4*2),pe)}Q.setCubicToSecondX=w;function V(K,j,pe){j.setFloatAt(K+(1+4*3),pe)}Q.setCubicToSecondY=V;function k(K,j,pe){j.setFloatAt(K+(1+4*4),pe)}Q.setCubicToX=k;function H(K,j,pe){j.setFloatAt(K+(1+4*5),pe)}Q.setCubicToY=H;let z;(Ke=>(Ke[Ke.CLOSE=0]="CLOSE",Ke[Ke.MOVE_TO=1]="MOVE_TO",Ke[Ke.LINE_TO=2]="LINE_TO",Ke[Ke.QUADRATIC_TO=3]="QUADRATIC_TO",Ke[Ke.CUBIC_TO=4]="CUBIC_TO"))(z=Q.Kind||(Q.Kind={}))})(r=e.Command||(e.Command={}))})(ze||(ze={}));var lt=class lt extends ze{constructor(e){super(e)}static mutableData(e){return e._data}append(e){this._invalidateCachedData(),!this.isEmpty()&&!e.isEmpty()&&ze.Command.kind(e.start(),e)!=1&&this.moveTo1(0,0),this._data.appendBytes(e.data())}setFloatAt(e,t){this._invalidateCachedData(),this._data.setFloatAt(e,t)}moveTo1(e,t){return this._invalidateCachedData(),this._data.appendByte(1),this._data.appendFloat(e),this._data.appendFloat(t),this}moveTo2(e){return this.moveTo1(e.x(),e.y())}lineTo(e,t){return this._invalidateCachedData(),this._data.appendByte(2),this._data.appendFloat(e),this._data.appendFloat(t),this}quadraticTo(e,t,n,o){return this._invalidateCachedData(),this._data.appendByte(3),this._data.appendFloat(e),this._data.appendFloat(t),this._data.appendFloat(n),this._data.appendFloat(o),this}cubicTo1(e,t,n,o,i,a){return this._invalidateCachedData(),this._data.appendByte(4),this._data.appendFloat(e),this._data.appendFloat(t),this._data.appendFloat(n),this._data.appendFloat(o),this._data.appendFloat(i),this._data.appendFloat(a),this}cubicTo2(e,t,n){return this.cubicTo1(e.x(),e.y(),t.x(),t.y(),n.x(),n.y())}close(){return this._invalidateCachedData(),this._data.appendByte(0),this}transformBy(e){this._invalidateCachedData(),!this.isEmpty()&&ze.Command.kind(this.start(),this)!=1&&this._data.prependBytes(new lt(new fn).moveTo1(0,0)._data);for(let t=this.start();ze.Command.isValid(t,this);t=ze.Command.next(t,this))switch(ze.Command.kind(t,this)){case 0:break;case 1:{lt._p0.setTo(ze.Command.moveToX(t,this),ze.Command.moveToY(t,this)),e.transformPoint(lt._p0),ze.Command.setMoveToX(t,this,lt._p0.x()),ze.Command.setMoveToY(t,this,lt._p0.y());break}case 2:{lt._p0.setTo(ze.Command.lineToX(t,this),ze.Command.lineToY(t,this)),e.transformPoint(lt._p0),ze.Command.setLineToX(t,this,lt._p0.x()),ze.Command.setLineToY(t,this,lt._p0.y());break}case 3:{lt._p0.setTo(ze.Command.quadraticToFirstX(t,this),ze.Command.quadraticToFirstY(t,this)),e.transformPoint(lt._p0),ze.Command.setQuadraticToFirstX(t,this,lt._p0.x()),ze.Command.setQuadraticToFirstY(t,this,lt._p0.y()),lt._p0.setTo(ze.Command.quadraticToX(t,this),ze.Command.quadraticToY(t,this)),e.transformPoint(lt._p0),ze.Command.setQuadraticToX(t,this,lt._p0.x()),ze.Command.setQuadraticToY(t,this,lt._p0.y());break}case 4:{lt._p0.setTo(ze.Command.cubicToFirstX(t,this),ze.Command.cubicToFirstY(t,this)),e.transformPoint(lt._p0),ze.Command.setCubicToFirstX(t,this,lt._p0.x()),ze.Command.setCubicToFirstY(t,this,lt._p0.y()),lt._p0.setTo(ze.Command.cubicToSecondX(t,this),ze.Command.cubicToSecondY(t,this)),e.transformPoint(lt._p0),ze.Command.setCubicToSecondX(t,this,lt._p0.x()),ze.Command.setCubicToSecondY(t,this,lt._p0.y()),lt._p0.setTo(ze.Command.cubicToX(t,this),ze.Command.cubicToY(t,this)),e.transformPoint(lt._p0),ze.Command.setCubicToX(t,this,lt._p0.x()),ze.Command.setCubicToY(t,this,lt._p0.y());break}default:break}}static new2(){return new lt(new fn)}static fromRect(e){return lt._fromRect(e.x(),e.y(),e.width(),e.height())}static _fromRect(e,t,n,o){let i=lt.new2();return i.moveTo1(e,t).lineTo(e+n,t).lineTo(e+n,t+o).lineTo(e,t+o).close(),i}static fromRoundedRectWithSpread(e,t){return e.adjustCornerRadiiForSpread(t),lt.fromRoundedRect1(e)}static fromRoundedRect1(e){return e.vertexRadii()!=null?lt.fromRoundedRect3(e.left(),e.top(),e.width(),e.height(),e.vertexRadii()):lt.fromRoundedRect2(e.left(),e.top(),e.width(),e.height(),e.nodeRadius())}static fromRoundedRect2(e,t,n,o,i){if(i=Math.min(i,Math.min(n/2,o/2)),i==0)return lt._fromRect(e,t,n,o);let a=lt.new2(),s=lt.CIRCLE_APPROXIMATION_CONSTANT*i;return a.moveTo1(e,t+i).cubicTo1(e,t+i-s,e+i-s,t,e+i,t).lineTo(e+n-i,t).cubicTo1(e+n-i+s,t,e+n,t+i-s,e+n,t+i).lineTo(e+n,t+o-i).cubicTo1(e+n,t+o-i+s,e+n-i+s,t+o,e+n-i,t+o).lineTo(e+i,t+o).cubicTo1(e+i-s,t+o,e,t+o-i+s,e,t+o-i).close(),a}static fromRoundedRect3(e,t,n,o,i){let a=!0;for(let d=0,c=i.length;d<c;d=d+1)i[d]!=0&&(a=!1),i[d]=Math.min(i[d],Math.min(n/2,o/2));if(a)return lt._fromRect(e,t,n,o);let s=lt.new2(),l=i.map(d=>lt.CIRCLE_APPROXIMATION_CONSTANT*d);return s.moveTo1(e,t+i[0]).cubicTo1(e,t+i[0]-l[0],e+i[0]-l[0],t,e+i[0],t).lineTo(e+n-i[1],t).cubicTo1(e+n-i[1]+l[1],t,e+n,t+i[1]-l[1],e+n,t+i[1]).lineTo(e+n,t+o-i[2]).cubicTo1(e+n,t+o-i[2]+l[2],e+n-i[2]+l[2],t+o,e+n-i[2],t+o).lineTo(e+i[3],t+o).cubicTo1(e+i[3]-l[3],t+o,e,t+o-i[3]+l[3],e,t+o-i[3]).close(),s}static forEllipse(e){let t=new b(e.left()+e.width()/2,e.top()+e.height()/2),n=new b(e.width()/2,0),o=new b(0,e.height()/2),i=n.multiplyScalar(lt.CIRCLE_APPROXIMATION_CONSTANT),a=o.multiplyScalar(lt.CIRCLE_APPROXIMATION_CONSTANT),s=lt.new2();return s.moveTo2(t.add(n)).cubicTo2(t.add(n).add(a),t.add(i).add(o),t.add(o)).cubicTo2(t.subtract(i).add(o),t.subtract(n).add(a),t.subtract(n)).cubicTo2(t.subtract(n).subtract(a),t.subtract(i).subtract(o),t.subtract(o)).cubicTo2(t.add(i).subtract(o),t.add(n).subtract(a),t.add(n)).close(),s}static forCenterStrokeAroundRect(e,t){let n=e.x(),o=e.y(),i=e.width(),a=e.height(),s=t/2,l=lt.new2();return l.moveTo1(n-s,o-s).lineTo(n+i+s,o-s).lineTo(n+i+s,o+a+s).lineTo(n-s,o+a+s).lineTo(n-s,o-s).lineTo(n+s,o+s).lineTo(n+s,o+a-s).lineTo(n+i-s,o+a-s).lineTo(n+i-s,o+s).lineTo(n+s,o+s).close(),l}};lt.CIRCLE_APPROXIMATION_CONSTANT=4/3*(Math.sqrt(2)-1),lt._p0=b.new(),lt._p1=b.new(),lt._p2=b.new(),lt._p3=b.new(),lt._r=G.new2();var Rt=lt;var bf=class{initialize(e){this._bindings=e}bindContext(e,t){var n;(n=this._bindings)==null||n.bindContext(e,t)}getNewProgramId(){return this._bindings.getNewProgramId()}},md=new bf;var ga;(o=>{let r;(s=>(s.SCENE_GRAPH_RENDERING="_sceneGraphRendering",s.OVERLAY_UI_RENDERING="_overlayUIRendering"))(r=o.GpuSubMetricsType||(o.GpuSubMetricsType={}));class e{constructor(){this._drawCalls=0;this._triangles=0;this._tristrips=0;this._trilists=0;this._vertices=0;this._clears=0;this._flushes=0;this._uniqueShaderPrograms=0;this._shaderChanges=0;this._glEnables=0;this._glDisables=0;this._framebufferBinds=0;this._uniformVariablesSet=0;this._texturesCreated=0;this._texturesDestroyed=0;this._textureBinds=0;this._texturesReferenced=0;this._vertexBuffersCreated=0;this._vertexBuffersDestroyed=0;this._vertexBuffersReferenced=0;this._uniformBuffersCreated=0;this._uniformBuffersDestroyed=0;this._uniformBuffersReferenced=0;this._totalBandwidth=0;this._readBandwidth=0;this._writeBandwidth=0;this._pixelReadBandwidth=0;this._textureWriteBandwidth=0;this._vertexBufferWriteBandwidth=0;this._uniformBufferWriteBandwidth=0;this._uniformVarsWriteBandwidth=0;this._uniformBufferUsedAreaWriteBandwidth=0;this._textureUploadCount=0;this._vertexBufferUploadCount=0;this._uniformBufferUploadCount=0;this.reset()}reset(){this._drawCalls=0,this._triangles=0,this._tristrips=0,this._trilists=0,this._vertices=0,this._clears=0,this._flushes=0,this._uniqueShaderPrograms=0,this._shaderChanges=0,this._glEnables=0,this._glDisables=0,this._framebufferBinds=0,this._uniformVariablesSet=0,this._texturesCreated=0,this._texturesDestroyed=0,this._textureBinds=0,this._texturesReferenced=0,this._vertexBuffersCreated=0,this._vertexBuffersDestroyed=0,this._vertexBuffersReferenced=0,this._uniformBuffersCreated=0,this._uniformBuffersDestroyed=0,this._uniformBuffersReferenced=0,this._totalBandwidth=0,this._readBandwidth=0,this._writeBandwidth=0,this._pixelReadBandwidth=0,this._textureWriteBandwidth=0,this._vertexBufferWriteBandwidth=0,this._uniformBufferWriteBandwidth=0,this._uniformVarsWriteBandwidth=0,this._uniformBufferUsedAreaWriteBandwidth=0,this._textureUploadCount=0,this._vertexBufferUploadCount=0,this._uniformBufferUploadCount=0}}o.GpuSubMetrics=e;class t{constructor(){this._frameIndex=0;this._gpuSubMetrics={_sceneGraphRendering:new e,_overlayUIRendering:new e};this._bgtIsWorkExceedingBudget=!1;this._bgtBrokeRenderAt="";this._bgtDidCompleteInterruptedFrame=!1;this._bgtHasPendingInterruptForNextFrame=!1;this._bgtTimePastRenderingDeadline=0;this._bgtTilesRendersRemaining=0;this._bgtTileCacheCapacityRemaining=0;this._bgtFrameBufferSwitchRemaining=0;this._bgtDidRasterWork=!1;this._bgtBlitToScreen=!1;this._bgtOnScreenTileCompletionCount=0;this._bgtOffScreenTileCompletionCount=0;this._bgtOptionalTileCompletionCount=0;this._bgtClearedExistingInterrupt=!1;this._currentFrameSubMetricsType="_sceneGraphRendering";this._gpuSubMetrics._sceneGraphRendering=new e,this._gpuSubMetrics._overlayUIRendering=new e,this.reset(0)}updateFrameBudgetInfo(a){this._bgtIsWorkExceedingBudget=!a.permitsMoreWork(),this._bgtTimePastRenderingDeadline=a.pastRenderingBudgetTime(),this._bgtTilesRendersRemaining=a.tileRenderingBudgetRemaining(),this._bgtTileCacheCapacityRemaining=a.tileCacheCapacityRemaining(),this._bgtFrameBufferSwitchRemaining=a.frameBufferSwitchBudgetRemaining()}logUniformVariableSet(a){this._gpuSubMetrics[this._currentFrameSubMetricsType]._uniformVariablesSet++,this._gpuSubMetrics[this._currentFrameSubMetricsType]._totalBandwidth+=a,this._gpuSubMetrics[this._currentFrameSubMetricsType]._writeBandwidth+=a,this._gpuSubMetrics[this._currentFrameSubMetricsType]._uniformVarsWriteBandwidth+=a}getCurrentFrameGPUSubMetrics(){return this._gpuSubMetrics[this._currentFrameSubMetricsType]}setCurrentFrameSubMetricsType(a){this._currentFrameSubMetricsType=a}reset(a){this._frameIndex=a,this._gpuSubMetrics._sceneGraphRendering.reset(),this._gpuSubMetrics._overlayUIRendering.reset(),this._bgtIsWorkExceedingBudget=!1,this._bgtBrokeRenderAt="",this._bgtDidCompleteInterruptedFrame=!1,this._bgtHasPendingInterruptForNextFrame=!1,this._bgtTimePastRenderingDeadline=0,this._bgtTilesRendersRemaining=0,this._bgtTileCacheCapacityRemaining=0,this._bgtFrameBufferSwitchRemaining=0,this._bgtDidRasterWork=!1,this._bgtBlitToScreen=!1,this._bgtOnScreenTileCompletionCount=0,this._bgtOffScreenTileCompletionCount=0,this._bgtOptionalTileCompletionCount=0,this._bgtClearedExistingInterrupt=!1}}o.GpuMetrics=t;class n{constructor(){this._defaultBufferSize=0;this._currentFrame=0;this._framesBuffered=0;this._metricsBuffer=[];this._frameIndex=0;this._referencedShaderPrograms=new Set}getCurrentFrameIndex(){return this._currentFrame}nextFrame(a){this._metricsBuffer.length==0&&this.setBufferSize(this._defaultBufferSize),this._frameIndex=a,this._currentFrame=(this._currentFrame+1)%this._metricsBuffer.length,this._framesBuffered=Math.min(this._framesBuffered+1,this._metricsBuffer.length),this._metricsBuffer[this._currentFrame].reset(this._frameIndex),this._referencedShaderPrograms=new Set}getBuffer(){let a=[];if(this._framesBuffered>0){let s=this._currentFrame==this._metricsBuffer.length-1?0:this._currentFrame+1,l=0;for(let d=s;d<this._metricsBuffer.length&&l<this._framesBuffered;d++,l++)a[l]=Object.assign({},this._metricsBuffer[d]);for(let d=0;l<this._framesBuffered;d++,l++)a[l]=Object.assign({},this._metricsBuffer[d])}return a}getBufferSize(){return this._metricsBuffer.length}jsonReplacerForTests(a,s){if(!(a=="_frameIndex"||a=="_bgtIsWorkExceedingBudget"||a=="_bgtTimePastRenderingDeadline"||a=="_bgtTilesRendersRemaining"||a=="_bgtTileCacheCapacityRemaining"||a=="_bgtFrameBufferSwitchRemaining"||s===0))return s}getBufferJsonForTest(){let a=this.getBuffer();for(let s=0;s<a.length;s++)delete a[s]._frameIndex;return JSON.stringify(a,this.jsonReplacerForTests)}getCurrentFrameGPUSubMetrics(){return this._metricsBuffer[this._currentFrame].getCurrentFrameGPUSubMetrics()}getCurrentFrameGPUMetrics(){return this._metricsBuffer[this._currentFrame]}getPreviousFrameGPUMetrics(){return this._framesBuffered<2?null:this._currentFrame>0?this._metricsBuffer[this._currentFrame-1]:this._metricsBuffer[this._metricsBuffer.length-1]}setBufferSize(a){if(a<2)return!1;if(a==this._metricsBuffer.length)return!0;this._currentFrame=0,this._framesBuffered=0,this._metricsBuffer=[];for(let s=0;s<a;s++)this._metricsBuffer.push(new t);return this._referencedShaderPrograms=new Set,!0}referenceShaderProgram(a){this._referencedShaderPrograms.add(a),this.getCurrentFrameGPUSubMetrics()._uniqueShaderPrograms=this._referencedShaderPrograms.size}}o.GpuMetricsCollection=n})(ga||(ga={}));var Lp=class{constructor(e,t,n){this._context=e,this._name=t,this._format=n,xc().then(o=>{this._wasmMutableMaterial=o.modules().wasmRendererBindings.createMaterialObject(t),this._emscriptenProgramId=this._wasmMutableMaterial.getId()})}format(){return this._format}setUniformFloat(e,t){throw new Error("Method not implemented.")}setUniformInt(e,t){throw new Error("Method not implemented.")}setUniformVec21(e,t,n){throw new Error("Method not implemented.")}setUniformVec41(e,t,n,o,i){throw new Error("Method not implemented.")}setUniformMat31(e,t,n,o,i,a,s){throw new Error("Method not implemented.")}setUniformSampler(e,t,n){throw new Error("Method not implemented.")}context(){return this._context}name(){return this._name}program(){throw new Error("Method not implemented.")}getEmscriptenProgramId(){return this._emscriptenProgramId}prepare(){this._context.useMaterial(this)}bind(e,t){this._wasmMutableMaterial.bindWithoutTextures(e,t)}static from(e){return e}};function Ll(){return Bf}function CF(r){Bf=r}var ko=class ko{getGpuMetricsCollection(){return this._gpuMetricsCollection}stats(){return this._stats}width(){return this._cachedSize.x()|0}height(){return this._cachedSize.y()|0}maxTextureSize(){return this._cachedMaxTextureSize}supportsCompressedTextures(){return this._astc_extension!=null}astcExtension(){return this._astc_extension}_loadASTCCompressedTexturesExtension(){Y.shouldUseCompressedTextures()&&Y.shouldUseWebGL2()&&(this._astc_extension=this._gl.getExtension("WEBGL_compressed_texture_astc"))}glInternalFormat(e){switch(e){case 2:if(this.supportsCompressedTextures())return this.astcExtension().COMPRESSED_RGBA_ASTC_6x6_KHR;case 1:case 0:default:return this.gl().RGBA}}_loadOESStandardDerivativesExtension(e){let t=this._gl.getExtension("OES_standard_derivatives"),n=Y.shouldUseWebGL2();CF(n||t!==null),e&&!Bf&&!n&&Ae.trackEvent("missing_webgl_extensions",{extensions:["OES_standard_derivatives"]})}_resetState(){this._attributeCount=0,this._currentClearColor=O.TRANSPARENT,this._currentProgramInUse=null,this._currentVertexBuffer=null,this._currentVertexFormat=null,this._oldBlendState=null,this._oldBlendOperations=0,this._oldScissors=null,this._oldStencilState=lr.NONE,this._oldFramebuffer=null,this._oldViewport=G.new2(),this._boundWebGLFramebuffer=null,this._webGLFramebufferUsedForLastClearOrDraw=null,this._materialsToCheckProgramCreationStatus=[],this._numFramebufferSwitches=0}constructor(e){this._resetState(),this._stats=new rp,this._contextResetHandlers=[],this._forceStateUpdate=!0,this._generation=1,this._cachedSize=new b(0,0),this._defaultViewport=G.new2(),this._mockMaximumDrawingBufferSize=null,this._hasLoggedHighpPrecisionUnsupported=!1,this._gpuMetricsCollection=new ga.GpuMetricsCollection,this._gpuMetricsCollection.setBufferSize(2);let t={antialias:!1,depth:!1,stencil:!1,alpha:e.needsAlpha,preserveDrawingBuffer:oa,powerPreference:"high-performance"};if(this._gl=Uc(Y.shouldUseWebGL2(),t),Y.getFeatureFlags().viewer_retry_webgl_init&&this._gl==null&&(t.powerPreference="default",this._gl=Uc(Y.shouldUseWebGL2(),t)),this._gl==null)throw console.error("WebGL initialization failed"),new Error("Could not initialize WebGL");Y.useUnifiedRenderer()&&xc().then(i=>{md.bindContext(this._gl,t),i.initializeRenderer()}),this._loadASTCCompressedTexturesExtension(),this._loadOESStandardDerivativesExtension(!0);let n=this._gl.canvas,o=n.style;n.width=0,n.height=0,o.display="block",o.left="0",o.top="0",qt.EventTarget_addEventListener2(n,"webglcontextlost",i=>{console.warn("WebGL context was lost"),oi.Event_preventDefault(i)}),qt.EventTarget_addEventListener1(n,"webglcontextrestored",()=>{console.warn("WebGL context was restored"),this._resetState(),this._forceStateUpdate=!0,this._loadOESStandardDerivativesExtension(!1),this._generation=this._generation+1,this._stats.resetOnContextRestored();for(let i of this._contextResetHandlers)i()}),vy(this._gl),this._blendOperationMap=new Map([[0,this._gl.ZERO],[1,this._gl.ONE],[2,this._gl.SRC_COLOR],[3,this._gl.DST_COLOR],[4,this._gl.ONE_MINUS_SRC_COLOR],[5,this._gl.ONE_MINUS_DST_COLOR],[6,this._gl.SRC_ALPHA],[7,this._gl.DST_ALPHA],[8,this._gl.ONE_MINUS_SRC_ALPHA],[9,this._gl.ONE_MINUS_DST_ALPHA],[10,this._gl.CONSTANT_COLOR],[11,this._gl.ONE_MINUS_CONSTANT_COLOR]]),this._comparisonMap=new Map([[0,this._gl.ALWAYS],[1,this._gl.EQUAL],[2,this._gl.GREATER],[3,this._gl.GEQUAL],[4,this._gl.LESS],[5,this._gl.LEQUAL],[6,this._gl.NEVER],[7,this._gl.NOTEQUAL]]),this._operationMap=new Map([[0,this._gl.DECR],[1,this._gl.DECR_WRAP],[2,this._gl.INCR],[3,this._gl.INCR_WRAP],[4,this._gl.INVERT],[5,this._gl.KEEP],[6,this._gl.REPLACE],[7,this._gl.ZERO]]),this._cachedGraphicsCardName=null,this._cachedMaxTextureSize=Math.min(4096,this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE))|0,Jt.setMaxRes(this._cachedMaxTextureSize),this.hackToAvoidMissingTextureWarningInChrome=new zi(this,be.RGBA_NEAREST_CLAMP,1,1,Jt.createFromPixels(1,1,new Uint8Array(4)),null,"ChromeHack"),this._shouldFlushAfterDraws=this._detectShouldFlushAfterDraws()}gl(){return this._gl}generation(){return this._generation}addContextResetHandler(e){ne.List_appendOne(this._contextResetHandlers,e)}removeContextResetHandler(e){ne.List_removeOne(this._contextResetHandlers,e)}beginFrame(){this._checkMaterialProgramCreationStatuses()}flush(){this._gl.flush(),this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._flushes++}readPixels(e,t,n,o,i){var d;let a=o*i*4,s=new Uint8Array(a),l=(d=fd.from(e))==null?void 0:d.framebuffer();return this.bindWebGLFramebufferAndTrackForBudget(l),this._gl.readPixels(t,n,o,i,this.gl().RGBA,this.gl().UNSIGNED_BYTE,s),this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._totalBandwidth+=a,this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._readBandwidth+=a,this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._pixelReadBandwidth+=a,s}_reportClearOrDraw(){this._boundWebGLFramebuffer!=this._webGLFramebufferUsedForLastClearOrDraw&&this._numFramebufferSwitches++,this._webGLFramebufferUsedForLastClearOrDraw=this._boundWebGLFramebuffer}draw(e,t,n,o,i,a,s,l){n!=null&&Gc.WebGLRenderingContext_annotateBlock(this._gl,`material:${t.name()}`,()=>{if(n instanceof Rs&&(n=n.bufferArea()),n.buffer()==null){Oe("Tried to draw using null vertex buffer");return}i==null&&(i=lr.NONE),this._updateFramebufferAndViewport(a,l),t.prepare(),Bp.from(n.buffer()).prepare(t.format()),this._updateBlendState(o),this._updateStencilState(i),this._updateScissorState(s);let d=n.byteCount()/n.stride();switch(this._gl.drawArrays(e==0?this._gl.TRIANGLES:this._gl.TRIANGLE_STRIP,n.byteOffset()/n.stride()|0,d|0),this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._drawCalls++,this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._vertices+=d,e){case 0:this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._triangles+=d/3;break;case 1:this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._tristrips++;break;default:break}this._forceStateUpdate=!1,this._shouldFlushAfterDraws&&this.flush(),this._reportClearOrDraw()})}_setCanvasSize(e,t){this._mockMaximumDrawingBufferSize!=null&&(e=Math.min(this._mockMaximumDrawingBufferSize.value,e)|0,t=Math.min(this._mockMaximumDrawingBufferSize.value,t)|0);let n=e/ho(),o=t/ho(),i=this._gl.canvas;i.width=e,i.height=t,i.style.width=`${n}px`,i.style.height=`${o}px`;let a=this._gl.drawingBufferWidth,s=this._gl.drawingBufferHeight,l=a!=e||s!=t;return l&&(n=a/ho(),o=s/ho(),i.width=a,i.height=s,i.style.width=`${n}px`,i.style.height=`${o}px`),new sa(new b(a,s),l)}resizeDefaultFramebuffer(e,t){let n=!1;if((this._cachedSize.x()|0)!=e||(this._cachedSize.y()|0)!=t){let o=this._setCanvasSize(e,t);this._cachedSize=o.canvasSize,n=o.webGLDidAdjustCanvasSize,this._defaultViewport.setTo1(0,0,this._cachedSize.x()|0,this._cachedSize.y()|0)}return new sa(this._cachedSize,n)}_detectShouldFlushAfterDraws(){return!!(ko.detectFaultyAdrenoGPU(this.graphicsCardName())||Y.shouldFlushAfterDraws())}static detectFaultyAdrenoGPU(e){return/Adreno \(TM\) ([78])\d{2}/.test(e)}_shouldFlushAfterClear(){return!!(ca.hasDrawClearReorderingBug()||["Mesa Intel(R) Graphics (ADL GT2)","Mesa Intel(R) Xe Graphics (TGL GT2)"].indexOf(this.graphicsCardName())!=-1||Y.shouldFlushAfterClear())}clear(e,t,n,o,i){var a,s;t==null&&(t=O.TRANSPARENT),this._updateFramebufferAndViewport(n,i),this._oldBlendState==It.KEEP&&this._updateBlendState(It.COPY),this._updateScissorState(o),t!=this._currentClearColor&&(this._gl.clearColor(O.redF(t),O.greenF(t),O.blueF(t),O.alphaF(t)),this._currentClearColor=t),this._gl.clear((e!=2?this._gl.COLOR_BUFFER_BIT:0)|(e!=1?this._gl.DEPTH_BUFFER_BIT|this._gl.STENCIL_BUFFER_BIT:0)),this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._clears++,this._shouldFlushAfterClear()&&(this._gl.flush(),this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._flushes++),n!=null&&((e==0||e==1)&&((a=n.colorTexture())==null||a.markContentHasBeenInitialized()),(e==0||e==2)&&((s=n.depthStencilTexture())==null||s.markContentHasBeenInitialized())),this._reportClearOrDraw()}useMaterial(e){if(e instanceof xp){let t=Y.useUnifiedRenderer()?this._currentProgramInUseId!=e.getEmscriptenProgramId():this._currentProgramInUse!=e.program();(this._forceStateUpdate||t)&&(this._gl.useProgram(e.program()),this._gpuMetricsCollection.referenceShaderProgram(e.program()),this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._shaderChanges++)}else e.bind(this._currentProgramInUseId,this._forceStateUpdate);Y.useUnifiedRenderer()?this._currentProgramInUseId=e.getEmscriptenProgramId():this._currentProgramInUse=e.program()}bindVertexBufferWithFormat(e,t){if((this._forceStateUpdate||this._currentVertexBuffer!=e)&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,e),this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._vertexBuffersReferenced++,this._currentVertexBuffer=e,this._currentVertexFormat=null),this._currentVertexFormat!=t){let n=this._gl,o=t.attributes(),i=o.length;for(let a=0,s=i;a<s;a=a+1){let l=o[a],d=l.type==1;n.vertexAttribPointer(a,l.count,d?n.UNSIGNED_BYTE:n.FLOAT,d,t.stride(),l.byteOffset)}for(;this._attributeCount<i;)n.enableVertexAttribArray(this._attributeCount),this._attributeCount=this._attributeCount+1;for(;this._attributeCount>i;)this._attributeCount=this._attributeCount-1,n.disableVertexAttribArray(this._attributeCount);this._attributeCount=i,this._currentVertexFormat=t}}isContextLost(){return this._gl.isContextLost()}graphicsCardName(){if(this._cachedGraphicsCardName!=null)return this._cachedGraphicsCardName;let e=this._gl.getExtension("WEBGL_debug_renderer_info");return e===null?this._cachedGraphicsCardName="Unknown":this._cachedGraphicsCardName=this._gl.getParameter(e.UNMASKED_RENDERER_WEBGL),this._cachedGraphicsCardName}isVisible(){let e=this._gl.canvas;return!e||!qu.Node_isConnected(e)?!1:Zu.Element_isVisible(e)}setMaximumDrawingBufferSizeForTesting(e){this._mockMaximumDrawingBufferSize=new ce(e)}clearMaximumDrawingBufferSizeForTesting(){this._mockMaximumDrawingBufferSize=null}createMaterial(e,t,n,o){return new xp(this,e,t,n,o)}createVertexBuffer(e,t){return new Bp(this,e,t)}createTexture(e,t,n,o){return this.createTextureWithPixels(e,t,n,null,o)}createTextureWithPixels(e,t,n,o,i){return new zi(this,e,t,n,Jt.createFromPixels(t,n,o),null,i)}createTextureWithVideo(e,t,n){return new zi(this,e,t.videoWidth,t.videoHeight,null,t,n)}createFramebuffer(e,t,n){return new fd(this,zi.from(e),zi.from(t),n)}annotate(e,t){t()}annotateAndReturn(e,t){return t()}addMaterialToCheckProgramCreationStatusAsync(e){this._materialsToCheckProgramCreationStatus.push(e)}_checkMaterialProgramCreationStatuses(){if(this._materialsToCheckProgramCreationStatus.length!=0){for(let e of this._materialsToCheckProgramCreationStatus)e.haveCheckedProgramCreationStatus()||e.checkProgramCreationStatus();this._materialsToCheckProgramCreationStatus.length=0}}annotateProfile(e,t){t()}takeSpectorSnapshot(){Wa.takeSnapshot(this.gl().canvas)}_updateFramebufferAndViewport(e,t){let n=fd.from(e),o=t??(n==null?void 0:n.bounds());n||(o=this._defaultViewport);let i=this._gl;if(this._forceStateUpdate||this._oldFramebuffer!=n){let a=n==null?void 0:n.framebuffer();this.bindWebGLFramebufferAndTrackForBudget(a),this._oldFramebuffer=n,ca.hasViewportBug()&&this._oldViewport.equals(o)&&(this._oldViewport.setX(o.x()+1),i.viewport(this._oldViewport.x()|0,this._oldViewport.y()|0,this._oldViewport.width()|0,this._oldViewport.height()|0),i.clear(0),this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._clears++)}(this._forceStateUpdate||!this._oldViewport.equals(o))&&(i.viewport(o.x()|0,o.y()|0,o.width()|0,o.height()|0),this._oldViewport.copyFrom(o))}_updateBlendState(e){let t=ko._packBlendModes(e.sourceColor,e.targetColor,e.sourceAlpha,e.targetAlpha);if(this._forceStateUpdate||this._oldBlendOperations!=t||this._oldBlendState.constant!=e.constant){let n=this._gl,o=t,i=this._oldBlendOperations,a=o&255,s=o>>8&255,l=o>>16&255,d=o>>24,c=e.constant;o==ko.KEEP_BLEND_OPERATIONS?n.colorMask(!1,!1,!1,!1):((this._forceStateUpdate||i==ko.KEEP_BLEND_OPERATIONS)&&n.colorMask(!0,!0,!0,!0),o==ko.COPY_BLEND_OPERATIONS?(n.disable(n.BLEND),this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._glDisables++):((this._forceStateUpdate||i==ko.COPY_BLEND_OPERATIONS||i==ko.KEEP_BLEND_OPERATIONS)&&(n.enable(n.BLEND),this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._glEnables++),n.blendFuncSeparate(this._blendOperationMap.get(a),this._blendOperationMap.get(s),this._blendOperationMap.get(l),this._blendOperationMap.get(d)),n.blendColor(c,c,c,c))),this._oldBlendState=e,this._oldBlendOperations=t}}_updateStencilState(e){let t=this._gl,n=this._oldStencilState,o=e,i=o.frontFace,a=o.backFace,s=i==a?t.FRONT_AND_BACK:t.FRONT;(this._forceStateUpdate||!n.equals(o))&&((this._forceStateUpdate||n.isEnabled!=o.isEnabled)&&(o.isEnabled?(t.enable(t.STENCIL_TEST),this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._glEnables++):(t.disable(t.STENCIL_TEST),this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._glDisables++)),t.stencilFuncSeparate(s,this._comparisonMap.get(i.comparison),o.reference,o.readMask),t.stencilOpSeparate(s,this._operationMap.get(i.stencilFail),this._operationMap.get(i.stencilPassDepthPass),this._operationMap.get(i.stencilPassDepthPass)),t.stencilMaskSeparate(s,o.writeMask),i!=a&&(t.stencilFuncSeparate(t.BACK,this._comparisonMap.get(a.comparison),o.reference,o.readMask),t.stencilOpSeparate(t.BACK,this._operationMap.get(a.stencilFail),this._operationMap.get(a.stencilPassDepthPass),this._operationMap.get(a.stencilPassDepthPass)),t.stencilMaskSeparate(t.BACK,o.writeMask)),this._oldStencilState=o)}_updateScissorState(e){let t=e??null;t==null?(this._oldScissors!=null&&(this._gl.disable(this._gl.SCISSOR_TEST),this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._glDisables++),this._oldScissors=null):(this._oldScissors==null&&(this._gl.enable(this._gl.SCISSOR_TEST),this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._glEnables++),(this._oldScissors==null||!t.equals(this._oldScissors))&&(this._gl.scissor(t.x()|0,t.y()|0,Math.max(t.width(),0)|0,Math.max(t.height(),0)|0),this._oldScissors==null&&(this._oldScissors=G.new2()),this._oldScissors.copyFrom(t)))}hasLoggedHighpPrecisionUnsupported(){return this._hasLoggedHighpPrecisionUnsupported}setHasLoggedHighpPrecisionUnsupported(){this._hasLoggedHighpPrecisionUnsupported=!0}static from(e){return e}static _packBlendModes(e,t,n,o){return e|t<<8|n<<16|o<<24}getNumFramebufferSwitches(){return this._numFramebufferSwitches}resetNumFramebufferSwitches(){this._numFramebufferSwitches=0}bindWebGLFramebufferAndTrackForBudget(e){this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,e),this._boundWebGLFramebuffer=e,this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._framebufferBinds++}};ko.COPY_BLEND_OPERATIONS=ko._packBlendModes(1,0,1,0),ko.KEEP_BLEND_OPERATIONS=ko._packBlendModes(0,1,0,1);var di=ko,za=class{location(){let e=di.from(this._material.context());return this._generation!=e.generation()&&(this._location=e.gl().getUniformLocation(this._material.program(),this._name),this._generation=e.generation()),this._location}constructor(e,t){this._material=e,this._name=t,this._generation=0,this._location=null,this._isDirty=!0}},Nf=class extends za{set(e){e!=this._x&&(this._x=e,this._isDirty=!0)}prepare(){let e=di.from(this._material.context());(this._generation!=e.generation()||this._isDirty)&&(e.gl().uniform1f(this.location(),this._x),this._isDirty=!1,e.getGpuMetricsCollection().getCurrentFrameGPUMetrics().logUniformVariableSet(4))}constructor(e,t){super(e,t),this._x=0}},Pf=class extends za{set(e){e!=this._x&&(this._x=e,this._isDirty=!0)}prepare(){let e=di.from(this._material.context());(this._generation!=e.generation()||this._isDirty)&&(e.gl().uniform1i(this.location(),this._x),this._isDirty=!1,e.getGpuMetricsCollection().getCurrentFrameGPUMetrics().logUniformVariableSet(4))}constructor(e,t){super(e,t),this._x=0}},Ff=class extends za{set(e,t){(e!=this._x||t!=this._y)&&(this._x=e,this._y=t,this._isDirty=!0)}prepare(){let e=di.from(this._material.context());(this._generation!=e.generation()||this._isDirty)&&(e.gl().uniform2f(this.location(),this._x,this._y),this._isDirty=!1,e.getGpuMetricsCollection().getCurrentFrameGPUMetrics().logUniformVariableSet(8))}constructor(e,t){super(e,t),this._x=0,this._y=0}},Df=class extends za{set(e,t,n,o){(e!=this._x||t!=this._y||n!=this._z||o!=this._w)&&(this._x=e,this._y=t,this._z=n,this._w=o,this._isDirty=!0)}prepare(){let e=di.from(this._material.context());(this._generation!=e.generation()||this._isDirty)&&(e.gl().uniform4f(this.location(),this._x,this._y,this._z,this._w),this._isDirty=!1,e.getGpuMetricsCollection().getCurrentFrameGPUMetrics().logUniformVariableSet(16))}constructor(e,t){super(e,t),this._x=0,this._y=0,this._z=0,this._w=0}},ro=class ro extends za{set(e,t,n,o,i,a){ro._cachedFloat32Values[0]=e,ro._cachedFloat32Values[1]=o,ro._cachedFloat32Values[3]=t,ro._cachedFloat32Values[4]=i,ro._cachedFloat32Values[6]=n,ro._cachedFloat32Values[7]=a;for(let s=0;s<9;s=s+1)if(!(Number.isNaN(ro._cachedFloat32Values[s])&&Number.isNaN(this._float32Values[s])||ro._cachedFloat32Values[s]===1/0&&this._float32Values[s]===1/0||ro._cachedFloat32Values[s]===-1/0&&this._float32Values[s]===-1/0)&&Math.abs(ro._cachedFloat32Values[s]-this._float32Values[s])>=1e-5){let l=this._float32Values;this._float32Values=ro._cachedFloat32Values,ro._cachedFloat32Values=l,this._isDirty=!0;break}}prepare(){let e=di.from(this._material.context());(this._generation!=e.generation()||this._isDirty)&&(e.gl().uniformMatrix3fv(this.location(),!1,this._float32Values),this._isDirty=!1,e.getGpuMetricsCollection().getCurrentFrameGPUMetrics().logUniformVariableSet(36))}constructor(e,t){super(e,t),this._float32Values=new Float32Array([1,0,0,0,1,0,0,0,1])}};ro._cachedFloat32Values=new Float32Array([1,0,0,0,1,0,0,0,1]);var wf=ro,Lf=class extends za{set(e,t){(this._texture!=e||this._index!=t)&&(this._texture=zi.from(e),this._index=t,this._isDirty=!0)}prepare(){let e=di.from(this._material.context()),t=this._texture,n=e.gl();t==null&&(t=e.hackToAvoidMissingTextureWarningInChrome),(this._generation!=e.generation()||this._isDirty)&&(n.uniform1i(this.location(),this._index),this._isDirty=!1,e.getGpuMetricsCollection().getCurrentFrameGPUMetrics().logUniformVariableSet(4)),n.activeTexture(Gc.WebGLRenderingContext_TEXTURE_N(n,this._index)),n.bindTexture(n.TEXTURE_2D,t.texture()),e.getGpuMetricsCollection().getCurrentFrameGPUSubMetrics()._texturesReferenced++}constructor(e,t){super(e,t),this._texture=null,this._index=-1}},xp=class{constructor(e,t,n,o,i){this._context=null,this._name=null,this._format=null,this._vertexSource=null,this._fragmentSource=null,this._uniformsMap=new Map,this._uniformsList=[],this._generation=0,this._program=null,this._haveCheckedProgramCreationStatus=!1,this._context=e,this._name=t,this._format=n,this._vertexSource=o,this._fragmentSource=i,this._createProgram(),Y.useUnifiedRenderer()&&xc().then(()=>{this._emscriptenProgramId=md.getNewProgramId()}),this._context.addMaterialToCheckProgramCreationStatusAsync(this)}context(){return this._context}name(){return this._name}format(){return this._format}setUniformFloat(e,t){let n=Ge.StringMap_get(this._uniformsMap,e,null);n==null&&(n=new Nf(this,e),this._uniformsMap.set(e,n),this._uniformsList.push(n)),n.set(t)}setUniformInt(e,t){let n=Ge.StringMap_get(this._uniformsMap,e,null);n==null&&(n=new Pf(this,e),this._uniformsMap.set(e,n),this._uniformsList.push(n)),n.set(t)}setUniformVec21(e,t,n){let o=Ge.StringMap_get(this._uniformsMap,e,null);o==null&&(o=new Ff(this,e),this._uniformsMap.set(e,o),this._uniformsList.push(o)),o.set(t,n)}setUniformVec41(e,t,n,o,i){let a=Ge.StringMap_get(this._uniformsMap,e,null);a==null&&(a=new Df(this,e),this._uniformsMap.set(e,a),this._uniformsList.push(a)),a.set(t,n,o,i)}setUniformMat31(e,t,n,o,i,a,s){let l=Ge.StringMap_get(this._uniformsMap,e,null);l==null&&(l=new wf(this,e),this._uniformsMap.set(e,l),this._uniformsList.push(l)),l.set(t,n,o,i,a,s)}setUniformSampler(e,t,n){let o=Ge.StringMap_get(this._uniformsMap,e,null);o==null&&(o=new Lf(this,e),this._uniformsMap.set(e,o),this._uniformsList.push(o)),o.set(t,n)}program(){return this._generation!=this._context.generation()&&(this._createProgram(),this.checkProgramCreationStatus()),this._program}getEmscriptenProgramId(){return this._emscriptenProgramId}prepare(){this._context.useMaterial(this);for(let e of this._uniformsList)e.prepare()}haveCheckedProgramCreationStatus(){return this._haveCheckedProgramCreationStatus}checkProgramCreationStatus(){if(this._generation!=this._context.generation())return;let e=this._context.gl();(()=>{if(e.getProgramParameter(this._program,e.LINK_STATUS))return;let n=a=>a.replace(new RegExp("\\bhighp\\b","g"),"mediump"),o=e.getAttachedShaders(this._program);if(o==null)throw new Error(`Failed to link shader ${this.name()}: ${e.getProgramInfoLog(this._program)}`);let i=!1;for(let a of o){if(e.getShaderParameter(a,e.COMPILE_STATUS))continue;i=!0;let s=e.getShaderParameter(a,e.SHADER_TYPE);if(s===e.VERTEX_SHADER)this._vertexSource=n(this._vertexSource);else if(s===e.FRAGMENT_SHADER)this._fragmentSource=n(this._fragmentSource);else{if(e.isContextLost())return;throw new Error(`Unexpected shader type: ${s}`)}}if(!i){if(e.isContextLost())return;throw new Error(`Failed to link shader ${this.name()}: ${e.getProgramInfoLog(this._program)}`)}if(this._createProgram(),e.getProgramParameter(this._program,e.LINK_STATUS)){this.context().hasLoggedHighpPrecisionUnsupported()||(Ae.trackEvent("highp_unsupported_device",{}),this.context().setHasLoggedHighpPrecisionUnsupported());return}if(o=e.getAttachedShaders(this._program),o==null)throw new Error(`Failed to link shader ${this.name()}: ${e.getProgramInfoLog(this._program)}`);for(let a of o)if(!e.getShaderParameter(a,e.COMPILE_STATUS)){if(e.isContextLost())return;{let s=e.getShaderInfoLog(a);throw new Error(s)}}if(!e.isContextLost())throw new Error(`Failed to link shader ${this.name()}: ${e.getProgramInfoLog(this._program)}`)})(),this._haveCheckedProgramCreationStatus=!0}_createProgram(){let e=this._context.gl();if(this._program=e.createProgram(),Wa.addDebugMetadataToWebGLObject(this._program,{name:this._name}),!this._compileShader(e,e.VERTEX_SHADER,this._vertexSource)||!this._compileShader(e,e.FRAGMENT_SHADER,this._fragmentSource))return;let t=this.format().attributes();for(let n=0,o=t.length;n<o;n=n+1)e.bindAttribLocation(this._program,n,t[n].name);e.linkProgram(this._program),this._generation=this._context.generation(),this._haveCheckedProgramCreationStatus=!1}_compileShader(e,t,n){let o=e.createShader(t);return o?(e.shaderSource(o,n),e.compileShader(o),e.attachShader(this._program,o),!0):!1}static from(e){return e}},wl=class wl{constructor(e,t,n){this._generation=0,this._initialGeneration=e.generation(),this._buffer=null,this._isDirty=!0,this._dirtyMin=wl.INT_MAX,this._dirtyMax=0,this._totalMin=wl.INT_MAX,this._totalMax=0,this._byteCount=0,this._glByteCount=0,this._context=e,this._byteCount=t,this._discardBytesAfterUpload=n,this._bytesForUploadMin=0,this._discardBytesAfterUpload?this._bytesForUploadMax=0:(this._bytesForUpload=new Uint8Array(t),this._bytesForUploadMax=this._byteCount)}context(){return this._context}bytesForUpload(){return this._bytesForUpload}byteCount(){return this._byteCount}moveBytesForUpload(e,t,n){e!=t&&n!=0&&(this._bytesForUpload.set(this._bytesForUpload.subarray(e,e+n),t),this._growDirtyRegion(Math.min(e,t),Math.max(e,t)+n))}setBytesForUpload(e,t){if(this._growDirtyRegion(t,t+e.length),!this._discardBytesAfterUpload){this._bytesForUpload.set(e,t);return}if(this._bytesForUpload==null){this._bytesForUpload=new Uint8Array(e),this._bytesForUploadMin=t,this._bytesForUploadMax=t+e.length;return}let n=Math.min(this._bytesForUploadMin,t),o=Math.max(this._bytesForUploadMax,t+e.length),i=this._bytesForUpload;this._bytesForUpload=new Uint8Array(o-n),this._bytesForUpload.set(i,this._bytesForUploadMin-n),this._bytesForUpload.set(e,t-n),this._bytesForUploadMin=n,this._bytesForUploadMax=o}prepare(e){let t=this._context.gl();if(this._initialGeneration!=this._context.generation()&&this._discardBytesAfterUpload){Oe("unexpectedly tried to re-create a vertex buffer with discardBytesAfterUpload");return}if(this._generation!=this._context.generation()&&(this._buffer=t.createBuffer(),this._context.getGpuMetricsCollection().getCurrentFrameGPUSubMetrics()._vertexBuffersCreated++,Wa.addDebugMetadataToWebGLObject(this._buffer,{purpose:"Vertex Buffer"}),this._generation=this._context.generation(),this._isDirty=!0),this._context.bindVertexBufferWithFormat(this._buffer,e),this._context.getGpuMetricsCollection().getCurrentFrameGPUSubMetrics()._vertexBuffersReferenced++,this._isDirty){let n=this._glByteCount;t.bufferData(t.ARRAY_BUFFER,this._byteCount,t.DYNAMIC_DRAW),this._context.getGpuMetricsCollection().getCurrentFrameGPUSubMetrics()._totalBandwidth+=this._byteCount,this._context.getGpuMetricsCollection().getCurrentFrameGPUSubMetrics()._writeBandwidth+=this._byteCount,this._context.getGpuMetricsCollection().getCurrentFrameGPUSubMetrics()._vertexBufferWriteBandwidth+=this._byteCount,this._glByteCount=this.byteCount(),this._context.stats().increment(1,"all",this._glByteCount-n),this._dirtyMin=this._totalMin,this._dirtyMax=this._totalMax,this._isDirty=!1}if(this._dirtyMin<this._dirtyMax){let n=this._bytesForUpload.subarray(this._dirtyMin-this._bytesForUploadMin,this._dirtyMax-this._bytesForUploadMin);t.bufferSubData(t.ARRAY_BUFFER,this._dirtyMin,n),this._context.getGpuMetricsCollection().getCurrentFrameGPUSubMetrics()._totalBandwidth+=n.length,this._context.getGpuMetricsCollection().getCurrentFrameGPUSubMetrics()._writeBandwidth+=n.length,this._context.getGpuMetricsCollection().getCurrentFrameGPUSubMetrics()._vertexBufferWriteBandwidth+=n.length,this._context.getGpuMetricsCollection().getCurrentFrameGPUSubMetrics()._vertexBufferUploadCount+=1,this._dirtyMin=wl.INT_MAX,this._dirtyMax=0,this._discardBytesAfterUpload&&(this._bytesForUpload=null,this._bytesForUploadMin=0,this._bytesForUploadMax=0)}}_growDirtyRegion(e,t){this._dirtyMin=Math.min(this._dirtyMin,e),this._dirtyMax=Math.max(this._dirtyMax,t),this._totalMin=Math.min(this._totalMin,e),this._totalMax=Math.max(this._totalMax,t)}static from(e){return e}};wl.INT_MAX=2147483647;var Bp=wl,zi=class{context(){return this._context}format(){return this._format}width(){return this._width}height(){return this._height}hasContentBeenInitialized(){return this.isRenderbuffer()?this.renderbuffer():this.texture(),this._hasContentBeenInitialized}markContentHasBeenInitialized(){this._hasContentBeenInitialized=!0}setShouldUnloadImageBuffer(e){this._shouldUnloadImageBuffer=e}_currentGlTextureSizeInBytes(){let e=this._glTextureWidth*this._glTextureHeight*vs.PixelFormat_byteCount(this._format.pixelFormat);return this._useMipmap&&(e+=e*.33),e|0}deleteTexture(){this._texture!=null?(this._context.gl().deleteTexture(this._texture),this._context.getGpuMetricsCollection().getCurrentFrameGPUSubMetrics()._texturesDestroyed++,this._context.stats().decrement(0,this._purpose,this._currentGlTextureSizeInBytes())):this._renderbuffer!=null&&(this._context.gl().deleteRenderbuffer(this._renderbuffer),this._context.stats().decrement(2,this._purpose,this._width*this._height*4))}resize1(e,t,n,o){this._width=e,this._height=t,this._pixels=n,this._useMipmap=o,this._isContentDirty=!0}_needsUploadToGPUTexture(){return this._isContentDirty||this._video!=null}setFormat(e){this._format!=e&&(this._format=e,this._isFormatDirty=!0)}isRenderbuffer(){return this._format.pixelFormat==1}invalidateVideoFrame(){this._isVideoFrameDirty=!0}texture(){let e=this._context.gl();if(this._generation!=this._context.generation()){if(this._texture=e.createTexture(),this._texture==null)return this._texture;this._context.getGpuMetricsCollection().getCurrentFrameGPUSubMetrics()._texturesCreated++,Wa.addDebugMetadataToWebGLObject(this._texture,{purpose:this._purpose}),this._generation=this._context.generation(),this._isFormatDirty=!0,this._isContentDirty=!0,this._hasContentBeenInitialized=!1}if(this._isFormatDirty&&(e.bindTexture(e.TEXTURE_2D,this._texture),this._context.getGpuMetricsCollection().getCurrentFrameGPUSubMetrics()._texturesReferenced++,e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,this.format().magFilter==0?e.NEAREST:e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,this.format().minFilter==0?e.NEAREST:e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,this.format().wrap==0?e.REPEAT:e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,this.format().wrap==0?e.REPEAT:e.CLAMP_TO_EDGE),this._isFormatDirty=!1),this._needsUploadToGPUTexture()){let t=this._currentGlTextureSizeInBytes();e.bindTexture(e.TEXTURE_2D,this._texture),this._context.getGpuMetricsCollection().getCurrentFrameGPUSubMetrics()._texturesReferenced++;let n=this._width*this._height*vs.PixelFormat_byteCount(this.format().pixelFormat);if(this._context.getGpuMetricsCollection().getCurrentFrameGPUSubMetrics()._totalBandwidth+=n,this._context.getGpuMetricsCollection().getCurrentFrameGPUSubMetrics()._writeBandwidth+=n,this._context.getGpuMetricsCollection().getCurrentFrameGPUSubMetrics()._textureWriteBandwidth+=n,this._context.getGpuMetricsCollection().getCurrentFrameGPUSubMetrics()._textureUploadCount+=1,this._video!=null)this._isVideoFrameDirty&&(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this._video),this._isVideoFrameDirty=!1,this._hasContentBeenInitialized=!0);else{if(this._pixels==null)return Oe("Tried to reupload image data after unloading it"),this._texture;let i=this._pixels.pixels;if(this._context.supportsCompressedTextures()&&this.format().isCompressedFormat()){let a=this._context.glInternalFormat(this.format().pixelFormat);e.compressedTexImage2D(e.TEXTURE_2D,0,a,this._width,this._height,0,i.array),this._hasContentBeenInitialized=i.array!=null}else i.imageBitmap!=null?(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,i.imageBitmap),this._hasContentBeenInitialized=!0):i.img!=null?(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,i.img),this._hasContentBeenInitialized=!0):i.canvas!=null?(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,i.canvas),this._hasContentBeenInitialized=!0):(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this._width,this._height,0,e.RGBA,e.UNSIGNED_BYTE,i.array),this._hasContentBeenInitialized=i.array!=null);if(this._shouldUnloadImageBuffer){let a=N().modules().corePerfInfo;a==null||a.imageMemStatsFree(xa.BUFFER,this._pixels.memorySize()),this._pixels=null}}this._glTextureWidth=this._width,this._glTextureHeight=this._height,this._useMipmap&&(e.generateMipmap(e.TEXTURE_2D),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR));let o=this._currentGlTextureSizeInBytes();this._context.stats().increment(0,this._purpose,o-t),this._isContentDirty=!1}return this._texture}renderbuffer(){let e=this._context.gl();if(this._generation!=this._context.generation()){if(this._renderbuffer=e.createRenderbuffer(),this.renderbuffer==null)return this.renderbuffer;Wa.addDebugMetadataToWebGLObject(this._renderbuffer,{purpose:this._purpose}),this._generation=this._context.generation(),this._isContentDirty=!0,this._hasContentBeenInitialized=!1}if(this._isContentDirty){e.bindRenderbuffer(e.RENDERBUFFER,this._renderbuffer),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,this._width,this._height);let t=this._width*this._height*4;this._context.stats().increment(2,this._purpose,t),this._isContentDirty=!1,this._hasContentBeenInitialized=!1}return this._renderbuffer}static from(e){return e}constructor(e,t,n,o,i,a,s){this._context=e,this._format=t,this._width=n,this._height=o,this._pixels=i,this._video=a,this._purpose=s,this._shouldUnloadImageBuffer=!1,this._useMipmap=!1,this._renderbuffer=null,this._texture=null,this._generation=0,this._isFormatDirty=!0,this._isContentDirty=!0,this._isVideoFrameDirty=!0,this._hasContentBeenInitialized=!1,this._glTextureWidth=0,this._glTextureHeight=0}},fd=class{context(){return this._context}colorTexture(){return this._colorTexture}depthStencilTexture(){return this._depthStencilTexture}setColorTexture(e){this._colorTexture!=e&&(this._colorTexture=zi.from(e),this._isDirty=!0)}resize(e,t){this._colorTexture!=null&&(e!=this._colorTexture.width()||t!=this._colorTexture.height())&&(this._colorTexture.resize1(e,t,null,!1),this._isDirty=!0),this._depthStencilTexture!=null&&(e!=this._depthStencilTexture.width()||t!=this._depthStencilTexture.height())&&(this._depthStencilTexture.resize1(e,t,null,!1),this._isDirty=!0)}setDepthStencil(e){this._depthStencilTexture!=e&&(this._depthStencilTexture=zi.from(e),this._isDirty=!0)}framebuffer(){let e=this._context.gl();if(this._generation!=this._context.generation()){if(this._framebuffer=e.createFramebuffer(),this._framebuffer==null)return this._framebuffer;Wa.addDebugMetadataToWebGLObject(this._framebuffer,{purpose:this._purpose}),this._generation=this._context.generation(),this._isDirty=!0}return this._isDirty&&(this._context.bindWebGLFramebufferAndTrackForBudget(this._framebuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this._colorTexture.texture(),0),this._depthStencilTexture!=null&&e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,this._depthStencilTexture.renderbuffer()),this._isDirty=!1),this._framebuffer}deleteTexture(){var e,t;(e=this._colorTexture)==null||e.deleteTexture(),(t=this._depthStencilTexture)==null||t.deleteTexture(),this._context.gl().deleteFramebuffer(this._framebuffer)}bounds(){var e,t;return new G(0,0,((e=this._colorTexture)==null?void 0:e.width())??0,((t=this._colorTexture)==null?void 0:t.height())??0)}static from(e){return e}constructor(e,t,n,o){this._context=e,this._colorTexture=t,this._depthStencilTexture=n,this._purpose=o,this._framebuffer=null,this._generation=0,this._isDirty=!0}},Wa;(l=>{function r(d){if(!window.spector){console.error("Can't take a Spector.js snapshot because Spector isn't loaded. Go here to install the Chrome extension: https://chrome.google.com/webstore/detail/spectorjs/denbgaamihkadbghdceggmchnflmhpmk?hl=en");return}window.spector.captureNextFrame(d)}l.takeSnapshot=r;function e(d,c){}l.addDebugMetadataToWebGLObject=e;function t(d,c){c()}l.annotate=t;function n(d,c){return c()}l.annotateAndReturn=n;function o(d){l._scopeStack.push(d),a()}l._beginScope=o;function i(d){l._scopeStack.pop(),a()}l._endScope=i;function a(){if(l._scopeStack.length==0)window.spector.clearMarker();else{let d=l._scopeStack.join(" > ");window.spector.setMarker(d)}}l._updateMarker=a,l._scopeStack=[]})(Wa||(Wa={}));var Bf=!0;var ui=class ui{constructor(e,t,n){this.center=null,this.xRadius=0,this.yRadius=0,this._hash=0,this._cachedBezier=null,this.center=e,this.xRadius=t,this.yRadius=n,ui.hasher.reset(),ui.hasher.hash1(this.center.x()),ui.hasher.hash1(this.center.y()),ui.hasher.hash1(this.xRadius),ui.hasher.hash1(this.yRadius),this._hash=ui.hasher.value()}bounds(){return new G(this.center.x()-this.xRadius,this.center.y()-this.yRadius,this.xRadius*2,this.yRadius*2)}equals2(e){return e instanceof ui?this.equals1(e):!1}equals1(e){return this.center.equals(e.center)&&this.xRadius==e.xRadius&&this.yRadius==e.yRadius}clone(){return new ui(this.center.clone(),this.xRadius,this.yRadius)}hash(){return this._hash}isRect(){return!1}canBeAnalyticallyAntialiased(){return Ll()}toBezierPath(){return this._cachedBezier==null&&(this._cachedBezier=Rt.forEllipse(this.bounds())),this._cachedBezier}asRoundedRectPath(){return null}static fromBounds(e){return new ui(e.center(),e.width()/2,e.height()/2)}};ui.hasher=new go;var Aa=ui;var Tn=class Tn{constructor(e,t){this._rect=null,this._radii=null,this._hash=0,this._cachedBezier=null,this._rect=e,this._radii=t.clippedForRectOfBounds(e),Tn.hasher.reset(),Tn.hasher.hash1(this._rect.x()),Tn.hasher.hash1(this._rect.y()),Tn.hasher.hash1(this._rect.width()),Tn.hasher.hash1(this._rect.height()),Tn.hasher.hash1(this._radii.topLeft),Tn.hasher.hash1(this._radii.topRight),Tn.hasher.hash1(this._radii.bottomRight),Tn.hasher.hash1(this._radii.bottomLeft),this._hash=Tn.hasher.value()}radii(){return this._radii}bounds(){return this._rect}equals2(e){return e instanceof Tn?this.equals1(e):!1}equals1(e){return this._rect.equals(e._rect)&&this._radii.equals(e._radii)}clone(){return new Tn(this._rect.clone(),this._radii)}hash(){return this._hash}isRect(){return this._radii.isZeros()}canBeAnalyticallyAntialiased(){return Ll()}toBezierPath(){return this._cachedBezier==null&&(this._cachedBezier=Rt.fromRoundedRect3(this._rect.x(),this._rect.y(),this._rect.width(),this._rect.height(),this._radii.toList())),this._cachedBezier}asRoundedRectPath(){return this}static fromRect(e){return new Tn(e,Ao.fromNodeRadius(0))}static fromRoundedRect(e){let t=e.vertexRadii()!=null?Ao.fromList(e.vertexRadii()):e.nodeRadius()!=0?Ao.fromNodeRadius(e.nodeRadius()):Ao.ZEROS;return new Tn(e.rect(),t)}static isRoundedRectSupportedIgnoringCornerSmoothing(e){let t=e.vertexRadii();if(t!=null){let n=Math.max(Math.max(t[0],t[1]),Math.max(t[2],t[3])),o=Math.min(e.width()/2,e.height()/2);if(n>o)return!1}return!0}static isRoundedRectSupported(e){return e.cornerSmoothing()!=0?!1:Tn.isRoundedRectSupportedIgnoringCornerSmoothing(e)}};Tn.hasher=new go;var St=Tn,Sa=class Sa{constructor(e,t,n,o){this.topLeft=0,this.topRight=0,this.bottomRight=0,this.bottomLeft=0,this.topLeft=Math.max(e,0),this.topRight=Math.max(t,0),this.bottomRight=Math.max(n,0),this.bottomLeft=Math.max(o,0)}isZeros(){return this.topLeft==0&&this.topRight==0&&this.bottomRight==0&&this.bottomLeft==0}isUniform(){return this.topRight==this.topLeft&&this.bottomRight==this.topLeft&&this.bottomLeft==this.topLeft}equals(e){return this.topLeft==e.topLeft&&this.topRight==e.topRight&&this.bottomRight==e.bottomRight&&this.bottomLeft==e.bottomLeft}clippedForRectOfBounds(e){let t=Math.min(e.width()/2,e.height()/2);return new Sa(Math.min(this.topLeft,t),Math.min(this.topRight,t),Math.min(this.bottomRight,t),Math.min(this.bottomLeft,t))}toList(){return[this.topLeft,this.topRight,this.bottomRight,this.bottomLeft]}static fromList(e){return new Sa(e[0],e[1],e[2],e[3])}static fromNodeRadius(e){return new Sa(e,e,e,e)}static fromRoundedRect(e){return e.vertexRadii()!=null?Sa.fromList(e.vertexRadii()):Sa.fromNodeRadius(e.nodeRadius())}};Sa.ZEROS=new Sa(0,0,0,0);var Ao=Sa;var no=class r{constructor(e){this.handle=0,this._cachedInfo=null,this._hash=0,this.handle=e}_updateCachedInfoIfNecessary(){if(this._cachedInfo==null){let e=N().modules().uniquePath_Internal.bounds(this.handle),t=e.max.x-e.min.x,n=e.max.y-e.min.y,o=new G(e.min.x,e.min.y,t,n);this._cachedInfo=new hd(o,N().modules().uniquePath_Internal.isRect(this.handle))}}bounds(){return this._updateCachedInfoIfNecessary(),this._cachedInfo.bounds}equals2(e){return e instanceof r?this.handle==e.handle:!1}clone(){return new r(this.handle)}hash(){return this._hash==null&&(this._hash=N().modules().uniquePath_Internal.getHash(this.handle)),this._hash}isRect(){return this._updateCachedInfoIfNecessary(),this._cachedInfo.isRect}canBeAnalyticallyAntialiased(){return!1}toBezierPath(){throw new Error("We should never need to copy UniquePath data into JS")}asRoundedRectPath(){return null}compileLoopBlinnAndReturnVolatileTriangles(){let e=N().modules().uniquePath_Internal.loopBlinnCompile(this.handle);return e??(Oe("Failed to compile UniquePath"),bF)}},bF=new Uint8Array([]);var Ka;(e=>{function r(t){return t!="NONE"&&t!="PRESENTATION"}e.hasDevice=r})(Ka||(Ka={}));var zt;(o=>{function r(i){return i=="BOOLEAN_OPERATION"||i=="VECTOR"||i=="STAR"||i=="LINE"||i=="ELLIPSE"||i=="RECTANGLE"||i=="REGULAR_POLYGON"||i=="ROUNDED_RECTANGLE"||i=="TEXT"||i=="STAMP"||i=="WASHI_TAPE"}o.isGeometryLeaf=r;function e(i){return i=="FRAME"||i=="SYMBOL"||i=="INSTANCE"||i=="SECTION"||n(i)||i=="TABLE_CELL"||i=="SLIDE"||i=="MODULE"}o.isFrameLike=e;function t(i){return i=="RECTANGLE"||i=="ROUNDED_RECTANGLE"||i=="ELLIPSE"||i=="STAMP"||e(i)}o.isRectOrEllipseLike=t;function n(i){return i=="STICKY"||i=="SHAPE_WITH_TEXT"||i=="CONNECTOR"||i=="CODE_BLOCK"||i=="MEDIA"||i=="SECTION_OVERLAY"||i=="TABLE"}o.isImmutableFrame=n})(zt||(zt={}));var Ya;(t=>{function r(n){return`${n.sessionID}:${n.localID}`}t.toString=r;function e(n,o){return n.sessionID==o.sessionID&&n.localID==o.localID}t.equals=e})(Ya||(Ya={}));var gd;(e=>{function r(t){return t.guid!==void 0?"VariableID:"+Ya.toString(t.guid):t.assetRef!==void 0&&t.assetRef.key!=null&&t.assetRef.version!=null?"VariableID:"+t.assetRef.key+"/"+t.assetRef.version:""}e.toString=r})(gd||(gd={}));var Mp;(e=>{function r(t){return t.guid!==void 0?"ManagedStringId:"+Ya.toString(t.guid):t.assetRef!==void 0&&t.assetRef.key!=null&&t.assetRef.version!=null?"ManagedStringId:"+t.assetRef.key+"/"+t.assetRef.version:""}e.toString=r})(Mp||(Mp={}));var an;(a=>{function r(s){let l=s.depth!==void 0?s.depth:-1;return`${n(s)}-${l}`}a.hash=r;function e(s,l){return r(s)==r(l)}a.equals=e;function t(s){return r(s)}a.toString=t;function n(s){let l=s.startingNode!==void 0?s.startingNode:null;return l!=null?`${l.sessionID}:${l.localID}`:"-1:-1"}a.nodeIdString=n;function o(s){let l=s.startingNode!==void 0?s.startingNode:null,d=l!=null?`${l.sessionID}:${l.localID}`:"-1:-1",c=s.depth!==void 0?s.depth:-1;return`${d}-${c}`}a.serializeForMultiplayerURL=o;function i(s,l){if((s.depth!==void 0?s.depth:-1)!=0)return!1;let c=s.startingNode!==void 0?s.startingNode:null;for(;l!=null;){if(Ya.equals(X.toFigGUID(l.id()),c))return!0;l=l.parent()}return!1}a.fullyLoadsNode=i})(an||(an={}));var mr;(e=>{let r;(s=>(s[s.NON_RENDERABLE=0]="NON_RENDERABLE",s[s.RENDERABLE_GEOMETRY=1]="RENDERABLE_GEOMETRY",s[s.RENDERABLE_TEXT=2]="RENDERABLE_TEXT",s[s.RENDERABLE_GROUP=3]="RENDERABLE_GROUP",s[s.CUSTOM_RENDER_TREE=4]="CUSTOM_RENDER_TREE"))(r=e.RenderableContentType||(e.RenderableContentType={}))})(mr||(mr={}));var Ad;(t=>{function r(){return new Map}t._new=r;function e(n,o){return new Map([...n.entries()].filter(([i,a])=>o(i,a)))}t._filter=e})(Ad||(Ad={}));var Qa=class{toString(){return this.name+" "+this.relativeChildIndex.toString()}toStringWithPrefix(e){let t=e?this.name.split("/")[0]:this.name;return t=t.trim(),t+" "+this.relativeChildIndex.toString()}constructor(e,t){this.name=e,this.relativeChildIndex=t}},Gp=class r{getData(e,t){let n=this.getAllDataForNode(e);return n!=null&&n.has(t)?n.get(t):null}getAllDataForNode(e){let t=this.getSubTrie(e);return t!=null?t.cache:null}insert(e,t,n){if(e.length==0){this.cache.set(t,n);return}let o=e[0].toString(),i=e.slice(1,e.length);this.children.has(o)||this.children.set(o,new r),this.children.get(o).insert(i,t,n)}remove(e,t){if(e.length==0){this.cache.delete(t);return}let n=e[0].toString(),o=e.slice(1,e.length);this.children.has(n)||this.children.set(n,new r),this.children.get(n).remove(o,t)}forEach(e){for(let t of Array.from(this.cache.keys()))e(this.cache.get(t));for(let t of Array.from(this.children.keys()))this.children.get(t).forEach(e)}getSubTrie(e){if(e.length==0)return this;let t=e[0].toString();return this.children.has(t)?this.children.get(t).getSubTrie(e.slice(1,e.length)):null}uninitialize1(){this.uninitialize2(null)}uninitialize2(e){for(let t of Array.from(this.cache.keys()))e!=null&&e(this.cache.get(t));for(let t of Array.from(this.children.keys()))this.children.get(t).uninitialize2(e),this.children.delete(t)}toString1(){return this.toString2(null)}toString2(e){let t=this.toStringHelper(e),n="";for(let o of t)n=n+`${o}
`;return n}toStringHelper(e){let t=[];for(let n of Array.from(this.cache.keys()))t.push(e==null?n:`${n}: ${e(this.cache.get(n))}`);for(let n of Array.from(this.children.keys())){let o=this.children.get(n).toStringHelper(e);for(let i of o)t.push(`${n}/${i}`)}return t}constructor(){this.cache=Ad._new(),this.children=new Map}},Xa=class{getData(e,t){if(e.length==0)return null;let n=this._getSSTDataCacheFromLowerNodeStorage(e);return n!=null&&n.has(t)?n.get(t):null}getAllDataForNode(e){return e.length==0?null:this._getSSTDataCacheFromLowerNodeStorage(e)}_getSSTDataCacheFromTLFStorage(e){let t=e[0].toString();return this.tlfNodeStorage.has(t)?this.tlfNodeStorage.get(t).getAllDataForNode([]):null}_getSSTDataCacheFromLowerNodeStorage(e){let t=this._getFirstNodeName(e);return this.lowerNodeStorage.has(t)?this.lowerNodeStorage.get(t).getAllDataForNode(e.slice(1,e.length)):null}insert(e,t,n){e.length!=0&&this._insertIntoLowerNodeStorage(e,t,n)}remove(e,t){e.length!=0&&this._deleteFromLowerNodeStorage(e,t)}_deleteFromTLFStorage(e,t){let n=e[0].toString();this.tlfNodeStorage.has(n)&&this.tlfNodeStorage.get(n).remove(e.slice(1,e.length),t)}_deleteFromLowerNodeStorage(e,t){let n=this._getFirstNodeName(e);this.lowerNodeStorage.has(n)&&this.lowerNodeStorage.get(n).remove(e.slice(1,e.length),t)}_insertIntoTLFStorage(e,t,n){let o=e[0].toString();this.tlfNodeStorage.has(o)||this.tlfNodeStorage.set(o,new Gp),this.tlfNodeStorage.get(o).insert(e.slice(1,e.length),t,n)}_insertIntoLowerNodeStorage(e,t,n){let o=this._getFirstNodeName(e);this.lowerNodeStorage.has(o)||this.lowerNodeStorage.set(o,new Gp),this.lowerNodeStorage.get(o).insert(e.slice(1,e.length),t,n)}forEach(e){for(let t of Array.from(this.tlfNodeStorage.keys()))this.tlfNodeStorage.get(t).forEach(e);for(let t of Array.from(this.lowerNodeStorage.keys()))this.lowerNodeStorage.get(t).forEach(e)}getSubTrie(e){if(e.length==0)return this;let t=e,n=this._getFirstNodeName(t);return this.lowerNodeStorage.has(n)?this.lowerNodeStorage.get(n).getSubTrie(t.slice(1,t.length)):null}uninitialize1(){this.uninitialize2(null)}uninitialize2(e){for(let t of Array.from(this.tlfNodeStorage.keys()))this.tlfNodeStorage.get(t).uninitialize2(e),this.tlfNodeStorage.delete(t);for(let t of Array.from(this.lowerNodeStorage.keys()))this.lowerNodeStorage.get(t).uninitialize2(e),this.lowerNodeStorage.delete(t)}toString1(){return this.toString2(null)}toString2(e){let t=this._toStringHelper(e),n="";for(let o of t)n=n+`${o}
`;return n}_toStringHelper(e){let t=[];for(let n of Array.from(this.lowerNodeStorage.keys())){let o=this.lowerNodeStorage.get(n).toStringHelper(e);for(let i of o)t.push(`*/${n}/${i}`)}for(let n of Array.from(this.tlfNodeStorage.keys())){let o=this.tlfNodeStorage.get(n).toStringHelper(e);for(let i of o)t.push(`[TLF]/${n}/${i}`)}return t}_getFirstNodeName(e){return e.length==1?e[0].toStringWithPrefix(!0):Mf.SemanticStorageTrie_UNIVERSAL_TLF_NAME_FOR_MATCHING}constructor(){this.lowerNodeStorage=new Map,this.tlfNodeStorage=new Map}},gr;(l=>{function r(){l._cachedNodePaths.clear()}l.clearCachedNodePaths=r;function e(d){if(d==null)return[];if(l._cachedNodePaths.has(d.uniqueIdentifier()))return l._cachedNodePaths.get(d.uniqueIdentifier());let c=d.getSemanticNodePath();return l._cachedNodePaths.set(d.uniqueIdentifier(),c),c}l.getSemanticNodePath=e;function t(d){return d.type()=="FRAME"||d.type()=="INSTANCE"||d.type()=="SYMBOL"||d.type()=="SLIDE"}l._isValidTLFType=t;function n(d){return d.isTopLevel()&&t(d)}l._isValidSemanticTLF=n;function o(d){if(d.isTopLevel()&&!t(d))return[];let c=[],p=!0;for(let u=d.clone();p&&u!=null;u=u.parent())c.splice(0,0,new Qa(u.name(),i(u))),n(u)&&(p=!1);return c}l.getSemanticNodePathHelper=o;function i(d){if(n(d)||d.parent()==null)return 0;let c=d.parent().clone(),p=[],u=c.childCount();for(let _=0;_<u;_=_+1){let h=c.clone();h.moveToChildAt(_),h.name()==d.name()&&p.push(h.uniqueIdentifier())}return p.indexOf(d.uniqueIdentifier())}l.getRelativeChildIndex=i,l.DEFAULT_STORAGE_KEY="storage_key",l._cachedNodePaths=new Map})(gr||(gr={}));var hv;(l=>{function r(d){return d}l.SSTDataCache_asMap=r;function e(d){return Array.from(d.keys())}l.SSTDataCache_keys=e;function t(d,c){return d.has(c)}l.SSTDataCache_has=t;function n(d){return d.size}l.SSTDataCache_size=n;function o(d,c){d.delete(c)}l.remove=o;function i(d,c){return d.get(c)}l.SSTDataCache_get=i;function a(d,c,p){d.set(c,p)}l.SSTDataCache_set=a;function s(d,c){d.forEach(c)}l.SSTDataCache_forEach=s})(hv||(hv={}));var Mf;(e=>e.SemanticStorageTrie_UNIVERSAL_TLF_NAME_FOR_MATCHING="TLF Placeholder")(Mf||(Mf={}));var Nt=class r{constructor(e,t=null){this.node=e,this._overlayRenderData=t}clone(){return new r(this.node,this.overlayRenderData())}setNode(e){this.node=e}moveToChildAt(e){this.node=this.node.childAt2(e,!0)}moveToParent(){this.node=this.node.parent()}isRoot(){return this.node.parent()==null}indexInParent(){return this.node.indexInParent()}renderableContentType(){switch(this.node.type()){case"NONE":case"DOCUMENT":case"SLICE":return mr.RenderableContentType.NON_RENDERABLE;case"CANVAS":case"GROUP":case"FRAME":case"SYMBOL":case"INSTANCE":case"STICKY":case"CODE_BLOCK":case"MEDIA":case"SECTION_OVERLAY":case"WIDGET":case"SHAPE_WITH_TEXT":case"CONNECTOR":case"SECTION":case"TABLE":case"TABLE_CELL":case"SLIDE":case"MODULE":case"SLIDE_GRID":case"SLIDE_ROW":return mr.RenderableContentType.RENDERABLE_GROUP;case"BOOLEAN_OPERATION":case"ELLIPSE":case"LINE":case"RECTANGLE":case"REGULAR_POLYGON":case"ROUNDED_RECTANGLE":case"STAR":case"VECTOR":case"HIGHLIGHT":case"STAMP":case"WASHI_TAPE":case"INTERACTIVE_SLIDE_ELEMENT":return mr.RenderableContentType.RENDERABLE_GEOMETRY;case"TEXT":return mr.RenderableContentType.RENDERABLE_TEXT}return Oe("Unhandled scene node type while getting cursor renderable content type"),mr.RenderableContentType.NON_RENDERABLE}isFrameLike(){return zt.isFrameLike(this.type())}isTopLevel(){return this.node.isTopLevel()}willChange(){return 0}shouldOptimizeShadowForAnimation(e){return!1}paintsDebugString(){return`SceneCursor ${this.node.paintsDebugString()}`}customRenderTree(e){return null}name(){return this.node.name()}scene(){return this.node.scene()}parent(){return this.node.parent()!=null?new r(this.node.parent()):null}blendMode(){return this.node.blendMode()}opacity(){return this.node.opacity()}visible(){return this.node.visible()}isVisibleMask(){return this.node.visible()&&this.node.isMask()}maskType(){return this.node.maskType()}isSpreadEligibleNode(){return this.node.isSpreadEligibleNode()}type(){return this.node.type()}childCount(){return this.node.childCount()}absoluteTransform(){return this.node!=null?this.node.absoluteTransform():yt.FrozenAffineTransform_IDENTITY}maxTransformScale(){return 1}clipsChildren(){return this.node.clipsToBoundingRectangle()}stopsMaskPropagation(){return this.node.isMask()||this.node.clipsToBoundingRectangle()}arcData(){return this.node.arcData()}isRoundedRect(){return this.node.isRoundedRect()}roundedRectInfo(){return this.node.roundedRectInfo()}fillGeometry(){return this.node.fillGeometry()}strokeGeometry(){return this.node.strokeGeometry()}fillGeometryForSpread(e,t,n){return this.node.fillGeometryForSpread(e,t,n)}strokeGeometryForSpread(e,t,n,o){return this.node.strokeGeometryForSpread(e,t,n,o)}size(){return this.node.size()}strokeAlign(){return this.node.strokeAlign()}strokeWeight(){return this.node.strokeWeight()}hasDefaultStrokeParameters(){return this.node.hasDefaultStrokeParameters()}strokeJoin(){return this.node.strokeJoin()}setStrokeJoin(e){this.node.setStrokeJoin(e)}strokeMiterLimit(){return this.node.strokeMiterLimit()}setStrokeMiterLimit(e){this.node.setStrokeMiterLimit(e)}id(){return this.node.id()}uniqueIdentifier(){return this.node.id()}isInsideOutlineMask(){return this.node.isInsideOutlineMask()}textData(){return this.node.textData()}derivedTextData(){return this.node.derivedTextData()}textGeometry(){return this.node.textGeometry()}getCachedRenderTree(){return this.node.getCachedRenderTree()}renderTree(){return this.node.renderTree2(this.clone())}renderTreeWithoutBackgroundBlurs(){return this.node.renderTreeWithoutBackgroundBlurs()}renderTreeForShadowRoot(){return this.node.renderTreeForShadowRoot1()}renderTreeForShadowDescendant(){return this.node.renderTreeForShadowDescendant1()}renderTreeForKnockoutShadowRoot(){return this.node.renderTreeForKnockoutShadowRoot1()}renderTreeForKnockoutShadowDescendant(){return this.node.renderTreeForKnockoutShadowDescendant1()}renderTreeForSlideThumbnail(){return this.node.renderTreeForSlideThumbnail1()}isFixed(){return this.node.isFixed()}isStandardScrolling(){return this.node.isStandardScrolling()}isStickyScrolling(){return this.node.isStickyScrolling()}scrollOffset(){return this.node.scrollOffset()}scrollSpeedMultiplier(){var e,t;return((t=(e=this.node.behaviors())==null?void 0:e.scrollParallax)==null?void 0:t.speed)??1}scrollDirection(){return this.node.scrollDirection()}hasOverflowingContentInScrollDirection(){return this.node.hasOverflowingContentInScrollDirection()}effects(){return this.node.effects()}fillPaints(){return this.node.fillPaints()}textDecorationFillPaints(){return this.node.textDecorationFillPaints()}strokePaints(){return this.node.strokePaints()}fillPaintsToRender(){return this.node.fillPaintsToRender()}videoPlayback(){return this.node.videoPlayback()}containerSupportsFillStrokeAndCorners(){return this.node.containerSupportsFillStrokeAndCorners()}isGroup(){return this.node.isGroup()}hasNonZeroStrokeWeight(){return this.node.hasNonZeroStrokeWeight()}hasPerRegionFillPaints(){return this.node.hasPerRegionFillPaints()}forEachRegionWithFillPaintBatch(e){this.node.forEachRegionWithFillPaintBatch(e)}overrideKey(){return this.node.overrideKey()}getSemanticNodePath(){return gr.getSemanticNodePathHelper(this)}hasBackgroundBlurs(){return this.node.hasBackgroundBlurs()}overlayRenderData(){return this._overlayRenderData}containsIndependentBordersStrokeMask(){return this.node.containsIndependentBordersStrokeMask()}generateStrokeAndStrokeMaskGeometries(e,t,n){return this.node.generateStrokeAndStrokeMaskGeometries(e,t,n)}canvasSpaceContentBounds(){return this.node.canvasSpaceContentBounds()}};var Ks=class r extends Nt{constructor(e,t=null,n=null,o=null,i=null){super(e,t),this._icRoot=e,this._enteringICNode=o,this._exitingICNode=i,this._icFramePairTransition=n}clone(){let e=new r(this.node,this.overlayRenderData(),this._icFramePairTransition,this._enteringICNode,this._exitingICNode);return e._icRoot=this._icRoot,e}moveToChildAt(e){let t=this.node.childAt2(e,!0);t!=null&&this._enteringICNode!=null&&t.id()==this._enteringICNode.id()?this.node=this._exitingICNode:this.node=t}moveToParent(){this._enteringICNode!=null&&this._exitingICNode!=null&&this._enteringICNode.parent()!=null&&this.node.id()==this._exitingICNode.id()?this.node=this._enteringICNode.parent():this.node=this.node.parent()}isRoot(){return this._enteringICNode!=null&&this._exitingICNode!=null&&this.node.id()==this._exitingICNode.id()?this._enteringICNode.parent()==null:this.node.parent()==null}indexInParent(){return this._enteringICNode!=null&&this._exitingICNode!=null&&this.node.id()==this._exitingICNode.id()?this._enteringICNode.indexInParent():this.node.indexInParent()}parent(){let e=this.clone();return e.moveToParent(),e.node==null?null:e}icFramePairTransition(){return this._icFramePairTransition}icRoot(){return this._icRoot}};var Tt=(q=>(q[q.MISSING__=0]="MISSING__",q[q.TEXT_ALIGN_HORIZONTAL=1]="TEXT_ALIGN_HORIZONTAL",q[q.TEXT_ALIGN_VERTICAL=2]="TEXT_ALIGN_VERTICAL",q[q.FONT_SIZE=3]="FONT_SIZE",q[q.TEXT_DATA=4]="TEXT_DATA",q[q.DERIVED_TEXT_DATA=5]="DERIVED_TEXT_DATA",q[q.HYPERLINK=6]="HYPERLINK",q[q.MENTION=7]="MENTION",q[q.VISIBLE=8]="VISIBLE",q[q.IS_BACKGROUND_ENABLED=9]="IS_BACKGROUND_ENABLED",q[q.IS_MASK=10]="IS_MASK",q[q.IS_MASK_OUTLINE__DEPRECATED=11]="IS_MASK_OUTLINE__DEPRECATED",q[q.IS_INTERNAL_ONLY=12]="IS_INTERNAL_ONLY",q[q.IS_FRAME_MASK_DISABLED=13]="IS_FRAME_MASK_DISABLED",q[q.IS_RESIZE_TO_FIT=14]="IS_RESIZE_TO_FIT",q[q.RECTANGLE_CORNER_RADII_INDEPENDENT=15]="RECTANGLE_CORNER_RADII_INDEPENDENT",q[q.RECTANGLE_CORNER_TOOL_INDEPENDENT=16]="RECTANGLE_CORNER_TOOL_INDEPENDENT",q[q.INTERACTION_MAINTAINED__DEPRECATED=17]="INTERACTION_MAINTAINED__DEPRECATED",q[q.TRANSITION_PRESERVE_SCROLL__DEPRECATED=18]="TRANSITION_PRESERVE_SCROLL__DEPRECATED",q[q.TRANSITION_SHOULD_SMART_ANIMATE__DEPRECATED=19]="TRANSITION_SHOULD_SMART_ANIMATE__DEPRECATED",q[q.BORDER_TOP_WEIGHT=20]="BORDER_TOP_WEIGHT",q[q.BORDER_BOTTOM_WEIGHT=21]="BORDER_BOTTOM_WEIGHT",q[q.BORDER_LEFT_WEIGHT=22]="BORDER_LEFT_WEIGHT",q[q.BORDER_RIGHT_WEIGHT=23]="BORDER_RIGHT_WEIGHT",q[q.BORDER_STROKE_WEIGHTS_INDEPENDENT=24]="BORDER_STROKE_WEIGHTS_INDEPENDENT",q[q.TYPE=25]="TYPE",q[q.HORIZONTAL_CONSTRAINT=26]="HORIZONTAL_CONSTRAINT",q[q.VERTICAL_CONSTRAINT=27]="VERTICAL_CONSTRAINT",q[q.BLEND_MODE=28]="BLEND_MODE",q[q.STROKE_ALIGN=29]="STROKE_ALIGN",q[q.RELATIVE_TRANSFORM=30]="RELATIVE_TRANSFORM",q[q.OVERLAY_TRANSFORM=31]="OVERLAY_TRANSFORM",q[q.PARENT_INDEX=32]="PARENT_INDEX",q[q.CONNECTION_TYPE__DEPRECATED=33]="CONNECTION_TYPE__DEPRECATED",q[q.TRANSITION_TYPE__DEPRECATED=34]="TRANSITION_TYPE__DEPRECATED",q[q.EASING_TYPE__DEPRECATED=35]="EASING_TYPE__DEPRECATED",q[q.INTERACTION_TYPE__DEPRECATED=36]="INTERACTION_TYPE__DEPRECATED",q[q.NAVIGATION_TYPE__DEPRECATED=37]="NAVIGATION_TYPE__DEPRECATED",q[q.OVERLAY_POSITION_TYPE=38]="OVERLAY_POSITION_TYPE",q[q.OVERLAY_BACKGROUND_INTERACTION=39]="OVERLAY_BACKGROUND_INTERACTION",q[q.STYLE_TYPE=40]="STYLE_TYPE",q[q.OVERFLOW_DIRECTION=41]="OVERFLOW_DIRECTION",q[q.SCROLL_BEHAVIOR=42]="SCROLL_BEHAVIOR",q[q.MASK_TYPE=43]="MASK_TYPE",q[q.OPACITY=44]="OPACITY",q[q.LOCAL_OPACITY=45]="LOCAL_OPACITY",q[q.BACKGROUND_OPACITY=46]="BACKGROUND_OPACITY",q[q.RECTANGLE_TOP_LEFT_CORNER_RADIUS=47]="RECTANGLE_TOP_LEFT_CORNER_RADIUS",q[q.RECTANGLE_TOP_RIGHT_CORNER_RADIUS=48]="RECTANGLE_TOP_RIGHT_CORNER_RADIUS",q[q.RECTANGLE_BOTTOM_LEFT_CORNER_RADIUS=49]="RECTANGLE_BOTTOM_LEFT_CORNER_RADIUS",q[q.RECTANGLE_BOTTOM_RIGHT_CORNER_RADIUS=50]="RECTANGLE_BOTTOM_RIGHT_CORNER_RADIUS",q[q.STROKE_WEIGHT=51]="STROKE_WEIGHT",q[q.CORNER_RADIUS=52]="CORNER_RADIUS",q[q.CORNER_SMOOTHING=53]="CORNER_SMOOTHING",q[q.TRANSITION_DURATION__DEPRECATED=54]="TRANSITION_DURATION__DEPRECATED",q[q.TRANSITION_TIMEOUT__DEPRECATED=55]="TRANSITION_TIMEOUT__DEPRECATED",q[q.INTERACTION_DURATION__DEPRECATED=56]="INTERACTION_DURATION__DEPRECATED",q[q.SIZE_VECTOR_F=57]="SIZE_VECTOR_F",q[q.OVERRIDE_KEY=58]="OVERRIDE_KEY",q[q.OVERRIDDEN_SYMBOL_ID=59]="OVERRIDDEN_SYMBOL_ID",q[q.OVERLAY_RELATIVE_POSITION__DEPRECATED=60]="OVERLAY_RELATIVE_POSITION__DEPRECATED",q[q.FILL_PAINT_DATA=61]="FILL_PAINT_DATA",q[q.STROKE_PAINT_DATA=62]="STROKE_PAINT_DATA",q[q.TEXT_DECORATION_FILL_PAINT_DATA=63]="TEXT_DECORATION_FILL_PAINT_DATA",q[q.EFFECT_DATA=64]="EFFECT_DATA",q[q.NAME=65]="NAME",q[q.ARC_DATA=66]="ARC_DATA",q[q.BACKGROUND_COLOR=67]="BACKGROUND_COLOR",q[q.PROTOTYPE_BACKGROUND_COLOR=68]="PROTOTYPE_BACKGROUND_COLOR",q[q.PROTOTYPE_DEVICE=69]="PROTOTYPE_DEVICE",q[q.OVERLAY_BACKGROUND_APPEARANCE=70]="OVERLAY_BACKGROUND_APPEARANCE",q[q.EXPORT_SETTINGS_DATA=71]="EXPORT_SETTINGS_DATA",q[q.PROTOTYPE_START_NODE_ID=72]="PROTOTYPE_START_NODE_ID",q[q.CONNECTION_URL_DEPRECATED=73]="CONNECTION_URL_DEPRECATED",q[q.TRANSITION_NODE_ID_DEPRECATED=74]="TRANSITION_NODE_ID_DEPRECATED",q[q.VIDEO_PLAYBACK=75]="VIDEO_PLAYBACK",q[q.FILL_GEOMETRY=76]="FILL_GEOMETRY",q[q.STROKE_GEOMETRY=77]="STROKE_GEOMETRY",q[q.SYMBOL_DATA=78]="SYMBOL_DATA",q[q.COMPILED_VECTOR_DATA=79]="COMPILED_VECTOR_DATA",q[q.STACK_MODE=80]="STACK_MODE",q[q.STACK_PADDING_LEFT=81]="STACK_PADDING_LEFT",q[q.STACK_PADDING_TOP=82]="STACK_PADDING_TOP",q[q.STACK_PADDING_RIGHT=83]="STACK_PADDING_RIGHT",q[q.STACK_PADDING_BOTTOM=84]="STACK_PADDING_BOTTOM",q[q.STACK_SPACING=85]="STACK_SPACING",q[q.STACK_REVERSE_Z_INDEX=86]="STACK_REVERSE_Z_INDEX",q[q.STACK_COUNTER_SPACING=87]="STACK_COUNTER_SPACING",q[q.KEY_TRIGGER__DEPRECATED=88]="KEY_TRIGGER__DEPRECATED",q[q.IS_STATE_GROUP=89]="IS_STATE_GROUP",q[q.PROTOTYPE_INTERACTIONS=90]="PROTOTYPE_INTERACTIONS",q[q.OBJECT_ANIMATIONS=91]="OBJECT_ANIMATIONS",q[q.VOICE_EVENT_PHRASE__DEPRECATED=92]="VOICE_EVENT_PHRASE__DEPRECATED",q[q.PROTOTYPE_STARTING_POINT=93]="PROTOTYPE_STARTING_POINT",q[q.SHAPE_WITH_TEXT_TYPE=94]="SHAPE_WITH_TEXT_TYPE",q[q.INTERACTIVE_SLIDE_CONFIG_DATA=95]="INTERACTIVE_SLIDE_CONFIG_DATA",q[q.INTERACTIVE_SLIDE_PARTICIPANT_DATA=96]="INTERACTIVE_SLIDE_PARTICIPANT_DATA",q[q.INTERACTIVE_SLIDE_ELEMENT_TYPE=97]="INTERACTIVE_SLIDE_ELEMENT_TYPE",q[q.SCROLL_OFFSET=98]="SCROLL_OFFSET",q[q.USED_AS_BASE_SCREEN=99]="USED_AS_BASE_SCREEN",q[q.CURRENT_VIEWPORT_SIZE=100]="CURRENT_VIEWPORT_SIZE",q[q.HAS_BEEN_LOADED=101]="HAS_BEEN_LOADED",q[q.STYLE_ID_FOR_FILL=102]="STYLE_ID_FOR_FILL",q[q.STYLE_ID_FOR_STROKE_FILL=103]="STYLE_ID_FOR_STROKE_FILL",q[q.STYLE_ID_FOR_TEXT=104]="STYLE_ID_FOR_TEXT",q[q.STYLE_ID_FOR_EFFECT=105]="STYLE_ID_FOR_EFFECT",q[q.STYLE_ID_FOR_GRID=106]="STYLE_ID_FOR_GRID",q[q.PAGE_TYPE=107]="PAGE_TYPE",q[q.SLIDE_THUMBNAIL_HASH=108]="SLIDE_THUMBNAIL_HASH",q[q.SLIDE_SPEAKER_NOTES=109]="SLIDE_SPEAKER_NOTES",q[q.BEHAVIORS=110]="BEHAVIORS",q[q.IS_SKIPPED_SLIDE=111]="IS_SKIPPED_SLIDE",q[q.PHASE=112]="PHASE",q[q.END__=113]="END__",q))(Tt||{});var or;(c=>{function r(p,u){let _=s();for(let h=0,S=p.length;h<S;h=h+1)t(_,p[h],u[h]);return _}c.new1=r;function e(p,u){return p.has(Tt[u])}c._in=e;function t(p,u,_){let h=Tt[u];c._remapKey.set(h,u),p.set(h,_)}c.set=t;function n(p,u,_=null){return Ge.StringMap_get(p,Tt[u],_)}c.get=n;function o(p,u){p.delete(Tt[u])}c.remove=o;function i(p,u){Ge.StringMap_each(p,(_,h)=>{u(c._remapKey.get(_),h)})}c.each=i;function a(p){let u=[];return Ge.StringMap_each(p,(_,h)=>{u.push(`${_}=${Je.toString(h)}`)}),`{${u.join(", ")}}`}c.toString=a;function s(){return new Map}c._new=s,c._remapKey=new Map,c.EMPTY=s()})(or||(or={}));var Wi;(o=>{function r(i,a){return or._in(i,a)}o._in=r;function e(i,a,s=null){return or.get(i,a,s)}o.get=e;function t(i,a){or.each(i,a)}o.each=t;function n(i){return or.toString(i)}o.toString=n})(Wi||(Wi={}));var Up;(w=>{function r(V,k){w._p.setTo(0,0);for(let H=V.start();ze.Command.isValid(H,V);H=ze.Command.next(H,V)){switch(ze.Command.kind(H,V)){case ze.Command.Kind.CLOSE:break;case ze.Command.Kind.MOVE_TO:{w._p3.setTo(ze.Command.moveToX(H,V),ze.Command.moveToY(H,V)),w._p.copyFrom(w._p3);break}case ze.Command.Kind.LINE_TO:{w._p3.setTo(ze.Command.lineToX(H,V),ze.Command.lineToY(H,V)),u(k,w._p,w._p0,w._p3);break}case ze.Command.Kind.QUADRATIC_TO:{let z=w._p0.x(),Q=w._p0.y(),K=ze.Command.quadraticToFirstX(H,V),j=ze.Command.quadraticToFirstY(H,V),pe=ze.Command.quadraticToX(H,V),Pe=ze.Command.quadraticToY(H,V);w._p1.setTo(K+(z-K)/3,j+(Q-j)/3),w._p2.setTo(K+(pe-K)/3,j+(Pe-j)/3),w._p3.setTo(pe,Pe),u(k,w._p,w._p0,w._p3),s(k,w._p0,w._p1,w._p2,w._p3,0,0);break}case ze.Command.Kind.CUBIC_TO:{w._p1.setTo(ze.Command.cubicToFirstX(H,V),ze.Command.cubicToFirstY(H,V)),w._p2.setTo(ze.Command.cubicToSecondX(H,V),ze.Command.cubicToSecondY(H,V)),w._p3.setTo(ze.Command.cubicToX(H,V),ze.Command.cubicToY(H,V)),u(k,w._p,w._p0,w._p3),s(k,w._p0,w._p1,w._p2,w._p3,0,0);break}default:break}w._p0.copyFrom(w._p3)}}w.compile=r;function e(V){return Math.abs(V)<w._EPSILON?0:V}w._roundToZero=e;function t(V,k){return V.squaredDistanceTo(k)<w._EPSILON*w._EPSILON}w._approxEqual=t;function n(V,k,H){let z=(H.x()-k.x())*(k.y()-V.y())-(H.y()-k.y())*(k.x()-V.x());return z<0?-1:z>0?1:0}w._orientation=n;function o(V,k,H,z){return n(V,k,H)!=n(V,k,z)&&n(H,z,V)!=n(H,z,k)}w._linesIntersect=o;function i(V,k,H,z){let Q=z.x()-k.x(),K=z.y()-k.y(),j=H.x()-k.x(),pe=H.y()-k.y(),Pe=V.x()-k.x(),at=V.y()-k.y(),Ke=Q*Q+K*K,_t=Q*j+K*pe,bt=Q*Pe+K*at,Xt=j*j+pe*pe,oe=j*Pe+pe*at,vt=Ke*Xt-_t*_t;if(vt==0)return!1;let Er=1/vt,dt=(Xt*bt-_t*oe)*Er,We=(Ke*oe-_t*bt)*Er,mt=1e-4;return dt>=-mt&&We>=-mt&&dt+We<=1+mt}w._pointInTriangle=i;function a(V,k,H){return V.x*(k.y*H.z-k.z*H.y)+V.y*(k.z*H.x-k.x*H.z)+V.z*(k.x*H.y-k.y*H.x)}w._dotCross=a;function s(V,k,H,z,Q,K,j){if(K==0||j<4){let dt=Q.x()-k.x(),We=Q.y()-k.y(),mt=(H.x()-k.x())*We-(H.y()-k.y())*dt,Qe=(z.x()-k.x())*We-(z.y()-k.y())*dt,Ut=3*mt-3*Qe,$t=-4*mt+2*Qe,Wt=mt,xr=$t*$t-4*Wt*Ut;if(xr>0){let Br=-$t/(2*Ut),qr=Math.sqrt(xr)/(2*Ut),Bn=Br+qr,ei=Br-qr;if(0<Bn&&Bn<1&&0<ei&&ei<1){let Vt=(Bn+ei)/2;for(let re=0;re<10;re=re+1){let Te=mt-Qe,ae=Qe-2*mt,L=Vt*(Vt*(Vt*Te+ae)+mt),x=Vt*(3*Vt*Te+2*ae)+mt;Vt-=L/x}let ti=k.mixedWith(H,Vt),ri=H.mixedWith(z,Vt),Yn=z.mixedWith(Q,Vt),De=ti.mixedWith(ri,Vt),Ot=ri.mixedWith(Yn,Vt),Mr=De.mixedWith(Ot,Vt);s(V,k,ti,De,Mr,1,j+1),s(V,Mr,Ot,Yn,Q,1,j+1),u(V,k,Mr,Q);return}}}w._b0.setTo(k.x(),k.y(),1),w._b1.setTo(H.x(),H.y(),1),w._b2.setTo(z.x(),z.y(),1),w._b3.setTo(Q.x(),Q.y(),1);let pe=a(w._b0,w._b3,w._b2),Pe=a(w._b1,w._b0,w._b3),at=a(w._b2,w._b1,w._b0),Ke=pe-2*Pe+3*at,_t=-Pe+3*at,bt=3*at,Xt=1/Math.sqrt(Ke*Ke+_t*_t+bt*bt);Ke*=Xt,_t*=Xt,bt*=Xt;let oe=3*_t*_t-4*Ke*bt,vt=Ke*Ke*oe;switch(Ke=e(Ke),_t=e(_t),bt=e(bt),vt=e(vt),t(w._b0,w._b1)&&t(w._b0,w._b2)&&t(w._b0,w._b3)?0:vt<0?4:vt>0?5:Ke==0&&_t==0?bt==0?1:2:Ke==0?3:oe<0?4:5){case 5:{let dt=Math.sqrt(Math.max(0,9*_t*_t-12*Ke*bt)),We=3*_t-dt,mt=6*Ke,Qe=3*_t+dt,Ut=mt,$t=mt-We,Wt=Ut-Qe;d(V,k,We*Qe,We*We*We,Qe*Qe*Qe,H,(3*We*Qe-We*Ut-mt*Qe)/3,We*We*(We-mt),Qe*Qe*(Qe-Ut),z,(mt*(Ut-2*Qe)+We*(3*Qe-2*Ut))/3,$t*$t*We,Wt*Wt*Qe,Q,$t*Wt,-$t*$t*$t,-Wt*Wt*Wt);break}case 4:{let dt=Math.sqrt(Math.max(0,4*Ke*bt-3*_t*_t)),We=_t-dt,mt=2*Ke,Qe=_t+dt,Ut=mt;if(K!=2||j<4){let xr=We/mt,Br=Qe/Ut,qr=w._EPSILON<xr&&xr<1-w._EPSILON,Bn=w._EPSILON<Br&&Br<1-w._EPSILON;if(qr&&Bn){l(V,k,H,z,Q,Math.min(xr,Br),Math.max(xr,Br),j+1);return}if(qr){l(V,k,H,z,Q,xr,-1,j+1);return}if(Bn){l(V,k,H,z,Q,Br,-1,j+1);return}}let $t=mt-We,Wt=Ut-Qe;d(V,k,We*Qe,We*We*Qe,We*Qe*Qe,H,(-We*Ut-mt*Qe+3*We*Qe)/3,-We*(We*(Ut-3*Qe)+2*mt*Qe)/3,-Qe*(We*(2*Ut-3*Qe)+mt*Qe)/3,z,(mt*(Ut-2*Qe)+We*(3*Qe-2*Ut))/3,(mt-We)*(We*(2*Ut-3*Qe)+mt*Qe)/3,(Ut-Qe)*(We*(Ut-3*Qe)+2*mt*Qe)/3,Q,$t*Wt,-$t*$t*Wt,-$t*Wt*Wt);break}case 3:{let dt=bt,We=3*_t,mt=dt-We;d(V,k,dt,dt*dt*dt,1,H,dt-We/3,dt*dt*mt,1,z,dt-We*(2/3),mt*mt*dt,1,Q,mt,mt*mt*mt,1);break}case 2:{d(V,k,0,0,0,H,1/3,0,1/3,z,2/3,1/3,2/3,Q,1,1,1);break}}}w._compileCubic=s;function l(V,k,H,z,Q,K,j,pe){let Pe=k.mixedWith(H,K),at=H.mixedWith(z,K),Ke=z.mixedWith(Q,K),_t=Pe.mixedWith(at,K),bt=at.mixedWith(Ke,K),Xt=_t.mixedWith(bt,K);if(u(V,k,Xt,Q),s(V,k,Pe,_t,Xt,2,pe+1),j==-1){s(V,Xt,bt,Ke,Q,2,pe+1);return}let oe=Xt,vt=bt,Er=Ke,dt=Q,We=(j-K)/(1-K),mt=oe.mixedWith(vt,We),Qe=vt.mixedWith(Er,We),Ut=Er.mixedWith(dt,We),$t=mt.mixedWith(Qe,We),Wt=Qe.mixedWith(Ut,We),xr=$t.mixedWith(Wt,We);s(V,oe,mt,$t,xr,2,pe+1),s(V,xr,Wt,Ut,dt,2,pe+1)}w._compileSubdividedCubic=l;function d(V,k,H,z,Q,K,j,pe,Pe,at,Ke,_t,bt,Xt,oe,vt,Er){w._v0.set(k,H,z,Q),w._v1.set(K,j,pe,Pe),w._v2.set(at,Ke,_t,bt),w._v3.set(Xt,oe,vt,Er);let dt=(H+oe)*(.9/2)+(j+Ke)*(.1/2),We=(z+vt)*(.9/2)+(pe+_t)*(.1/2),mt=(Q+Er)*(.9/2)+(Pe+bt)*(.1/2),Qe=dt*dt*dt-We*mt>0,Ut=0,$t=0;for(let qr=0;qr<4;qr=qr+1){let Bn=gt.int_remainder(qr+1,4),ei=gt.int_remainder(qr+2,4),Vt=gt.int_remainder(qr+3,4),ti=w._v[Bn].xy,ri=w._v[ei].xy,Yn=w._v[Vt].xy,De=ti.distanceTo(ri),Ot=ri.distanceTo(Yn),Mr=Yn.distanceTo(ti),re=(De+Ot+Mr)/2,Te=re*(re-De)*(re-Ot)*(re-Mr);Te>Ut&&(Ut=Te,$t=qr)}let Wt=gt.int_remainder($t+1,4),xr=gt.int_remainder($t+2,4),Br=gt.int_remainder($t+3,4);if(i(w._v[$t].xy,w._v[Wt].xy,w._v[xr].xy,w._v[Br].xy)){_(V,w._v[Wt],w._v[xr],w._v[Br],Qe);return}o(k,at,K,Xt)?k.squaredDistanceTo(at)<K.squaredDistanceTo(Xt)?(_(V,w._v0,w._v1,w._v2,Qe),_(V,w._v0,w._v2,w._v3,Qe)):(_(V,w._v0,w._v1,w._v3,Qe),_(V,w._v1,w._v2,w._v3,Qe)):o(k,Xt,K,at)?k.squaredDistanceTo(Xt)<K.squaredDistanceTo(at)?(_(V,w._v0,w._v1,w._v3,!Qe),_(V,w._v0,w._v3,w._v2,Qe)):(_(V,w._v0,w._v1,w._v2,Qe),_(V,w._v2,w._v1,w._v3,Qe)):k.squaredDistanceTo(K)<at.squaredDistanceTo(Xt)?(_(V,w._v0,w._v2,w._v1,Qe),_(V,w._v0,w._v1,w._v3,Qe)):(_(V,w._v0,w._v2,w._v3,Qe),_(V,w._v3,w._v2,w._v1,Qe))}w._appendQuad=d;function c(V,k,H){return V.equals(k)||V.equals(H)||k.equals(H)}w._isEmptyTriangle=c;function p(V,k,H,z,Q,K){V.appendFloat(k).appendFloat(H),V.appendFloat(z).appendFloat(Q).appendFloat(K)}w._appendVertex=p;function u(V,k,H,z){c(k,H,z)||(p(V,k.x(),k.y(),.5,.5,.5),p(V,H.x(),H.y(),.5,.5,.5),p(V,z.x(),z.y(),.5,.5,.5))}w._appendTriangle1=u;function _(V,k,H,z,Q){if(!c(k.xy,H.xy,z.xy)){let K=Q?-1:1;p(V,k.xy.x(),k.xy.y(),k.k*K,k.l*K,k.m),p(V,H.xy.x(),H.xy.y(),H.k*K,H.l*K,H.m),p(V,z.xy.x(),z.xy.y(),z.k*K,z.l*K,z.m)}}w._appendTriangle2=_;class h{setTo(k,H,z){this.x=k,this.y=H,this.z=z}squaredDistanceTo(k){let H=this.x-k.x,z=this.y-k.y,Q=this.z-k.z;return H*H+z*z+Q*Q}constructor(){this.x=0,this.y=0,this.z=0}}w.Vector3=h;class S{set(k,H,z,Q){this.xy=k,this.k=H,this.l=z,this.m=Q}constructor(){this.xy=null,this.k=0,this.l=0,this.m=0}}w.Vector5=S;let m;(z=>(z[z.INITIAL=0]="INITIAL",z[z.SUBDIVIDED_BECAUSE_OF_CROSSING=1]="SUBDIVIDED_BECAUSE_OF_CROSSING",z[z.SUBDIVIDED_BECAUSE_OF_LOOP=2]="SUBDIVIDED_BECAUSE_OF_LOOP"))(m=w.CompileState||(w.CompileState={}));let f;(j=>(j[j.POINT=0]="POINT",j[j.LINE=1]="LINE",j[j.QUADRATIC=2]="QUADRATIC",j[j.CUSP=3]="CUSP",j[j.LOOP=4]="LOOP",j[j.SERPENTINE=5]="SERPENTINE"))(f=w.SegmentClass||(w.SegmentClass={})),w._EPSILON=5e-4,w._p=b.new(),w._p0=b.new(),w._p1=b.new(),w._p2=b.new(),w._p3=b.new(),w._b0=new h,w._b1=new h,w._b2=new h,w._b3=new h,w._v0=new S,w._v1=new S,w._v2=new S,w._v3=new S,w._v=[w._v0,w._v1,w._v2,w._v3]})(Up||(Up={}));var Vp=class{constructor(e,t){this.key=e,this.value=t}},pi=class{each(e){Dt.IntMap_each(this._buckets,(t,n)=>{for(let o of n)e(o.key,o.value)})}getOrInsertFallback(e){let t=this._hash(e),n=Dt.IntMap_get(this._buckets,t,null);if(n!=null){for(let i of n)if(this._equals(e,i.key))return i.value}else n=[],this._buckets.set(t,n);let o=this._fallback(e);return n.push(new Vp(e,o)),o}get(e,t){let n=this._hash(e),o=Dt.IntMap_get(this._buckets,n,null);if(o!=null){for(let i of o)if(this._equals(e,i.key))return i.value}return t}getOrNull(e){return this.get(e,null)}set(e,t){let n=this._hash(e),o=Dt.IntMap_get(this._buckets,n,null);o==null&&(o=[],this._buckets.set(n,o));for(let i of o)if(this._equals(e,i.key)){i.value=t;return}o.push(new Vp(e,t))}remove(e){let t=this._hash(e),n=Dt.IntMap_get(this._buckets,t,null);if(n!=null){for(let o=0,i=n.length;o<i;o=o+1)if(this._equals(e,n[o].key)){n.splice(o,1),n.length==0&&this._buckets.delete(t);break}}}constructor(e,t,n){this._buckets=new Map,this._hash=e,this._equals=t,this._fallback=n}};var Sd=class Sd{each(e){this._innerMap.each((t,n)=>{let o=n.deref();o&&e(t,o)})}getOrInsertFallback(e){var n;let t=(n=this._innerMap.getOrNull(e))==null?void 0:n.deref();return t||(t=this._fallback(e),this.set(e,t)),t}get(e,t){var n;return((n=this._innerMap.getOrNull(e))==null?void 0:n.deref())??t}getOrNull(e){return this.get(e,null)}set(e,t){this.remove(e);let n=new WeakRef(t);this._innerMap.set(e,n),Sd._cacheFinalizer.register(t,this.getNonSelfRetainingCleanupCallback(e),n)}remove(e){let t=this._innerMap.getOrNull(e);t&&(this._innerMap.remove(e),Sd._cacheFinalizer.unregister(t))}getNonSelfRetainingCleanupCallback(e){let t=new WeakRef(this);return function(){var o;let n=t.deref();n&&!((o=n._innerMap.getOrNull(e))!=null&&o.deref())&&n._innerMap.remove(e)}}constructor(e,t,n){this._innerMap=new pi(e,t,o=>{throw new Error("Cannot use fallback on WeakHashTable::_innerMap")}),this._fallback=n}};Sd._cacheFinalizer=new FinalizationRegistry(e=>{e()});var Td=Sd;var kp=class{constructor(e,t,n,o){this.bufferArea=e,this.hasNoCurves=t,this.hasNoOverlaps=n,this.hasNoCurvesAndSameOrientation=o}},ft;(T=>{function r(y){return`SCROLL_OFFSET::${y}`}T.forScrollOffset=r;function e(y){return`OVERLAY_POSITION::${y}`}T.forOverlayPosition=e;function t(y){return`ANIMATEABLE_TRANSLATION::${y}`}T.forAnimateableTranslation=t;function n(y){return`SHADOW_TRANSFORMATION::${y}`}T.forShadowTransformation=n;function o(y){return`ANIMATEABLE_OPACITY::${y}`}T.forAnimateableOpacity=o;function i(y){return`ANIMATEABLE_DISSOLVE::${y}`}T.forAnimateableDissolve=i;function a(y){return`DYNAMIC_GEOMETRY::${y}`}T.forDynamicGeometry=a;function s(y){return y.id.startsWith("SCROLL_OFFSET")}T.isScrollingTransform=s,T.ENTERING_TLF="ENTERING_TLF",T.EXITING_TLF="EXITING_TLF",T.ENTERING_OVERLAY="ENTERING_OVERLAY",T.EXITING_OVERLAY="EXITING_OVERLAY",T.ENTERING_OVERLAY_BACKGROUND="ENTERING_OVERLAY_BACKGROUND",T.EXITING_OVERLAY_BACKGROUND="EXITING_OVERLAY_BACKGROUND",T.OVERLAY_BACKGROUND="OVERLAY_BACKGROUND",T.SMART_ANIMATE_OVERLAY_TRANSLATION="SMART_ANIMATE_OVERLAY_TRANSLATION",T.OVERLAY_BACKGROUND_DISSOLVE="OVERLAY_BACKGROUND_DISSOLVE",T.DISSOLVE_TRANSITION="DISSOLVE_TRANSITION"})(ft||(ft={}));var Ho;(c=>{function r(p){if(gt.int_remainder(p.byteCount(),c.NUM_BYTES_PER_FLOAT)!=0)return!1;let u=p.byteCount()/c.NUM_BYTES_PER_FLOAT|0;if(gt.int_remainder(u,c.NUM_FLOATS_PER_VERTEX)!=0)return!1;let _=u/c.NUM_FLOATS_PER_VERTEX|0;if(gt.int_remainder(_,3)!=0)return!1;if(p.byteCount()>Bo.BYTE_COUNT)throw new Error("This triangles chunk exceeds the maximum buffer size and will crash if we try to render it");return!0}c.isValid=r;function e(p){return p.byteCount()/(c.NUM_BYTES_PER_FLOAT*c.NUM_FLOATS_PER_VERTEX)|0}c.numVertices=e;function t(p,u){let _=u*c.NUM_FLOATS_PER_VERTEX*c.NUM_BYTES_PER_FLOAT;return p.floatAt(_)}c.xValueAt=t;function n(p,u){let _=u*c.NUM_FLOATS_PER_VERTEX*c.NUM_BYTES_PER_FLOAT;return p.floatAt(_+1*c.NUM_BYTES_PER_FLOAT)}c.yValueAt=n;function o(p,u){let _=t(p,u),h=n(p,u);return new b(_,h)}c.xyValueAt=o;function i(p,u){let _=u*c.NUM_FLOATS_PER_VERTEX*c.NUM_BYTES_PER_FLOAT;return p.floatAt(_+2*c.NUM_BYTES_PER_FLOAT)}c.kValueAt=i;function a(p,u){let _=u*c.NUM_FLOATS_PER_VERTEX*c.NUM_BYTES_PER_FLOAT;return p.floatAt(_+3*c.NUM_BYTES_PER_FLOAT)}c.lValueAt=a;function s(p,u){let _=u*c.NUM_FLOATS_PER_VERTEX*c.NUM_BYTES_PER_FLOAT;return p.floatAt(_+4*c.NUM_BYTES_PER_FLOAT)}c.mValueAt=s,c.NUM_BYTES_PER_FLOAT=4,c.NUM_FLOATS_PER_VERTEX=5})(Ho||(Ho={}));var Fr=class Fr{static get uniqueValuesWeakRef(){return Fr._uniqueValuesWeakRef??(Fr._uniqueValuesWeakRef=new Td(e=>e.hash,(e,t)=>e.equals(t),e=>new Fr(e.path,e.windingRule)))}static UNIT_RECT(){return Fr._UNIT_RECT!=null||(Fr._UNIT_RECT=new Fr(St.fromRect(new G(0,0,1,1)),"NONZERO")),Fr._UNIT_RECT}static getOrCreate(e,t){return Y.viewerCleanupBufferAreas()?Fr.uniqueValuesWeakRef.getOrInsertFallback(new Fr.PathAndWindingRuleArgs(e,t)):Fr._uniqueValues.getOrInsertFallback(new Fr.PathAndWindingRuleArgs(e,t))}constructor(e,t){this._path=null,this._windingRule=null,this._cachedTriangles=null,this._path=e,this._windingRule=t}equals(e){return e==null?!1:this._windingRule==e._windingRule&&this._path.equals2(e._path)}bounds(){return this._path.bounds()}isRect(){return this._path.isRect()}path(){return this._path}windingRule(){return this._windingRule}triangles(e,t){return Ae.perfTimerScope("generate-triangles-viewer",Ae.ProfileLevel.LOW,()=>{let n=this._cachedTriangles==null;if(!n){for(let o of this._cachedTriangles)if(o.bufferArea!=null&&o.bufferArea.buffer()==null){n=!0;break}}n&&(this._cachedTriangles=this._convertToTriangles(e,t))}),this._cachedTriangles}_allTrianglesHaveSameOrientation(e){let t=0;for(let n=0;n<Ho.numVertices(e);n=n+3){let o=Ho.xyValueAt(e,n),i=Ho.xyValueAt(e,n+1),a=Ho.xyValueAt(e,n+2),s=b.cross(i.subtract(o),a.subtract(o)),l=s<0?-1:s>0?1:0;if(l!=0){if(t==-l)return!1;t=l}}return!0}_convertToTriangles(e,t){let n=[],o=null;if(this._path instanceof no)o=this._path.compileLoopBlinnAndReturnVolatileTriangles();else{Fr.TEMP_ARRAY.clear();let d=this._path.toBezierPath();Up.compile(d,Fr.TEMP_ARRAY),o=Fr.TEMP_ARRAY.bytes()}let i=t.stride()*3,a=Bo.BYTE_COUNT,s=a-gt.int_remainder(a,i),l=(o.length+s-1)/s|0;for(let d=0,c=l;d<c;d=d+1){let p=o.subarray(d*s,d*s+s),u=new fn(p),_=e.allocate(t,p);if(_==null)continue;let h=!0;for(let f=0,T=Ho.numVertices(u);f<T;f=f+1){let y=Ho.kValueAt(u,f),E=Ho.lValueAt(u,f),v=Ho.mValueAt(u,f);if(y!=.5||E!=.5||v!=.5){h=!1;break}}let S=Ho.numVertices(u)==3||this.isRect(),m=h&&this._allTrianglesHaveSameOrientation(u);n.push(new kp(_,h,S,m))}return l>1&&console.warn(`splitting ${o.length} byte geometry buffer into ${l} chunks`),n}};Fr.TEMP_ARRAY=new fn,Fr._UNIT_RECT=null,Fr._uniqueValues=new pi(e=>e.hash,(e,t)=>e.equals(t),e=>new Fr(e.path,e.windingRule)),Fr._uniqueValuesWeakRef=void 0;var Et=Fr;(e=>{class r{constructor(n,o){this.path=null,this.windingRule=null,this.hash=0,this.path=n,this.windingRule=o,this.hash=go.combine(n.hash(),o=="ODD"?1:0)}equals(n){return this.windingRule==n.windingRule&&this.path.equals2(n.path)}}e.PathAndWindingRuleArgs=r})(Et||(Et={}));var Hp=class{path(){throw new Error("Not implemented")}bounds(){throw new Error("Not implemented")}geometryEquals(e){throw new Error("Not implemented")}constructor(e,t,n){this.type=e,this.windingRule=t,this.styleID=n}},Dr=class r extends Hp{constructor(e,t,n,o){super(0,e,t),this._path=null,this._bounds=null,this._path=n,this._bounds=o}path(){return this._path}bounds(){return this._bounds}geometryEquals(e){return e instanceof r?e.windingRule==this.windingRule&&e.bounds().equals(this._bounds)&&e.path().equals2(this._path):!1}},Ed=class extends Hp{constructor(e,t,n,o){super(1,e,t),this._computePath=null,this._maxBounds=null,this._computePath=n,this._maxBounds=o}path(){return this._computePath()}bounds(){return this._maxBounds}geometryEquals(e){return e==this}},So=class{constructor(e){this._overrideTable=null,this._overrideTable=e}get(e,t){if(this._overrideTable!=null&&this._overrideTable._in(e)){let n=this._overrideTable.styleByID1(e),o=n!=null?Wi.get(n,102,null):null,i=o!=null?t.findStyle(Je.asStyleId(o)):null;if(i!=null&&i.styleType()=="FILL")return i.fillPaints();let a=n!=null?Wi.get(n,61,null):null;if(a!=null)return Je.asPaintList(a)}return null}forEachPaint(e,t){var n;(n=this._overrideTable)==null||n.forEachFillPaint(e,t)}table(){return this._overrideTable}},wr=class{geometryEquals(e){return ne.List_equalsWithComparison(this.regions,e.regions,(t,n)=>t.geometryEquals(n))}isRect(){return this.regions.length==1?Et.getOrCreate(this.regions[0].path(),this.regions[0].windingRule).isRect():!1}toString(){return`Geometry(bounds: ${this.bounds} with ${this.regions.length} regions)`}constructor(e,t,n,o){this.regions=e,this.styleIDs=t,this.bounds=n,this.paintOverrides=o}},zp=class extends wr{constructor(e,t,n,o,i,a,s){super(e,t,n,o),this.emojiCodepoints=i,this.emojiImageSet=a,this.decorationRegions=s}},ut=class r{static equals(e,t){if(e!=null&&t!=null&&e.guids.length==t.guids.length){for(let n=0,o=e.guids.length;n<o;n=n+1)if(!X.equals(e.guids[n],t.guids[n]))return!1;return!0}return e==t}static equalsGUID(e,t){return e!=null&&t!=null&&e.guids.length==1?X.equals(e.guids[0],t):e==null&&t==null}toString(){return`[${this.guids.map(e=>e).join(", ")}]`}startsWith(e){if(this.guids==null)return e.guids==null;if(this.guids.length<e.guids.length)return!1;for(let t=0,n=e.guids.length;t<n;t=t+1)if(!X.equals(e.guids[t],this.guids[t]))return!1;return!0}slice1(e){return this.slice2(e,this.guids.length)}slice2(e,t){return new r(this.guids.slice(e,t))}cloneAndAppend(e){let t=this.guids.slice();return Ir(t,e.guids),new r(t)}static fromString(e){if(e!=null&&e.length>=2&&e.startsWith("[")&&e.endsWith("]")){let t=e.slice(1,e.length-1).split(","),n=[];for(let o of t){let i=X.fromString(o.trim());if(i==null)return null;n.push(i)}return new r(n)}return null}constructor(e){this.guids=e}static ROOT_STABLE_PATH(){return new r([])}},zo;(o=>{function r(i){return i}o.map=r;function e(i){let a=[];return i.each((s,l)=>{a.push(`
  `+s.toString()+": "+or.toString(l))}),a.join(", ")}o.toString=e;function t(){return new eo(i=>i.toString())}o._new=t;function n(i,a){let s=new eo(l=>l.toString());for(let l=0,d=i.length;l<d;l=l+1)s.set(i[l],a[l]);return s}o.new1=n})(zo||(zo={}));var Ta=class{toString(){return`SymbolData(id=${this.masterID}, overrides=[${zo.toString(this.instanceOverrides)}])`}constructor(e,t){this.masterID=e,this.instanceOverrides=t}},Wp=class{constructor(e,t){this.value=e,this.units=t}toString(){return`${this.value} ${this.units}`}},Kp=class{constructor(e,t,n){this.family=e,this.style=t,this.postscript=n}toString(){return`${this.family} ${this.style}`}},xl=class{constructor(e,t){this.type=e,this.value=t}},Yp=class{constructor(e,t,n,o){this.suffix=e,this.imageType=t,this.constraint=n,this.contentsOnly=o}},Ri=class r{static DEFAULT_FOR_TESTS(){return new r("DEFAULT_FLOW_FOR_TESTS","default flow for tests",nr.FIRST_POSITION)}constructor(e,t,n){this.name=e,this.description=t,this.position=n}},Qp=class Qp{size(){switch(this.rotation){case"NONE":return this.nonRotatedSize;case"CCW_90":return this.nonRotatedSize.flipped()}return this.nonRotatedSize}canvasSpaceImageSize(e){let t=e.nonRotatedImageSize.divideScalar(e.scaleFactor);switch(this.rotation){case"NONE":return t;case"CCW_90":return t.flipped()}return t}canvasSpaceTopLeftOffset(e){let t=e.nonRotatedOffset,n=e.nonRotatedImageSize.divideScalar(e.scaleFactor),o=e.nonRotatedFramePresetSize;switch(this.rotation){case"NONE":return t;case"CCW_90":return new b(t.y(),n.x()-o.x()-t.x())}return t}canvasSpaceFramePresetSize(e){let t=e.nonRotatedFramePresetSize;switch(this.rotation){case"NONE":return t;case"CCW_90":return t.flipped()}return t}os(){return this.presetIdentifier==null||this.presetIdentifier==""?0:this.presetIdentifier.indexOf("APPLE")!=-1?this.presetIdentifier.indexOf("MACBOOK")!=-1?4:2:this.presetIdentifier.indexOf("GOOGLE")!=-1||this.presetIdentifier.indexOf("ANDROID")!=-1?1:this.presetIdentifier.indexOf("MICROSOFT")!=-1?5:(console.error(`${this.presetIdentifier} OS could not be inferred`),0)}toString(){return`PrototypeDevice(${this.type}, ${this.nonRotatedSize}, ${this.presetIdentifier}, ${this.rotation})`}toJSON(){return{type:this.type,size:{x:this.nonRotatedSize.x(),y:this.nonRotatedSize.y()},presetIdentifier:this.presetIdentifier,rotation:this.rotation}}constructor(e,t,n,o){this.type=e,this.nonRotatedSize=t,this.presetIdentifier=n,this.rotation=o}};Qp.DEFAULT=new Qp("NONE",new b(0,0),null,"NONE");var sn=Qp,vi=class{constructor(){arguments.length==0?(this.backgroundType="NONE",this.backgroundColor=O.new3(0,0,0,.25)):arguments.length==2&&(this.backgroundType=arguments[0],this.backgroundColor=arguments[1])}},$r=class{constructor(e=new Map){this._styleByID=e}_in(e){return this._styleByID.has(e)}styleByID1(e){return this._styleByID.get(e)}forEachStyle(e){for(let t of Array.from(this._styleByID.keys()))e(t,this._styleByID.get(t))}styleByID2(){return this._styleByID}forEachFillPaint(e,t){this.forEachStyle((n,o)=>{let i=Wi.get(o,102,null),a=i!=null?e.findStyle(Je.asStyleId(i)):null;if(a!=null){let s=a.fillPaints();s!=null&&t(s)}else if(Wi._in(o,61)){let s=Je.asPaintList(Wi.get(o,61,null));s!=null&&t(s)}})}};var Id=class{constructor(e,t,n){this.exitingTransitionRoot=e,this.swappedStablePath=t,this.hotspotInExitingTree=n}};function mv(r){return!r.hasNodeProperty(93)||r.prototypeStartingPoint()==null?!1:r.prototypeStartingPoint().name!=""||r.prototypeStartingPoint().description!=""||r.prototypeStartingPoint().position!=null&&nr.isValid(r.prototypeStartingPoint().position)}var Oi;(a=>{function r(s){return s.hasNodeProperty?Y.getFeatureFlags().prototype_fix_scrolling_hotspots?s.hasNodeProperty(98)&&s.hasOverflowingContentInScrollDirection():s.hasNodeProperty(98):s.scrollDirection()!="NONE"&&s.hasOverflowingContentInScrollDirection()}function e(s,l,d,c,p){let u=s.stickyNodeInitialTopPosition,_=s.overflowingAncestorInitialTopPosition,h=u-_;if(c)return d.y()>h?fe.FrozenVector_new4(d.x(),h):d;{if(p)return fe.FrozenVector_new4(0,0);let S=l(),m=s.stickyNodeHeight,f=s.parentNodeHeight,T=s.parentNodeInitialTopPosition,E=u-T+m,v=f-E,A=S.y()>h&&S.y()<=h+v,I=S.y()>h+v;return A?fe.FrozenVector_new4(0,h-S.y()):I?fe.FrozenVector_new4(0,-v):fe.FrozenVector_new4(0,0)}}a.getRelativeScrollTranslationOfStickyScrollingNodeFromBounds=e;function t(s){let l=s.parent();if(l==null)return fe.FrozenVector_new4(0,0);let d=l.isFixed()&&l.parent()!=null&&r(l.parent()),c=r(l);if(s.isStandardScrolling()){let p=Y.getFeatureFlags().prototype_parallax_scroll&&!o(s)?s.scrollSpeedMultiplier():1;if(c){let u=l.scrollOffset();return fe.FrozenVector_new4(u.x(),u.y()*p)}else return p!=1?n(l).multiplyScalar(p-1):fe.FrozenVector_ZERO}else if(s.isStickyScrolling()){let p=l;for(;p!=null&&!r(p);)p=p.parent();if(p==null)return fe.FrozenVector_ZERO;let u=s.absoluteTransform().m12(),_=s.size().y(),h=l.absoluteTransform().m12(),S=l.size().y(),m=p.absoluteTransform().m12(),f=new i(u,_,h,S,m);return e(f,()=>n(l),l.scrollOffset(),c,d)}return fe.FrozenVector_ZERO}a.getScrollTranslationOfNodeRelativeToParent=t;function n(s){let l=fe.FrozenVector_ZERO,d=s;for(;d!=null&&(!r(d)||d==s);){let c=t(d);l=l.add(c),d=d.parent()}return l}a.getScrollTranslationOfNodeRelativeToOverflowingAncestor=n;function o(s){let l=s;for(;l!=null;){if(l.isStickyScrolling())return!0;l=l.parent()}return!1}a.hasStickyScrollingAncestor=o;class i{constructor(l,d,c,p,u){this.stickyNodeInitialTopPosition=l,this.stickyNodeHeight=d,this.parentNodeInitialTopPosition=c,this.parentNodeHeight=p,this.overflowingAncestorInitialTopPosition=u}}a.StickyScrollBounds=i})(Oi||(Oi={}));var ln;(o=>{function r(i){return i!="NONE"}o.hasExplicitOverflow=r;function e(i){return i=="HORIZONTAL"||i=="BOTH"}o.scrollsHorizontally=e;function t(i){return i=="VERTICAL"||i=="BOTH"}o.scrollsVertically=t;function n(i,a){switch(i){case"VERTICAL":return Math.abs(a.y());case"HORIZONTAL":return Math.abs(a.x());case"BOTH":return Math.abs(a.length());default:break}return 0}o.getDirectionSimilarity=n})(ln||(ln={}));var Gf;(e=>{function r(t){let n=t,o=t.parent(),i=new b(0,0);for(;o!=null&&o.type()!="CANVAS";){let a=o.scrollDirection()!="NONE"&&o.hasNodeProperty(98),s=n.isFixed();a&&!s&&i.addUpdate1(o.scrollOffset()),n=o,o=o.parent()}return i}e.cumulativeScrollOffsetOfAncestors=r})(Gf||(Gf={}));function fv(r){switch(r){case"VERTICAL":return new b(0,1);case"HORIZONTAL":return new b(1,0);case"BOTH":{let e=new b(1,1);return e.divideScalar(e.length())}default:break}return b.new()}var qp=(n=>(n[n.BASE_SCREEN=0]="BASE_SCREEN",n[n.OVERLAY_OR_SUBLAYER=1]="OVERLAY_OR_SUBLAYER",n[n.DETERMINE_USING_NODE_FIELDS=2]="DETERMINE_USING_NODE_FIELDS",n))(qp||{}),Xp=class{constructor(e){this._node=null,this._overrideRole=null,this._node=e}overrideRole(e){this._overrideRole=new ce(e)}clearRoleOverride(){this._overrideRole=null}_role(){return this._overrideRole!=null?this._overrideRole.value:2}canvasSpaceContentBounds(){return this.scrollDirection()=="NONE"?this._node.canvasSpaceRenderedBounds():this._scrollableContentBounds()}defaultScrollOffset(){return this._node.canvasSpaceBoundingBox().topLeft().subtract(this.canvasSpaceContentBounds().topLeft())}minScrollOffsetX(){return-this.defaultScrollOffset().x()}minScrollOffsetY(){return-this.defaultScrollOffset().y()}maxScrollOffsetX(){return Math.max(this.minScrollOffsetX(),this.canvasSpaceContentBounds().right()-this._node.canvasSpaceBoundingBox().right())}maxScrollOffsetY(){return Math.max(this.minScrollOffsetY(),this.canvasSpaceContentBounds().bottom()-this._node.canvasSpaceBoundingBox().bottom())}hasOverflowingContentInXDirection(){return ln.scrollsHorizontally(this.scrollDirection())&&this.canvasSpaceContentBounds().width()>this._node.canvasSpaceBoundingBox().width()}hasOverflowingContentInYDirection(){return ln.scrollsVertically(this.scrollDirection())&&this.canvasSpaceContentBounds().height()>this._node.canvasSpaceBoundingBox().height()}shouldResizeToFitViewport(){return(this._role()==2?this._node.isTopLevel():this._role()==0)&&!this._node.isTooRotatedToScroll()}nodeSize(){if(this.shouldResizeToFitViewport()){let e=this._node.findContainingCanvasOrParent(),t=e.prototypeDevice(),n=e.currentViewportSize(),o=t.type=="NONE"||t.type=="PRESENTATION"?n:t.size();return new b(Math.min(this._node.fullSize().x(),o.x()),Math.min(this._node.fullSize().y(),o.y()))}else return this._node.fullSize()}nodeSpaceScrollableContentBounds(){let e=this._role()==2?this._node.isTopLevel():this._role()==0,t=!ln.hasExplicitOverflow(this._node.overflowDirection()),n=e?t:!this._node.isFrameMaskDisabled()&&this.scrollDirection()=="NONE",o=e&&t?this._node.originalSize():this._node.fullSize(),i=G.new2();if(n)i.setTo1(0,0,o.x(),o.y());else{let a=this._node.canvasSpaceBoundingBox().topLeft();i.setTo1(a.x(),a.y(),o.x(),o.y());for(let s=0,l=this._node.childCount();s<l;s=s+1){let d=this._node.childAt1(s);d.isFixed()||(Xn?i.expandToInclude(d.canvasSpaceBoundingBox()):i.expandToInclude(d.canvasSpaceScrollingBounds()))}i.setX(i.x()-a.x()),i.setY(i.y()-a.y()),this._node.overflowDirection()=="VERTICAL"?(i.setX(0),i.setWidth(o.x())):this._node.overflowDirection()=="HORIZONTAL"?(i.setY(0),i.setHeight(o.y())):this._node.overflowDirection()=="BOTH"}return i}_scrollableContentBounds(){let e=this.nodeSpaceScrollableContentBounds();return e.transformInto1(e,this._node.absoluteTransform()),e}scrollDirection(){let e=this._role()==2?Je.asBool(this._node.get(99,!1)):this._role()==0;return this._node.constrainsAnchoredChildren()?this._node.isTopLevel()&&e?"BOTH":this._node.overflowDirection():"NONE"}scrollDirectionWithScrollableContent(){let e=this.scrollDirection(),t=this.canvasSpaceContentBounds(),n=this._node.canvasSpaceBoundingBox(),o=ln.scrollsVertically(e)&&t.height()>n.height(),i=ln.scrollsHorizontally(e)&&t.width()>n.width();return o&&i?"BOTH":o?"VERTICAL":i?"HORIZONTAL":"NONE"}hasScrollableParent(){let e=this._node.parent();return!(e==null||e.overflowDirection()=="NONE"&&!(e.isTopLevel()&&e.type()=="FRAME"))}isFixed(){return this.hasScrollableParent()?this._node.scrollBehavior()=="FIXED_WHEN_CHILD_OF_SCROLLING_FRAME":!1}isStickyScrolling(){return this._node.scrollBehavior()=="STICKY_SCROLLS"}isStandardScrolling(){return!this.isFixed()&&!this.isStickyScrolling()}scrollAndClipBoundsBySelfAndAncestors(e,t){let n=e.clone(),o=this._node;for(;o.parent()!=null;){let i=Oi.getScrollTranslationOfNodeRelativeToParent(o);n.translate2(i.negative());let a=o.parent();a.clipsToBoundingRectangle()&&t==0&&n.intersectWith(a.canvasSpaceBoundingBox()),o=a}return n}canvasSpaceScrolledBounds(e){return this.scrollAndClipBoundsBySelfAndAncestors(this._node.canvasSpaceBoundingBox(),e)}canvasSpaceScrolledInteractiveBounds(e){let t=this._node.canvasSpaceInteractiveBounds();return this.scrollAndClipBoundsBySelfAndAncestors(t,e)}scrollsInPreferredDirection(e){switch(e){case"HORIZONTAL":return ln.scrollsHorizontally(this.scrollDirection());case"VERTICAL":return ln.scrollsVertically(this.scrollDirection());case"BOTH":return this.scrollDirection()!="NONE"}return!1}hasOverflowingContentInScrollDirection(){let e=this.canvasSpaceContentBounds(),t=this._node.canvasSpaceBoundingBox();return ln.scrollsHorizontally(this.scrollDirection())&&e.width()>t.width()||ln.scrollsVertically(this.scrollDirection())&&e.height()>t.height()}};var Un=class{constructor(e,t){this.a=e,this.b=t}};var Ys=.001,Ci=class{path(){throw new Error("Not implemented")}optimized(){throw new Error("Not implemented")}equals(e){throw new Error("Not implemented")}withNewPaints(e){throw new Error("Not implemented")}canBeAnalyticallyAntialiased(){return this.path().path().canBeAnalyticallyAntialiased()}constructor(e,t,n){this.type=e,this.paints=t,this.maxBounds=n}};(e=>{let r;(o=>(o[o.STATIC=0]="STATIC",o[o.DYNAMIC=1]="DYNAMIC"))(r=e.PaintedGeometryType||(e.PaintedGeometryType={}))})(Ci||(Ci={}));var wt=class r extends Ci{constructor(e,t){super(0,t,e.bounds()),this._isOptimized=!1,this._path=e}path(){return this._path}withNewPaints(e){return new r(this._path,e)}equals(e){if(this.type!=e.type)return!1;if(this.path()==null||e.path()==null){if(this.path()==null!=(e.path()==null))return!1}else if(!this.path().equals(e.path()))return!1;if(this.paints==null||e.paints==null){if(this.paints==null!=(e.paints==null))return!1}else if(!Se.equals(this.paints,e.paints))return!1;return!0}optimized(){if(this._isOptimized)return this;let e=Se.optimize(this.paints);return this.paints!=e?new r(this.path(),e):(this._isOptimized=!0,this)}},Bl=class r extends Ci{constructor(e,t,n,o){super(1,t,n),this._isOptimized=!1,this._computePath=e,this.id=o}path(){return this._computePath()}withNewPaints(e){return new r(this._computePath,e,this.maxBounds,this.id)}equals(e){return this.type==e.type&&this.id==e.id}optimized(){if(this._isOptimized)return this;let e=Se.optimize(this.paints);return this.paints!=e?new r(this._computePath,e,this.maxBounds,this.id):(this._isOptimized=!0,this)}},En=(_=>(_[_.METADATA=0]="METADATA",_[_.GROUP=1]="GROUP",_[_.SUPERSAMPLE_GROUP=2]="SUPERSAMPLE_GROUP",_[_.FILL=3]="FILL",_[_.FILL_STROKE=4]="FILL_STROKE",_[_.MASK=5]="MASK",_[_.BLUR=6]="BLUR",_[_.BLEND=7]="BLEND",_[_.COMPOSITE_TILE_GRID=8]="COMPOSITE_TILE_GRID",_[_.HARD_MASK_WITH_COLOR=9]="HARD_MASK_WITH_COLOR",_[_.VOLATILE_PROPERTY_BINDING=10]="VOLATILE_PROPERTY_BINDING",_[_.STATIC_TRANSFORM_BINDING=11]="STATIC_TRANSFORM_BINDING",_[_.DISSOLVE=12]="DISSOLVE",_))(En||{});var Ki;(i=>{function r(a,s){return a.has(s)}i.has=r;function e(a,s){return a.get(s)}i.get=e;function t(a,s,l){a.set(s,l)}i.set=t;function n(a){a.clear()}i.clear=n;function o(){return new Map}i._new=o})(Ki||(Ki={}));var Or=class r{currentBounds(e){if(e==null)return this.maxBounds;if(Ki.has(e,this))return Ki.get(e,this);let t=this.computeBounds(e);return Ki.set(e,this,t),t}equals(e){return this.equalsWithinBounds(e,null)}equalsWithinBounds(e,t){if(e==this)return!0;if(t!=null){let n=e.maxBounds.overlaps(t),o=this.maxBounds.overlaps(t);if(!n&&!o)return!0;if(n!=o)return!1;if(!e.maxBounds.equals(this.maxBounds)){if(t.contains1(e.maxBounds)&&t.contains1(this.maxBounds))return!1;let i=G.fromRect(this.maxBounds).intersectedWith(t),a=G.fromRect(this.maxBounds).intersectedWith(t);if(!i.equals(a))return!1}}return e.op()!=this.op()?!1:this.equalsWithinBoundsImpl(e,t)}constructor(e,t){this.maxBounds=null,this._isOptimized=!1,this.flags=0,this.maxBounds=e,this.flags=t}hasNonIsolatedBlends(){return(1&this.flags)!=0}hasBackgroundBlurs(){return(2&this.flags)!=0}canBeUsedInBackgroundBlurs(){return(4&this.flags)==0}hasVolatileContent(){return(8&this.flags)!=0}hasAnimatingMedia(){return(16&this.flags)!=0}maskNeedsSSAA(){return(32&this.flags)!=0}canCacheRasterized(){return!(this.hasNonIsolatedBlends()||this.hasBackgroundBlurs()||this.hasAnimatingMedia()||this.hasVolatileContent())}isRectFill(){if(this.op()==3){let e=this;if(e.geometry.path().isRect()&&e.transform.hasPerpendicularAxes(Ys))return!0}return!1}isAxisAlignedRoundedRectFill(){if(this.op()==3){let e=this;if(e.geometry.path().path().asRoundedRectPath()!=null&&e.transform.isAxisAligned(Ys))return!0}return!1}isAxisAlignedRectFill(){if(this.op()==3){let e=this;if(e.geometry.path().isRect()&&e.transform.isAxisAligned(Ys))return!0}return!1}isRoundedRectFill(){if(this.op()==3){let e=this;if(e.geometry.path().path()instanceof St&&e.transform.hasPerpendicularAxes(Ys))return!0}return!1}desiredAntialiasing(){return this.op()!=3&&this.op()!=4?0:this.hasAnimatingMedia()||this.hasVolatileContent()?0:this.op()==3&&this.geometry.canBeAnalyticallyAntialiased()?1:2}opProfileString(){let e="RenderNodeOp: ";switch(this.op()){case 0:{e+="METADATA";break}case 2:{e+="SUPERSAMPLE_GROUP";break}case 1:{e+="GROUP";break}case 3:{e+="FILL";break}case 4:{let t=this;switch(e+="FILL_STROKE",t.mode){case 0:{e+=" mode=INSIDE";break}case 1:{e+=" mode=OUTSIDE";break}}break}case 5:{let t=this;switch(e+="MASK",t.type){case 0:{e+=" type=NORMAL";break}case 3:{e+=" type=BACKGROUND_BLUR";break}case 2:{e+=" type=INNER_SHADOW";break}case 4:{e+=" type=KNOCKOUT_SHADOW";break}case 1:{e+=" type=LUMINANCE";break}}break}case 6:{e+="BLUR";break}case 7:{e+="BLEND mode="+this.blendMode;break}case 9:{e+="HARD_MASK_WITH_COLOR";break}case 8:{e+="COMPOSITE_TILE_GRID";break}case 10:{let t=this;e+=`VOLATILE_PROPERTY_BINDING property=${Za.VolatileProperty_toString(t.property)}`;break}case 11:{e+=`STATIC_TRANSFORM_BINDING transform=${this.transform}`;break}case 12:{e+="DISSOLVE";break}default:throw new Error(`Unhandled node op ${En[this.op()]}`)}return e}debugString1(){return this.debugString2(r.DebugStringType.BASIC)}debugString2(e){let t=new r.GenerateStringState;return this._debugStringRecursive(this,t,!0,!1,e),t.result}_debugStringRecursive(e,t,n,o,i){let a=i!=r.DebugStringType.BASIC;t.result+=t.indent,n||(t.result+=o?"\u2514\u2500":"\u251C\u2500");let s=t.indent.length;switch(n||(t.indent+=o?"  ":"\u2502 "),e.op()){case 0:{let l=e;t.result+="METADATA",this._appendFlagsToString(t,e),t.result+=`
`,this._debugStringRecursive(l.child,t,!1,!0,i);break}case 2:{let l=e;t.result+="SUPERSAMPLE_GROUP",this._appendFlagsToString(t,e),t.result+=`
`,this._debugStringRecursive(l.child,t,!1,!0,i);break}case 1:{let l=e;t.result+="GROUP",this._appendFlagsToString(t,e),t.result+=`
`;for(let d=0,c=l.children.length;d<c;d=d+1){let p=l.children[d];this._debugStringRecursive(p,t,!1,d+1==l.children.length,i)}break}case 3:{let l=e,d=l.geometry.path().path(),c=d instanceof Aa?"CirclePath":d instanceof St?"RoundedRectPath":d instanceof Rt?"BezierPath":d instanceof ze?"FrozenBezierPath":d instanceof no?"UniquePath":"UnknownPath";t.result+=`FILL path=${c} paints=`,this._appendPaintDataToString(t,l.geometry.paints,i),a&&(t.result+=` transform=${l.transform}`,t.result+=` paintSize=${l.paintSize}`),e.isRectFill()?t.result+=" isRect":e.isRoundedRectFill()&&(t.result+=" isRoundedRect"),this._appendFlagsToString(t,e),t.result+=`
`;break}case 4:{let l=e;switch(t.result+="FILL_STROKE",l.mode){case 0:{t.result+=" mode=INSIDE";break}case 1:{t.result+=" mode=OUTSIDE";break}}t.result+=" fills=",this._appendGeometriesToString(t,l.fillGeometries,i),t.result+=" strokes=",this._appendGeometriesToString(t,l.strokeGeometries,i),a&&(t.result+=` transform=${l.transform}`),this._appendFlagsToString(t,l),t.result+=`
`;break}case 5:{let l=e;switch(t.result+="MASK",l.type){case 0:{t.result+=" type=NORMAL";break}case 3:{t.result+=" type=BACKGROUND_BLUR";break}case 2:{t.result+=" type=INNER_SHADOW color=",this._appendColorToString(t,l.innerShadowFill);break}case 4:{t.result+=" type=KNOCKOUT_SHADOW";break}}this._appendFlagsToString(t,e),t.result+=`
`,this._debugStringRecursive(l.alpha,t,!1,!1,i),this._debugStringRecursive(l.color,t,!1,!0,i);break}case 6:{let l=e;t.result+="BLUR",l.startRadius!=l.endRadius?(t.result+=` start radius=${l.startRadius}`,t.result+=` end radius=${l.endRadius}`):t.result+=` radius=${l.endRadius}`,a&&(t.result+=` clamp=${l.clamp}`),this._appendFlagsToString(t,e),t.result+=`
`,this._debugStringRecursive(l.child,t,!1,!0,i);break}case 7:{let l=e;t.result+="BLEND mode=",t.result+=l.blendMode,t.result+=` opacity=${l.opacity}`,this._appendFlagsToString(t,e),t.result+=`
`,this._debugStringRecursive(l.child,t,!1,!0,i);break}case 9:{let l=e;t.result+="HARD_MASK_WITH_COLOR color=",this._appendColorToString(t,l.color),this._appendFlagsToString(t,e),t.result+=`
`,this._debugStringRecursive(l.alpha,t,!1,!0,i);break}case 8:{let l=e;t.result+="COMPOSITE_TILE_GRID",this._appendFlagsToString(t,e),t.result+=`
`,this._debugStringRecursive(l.tree,t,!1,!0,i);break}case 10:{let l=e;switch(t.result+=`VOLATILE_PROPERTY_BINDING property=${Za.VolatileProperty_toString(l.property)}`,a&&(t.result+=` id=${l.id}`),l.property){case 3:{t.result+=` value=${l.maxTransformScale()}`;break}case 2:{t.result+=` value=${l.transform()}`,l.id.startsWith("SHADOW_TRANSFORMATION")&&(t.result+=" SHADOW_TRANSFORMATION");break}case 4:{t.result+=` value=${l.opacity()}`;break}}this._appendFlagsToString(t,e),t.result+=`
`,this._debugStringRecursive(l.child,t,!1,!0,i);break}case 11:{let l=e;t.result+=`STATIC_TRANSFORM_BINDING transform=${l.transform}`,this._appendFlagsToString(t,e),t.result+=`
`,this._debugStringRecursive(l.child,t,!1,!0,i);break}case 12:{let l=e;t.result+="DISSOLVE",this._appendFlagsToString(t,e),t.result+=`
`,this._debugStringRecursive(l.startChild,t,!1,!1,i),this._debugStringRecursive(l.endChild,t,!1,!0,i);break}default:throw new Error(`Unhandled node op ${En[e.op()]}`)}t.indent=t.indent.slice(0,s)}_appendGeometriesToString(e,t,n){e.result+="[";for(let o=0,i=t.length;o<i;o=o+1){let a=t[o];o!=0&&(e.result+=", ");let s=a.path().path();s instanceof Rt?e.result+=`(${s.countCommands()} commands, `:s instanceof Aa?e.result+="EllipsePath, ":s instanceof St&&(e.result+="RoundedRectPath, "),this._appendPaintDataToString(e,a.paints,n),e.result+=")"}e.result+="]"}_appendFlagsToString(e,t){t.hasNonIsolatedBlends()&&(e.result+=" hasBlends"),t.hasBackgroundBlurs()&&(e.result+=" hasBgBlurs"),t.canBeUsedInBackgroundBlurs()&&(e.result+=" bgBlurSafe"),t.maskNeedsSSAA()&&(e.result+=" maskNeedsSSAA"),t.hasVolatileContent()&&(e.result+=" volatile"),t.canCacheRasterized()||(e.result+=" nocache")}_appendSinglePaintToString(e,t,n){let o=n!=r.DebugStringType.BASIC,i=t.asVolatilePaint();if(i!=null){e.result+="VOLATILE [",this._appendSinglePaintToString(e,i.from(),n),e.result+=" -> ",this._appendSinglePaintToString(e,i.to(),n),e.result+="]";return}let a=t.asSinglePaint();switch(a.type()){case"SOLID":{e.result+="color=",this._appendColorToString(e,a.color());break}case"GRADIENT_LINEAR":case"GRADIENT_RADIAL":case"GRADIENT_ANGULAR":case"GRADIENT_DIAMOND":{e.result+="stops=[";let s=a.colorStops();for(let l=0,d=s.length;l<d;l=l+1){l>0&&(e.result+=", ");let c=s[l];e.result+=`${c.position}`,e.result+=" ",this._appendColorToString(e,c.color)}e.result+="]";break}case"IMAGE":case"VIDEO":{o&&(e.result+=` hash=${a.image()!=null?a.image().hash():"NULL"}`,e.result+=` thumbnail=${a.imageThumbnail()!=null?a.imageThumbnail().hash():"NULL"}`,e.result+=` imageScaleMode=${a.imageScaleMode()}`,e.result+=` imageRotationDeg=${a.rotationDeg()}`,e.result+=` imageScalingFactor=${a.scalingFactor()}`);break}default:break}o&&a.transform()!=null&&(e.result+=` transform=${a.transform()}`),e.result+=` opacity=${a.opacity()}`}_appendPaintDataToString(e,t,n){e.result+="[";for(let o=0,i=t.length;o<i;o=o+1){o>0&&(e.result+=",");let a=t[o];e.result+=a.type()+" ",this._appendSinglePaintToString(e,a,n)}e.result+="]"}_appendColorToString(e,t){O.isOpaque(t)?e.result+=O.toCSS(t):e.result+=`rgba(${O.red(t)}, ${O.green(t)}, ${O.blue(t)}, ${O.alpha(t)})`}static visitEachNodeInTree(e,t,n){if(e!=null){switch(t!=null&&t(e),e.op()){case 0:{let o=e;r.visitEachNodeInTree(o.child,t,n);break}case 2:{let o=e;r.visitEachNodeInTree(o.child,t,n);break}case 1:{let o=e;for(let i of o.children)r.visitEachNodeInTree(i,t,n);break}case 3:case 4:case 8:break;case 5:{let o=e;r.visitEachNodeInTree(o.alpha,t,n),r.visitEachNodeInTree(o.color,t,n);break}case 6:{let o=e;r.visitEachNodeInTree(o.child,t,n);break}case 7:{let o=e;r.visitEachNodeInTree(o.child,t,n);break}case 9:{let o=e;r.visitEachNodeInTree(o.alpha,t,n);break}case 10:{let o=e;r.visitEachNodeInTree(o.child,t,n);break}case 11:{let o=e;r.visitEachNodeInTree(o.child,t,n);break}case 12:{let o=e;r.visitEachNodeInTree(o.startChild,t,n),r.visitEachNodeInTree(o.endChild,t,n);break}default:throw new Error(`Unhandled node op ${En[e.op()]}`)}n!=null&&n(e)}}static geometryNodePaintSize(e){return e==null?null:e.op()==3||e.op()==4?e.paintSize:null}};(t=>{let r;(i=>(i[i.BASIC=0]="BASIC",i[i.EXTENDED=1]="EXTENDED"))(r=t.DebugStringType||(t.DebugStringType={}));class e{constructor(){this.result="",this.indent=""}}t.GenerateStringState=e})(Or||(Or={}));var ke=class r extends Or{constructor(e,t=!1){super(Av(e,null),LF(e)),this.children=e,this._isFirstChildSolidBackground=t,this._isFirstChildSolidBackground}op(){return 1}isFirstChildSolidBackground(){return this._isFirstChildSolidBackground}canCacheRasterized(){return this.hasAnimatingMedia()||this.hasVolatileContent()||this.hasBackgroundBlurs()?!1:this._isFirstChildSolidBackground?!0:!this.hasNonIsolatedBlends()}computeBounds(e){return Av(this.children,e)}optimized(){if(this._isOptimized)return this;if(this.maxBounds.isEmpty())return null;let e=this.children.length;for(let t=0;t<e;t=t+1){if(t==0&&this._isFirstChildSolidBackground)continue;let n=this.children[t],o=n.optimized();if(o==n&&n.op()!=1)continue;let i=this.children.slice(0,t),a=(s,l)=>{if(l.op()==1){let d=l;for(let c of d.children)s.push(c)}else s.push(l)};for(o!=null&&a(i,o);(t=t+1)<e;){let s=this.children[t].optimized();s!=null&&a(i,s)}return i.length==0?null:this._isFirstChildSolidBackground?i.length==1?null:new r(i,this._isFirstChildSolidBackground):r.wrap(i)}return this.children.length==1?this.children[0]:(this._isOptimized=!0,this)}equalsWithinBoundsImpl(e,t){let o=e.children;if(this.children.length!=o.length)return!1;for(let i=0,a=this.children.length;i<a;i=i+1)if(!this.children[i].equalsWithinBounds(o[i],t))return!1;return!0}static wrap(e){return e.length==1?e[0]:new r(e)}static wrapWithSolidBackground(e,t){let n=Ar.solidColorRect(e.maxBounds,t,1);return new r([n,e],!0)}},_i=class r extends Or{constructor(e,t){super(e.maxBounds,t?e.flags|t:e.flags),this.child=e}op(){return 2}computeBounds(e){return this.child.computeBounds(e)}optimized(){if(this._isOptimized)return this;let e=o=>o.op()==5&&o.type==4,t=e($p(this.child)),n=this.child.optimized();return n==null?null:t&&!e($p(n))||!n.maskNeedsSSAA()&&!this.maskNeedsSSAA()?n:n!=this.child?new r(n,this.flags):(this._isOptimized=!0,this)}equalsWithinBoundsImpl(e,t){let n=e;return this.child.equalsWithinBounds(n.child,t)}static thatShouldNotBeUnwrappedInOptimization(e){return new r(e,32)}},qa=class r extends Or{op(){return 0}constructor(e,t){super(e.maxBounds,t|e.flags),this.child=e}computeBounds(e){return this.child.computeBounds(e)}optimized(){if(this._isOptimized)return this;let e=this.child.optimized();return e==null?null:e==this.child?(this._isOptimized=!0,this):new r(e,this.flags)}equalsWithinBoundsImpl(e,t){let n=e;return this.flags==e.flags&&this.child.equalsWithinBounds(n.child,t)}static createForBackgroundBlur(e){return new r(e,6)}},Ar=class r extends Or{op(){return 3}constructor(e,t,n){super(FF(e,t),GF(t)),this.transform=e,this.geometry=t,this.paintSize=n}geometryBounds(){return this.geometry.canBeAnalyticallyAntialiased()?this.transform.clone().transformRect(this.geometry.path().bounds().clone()):this.maxBounds}computeBounds(e){return this.maxBounds}withPaints(e){return new r(this.transform,this.geometry.withNewPaints(e),this.paintSize)}optimized(){if(this._isOptimized)return this;if(this.maxBounds.isEmpty()||!Se.containsAtLeastOneVisiblePaint(this.geometry.paints))return null;let e=this.geometry.optimized(),t=e.type==0,n=e.canBeAnalyticallyAntialiased();if(t&&!n&&!e.path().isRect()&&(Se.hasAnimatingMediaPaints(e.paints)||Se.hasVolatilePaints(e.paints))){let o=new r(this.transform,new wt(e.path(),[$.createSolid(O.BLACK,1)]),this.paintSize),i=new r(this.transform,new wt(Et.getOrCreate(St.fromRect(e.path().bounds()),"ODD"),e.paints),this.paintSize);return new In(o,i).optimized()}return e==this.geometry?(this._isOptimized=!0,this):new r(this.transform,e,this.paintSize)}equalsWithinBoundsImpl(e,t){let n=e;return this.transform.equals1(n.transform)&&this.geometry.equals(n.geometry)&&this.paintSize.equals(n.paintSize)}static solidColorRect(e,t,n){let o=[$.createSolid(t,n)],i=J.new2().translatedBy1(e.topLeft()).scaledBy1(e.size()),a=new wt(Et.UNIT_RECT(),o),s=fe.FrozenVector_ZERO;return new r(i,a,s)}};var yd=class r extends Or{op(){return 4}constructor(e,t,n,o,i){super(PF(e,t,n,i),NF([t,n])),this.mode=0,this.transform=e,this.fillGeometries=t,this.strokeGeometries=n,this.paintSize=o,this.mode=i}computeBounds(e){return this.maxBounds}optimized(){if(this._isOptimized)return this;let e=[];for(let o=0,i=this.strokeGeometries.length;o<i;o=o+1){let a=this.strokeGeometries[o];Se.containsAtLeastOneVisiblePaint(a.paints)&&e.push(a)}if(this.maxBounds.isEmpty()||this.fillGeometries.length==0&&e.length==0)return null;let t=o=>{let i=[];for(let a=0,s=o.length;a<s;a=a+1){let l=o[a];i.push(new Ar(this.transform,l,this.paintSize))}return ke.wrap(i).optimized()};return e.length==0?t(this.fillGeometries):this.fillGeometries.length==0?this.mode==0?null:t(e):Mt.FrozenList_equals(e,this.strokeGeometries,(o,i)=>o.equals(i))?(this._isOptimized=!0,this):new r(this.transform,this.fillGeometries,e,this.paintSize,this.mode).optimized()}equalsWithinBoundsImpl(e,t){let n=e;return this.transform.equals1(n.transform)&&Mt.FrozenList_equals(this.fillGeometries,n.fillGeometries,(o,i)=>o.equals(i))&&Mt.FrozenList_equals(this.strokeGeometries,n.strokeGeometries,(o,i)=>o.equals(i))&&this.paintSize.equals(n.paintSize)&&this.mode==n.mode}};var In=class r extends Or{constructor(){let e=arguments[0],t=arguments[1];if(arguments.length==5){let n=arguments[2];super(Uf(e,t,n,null),Iv(e,t,n)),this.alpha=e,this.color=t,this.type=n,this.innerShadowFill=arguments[3],this.innerShadowAlphaRequiresHardMask=arguments[4]}else arguments.length==2&&(super(Uf(e,t,0,null),Iv(e,t,0)),this.alpha=e,this.color=t,this.type=0,this.innerShadowFill=O.TRANSPARENT,this.innerShadowAlphaRequiresHardMask=!1)}op(){return 5}computeBounds(e){return Uf(this.alpha,this.color,this.type,e)}optimized(){if(this._isOptimized)return this;if(this.maxBounds.isEmpty())return null;let e=this.alpha.optimized();if(e==null)return null;let t=this.color.optimized(),n=this.type!=4,o=this.type!=4&&this.type!=2;if(t!=null&&n&&(t=r.cullGroupChildren(t,e.maxBounds)),t!=null&&o&&(e=r.cullGroupChildren(e,t.maxBounds),e==null))return null;switch(this.type){case 0:case 1:{if(t==null)return null;let i=!1,a=e;if(e.isAxisAlignedRectFill()){let s=G.new2();s.copyFrom(a.geometryBounds()),s.expand1(Ys),i=s.contains1(t.maxBounds)}else if(e.isAxisAlignedRoundedRectFill()){let l=a.geometry.path().path().asRoundedRectPath().radii(),d=G.new2();d.copyFrom(a.geometryBounds()),d.expand1(Ys);let c=Math.max(Math.max(l.topLeft,l.topRight),Math.max(l.bottomLeft,l.bottomRight)),p=Math.min(d.width()/2,d.height()/2);if(c<=p){let u=G.new2();if(u.copyFrom(a.geometryBounds()),u.expand1(Ys),u.contains1(t.maxBounds)){let h=t.maxBounds,S=h.left(),m=h.right(),f=h.top(),T=h.bottom(),y=new b(u.left()+l.topLeft,u.top()+l.topLeft),E=new b(u.right()-l.topRight,u.top()+l.topRight),v=new b(u.left()+l.bottomLeft,u.bottom()-l.bottomLeft),A=new b(u.right()-l.bottomRight,u.bottom()-l.bottomRight);(S>=y.x()||f>=y.y()||Math.sqrt(Math.pow(S-y.x(),2)+Math.pow(f-y.y(),2))<=l.topLeft)&&(m<=E.x()||f>=E.y()||Math.sqrt(Math.pow(m-E.x(),2)+Math.pow(f-E.y(),2))<=l.topRight)&&(S>=v.x()||T<=v.y()||Math.sqrt(Math.pow(S-v.x(),2)+Math.pow(T-v.y(),2))<=l.bottomLeft)&&(m<=A.x()||T<=A.y()||Math.sqrt(Math.pow(m-A.x(),2)+Math.pow(T-A.y(),2))<=l.bottomRight)&&(i=!0)}}}if(i){let s=a.geometry.paints;if((this.type===0||!Y.getFeatureFlags().render_tree_luminance_mask_fix)&&Se.containsAtLeastOneVisibleOpaquePaint(s))return t;let l=Se.onlySolidPaintOrNull(s);if(l!=null)return new io("PASS_THROUGH",O.alphaF(l.color())*l.opacity(),t).optimized()}break}case 4:{if(t==null)return null;let i=e.maxBounds,a=t.maxBounds;if(!i.overlaps(a))return t;if(!e.hasVolatileContent()&&i.contains1(a))return null;break}case 2:{if(O.alpha(this.innerShadowFill)==0)return null;if(t==null&&e.op()==3&&!this.innerShadowAlphaRequiresHardMask){let i=e,a=i.geometry.paints,s=Se.onlySolidPaintOrNull(a);if(s!=null)return i.withPaints([$.createSolid(O.multiplyOpacity(this.innerShadowFill,O.alphaF(s.color())),1)])}if(e.op()==9&&t!=null){let i=e;return new r(i.alpha,t,this.type,this.innerShadowFill,!0)}break}case 3:break}return e==this.alpha&&t==this.color?(this._isOptimized=!0,this):(t==null&&(t=new ke([])),new r(e,t,this.type,this.innerShadowFill,this.innerShadowAlphaRequiresHardMask))}equalsWithinBoundsImpl(e,t){let n=e;return this.type==n.type&&this.innerShadowFill==n.innerShadowFill&&this.alpha.equalsWithinBounds(n.alpha,t)&&this.color.equalsWithinBounds(n.color,t)}static createForInnerShadow(e,t,n){return new r(e,t,2,n,!1)}static createForBackgroundBlur(e,t){return new r(e,t,3,O.TRANSPARENT,!1)}static createForKnockoutShadow(e,t){return new r(e,t,4,O.TRANSPARENT,!1)}static createForLuminanceMask(e,t){return new r(e,t,1,O.TRANSPARENT,!1)}static cullGroupChildren(e,t){if(e!=null&&!e.maxBounds.overlaps(t))return null;if(e!=null&&e.op()==1){let n=e,o=n.children.length;for(let i=0;i<o;i=i+1)if(!n.children[i].maxBounds.overlaps(t)){let s=n.children.slice(0,i);for(;(i=i+1)<o;)n.children[i].maxBounds.overlaps(t)&&s.push(n.children[i]);return ke.wrap(s).optimized()}}return e}},To=class r extends Or{op(){return 9}constructor(e,t){super(O.alpha(t)>0?e.maxBounds:G.INVALID,xF(e)),this.alpha=e,this.color=t}computeBounds(e){return O.alpha(this.color)>0?this.alpha.currentBounds(e):G.INVALID}optimized(){if(this._isOptimized)return this;if(this.maxBounds.isEmpty())return null;let e=this.alpha.optimized();if(e==null)return null;if(e.op()==10){let n=e;return new rt(new r(n.child,this.color),n.id,n.property,n.getter).optimized()}e=gv(e,n=>(n.op()==7&&(n=n.child),n));let t=gv(e,n=>{if(n.op()==3){let o=n;if(!Se.hasVolatilePaints(o.geometry.paints)&&!Se.hasAnyFullyTransparentAreas(o.geometry.paints))return o.withPaints([$.createSolid(this.color,1)])}return n});return t!=e?t:e==this.alpha?(this._isOptimized=!0,this):new r(e,this.color)}equalsWithinBoundsImpl(e,t){let n=e;return this.color==n.color&&this.alpha.equalsWithinBounds(n.alpha,t)}};var oo=class r extends Or{op(){return 6}constructor(e,t,n,o,i,a,s){super(Sv(n,a,null),BF(a)),this.blurOpType=e,this.startRadius=t,this.endRadius=n,this.startPoint=o,this.endPoint=i,this.child=a,this.clamp=s}static createForStandardBlur(e,t,n){return new r(0,e,e,new b(0,0),new b(0,0),t,n)}static createForProgressiveBlur(e,t,n,o,i,a){return e>t||o.equals(n)?r.createForStandardBlur(t,i,a):new r(1,e,t,n,o,i,a)}computeBounds(e){return Sv(this.endRadius,this.child,e)}optimized(){if(this._isOptimized)return this;if(this.maxBounds.isEmpty())return null;let e=this.child.optimized();if(e==null)return null;if(this.startRadius==0&&this.endRadius==0)return e;if(e.op()==10&&this.clamp.isInvalid()){let t=e;return new rt(new r(this.blurOpType,this.startRadius,this.endRadius,this.startPoint,this.endPoint,t.child,this.clamp),t.id,t.property,t.getter).optimized()}return e==this.child?(this._isOptimized=!0,this):new r(this.blurOpType,this.startRadius,this.endRadius,this.startPoint,this.endPoint,e,this.clamp)}equalsWithinBoundsImpl(e,t){let n=e;return this.blurOpType==n.blurOpType&&this.startRadius==n.startRadius&&this.endRadius==n.endRadius&&this.startPoint.equals(n.startPoint)&&this.endPoint.equals(n.endPoint)&&this.clamp.equals(n.clamp)&&this.child.equalsWithinBounds(n.child,t)}},io=class r extends Or{op(){return 7}constructor(e,t,n){super(t>0?n.maxBounds:G.INVALID,MF(e,n)),this.blendMode=null,this.opacity=0,this.child=null,this.blendMode=e,this.opacity=t,this.child=n}computeBounds(e){return this.opacity>0?this.child.currentBounds(e):G.INVALID}optimized(){var n;if(this._isOptimized)return this;if(this.opacity==0||this.maxBounds.isEmpty())return null;let e=this.child.optimized();if(e==null)return null;if(this.opacity==1&&(this.blendMode=="PASS_THROUGH"||this.blendMode=="NORMAL"&&!e.hasNonIsolatedBlends()))return e;if((this.blendMode=="PASS_THROUGH"||this.blendMode=="NORMAL")&&e.op()==3){let o=e,i=(n=Se.onlyPaintOrNull(o.geometry.paints))==null?void 0:n.asSinglePaint();if(i!=null){let a=i.cloneAsSinglePaint();return a.setOpacity(a.opacity()*this.opacity),o.withPaints([a])}}let t=this.opacity;if(e.op()==7){let o=e;this.blendMode==o.blendMode&&(this.blendMode=="PASS_THROUGH"||this.blendMode=="NORMAL")&&(t=o.opacity*t,e=o.child)}return t==this.opacity&&e==this.child?(this._isOptimized=!0,this):new r(this.blendMode,t,e)}equalsWithinBoundsImpl(e,t){let n=e;return this.blendMode==n.blendMode&&this.opacity==n.opacity&&this.child.equalsWithinBounds(n.child,t)}},Jp=class{constructor(e,t){this.tileHandleOrNull=null,this.neededImagesOrNull=null,this.key=e,this._cache=t}canvasSpaceBounds(){return this.key.bounds}textureRegionOrNull(){return this._cache.textureRegionOrNull(this)}bounds(){return this.key.bounds}};var jp=class extends Or{op(){return 8}constructor(e,t){super(Ev(e,null),e.flags),this._tiles=new Map,this._devicePixelsPerCanvasPixel=-1,this.tree=e,this._tileCache=t}optimized(){return this._isOptimized=!0,this}computeBounds(e){return Ev(this.tree,e)}equalsWithinBoundsImpl(e,t){let n=e;return this._tileCache==n._tileCache&&this.maxBounds.equals(n.maxBounds)&&this.tree.equalsWithinBounds(n.tree,t)}setDevicePixelPerCanvasPixel(e){this._devicePixelsPerCanvasPixel!=e&&(this._tiles=new Map,this._devicePixelsPerCanvasPixel=e)}numTilesNeededForBounds(e){let t=G.new3(e);t.intersectWith(this.maxBounds);let n=new b(Math.floor(this.maxBounds.left()),Math.floor(this.maxBounds.top())),o=tr.TILE_SIZE/this._devicePixelsPerCanvasPixel,i=Math.floor((t.left()-n.x())/o)|0,a=Math.ceil((t.right()-n.x())/o)|0,s=Math.floor((t.top()-n.y())/o)|0,l=Math.ceil((t.bottom()-n.y())/o)|0;return(a-i)*(l-s)}forEachTileWithinBounds(e,t,n){if(!t.overlaps(this.maxBounds))return;let o=G.new3(t);o.intersectWith(this.maxBounds);let i=new b(Math.floor(this.maxBounds.left()),Math.floor(this.maxBounds.top())),a=tr.TILE_SIZE/this._devicePixelsPerCanvasPixel,s=Math.floor((o.left()-i.x())/a)|0,l=Math.ceil((o.right()-i.x())/a)|0,d=Math.floor((o.top()-i.y())/a)|0,c=Math.ceil((o.bottom()-i.y())/a)|0,p=i.y()+d*a;for(let u=d;u<c;u=u+1,p+=a){let _=Dt.IntMap_get(this._tiles,u,null);_==null&&(_=new Map,this._tiles.set(u,_));let h=i.x()+s*a;for(let S=s;S<l;S=S+1,h+=a){let m=Dt.IntMap_get(_,S,null);if(m!=null){let y=m.value;y!=null&&n(y);continue}if(e==1)continue;let f=new G(h,p,a,a),T=this._tileCache.getOrInsertOrNull(this.tree,f);_.set(S,new ce(T)),T!=null&&n(T)}}}};var rt=class r extends Or{op(){return 10}constructor(e,t,n,o){super(DF(e,n),e.flags|8),this.child=e,this.id=t,this.property=n,this.getter=o}computeBounds(e){switch(this.property){case 2:{let t=this.child.currentBounds(e).clone();return this.transform().transformRect(t),t}case 1:case 3:case 4:case 5:return this.child.currentBounds(e);case 0:return this.maxBounds;default:throw new Error(`Unhandled VolatileProperty value: ${Za.VolatileProperty_toString(this.property)}`)}}transform(){return this.getter()}opacity(){return+this.getter()}maxTransformScale(){return+this.getter()}optimized(){if(this._isOptimized)return this;let e=this.child.optimized();return e==null||e.maxBounds.isEmpty()?null:e!=this.child?new r(e,this.id,this.property,this.getter):(this._isOptimized=!0,this)}equalsWithinBoundsImpl(e,t){let n=e;return this.id==n.id&&this.property==n.property&&this.child.equals(n.child)}static forTranslation(e,t,n){let o=J.new2();return r.forTransform(e,t,()=>(o.copyFrom(yt.FrozenAffineTransform_IDENTITY),o.translatedBy1(n())))}static forTransform(e,t,n){return new r(e,t,2,n)}static forOpacity(e,t,n){return new r(e,t,4,n)}static forTransformIsolation(e){let t="ID_FOR_TRANSFORM_ISOLATION";return new r(e,t,1,null)}static forMaxTransformScale(e,t){let n=`ID_FOR_MAX_TRANSFORM_SCALE_${e}`;return new r(t,n,3,()=>e)}static forInverseTransform(e){let t="ID_FOR_INVERSE_TRANSFORM";return new r(e,t,0,null)}static forStateSwap(e){let t="ID_FOR_STATE_SWAP";return new r(e,t,5,null)}},Eo=class r extends Or{op(){return 11}constructor(e,t){super(wF(e,t),e.flags),this.child=e,this.transform=t}computeBounds(e){return this.maxBounds}optimized(){if(this._isOptimized)return this;let e=this.child.optimized();return e==null||e.maxBounds.isEmpty()?null:this.transform.equals1(yt.FrozenAffineTransform_IDENTITY)?e:e!=this.child?new r(e,this.transform):(this._isOptimized=!0,this)}equalsWithinBoundsImpl(e,t){let n=e;return this.transform.equals1(n.transform)&&this.child.equalsWithinBounds(n.child,t!=null?this.transform.inverse().transformRect(G.new3(t)):null)}},cn=class r extends Or{op(){return 12}constructor(e,t,n,o){super(Tv(e,t,null),(e!=null?e.flags:0)|(t!=null?t.flags:0)|8),this.startChild=e,this.endChild=t,this.id=n,this.progressFn=o}computeBounds(e){return Tv(this.startChild,this.endChild,e)}progress(){return this.progressFn()}optimized(){if(this._isOptimized)return this;let e=this.startChild!=null?this.startChild.optimized():null,t=this.endChild!=null?this.endChild.optimized():null,n=e!=null&&!e.maxBounds.isEmpty(),o=t!=null&&!t.maxBounds.isEmpty();if(!n&&!o)return null;if(n)if(o){if(this.startChild.equals(this.endChild))return this.startChild}else return new rt(e,this.id,4,()=>1-this.progressFn());else return new rt(t,this.id,4,()=>this.progressFn());return this.startChild!=e||this.endChild!=t?new r(e,t,this.id,this.progressFn):(this._isOptimized=!0,this)}equalsWithinBoundsImpl(e,t){let n=e;return this.id==n.id&&this.startChild.equalsWithinBounds(n.startChild,t)&&this.endChild.equalsWithinBounds(n.endChild,t)}},Za;(e=>{function r(t){switch(t){case 0:return"INVERSE_TRANSFORM";case 1:return"TRANSFORM_ISOLATION";case 2:return"TRANSFORM";case 3:return"MAX_TRANSFORM_SCALE";case 4:return"OPACITY";case 5:return"STATE_SWAP";default:throw new Error("Unhandled VolatileProperty value")}}e.VolatileProperty_toString=r})(Za||(Za={}));function NF(r){let e=0;for(let t of r)for(let n=0,o=t.length;n<o;n=n+1)Se.hasAnimatingMediaPaints(t[n].paints)&&(e|=16),Se.hasVolatilePaints(t[n].paints)&&(e|=8);return e}function gv(r,e){if(r.op()==11){let t=r,n=e(t.child);return n==t.child?t:n!=null?new Eo(n,t.transform):null}else return e(r)}function $p(r){return r.op()==11?r.child:r}function Rv(r){if(r.op()==11){let e=r;return new Un(e.child,e.transform)}else if(r.op()==10){let e=r;if(e.property==2)return new Un(e.child,e.transform())}return new Un(r,null)}function Av(r,e){let t=new ht;for(let n of r)t.include3(n.currentBounds(e));return t.isValid()?t.build():G.INVALID}function Uf(r,e,t,n){if(t==2)return r.currentBounds(n);if(t==4)return e.currentBounds(n);if(Al&&t==3)return r.currentBounds(n);let o=r.currentBounds(n).clone();return o.intersectWith(e.currentBounds(n)),o}function Sv(r,e,t){if(e.currentBounds(t).isEmpty())return e.currentBounds(t);let n=e.currentBounds(t).clone();return n.expand1(r),n}function Zp(r,e){let t=new ht,n=!1;for(let i=0,a=e.length;i<a;i=i+1){let s=e[i];t.include3(s.maxBounds),s.canBeAnalyticallyAntialiased()&&(n=!0)}if(!t.isValid())return G.INVALID;let o=t.build();return r.transformRect(o),n&&o.expand1(4),o}function PF(r,e,t,n){if(n==0)return Zp(r,e);let o=new ht;return o.include3(Zp(r,e)),o.include3(Zp(r,t)),o.isValid()?o.build():G.INVALID}function FF(r,e){return Zp(r,[e])}function DF(r,e){switch(e){case 2:case 0:{let t=G.new2();return t.copyFrom(r.maxBounds),t.expandedBy1(1e6),t}case 4:case 3:case 1:case 5:return r.maxBounds;default:throw new Error(`Unhandled property ${Za.VolatileProperty_toString(e)}`)}}function wF(r,e){return e.transformRect(G.new3(r.maxBounds))}function Tv(r,e,t){let n=new ht;return r!=null&&n.include3(r.currentBounds(t)),e!=null&&n.include3(e.currentBounds(t)),n.build()}function Ev(r,e){let t=r.currentBounds(e).clone();return t.expand1(1),t}function LF(r){let e=0;for(let t of r)e|=t.flags;return e}function Iv(r,e,t){let n=r.flags&-2|e.flags;return t!=0&&t!=4&&t!=1&&(n&=-2),t==2&&(n|=32),n}function xF(r){return r.flags&-2|32}function BF(r){return r.flags&-2}function MF(r,e){let t=e.flags;return r!="PASS_THROUGH"&&(t&=-2,t|=r!="NORMAL"?1:0),t}function GF(r){let e=0;return Se.hasAnimatingMediaPaints(r.paints)&&(e|=16),(Se.hasVolatilePaints(r.paints)||r.type==1)&&(e|=8),e}var ye;(ae=>{function r(L,x,W){if(L>ae.GEN_DURATION_LOG_THRESHOLD_S){let Z=`${qp[x]}${W}`;ae._trackingKeys.has(Z)||(Ae.trackEvent("Slow Render Tree Generation",{duration:L,frameRole:x,callSite:W}),ae._trackingKeys.add(Z))}}ae._logIfNecessary=r;function e(L,x){let W=new Ns,Z=Ae.perfTimerScope("generateRenderTree",Ae.ProfileLevel.LEGACY,()=>L.renderTree());return r(W.elapsedSeconds(),1,x),Z}ae.renderTreeWithPerfLogging1=e;function t(L,x,W){let Z=new Ns,te=Ae.perfTimerScope("generateRenderTree",Ae.ProfileLevel.LEGACY,()=>L.renderTree2(x));return r(Z.elapsedSeconds(),1,W),te}ae.renderTreeWithPerfLogging2=t;function n(L,x,W){let Z=new Ns,te=Ae.perfTimerScope("generateRenderTree",Ae.ProfileLevel.LEGACY,()=>L.renderTreeForBaseScreen2(x));return r(Z.elapsedSeconds(),0,W),te}ae.renderTreeForBaseScreenWithPerfLogging=n;function o(L,x,W){let Z=new Ns,te=Ae.perfTimerScope("generateRenderTree",Ae.ProfileLevel.LEGACY,()=>L.renderTreeForOverlay(x));return r(Z.elapsedSeconds(),1,W),te}ae.renderTreeForOverlayWithPerfLogging=o;function i(L,x,W){if(W!=null){let te=L.getCachedRenderTree();if(te!=null&&(te.value==null||!W.overlaps(te.value.maxBounds)))return null}let Z=null;switch(x.mode){case 0:{Z=L.renderTree();break}case 2:{Z=L.renderTreeWithoutBackgroundBlurs();break}case 1:{Z=x.shadowOwnerID==L.uniqueIdentifier()?L.renderTreeForShadowRoot():L.renderTreeForShadowDescendant();break}case 3:{Z=x.shadowOwnerID==L.uniqueIdentifier()?L.renderTreeForKnockoutShadowRoot():L.renderTreeForKnockoutShadowDescendant();break}case 4:{Z=L.renderTreeForSlideThumbnail();break}default:throw new Error(`Unhandled render tree GenerateArgs mode: ${Wt[x.mode]}`)}return W!=null&&(Z==null||!W.overlaps(Z.maxBounds))?null:Z}ae._generateRenderTreeForChild=i;function a(L){return L.scrollDirection()!="NONE"&&L.hasOverflowingContentInScrollDirection()}ae._nodeCanScroll=a;function s(L,x,W){return Y.useBackgroundBlurOpts()?W==null?!0:W.hasVolatileContent()?!1:!P(L,x):!1}ae._canSkipWrappingInVolatileTransforms=s;function l(L,x){if(L.isRoot())return x;if(x=B(x,L),L instanceof Ks){let se=L;se.icRoot().id()==se.uniqueIdentifier()&&se.icFramePairTransition()!=null&&(x=se.icFramePairTransition()(x))}let W=L.clone(),Z=L.indexInParent();L.moveToParent();let te=Y.getFeatureFlags().viewer_sticky_scrolling_background_blurs&&W.isStickyScrolling();if((a(L)||te)&&Z<p(L)){let se=L.clone(),le=ft.forScrollOffset(L.uniqueIdentifier());x=rt.forTranslation(x,le,()=>Oi.getScrollTranslationOfNodeRelativeToParent(W).negative())}return x=l(L,x),L.moveToChildAt(Z),x}ae._wrapInVolatileTransformsForAncestors=l;function d(L,x,W,Z,te,se){return c(L,x,W,Z,te,se)}ae._generateChildrenWithMasking=d;function c(L,x,W,Z,te,se){let le=a(L),Ee=x.clone(),Ie=L.clone(),ge=le?Ie:null,Ue=[],Fe=[],Ce=W,Ye=Z;for(;Ce<Ye;){L.moveToChildAt(Ce++);let ve=Ue.length==0||!ne.List_last(Ue).isStandardScrolling(),Ve=Ue.length==0?null:ne.List_last(Ue).scrollSpeedMultiplier,er=L.parent()!=null&&L.isStickyScrolling(),fr=ge!=null&&L.isFixed(),Mn=!er&&!fr,fs=Y.getFeatureFlags().prototype_parallax_scroll?L.scrollSpeedMultiplier():1;er?(Ue.push(new ei("STICKY_SCROLLS",fs)),ne.List_last(Ue).scrollingSceneNode=L.clone()):Mn&&(ve||Ve!=fs)&&(Ue.push(new ei("SCROLLS",fs)),ne.List_last(Ue).scrollingSceneNode=L.clone());let Da=fr?Fe:ne.List_last(Ue).nodes,lm=ge==null||L.isFixed()?te:null;if(!L.isVisibleMask()){let bc=i(L,Ee,lm);bc!=null&&Da.push(bc),L.moveToParent();continue}let wb=L.maskType(),Lb=Ee.clone(),Fu=i(L,Lb,lm),Cc=[];L.moveToParent();let xb=p(L);for(;Ce<Ye;){if(L.moveToChildAt(Ce),L.stopsMaskPropagation()||Ce==xb){L.moveToParent();break}if(Fu!=null){let bc=i(L,Ee,lm);bc!=null&&Cc.push(bc)}Ce=Ce+1,L.moveToParent()}Fu!=null&&Cc.length!=0&&(se==0&&Ce==Ye?Da.push(ke.wrap(Cc)):wb=="LUMINANCE"?Da.push(In.createForLuminanceMask(Fu,ke.wrap(Cc))):Da.push(new In(Fu,ke.wrap(Cc))))}let we=Ue.filter(ve=>ve.nodes.length!=0),st=ft.forScrollOffset(L.uniqueIdentifier()),tt=[];for(let ve=0;ve<we.length;ve=ve+1){let Ve=we[ve],er=Ve.scrollSpeedMultiplier;if(Ve.isStandardScrolling()){let fr=Ve.scrollingSceneNode;if(ge!=null||er!=1){let fs=ve>0&&we[ve-1].isStickyScrolling(),Da=ke.wrap(Ve.nodes).optimized();(!Y.getFeatureFlags().viewer_sticky_scrolling_blend_ctg||!fs)&&(Da=u(Ie,Da)),tt.push(rt.forTranslation(Da,st,()=>Oi.getScrollTranslationOfNodeRelativeToParent(fr).negative()))}else Ir(tt,Ve.nodes)}else if(Ve.isStickyScrolling()){Ve.nodes.length==1,Ve.scrollingSceneNode;let fr=Ve.scrollingSceneNode,Mn=Ve.nodes[0],fs=rt.forTranslation(Mn,st,()=>Oi.getScrollTranslationOfNodeRelativeToParent(fr).negative());tt.push(fs)}}if(Fe.length!=0){let ve=ke.wrap(Fe).optimized();tt.push(ve)}return new ke(tt).optimized()}ae._generateChildrenWithMaskingNew=c;function p(L){for(let x=L.childCount()-1;x>=0;x=x-1){if(L.moveToChildAt(x),!L.isFixed())return L.moveToParent(),x+1;L.moveToParent()}return 0}ae._indexOfFirstValidFixedChild=p;function u(L,x){if(x.hasAnimatingMedia()||x.hasVolatileContent()||x.hasBackgroundBlurs()||!x.hasNonIsolatedBlends())return x;let W=Se.firstPaintIfSolidAndOpaqueOrNull(L.fillPaintsToRender());return W==null?x:ke.wrapWithSolidBackground(x,W.color())}ae._wrapScrollingContentWithSolidBackground=u;function _(L,x,W,Z,te,se,le){if(x.parent()==null)return null;let Ee=x.indexInParent();x.moveToParent();let Ie=h(L,x,W,Z,te,se,Ee,le);return x.moveToChildAt(Ee),Ie}ae._generateBackground=_;function h(L,x,W,Z,te,se,le,Ee){let Ie=new Br(2),ge=d(x,Ie,0,le,W,0);if(Z!=null){let Ce=x.clone();Ce.moveToChildAt(le);let Ye=Y.getFeatureFlags().viewer_sticky_scrolling_background_blurs&&Ce.isStickyScrolling();if((a(x)||Ye)&&le<p(x)){let we=x.clone(),st=ft.forScrollOffset(we.uniqueIdentifier());Z=rt.forTranslation(Z,st,()=>Oi.getScrollTranslationOfNodeRelativeToParent(Ce).negative())}ge==null?ge=Z:ge=ke.wrap([ge,Z]).optimized()}ge=H(ge,x.clone(),Ie,1,te);let Ue=!1;x.isFrameLike()&&x.clipsChildren()&&(Ue=Se.containsAtLeastOneVisibleOpaquePaint(x.fillPaintsToRender()));let Fe=Y.getViewerMode()==Y.ViewerMode.PROTOTYPE&&x.isTopLevel();if(!x.isRoot()&&!Ue&&!Fe)ge=_(Ie,x,W,ge,te,se,Ee);else{let Ce=!Ee&&!s(se,x,ge);Ce&&(ge=l(x,ge)),ge!=null&&(ge=new ke([ge,A(se,new Br(2))]),U(se)&&Ce&&(ge=rt.forInverseTransform(ge)))}return ge}ae._generateBackgroundFromParent=h;function S(L,x,W){let Z=null;switch(x){case 1:{Z=L.renderTreeForShadowRoot();break}case 3:{Z=L.renderTreeForKnockoutShadowRoot();break}default:throw new Error(`Unhandled shadow mode: ${Wt[x]}`)}if(Z!=null&&W!=null){if(L.shouldOptimizeShadowForAnimation(W)){let te=L.clone(),se=te.absoluteTransform(),le=se.inverse();Z=rt.forTransform(Z,ft.forShadowTransformation(te.uniqueIdentifier()),()=>{let Ee=te.absoluteTransform(),Ie=Ee.inverse();Ie.multiply(J.new2().translatedBy1(W)),Ie.multiply(Ee);let ge=J.new2();return ge.multiply(se),ge.multiply(Ie),ge.multiply(le),ge})}else{let te=J.translated(W.x(),W.y());Z=new Eo(Z,te)}Z=Z.optimized()}return Z}ae._generateRenderTreeForShadow=S;function m(L,x){if(x.effects()!=null)for(let W=0,Z=x.effects().length;W<Z;W=W+1){let te=x.effects()[W];if(te.type()!="INNER_SHADOW"||!te.isVisibleForRendering())continue;let se=S(x,1,null);if(se!=null){let le=S(x,1,te.blurOffset());if(le==null)le=new ke([]);else{if(te.spread()!=0&&(le=v(le,-te.spread(),x,te.type()),le==null))continue;le=new To(le,O.BLACK)}se=new To(se,O.BLACK);let Ee=In.createForInnerShadow(se,oo.createForStandardBlur(te.blurRadius(),le,G.INVALID),O.withAlpha(te.blurColor(),Math.ceil(te.opacity()*255)|0));Ee=new io(te.blendMode(),1,Ee),L!=null?L=new _i(new ke([L,Ee])):L=Ee}}return L}ae._wrapWithInnerShadows=m;function f(L){let x=L.renderableContentType();if(x!=mr.RenderableContentType.RENDERABLE_GEOMETRY&&x!=mr.RenderableContentType.RENDERABLE_TEXT&&x!=mr.RenderableContentType.RENDERABLE_GROUP||x==mr.RenderableContentType.RENDERABLE_GROUP&&L.childCount()>0&&!L.clipsChildren())return!1;let W=L.fillPaints(),Z=L.strokePaints(),te=L.fillGeometry(),se=te!=null&&te.regions.length!=0,le=L.strokeGeometry(),Ee=le!=null&&le.regions.length!=0,Ie=se&&W!=null&&Se.containsAtLeastOneVisibleOpaquePaint(W),ge=!Ee||Z==null||Se.containsAtLeastOneVisibleOpaquePaint(Z);if(x==mr.RenderableContentType.RENDERABLE_TEXT){let Fe=L.textData().styleOverrideTable().styleByID2();for(let Ce of Array.from(Fe.keys())){let Ye=Fe.get(Ce),we=or.get(Ye,61,null);if(we!=null&&!Se.containsAtLeastOneVisibleOpaquePaint(Je.asPaintData(we))){Ie=!1;break}}}return Ie&&(ge||L.strokeAlign()=="INSIDE")}ae._hasOpaqueGeometry=f;function T(L,x,W,Z,te,se){if(!x.isForShadows()||L.strokeAlign()!="OUTSIDE"&&L.strokeAlign()!="CENTER"||!Se.containsAtLeastOneVisibleNotFullyTransparentPaint(Z)||!Se.containsAtLeastOneVisibleNotFullyTransparentPaint(W)||!L.hasDefaultStrokeParameters())return null;let le=L.effects();if(!le)return null;for(let fr=0;fr<le.length;fr++)if(le[fr].type()!="DROP_SHADOW"&&le[fr].isVisibleForRendering())return null;let Ee=te.length==1&&te[0].path().isRect(),Ie=!1,ge=null;if(!Ee&&(L.isRoundedRect()&&(ge=L.roundedRectInfo(),Ie=ge&&ge.isSimpleRoundedRect()),!Ie))return null;let Ue=L.strokeAlign()=="OUTSIDE"?2:1,Fe=L.strokeAlign()=="OUTSIDE"?1:.5,Ce=L.strokeWeight()*Ue,Ye=L.strokeWeight()*Fe,we=L.size().withOnesForZeros().addScalar(Ce),st=new G(-Ce/2,-Ce/2,we.x(),we.y()),tt=ge&&ge.nodeRadius()>0?ge.nodeRadius()+Ye:ge&&ge.vertexRadii().length>0?ge.vertexRadii()[0]+Ye:0,ve=null;if(Ee)ve=new Et(St.fromRect(st),"NONZERO");else{let fr=new da(1,st.topLeft(),st.size(),[tt,tt,tt,tt],0);ve=new Et(St.fromRoundedRect(fr),"NONZERO")}let Ve=[];Ve.push(new wt(ve,W));let er=[];return bt(se,Ve,L.size(),er),ke.wrap(er)}ae.attemptToReplaceStrokeWithExpandedFillForDropShadow=T;function y(L,x){let W=L.isInsideOutlineMask(),Z=[],te=[],se=null,le=k(x,L,0),Ee=k(x,L,1),Ie=k(x,L,2);if(L.renderableContentType()==mr.RenderableContentType.RENDERABLE_TEXT)_t(Z,L,le,Ie,L.scene(),W,x);else{let Ve=x.mode==3?0:1;Ke(Z,L,0,le,L.uniqueIdentifier(),x,Ve)}let ge=[],Ue;L.containsIndependentBordersStrokeMask()?L.generateStrokeAndStrokeMaskGeometries(te,ge,Ee):Ke(te,L,1,Ee,L.uniqueIdentifier(),x,1);let Fe=L.size().withOnesForZeros(),Ce=L.strokeAlign();x.isForShadows()&&Ce=="INSIDE"&&Qe(Z)&&Qe(te)&&(te.length=0);let Ye=L.effects(),we=L.absoluteTransform();if(Y.useFastStrokeShadow()){let Ve=T(L,x,le,Ee,Z,we);if(Ve)return new Vt(Ve,se)}if(ge.length&&(Ue=new Ar(we,ge[0],Fe)),dt(Z)&&dt(te)&&!x.isForShadows()&&mt(Ye)&&!(Al&&We(Ye,"FOREGROUND_BLUR")&&We(Ye,"INNER_SHADOW"))){let Ve=[],er=[];bt(we,Z,Fe,Ve);let fr=m(ke.wrap(Ve),L);se=new ce(2),er.push(fr);let Mn=[];return Ce=="CENTER"?bt(we,te,Fe,Mn):vt(Ce,we,Z,te,Fe,Mn),new Vt(K(er,Mn,Ue),se)}if(Ce=="CENTER"||Z.length==0){let Ve=[],er=[];return bt(we,Z,Fe,Ve),bt(we,te,Fe,er),new Vt(K(Ve,er,Ue),se)}if(le!=null&&Ee!=null&&(Se.isIsolated(le)&&Se.isIsolated(Ee)||x.isForShadows())&&te.length!=0&&!Ue){let Ve=[],er=[];for(let Mn of Z)Se.isEmojiPaint(Mn.paints)?Ve.push(Mn):er.push(Mn);let fr=[];return bt(we,Ve,Fe,fr),fr.push(new yd(we,er,te,Fe,Ce=="INSIDE"?0:1)),new Vt(ke.wrap(fr),se)}let tt=[],ve=[];return bt(we,Z,Fe,tt),vt(Ce,we,Z,te,Fe,ve),new Vt(K(tt,ve,Ue),se)}ae._generateRenderTreeForGeometry=y;function E(L,x){if(!L.visible()||L.opacity()<=0&&!(2&L.willChange()))return null;let W=null,Z=0;switch(L.renderableContentType()){case mr.RenderableContentType.NON_RENDERABLE:return null;case mr.RenderableContentType.RENDERABLE_GEOMETRY:case mr.RenderableContentType.RENDERABLE_TEXT:{if(L.type()=="INTERACTIVE_SLIDE_ELEMENT"&&x.mode!=4)return null;let te=y(L,x);W=te.node,te.layerWrap!=null&&(Z=te.layerWrap.value);break}case mr.RenderableContentType.RENDERABLE_GROUP:{!(x.isForShadows()&&L.clipsChildren()&&Se.containsAtLeastOneVisibleNotFullyTransparentPaint(L.fillPaintsToRender()))&&(W=d(L,x,0,L.childCount(),null,1));break}case mr.RenderableContentType.CUSTOM_RENDER_TREE:{Z=2,W=L.customRenderTree(x);break}}return H(W,L,x,Z,0)}ae.generateRenderTree=E;function v(L,x,W,Z){if(!W.isSpreadEligibleNode())return L;if(L.op()==10){let ve=L,Ve=v(ve.child,x,W,Z);return Ve==null?null:new rt(Ve,ve.id,ve.property,ve.getter)}else if(L.op()==11){let ve=L,Ve=v(ve.child,x,W,Z);return Ve==null?null:new Eo(Ve,ve.transform)}else if(L.op()==2){let Ve=v(L.child,x,W,Z);return Ve==null?null:new _i(Ve)}else if(L.op()==12){let ve=L,Ve=ve.startChild!=null?v(ve.startChild,x,W,Z):null,er=ve.endChild!=null?v(ve.endChild,x,W,Z):null;return Ve!=null||er!=null?new cn(Ve,er,ve.id,ve.progressFn):null}let te=W.fillGeometry()!=null&&W.fillGeometry().regions.length!=0&&Se.containsAtLeastOneVisiblePaint(W.fillPaints()),se=W.strokeGeometry()!=null&&W.strokeGeometry().regions.length!=0&&Se.containsAtLeastOneVisiblePaint(W.strokePaints()),le=te&&!se,Ee=!te&&se,Ie=null,ge=L,Ue=()=>{Ae.trackEvent("unexpected_spread_shadow_node",{sceneNode:W.paintsDebugString(),renderNode:L.debugString1()})};for(;Ie==null;)switch(ge.op()){case 3:case 4:{Ie=ge;break}case 5:{ge=ge.alpha;break}case 7:{ge=ge.child;break}case 1:{let ve=null;Or.visitEachNodeInTree(ge,Ve=>{(Ve.op()==3||Ve.op()==4)&&(ve==null||Or.geometryNodePaintSize(Ve).area()>Or.geometryNodePaintSize(ve).area())&&(ve=Ve)},null),ge=ve;break}case 0:{ge=ge.child,Ue();break}case 9:{ge=ge.alpha,Ue();break}case 6:{ge=ge.child,Ue();break}default:return Ue(),Oe("Unexpected wrapped node for spread shadow"),L}if(Ie==null||Ie.op()!=3&&Ie.op()!=4)return Oe(`Failed to find geometryNode after search; got ${En[Ie.op()]}`),L;let Fe=null,Ce=null,Ye=null;switch(Ie.op()){case 3:{let ve=Ie;Fe=Ce=ve.paintSize,Ye=ve.transform;break}case 4:{let ve=Ie;Fe=Ce=ve.paintSize,Ye=ve.transform;break}default:return Oe(`Unexpected node type ${En[Ie.op()]}`),L}if(se&&W.strokeAlign()!="INSIDE"){let ve=W.strokeAlign()=="OUTSIDE"?2:1;Fe=Fe.addScalar(W.strokeWeight()*ve)}if(Z=="DROP_SHADOW"){if(Fe.x()<=-(2*x)||Fe.y()<=-(2*x))return null}else Z=="INNER_SHADOW"&&(x=Math.max(x,-Math.min(Fe.x(),Fe.y())/2));let we=Ce.addScalar(2*x),st=we.divide(Ce),tt=J.new2().translatedBy2(-x,-x).scaledBy1(st);if(le){let ve=W.fillGeometryForSpread(tt,x,Se.SOLID_BLACK);return new Ar(Ye,ve,we)}else if(Ee){let ve=W.strokeGeometryForSpread(tt,x,Ce,Se.SOLID_BLACK);if(ve==null){if(Z=="DROP_SHADOW")return null;ve=new wt(new Et(St.fromRect(Yr.FrozenRect_EMPTY),"NONZERO"),Se.SOLID_BLACK)}return new Ar(Ye,ve,we)}else{let ve=W.strokeGeometryForSpread(tt,x,Ce,Se.SOLID_BLACK);return ve==null?null:new Ar(Ye,ve,we)}}ae._blurChildWithSpread=v;function A(L,x){let W=[],Z=L.effects(),te=Z.filter(se=>se.type()=="BACKGROUND_BLUR"&&se.isVisibleForRendering()).length>0;for(let se=0;se<Z.length;se=se+1){let le=Z[se];if(le.type()=="DROP_SHADOW"&&le.isVisibleForRendering()){if(x.mode==2&&!le.showShadowBehindNode()&&te)continue;let Ee=S(L,1,le.blurOffset());if(Ee!=null){if(le.spread()!=0&&(Ee=v(Ee,le.spread(),L,le.type()),Ee==null))continue;let Ie=new To(Ee,O.multiplyOpacity(le.blurColor(),le.opacity())),ge=null,Ue=Ie.optimized();if(Ue!=null&&(ge=oo.createForStandardBlur(le.blurRadius(),new _i(Ue),G.INVALID)),ge!=null&&!le.showShadowBehindNode()&&!f(L)){let Fe=S(L,3,null);ge=new _i(In.createForKnockoutShadow(Fe,ge))}ge!=null&&W.push(new io(le.blendMode(),1,ge))}}}return new ke(W)}ae._dropShadowsForNode=A;function I(L){let x=L.parent();if(x==null)return L.absoluteTransform();let W=x.absoluteTransform().clone();return W.invert()?(W.multiply(L.absoluteTransform()),W):J.new2()}ae._transformRelativeToParent=I;function C(L,x,W,Z,te,se){let le=x.size(),Ee=Z>0&&x.clipsChildren()&&W!=0,Ie=null,ge=null,Ue=k(se,x,0);se.isForShadows()&&Se.containsAtLeastOneVisibleNotFullyTransparentPaint(Ue)&&(Ue=Er(1)),Se.forEachPaintWithVideo(Ue,Ye=>{let we=Ye.video().getVideoManager();we!=null&&we.associatePaintWithNode(Ye,x)});let Fe=x.absoluteTransform(),Ce=[];if(Ee){Ie=Et.getOrCreate(St.fromRect(G.new4(fe.FrozenVector_ZERO,le).expandedBy1(Z)),"ODD");let Ye=Se.isolatedPaints(Ue);for(let we=0,st=Ye.length;we<st;we=we+1)te.push(new wt(Ie,Ye[we]))}else if(x.fillGeometry()!=null&&x.fillGeometry().regions.length!=0)Ke(te,x,0,Ue,x.uniqueIdentifier(),se,1);else if(at(0,x)){ge=Et.getOrCreate(St.fromRect(G.new4(fe.FrozenVector_ZERO,le)),"ODD");let Ye=Se.isolatedPaints(Ue);for(let we=0,st=Ye.length;we<st;we=we+1)te.push(new wt(ge,Ye[we]))}if(bt(Fe,te,le,Ce),!x.clipsChildren()){let Ye=[],we=[],st,tt=k(se,x,1);x.containsIndependentBordersStrokeMask()?x.generateStrokeAndStrokeMaskGeometries(Ye,we,tt):Ke(Ye,x,1,tt,x.uniqueIdentifier(),se,1),we.length&&(st=new Ar(Fe,we[0],le));let ve=[];x.strokeAlign()=="CENTER"||te.length==0?bt(Fe,Ye,le,ve):vt(x.strokeAlign(),Fe,te,Ye,le,ve),Ce.push(K([],ve,st))}return L!=null&&Ce.push(L),L=ke.wrap(Ce),L}ae._wrapTreeWithFrameFillPaints=C;function g(L,x,W,Z,te){let se=x.size(),le=Z>0&&x.clipsChildren()&&W!=0,Ee=null,Ie=null,ge=x.absoluteTransform();if(le?Ee=Et.getOrCreate(St.fromRect(G.new4(fe.FrozenVector_ZERO,se).expandedBy1(Z)),"ODD"):Ie=Et.getOrCreate(St.fromRect(G.new4(fe.FrozenVector_ZERO,se)),"ODD"),x.clipsChildren()){let Ue=[],Fe=[];le?Ue.push(new wt(Ee,Er(1))):x.fillGeometry()!=null&&x.fillGeometry().regions.length!=0?Ke(Ue,x,0,Er(1),x.uniqueIdentifier(),te,1):Ue.push(new wt(Ie,Er(1))),bt(ge,Ue,se,Fe),L=new In(ke.wrap(Fe),L)}return L}ae._wrapTreeWithFrameMasks=g;function R(L){return L.containerSupportsFillStrokeAndCorners()?L.fillPaints():L.fillPaintsToRender()}ae._fillPaintsToRender=R;function D(L,x,W,Z){let te=x.size();if(!te.isZero()){let se=null,le=x.clipsChildren(),Ee=R(x);if(Se.containsAtLeastOneVisiblePaint(Ee)){let Ie=[],ge=[],Ue=null;W.isForShadows()&&Se.containsAtLeastOneVisibleNotFullyTransparentPaint(Ee)?Ue=Er(1):Ue=j(W,Ee,0),se=Et.getOrCreate(St.fromRect(G.new4(fe.FrozenVector_ZERO,te).expandedBy1(le?Z:0)),"ODD");let Fe=Se.isolatedPaints(Ue);for(let Ce=0,Ye=Fe.length;Ce<Ye;Ce=Ce+1){let we=Fe[Ce];Ie.push(new wt(se,we))}bt(x.absoluteTransform(),Ie,te,ge),L!=null&&ge.push(L),L=ke.wrap(ge)}if(L!=null&&le){se==null&&(se=Et.getOrCreate(St.fromRect(G.new4(fe.FrozenVector_ZERO,te).expandedBy1(Z)),"ODD"));let Ie=new wt(se,Er(1));L=new In(new Ar(x.absoluteTransform(),Ie,te),L)}}return L}ae._wrapTreeWithFrameBackgroundOrFillIgnoringGeometry=D;function P(L,x){let W=L.clone(),Z=W.parent(),te=!0;for(;W!=null;){if(x!=null&&W.uniqueIdentifier()==x.uniqueIdentifier())return!1;if(1&W.willChange()||W.overlayRenderData()!=null)return!0;if(Z==null||x!=null&&Z.uniqueIdentifier()==x.uniqueIdentifier())return!1;if(!te){let se=W.indexInParent();if(a(Z)&&se<p(Z))return!0}te=!1,W=Z,Z=Z.parent()}return!1}ae._hasVolatileTransformOnAncestor=P;function U(L){return Y.useBackgroundBlurOpts()?P(L,null):!0}ae._needInverseTransform=U;function B(L,x){if(1&x.willChange()){let W=yt.FrozenAffineTransform_IDENTITY,Z=x.parent();Z!=null&&(W=Z.absoluteTransform());let te=x.absoluteTransform().clone(),se=te.invert(),le=x.clone();L=rt.forTransform(L,ft.forAnimateableTranslation(x.uniqueIdentifier()),()=>{let Ie=J.new2();return Ie.multiply(W),Ie.multiply(I(le)),Ie.multiply(te),Ie});let Ee=x.maxTransformScale();Ee!=1&&(L=rt.forMaxTransformScale(Ee,L))}return L}ae._wrapTreeInVolatileTransform=B;function M(L,x){if(L.backgroundAppearance.backgroundType=="NONE")return null;let W=Pe(L.backgroundAppearance,x.scene().findNode(x.overrideKey()).canvasSpaceBoundingBox());return W!=null?(L.backgroundTransitionProgress!=null&&(W=rt.forOpacity(W,ft.OVERLAY_BACKGROUND,L.backgroundTransitionProgress)),rt.forInverseTransform(W)):null}ae._generateRenderTreeForOverlayBackground=M;function F(L,x,W){let Z=[];for(let te=0,se=L.count();te<se;te=te+1){let le=L.keys()[te];if(le==x)break;let Ee=L.get(le),Ie=Ee.overlayNode,ge=M(Ee,W.clone()),Ue=Ie.renderTreeWithoutBackgroundBlurs();if(ge!=null&&Z.push(ge),Ue!=null){let Fe=Ee.bounds.center(),Ce=Ie.canvasSpaceBoundingBox().center(),Ye=Fe.subtract(Ce),we=tt=>()=>tt,st=rt.forInverseTransform(rt.forTranslation(Ue,ft.forOverlayPosition(te),we(Ye)));Z.push(st)}}return new ke(Z)}ae._generateIntermediateOverlays=F;function w(L,x,W,Z,te){let se=G.new2();se.copyFrom(L.bounds);let le=L.baseTlfCursor.clone(),Ee=x.overlayRenderData(),Ie=[],ge=h(Z,le.clone(),se,null,te,x.clone(),le.childCount(),!1);ge!=null&&Ie.push(ge);let Ue=F(Ee,L.overlayId,le.clone());Ue!=null&&Ie.push(Ue);let Fe=M(L,le);Fe!=null&&Ie.push(Fe);let Ce=null;return L.overlayId!=x.uniqueIdentifier()&&(Ce=_(Z,x,W,null,te,x.clone(),!0),Ce!=null&&(Ce=rt.forInverseTransform(rt.forTranslation(Ce,ft.ENTERING_OVERLAY,()=>(L.transform!=null?L.transform():fe.FrozenVector_new4(0,0)).add(L.animationTransform!=null?L.animationTransform():fe.FrozenVector_new4(0,0)))))),Ce!=null&&Ie.push(Ce),new ke(Ie)}ae._generateBackgroundBlurForOverlays=w;function V(L,x,W,Z){let te=S(L,1,null);if(te!=null){let se=null,le=null;if(se=G.new2(),Y.getFeatureFlags().viewer_offscreen_bg_blurs){let Ee=!L.isFixed(),Ie=null;if(Ee){for(Ie=L.parent()!=null?L.parent().clone():null;Ie!=null&&!a(Ie);)Ie=Ie.parent();Ee=Ie!=null}se.copyFrom(Ee&&Ie!=null?Ie.canvasSpaceContentBounds():te.maxBounds)}else se.copyFrom(te.maxBounds);if(L.overlayRenderData()!=null){let Ee=L.clone(),Ie=null,ge=L.overlayRenderData();for(;Ee!=null&&(Ie=ge.get(Ee.uniqueIdentifier()),Ie==null);)Ee=Ee.parent();if(Ee==null||Ie==null)return Oe("Blurred node with overlay data cannot be found in an overlay"),x;se=G.new2(),se.copyFrom(Ie.bounds),le=w(Ie,L.clone(),te.maxBounds,W,Z)}else le=_(W,L,se,null,Z,L.clone(),!1);if(le!=null){let Ee=null,Ie=$p(te),ge=Ie.op()==3?Ie:null;ge!=null&&ge.geometry.type==Ci.PaintedGeometryType.STATIC?Ee=ge.geometryBounds():Ee=te.maxBounds;let Ue=oo.createForStandardBlur(Z,le,Ee),Fe=In.createForBackgroundBlur(te,Ue);x=new ke([Fe,x])}x=qa.createForBackgroundBlur(x)}return x}ae._generateBackgroundBlur=V;function k(L,x,W){let Z=x.isInsideOutlineMask(),te=W==1?x.strokePaints():x.fillPaints();if(W==2){let le=x.textDecorationFillPaints();le&&(te=le)}let se=te!=null&&Se.containsAtLeastOneVisiblePaint(te);return Z?Er(se?1:0):j(L,te,W)}ae._getFinalizedPaintData=k;function H(L,x,W,Z,te){let se=[],le=Z==0&&x.isFrameLike()&&x.containerSupportsFillStrokeAndCorners()&&!x.isGroup()&&x.clipsChildren(),Ee=x.isFrameLike()&&!x.size().isZero(),Ie=x.overlayRenderData()==null&&x.isTopLevel()&&x.isFrameLike()&&Se.containsAtLeastOneVisibleOpaquePaint(x.fillPaintsToRender())||x.type()==="SLIDE",ge=!x.containerSupportsFillStrokeAndCorners()||x.isGroup(),Ue=Ee&&!ge;Ee&&(ge?L=D(L,x,W,te):L=C(L,x,Z,te,se,W)),L!=null&&(L=L.optimized());let Fe=!W.isForShadows()&&x.effects()!=null,Ce=[];if(Fe)if(L!=null){if(W.mode==0)for(let st=0,tt=x.effects().length;st<tt;st=st+1){let ve=x.effects()[st];if(ve.type()=="BACKGROUND_BLUR"){ve.isVisibleForRendering()&&!f(x)&&(L=V(x,L,W,ve.blurRadius()));break}}(Z==1||Z==0)&&(L=m(L,x)),Ie||Ce.push(A(x,W))}else Ie||Ce.push(A(x,W));if(L==null&&Ce.length==0&&!le)return L;let Ye=le&&x.strokeAlign()=="INSIDE";if(Ue&&!Ye&&L!=null&&(L=g(L,x,Z,te,W)),le&&!Xt(x,W,se)){let st=x.absoluteTransform(),tt=[],ve=[],Ve=k(W,x,1),er=[],fr;L!=null&&er.push(L),x.containsIndependentBordersStrokeMask()?x.generateStrokeAndStrokeMaskGeometries(tt,ve,Ve):Ke(tt,x,1,Ve,x.uniqueIdentifier(),W,1),ve.length&&(fr=new Ar(st,ve[0],x.size()));let Mn=[];x.strokeAlign()=="CENTER"||se.length==0||Ye?bt(st,tt,x.size(),Mn):vt(x.strokeAlign(),st,se,tt,x.size(),Mn),L=K(er,Mn,fr)}else Ye=!1;if(le&&x.strokeAlign()=="OUTSIDE"&&x.clipsChildren()&&(L=_i.thatShouldNotBeUnwrappedInOptimization(L)),Ue&&Ye&&L!=null&&(L=g(L,x,Z,te,W)),L!=null?L=new ke([new ke(Ce),L]):L=new ke(Ce),L!=null&&Fe)for(let st=0,tt=x.effects().length;st<tt;st=st+1){let ve=x.effects()[st];if(ve.type()=="FOREGROUND_BLUR"){ve.isVisibleForRendering()&&(L=oo.createForStandardBlur(ve.blurRadius(),L,G.INVALID));break}}if(W.isForShadows()&&W.shadowOwnerID==x.uniqueIdentifier())return L.optimized();let we=2&x.willChange()?1:x.opacity();if(L=new io(x.blendMode(),we,L),L=L.optimized(),L!=null&&2&x.willChange()){let st=x.clone();L=new rt(L,ft.forAnimateableOpacity(st.uniqueIdentifier()),4,()=>st.opacity())}return L!=null&&(L=B(L,x)),L}ae._wrapTreeWithLayerProperties=H;function z(L){if(L==null)return null;let x=!1;for(let Z=0,te=L.length;Z<te;Z=Z+1){let se=L[Z].asVolatilePaint();if(se!=null){if(se.from().image()!=null&&se.from().image().isDecoded()||se.from().imageThumbnail()!=null&&se.from().imageThumbnail().isDecoded()||se.to().image()!=null&&se.to().image().isDecoded()||se.to().imageThumbnail()!=null&&se.to().imageThumbnail().isDecoded()){x=!0;break}}else if(L[Z].asSinglePaint()!=null){let le=L[Z].asSinglePaint();if(le.image()!=null&&le.image().isDecoded()||le.imageThumbnail()!=null&&le.imageThumbnail().isDecoded()){x=!0;break}}if(!L[Z].isEnabledAndVisible()){x=!0;break}}if(!x)return L;let W=[];for(let Z=0,te=L.length;Z<te;Z=Z+1){if(!L[Z].isEnabledAndVisible())continue;let se=L[Z].asVolatilePaint();if(se!=null){let le=se.cloneAsVolatilePaint();le.from().setDecodedImageIsReady(le.from().image()!=null&&le.from().image().isDecoded()),le.to().setDecodedImageIsReady(le.to().image()!=null&&le.to().image().isDecoded()),le.from().setDecodedImageThumbnailIsReady(le.from().imageThumbnail()!=null&&le.from().imageThumbnail().isDecoded()),le.to().setDecodedImageThumbnailIsReady(le.to().imageThumbnail()!=null&&le.to().imageThumbnail().isDecoded()),W.push(le)}else if(L[Z].asSinglePaint()!=null){let le=L[Z].asSinglePaint().cloneAsSinglePaint();le.setDecodedImageIsReady(le.image()!=null&&le.image().isDecoded()),le.setDecodedImageThumbnailIsReady(le.imageThumbnail()!=null&&le.imageThumbnail().isDecoded()),W.push(le)}}return W}ae._filteredPaintsWithImageAvailability=z;function Q(L,x,W){if(L!=3||W==1&&x.length==0)return x;let Z=[];for(let te=0,se=x.length;te<se;te=te+1){let le=x[te];if(le.type()=="IMAGE"||le.type()=="EMOJI"||le.type()=="VIDEO")Z.push(le);else return[$.createSolid(O.BLACK,1)]}return Z.length==0&&Z.push($.SOLID_BLACK),Z}ae._filteredPaintsForKnockoutShadow=Q;function K(L,x,W){return W?(L.push(new In(W,new ke(x))),new ke(L)):new ke(L.concat(x))}ae.wrapFillsStrokesAndStrokeMasks=K;function j(L,x,W){return Q(L.mode,z(x),W)}ae._substitutePaintsAsNeeded=j;function pe(L,x,W,Z,te,se){if(X.equals(x.overrideKey(),X._new(4e7,2)))return!1;let Ee=x.strokeGeometry()!=null&&x.strokeGeometry().regions.length!=0&&Se.containsAtLeastOneVisiblePaint(x.strokePaints());if(Z!=0||Ee&&!oe(x,se,te))return!1;for(let Ie of W.regions)if(Ie.type==1)return!1;switch(x.type()){case"ELLIPSE":{if(x.arcData()==null||Se.hasEmoji(te))return!1;let Ie=x.arcData(),ge=Ie.innerRadius<=0,Ue=Ie.endingAngle-Ie.startingAngle,Fe=Math.abs(Ue)>2*Math.PI-.001,Ce=x.size().withOnesForZeros();if(ge&&Fe&&W.regions.length==1&&W.regions[0].type==0){let we=Ce.divideScalar(2),st=new Aa(we,we.x(),we.y()),tt=new Et(st,"NONZERO"),ve=Se.isolatedPaints(te);for(let Ve=0,er=ve.length;Ve<er;Ve=Ve+1){let fr=ve[Ve];L.push(new wt(tt,fr))}return!0}break}case"RECTANGLE":case"ROUNDED_RECTANGLE":case"FRAME":case"STAMP":case"SYMBOL":case"INSTANCE":case"INTERACTIVE_SLIDE_ELEMENT":{let Ie=x.roundedRectInfo();if(!St.isRoundedRectSupported(Ie))return!1;let ge=St.fromRoundedRect(Ie),Ue=new Et(ge,"NONZERO"),Fe=Se.isolatedPaints(te);for(let Ce=0,Ye=Fe.length;Ce<Ye;Ce=Ce+1){let we=Fe[Ce];L.push(new wt(Ue,we))}return!0}}return!1}ae._attemptToGenerateAAAGeometry=pe;function Pe(L,x){switch(L.backgroundType){case"NONE":return null;case"SOLID_COLOR":{if(x==null)return null;let W=L.backgroundColor;return Ar.solidColorRect(x,W,1)}}throw new Error(`Unhandled backgroundType ${L.backgroundType}`)}ae.renderTreeForOverlayBackground=Pe;function at(L,x){if(L==0){let W=x.fillPaints(),Z=x!=null&&x.clipsChildren();return x!=null&&(Z||Se.containsAtLeastOneVisiblePaint(W)||x.strokeAlign()!="CENTER"&&at(1,x))}else if(L==1){let W=x.strokePaints();return Se.containsAtLeastOneVisiblePaint(W)&&x.hasNonZeroStrokeWeight()}return!1}ae._isGeometryNecessary=at;function Ke(L,x,W,Z,te,se,le){let Ee=W==0?x.fillGeometry():x.strokeGeometry();if(W==0&&le==1&&!at(W,x)&&(Ee=null),Ee==null||Z==null)return;if(Se.forEachPaintWithVideo(Z,ge=>{let Ue=ge.video().getVideoManager();Ue!=null&&Ue.associatePaintWithNode(ge,x)}),x.hasPerRegionFillPaints()&&W==0){x.forEachRegionWithFillPaintBatch((ge,Ue)=>{let Fe=Se.isolatedPaints(Ue);for(let Ce=0,Ye=Fe.length;Ce<Ye;Ce=Ce+1){let we=z(Fe[Ce]);Se.forEachPaintWithVideo(we,tt=>{let ve=tt.video().getVideoManager();ve!=null&&ve.associatePaintWithNode(tt,x)});let st=Et.getOrCreate(ge.path(),ge.windingRule);L.push(new wt(st,we))}});return}if(pe(L,x,Ee,W,Z,se))return;let Ie=Se.isolatedPaints(Z);for(let ge=0,Ue=Ie.length;ge<Ue;ge=ge+1){let Fe=Ie[ge],Ce=null,Ye=()=>{if(Ce!=null){let we=Ce.compilePaths(),st=Et.getOrCreate(we,Ce.windingRule);L.push(new wt(st,Fe)),Ce=null}};for(let we of Ee.regions)we.bounds().isEmpty()||(we.type==0?Ce!=null&&Ce.canAddRegion(we)?Ce.add(we):(Ye(),Ce=new De(we)):(Ye(),L.push(new Bl(()=>new Et(we.path(),we.windingRule),Fe,we.bounds(),ft.forDynamicGeometry(te)))));Ye()}}ae._generateGeometries=Ke;function _t(L,x,W,Z,te,se,le){Ae.perfTimerScope("text-geometry-viewer",Ae.ProfileLevel.LOW,()=>{let Ee=x.textGeometry();if(Ee==null||W==null)return;let Ie=(Fe,Ce)=>{var st;let Ye=Ur.getEmojiImageUrl(Fe,Ce),we=((st=x.derivedTextData())==null?void 0:st.usedEmojiImages())??[];for(let tt of we)if(tt.url()==Ye){let ve=new $("EMOJI");return ve.setOpacity(1),ve.setBlendMode("NORMAL"),ve.setImage(tt),j(le,[ve],0)}return null},ge=Fe=>{let Ce=Ee.paintOverrides.get(Fe,te);return Ce!=null?j(le,Ce,0):j(le,W,0)},Ue=(Fe,Ce)=>{let Ye=Ce.textData();if(!Ye)return null;let we=Ye.styleOverrideTable().styleByID2(),st=we.get(Fe);if(!st)return null;let tt=or.get(st,63,null);if(tt!=null)return Je.asPaintData(tt);let ve=we!=null?or.get(st,104,null):null,Ve=ve!=null?te.findStyle(Je.asStyleId(ve)):null;return Ve!=null&&Ve.styleType()=="TEXT"?Ve.textDecorationFillPaints():null};for(let Fe=0,Ce=Ee.regions.length;Fe<Ce;Fe=Fe+1){let Ye=Ee.regions[Fe];if(Ee.emojiCodepoints[Fe]&&Ee.emojiCodepoints[Fe].length>0){let tt=Et.getOrCreate(Ye.path(),Ye.windingRule),ve=Ie(Ee.emojiCodepoints[Fe],Ee.emojiImageSet);if(ve==null)continue;L.push(new wt(tt,ve));continue}if(Ee.decorationRegions[Fe]){let tt=Ee.decorationRegions[Fe],ve=Et.getOrCreate(tt.path(),tt.windingRule),Ve=Ue(tt.styleID,x),er=Ve&&Ve.length>0?Ve:Z.length>0?Z:ge(tt.styleID);er!=null&&L.push(new wt(ve,er))}let we=ge(Ye.styleID);if(we==null)continue;for(let tt=0,ve=we.length;tt<ve;tt=tt+1){let Ve=we[tt].asSinglePaint();(Ve==null?void 0:Ve.video())!=null&&Ve.video().getVideoManager().associatePaintWithNode(Ve,x)}let st=Se.isolatedPaints(we);for(let tt=0,ve=st.length;tt<ve;tt=tt+1){let Ve=st[tt];if(!Ye.bounds().isEmpty()){let er=Et.getOrCreate(Ye.path(),Ye.windingRule);L.push(new wt(er,Ve))}}}})}ae._generateGeometriesForText=_t;function bt(L,x,W,Z){for(let te=0,se=x.length;te<se;te=te+1){let le=x[te];if(Se.containsAtLeastOneVisiblePaint(le.paints)){let Ee=new Ar(L,le,W),Ie=le.paints;Ie.length!=0&&Ie[0].blendMode()!="NORMAL"?Z.push(new io(Ie[0].blendMode(),1,Ee)):Z.push(Ee)}}}ae._generateFills=bt;function Xt(L,x,W){if(x.mode!=1||L.strokeAlign()!="INSIDE")return!1;for(let Z=0,te=W.length;Z<te;Z=Z+1){let se=W[Z];if(Se.containsAtLeastOneVisibleOpaquePaint(se.paints))return!0}return!1}ae._canSkipInsideStrokesForShadows1=Xt;function oe(L,x,W){return x.mode!=1||L.strokeAlign()!="INSIDE"?!1:Se.containsAtLeastOneVisibleOpaquePaint(W)}ae._canSkipInsideStrokesForShadows2=oe;function vt(L,x,W,Z,te,se){let le=[];for(let Ee=0,Ie=W.length;Ee<Ie;Ee=Ee+1){let ge=W[Ee];le.push(new wt(ge.path(),Se.EMPTY))}for(let Ee=0,Ie=Z.length;Ee<Ie;Ee=Ee+1){let ge=Z[Ee],Ue=ge.paints,Fe=[ge],Ce=new yd(x,le,Fe,te,L=="INSIDE"?0:1);Ue.length!=0&&se.push(new io(Ue[0].blendMode(),1,Ce))}}ae._generateFillStrokes=vt;function Er(L){return L==1?Se.SOLID_BLACK:Se.EMPTY}ae._outlineMaskPaintData=Er;function dt(L){for(let x=0,W=L.length;x<W;x=x+1){let Z=L[x];if(Se.containsAtLeastOneVisiblePaint(Z.paints))return!0}return!1}ae._isAnyGeometryVisible=dt;function We(L,x){for(let W=0,Z=L.length;W<Z;W=W+1){let te=L[W];if(te.type()==x&&te.isEnabledAndVisible())return!0}return!1}ae._hasVisibleEffectsOfType=We;function mt(L){for(let x=0,W=L.length;x<W;x=x+1)if(L[x].isEnabledAndVisible())return!0;return!1}ae._hasVisibleEffects=mt;function Qe(L){if(L.length!=1)return!1;let x=L[0].paints;return x.length==1&&x[0].type()=="SOLID"}ae._isSingleSolidGeometry=Qe;function Ut(){return ae._flushBeforeMasks}ae.flushBeforeMasks=Ut;function $t(L){ae._flushBeforeMasks=L}ae.setFlushBeforeMasks=$t;let Wt;(se=>(se[se.NORMAL=0]="NORMAL",se[se.SHADOW=1]="SHADOW",se[se.WITHOUT_BACKGROUND_BLURS=2]="WITHOUT_BACKGROUND_BLURS",se[se.KNOCKOUT_SHADOW=3]="KNOCKOUT_SHADOW",se[se.SLIDE_THUMBNAIL=4]="SLIDE_THUMBNAIL"))(Wt=ae.RenderMode||(ae.RenderMode={}));let xr;(W=>(W[W.INCLUDE=0]="INCLUDE",W[W.IGNORE=1]="IGNORE"))(xr=ae.IncludeUnnecessaryGeometry||(ae.IncludeUnnecessaryGeometry={}));class Br{constructor(x,W=null){this.mode=x,this.shadowOwnerID=W}clone(){return new Br(this.mode,this.shadowOwnerID)}isForShadows(){return this.mode==1||this.mode==3}}ae.GenerateArgs=Br;let qr;(W=>(W[W.FILL=0]="FILL",W[W.STROKE=1]="STROKE"))(qr=ae.GeometryType||(ae.GeometryType={}));let Bn;(W=>(W[W.IGNORE=0]="IGNORE",W[W.INCLUDE=1]="INCLUDE"))(Bn=ae.LastMask||(ae.LastMask={}));class ei{constructor(x,W){this.nodes=[],this.scrollBehavior=x,this.scrollSpeedMultiplier=W,this.scrollingSceneNode=null}isFixed(){return this.scrollBehavior=="FIXED_WHEN_CHILD_OF_SCROLLING_FRAME"}isStickyScrolling(){return this.scrollBehavior=="STICKY_SCROLLS"}isStandardScrolling(){return this.scrollBehavior=="SCROLLS"}}ae.ContiguousRenderNodes=ei;class Vt{constructor(x,W){this.node=x,this.layerWrap=W}}ae.GeometryRenderTreeResult=Vt;let ti;(Z=>(Z[Z.WITH_INNER_SHADOWS_AND_TOP_STROKE=0]="WITH_INNER_SHADOWS_AND_TOP_STROKE",Z[Z.WITH_INNER_SHADOWS_ONLY=1]="WITH_INNER_SHADOWS_ONLY",Z[Z.WITHOUT_LAYER_WRAPS=2]="WITHOUT_LAYER_WRAPS"))(ti=ae.LayerWrap||(ae.LayerWrap={}));let ri;(Z=>(Z[Z.FILL_PAINT_DATA=0]="FILL_PAINT_DATA",Z[Z.STROKE_PAINT_DATA=1]="STROKE_PAINT_DATA",Z[Z.TEXT_DECORATION_FILL_PAINT_DATA=2]="TEXT_DECORATION_FILL_PAINT_DATA"))(ri=ae.PaintType||(ae.PaintType={}));class Yn{constructor(x){this.minX=0,this.minY=0,this.maxX=0,this.maxY=0,this.minX=x.left(),this.maxX=x.right(),this.minY=x.top(),this.maxY=x.bottom()}}ae.RBushRect=Yn;class De{constructor(x){this.windingRule=null,this._uniquePathsOnly=!1,this._collisionTracker=new Ov.default,this._paths=[],this.windingRule=x.windingRule,this._uniquePathsOnly=x.path()instanceof no,this.add(x)}compilePaths(){if(this._paths.length==1)return this._paths[0];if(this._uniquePathsOnly){let W=[];for(let se of this._paths)W.push(se.handle);let Z=N().modules().uniquePathHelpers.getVolatileConcatenatedPaths(W),te=new Uint8Array(Z);return new ze(new fn(te))}let x=this._paths[0].toBezierPath().getMutableClone();for(let W=1,Z=this._paths.length;W<Z;W=W+1)x.append(this._paths[W].toBezierPath());return x}canAddRegion(x){return x.windingRule==this.windingRule&&this._uniquePathsOnly==x.path()instanceof no&&!this._collisionTracker.collides(new Yn(x.path().bounds()))}add(x){this._paths.push(x.path()),this._collisionTracker.insert(new Yn(x.path().bounds()))}}ae.PathBatch=De;let Ot;(W=>(W[W.ALL_PAINTS_INVISIBLE=0]="ALL_PAINTS_INVISIBLE",W[W.HAS_VISIBLE_PAINTS=1]="HAS_VISIBLE_PAINTS"))(Ot=ae.PaintVisibility||(ae.PaintVisibility={})),ae.GEN_DURATION_LOG_THRESHOLD_S=.15,ae._trackingKeys=new Set,ae._flushBeforeMasks=!1})(ye||(ye={}));var Ml=class{constructor(e,t){this.type=e,this.interruptIndex=t}},e_=class extends Ml{constructor(e,t,n,o){super(3,0),this.node=e,this.transform=t,this.canvasSpaceTileBounds=n,this.inverseVolatileTransform=o}},t_=class extends Ml{constructor(e){super(2,0),this.scissor=e}},r_=class extends Ml{constructor(e,t,n,o,i){super(4,0),this.blendIsNoOp=e,this.node=t,this.transform=n,this.canvasSpaceTileBounds=o,this.inverseVolatileTransform=i}},Yi=class extends Ml{constructor(e,t,n,o,i){super(1,i),this.node=e,this.transform=t,this.canvasSpaceTilebounds=n,this.inverseVolatileTransform=o}};var Cv=(r,e,t)=>{var n;if(yi.didUseUnifiedRendererMaterial(Y.useUnifiedRenderer()),Y.useUnifiedRenderer()){let o={m00:t.m00(),m01:t.m01(),m02:t.m02(),m10:t.m10(),m11:t.m11(),m12:t.m12()};(n=N().modules().wasmRendererBindings)==null||n.bindSolidColorPaintForStencilUniforms(o)}else Be.Material_setUniformMat32(r,e.GLSLX_NAME_U_VERTEX_TRANSFORM,t)},n_=(r,e,t,n,o)=>{var i;if(yi.didUseUnifiedRendererMaterial(Y.useUnifiedRenderer()),Y.useUnifiedRenderer()){let a={m00:t.m00(),m01:t.m01(),m02:t.m02(),m10:t.m10(),m11:t.m11(),m12:t.m12()};(i=N().modules().wasmRendererBindings)==null||i.bindSolidColorPaintUniforms(a,o,O.toColorF(n))}else Be.Material_setUniformMat32(r,e.GLSLX_NAME_U_VERTEX_TRANSFORM,t),Be.Material_setUniformVec42(r,e.GLSLX_NAME_U_COLOR,n),r.setUniformFloat(e.GLSLX_NAME_U_OPACITY,o)};var Gl=class Gl{texture(e){return this._texture==null&&(this._texture=e.createTextureWithPixels(be.RGBA_LINEAR_CLAMP,Gl.WIDTH,Gl.HEIGHT,this.pixels,yr.GRADIENT)),this._texture}totalVRAM(){return this._texture!=null?Mo.Texture_totalVRAM(this._texture):0}constructor(e){this.pixels=e,this._texture=null}};Gl.WIDTH=1024,Gl.HEIGHT=2;var Ja=Gl,Rd=class r{constructor(){this._table=null;let e=new go;this._table=new pi(t=>r._hashGradient(e,t),(t,n)=>t.equals2(n),t=>r._evaluateGradient(t))}allocate(e){return this._table.getOrInsertFallback(e)}totalVRAM(){let e=0;return this._table.each((t,n)=>{e=e+n.totalVRAM()}),e}static _hashGradient(e,t){let n=t.colorStops(),o=n.length;e.hash2(zs.shouldWrap(t.type())?1:0),e.hash2(o);for(let i=0,a=o;i<a;i=i+1){let s=n[i];e.hash2(s.color),e.hash1(s.position)}return e.value()}static _evaluateGradient(e){let t=new Uint8Array(Ja.WIDTH*Ja.HEIGHT*4),n=e.flattenedStops(),o=n.length;if(o!=0){let i=1,a=n[0],s=a,l=0;for(let d=0;d<Ja.WIDTH;d=d+1){let c=d/(Ja.WIDTH-1);for(;a.position<c&&i<o;)s=a,a=n[i],i=i+1;let p=s.position,u=a.position,_=c<p?0:c>u?1:p<u?(c-p)/(u-p):0,h=s.color,S=a.color,m=((h>>>24)+((S>>>24)-(h>>>24))*_)/255;for(let f=0;f<4;f=f+1){let T=h&255,y=S&255,E=T+(y-T)*_,v=.5+257*(f<3?E*m:E)|0;t[l]=v>>8,t[l+Ja.WIDTH*4]=v,h>>=8,S>>=8,l=l+1}}}return new Ja(t)}};var Cr;(o=>{function r(i){return i.length==0}o.isEmpty=r;function e(i,a){return i[a]}o.get=e;function t(i){return ne.List_last(i)}o.last=t;function n(i){return i.length}o.count=n})(Cr||(Cr={}));var vd=class{constructor(e){this._scissorStack=[],this._framebuffer=e}pushScissor(e,t,n,o){let i=new G(e,t,n,o);this.pushScissorRect(i)}pushScissorRect(e){this._scissorStack.length!=0&&e.intersectWith(ne.List_last(this._scissorStack)),this._scissorStack.push(e)}popScissor(){ne.List_removeLast(this._scissorStack)}takeScissor(){return this._scissorStack.pop()}takeAllScissors(){let e=this._scissorStack;return this._scissorStack=[],e}replaceAllScissors(e){this._scissorStack=e}scissors(){return this._scissorStack}clearScissors(){this._scissorStack.length=0}activeScissor(){return this._scissorStack.length==0?null:ne.List_last(this._scissorStack)}};var a_=class a_{static SUPERSAMPLE_COUNT(){return this._CACHED_SUPERSAMPLE_COUNT==null&&(this._CACHED_SUPERSAMPLE_COUNT=Y.useSSAA()?4:2),this._CACHED_SUPERSAMPLE_COUNT}static SSAA_SIZE(){return tr.TILE_SIZE*a_.SUPERSAMPLE_COUNT()}constructor(e,t,n){this._gradientDataCache=new Map,this._gradientPool=new Rd,this._batchAntialiasing=null,this._currentBatchScissorBuilder=new ht,this._shouldFlushAfterStencilCover=!1,this._materialStrings=Pr.instance(),this.computeStates=new Map([["ODD",lr.ODD_WINDING_NUMBER_COMPUTE],["NONZERO",lr.NONZERO_WINDING_NUMBER_COMPUTE]]),this.useStates=new Map([["ODD",lr.ODD_WINDING_NUMBER],["NONZERO",lr.NONZERO_WINDING_NUMBER]]),this.clearStates=new Map([["ODD",lr.ODD_WINDING_NUMBER_CLEAR],["NONZERO",lr.NONZERO_WINDING_NUMBER_CLEAR]]),this.setFillStates=new Map([["ODD",lr.ODD_WINDING_NUMBER_FILL],["NONZERO",lr.NONZERO_WINDING_NUMBER_FILL]]),this.setStrokeStates=new Map([["ODD",lr.ODD_WINDING_NUMBER_STROKE],["NONZERO",lr.NONZERO_WINDING_NUMBER_STROKE]]),this.compoundUseStates=new Map([[0,lr.STROKE_INSIDE],[1,lr.STROKE_OUTSIDE]]),this.compoundClearStates=new Map([[0,lr.STROKE_INSIDE_CLEAR],[1,lr.STROKE_OUTSIDE_CLEAR]]),this._delegate=e,this._context=t,this._bufferPool=n,Y.useUnifiedRenderer()?this._solidColorMaterial=new Lp(this._context,"solidColorPaint",Le.getPositionF2CoordF3()):this._solidColorMaterial=this._context.createMaterial("solidColor",Le.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.GLSLX_SOURCE_SOLID_COLOR_PAINT_FRAGMENT),this._gradientPaintMaterial=this._context.createMaterial("gradientPaint",Le.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.GLSLX_SOURCE_GRADIENT_FRAGMENT),this._lerpGradientPaintMaterial=this._context.createMaterial("lerpGradientPaint",Le.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.GLSLX_SOURCE_LERP_GRADIENT_FRAGMENT),this._stencilMaterial=this._context.createMaterial("stencil",Le.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_LOOP_BLINN_VERTEX,this._materialStrings.GLSLX_SOURCE_LOOP_BLINN_FRAGMENT),this._imageMaterial=this._context.createMaterial("image",Le.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.GLSLX_SOURCE_IMAGE_FRAGMENT),this._lerpImageMaterial=this._context.createMaterial("lerpImage",Le.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_TWO_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.GLSLX_SOURCE_LERP_IMAGE_FRAGMENT),this._imageColorAdjustMaterial=this._context.createMaterial("imageColorAdjust",Le.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.GLSLX_SOURCE_IMAGE_COLOR_ADJUST_FRAGMENT),this._lerpImageColorAdjustMaterial=this._context.createMaterial("lerpImageColorAdjust",Le.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_TWO_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.GLSLX_SOURCE_LERP_IMAGE_COLOR_ADJUST_FRAGMENT),Ll()&&(this._aaaShapeSolidColorMaterial=this._context.createMaterial("aaaShapeSolidColor",Le.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_AAA_SHAPE_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.GLSLX_SOURCE_AAA_SHAPE_SOLID_COLOR_PAINT_FRAGMENT),this._aaaShapeGradientPaintMaterial=this._context.createMaterial("aaaShapeGradientPaint",Le.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_AAA_SHAPE_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.GLSLX_SOURCE_AAA_SHAPE_GRADIENT_FRAGMENT),this._aaaShapeLerpGradientPaintMaterial=this._context.createMaterial("aaaShapeLerpGradientPaint",Le.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_AAA_SHAPE_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.GLSLX_SOURCE_AAA_SHAPE_LERP_GRADIENT_FRAGMENT),this._aaaShapeImageMaterial=this._context.createMaterial("aaaShapeImage",Le.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_AAA_SHAPE_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.GLSLX_SOURCE_AAA_SHAPE_IMAGE_FRAGMENT),this._aaaShapeLerpImageMaterial=this._context.createMaterial("aaaShapeLerpImage",Le.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_AAA_SHAPE_TWO_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.GLSLX_SOURCE_AAA_SHAPE_LERP_IMAGE_FRAGMENT),this._aaaShapeImageColorAdjustMaterial=this._context.createMaterial("aaaShapeImageColorAdjust",Le.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_AAA_SHAPE_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.GLSLX_SOURCE_AAA_SHAPE_IMAGE_COLOR_ADJUST_FRAGMENT),this._aaaShapeLerpImageColorAdjustMaterial=this._context.createMaterial("aaaShapeLerpImageColorAdjust",Le.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_AAA_SHAPE_TWO_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.GLSLX_SOURCE_AAA_SHAPE_LERP_IMAGE_COLOR_ADJUST_FRAGMENT)),this._quadArea=this._bufferPool.allocateSmallManagedArea(Le.getPositionF2CoordF3(),new Uint8Array(new Float32Array([0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,1,1,0,0,0]).buffer)),this._shouldFlushAfterStencilCover=this._checkShouldFlushAfterStencilCover()}totalVRAM(){return this._gradientPool.totalVRAM()}clearGradientCache(){this._gradientDataCache=new Map,this._gradientPool=new Rd}canSkipStencil(e,t,n){return t.hasNoCurves?!!(t.hasNoOverlaps||e=="NONZERO"&&t.hasNoCurvesAndSameOrientation&&!Se.containsAtLeastOneNonOpaquePaint(n)):!1}currentBatchAA(){return this._batchAntialiasing}currentBatchScissor(){return this._currentBatchScissorBuilder.build()}includeBoundsInBatchScissor(e){this._currentBatchScissorBuilder.include3(e)}beginBatch(e){this._batchAntialiasing=new ce(e),this._batchAntialiasing.value==2&&this._delegate.pushSSAARenderState(null)}finishBatch(){if(this._delegate.supersampleState().level==1&&this._delegate.supersampleState().mode==0&&this._batchAntialiasing.value==2){let e=this.currentBatchScissor();this._delegate.currentTile().pushScissorRect(e)}this._currentBatchScissorBuilder.reset(),this._batchAntialiasing.value==2&&this._delegate.popSSAARenderState(),this._batchAntialiasing=null}renderStencilQuad(e,t,n){let o=this._solidColorMaterial,i=J.new3(e).translatedBy1(t.topLeft()).scaledBy1(t.size());Cv(o,this._materialStrings,i),this._delegate.drawToCurrentTile(1,o,this._quadArea,It.KEEP,n),this._delegate.markDidDraw()}renderFill(e,t){if(t.geometry.paints.length==0)return;let n=t.geometry.type==Ci.PaintedGeometryType.DYNAMIC?t.geometry.path().bounds().size():t.paintSize,o=J.new2().translatedBy2(-1,-1).scaledBy2(2).multipliedBy1(e).multipliedBy1(t.transform),i=this._delegate.currentTile(),a=i.tileSize(),s=J.new2().scaledBy2(a).multipliedBy1(e).multipliedBy1(t.transform),l=Cr.isEmpty(i.scissors())?new G(0,0,a,a):Cr.last(i.scissors()),d=G.new3(t.geometry.path().bounds());if(s.transformRect(d),d.intersectWith(l),this.includeBoundsInBatchScissor(d),t.geometry.canBeAnalyticallyAntialiased()){this.renderAAAShape(o,t.geometry,n,a,It.PREMULTIPLIED);return}let c=t.geometry.path().windingRule(),p=t.geometry.path().triangles(this._bufferPool,Le.getPositionF2CoordF3()),u=!0;for(let _=0,h=p.length;_<h;_=_+1)if(!this.canSkipStencil(c,p[_],t.geometry.paints)){u=!1;break}u?this.renderGeometryDirectly(o,t.geometry,n,a,It.PREMULTIPLIED):(this.renderStencilGeometry(o,t.geometry,this.computeStates.get(c)),this.renderCoverQuad(o,t.geometry,n,this.useStates.get(c),this.clearStates.get(c),a,It.PREMULTIPLIED))}renderFillStroke(e,t){let n=this._delegate.currentTile(),o=n.tileSize(),i=J.new2().scaledBy2(o).multipliedBy1(e).multipliedBy1(t.transform),a=Cr.isEmpty(n.scissors())?new G(0,0,o,o):Cr.last(n.scissors()),s=J.new2().translatedBy2(-1,-1).scaledBy2(2).multipliedBy1(e).multipliedBy1(t.transform);for(let l=0,d=t.fillGeometries.length;l<d;l=l+1){let c=t.fillGeometries[l],p=G.new3(c.path().bounds());i.transformRect(p),this.includeBoundsInBatchScissor(p.intersectedWith(a));let u=c.path().windingRule();this.renderStencilGeometry(s,c,this.computeStates.get(u)),this.renderCoverQuad(s,c,t.paintSize,this.useStates.get(u),this.setFillStates.get(u),o,It.PREMULTIPLIED)}for(let l=0,d=t.strokeGeometries.length;l<d;l=l+1){let c=t.strokeGeometries[l],p=G.new3(c.path().bounds());i.transformRect(p),this.includeBoundsInBatchScissor(p.intersectedWith(a));let u=c.path().windingRule();this.renderStencilGeometry(s,c,this.computeStates.get(u)),this.renderStencilQuad(s,c.path().bounds(),this.setStrokeStates.get(u)),this.renderCoverQuad(s,c,t.paintSize,this.compoundUseStates.get(t.mode),this.compoundClearStates.get(t.mode),o,It.PREMULTIPLIED)}if(t.strokeGeometries.length!=0){let l=ne.List_last(t.strokeGeometries).path().bounds(),d=ne.List_last(t.fillGeometries).path().bounds();l.contains1(d)||this.renderStencilQuad(s,d,this.compoundClearStates.get(t.mode))}}uvTransformFromBounds(e,t){let n=J.new2();return n.scale4(1/t.x(),1/t.y()),n.translate1(e.topLeft()),n.scale3(e.size()),n}canSkipPaint(e,t,n,o){let i=n.asSinglePaint();if(i==null)return!1;if((i.type()=="GRADIENT_RADIAL"||i.type()=="GRADIENT_DIAMOND")&&i.lastStopIsTransparent()){let a=J.new3(i.transform());if(a.multiply(t),a.invert()){let s=ne.List_last(i.colorStops()).position*.5,l=new b(.5,.5),d=G.new4(l.subtractScalar(s),l.addScalar(s));return J.new3(e).translatedBy1(o.topLeft()).scaledBy1(o.size()).multipliedBy1(a).transformRect(d),!G.CLIP.overlaps(d)}}return!1}_findOrCreateGradientData(e){let t=Dt.IntMap_get(this._gradientDataCache,e.id(),null);return t==null&&(t=this._gradientPool.allocate(e),this._gradientDataCache.set(e.id(),t)),t}_setAaaShapeUniforms(e,t,n){if(e.setUniformVec21(this._materialStrings.GLSLX_NAME_U_UV_SCALE,n.x(),n.y()),Be.Material_setUniformVec22(e,this._materialStrings.GLSLX_NAME_U_PATH_SIZE,t.bounds().size()),t instanceof Aa){let o=t;e.setUniformInt(this._materialStrings.GLSLX_NAME_U_SHAPE_TYPE,i_.ELLIPSE),Be.Material_setUniformVec22(e,this._materialStrings.GLSLX_NAME_U_ELLIPSE_CENTER,o.center.subtract(o.bounds().topLeft())),e.setUniformVec21(this._materialStrings.GLSLX_NAME_U_ELLIPSE_RADII,o.xRadius,o.yRadius)}else if(t instanceof St){let o=t;e.setUniformInt(this._materialStrings.GLSLX_NAME_U_SHAPE_TYPE,i_.ROUNDED_RECT),Be.Material_setUniformVec43(e,this._materialStrings.GLSLX_NAME_U_RECT,t.bounds().translatedBy(t.bounds().topLeft())),e.setUniformVec41(this._materialStrings.GLSLX_NAME_U_CORNER_RADII,Math.max(o.radii().topLeft,0),Math.max(o.radii().topRight,0),Math.max(o.radii().bottomRight,0),Math.max(o.radii().bottomLeft,0))}else throw new Error("Unxpected path type")}renderAAAShape(e,t,n,o,i){let a=t.paints,s=t.path().bounds(),l=e.clone(),d=l.invert(),c=2/o,p=l.scale1().x()*c,u=s.clone().expandedBy1(p),_=J.new3(e).translatedBy1(u.topLeft()).scaledBy1(u.size()),h=this.uvTransformFromBounds(s,n),S=new b(u.width()/s.width(),u.height()/s.height()),m=t.path().path();for(let f=0,T=a.length;f<T;f=f+1){let y=a[f];if(!this.canSkipPaint(e,h,y,s))if(y.type()=="SOLID"){let E=this._aaaShapeSolidColorMaterial;this._setAaaShapeUniforms(E,m,S),Be.Material_setUniformMat32(E,this._materialStrings.GLSLX_NAME_U_VERTEX_TRANSFORM,_),Be.Material_setUniformVec42(E,this._materialStrings.GLSLX_NAME_U_COLOR,O.premultiplied(y.color())),E.setUniformFloat(this._materialStrings.GLSLX_NAME_U_OPACITY,y.opacity()),this._delegate.drawToCurrentTile(1,E,this._quadArea,i),this._delegate.markDidDraw()}else if(zs.isGradient(y.type())){let E=J.new3(y.transform()).multipliedBy1(h),v=null,A=y.asVolatilePaint();if(A!=null){v=this._aaaShapeLerpGradientPaintMaterial;let I=this._findOrCreateGradientData(A.from()).texture(this._context),C=this._findOrCreateGradientData(A.to()).texture(this._context);I.setFormat(be.RGBA_LINEAR_CLAMP),C.setFormat(be.RGBA_LINEAR_CLAMP),v.setUniformSampler(this._materialStrings.GLSLX_NAME_TEXTURE0,I,0),v.setUniformSampler(this._materialStrings.GLSLX_NAME_TEXTURE1,C,1),v.setUniformFloat(this._materialStrings.GLSLX_NAME_U_PROGRESS,A.t())}else{let I=y.asSinglePaint();v=this._aaaShapeGradientPaintMaterial;let C=this._findOrCreateGradientData(I).texture(this._context);C.setFormat(be.RGBA_LINEAR_CLAMP),v.setUniformSampler(this._materialStrings.GLSLX_NAME_TEXTURE0,C,0)}this._setAaaShapeUniforms(v,m,S),Be.Material_setUniformMat32(v,this._materialStrings.GLSLX_NAME_U_VERTEX_TRANSFORM,_),Be.Material_setUniformMat32(v,this._materialStrings.GLSLX_NAME_U_PAINT_TRANSFORM0,E),v.setUniformInt(this._materialStrings.GLSLX_NAME_U_TYPE,o_.get(y.type())),v.setUniformFloat(this._materialStrings.GLSLX_NAME_U_OPACITY,y.opacity()),this._delegate.drawToCurrentTile(1,v,this._quadArea,i),this._delegate.markDidDraw()}else if(y.type()=="IMAGE"||y.type()=="VIDEO"){let E=J.new3(h).scaledBy3(1/s.size().x(),1/s.size().y()),v=!0,A=y.asVolatilePaint();if(A!=null){let I=this.getImageToDraw(A.from(),n,e,E,A.from().imageScaleMode(),o);if(I!=null){let C=J.new2(),g=null;if(A.from().image()==A.to().image()&&!(A.from().imageScaleMode()=="TILE"||A.to().imageScaleMode()=="TILE"))g=this._aaaShapeImageMaterial,A.colorAdjustIsActive()&&(g=this._aaaShapeImageColorAdjustMaterial,A.colorAdjustSetData(g)),C=this.allocateObjectSpaceToNormalizedImageSpaceTransform(A,n,h);else{g=this._aaaShapeLerpImageMaterial,A.colorAdjustIsActive()&&(g=this._aaaShapeLerpImageColorAdjustMaterial,A.colorAdjustSetData(g)),C=this.allocateObjectSpaceToNormalizedImageSpaceTransform(A.from(),n,h);let D=this.getImageToDraw(A.to(),n,e,E,A.to().imageScaleMode(),o);if(D==null)v=!1;else{let P=this.getOrCreateVideoTexture(A.to());P==null&&(P=this._delegate.getOrCreateImageTexture(D));let U=this.allocateObjectSpaceToNormalizedImageSpaceTransform(A.to(),n,h);Be.Material_setUniformMat32(g,this._materialStrings.GLSLX_NAME_U_PAINT_TRANSFORM1,U),P!=null&&!D.image.isCompressedTexture()&&P.setFormat(be.RGBA_NEAREST_CLAMP),g.setUniformSampler(this._materialStrings.GLSLX_NAME_TEXTURE1,P,1),g.setUniformFloat(this._materialStrings.GLSLX_NAME_U_PROGRESS,kt.double_clamp(A.t(),0,1))}}g.setUniformFloat(this._materialStrings.GLSLX_NAME_U_PIXEL_RATIO,window.devicePixelRatio*this._delegate.canvasSpaceToViewSpaceScale());let R=this.getOrCreateVideoTexture(A.from());R==null&&(R=this._delegate.getOrCreateImageTexture(I)),v&&R!=null&&(R!=null&&!I.image.isCompressedTexture()&&R.setFormat(be.RGBA_NEAREST_CLAMP),this._setupRepeatingForImage(y,g),Be.Material_setUniformMat32(g,this._materialStrings.GLSLX_NAME_U_VERTEX_TRANSFORM,_),Be.Material_setUniformMat32(g,this._materialStrings.GLSLX_NAME_U_PAINT_TRANSFORM0,C),g.setUniformFloat(this._materialStrings.GLSLX_NAME_U_OPACITY,A.opacity()),g.setUniformSampler(this._materialStrings.GLSLX_NAME_TEXTURE0,R,0),this._setAaaShapeUniforms(g,m,S),this._delegate.drawToCurrentTile(1,g,this._quadArea,i),this._delegate.markDidDraw())}}else{let I=y.asSinglePaint(),C=null,g=!1;if(C=this.getOrCreateVideoTexture(I),C==null){let R=this.getImageToDraw(I,n,e,E,I.imageScaleMode(),o);R!=null&&(C=this._delegate.getOrCreateImageTexture(R),g=R.image.isCompressedTexture())}if(C!=null){let R=this._aaaShapeImageMaterial;I.colorAdjustIsActive()&&(R=this._aaaShapeImageColorAdjustMaterial,I.colorAdjustSetData(R));let D=this.allocateObjectSpaceToNormalizedImageSpaceTransform(I,n,h);g||C.setFormat(be.RGBA_NEAREST_CLAMP),this._setupRepeatingForImage(y,R),Be.Material_setUniformMat32(R,this._materialStrings.GLSLX_NAME_U_VERTEX_TRANSFORM,_),Be.Material_setUniformMat32(R,this._materialStrings.GLSLX_NAME_U_PAINT_TRANSFORM0,D),R.setUniformFloat(this._materialStrings.GLSLX_NAME_U_OPACITY,I.opacity()),R.setUniformSampler(this._materialStrings.GLSLX_NAME_TEXTURE0,C,0),R.setUniformFloat(this._materialStrings.GLSLX_NAME_U_PIXEL_RATIO,window.devicePixelRatio*this._delegate.canvasSpaceToViewSpaceScale()),this._setAaaShapeUniforms(R,m,S),this._delegate.drawToCurrentTile(1,R,this._quadArea,i),this._delegate.markDidDraw()}}}else y.type()=="EMOJI"&&Oe("Emoji should always be rendered by renderGeometryDirectly")}}renderGeometryDirectly(e,t,n,o,i){let a=t.path().triangles(this._bufferPool,Le.getPositionF2CoordF3()),s=t.paints,l=t.path().bounds(),d=this.uvTransformFromBounds(l,n),c=null;for(let p=0,u=s.length;p<u;p=p+1){let _=s[p];if(!this.canSkipPaint(e,d,_,l))switch(_.type()){case"SOLID":{c=this._solidColorMaterial,n_(c,this._materialStrings,e,O.premultiplied(_.color()),_.opacity());for(let h=0,S=a.length;h<S;h=h+1)a[h].bufferArea!=null&&(this._delegate.drawToCurrentTile(0,c,a[h].bufferArea,i),this._delegate.markDidDraw());break}case"GRADIENT_LINEAR":case"GRADIENT_RADIAL":case"GRADIENT_ANGULAR":case"GRADIENT_DIAMOND":{let h=J.new3(_.transform()).scaledBy3(1/n.x(),1/n.y()),S=_.asVolatilePaint();if(S!=null){c=this._lerpGradientPaintMaterial;let m=this._findOrCreateGradientData(S.from()).texture(this._context),f=this._findOrCreateGradientData(S.to()).texture(this._context);m.setFormat(be.RGBA_LINEAR_CLAMP),f.setFormat(be.RGBA_LINEAR_CLAMP),c.setUniformSampler(this._materialStrings.GLSLX_NAME_TEXTURE0,m,0),c.setUniformSampler(this._materialStrings.GLSLX_NAME_TEXTURE1,f,1),c.setUniformFloat(this._materialStrings.GLSLX_NAME_U_PROGRESS,S.t())}else{let m=_.asSinglePaint();c=this._gradientPaintMaterial;let f=this._findOrCreateGradientData(m).texture(this._context);f.setFormat(be.RGBA_LINEAR_CLAMP),c.setUniformSampler(this._materialStrings.GLSLX_NAME_TEXTURE0,f,0)}Be.Material_setUniformMat32(c,this._materialStrings.GLSLX_NAME_U_VERTEX_TRANSFORM,e),Be.Material_setUniformMat32(c,this._materialStrings.GLSLX_NAME_U_PAINT_TRANSFORM0,h),c.setUniformInt(this._materialStrings.GLSLX_NAME_U_TYPE,o_.get(_.type())),c.setUniformFloat(this._materialStrings.GLSLX_NAME_U_OPACITY,_.opacity());for(let m=0,f=a.length;m<f;m=m+1)a[m].bufferArea!=null&&(this._delegate.drawToCurrentTile(0,c,a[m].bufferArea,i),this._delegate.markDidDraw());break}case"IMAGE":case"VIDEO":{let h=J.new2().scaledBy3(1/n.x(),1/n.y()),S=_.asVolatilePaint();if(S!=null){let m=this.getImageToDraw(S.from(),n,e,h,S.from().imageScaleMode(),o);if(m!=null){let f=J.new2(),T=!0;if(S.from().image()==S.to().image()&&!(S.from().imageScaleMode()=="TILE"||S.to().imageScaleMode()=="TILE"))c=this._imageMaterial,S.colorAdjustIsActive()&&(c=this._imageColorAdjustMaterial,S.colorAdjustSetData(c)),f=this.allocateObjectSpaceToNormalizedImageSpaceTransform(S,n,h);else{let E=this.getImageToDraw(S.to(),n,e,h,S.to().imageScaleMode(),o);if(E==null)T=!1;else{c=this._lerpImageMaterial,S.colorAdjustIsActive()&&(c=this._lerpImageColorAdjustMaterial,S.colorAdjustSetData(c)),f=this.allocateObjectSpaceToNormalizedImageSpaceTransform(S.from(),n,h);let v=this._delegate.getOrCreateImageTexture(E),A=this.allocateObjectSpaceToNormalizedImageSpaceTransform(S.to(),n,h);Be.Material_setUniformMat32(c,this._materialStrings.GLSLX_NAME_U_PAINT_TRANSFORM1,A),this._setupClampingForImageOrGIF(E.image,v),c.setUniformSampler(this._materialStrings.GLSLX_NAME_TEXTURE1,v,1),c.setUniformFloat(this._materialStrings.GLSLX_NAME_U_PROGRESS,kt.double_clamp(S.t(),0,1))}}let y=this._delegate.getOrCreateImageTexture(m);if(T&&y!=null){Be.Material_setUniformMat32(c,this._materialStrings.GLSLX_NAME_U_VERTEX_TRANSFORM,e),Be.Material_setUniformMat32(c,this._materialStrings.GLSLX_NAME_U_PAINT_TRANSFORM0,f),c.setUniformFloat(this._materialStrings.GLSLX_NAME_U_OPACITY,S.opacity()),this._setupRepeatingForImage(_,c),this._setupClampingForImageOrGIF(m.image,y),c.setUniformSampler(this._materialStrings.GLSLX_NAME_TEXTURE0,y,0);for(let E=0,v=a.length;E<v;E=E+1)a[E].bufferArea!=null&&(this._delegate.drawToCurrentTile(0,c,a[E].bufferArea,i),this._delegate.markDidDraw())}}}else{let m=_.asSinglePaint(),f=null;if(f=this.getOrCreateVideoTexture(m),f==null){let T=this.getImageToDraw(m,n,e,h,m.imageScaleMode(),o);T!=null&&(f=this._delegate.getOrCreateImageTexture(T),f!=null&&this._setupClampingForImageOrGIF(T.image,f))}if(f!=null){let T=this.allocateObjectSpaceToNormalizedImageSpaceTransform(m,n,h);c=this._imageMaterial,m.colorAdjustIsActive()&&(c=this._imageColorAdjustMaterial,m.colorAdjustSetData(c)),Be.Material_setUniformMat32(c,this._materialStrings.GLSLX_NAME_U_VERTEX_TRANSFORM,e),Be.Material_setUniformMat32(c,this._materialStrings.GLSLX_NAME_U_PAINT_TRANSFORM0,T),c.setUniformFloat(this._materialStrings.GLSLX_NAME_U_OPACITY,m.opacity()),this._setupRepeatingForImage(_,c),c.setUniformSampler(this._materialStrings.GLSLX_NAME_TEXTURE0,f,0);for(let y=0,E=a.length;y<E;y=y+1)a[y].bufferArea!=null&&(this._delegate.drawToCurrentTile(0,c,a[y].bufferArea,i),this._delegate.markDidDraw())}}break}case"EMOJI":{let h=_.asSinglePaint();if(h==null)continue;let S=this._delegate.getOrCreateImageTexture(new Qi(h.image(),2));if(h.decodedImageIsReady()||(S=null),S!=null){let m=S;c=this._imageMaterial;let f=J.new2().scaledBy3(1/l.width(),1/l.height()).translatedBy2(-l.left(),-l.top());Be.Material_setUniformMat32(c,this._materialStrings.GLSLX_NAME_U_VERTEX_TRANSFORM,e),Be.Material_setUniformMat32(c,this._materialStrings.GLSLX_NAME_U_PAINT_TRANSFORM0,f),c.setUniformFloat(this._materialStrings.GLSLX_NAME_U_OPACITY,h.opacity()),c.setUniformSampler(this._materialStrings.GLSLX_NAME_TEXTURE0,m,0),m!=null&&m.setFormat(be.RGBA_NEAREST_CLAMP);for(let T=0,y=a.length;T<y;T=T+1)a[T].bufferArea!=null&&(this._delegate.drawToCurrentTile(0,c,a[T].bufferArea,i),this._delegate.markDidDraw())}break}}}}_setupRepeatingForImage(e,t){let n=!1,o=e.asVolatilePaint();o!=null?o.eitherPaint(i=>i.imageScaleMode()=="TILE")&&(n=!0):e.asSinglePaint()!=null&&(n=e.asSinglePaint().imageScaleMode()=="TILE"),t.setUniformInt(this._materialStrings.GLSLX_NAME_U_EMULATE_WRAP_ADDRESS,n?1:0),t.setUniformInt(this._materialStrings.GLSLX_NAME_U_EMULATE_BORDER_ADDRESS,n?0:1)}_setupClampingForImageOrGIF(e,t){e.isGIF()?t.setFormat(be.RGBA_LINEAR_CLAMP):e.isCompressedTexture()||t.setFormat(be.RGBA_NEAREST_CLAMP)}renderStencilGeometry(e,t,n){let o=t.path().triangles(this._bufferPool,Le.getPositionF2CoordF3()),i=this._stencilMaterial;Be.Material_setUniformMat32(i,this._materialStrings.GLSLX_NAME_U_VERTEX_TRANSFORM,e);for(let a=0,s=o.length;a<s;a=a+1)o[a].bufferArea!=null&&(this._delegate.drawToCurrentTile(0,i,o[a].bufferArea,It.KEEP,n),this._delegate.markDidDraw())}_checkShouldFlushAfterStencilCover(){return!!Y.shouldFlushAfterStencilCover()}renderCoverQuad(e,t,n,o,i,a,s){let l=t.paints;if(l.length==0){this.renderStencilQuad(e,t.path().bounds(),i),this._shouldFlushAfterStencilCover&&this._context.flush();return}let d=t.path().bounds(),c=J.new3(e).translatedBy1(d.topLeft()).scaledBy1(d.size()),p=this.uvTransformFromBounds(d,n),u=null;for(let _=0,h=l.length;_<h;_=_+1){let S=l[_],m=_+1==h;if(!m&&this.canSkipPaint(e,p,S,d))continue;let f=m?i:o;switch(S.type()){case"SOLID":{u=this._solidColorMaterial,n_(u,this._materialStrings,c,O.premultiplied(S.color()),S.opacity()),this._delegate.drawToCurrentTile(1,u,this._quadArea,s,f),this._delegate.markDidDraw();break}case"GRADIENT_LINEAR":case"GRADIENT_RADIAL":case"GRADIENT_ANGULAR":case"GRADIENT_DIAMOND":{let T=J.new3(S.transform()).multipliedBy1(p),y=S.asVolatilePaint();if(y!=null){u=this._lerpGradientPaintMaterial;let E=this._findOrCreateGradientData(y.from()).texture(this._context),v=this._findOrCreateGradientData(y.to()).texture(this._context);E.setFormat(be.RGBA_LINEAR_CLAMP),v.setFormat(be.RGBA_LINEAR_CLAMP),u.setUniformSampler(this._materialStrings.GLSLX_NAME_TEXTURE0,E,0),u.setUniformSampler(this._materialStrings.GLSLX_NAME_TEXTURE1,v,1),u.setUniformFloat(this._materialStrings.GLSLX_NAME_U_PROGRESS,y.t())}else{let E=S.asSinglePaint();u=this._gradientPaintMaterial;let v=this._findOrCreateGradientData(E).texture(this._context);v.setFormat(be.RGBA_LINEAR_CLAMP),u.setUniformSampler(this._materialStrings.GLSLX_NAME_TEXTURE0,v,0)}Be.Material_setUniformMat32(u,this._materialStrings.GLSLX_NAME_U_VERTEX_TRANSFORM,c),Be.Material_setUniformMat32(u,this._materialStrings.GLSLX_NAME_U_PAINT_TRANSFORM0,T),u.setUniformInt(this._materialStrings.GLSLX_NAME_U_TYPE,o_.get(S.type())),u.setUniformFloat(this._materialStrings.GLSLX_NAME_U_OPACITY,S.opacity()),this._delegate.drawToCurrentTile(1,u,this._quadArea,s,f),this._delegate.markDidDraw();break}case"IMAGE":case"VIDEO":{let T=J.new3(p).scaledBy3(1/d.size().x(),1/d.size().y()),y=!0,E=!1,v=S.asVolatilePaint();if(v!=null){let A=this.getImageToDraw(v.from(),n,e,T,v.from().imageScaleMode(),a);if(A!=null){let I=J.new2();if(v.from().image()==v.to().image()&&!(v.from().imageScaleMode()=="TILE"||v.to().imageScaleMode()=="TILE"))u=this._imageMaterial,v.colorAdjustIsActive()&&(u=this._imageColorAdjustMaterial,v.colorAdjustSetData(u)),I=this.allocateObjectSpaceToNormalizedImageSpaceTransform(v,n,p);else{u=this._lerpImageMaterial,v.colorAdjustIsActive()&&(u=this._lerpImageColorAdjustMaterial,v.colorAdjustSetData(u)),I=this.allocateObjectSpaceToNormalizedImageSpaceTransform(v.from(),n,p);let g=this.getImageToDraw(v.to(),n,e,T,v.to().imageScaleMode(),a);if(g==null)y=!1;else{let R=this._delegate.getOrCreateImageTexture(g),D=this.allocateObjectSpaceToNormalizedImageSpaceTransform(v.to(),n,p);Be.Material_setUniformMat32(u,this._materialStrings.GLSLX_NAME_U_PAINT_TRANSFORM1,D),R!=null&&R.setFormat(be.RGBA_NEAREST_CLAMP),u.setUniformSampler(this._materialStrings.GLSLX_NAME_TEXTURE1,R,1),u.setUniformFloat(this._materialStrings.GLSLX_NAME_U_PROGRESS,kt.double_clamp(v.t(),0,1))}}let C=this._delegate.getOrCreateImageTexture(A);y&&C!=null&&(C!=null&&C.setFormat(be.RGBA_NEAREST_CLAMP),this._setupRepeatingForImage(S,u),Be.Material_setUniformMat32(u,this._materialStrings.GLSLX_NAME_U_VERTEX_TRANSFORM,c),Be.Material_setUniformMat32(u,this._materialStrings.GLSLX_NAME_U_PAINT_TRANSFORM0,I),u.setUniformFloat(this._materialStrings.GLSLX_NAME_U_OPACITY,v.opacity()),u.setUniformSampler(this._materialStrings.GLSLX_NAME_TEXTURE0,C,0),this._delegate.drawToCurrentTile(1,u,this._quadArea,s,f),this._delegate.markDidDraw(),E=!0)}}else{let A=S.asSinglePaint(),I=null,C=!1;if(I=this.getOrCreateVideoTexture(A),I==null){let g=this.getImageToDraw(A,n,e,T,A.imageScaleMode(),a);g!=null&&(I=this._delegate.getOrCreateImageTexture(g),C=g.image.isCompressedTexture())}if(I!=null){u=this._imageMaterial,A.colorAdjustIsActive()&&(u=this._imageColorAdjustMaterial,A.colorAdjustSetData(u));let g=this.allocateObjectSpaceToNormalizedImageSpaceTransform(A,n,p);C||I.setFormat(be.RGBA_NEAREST_CLAMP),this._setupRepeatingForImage(S,u),Be.Material_setUniformMat32(u,this._materialStrings.GLSLX_NAME_U_VERTEX_TRANSFORM,c),Be.Material_setUniformMat32(u,this._materialStrings.GLSLX_NAME_U_PAINT_TRANSFORM0,g),u.setUniformFloat(this._materialStrings.GLSLX_NAME_U_OPACITY,A.opacity()),u.setUniformSampler(this._materialStrings.GLSLX_NAME_TEXTURE0,I,0),this._delegate.drawToCurrentTile(1,u,this._quadArea,s,f),this._delegate.markDidDraw(),E=!0}}m&&!E&&(n_(this._solidColorMaterial,this._materialStrings,c,O.TRANSPARENT,0),this._delegate.drawToCurrentTile(1,this._solidColorMaterial,this._quadArea,s,f),this._delegate.markDidDraw());break}case"EMOJI":{Oe("Emoji should always be rendered by renderGeometryDirectly");break}}}this._shouldFlushAfterStencilCover&&this._context.flush()}allocateObjectSpaceToNormalizedImageSpaceTransform(e,t,n){let o=e.allocateImageTransformForGeometrySize(t);return J.new2().multipliedBy1(o).multipliedBy1(n)}getImageToDraw(e,t,n,o,i,a){if(e.image()==null&&e.imageThumbnail()==null)return null;e.imageThumbnail()!=null&&this._delegate.getOrCreateImageTexture(new Qi(e.imageThumbnail(),1)),e.image()!=null&&e.image().isGIF()&&this._delegate.getOrCreateImageTexture(new Qi(e.image(),0));let s=e.decodedImageThumbnailIsReady()?e.decodedImageThumbnail():null,l=!1;if(e.imageThumbnail()==null)l=!0;else if(s!=null){let d=this.allocateObjectSpaceToNormalizedImageSpaceTransform(e,t,o),c=J.new3(d);c.invert();let p=J.new2().scaledBy2(a).multipliedBy1(n).multipliedBy1(c).scaledBy3(1/s.width(),1/s.height()),u=p.axisX().length(),_=p.axisY().length();l=Math.max(_,u)>1||e.image()!=null&&e.image().isGIF(),i=="TILE"&&(l=!0)}if(l&&(this._delegate.getOrCreateImageTexture(new Qi(e.image(),0)),e.decodedImageIsReady())){let d=e.decodedImage();if(d!=null)return new Qi(d,0)}if(s!=null)return new Qi(s,1);if(e.decodedImageIsReady()){let d=e.decodedImage();if(d!=null)return new Qi(d,0)}return null}getOrCreateVideoTexture(e){var t;return(t=e==null?void 0:e.video())==null?void 0:t.getOrCreateTexture(e,this._context,be.RGBA_NEAREST_CLAMP)}};a_._CACHED_SUPERSAMPLE_COUNT=null;var Vr=a_,i_;(t=>(t.ELLIPSE=0,t.ROUNDED_RECT=1))(i_||(i_={}));var l_=class{activate(e){this.reset(),this._isEnabled=!0,this._invalidateFn=e}deactivate(){this.isEnabled()&&(this._invalidateFn(),this.reset())}isEnabled(){return this._isEnabled}reset(){this._isPlaying=!1,this._isEnabled=!1,this._maxLayersToRender=1,this._totalLayersInRenderTree=0,this._framesUntilUpdate=this._frameDelay,this._filteredTree=null,this._invalidateFn=null,this._frameDelay=this._defaultFrameDelay}play(){this.isEnabled()&&(this._isPlaying=!0,this._invalidateFn())}pause(){this.isEnabled()&&(this._isPlaying=!1)}forward(){this.isEnabled()&&(this._maxLayersToRender=Math.min(this._maxLayersToRender+1,this._totalLayersInRenderTree),this._invalidateFn())}backward(){this.isEnabled()&&(this._maxLayersToRender=Math.max(this._maxLayersToRender-1,1),this._invalidateFn())}rewind(){this.isEnabled()&&(this._maxLayersToRender=1,this._invalidateFn())}increaseSpeed(){this.isEnabled()&&(this._frameDelay=Math.max(this._minFrameDelay,this._frameDelay-5))}decreaseSpeed(){this.isEnabled()&&(this._frameDelay=Math.min(this._maxFrameDelay,this._frameDelay+5))}finishLayerByLayerDrawToScreen(){this.isEnabled()&&this._isPlaying&&(this._maxLayersToRender>=this._totalLayersInRenderTree||(this._invalidateFn(),this._framesUntilUpdate=this._framesUntilUpdate-1,this._framesUntilUpdate<=0&&(this._maxLayersToRender=this._maxLayersToRender+1,this._framesUntilUpdate=this._frameDelay)))}_filterCompositeTileGridNodes(e){switch(e.op()){case 0:{let t=e;return new qa(this._filterCompositeTileGridNodes(t.child),t.flags)}case 2:{let t=e;return new _i(this._filterCompositeTileGridNodes(t.child))}case 1:{let t=e,n=[];for(let o=0,i=t.children.length;o<i;o=o+1){let a=this._filterCompositeTileGridNodes(t.children[o]);n.push(a)}return new ke(n,t.isFirstChildSolidBackground())}case 3:case 4:return e;case 5:{let t=e,n=this._filterCompositeTileGridNodes(t.alpha),o=this._filterCompositeTileGridNodes(t.color);return new In(n,o,t.type,t.innerShadowFill,t.innerShadowAlphaRequiresHardMask)}case 6:{let t=e;return new oo(t.blurOpType,t.startRadius,t.endRadius,t.startPoint,t.endPoint,this._filterCompositeTileGridNodes(t.child),t.clamp)}case 7:{let t=e;return new io(t.blendMode,t.opacity,this._filterCompositeTileGridNodes(t.child))}case 9:{let t=e;return new To(this._filterCompositeTileGridNodes(t.alpha),t.color)}case 8:{let t=e;return this._filterCompositeTileGridNodes(t.tree)}case 10:{let t=e;return new rt(this._filterCompositeTileGridNodes(t.child),t.id,t.property,t.getter)}case 11:{let t=e;return new Eo(this._filterCompositeTileGridNodes(t.child),t.transform)}case 12:{let t=e,n=this._filterCompositeTileGridNodes(t.startChild),o=this._filterCompositeTileGridNodes(t.endChild);return new cn(n,o,t.id,t.progressFn)}default:throw new Error(`Unhandled node op ${En[e.op()]}`)}return null}_renderTreeWithNLayers(e,t){let n=(a,s)=>new Un(a,s);if(t<=0)return n(null,0);let o=[];switch(e.op()){case 0:{let a=e;o.push(a.child);break}case 2:{let a=e;o.push(a.child);break}case 1:{let a=e;for(let s=0,l=a.children.length;s<l;s=s+1){let d=a.children[s];o.push(d)}break}case 3:case 4:return n(e,t-1);case 5:{let a=e;o.push(a.color),o.push(a.alpha);break}case 6:{let a=e;o.push(a.child);break}case 7:{let a=e;o.push(a.child);break}case 9:{let a=e;o.push(a.alpha);break}case 8:{let a=e;o.push(a.tree);break}case 10:{let a=e;o.push(a.child);break}case 11:{let a=e;o.push(a.child);break}case 12:{let a=e;o.push(a.startChild),o.push(a.endChild);break}default:throw new Error(`Unhandled node op ${En[e.op()]}`)}let i=[];for(let a=0,s=o.length;a<s;a=a+1){let l=o[a],d=this._renderTreeWithNLayers(l,t);if(t=d.b,i.push(d.a),t<=0)return n(new ke(i).optimized(),0)}return this._isRenderableLayer(e)?t>0?n(e,t-1):n(new ke(i).optimized(),0):n(e,t)}_isRenderableLayer(e){switch(e.op()){case 8:case 1:case 0:return!1}return!0}_countLayers(e){let t=0;switch(e.op()){case 0:{let n=e;t=t+this._countLayers(n.child);break}case 2:{let n=e;t=t+this._countLayers(n.child);break}case 1:{let n=e;for(let o=0,i=n.children.length;o<i;o=o+1){let a=n.children[o];t=t+this._countLayers(a)}break}case 3:case 4:break;case 5:{let n=e;t=t+this._countLayers(n.alpha),t=t+this._countLayers(n.color);break}case 6:{let n=e;t=t+this._countLayers(n.child);break}case 7:{let n=e;t=t+this._countLayers(n.child);break}case 9:{let n=e;t=t+this._countLayers(n.alpha);break}case 8:{let n=e;t=t+this._countLayers(n.tree);break}case 10:{let n=e;t=t+this._countLayers(n.child);break}case 11:{let n=e;t=t+this._countLayers(n.child);break}case 12:{let n=e;t=t+this._countLayers(n.startChild),t=t+this._countLayers(n.endChild);break}default:throw new Error(`Unhandled node op ${En[e.op()]}`)}return this._isRenderableLayer(e)&&(t=t+1),t}treeToRender(e){if(!this.isEnabled())return e;e!=this._originalTree&&(this._totalLayersInRenderTree=this._countLayers(e),this._filteredTree=this._filterCompositeTileGridNodes(e),this._originalTree=e);let t=this._renderTreeWithNLayers(this._filteredTree,this._maxLayersToRender).a;return t!=this._lastTreeToRender&&console.log(`LayerByLayerRendering: rendering ${this._maxLayersToRender} instructions out of ${this._totalLayersInRenderTree}
`+t.debugString1()),this._lastTreeToRender=t,t}constructor(){this._isEnabled=!1,this._maxLayersToRender=1,this._totalLayersInRenderTree=0,this._maxFrameDelay=60,this._defaultFrameDelay=45,this._minFrameDelay=5,this._frameDelay=60,this._framesUntilUpdate=0,this._filteredTree=null,this._originalTree=null,this._invalidateFn=null,this._isPlaying=!1,this._lastTreeToRender=null}};var s_=(n=>(n[n.FULL_SIZE=0]="FULL_SIZE",n[n.THUMBNAIL=1]="THUMBNAIL",n[n.EMOJI=2]="EMOJI",n))(s_||{}),Qi=class{hash(){return`${this.image.objectHash()}:${s_[this.purpose]}`}constructor(e,t){this.image=e,this.purpose=t}};var Od;(o=>{function r(){return new Map}o._new=r;function e(i,a){i.set(a.hash(),a)}o.add=e;function t(i){let a=i;return Array.from(a.values())}o.asList=t;function n(i,a){let s=a,l=i;Ge.StringMap_each(s,(d,c)=>{l.set(d,c)})}o.addAllImagesInSet=n})(Od||(Od={}));var c_=class{constructor(e,t,n){this.includesBackgroundColor=e,this.status=t,this.neededImagesOrNull=n}};function Hf(){return Vr.SSAA_SIZE()}var Qs=class r{constructor(e,t){this._frameBudgetInformation=null;this._interruptedCommands=new Array;this._interruptArgs=null;this._currentlyInDissolveCounter=0;this._currentlyInVolatilePropertyCounter=0;this._canvas=null,this._backgroundEnabled=!0,this._didDraw=!1,this._includesBackgroundColor=!1,this._boundsCache=null,this._canvasSpaceTileBounds=null,this._neededImagesOrNull=null,this._ssaaState=new Vf,this._downsampleNeedsBlend=!1,this._shouldDisableAllAntialiasing=!1,this._requestImage=null,this._layerByLayerRendering=new l_,this._context=e,this._bufferPool=t,this._materialStrings=Pr.instance(),this._quadArea=this._bufferPool.allocateSmallManagedArea(Le.getPositionF2CoordF3(),new Uint8Array(new Float32Array([0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,1,1,0,0,0]).buffer)),this._transparentClearTexture=e.createTextureWithPixels(be.RGBA_LINEAR_CLAMP,1,1,new Uint8Array([0,0,0,0]),yr.SINGLE_PIXEL_TEXTURE),this._tileStack=new r.TileStack(e,this._transparentClearTexture),this._pathRasterizer=new Vr(this,this._context,this._bufferPool);let n=this._context.graphicsCardName();ye.setFlushBeforeMasks(n.indexOf("NVIDIA")!=-1&&n.indexOf("Direct3D11")!=-1||Y.getFeatureFlags().flush_before_masks),this._clampedBlurMaterial=this._context.createMaterial("clampedBlur",Le.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_TILE_VERTEX,this._materialStrings.GLSLX_SOURCE_CLAMPED_BLUR_TILE_FRAGMENT),this._unclampedBlurMaterial=this._context.createMaterial("unclampedBlur",Le.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_TILE_VERTEX,this._materialStrings.GLSLX_SOURCE_UNCLAMPED_BLUR_TILE_FRAGMENT),this._rectangleBlurMaterial=this._context.createMaterial("rectangleBlur",Le.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_RECTANGLE_BLUR_VERTEX,this._materialStrings.GLSLX_SOURCE_RECTANGLE_BLUR_FRAGMENT),this._roundedRectangleBlurMaterial=this._context.createMaterial("roundedRectangleBlur",Le.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_ROUNDED_RECTANGLE_BLUR_VERTEX,this._materialStrings.GLSLX_SOURCE_ROUNDED_RECTANGLE_BLUR_FRAGMENT),this._upscaleTileMaterial=this._context.createMaterial("upscaleTile",Le.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_UPSAMPLE_TILE_VERTEX,this._materialStrings.GLSLX_SOURCE_UPSAMPLE_TILE_FRAGMENT),this._downscaleTileMaterial=this._context.createMaterial("downscaleTile",Le.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_DOWNSAMPLE_TILE_VERTEX,this._materialStrings.GLSLX_SOURCE_DOWNSAMPLE_TILE_FRAGMENT),this._hardMaskWithColorAndDownscaleTileMaterial=this._context.createMaterial("hardMaskWithColorAndDownscaleTile",Le.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_DOWNSAMPLE_TILE_VERTEX,this._materialStrings.GLSLX_SOURCE_HARD_MASK_WITH_COLOR_AND_DOWNSAMPLE_TILE_FRAGMENT),this._blendTextureMaterial=this._context.createMaterial("blendTexture",Le.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_CLIP_SPACE_QUAD_VERTEX,this._materialStrings.GLSLX_SOURCE_BLEND_TEXTURE_FRAGMENT),this._lerpTileMaterial=this._context.createMaterial("lerpTexture",Le.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_CLIP_SPACE_QUAD_VERTEX,this._materialStrings.GLSLX_SOURCE_LERP_TILE_FRAGMENT),this._blendTileSimpleMaterial=this._context.createMaterial("blendTileSimple",Le.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_TILE_VERTEX,this._materialStrings.GLSLX_SOURCE_BLEND_TEXTURE_FRAGMENT),this._blendTileCustomMaterial=this._context.createMaterial("blendTileCustom",Le.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_TILE_VERTEX,this._materialStrings.GLSLX_SOURCE_BLEND_MODE_FRAGMENT),this._maskInnerShadowTileMaterial=this._context.createMaterial("maskInnerShadowTile",Le.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_TILE_VERTEX,this._materialStrings.GLSLX_SOURCE_MASK_INNER_SHADOW_TILE_FRAGMENT),this._maskInnerShadowTileAndFirstHardMaskAlpha=this._context.createMaterial("maskInnerShadowTileAndFirstHardMaskAlpha",Le.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_TILE_VERTEX,this._materialStrings.GLSLX_SOURCE_MASK_INNER_SHADOW_TILE_AND_FIRST_HARD_MASK_ALPHA_FRAGMENT),this._maskBackgroundBlurTileMaterial=this._context.createMaterial("maskBackgroundBlurTile",Le.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_TILE_VERTEX,this._materialStrings.GLSLX_SOURCE_MASK_BACKGROUND_BLUR_TILE_FRAGMENT),this._maskTileMaterial=this._context.createMaterial("maskTile",Le.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_TILE_VERTEX,this._materialStrings.GLSLX_SOURCE_MASK_TILE_FRAGMENT),this._maskTileLuminanceMaterial=this._context.createMaterial("maskTileLuminance",Le.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_TILE_VERTEX,this._materialStrings.GLSLX_SOURCE_MASK_TILE_LUMINANCE_FRAGMENT),this._maskTileLuminancePassThroughMaterial=this._context.createMaterial("maskTileLuminancePassThrough",Le.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_TILE_VERTEX,this._materialStrings.GLSLX_SOURCE_MASK_TILE_LUMINANCE_PASS_THROUGH_FRAGMENT),this._maskTilePassThroughMaterial=this._context.createMaterial("maskTilePassThrough",Le.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_TILE_VERTEX,this._materialStrings.GLSLX_SOURCE_MASK_TILE_PASS_THROUGH_FRAGMENT),this._maskKnockoutShadowTileMaterial=this._context.createMaterial("maskKnockoutShadowTile",Le.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_TILE_VERTEX,this._materialStrings.GLSLX_SOURCE_MASK_KNOCKOUT_SHADOW_TILE_FRAGMENT),this._maskKnockoutShadowTilePassThroughMaterial=this._context.createMaterial("maskKnockoutShadowTile",Le.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_TILE_VERTEX,this._materialStrings.GLSLX_SOURCE_MASK_KNOCKOUT_SHADOW_TILE_PASS_THROUGH_FRAGMENT),this._hardMaskTileWithColorMaterial=this._context.createMaterial("hardMaskWithColor",Le.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_TILE_VERTEX,this._materialStrings.GLSLX_SOURCE_HARD_MASK_TILE_WITH_COLOR_FRAGMENT),this._drawTextureMaterial=this._context.createMaterial("drawTexture",Le.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_DRAW_TEXTURE_VERTEX,this._materialStrings.GLSLX_SOURCE_DRAW_TEXTURE_FRAGMENT),this._superSSAA4x4DownsampleMaterial=this._context.createMaterial("superSSAA4x4Downsample",Le.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_CLIP_SPACE_QUAD_VERTEX,this._materialStrings.GLSLX_SOURCE_SUPER_SSAA4X4_DOWNSAMPLE_TEXTURE_FRAGMENT)}context(){return this._context}bufferPool(){return this._bufferPool}totalVRAM(){let e=0;return e=e+this._pathRasterizer.totalVRAM(),e=e+this._tileStack.totalVRAM(),e}upscaleRectForSSAA(e){let t=Vr.SSAA_SIZE()/tr.TILE_SIZE|0;return e.scaledBy1(t)}downscaleRectForSSAA(e){let t=tr.TILE_SIZE/Vr.SSAA_SIZE();return e.scaledBy1(t)}setBackgroundEnabled(e){this._backgroundEnabled=e}currentTextureSize(){return this._currentTile1().tileSize()}markDidDraw(){this._didDraw=!0}pushSSAARenderState(e){if(this._shouldDisableAllAntialiasing){Oe("Pushing SSAA state during final composite");return}if(this._ssaaState.level==0){this._tileStack.setSSAARenderState(),this._ssaaState.mode=e==null?0:1;let t=null;this._tileStack.isEmpty()||(t=this.upscaleRectForSSAA(Cr.last(this._currentTile1().scissors()).clone())),e!=null&&this._needsBackgroundColor(e)?(this.duplicateTile1(t),this._downsampleNeedsBlend=!0):(this._downsampleNeedsBlend=!1,this._tileStack.pushTile(t))}this._ssaaState!=null&&(this._ssaaState.level+=1)}popSSAARenderState(){if(this._shouldDisableAllAntialiasing){Oe("Popping SSAA state during final composite");return}if(this._ssaaState!=null&&(this._ssaaState.level-=1),this._ssaaState.level==0){let e=this._tileStack.popTile();this._tileStack.unsetSSAARenderState();let t;this._downsampleNeedsBlend?t=It.COPY:t=It.PREMULTIPLIED,this.downsampleSuperSSAATile(e,t),this._tileStack.freeTileToPool(e)}}supersampleState(){return this._ssaaState}currentTile(){return this._currentTile1()}computeTileTransform(){return J.new2().scaledBy2(1/this._canvasSpaceTileBounds.size().x()).translatedBy1(new b(-this._canvasSpaceTileBounds.x(),-this._canvasSpaceTileBounds.y()))}canvasSpaceToViewSpaceScale(){return this._tileSize/this._canvasSpaceTileBounds.size().x()}drawTileContinued(e,t,n,o,i,a,s){return Ae.perfTimerScope("tile-render-continued-viewer",Ae.ProfileLevel.LOW,()=>{this._canvasSpaceTileBounds=new G(t,n,o,o),this._boundsCache=a.boundsCache;let l=this.computeTileTransform(),d=new d_(a.renderTree,l,this._interruptArgs.framebuffer,this._interruptArgs.originalOutputTextureFormat);if(!d.equals(this._interruptArgs)||this._interruptedCommands.length==0)return Oe("Clearing interrupt state, prototype in potentially precarious state."),null;this._interruptArgs.framebuffer.colorTexture().format()!=be.RGBA_LINEAR_CLAMP&&this._interruptArgs.framebuffer.colorTexture().setFormat(be.RGBA_LINEAR_CLAMP);let p=this._interruptedCommands;return this._interruptedCommands=new Array,this._frameBudgetInformation=s,p.forEach(_=>{if(this._interruptedCommands.length>0)this._interruptedCommands.push(_);else switch(_.type){case 1:let h=_;this.visitWithCanvasSpaceTileBounds(h.node,h.transform,h.canvasSpaceTilebounds,h.inverseVolatileTransform,h.interruptIndex);break;case 2:let S=_;this._tileStack.popScissorFromCurrentTile(),this._tileStack.pushScissor(S.scissor);break;case 3:let m=_;this.visitGroupChildWithSSAA(m.node,m.transform,m.canvasSpaceTileBounds,m.inverseVolatileTransform);break;case 4:let f=_;this.renderBlend(f.blendIsNoOp,f.node,f.transform,f.canvasSpaceTileBounds,f.inverseVolatileTransform,1);break;default:}}),this._interruptedCommands.length>0?this._interruptArgs=d:this._tileStack.popScissorFromCurrentTile(),this._interruptedCommands.length==0&&this._interruptArgs.originalOutputTextureFormat!=be.RGBA_LINEAR_CLAMP&&this._interruptArgs.framebuffer.colorTexture().setFormat(this._interruptArgs.originalOutputTextureFormat),this.drawTileFinish(d,e,this._interruptArgs.framebuffer)})}cleanUpExistingInterrupt(){for(this._context.getGpuMetricsCollection().getCurrentFrameGPUMetrics()._bgtClearedExistingInterrupt=!0,this._interruptArgs.originalOutputTextureFormat!=be.RGBA_LINEAR_CLAMP&&this._interruptArgs.framebuffer.colorTexture().setFormat(this._interruptArgs.originalOutputTextureFormat),this._interruptedCommands=new Array,this._interruptArgs=null,this._frameBudgetInformation=null,this._cleanUpInterruptCallback=null,this._currentlyInDissolveCounter=0,this._currentlyInVolatilePropertyCounter=0;this._tileStack.count()>0;)if(this._tileStack.count()==1&&!this._tileStack.last().isBackedBySingleTileTexture()){this._tileStack.popScissorFromCurrentTile(),this._includesBackgroundColor&&!this._didDraw&&(this._tileStack.last().clearToColor(O.TRANSPARENT),this._includesBackgroundColor=!1),this._currentTile1().needsColorClear()&&this._currentTile1().doDeferredClear(1);let e=this._tileStack.popTile();this._tileStack.assertPoolAfterRender()}else this._tileStack.freeTileToPool(this._tileStack.popTile())}drawTile(e,t,n,o,i,a,s,l){return this._context.annotateAndReturn(`Draw tile (${t}, ${n})`,()=>{this._interruptArgs!=null&&this._cleanUpInterruptCallback!=null&&this._cleanUpInterruptCallback();let d=i.colorTexture().format();a.useLargeTilesForDrawToScreen&&this._tileStack.setDrawToScreenLargeTileState(),a.shouldDisableAllAntialiasing,d!=be.RGBA_LINEAR_CLAMP&&i.colorTexture().setFormat(be.RGBA_LINEAR_CLAMP),this._requestImage=a.requestImage,this._boundsCache=a.boundsCache,this._canvasSpaceTileBounds=new G(t,n,o,o),this._tileSize=a.useLargeTilesForDrawToScreen?Vr.SSAA_SIZE():tr.TILE_SIZE,this._shouldDisableAllAntialiasing=a.shouldDisableAllAntialiasing,this._neededImagesOrNull=a.shouldCollectNeededImages?Od._new():null;let c=this.computeTileTransform(),p=a.renderTree;this._frameBudgetInformation=s;let u=new d_(p,c,i,d);if(this._didDraw=!1,this._includesBackgroundColor=!1,this._includesBackgroundColor=p!=null&&this.nodeNeedsBackgroundColor(p,c),this._includesBackgroundColor){let h=O.premultiplied(O.TRANSPARENT);this._tileStack.pushTileBackedByExistingFramebufferAndClearToColor(i,e,a,h)}else this._tileStack.pushTileBackedByExistingFramebuffer(i,e,a);if(p!=null){let h=this.allocateAndComputeTileScissor(c,this.bounds(p));this._tileStack.last().pushScissorRect(h);let S=J.new2();this.visit(p,J.new3(c),S,0),this._interruptedCommands.length==0&&this._tileStack.popScissorFromCurrentTile()}this._interruptedCommands.length>0&&(this._interruptArgs=u,this._cleanUpInterruptCallback=l);let _=this.drawTileFinish(u,e,i);return this._interruptedCommands.length==0&&d!=be.RGBA_LINEAR_CLAMP&&i.colorTexture().setFormat(d),a.useLargeTilesForDrawToScreen&&this._tileStack.unsetDrawToScreenLargeTileState(),_})}setCanvas(e){this._canvas!=e&&(this._canvas=e,this._pathRasterizer.clearGradientCache())}drawToCurrentTile(e,t,n,o,i){n instanceof Rs&&(n=n.bufferArea());let a=this._currentTile1().needsColorClear(),s=(i==null?void 0:i.isEnabled)&&this._currentTile1().needsDepthStencilClear();if(a||s){let l=a&&s?0:a?1:2;this._currentTile1().doDeferredClear(l)}this._context.draw(e,t,n,o,i,this._currentTile1().framebuffer(),this._currentTile1().activeScissorRelativeToFramebuffer(),this._currentTile1().viewport()),this._currentTile1().setIsColorClear(!1)}_currentTile1(){return this._tileStack.last()}_currentTile2(e){return this._tileStack.get(this._tileStack.count()-e-1)}_needsBackgroundColor(e){return e.hasNonIsolatedBlends()||e.hasBackgroundBlurs()}bounds(e){return e.currentBounds(this._boundsCache)}nodeNeedsBackgroundColor(e,t){let n=G.new3(this.bounds(e));t.transformRect(n);let o=G.UNIT.overlaps(n);if(e==null||!this._needsBackgroundColor(e)||!o)return!1;if(e.op()==1){let i=e;for(let a of i.children){let s=G.new3(this.bounds(a)),l=G.UNIT.overlaps(t.transformRect(s));if(this._needsBackgroundColor(a)&&l)return!0}return!1}return!0}drawTileFinish(e,t,n){if(this._interruptedCommands.length==0){this._includesBackgroundColor&&!this._didDraw&&(this._tileStack.last().clearToColor(O.TRANSPARENT),this._includesBackgroundColor=!1),this._currentTile1().needsColorClear()&&this._currentTile1().doDeferredClear(1);let o=this._tileStack.popTile();this._interruptArgs=null,this._cleanUpInterruptCallback=null,this._tileStack.assertPoolAfterRender()}return this._frameBudgetInformation=null,new c_(this._includesBackgroundColor,this._interruptedCommands.length>0?1:0,this._neededImagesOrNull)}visit(e,t,n,o){let i=G.new3(G.UNIT),a=J.new3(t);a.invert();let s=a.transformRect(i);this.visitWithCanvasSpaceTileBounds(e,t,s,n,o)}visitWithCanvasSpaceTileBounds(e,t,n,o,i){this._context.annotateProfile(e.opProfileString(),()=>{this._visitWithCanvasSpaceTileBounds(e,t,n,o,i)})}_visitWithCanvasSpaceTileBounds(e,t,n,o,i){var a;if(n.overlaps(this.bounds(e))&&!Cr.isEmpty(this._currentTile1().scissors())){if(this._frameBudgetInformation){if(this._interruptedCommands.length>0){this._interruptedCommands.push(new Yi(e,t,n,o,i));return}else if(!this._frameBudgetInformation.permitsMoreWork()){yi.didEncounterIntraTileInterrupt();let s=this._ssaaState.level!=0||this._pathRasterizer.currentBatchAA()!=null&&this._pathRasterizer.currentBatchAA().value==2,l=this._currentlyInDissolveCounter>0;if(!(this._currentlyInVolatilePropertyCounter>0)&&!l&&!s){this._interruptedCommands.push(new Yi(e,t,n,o,i));return}}}switch(e.op()){case 0:{let s=e;this.visitWithCanvasSpaceTileBounds(s.child,t,n,o,0);break}case 2:{let s=e;this._shouldDisableAllAntialiasing?this.visitWithCanvasSpaceTileBounds(s.child,t,n,o,0):(this.pushSSAARenderState(s.child),this.visitWithCanvasSpaceTileBounds(s.child,t,n,o,0),this.popSSAARenderState());break}case 1:{let s=e;this.visitGroupHelper(s,t,n,o,i);break}case 3:{let s=e,l=this._shouldDisableAllAntialiasing?0:s.desiredAntialiasing();this._pathRasterizer.beginBatch(l),this._pathRasterizer.renderFill(t,s),this._pathRasterizer.finishBatch();break}case 4:{let s=e,l=this._shouldDisableAllAntialiasing?0:s.desiredAntialiasing();this._pathRasterizer.beginBatch(l),this._pathRasterizer.renderFillStroke(t,s),this._pathRasterizer.finishBatch();break}case 5:{let s=e,l=(s.type==0||s.type==4||s.type==1)&&s.hasNonIsolatedBlends(),d=this.allocateAndComputeTileScissor(t,this.bounds(s.color)),c=s.type==0&&!s.hasNonIsolatedBlends()&&s.alpha.isAxisAlignedRectFill()&&s.alpha.op()==3&&Se.containsAtLeastOneVisibleOpaquePaint(s.alpha.geometry.paints),p=c?s.alpha.geometryBounds():this.bounds(s.alpha),u=s.type==2||Al&&s.type==3?this.allocateAndComputeTileScissor(t,p):s.type==4?d:this.allocateAndComputeTileScissor(t,p).intersectedWith(d);if(c){let m=this._tileStack.takeScissorFromCurrentTile();if(u.intersectWith(m),this._tileStack.pushScissor(u),this.visitWithCanvasSpaceTileBounds(s.color,t,n,o,0),this._interruptedCommands.length>0){this._interruptedCommands.push(new t_(m.clone()));return}else{this._tileStack.popScissorFromCurrentTile(),this._tileStack.pushScissor(m);return}}let _=G.new3(Cr.last(this._currentTile1().scissors())).intersectedWith(u);if(i<1){if(_.isEmpty())return;if(l?(this.duplicateTile1(_),this.duplicateTile1(_)):s.type==3?this._tileStack.pushTileAndClearToColor(O.premultiplied(this._canvas.computedBackgroundColor()),_):this._tileStack.pushTile(_),this.visitWithCanvasSpaceTileBounds(s.color,t,n,o,0),this._interruptedCommands.length>0){this._interruptedCommands.push(new Yi(e,t,n,o,1));return}}if(i<2&&(this._tileStack.pushTile(_),this.visitWithCanvasSpaceTileBounds(s.alpha,t,n,o,0),this._interruptedCommands.length>0)){this._interruptedCommands.push(new Yi(e,t,n,o,2));return}let h=this._tileStack.popTile(),S=this._tileStack.popTile();switch(s.type){case 0:{if(l){let m=this._tileStack.popTile();this.maskTilePassThrough(m,h,S,_),this._tileStack.freeTileToPool(m)}else this.maskTile(h,S,_);break}case 1:{if(l){let m=this._tileStack.popTile();this.maskTileLuminancePassThrough(m,h,S,_),this._tileStack.freeTileToPool(m)}else this.maskTileLuminance(h,S,_);break}case 4:{if(l){let m=this._tileStack.popTile();this.maskKnockoutShadowTilePassThrough(m,h,S,_),this._tileStack.freeTileToPool(m)}else this.maskKnockoutShadowTile(h,S,_);break}case 3:{this.maskBackgroundBlurTile(h,S,_);break}case 2:{this.maskInnerShadowTile(h,S,_,s.innerShadowFill,s.innerShadowAlphaRequiresHardMask);break}}this._tileStack.freeTileToPool(h),this._tileStack.freeTileToPool(S);break}case 9:{let s=e,l=this.allocateAndComputeTileScissor(t,this.bounds(s.alpha)),d=G.new3(Cr.last(this._currentTile1().scissors())).intersectedWith(l);if(d.isEmpty())return;if(i<1&&(this._tileStack.pushTile(d),this.visitWithCanvasSpaceTileBounds(s.alpha,t,n,o,0),this._interruptedCommands.length>0)){this._interruptedCommands.push(new Yi(e,t,n,o,1));return}let c=this._tileStack.popTile();this.hardMaskTileWithColor(c,s.color,d),this._tileStack.freeTileToPool(c);break}case 6:{let s=e,l=G.new3(this.bounds(s));t.transformRect(l),l.scaledBy1(this.currentTextureSize());let d=s.endRadius*t.scale1().maxComponent(),c=G.new3(Cr.last(this._currentTile1().scissors())).intersectedWith(l);if(c.isEmpty())return;if(d<1/this.currentTextureSize()){this.visitWithCanvasSpaceTileBounds(s.child,t,n,o,0);return}let p=Rv(s.child),u=p.a,_=p.b??yt.FrozenAffineTransform_IDENTITY,h=u.isRectFill()?u:null;if(h!=null&&s.clamp.isInvalid()){let m=Se.onlySolidPaintOrNull(h.geometry.paints);if(m!=null){let f=J.new2().translatedBy2(-1,-1).scaledBy2(2).multipliedBy1(t).multipliedBy1(_).multipliedBy1(h.transform);this.renderBlurredRectangle(f,h.geometry.path().bounds(),O.multiplyOpacity(m.color(),m.opacity()),s.endRadius);return}}let S=u.isRoundedRectFill()?u:null;if(S!=null&&s.clamp.isInvalid()){let m=S.geometry.path().path(),f=m.radii();if(f.isUniform()){let T=Se.onlySolidPaintOrNull(S.geometry.paints);if(T!=null){let y=f.topLeft,E=J.new2().translatedBy2(-1,-1).scaledBy2(2).multipliedBy1(t).multipliedBy1(_).multipliedBy1(S.transform);this.renderBlurredRoundedRectangle(E,m.bounds(),y,O.multiplyOpacity(T.color(),T.opacity()),s.endRadius);return}}}this.renderBlur(e,t,d,c,o,s.clamp,n,i);break}case 7:{let s=e,l=HF(s.blendMode)&&(this._currentTile1().isColorClear()||this._currentTile1().needsColorClear())&&s.opacity==1;this.renderBlend(l,s,t,n,o,0);break}case 8:{let s=e;this.visitCompositeChildWithOpacity(s,1,t,n);break}case 10:{this._currentlyInVolatilePropertyCounter++;let s=e;switch(s.property){case 2:{let l=J.new3(t);l.multipliedBy1(s.transform());let d=J.new3(s.transform());d.invert()||d.copyFrom(yt.FrozenAffineTransform_IDENTITY),d.multipliedBy1(o),this.visit(s.child,l,d,0);break}case 1:{let l=J.new2();this.visitWithCanvasSpaceTileBounds(s.child,t,n,l,0);break}case 0:{let l=J.new2(),d=J.new2();l.copyFrom(t).multipliedBy1(o),this.visit(s.child,l,d,0);break}case 4:{let l=s.opacity(),d=!1;if(l==1)this.visitWithCanvasSpaceTileBounds(s.child,t,n,o,0),d=!0;else if(l==0)d=!0;else if(s.child.op()==3){let c=s.child,p=(a=Se.onlyPaintOrNull(c.geometry.paints))==null?void 0:a.asSinglePaint();if(p!=null){let u=p.cloneAsSinglePaint();u.setOpacity(u.opacity()*l),this.visitWithCanvasSpaceTileBounds(c.withPaints([u]),t,n,o,0),d=!0}}else if(s.child.op()==8){let c=s.child;this.visitCompositeChildWithOpacity(c,l,t,n),d=!0}if(!d){let c=this.allocateAndComputeTileScissor(t,this.bounds(s.child)),p=G.new3(Cr.last(this._currentTile1().scissors())).intersectedWith(c);s.child.hasNonIsolatedBlends()?this.duplicateTile1(p):this._tileStack.pushTile(p),this.visitWithCanvasSpaceTileBounds(s.child,t,n,o,0),s.child.hasNonIsolatedBlends()?this.blendAndPopTile("PASS_THROUGH",l):this.blendAndPopTile("NORMAL",l)}break}case 3:{this.visitWithCanvasSpaceTileBounds(s.child,t,n,o,0);break}case 5:{this.visitWithCanvasSpaceTileBounds(s.child,t,n,o,0);break}default:throw new Error(`Unhandled VolatileProperty value ${Za.VolatileProperty_toString(s.property)}`)}this._currentlyInVolatilePropertyCounter--;break}case 11:{let s=e,l=J.new3(t);l.multipliedBy1(s.transform);let d=J.new3(s.transform);d.invert()||d.copyFrom(yt.FrozenAffineTransform_IDENTITY),d.multipliedBy1(o),this.visit(s.child,l,d,0);break}case 12:{this._currentlyInDissolveCounter++;let s=e,l=this.allocateAndComputeTileScissor(t,this.bounds(s.startChild)),d=this.allocateAndComputeTileScissor(t,this.bounds(s.endChild)),c=G.new2();c.copyFrom(Cr.last(this._currentTile1().scissors())).intersectedWith(l);let p=c.clone().scaledBy1(1/this.currentTextureSize());s.startChild.hasNonIsolatedBlends()?this.duplicateTile1(c):this._tileStack.pushTile(c),this.visitWithCanvasSpaceTileBounds(s.startChild,t,n,o,0);let u=this._tileStack.popTile();c.copyFrom(Cr.last(this._currentTile1().scissors())).intersectedWith(d);let _=c.clone().scaledBy1(1/this.currentTextureSize());s.endChild.hasNonIsolatedBlends()?this.duplicateTile1(c):this._tileStack.pushTile(c),this.visitWithCanvasSpaceTileBounds(s.endChild,t,n,o,0);let h=this._tileStack.popTile();this._lerpTileMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_TEXTURE0,u.colorTextureForSampling(),0),this._lerpTileMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_TEXTURE1,h.colorTextureForSampling(),1),Be.Material_setUniformVec43(this._lerpTileMaterial,this._materialStrings.GLSLX_NAME_TEXTURE0_UV_SPACE_SCISSOR,p),Be.Material_setUniformVec43(this._lerpTileMaterial,this._materialStrings.GLSLX_NAME_TEXTURE1_UV_SPACE_SCISSOR,_),this._lerpTileMaterial.setUniformFloat(this._materialStrings.GLSLX_NAME_U_OPACITY,kt.double_clamp(s.progress(),0,1));let S=this.allocateAndComputeTileScissor(t,this.bounds(e));this._tileStack.pushScissor(S),this.drawToCurrentTile(1,this._lerpTileMaterial,this._quadArea,It.PREMULTIPLIED),this._tileStack.popScissorFromCurrentTile(),this._tileStack.freeTileToPool(h),this._tileStack.freeTileToPool(u),this._currentlyInDissolveCounter--;break}}}}visitCompositeChildWithOpacity(e,t,n,o){let i=J.new2().translatedBy2(-1,-1).scaledBy2(2).multipliedBy1(n),a=this.allocateAndComputeTileScissor(n,this.bounds(e));this._tileStack.pushScissor(a),e.forEachTileWithinBounds(1,o,s=>{let l=s.textureRegionOrNull();if(l!=null&&(this.drawTextureRegion2(l,s.canvasSpaceBounds(),i,1,t),s.neededImagesOrNull!=null)){let d=Od.asList(s.neededImagesOrNull);for(let c of d)this.getOrCreateImageTexture(c)}}),this._tileStack.popScissorFromCurrentTile()}visitGroupHelper(e,t,n,o,i){if(i<1)for(let a of e.children)this.visitGroupChildWithSSAA(a,t,n,o);if(this._interruptedCommands.length>0){this._interruptedCommands.push(new Yi(e,t,n,o,1));return}this._pathRasterizer.currentBatchAA()!=null&&this._pathRasterizer.finishBatch()}visitGroupChildWithSSAA(e,t,n,o){let i=this._pathRasterizer.currentBatchAA()!=null&&this._pathRasterizer.currentBatchAA().value==2,a=e.desiredAntialiasing()==2&&!this._shouldDisableAllAntialiasing;if(this._interruptedCommands.length>0){this._interruptedCommands.push(new e_(e,t,n,o));return}Cr.last(this._currentTile1().scissors()).overlaps(this.allocateAndComputeTileScissor(t,this.bounds(e)))&&(a&&!i?this._pathRasterizer.beginBatch(2):!a&&i&&this._pathRasterizer.finishBatch(),a?e.op()==3?this._pathRasterizer.renderFill(t,e):e.op()==4&&this._pathRasterizer.renderFillStroke(t,e):this.visitWithCanvasSpaceTileBounds(e,t,n,o,0))}allocateAndComputeTileScissor(e,t){let n=G.new3(t);e.transformRect(n);let o=n.scaledBy1(this.currentTextureSize());return o.round(),o}renderBlurredRectangle(e,t,n,o){O.alpha(n)!=0&&(Be.Material_setUniformMat32(this._rectangleBlurMaterial,this._materialStrings.GLSLX_NAME_U_VERTEX_TRANSFORM,e),Be.Material_setUniformVec42(this._rectangleBlurMaterial,this._materialStrings.GLSLX_NAME_U_COLOR,O.premultiplied(n)),Be.Material_setUniformVec43(this._rectangleBlurMaterial,this._materialStrings.GLSLX_NAME_U_QUAD,t),this._rectangleBlurMaterial.setUniformFloat(this._materialStrings.GLSLX_NAME_U_BLUR_RADIUS,o),this.drawToCurrentTile(1,this._rectangleBlurMaterial,this._quadArea,It.PREMULTIPLIED),this._didDraw=!0)}renderBlurredRoundedRectangle(e,t,n,o,i){O.alpha(o)!=0&&(Be.Material_setUniformMat32(this._roundedRectangleBlurMaterial,this._materialStrings.GLSLX_NAME_U_VERTEX_TRANSFORM,e),Be.Material_setUniformVec42(this._roundedRectangleBlurMaterial,this._materialStrings.GLSLX_NAME_U_COLOR,O.premultiplied(o)),Be.Material_setUniformVec43(this._roundedRectangleBlurMaterial,this._materialStrings.GLSLX_NAME_U_QUAD,t),this._roundedRectangleBlurMaterial.setUniformFloat(this._materialStrings.GLSLX_NAME_U_CORNER_RADIUS_OVER_BLUR_RADIUS,n/i),Be.Material_setUniformVec22(this._roundedRectangleBlurMaterial,this._materialStrings.GLSLX_NAME_U_HALF_SIZE_OVER_BLUR_RADIUS,t.size().divideScalar(2*i)),this._roundedRectangleBlurMaterial.setUniformFloat(this._materialStrings.GLSLX_NAME_U_BLUR_RADIUS,i),this.drawToCurrentTile(1,this._roundedRectangleBlurMaterial,this._quadArea,It.PREMULTIPLIED),this._didDraw=!0)}renderBlur(e,t,n,o,i,a,s,l){let d=e,c=32,p=.5,u=1/(1+2*n),_=Math.min(c,u*n*this.currentTextureSize()),h=_/this.currentTextureSize(),S=h/n;S>2/p/this.currentTextureSize()&&(S=Math.round(S*(this.currentTextureSize()*p))/(this.currentTextureSize()*p),_=Math.min(c/p,S*n*this.currentTextureSize()),h=_/this.currentTextureSize());let m=J.new2().translatedBy2(.5,.5).scaledBy2(S).translatedBy2(-.5,-.5),f=G.new3(o).scaledBy1(1/this.currentTextureSize());m.transformRect(f);let T=G.new3(f).expandedBy2(0,h),y=G.new3(T).expandedBy2(h,0),E=m.multipliedBy1(t),v=null;if(!a.isInvalid()){v=E.transformRect(a.clone()),v.scaledBy1(this.currentTextureSize());let g=Math.ceil(v.left()-.5)+.5,R=Math.ceil(v.top()-.5)+.5,D=Math.floor(v.right()+.5)-.5,P=Math.floor(v.bottom()+.5)-.5;v=new G(g,R,D-g,P-R),v.scaledBy1(1/this.currentTextureSize())}let A=_>4,I=A&&d.child.op()==9;if(l<1){if(this._tileStack.pushTile(G.new3(y).scaledBy1(this.currentTextureSize()).expandedBy1(1).rounded()),I){let g=d.child;this.visit(g.alpha,E,i,0)}else this.visit(d.child,E,i,0);if(this._interruptedCommands.length>0){this._interruptedCommands.push(new Yi(e,t,s,i,1));return}}let C=!1;if(A){let g=_*p,R=G.new3(y).scaledBy1(p),D=G.new3(T).scaledBy1(p),P=G.new3(f).scaledBy1(p),U=null;if(v!=null){U=G.new3(v).scaledBy1(p),U.scaledBy1(this.currentTextureSize());let z=Math.ceil(U.left()-.5)+.5,Q=Math.ceil(U.top()-.5)+.5,K=Math.floor(U.right()+.5)-.5,j=Math.floor(U.bottom()+.5)-.5;U=new G(z,Q,K-z,j-Q),U.scaledBy1(1/this.currentTextureSize())}let B=this._tileStack.popTile(),M=G.new3(R).scaledBy1(this.currentTextureSize()).expandedBy1(1).rounded();if(this._tileStack.pushTile(M,C),I){let z=d.child;this.hardMaskWithColorAndDownscaleTile(B,z.color,R,y)}else this.downscaleTile(B,R,y);this._tileStack.freeTileToPool(B);let F=this._tileStack.popTile(),w=G.new3(D).scaledBy1(this.currentTextureSize()).expandedBy1(1).rounded();this._tileStack.pushTile(w,C),this.blurTile(F,1/this.currentTextureSize(),0,G.new3(w).scaledBy1(1/this.currentTextureSize()),g,U),this._tileStack.freeTileToPool(F);let V=this._tileStack.popTile(),k=G.new3(P).scaledBy1(this.currentTextureSize()).expandedBy1(1).rounded();this._tileStack.pushTile(k,C),this.blurTile(V,0,1/this.currentTextureSize(),G.new3(k).scaledBy1(1/this.currentTextureSize()),g,U),this._tileStack.freeTileToPool(V);let H=this._tileStack.popTile();this.upscaleTile(H,o.scaledBy1(1/this.currentTextureSize()),P),this._tileStack.freeTileToPool(H)}else{let g=this._tileStack.popTile(),R=G.new3(T).scaledBy1(this.currentTextureSize()).expandedBy1(1).rounded();this._tileStack.pushTile(R,C),this.blurTile(g,1/this.currentTextureSize(),0,G.new3(R).scaledBy1(1/this.currentTextureSize()),_,v),this._tileStack.freeTileToPool(g);let D=this._tileStack.popTile(),P=G.new3(f).scaledBy1(this.currentTextureSize()).expandedBy1(1).rounded();this._tileStack.pushTile(P,C),this.blurTile(D,0,1/this.currentTextureSize(),G.new3(P).scaledBy1(1/this.currentTextureSize()),_,v),this._tileStack.freeTileToPool(D);let U=this._tileStack.popTile();this.upscaleTile(U,o.scaledBy1(1/this.currentTextureSize()),f),this._tileStack.freeTileToPool(U)}}hardMaskTileWithColor(e,t,n){let o=G.new3(n);Be.Material_setUniformVec43(this._hardMaskTileWithColorMaterial,this._materialStrings.GLSLX_NAME_U_QUAD,this.scissorQuad(o)),Be.Material_setUniformVec42(this._hardMaskTileWithColorMaterial,this._materialStrings.GLSLX_NAME_U_COLOR,O.premultiplied(t)),e.colorTextureForSampling().setFormat(be.RGBA_NEAREST_CLAMP),this._hardMaskTileWithColorMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_TEXTURE0,e.colorTextureForSampling(),0),this.drawToCurrentTile(1,this._hardMaskTileWithColorMaterial,this._quadArea,It.PREMULTIPLIED),this._didDraw=!0,e.colorTextureForSampling().setFormat(be.RGBA_LINEAR_CLAMP)}blurTile(e,t,n,o,i,a){let s=null;a==null?s=this._unclampedBlurMaterial:(s=this._clampedBlurMaterial,Be.Material_setUniformVec43(s,this._materialStrings.GLSLX_NAME_U_BLUR_CLAMP,a)),Be.Material_setUniformVec43(s,this._materialStrings.GLSLX_NAME_U_QUAD,o),s.setUniformFloat(this._materialStrings.GLSLX_NAME_U_COUNT,i),s.setUniformVec21(this._materialStrings.GLSLX_NAME_U_BLUR_DELTA,t,n),s.setUniformSampler(this._materialStrings.GLSLX_NAME_TEXTURE0,e.colorTextureForSampling(),0),this.drawToCurrentTile(1,s,this._quadArea,It.COPY),this._didDraw=!0}scissorQuad(e){return e.scaledBy1(1/this.currentTextureSize())}blendAndPopTile(e,t){if(e=="PASS_THROUGH"||e=="NORMAL"||e=="SCREEN"){let n=this._tileStack.popTile(),o=this.scissorQuad(G.new3(Cr.last(n.scissors())));Be.Material_setUniformVec43(this._blendTileSimpleMaterial,this._materialStrings.GLSLX_NAME_U_QUAD,o);let i;e=="PASS_THROUGH"?(this._blendTileSimpleMaterial.setUniformFloat(this._materialStrings.GLSLX_NAME_U_OPACITY,1),i=It.createInterpolateBlendState(t)):(this._blendTileSimpleMaterial.setUniformFloat(this._materialStrings.GLSLX_NAME_U_OPACITY,t),e=="SCREEN"?i=It.SCREEN:i=It.PREMULTIPLIED),n.colorTextureForSampling().setFormat(be.RGBA_NEAREST_CLAMP),this._blendTileSimpleMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_TEXTURE0,n.colorTextureForSampling(),0),this.drawToCurrentTile(1,this._blendTileSimpleMaterial,this._quadArea,i),this._didDraw=!0,n.colorTextureForSampling().setFormat(be.RGBA_LINEAR_CLAMP),this._tileStack.freeTileToPool(n)}else{this.duplicateTile2(Cr.last(this._currentTile1().scissors()),1);let n=this._tileStack.popTile(),o=this._tileStack.popTile(),i=this.scissorQuad(G.new3(Cr.last(o.scissors())));Be.Material_setUniformVec43(this._blendTileCustomMaterial,this._materialStrings.GLSLX_NAME_U_QUAD,i),this._blendTileCustomMaterial.setUniformInt(this._materialStrings.GLSLX_NAME_U_TYPE,zF.get(e)),this._blendTileCustomMaterial.setUniformFloat(this._materialStrings.GLSLX_NAME_U_OPACITY,t),o.colorTextureForSampling().setFormat(be.RGBA_NEAREST_CLAMP),n.colorTextureForSampling().setFormat(be.RGBA_NEAREST_CLAMP),this._blendTileCustomMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_TEXTURE0,o.colorTextureForSampling(),0),this._blendTileCustomMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_TEXTURE1,n.colorTextureForSampling(),1),this.drawToCurrentTile(1,this._blendTileCustomMaterial,this._quadArea,It.COPY),this._didDraw=!0,n.colorTextureForSampling().setFormat(be.RGBA_LINEAR_CLAMP),o.colorTextureForSampling().setFormat(be.RGBA_LINEAR_CLAMP),this._tileStack.freeTileToPool(n),this._tileStack.freeTileToPool(o)}}upscaleTile(e,t,n){Be.Material_setUniformVec43(this._upscaleTileMaterial,this._materialStrings.GLSLX_NAME_U_QUAD,t),Be.Material_setUniformVec43(this._upscaleTileMaterial,this._materialStrings.GLSLX_NAME_U_SOURCE,n),this._upscaleTileMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_TEXTURE0,e.colorTextureForSampling(),0),this.drawToCurrentTile(1,this._upscaleTileMaterial,this._quadArea,It.PREMULTIPLIED),this._didDraw=!0}downscaleTile(e,t,n){Be.Material_setUniformVec43(this._downscaleTileMaterial,this._materialStrings.GLSLX_NAME_U_QUAD,t),Be.Material_setUniformVec43(this._downscaleTileMaterial,this._materialStrings.GLSLX_NAME_U_SOURCE,n),this._downscaleTileMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_TEXTURE0,e.colorTextureForSampling(),0),this.drawToCurrentTile(1,this._downscaleTileMaterial,this._quadArea,It.COPY),this._didDraw=!0}hardMaskWithColorAndDownscaleTile(e,t,n,o){Be.Material_setUniformVec43(this._hardMaskWithColorAndDownscaleTileMaterial,this._materialStrings.GLSLX_NAME_U_QUAD,n),Be.Material_setUniformVec43(this._hardMaskWithColorAndDownscaleTileMaterial,this._materialStrings.GLSLX_NAME_U_SOURCE,o),this._hardMaskWithColorAndDownscaleTileMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_TEXTURE0,e.colorTextureForSampling(),0),Be.Material_setUniformVec42(this._hardMaskWithColorAndDownscaleTileMaterial,this._materialStrings.GLSLX_NAME_U_COLOR,O.premultiplied(t)),this._hardMaskWithColorAndDownscaleTileMaterial.setUniformFloat(this._materialStrings.GLSLX_NAME_U_TEXTURE_SIZE,this.currentTextureSize()),this._hardMaskWithColorAndDownscaleTileMaterial.setUniformFloat(this._materialStrings.GLSLX_NAME_U_TEXTURE_PX,1/this.currentTextureSize()),this.drawToCurrentTile(1,this._hardMaskWithColorAndDownscaleTileMaterial,this._quadArea,It.COPY),this._didDraw=!0}_advanceGIFAndUpload(e,t){let n=e.gif().nextFrameIfNecessary();n!=null&&Mo.Texture_resize3(t,e.width(),e.height(),Jt.createFromPixels(e.width(),e.height(),n))}getOrCreateImageTexture(e){var i,a;if((e==null?void 0:e.image)==null)return null;this._neededImagesOrNull!=null&&Od.add(this._neededImagesOrNull,e);let t=e.image,n=e.purpose,o=t.texture();return o!=null?t.gif()!=null&&this._advanceGIFAndUpload(t,o):(((i=t.decodedData())==null?void 0:i.pixels)!=null||t.gif()!=null)&&(o=this._context.createTexture(t.isCompressedTexture()?be.ASTC_6X6_NEAREST_CLAMP:be.RGBA_NEAREST_CLAMP,t.width(),t.height(),yr.IMAGE),o.setShouldUnloadImageBuffer(Y.shouldApplyMobileOptimizations()),t.setTexture(o),((a=t.decodedData())==null?void 0:a.pixels)!=null?(Mo.Texture_resize3(t.texture(),t.width(),t.height(),t.decodedData()),Y.shouldApplyMobileOptimizations()&&t.freeMemoryForDecodedData()):t.gif()!=null&&this._advanceGIFAndUpload(t,o)),t.state()==0&&this._requestImage(t,n),o}duplicateTile1(e){this.duplicateTile2(e,0)}duplicateTile2(e,t){let n=this._currentTile2(t),o=n.isColorClear()||n.needsColorClear(),i=o;this._tileStack.pushTile(e,i);let a=this._currentTile1();if(o)return;let s=n.colorTextureForSampling();s.setFormat(be.RGBA_NEAREST_CLAMP);let l=n.uvSpaceRect(),d=this.scissorQuad(G.new3(e)),c=new G(l.x()+l.width()*d.x(),l.y()+l.height()*d.y(),l.width()*d.width(),l.height()*d.height()),p=new G(-1+2*d.x(),-1+2*d.y(),2*d.width(),2*d.height());this.drawTexture1(s,c,null,p,0),s.setFormat(be.RGBA_LINEAR_CLAMP)}renderBlend(e,t,n,o,i,a){if(a<1){let s=this.allocateAndComputeTileScissor(n,this.bounds(t.child)),l=G.new3(Cr.last(this._currentTile1().scissors())).intersectedWith(s);if(l.isEmpty())return;if(e?this._currentTile1().pushScissorRect(l.clone()):t.blendMode=="PASS_THROUGH"?this.duplicateTile1(l):this._tileStack.pushTile(l),this.visitWithCanvasSpaceTileBounds(t.child,n,o,i,0),this._interruptedCommands.length>0){this._interruptedCommands.push(new r_(e,t,n,o,i));return}}e?this._currentTile1().popScissor():this.blendAndPopTile(t.blendMode,t.opacity)}maskBackgroundBlurTile(e,t,n){ye.flushBeforeMasks()&&this._context.flush();let o=G.new3(n);Be.Material_setUniformVec43(this._maskBackgroundBlurTileMaterial,this._materialStrings.GLSLX_NAME_U_QUAD,this.scissorQuad(o)),t.colorTextureForSampling().setFormat(be.RGBA_NEAREST_CLAMP),e.colorTextureForSampling().setFormat(be.RGBA_NEAREST_CLAMP),this._maskBackgroundBlurTileMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_TEXTURE0,t.colorTextureForSampling(),0),this._maskBackgroundBlurTileMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_TEXTURE1,e.colorTextureForSampling(),1),this.drawToCurrentTile(1,this._maskBackgroundBlurTileMaterial,this._quadArea,It.COPY),this._didDraw=!0,e.colorTextureForSampling().setFormat(be.RGBA_LINEAR_CLAMP),t.colorTextureForSampling().setFormat(be.RGBA_LINEAR_CLAMP)}maskInnerShadowTile(e,t,n,o,i){ye.flushBeforeMasks()&&this._context.flush();let a=G.new3(n),s=i?this._maskInnerShadowTileAndFirstHardMaskAlpha:this._maskInnerShadowTileMaterial;Be.Material_setUniformVec43(s,this._materialStrings.GLSLX_NAME_U_QUAD,this.scissorQuad(a)),Be.Material_setUniformVec42(s,this._materialStrings.GLSLX_NAME_U_COLOR,O.premultiplied(o)),t.colorTextureForSampling().setFormat(be.RGBA_NEAREST_CLAMP),e.colorTextureForSampling().setFormat(be.RGBA_NEAREST_CLAMP),s.setUniformSampler(this._materialStrings.GLSLX_NAME_TEXTURE0,t.colorTextureForSampling(),0),s.setUniformSampler(this._materialStrings.GLSLX_NAME_TEXTURE1,e.colorTextureForSampling(),1),this.drawToCurrentTile(1,s,this._quadArea,It.PREMULTIPLIED),e.colorTextureForSampling().setFormat(be.RGBA_LINEAR_CLAMP),t.colorTextureForSampling().setFormat(be.RGBA_LINEAR_CLAMP),this._didDraw=!0}maskTile(e,t,n){ye.flushBeforeMasks()&&this._context.flush();let o=G.new3(n);Be.Material_setUniformVec43(this._maskTileMaterial,this._materialStrings.GLSLX_NAME_U_QUAD,this.scissorQuad(o)),t.colorTextureForSampling().setFormat(be.RGBA_NEAREST_CLAMP),e.colorTextureForSampling().setFormat(be.RGBA_NEAREST_CLAMP),this._maskTileMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_TEXTURE0,t.colorTextureForSampling(),0),this._maskTileMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_TEXTURE1,e.colorTextureForSampling(),1),this.drawToCurrentTile(1,this._maskTileMaterial,this._quadArea,It.PREMULTIPLIED),e.colorTextureForSampling().setFormat(be.RGBA_LINEAR_CLAMP),t.colorTextureForSampling().setFormat(be.RGBA_LINEAR_CLAMP),this._didDraw=!0}maskTileLuminance(e,t,n){ye.flushBeforeMasks()&&this._context.flush();let o=G.new3(n);Be.Material_setUniformVec43(this._maskTileLuminanceMaterial,this._materialStrings.GLSLX_NAME_U_QUAD,this.scissorQuad(o)),t.colorTextureForSampling().setFormat(be.RGBA_NEAREST_CLAMP),e.colorTextureForSampling().setFormat(be.RGBA_NEAREST_CLAMP),this._maskTileLuminanceMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_TEXTURE0,t.colorTextureForSampling(),0),this._maskTileLuminanceMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_TEXTURE1,e.colorTextureForSampling(),1),this.drawToCurrentTile(1,this._maskTileLuminanceMaterial,this._quadArea,It.PREMULTIPLIED),e.colorTextureForSampling().setFormat(be.RGBA_LINEAR_CLAMP),t.colorTextureForSampling().setFormat(be.RGBA_LINEAR_CLAMP),this._didDraw=!0}maskTileLuminancePassThrough(e,t,n,o){ye.flushBeforeMasks()&&this._context.flush();let i=G.new3(o);Be.Material_setUniformVec43(this._maskTileLuminancePassThroughMaterial,this._materialStrings.GLSLX_NAME_U_QUAD,this.scissorQuad(i)),n.colorTextureForSampling().setFormat(be.RGBA_NEAREST_CLAMP),t.colorTextureForSampling().setFormat(be.RGBA_NEAREST_CLAMP),this._maskTileLuminancePassThroughMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_TEXTURE0,n.colorTextureForSampling(),0),this._maskTileLuminancePassThroughMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_TEXTURE1,e.colorTextureForSampling(),1),this._maskTileLuminancePassThroughMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_TEXTURE2,t.colorTextureForSampling(),2),this.drawToCurrentTile(1,this._maskTileLuminancePassThroughMaterial,this._quadArea,It.COPY),t.colorTextureForSampling().setFormat(be.RGBA_LINEAR_CLAMP),n.colorTextureForSampling().setFormat(be.RGBA_LINEAR_CLAMP),this._didDraw=!0}maskTilePassThrough(e,t,n,o){ye.flushBeforeMasks()&&this._context.flush();let i=G.new3(o);Be.Material_setUniformVec43(this._maskTilePassThroughMaterial,this._materialStrings.GLSLX_NAME_U_QUAD,this.scissorQuad(i)),n.colorTextureForSampling().setFormat(be.RGBA_NEAREST_CLAMP),t.colorTextureForSampling().setFormat(be.RGBA_NEAREST_CLAMP),this._maskTilePassThroughMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_TEXTURE0,n.colorTextureForSampling(),0),this._maskTilePassThroughMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_TEXTURE1,e.colorTextureForSampling(),1),this._maskTilePassThroughMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_TEXTURE2,t.colorTextureForSampling(),2),this.drawToCurrentTile(1,this._maskTilePassThroughMaterial,this._quadArea,It.COPY),t.colorTextureForSampling().setFormat(be.RGBA_LINEAR_CLAMP),n.colorTextureForSampling().setFormat(be.RGBA_LINEAR_CLAMP),this._didDraw=!0}maskKnockoutShadowTile(e,t,n){ye.flushBeforeMasks()&&this._context.flush();let o=G.new3(n);Be.Material_setUniformVec43(this._maskKnockoutShadowTileMaterial,this._materialStrings.GLSLX_NAME_U_QUAD,this.scissorQuad(o)),t.colorTextureForSampling().setFormat(be.RGBA_NEAREST_CLAMP),e.colorTextureForSampling().setFormat(be.RGBA_NEAREST_CLAMP),this._maskKnockoutShadowTileMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_TEXTURE0,t.colorTextureForSampling(),0),this._maskKnockoutShadowTileMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_TEXTURE1,e.colorTextureForSampling(),1),this.drawToCurrentTile(1,this._maskKnockoutShadowTileMaterial,this._quadArea,It.PREMULTIPLIED),e.colorTextureForSampling().setFormat(be.RGBA_LINEAR_CLAMP),t.colorTextureForSampling().setFormat(be.RGBA_LINEAR_CLAMP),this._didDraw=!0}maskKnockoutShadowTilePassThrough(e,t,n,o){ye.flushBeforeMasks()&&this._context.flush();let i=G.new3(o);Be.Material_setUniformVec43(this._maskKnockoutShadowTilePassThroughMaterial,this._materialStrings.GLSLX_NAME_U_QUAD,this.scissorQuad(i)),n.colorTextureForSampling().setFormat(be.RGBA_NEAREST_CLAMP),t.colorTextureForSampling().setFormat(be.RGBA_NEAREST_CLAMP),this._maskKnockoutShadowTilePassThroughMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_TEXTURE0,n.colorTextureForSampling(),0),this._maskKnockoutShadowTilePassThroughMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_TEXTURE1,e.colorTextureForSampling(),1),this._maskKnockoutShadowTilePassThroughMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_TEXTURE2,t.colorTextureForSampling(),2),this.drawToCurrentTile(1,this._maskKnockoutShadowTilePassThroughMaterial,this._quadArea,It.COPY),t.colorTextureForSampling().setFormat(be.RGBA_LINEAR_CLAMP),n.colorTextureForSampling().setFormat(be.RGBA_LINEAR_CLAMP),this._didDraw=!0}downsampleSuperSSAATile(e,t){let n=this.downscaleRectForSSAA(Cr.last(e.scissors()).clone());n.expand1(1),n.round(),this._tileStack.pushScissor(n);let o=null;switch(Vr.SUPERSAMPLE_COUNT()){case 4:{o=this._superSSAA4x4DownsampleMaterial;break}case 2:{o=this._blendTextureMaterial;break}default:throw new Error(`Unrecognized SUPERSAMPLE_COUNT (${Vr.SUPERSAMPLE_COUNT()}) when downsampling`)}o.setUniformFloat(this._materialStrings.GLSLX_NAME_U_OPACITY,1),o.setUniformSampler(this._materialStrings.GLSLX_NAME_TEXTURE0,e.colorTextureForSampling(),0),this.drawToCurrentTile(1,o,this._quadArea,t),this._tileStack.popScissorFromCurrentTile()}drawTextureRegion1(e,t,n){this.drawTextureRegion2(e,t,yt.FrozenAffineTransform_IDENTITY,n,1)}drawTextureRegion2(e,t,n,o,i){let a=e.uvSpaceRect,s=null;if(e.texture.format().minFilter==1||e.texture.format().magFilter==1){s=a.clone();let l=1/e.texture.width();s.contract(l/2)}this.drawTexture2(e.texture,e.uvSpaceRect,s,t,n,o,i)}drawTexture1(e,t,n,o,i){this.drawTexture2(e,t,n,o,yt.FrozenAffineTransform_IDENTITY,i,1)}drawTexture2(e,t,n,o,i,a,s){let l=this._setupDrawTextureState(e,t,n,o,i,a,s);this.drawToCurrentTile(1,this._drawTextureMaterial,this._quadArea,l),this._didDraw=!0}drawTextureToCurrentFramebuffer(e,t,n,o,i,a,s,l,d){let c=this._setupDrawTextureState(e,t,n,o,i,a,s);this._context.draw(1,this._drawTextureMaterial,this._quadArea,c,lr.NONE,l,null,d)}_setupDrawTextureState(e,t,n,o,i,a,s){let l;switch(a){case 0:{l=It.COPY;break}case 1:{l=It.PREMULTIPLIED;break}}return Be.Material_setUniformVec43(this._drawTextureMaterial,this._materialStrings.GLSLX_NAME_U_UV_SPACE_CLAMPING_RECT,n??t),Be.Material_setUniformVec43(this._drawTextureMaterial,this._materialStrings.GLSLX_NAME_U_UV_SPACE_SOURCE_RECT,t),Be.Material_setUniformMat32(this._drawTextureMaterial,this._materialStrings.GLSLX_NAME_U_TO_CLIP_SPACE_TRANSFORM,i),Be.Material_setUniformVec43(this._drawTextureMaterial,this._materialStrings.GLSLX_NAME_U_DESTINATION_RECT,o),this._drawTextureMaterial.setUniformFloat(this._materialStrings.GLSLX_NAME_U_OPACITY,s),this._drawTextureMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_TEXTURE0,e,0),l}renderLayerByLayerActivate(e){this._layerByLayerRendering.activate(e)}renderLayerByLayerDeactivate(){this._layerByLayerRendering.deactivate()}finishLayerByLayerDrawToScreen(){this._layerByLayerRendering.finishLayerByLayerDrawToScreen()}isLayerByLayerRenderingEnabled(){return this._layerByLayerRendering.isEnabled()}treeToRender(e){return this._layerByLayerRendering.treeToRender(e)}renderLayerByLayerPlay(){this._layerByLayerRendering.play()}renderLayerByLayerPause(){this._layerByLayerRendering.pause()}renderLayerByLayerForward(){this._layerByLayerRendering.forward()}renderLayerByLayerBackward(){this._layerByLayerRendering.backward()}renderLayerByLayerRewind(){this._layerByLayerRendering.rewind()}renderLayerByLayerIncreaseSpeed(){this._layerByLayerRendering.increaseSpeed()}renderLayerByLayerDecreaseSpeed(){this._layerByLayerRendering.decreaseSpeed()}},Xi=class{constructor(e,t,n,o,i,a,s){this.renderTree=e,this.shouldCollectNeededImages=t,this.boundsCache=n,this.requestImage=o,this.shouldDisableAllAntialiasing=i,this.outputTextureNeedsClear=a,this.useLargeTilesForDrawToScreen=s}};(t=>{class r{constructor(o,i){this._context=null,this._transparentClearTexture=null,this._tilePools=new Map([[tr.TILE_SIZE,[]],[Vr.SSAA_SIZE(),[]]]),this._stack=[],this._tileSizeState=t.TileStack.TileSizeState.REGULAR,this._liveTileCount=new Map([[tr.TILE_SIZE,0],[Vr.SSAA_SIZE(),0]]),this._sharedStencilTexture=null,this._sharedSSAAStencilTexture=null,this._context=o,this._transparentClearTexture=i,this._defaultScissors=new Map([[tr.TILE_SIZE,new G(0,0,tr.TILE_SIZE,tr.TILE_SIZE)],[Vr.SSAA_SIZE(),new G(0,0,Vr.SSAA_SIZE(),Vr.SSAA_SIZE())]])}setSSAARenderState(){this._tileSizeState=t.TileStack.TileSizeState.SUPERSAMPLING}unsetSSAARenderState(){this._tileSizeState=t.TileStack.TileSizeState.REGULAR}setDrawToScreenLargeTileState(){this._tileSizeState=t.TileStack.TileSizeState.DRAW_TO_SCREEN_LARGE_TILES}unsetDrawToScreenLargeTileState(){this._tileSizeState=t.TileStack.TileSizeState.REGULAR}isEmpty(){return this._stack.length==0}count(){return this._stack.length}get(o){return this._stack[o]}last(){return this._stack.length==0?null:ne.List_last(this._stack)}assertPoolAfterRender(){}popScissorFromCurrentTile(){ne.List_last(this._stack).popScissor()}takeScissorFromCurrentTile(){return ne.List_last(this._stack).takeScissor()}freeTileToPool(o){o.clearScissors(),o.setIsColorClear(!1),o.setNeedsColorClear(!0),o.setNeedsDepthStencilClear(!0),o.setScissorForClear(null),o.tileSize()==Vr.SSAA_SIZE()?this._tilePools.get(Vr.SSAA_SIZE()).push(o):this._tilePools.get(tr.TILE_SIZE).push(o)}pushScissor(o){let i=ne.List_last(this._stack);i.pushScissorRect(o.clone());let a=i.scissorForClear()}pushTile(o,i=!0){let a=this._allocateTileFromPool();this._stack.push(a),i||a.setNeedsColorClear(!1),a.backingColorTexture().hasContentBeenInitialized()||a.setNeedsColorClear(!0),a.backingDepthStencilTexture()!=null&&!a.backingDepthStencilTexture().hasContentBeenInitialized()&&a.setNeedsDepthStencilClear(!0),Y.viewerScissorClear()&&a.setScissorForClear(o??this.defaultTileScissor()),this.pushScissor(o)}pushTileAndClearToColor(o,i){this.pushTile(i),o!=O.TRANSPARENT&&ne.List_last(this._stack).clearToColor(o)}pushTileBackedByExistingFramebuffer(o,i,a){let s=a.outputTextureNeedsClear,l=a.useLargeTilesForDrawToScreen?Vr.SSAA_SIZE():tr.TILE_SIZE,d=!s,c=new t.TileStackTile(1,l,this._context,o,i,d,this._transparentClearTexture);this._stack.push(c),c.setNeedsColorClear(s),c.setNeedsDepthStencilClear(s)}pushTileBackedByExistingFramebufferAndClearToColor(o,i,a,s){this.pushTileBackedByExistingFramebuffer(o,i,a),s!=O.TRANSPARENT&&ne.List_last(this._stack).clearToColor(s)}popTile(){return this._stack.pop()}totalVRAM(){let o=0;this._sharedStencilTexture!=null&&(o=o+Mo.Texture_totalVRAM(this._sharedStencilTexture));for(let i of this._tilePools.get(tr.TILE_SIZE))o=o+Mo.Texture_totalVRAM(i.backingColorTexture());for(let i of this._tilePools.get(Vr.SSAA_SIZE()))o=o+Mo.Texture_totalVRAM(i.backingColorTexture());for(let i of this._stack)o=o+Mo.Texture_totalVRAM(i.backingColorTexture());return o}_pool(){return this._tileSizeState==t.TileStack.TileSizeState.REGULAR?this._tilePools.get(tr.TILE_SIZE):this._tilePools.get(Vr.SSAA_SIZE())}_size(){return this._tileSizeState==t.TileStack.TileSizeState.REGULAR?tr.TILE_SIZE:Vr.SSAA_SIZE()}defaultTileScissor(){return this._defaultScissors.get(this._size())}_purpose(){return this._tileSizeState==t.TileStack.TileSizeState.REGULAR?"TileStack":this._tileSizeState==t.TileStack.TileSizeState.SUPERSAMPLING?"SSAATileStack":"DrawToScreenLargeTiles"}_sizeState(){return this._tileSizeState}_allocateTileFromPool(){let o=this._pool(),i=this._size(),a=this._purpose(),s=this._sizeState(),l=null;if(o!=null&&o.length!=0)l=o.pop();else{this._liveTileCount.set(i,this._liveTileCount.get(i)+1);let d=null;s==t.TileStack.TileSizeState.REGULAR?(this._sharedStencilTexture==null&&(this._sharedStencilTexture=this._context.createTexture(be.STENCIL,i,i,yr.TILE_STACK)),d=this._sharedStencilTexture):(s==t.TileStack.TileSizeState.SUPERSAMPLING||s==t.TileStack.TileSizeState.DRAW_TO_SCREEN_LARGE_TILES)&&(this._sharedSSAAStencilTexture==null&&(this._sharedSSAAStencilTexture=this._context.createTexture(be.STENCIL,i,i,yr.TILE_STACK)),d=this._sharedSSAAStencilTexture),l=new t.TileStackTile(0,i,a,d,this._context,this._transparentClearTexture)}return l}_isAllocatedUnusedTile(o){return o!=null&&o!=this.last()&&this._stack.indexOf(o)==-1&&this._tilePools.get(tr.TILE_SIZE).indexOf(o)==-1&&this._tilePools.get(Vr.SSAA_SIZE()).indexOf(o)==-1}}t.TileStack=r,(o=>{let n;(l=>(l[l.REGULAR=0]="REGULAR",l[l.SUPERSAMPLING=1]="SUPERSAMPLING",l[l.DRAW_TO_SCREEN_LARGE_TILES=2]="DRAW_TO_SCREEN_LARGE_TILES"))(n=o.TileSizeState||(o.TileSizeState={}))})(r=t.TileStack||(t.TileStack={}));class e{constructor(){this._scissorForClear=null;if(arguments[0]==0){let[,o,i,a,s,l]=arguments;this._needsColorClear=!1,this._needsDepthStencilClear=!1,this._context=s,this._framebuffer=this._context.createFramebuffer(this._context.createTexture(be.RGBA_LINEAR_CLAMP,o,o,yr.TILE_STACK),a,i),this._viewport=new G(0,0,o,o),this._isBackedBySingleTileTexture=!0,this._transparentClearTexture=l,this._isColorClear=!0,this._scissorStack=new vd(this._framebuffer)}else if(arguments[0]==1){let[o,i,a,s,l,d,c]=arguments;this._needsColorClear=!1,this._needsDepthStencilClear=!1,this._context=a,this._framebuffer=s,this._viewport=new G(l.x()|0,l.y()|0,i,i),this._isBackedBySingleTileTexture=!1,this._transparentClearTexture=c,this._isColorClear=d,this._scissorStack=new vd(this._framebuffer)}}uvSpaceRect(){if(this._isBackedBySingleTileTexture)return G.UNIT;{let o=this._viewport,i=this._framebuffer.colorTexture();return new G(o.x()/i.width(),o.y()/i.height(),o.width()/i.width(),o.height()/i.height())}}tileSize(){return this._viewport.width()|0}colorTextureForSampling(){return this._isColorClear||this._needsColorClear?this._transparentClearTexture:this._framebuffer.colorTexture()}backingColorTexture(){return this._framebuffer.colorTexture()}backingDepthStencilTexture(){return this._framebuffer.depthStencilTexture()}context(){return this._context}framebuffer(){return this._framebuffer}viewport(){return this._viewport}isBackedBySingleTileTexture(){return this._isBackedBySingleTileTexture}deleteTexture(){this._framebuffer.deleteTexture()}popScissor(){this._scissorStack.popScissor()}takeScissor(){let o=this._scissorStack.takeScissor();if(this._isBackedBySingleTileTexture)return o;let i=this._viewport;return o.setX(o.x()-i.x()),o.setY(o.y()-i.y()),o}scissors(){let o=this._scissorStack.scissors();if(this._isBackedBySingleTileTexture)return o;let i=[],a=this._viewport;for(let s=0,l=Cr.count(o);s<l;s=s+1){let d=G.new3(Cr.get(o,s));d.setX(d.x()-a.x()),d.setY(d.y()-a.y()),i.push(d)}return i}activeScissorRelativeToFramebuffer(){return this._scissorStack.activeScissor()}pushScissor(o,i,a,s){if(this._isBackedBySingleTileTexture)this._scissorStack.pushScissor(o,i,a,s);else{let l=this._viewport;this._scissorStack.pushScissor((l.x()|0)+o,(l.y()|0)+i,a,s)}}pushScissorRect(o){this.pushScissor(o.x()|0,o.y()|0,o.width()|0,o.height()|0)}clearScissors(){this._scissorStack.clearScissors()}clearToColor(o){if(this.needsColorClear()||this.needsDepthStencilClear()){let a=this.needsColorClear()&&this.needsDepthStencilClear()?0:this.needsColorClear()?1:2;this.doDeferredClear(a)}if(o==O.TRANSPARENT&&this.isColorClear())return;let i=this._scissorStack.takeAllScissors();if(this._scissorForClear!=null)this._scissorStack.pushScissorRect(this._scissorForClear.clone());else if(!this._isBackedBySingleTileTexture){let a=this._viewport;this._scissorStack.pushScissor(a.x()|0,a.y()|0,a.width()|0,a.height()|0)}this._context.clear(1,o,this._framebuffer,this._scissorStack.activeScissor(),this._viewport),(this._scissorForClear!=null||!this._isBackedBySingleTileTexture)&&this._scissorStack.popScissor(),this._scissorStack.replaceAllScissors(i),this._isColorClear=o==O.TRANSPARENT}doDeferredClear(o){let i=this._scissorStack.takeAllScissors();if(this._scissorForClear!=null)this._scissorStack.pushScissorRect(this._scissorForClear.clone());else if(!this._isBackedBySingleTileTexture){let a=this._viewport;this._scissorStack.pushScissor(a.x()|0,a.y()|0,a.width()|0,a.height()|0)}this._context.clear(o,O.TRANSPARENT,this._framebuffer,this._scissorStack.activeScissor(),this._viewport),(this._scissorForClear!=null||!this._isBackedBySingleTileTexture)&&this._scissorStack.popScissor(),this._scissorStack.replaceAllScissors(i),(o==0||o==1)&&(this._needsColorClear=!1,this._isColorClear=!0),(o==0||o==2)&&(this._needsDepthStencilClear=!1)}setNeedsColorClear(o){this._needsColorClear=o}needsColorClear(){return this._needsColorClear}setNeedsDepthStencilClear(o){this._needsDepthStencilClear=o}needsDepthStencilClear(){return this._needsDepthStencilClear}setIsColorClear(o){this._isColorClear=o}isColorClear(){return this._isColorClear}setScissorForClear(o){this._scissorForClear=o}scissorForClear(){return this._scissorForClear}}t.TileStackTile=e})(Qs||(Qs={}));var d_=class{constructor(e,t,n,o){this.node=e,this.transform=t,this.framebuffer=n,this.originalOutputTextureFormat=o}equals(e){return e==this?!0:e==null?!1:e.node==this.node&&e.transform.equals2(this.transform,.001)}};var Vf=class{constructor(){this.level=0,this.mode=0}};function u_(r,e,t,n){return n==null?O.BLACK:r!=null?t?O.TRANSPARENT:e=="free"?n.computedBackgroundColor():Y.prototypeBackgroundColorOverride!=null&&Y.prototypeBackgroundColorOverride.value!=O.TRANSPARENT?Y.prototypeBackgroundColorOverride.value:n.prototypeBackgroundColor()!=O.TRANSPARENT?n.prototypeBackgroundColor():O.BLACK:n.computedBackgroundColor()}function HF(r){switch(r){case"PASS_THROUGH":case"NORMAL":case"DARKEN":case"MULTIPLY":case"LINEAR_BURN":case"COLOR_BURN":case"LIGHTEN":case"SCREEN":case"LINEAR_DODGE":case"COLOR_DODGE":case"OVERLAY":case"SOFT_LIGHT":case"HARD_LIGHT":case"DIFFERENCE":case"EXCLUSION":case"HUE":case"SATURATION":case"COLOR":case"LUMINOSITY":return!0;default:break}return!1}var zF=new Map([["PASS_THROUGH",0],["NORMAL",1],["DARKEN",2],["MULTIPLY",3],["LINEAR_BURN",4],["COLOR_BURN",5],["LIGHTEN",6],["SCREEN",7],["LINEAR_DODGE",8],["COLOR_DODGE",9],["OVERLAY",10],["SOFT_LIGHT",11],["HARD_LIGHT",12],["DIFFERENCE",13],["EXCLUSION",14],["HUE",15],["SATURATION",16],["COLOR",17],["LUMINOSITY",18]]),o_=new Map([["SOLID",0],["GRADIENT_LINEAR",1],["GRADIENT_RADIAL",2],["GRADIENT_ANGULAR",3],["GRADIENT_DIAMOND",4],["IMAGE",5],["EMOJI",6],["VIDEO",7]]);var Cd=(i=>(i[i.OTHER=0]="OTHER",i[i.PRERENDER_FULLSIZE=1]="PRERENDER_FULLSIZE",i[i.PRERENDER_THUMB=2]="PRERENDER_THUMB",i[i.ON_SCREEN_FULLSIZE=3]="ON_SCREEN_FULLSIZE",i[i.ON_SCREEN_THUMB=4]="ON_SCREEN_THUMB",i))(Cd||{}),bi=class bi{compare(e){let t=gt.int_compare(this.type,e.type);return t!=0?t:gt.int_compare(this.generation,e.generation)}toString(){return`${Cd[this.type]}:${this.generation}`}static advanceGeneration(){bi._generation=bi._generation+1}static forType(e){return new bi(e,bi._generation)}static forOnScreenPurpose(e){let t=ja.ImagePriorityType_forOnScreenPurpose(e);return bi.forType(t)}static forPrerenderPurpose(e){let t=ja.ImagePriorityType_forPrerenderPurpose(e);return bi.forType(t)}static max(e,t){return e.compare(t)>0?e:t}constructor(e,t){this.type=e,this.generation=t}};bi.OTHER=new bi(0,0),bi._generation=0;var dn=bi,p_=class{insertOrUpdate(e,t){let n=this._queue.getPriority(e);(n==null||t.compare(n.value)>0)&&this._queue.insertOrUpdate(e,t)}peek(){return this._queue.peek()}getPriority(e){let t=this._queue.getPriority(e);return t!=null?new ce(t.value):null}maxPriority(){return this._queue.count()==0?null:new ce(this._queue.maxPriority())}remove(e){this._queue.remove(e)}clear(){this._queue=new fa((e,t)=>e.compare(t))}allImages(){return this._queue.allValues()}count(){return this._queue.count()}isEmpty(){return this.count()==0}takeFirst(){return this._queue.pop()}constructor(){this._queue=new fa((e,t)=>e.compare(t))}},ja;(o=>{function r(i){return i==3||i==4}o.ImagePriorityType_isOnScreen=r;function e(i){return i==1||i==2}o.ImagePriorityType_isPrerender=e;function t(i){switch(i){case 0:return 3;case 1:case 2:return 4}throw new Error("Unhandled case")}o.ImagePriorityType_forOnScreenPurpose=t;function n(i){switch(i){case 0:return 1;case 1:case 2:return 2}throw new Error("Unhandled case")}o.ImagePriorityType_forPrerenderPurpose=n})(ja||(ja={}));var zf;(t=>{function r(){return X._new(-1,t._nextLocalID=t._nextLocalID+1)}t.generateId=r,t._nextLocalID=0})(zf||(zf={}));var bv=null;function Nv(r){bv=r}function xe(){return bv}function Pv(r,e){let t=e(r)||0;switch(t){case 1:return 1;case 0:break;case 2:return 0}for(let n=0,o=r.childCount();n<o;n=n+1)if(r.childAt1(n)!==void 0)switch(t=Pv(r.childAt1(n),e),t){case 1:return 1;case 0:break;case 2:return 0}return 0}function yn(r,e){Pv(r,e)}var __=class{constructor(e,t,n,o){this.ax=0,this.bx=0,this.cx=0,this.cy=0,this.by=0,this.ay=0,this.cx=3*e,this.bx=3*(n-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(o-t)-this.cy,this.ay=1-this.cy-this.by}_sampleCurveX(e){return((this.ax*e+this.bx)*e+this.cx)*e}_sampleCurveY(e){return((this.ay*e+this.by)*e+this.cy)*e}_sampleCurveDerivativeX(e){return(3*this.ax*e+2*this.bx)*e+this.cx}_sampleCurveDerivativeY(e){return(3*this.ay*e+2*this.by)*e+this.cy}_solveCurveX(e,t){let n=0,o=0,i=0,a=0,s=0;i=e;for(let l=0;l<8;l=l+1){if(a=this._sampleCurveX(i)-e,Math.abs(a)<t)return i;if(s=this._sampleCurveDerivativeX(i),Math.abs(s)<1e-6)break;i=i-a/s}if(n=0,o=1,i=e,i<n)return n;if(i>o)return o;for(;n<o;){if(a=this._sampleCurveX(i),Math.abs(a-e)<t)return i;e>a?n=i:o=i,i=(o-n)*.5+n}return i}solve(e,t){return this._sampleCurveY(this._solveCurveX(e,t))}getYDerivativeForXValue(e,t){let n=this._solveCurveX(e,t),o=this._sampleCurveDerivativeX(n);return Math.abs(o)>0?this._sampleCurveDerivativeY(n)/o:this._sampleCurveDerivativeY(n)}},h_=class{constructor(e,t){this._bezier=null,this._bezierInverse=null,this._durationSeconds=0,this._bezier=this.bezierForEasingFunction(e),this._bezierInverse=this.inverseBezierForEasingFunction(e),this._durationSeconds=t}bezierForEasingFunction(e){return e==null||e.length!=4?null:new __(e[0],e[1],e[2],e[3])}inverseBezierForEasingFunction(e){return e==null||e.length!=4?null:new __(e[1],e[0],e[3],e[2])}_solveEpsilon(e){return 1/(200*e)}getYValueForXValue(e){if(this._bezier==null)return e;let t=this._solveEpsilon(this._durationSeconds);return this._bezier.solve(e,t)}getDerivative(e,t){if(this._bezier==null)return 1;let n=this._solveEpsilon(this._durationSeconds);return this._bezier.getYDerivativeForXValue(e,n)}invert(e){if(this._bezier==null)return e;let t=this._solveEpsilon(this._durationSeconds);return this._bezierInverse.solve(e,t)}};var Wf=class{constructor(e,t,n,o){this.m_w0=0,this.m_zeta=0,this.m_wd=0,this.m_A=0,this.m_B=0,this.m_w0=Math.sqrt(t/e),this.m_zeta=n/(2*Math.sqrt(t*e)),this.m_zeta<1?(this.m_wd=this.m_w0*Math.sqrt(1-this.m_zeta*this.m_zeta),this.m_A=1,this.m_B=(this.m_zeta*this.m_w0+-o)/this.m_wd):(this.m_A=1,this.m_B=-o+this.m_w0)}solve(e){return this.m_zeta<1?e=Math.exp(-e*this.m_zeta*this.m_w0)*(this.m_A*Math.cos(this.m_wd*e)+this.m_B*Math.sin(this.m_wd*e)):e=(this.m_A+this.m_B*e)*Math.exp(-e*this.m_w0),1-e}solveInverse(e){let t=0,n=0,o=Math.PI/this.m_w0,i=this.solve(o),a=0,s=.001,l=15;for(let d=0;d<l;d=d+1){a=(e-n)/(i-n)*(o-t)+t;let c=this.solve(a);if(Math.abs(c-e)<s)return a;c>e?(t=a,n=c):(o=a,i=c)}return a}},m_=class{constructor(e,t){this._spring=null,this._durationSeconds=0,this._spring=this.convertFunctionToUnitSpring(e),this._durationSeconds=t}convertFunctionToUnitSpring(e){return e==null||e.length!=4?null:new Wf(e[0],e[1],e[2],e[3])}getYValueForXValue(e){if(this._spring==null)return e;let t=e*this._durationSeconds;return this._spring.solve(t)}getDerivative(e,t){return this._spring==null?1:t}invert(e){return this._spring==null?e:this._spring.solveInverse(e)/this._durationSeconds}};var wn=class wn{static easingFunctionCallbackCleanup(e){wn.easingFunctionCache.delete(e)}static cleanCache(){for(var e of wn.easingFunctionCache.entries())e[1].deref()===void 0&&(wn.easingFunctionCache.delete(e[0]),wn.easingFunctionCacheFinalizer.unregister(e[1]))}static makeEasingFunctionWithEasingType(e,t,n){wn.cleanCache();let o=null;o=this.createCacheKey(e,t,this.getAnimationType(n));let i=wn.easingFunctionCache.get(o);if(i!==void 0)return i.deref();let a=new wn(e,t,n),s=new WeakRef(a);return wn.easingFunctionCache.set(o,s),wn.easingFunctionCacheFinalizer.register(a,o,s),a}static makeEasingFunction(e,t){return wn.makeEasingFunctionWithEasingType(e,t,null)}static createCacheKey(e,t,n){let o=[];for(var i of e)o.push(i.toFixed(2));return o.push(";"),o.push(t.toFixed(2)),o.push(n),o.join()}static getAnimationType(e){return e=="GENTLE_SPRING"||e=="SPRING_PRESET_ONE"||e=="SPRING_PRESET_TWO"||e=="SPRING_PRESET_THREE"||e=="CUSTOM_SPRING"?1:0}constructor(e,t,n){this._easingFunction=e,this._animationType=wn.getAnimationType(n),this._durationSeconds=t,this._createAnimationUnit(this._easingFunction),this.bounds=wn.boundsForEasingFunction(this._easingFunction)}_createAnimationUnit(e){this._animationType==0?this._animationFunction=new h_(e,this._durationSeconds):this._animationType==1&&(this._animationFunction=new m_(e,this._durationSeconds))}get(e){return this._animationFunction.getYValueForXValue(e)}getDerivative(e,t){return this._animationFunction.getDerivative(e,t)}invert(e){return this._animationFunction.invert(e)}static boundsForEasingFunction(e){if(e==null)return Yr.FrozenRect_new3(G.fromMinAndMax(0,0,1,1));let t=fe.FrozenVector_new4(0,0),n=fe.FrozenVector_new4(e[0],e[1]),o=fe.FrozenVector_new4(e[2],e[3]),i=fe.FrozenVector_new4(1,1),a=t.clone(),s=i.clone(),l=t.negative().add(n),d=t.subtract(n.multiplyScalar(2)).add(o),c=t.negative().add(n.multiplyScalar(3)).subtract(o.multiplyScalar(3)).add(i),p=d.multiply(d).subtract(c.multiply(l));if(p.x()>0){p.setX(Math.sqrt(p.x()));for(let u of[(-d.x()-p.x())/c.x(),(-d.x()+p.x())/c.x()])if(u>0&&u<1){let _=1-u,h=_*_*_*t.x()+3*_*_*u*n.x()+3*_*u*u*o.x()+u*u*u*i.x();a.setX(Math.min(a.x(),h)),s.setX(Math.max(s.x(),h))}}if(p.y()>0){p.setY(Math.sqrt(p.y()));for(let u of[(-d.y()-p.y())/c.y(),(-d.y()+p.y())/c.y()])if(u>0&&u<1){let _=1-u,h=_*_*_*t.y()+3*_*_*u*n.y()+3*_*u*u*o.y()+u*u*u*i.y();a.setY(Math.min(a.y(),h)),s.setY(Math.max(s.y(),h))}}return G.fromMinAndMax(a.x(),a.y(),s.x(),s.y())}static easingValuesForPreset(e){switch(e){case"IN_CUBIC":return[.42,0,1,1];case"OUT_CUBIC":return[0,0,.58,1];case"INOUT_CUBIC":return[.42,0,.58,1];case"LINEAR":return[0,0,1,1];case"IN_BACK_CUBIC":return[.3,-.05,.7,-.5];case"OUT_BACK_CUBIC":return[.45,1.45,.8,1];case"INOUT_BACK_CUBIC":return[.7,-.4,.4,1.4];case"CUSTOM_CUBIC":return[0,0,.58,1];case"GENTLE_SPRING":return[1,100,15,0];case"SPRING_PRESET_ONE":return[1,300,20,0];case"SPRING_PRESET_TWO":return[1,600,15,0];case"SPRING_PRESET_THREE":return[1,80,20,0];case"CUSTOM_SPRING":return[1,100,15,0]}return[0,0,.58,1]}};wn.easingFunctionCache=new Map,wn.easingFunctionCacheFinalizer=new FinalizationRegistry(wn.easingFunctionCallbackCleanup);var Vn=wn;var Rn;(a=>{function r(s){return s=="PUSH_FROM_LEFT"||s=="PUSH_FROM_RIGHT"||s=="PUSH_FROM_TOP"||s=="PUSH_FROM_BOTTOM"}a.isPush=r;function e(s){return s=="MOVE_FROM_LEFT"||s=="MOVE_FROM_RIGHT"||s=="MOVE_FROM_TOP"||s=="MOVE_FROM_BOTTOM"}a.isMove=e;function t(s){return s=="SLIDE_FROM_LEFT"||s=="SLIDE_FROM_RIGHT"||s=="SLIDE_FROM_TOP"||s=="SLIDE_FROM_BOTTOM"}a.isSlide=t;function n(s){return s=="MOVE_OUT_TO_LEFT"||s=="MOVE_OUT_TO_RIGHT"||s=="MOVE_OUT_TO_TOP"||s=="MOVE_OUT_TO_BOTTOM"}a.isMoveOut=n;function o(s){return s=="SLIDE_OUT_TO_LEFT"||s=="SLIDE_OUT_TO_RIGHT"||s=="SLIDE_OUT_TO_TOP"||s=="SLIDE_OUT_TO_BOTTOM"}a.isSlideOut=o;function i(s){return r(s)||e(s)||n(s)||t(s)||o(s)}a.supportsSmartAnimate=i})(Rn||(Rn={}));var hi=class hi{constructor(e,t,n,o,i){this._isDeleted=!1,this._stateManagementVersion=0,this._hoverLastHandledFrameNum=-1,this._id=e,this._event=t,this._actions=n,this._isDeleted=o,this._stateManagementVersion=i,this._allActions=this.getAllActions()}getAllActions(){let e=[];for(let t of this.actions())if(e.push(t),t.connectionType()=="CONDITIONAL")for(let n of t.conditionalActions())for(let o of n.actions())e.push(o);return e}id(){return this._id!=null?this._id:X.invalid()}event(){return this._event!=null?this._event:kn.createDefault()}action(){return this._actions!=null&&this._actions.length!=0?new ce(this._actions[0]):null}actions(){return this._actions!=null?this._actions:[]}allActions(){return this._allActions!=null?this._allActions:[]}isDeleted(){return this._isDeleted}stateManagementVersion(){return this._stateManagementVersion}withEvent(e){return new hi(this._id,e,this._actions,this._isDeleted,this._stateManagementVersion)}withActions(e){return new hi(this._id,this._event,e,this._isDeleted,this._stateManagementVersion)}withStateManagementVersion(e){return new hi(this._id,this._event,this._actions,this._isDeleted,e)}isValid(){if(this.event().interactionType()=="NONE"||this._actions==null||this._actions.length==0)return!1;let e=this.action();return e!=null&&e.value.connectionType()!="NONE"}apply(e){let t=this.action(),n=e.action(),o=[];t!=null&&n!=null?o=[t.value.apply(n.value)]:t!=null?o=[t.value]:n!=null&&(o=[n.value]);let i=this._event,a=e._event,s=null;return i!=null&&a!=null?s=i.apply(a):i!=null?s=i:a!=null&&(s=a),new hi(this._id,s,o,e._isDeleted,e._stateManagementVersion)}setHoverLastHandledFrameNum(e){this._hoverLastHandledFrameNum=e}getHoverLastHandledFrameNum(){return this._hoverLastHandledFrameNum}toString(){let e="";return e+="PrototypeInteraction(",this._id!=null&&(e+=`id: ${this._id},`),this._event!=null&&(e+=`event: ${this._event.debugString()},`),this._actions!=null&&(e+=`actions: ${this._actions[0].debugString()},`),e+=`isDeleted: ${this._isDeleted},`,e+=")",e}getAllActionsWithSpecificConnectionType(e){let t=[];for(let n of this.actions())if(n.connectionType()==e)t.push(n);else if(n.connectionType()=="CONDITIONAL")for(let o of n.conditionalActions())for(let i of o.actions())n.connectionType()==e&&t.push(n);return t}getAllActionsWithSpecificTransitionType(e){let t=[];for(let n of this.actions())if(n.transitionType()==e)t.push(n);else if(n.connectionType()=="CONDITIONAL")for(let o of n.conditionalActions())for(let i of o.actions())i.transitionType()==e&&t.push(i);return t}getAllValidTransitionActionsInInteraction(){let e=[];for(let t of this.actions())if(X.isValid(t.transitionNodeID())&&["INTERNAL_NODE","BACK","CLOSE"].indexOf(t.connectionType())!=-1)e.push(t);else if(t.connectionType()=="CONDITIONAL")for(let n of t.conditionalActions())for(let o of n.actions())X.isValid(t.transitionNodeID())&&["INTERNAL_NODE","BACK","CLOSE"].indexOf(t.connectionType())!=-1&&e.push(t);return e}interactionContainsTransitionAction(){for(let e of this.actions()){if(X.isValid(e.transitionNodeID())&&["INTERNAL_NODE","BACK","CLOSE"].indexOf(e.connectionType())!=-1)return!0;if(e.connectionType()=="CONDITIONAL"){for(let t of e.conditionalActions())for(let n of t.actions())if(X.isValid(e.transitionNodeID())&&["INTERNAL_NODE","BACK","CLOSE"].indexOf(e.connectionType())!=-1)return!0}}return!1}interactionContainsSpecificConnectionTypeAction(e){for(let t of this.actions()){if(t.connectionType()==e)return!0;if(t.connectionType()=="CONDITIONAL"){for(let n of t.conditionalActions())for(let o of n.actions())if(t.connectionType()==e)return!0}}return!1}getFirstActionInInteractionWithSpecificNavigation(e){for(let t of this.actions())if(t.navigationType()==e)return t;return null}static createDefault(){return new hi(X.invalid(),kn.createDefault(),[],!1,0)}static equals(e,t){return e==null!=(t==null)?!1:e==null?!0:X.equals(e._id,t._id)&&kn.equals(e._event,t._event)&&ne.List_equalsWithComparison(e._actions,t._actions,(n,o)=>ir.equals(n,o))&&e._isDeleted==t._isDeleted&&e._stateManagementVersion==t._stateManagementVersion}static applyInteractions(e,t){if(e==null&&t==null)return hi.EMPTY_LIST;if(e==null)return t;if(t==null)return e;let n=e.slice();return t.forEach(o=>{let i=!1;for(let a=0,s=e.length;a<s;a=a+1){let l=e[a];if(X.equals(l.id(),o.id())){n[a]=l.apply(o),i=!0;break}}i||n.push(o)}),n.filter(o=>!o._isDeleted)}static whichAncestorToSwapState(e,t,n){let o=e!=null?e.scene().findNode(t):null,i=o?o.findContainingStateGroupOrSelf():null;if(i==null)return null;let a=e;for(;a!=null;){let s=null;a.type()=="INSTANCE"?s=e.scene().findNode(a.symbolID()):n==hi.StateSwapPolicy.INCLUDE_SYMBOLS&&a.type()=="SYMBOL"&&(s=a);let l=s?s.findContainingStateGroupOrSelf():null;if(i==l)return a;a=a.parent()}return null}static whichInstanceToSwap(e,t){return hi.whichAncestorToSwapState(e,t,hi.StateSwapPolicy.INSTANCES_ONLY)}};hi.EMPTY_LIST=[];var Gt=hi;(e=>{let r;(o=>(o[o.INCLUDE_SYMBOLS=0]="INCLUDE_SYMBOLS",o[o.INSTANCES_ONLY=1]="INSTANCES_ONLY"))(r=e.StateSwapPolicy||(e.StateSwapPolicy={}))})(Gt||(Gt={}));var Xs=class Xs{interactionType(){let e=this._interactionType!=null?this._interactionType:"ON_CLICK";return e=="NONE"?"ON_CLICK":e}interactionMaintained(){return this._interactionMaintained!=null?this._interactionMaintained.value:!1}interactionDuration(){return this._interactionDuration!=null&&this._interactionDuration.value>=0?this._interactionDuration.value:.3}keyTrigger(){return this._keyTrigger!=null?this._keyTrigger:{}}transitionTimeout(){return this._transitionTimeout!=null&&this._transitionTimeout.value>=0?this._transitionTimeout.value:.8}mediaHitTime(){return this._mediaHitTime!=null?this._mediaHitTime.value:0}withInteractionType(e){return new Xs(e,this._interactionMaintained,this._interactionDuration,this._keyTrigger,this._transitionTimeout,this._mediaHitTime)}apply(e){let t=this._interactionType,n=this._interactionMaintained,o=this._interactionDuration,i=this._keyTrigger,a=this._transitionTimeout,s=this._mediaHitTime;return e._interactionType!=null&&(t=e._interactionType),e._interactionMaintained!=null&&(n=e._interactionMaintained),e._interactionDuration!=null&&(o=e._interactionDuration),e._keyTrigger!=null&&(i=e._keyTrigger),e._transitionTimeout!=null&&(a=e._transitionTimeout),e._mediaHitTime!=null&&(s=e._mediaHitTime),new Xs(t,n,o,i,a,s)}debugString(){let e="";return e+="PrototypeEvent(",this._interactionType!=null&&(e+=`interactionType: ${this._interactionType},`),this._interactionMaintained!=null&&(e+=`interactionMaintained: ${this._interactionMaintained.value},`),this._interactionDuration!=null&&(e+=`interactionDuration: ${this._interactionDuration.value},`),this._keyTrigger!=null&&(e+=`keyTrigger: ${JSON.stringify(this._keyTrigger)},`),this._transitionTimeout!=null&&(e+=`transitionTimeout: ${this._transitionTimeout.value},`),this._mediaHitTime!=null&&(e+=`mediaHitTime: ${this._mediaHitTime.value},`),e+=")",e}static createDefault(){let e={};return e.keyCodes=[],e.triggerDevice="KEYBOARD",new Xs("NONE",new ce(!1),new ce(0),e,new ce(0),new ce(0))}static equals(e,t){return e==null!=(t==null)?!1:e==null?!0:e._interactionType==t._interactionType&&ce.equals(e._interactionMaintained,t._interactionMaintained)&&ce.equals(e._interactionDuration,t._interactionDuration)&&Kf.equals(e._keyTrigger,t._keyTrigger)&&ce.equals(e._transitionTimeout,t._transitionTimeout)}constructor(e,t,n,o,i,a){this._interactionType=e,this._interactionMaintained=t,this._interactionDuration=n,this._keyTrigger=o,this._transitionTimeout=i,this._mediaHitTime=a}};Xs.NULL_EVENT=new Xs(null,null,null,null,null,null);var kn=Xs,bd=class bd{constructor(e,t=""){this._actions=e,this._condition=t}actions(){return this._actions}condition(){return this._condition}debugString(){let e="";return e+="ConditionalActions(",this._actions!=null&&(e+=`actions: ${this._actions[0].debugString()},`),e+=")",e}static createDefault(){return new bd([])}static equals(e,t){if(e==null!=(t==null))return!1;if(e==null)return!0;let n=ne.List_equalsWithComparison(e._actions,t._actions,(i,a)=>ir.equals(i,a)),o=e._condition==t._condition;return n&&o}};bd.NULL_CONDITIONAL_ACTIONS=new bd(null);var Nd=bd,xt=class xt{constructor(e,t,n,o,i,a,s,l,d,c,p,u,_,h,S,m,f,T,y,E,v,A,I,C,g,R,D,P){this._transitionNodeID=e,this._transitionType=t,this._transitionDuration=n,this._easingType=o,this._easingFunctionValues=i,this._transitionShouldSmartAnimate=a,this._connectionType=s,this._connectionURL=l,this._overlayRelativePosition=d,this._navigationType=c,this._transitionPreserveScroll=p,this.easingFunction=this.easingFunctionFromAction(),this._extraScrollOffset=u,this._mediaAction=_,this._transitionResetVideoPosition=h,this._openUrlInNewTab=S,this._mediaSkipToTime=m,this._mediaSkipByAmount=f,this._transitionResetScrollPosition=T,this._conditionalActions=y,this._transitionResetInteractiveComponents=E,this._targetVariableID=v,this._targetVariableData=A,this._targetVariableModeID=I,this._targetVariableSetID=C,this._deprecatedTargetVariableSetKey=g,this._targetNodeFieldAlias=R,this._animationType=D,this._animationPhase=P}transitionNodeID(){return this._connectionType==null||this.connectionType()=="INTERNAL_NODE"||this.connectionType()=="UPDATE_MEDIA_RUNTIME"||this.connectionType()=="OBJECT_ANIMATION"?this._transitionNodeID!=null?this._transitionNodeID:X.invalid():X.invalid()}transitionType(){let e=this._transitionType!=null?this._transitionType:"INSTANT_TRANSITION";return this.navigationType()=="OVERLAY"&&(e=="FADE"||Rn.isPush(e)||Rn.isSlide(e))?"INSTANT_TRANSITION":e}animationType(){return this._animationType!=null?this._animationType:"NONE"}animationPhase(){return this._animationPhase!=null?this._animationPhase:"IN"}transitionDuration(){return this.transitionType()=="INSTANT_TRANSITION"&&this.connectionType()!="OBJECT_ANIMATION"?0:this._transitionDuration!=null&&this._transitionDuration.value>=0?this._transitionDuration.value:.3}easingType(){return this._easingType!=null?this._easingType:"OUT_CUBIC"}easingFunctionValues(){switch(this.easingType()){case"CUSTOM_CUBIC":case"GENTLE_SPRING":case"SPRING_PRESET_ONE":case"SPRING_PRESET_TWO":case"SPRING_PRESET_THREE":case"CUSTOM_SPRING":return this._easingFunctionValues!=null?this._easingFunctionValues:Vn.easingValuesForPreset(this.easingType());default:break}return Vn.easingValuesForPreset(this.easingType())}transitionShouldSmartAnimate(){return this._transitionShouldSmartAnimate!=null?this._transitionShouldSmartAnimate.value:!1}connectionType(){return this._connectionType!=null?this._connectionType:"NONE"}connectionURL(){return this.connectionType()=="URL"?this._connectionURL:null}overlayRelativePosition(){return this._overlayRelativePosition!=null?this._overlayRelativePosition:b.new()}navigationType(){return this._navigationType!=null?this._navigationType:"NAVIGATE"}mediaAction(){return this._mediaAction!=null?this._mediaAction:"PLAY"}transitionPreserveScroll(){return this.transitionType()=="SMART_ANIMATE"||Rn.supportsSmartAnimate(this.transitionType())&&this.transitionShouldSmartAnimate()?!0:Rn.isSlide(this.transitionType())||Rn.isPush(this.transitionType())||Rn.isMove(this.transitionType())?!1:this._transitionPreserveScroll!=null?this._transitionPreserveScroll.value:!1}transitionResetVideoPosition(){return this._transitionResetVideoPosition!=null?this._transitionResetVideoPosition.value:!1}transitionResetScrollPosition(){return this._transitionResetScrollPosition!=null?this._transitionResetScrollPosition.value:!1}transitionResetInteractiveComponents(){return this._transitionResetInteractiveComponents!=null?this._transitionResetInteractiveComponents.value:!1}openUrlInNewTab(){return this._openUrlInNewTab!=null?this._openUrlInNewTab.value:!0}extraScrollOffset(){return this._extraScrollOffset!=null?this._extraScrollOffset:b.new()}mediaSkipToTime(){return this._mediaSkipToTime!=null&&this._mediaSkipToTime.value>=0?this._mediaSkipToTime.value:0}mediaSkipByAmount(){return this._mediaSkipByAmount!=null&&this._mediaSkipByAmount.value>=0?this._mediaSkipByAmount.value:5}conditionalActions(){return this._conditionalActions!=null?this._conditionalActions:[]}targetVariableID(){return this._targetVariableID}targetVariableData(){return this._targetVariableData}targetVariableModeID(){return this._targetVariableModeID}targetVariableSetID(){return this._targetVariableSetID}deprecatedTargetVariableSetKey(){return this._deprecatedTargetVariableSetKey}targetNodeFieldAlias(){return this._targetNodeFieldAlias}withTransitionNodeID(e){let t=xt.from(this);return t._transitionNodeID=e,t}withTransitionType(e){let t=xt.from(this);return t._transitionType=e,t}withTransitionDuration(e){let t=xt.from(this);return t._transitionDuration=new ce(e),t}withEasingType(e){let t=xt.from(this);return t._easingType=e,t}withEasingFunctionValues(e){let t=xt.from(this);return t._easingFunctionValues=e,t}withTransitionShouldSmartAnimate(e){let t=xt.from(this);return t._transitionShouldSmartAnimate=new ce(e),t}withConnectionType(e){let t=xt.from(this);return t._connectionType=e,t}withConnectionURL(e){let t=xt.from(this);return t._connectionURL=e,t}withOverlayRelativePosition(e){let t=xt.from(this);return t._overlayRelativePosition=e,t}withNavigationType(e){let t=xt.from(this);return t._navigationType=e,t}withTransitionPreserveScroll(e){let t=xt.from(this);return t._transitionPreserveScroll=new ce(e),t}withExtraScrollOffset(e){let t=xt.from(this);return t._extraScrollOffset=e,t}withMediaAction(e){let t=xt.from(this);return t._mediaAction=e,t}withTransitionResetVideoPosition(e){let t=xt.from(this);return t._transitionResetVideoPosition=new ce(e),t}withOpenUrlInNewTab(e){let t=xt.from(this);return t._openUrlInNewTab=new ce(e),t}withMediaSkipToTime(e){let t=xt.from(this);return t._mediaSkipToTime=new ce(e),t}withMediaSkipByAmount(e){let t=xt.from(this);return t._mediaSkipByAmount=new ce(e),t}withTransitionResetScrollPosition(e){let t=xt.from(this);return t._transitionResetScrollPosition=new ce(e),t}withConditionalActions(e){let t=xt.from(this);return t._conditionalActions=e,t}withTransitionResetInteractiveComponents(e){let t=xt.from(this);return t._transitionResetInteractiveComponents=new ce(e),t}withTargetVariableID(e){let t=xt.from(this);return t._targetVariableID=e,t}withTargetVariableData(e){let t=xt.from(this);return t._targetVariableData=e,t}withTargetVariableModeID(e){let t=xt.from(this);return t._targetVariableModeID=e,t}withTargetVariableSetID(e){let t=xt.from(this);return t._targetVariableSetID=e,t}withDeprecatedTargetVariableSetKey(e){let t=xt.from(this);return t._deprecatedTargetVariableSetKey=e,t}withTargetNodeFieldAlias(e){let t=xt.from(this);return t._targetNodeFieldAlias=e,t}withAnimationType(e){let t=xt.from(this);return t._animationType=e,t}withAnimationPhase(e){let t=xt.from(this);return t._animationPhase=e,t}easingFunctionFromAction(){return Vn.makeEasingFunctionWithEasingType(this.easingFunctionValues(),this.transitionDuration(),this._easingType)}apply(e){let t=this._transitionNodeID,n=this._transitionType,o=this._transitionDuration,i=this._easingType,a=this._easingFunctionValues,s=this._transitionShouldSmartAnimate,l=this._connectionType,d=this._connectionURL,c=this._overlayRelativePosition,p=this._navigationType,u=this._transitionPreserveScroll,_=this._extraScrollOffset,h=this._mediaAction,S=this._transitionResetVideoPosition,m=this._openUrlInNewTab,f=this._mediaSkipToTime,T=this._mediaSkipByAmount,y=this._transitionResetScrollPosition,E=this._conditionalActions,v=this._transitionResetInteractiveComponents,A=this._targetVariableID,I=this._targetVariableData,C=this._targetVariableModeID,g=this._targetVariableSetID,R=this._deprecatedTargetVariableSetKey,D=this._targetNodeFieldAlias,P=this._animationType,U=this._animationPhase;return e._transitionNodeID!=null&&(t=e._transitionNodeID),e._transitionType!=null&&(n=e._transitionType),e._transitionDuration!=null&&(o=e._transitionDuration),e._easingType!=null&&(i=e._easingType),e._easingFunctionValues!=null&&(a=e._easingFunctionValues),e._transitionShouldSmartAnimate!=null&&(s=e._transitionShouldSmartAnimate),e._connectionType!=null&&(l=e._connectionType),e._connectionURL!=null&&(d=e._connectionURL),e._overlayRelativePosition!=null&&(c=e._overlayRelativePosition),e._navigationType!=null&&(p=e._navigationType),e._transitionPreserveScroll!=null&&(u=e._transitionPreserveScroll),e._extraScrollOffset!=null&&(_=e._extraScrollOffset),e._mediaAction!=null&&(h=e._mediaAction),e._transitionResetVideoPosition!=null&&(S=e._transitionResetVideoPosition),e._openUrlInNewTab!=null&&(m=e._openUrlInNewTab),e._mediaSkipToTime!=null&&(f=e._mediaSkipToTime),e._mediaSkipByAmount!=null&&(T=e._mediaSkipByAmount),e._transitionResetScrollPosition!=null&&(y=e._transitionResetScrollPosition),e._conditionalActions!=null&&(E=e._conditionalActions),e._transitionResetInteractiveComponents!=null&&(v=e._transitionResetInteractiveComponents),e._targetVariableID!=null&&(A=e._targetVariableID),e._targetVariableData!=null&&(I=e._targetVariableData),e._targetVariableModeID!=null&&(C=e._targetVariableModeID),e._targetVariableSetID!=null&&(g=e._targetVariableSetID),e._deprecatedTargetVariableSetKey!=null&&(R=e._deprecatedTargetVariableSetKey),e._targetNodeFieldAlias!=null&&(D=e._targetNodeFieldAlias),e._animationType!=null&&(P=e._animationType),e._animationPhase!=null&&(U=e._animationPhase),new xt(t,n,o,i,a,s,l,d,c,p,u,_,h,S,m,f,T,y,E,v,A,I,C,g,R,D,P,U)}debugString(){let e="";return e+="PrototypeAction(",this._transitionNodeID!=null&&(e+=`transitionNodeID: ${this._transitionNodeID},`),this._transitionType!=null&&(e+=`transitionType: ${this._transitionType},`),this._transitionDuration!=null&&(e+=`transitionDuration: ${this._transitionDuration.value},`),this._easingType!=null&&(e+=`easingType: ${this._easingType},`),this._easingFunctionValues!=null&&(e+=`easingFunctionValues: ${this._easingFunctionValues.map(t=>t.toString()).join(",")},`),this._transitionShouldSmartAnimate!=null&&(e+=`transitionShouldSmartAnimate: ${this._transitionShouldSmartAnimate.value},`),this._connectionType!=null&&(e+=`connectionType: ${this._connectionType},`),this._connectionURL!=null&&(e+=`connectionURL: ${this._connectionURL},`),this._overlayRelativePosition!=null&&(e+=`overlayRelativePosition: ${this._overlayRelativePosition},`),this._navigationType!=null&&(e+=`navigationType: ${this._navigationType},`),this._transitionPreserveScroll!=null&&(e+=`transitionPreserveScroll: ${this._transitionPreserveScroll.value},`),this._extraScrollOffset!=null&&(e+=`extraScrollOffset: ${this._extraScrollOffset},`),this._mediaAction!=null&&(e+=`mediaAction: ${this._mediaAction},`),this._transitionResetVideoPosition!=null&&(e+=`transitionResetVideoPosition: ${this._transitionResetVideoPosition.value},`),this._openUrlInNewTab!=null&&(e+=`openUrlInNewTab: ${this._openUrlInNewTab.value},`),this._mediaSkipToTime!=null&&(e+=`mediaSkipToTime: ${this._mediaSkipToTime.value},`),this._mediaSkipByAmount!=null&&(e+=`mediaSkipByAmount: ${this._mediaSkipByAmount.value},`),this._transitionResetScrollPosition!=null&&(e+=`transitionResetScrollPosition: ${this._transitionResetScrollPosition.value},`),this._conditionalActions!=null&&this._conditionalActions.length>0&&(e+=`conditionalActions: ${this._conditionalActions[0].debugString()},`),this._transitionResetInteractiveComponents!=null&&(e+=`transitionResetInteractiveComponents: ${this._transitionResetInteractiveComponents.value},`),this._targetNodeFieldAlias!=null&&(e+=`targetNodeFieldAlias: ${this._targetNodeFieldAlias},`),this._animationType!=null&&(e+=`animationType: ${this._animationType},`),this._animationPhase!=null&&(e+=`animationPhase: ${this._animationPhase},`),e+=")",e}static from(e){return new xt(e._transitionNodeID,e._transitionType,e._transitionDuration,e._easingType,e._easingFunctionValues,e._transitionShouldSmartAnimate,e._connectionType,e._connectionURL,e._overlayRelativePosition,e._navigationType,e._transitionPreserveScroll,e._extraScrollOffset,e._mediaAction,e._transitionResetVideoPosition,e._openUrlInNewTab,e._mediaSkipToTime,e._mediaSkipByAmount,e._transitionResetScrollPosition,e._conditionalActions,e._transitionResetInteractiveComponents,e._targetVariableID,e._targetVariableData,e._targetVariableModeID,e._targetVariableSetID,e._deprecatedTargetVariableSetKey,e._targetNodeFieldAlias,e._animationType,e._animationPhase)}static createDefault(){return new xt(X.invalid(),"INSTANT_TRANSITION",new ce(0),"IN_CUBIC",Vn.easingValuesForPreset("IN_CUBIC"),new ce(!1),"NONE",null,new b(0,0),"NAVIGATE",new ce(!1),new b(0,0),"PLAY",new ce(!1),new ce(!0),new ce(0),new ce(5),new ce(!1),[],new ce(!1),null,null,null,null,null,null,"NONE","IN")}static equals(e,t){return e==null!=(t==null)?!1:e==null?!0:X.equals(e._transitionNodeID,t._transitionNodeID)&&e._transitionType==t._transitionType&&ce.equals(e._transitionDuration,t._transitionDuration)&&e._easingType==t._easingType&&ne.List_equalsWithComparison(e._easingFunctionValues,t._easingFunctionValues,(n,o)=>Math.abs(n-o)<1e-6)&&ce.equals(e._transitionShouldSmartAnimate,t._transitionShouldSmartAnimate)&&e._connectionType==t._connectionType&&e._connectionURL==t._connectionURL&&b.equals_(e._overlayRelativePosition,t._overlayRelativePosition)&&e._navigationType==t._navigationType&&ce.equals(e._transitionPreserveScroll,t._transitionPreserveScroll)&&ce.equals(e._transitionResetVideoPosition,t._transitionResetVideoPosition)&&ce.equals(e._openUrlInNewTab,t._openUrlInNewTab)&&b.equals_(e._extraScrollOffset,t._extraScrollOffset)&&e._mediaAction==t._mediaAction&&ce.equals(e._mediaSkipToTime,t._mediaSkipToTime)&&ce.equals(e._mediaSkipByAmount,t._mediaSkipByAmount)&&ce.equals(e._transitionResetScrollPosition,t._transitionResetScrollPosition)&&ne.List_equalsWithComparison(e._conditionalActions,t._conditionalActions,(n,o)=>Nd.equals(n,o))&&ce.equals(e._transitionResetInteractiveComponents,t._transitionResetInteractiveComponents)&&e._targetVariableSetID==t._targetVariableSetID&&e._targetVariableID==t._targetVariableID&&e._targetVariableData==t._targetVariableData&&e._targetVariableModeID==t._targetVariableModeID&&e._deprecatedTargetVariableSetKey==t._deprecatedTargetVariableSetKey&&e._targetNodeFieldAlias==t._targetNodeFieldAlias&&e._animationType==t._animationType&&e._animationPhase==t._animationPhase}};xt.NULL_ACTION=new xt(null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,[],null,null,null,null,null,null,null,null,null);var ir=xt,Kf;(e=>{function r(t,n){return t==null!=(n==null)?!1:t==null?!0:ne.List_equalsWithComparison(t.keyCodes,n.keyCodes,(o,i)=>o==i)&&t.triggerDevice==n.triggerDevice}e.equals=r})(Kf||(Kf={}));var qi=class r{constructor(e,t,n,o,i){this._styleOverrideTable=e,this._fontSizes=t,this._characters=n,this._lines=o,this._characterStyleIds=i}characters(){return this._characters}characterStyleIds(){return this._characterStyleIds}lines(){return this._lines}styleOverrideTable(){return this._styleOverrideTable}fontSizes(){return this._fontSizes}static forTests1(){return new r(new $r,null,"",[],[])}static forTests2(e){return new r(e,null,"",[],[])}},f_=class{constructor(e){this.paintOverrides=null,this.styleOverrideTable=null,this.paintOverrides=new So(e),this.styleOverrideTable=e}};var g_;(t=>{function r(n){return X._new(n,t._nextLocalID=t._nextLocalID+1)}t.make=r,t._nextLocalID=0})(g_||(g_={}));var qs=class r{constructor(){this.assertEquals=AssertLib.strictEqual,this.trackingCalls=[],this._uninstall=null,this._uninstall=Ae.mockTrackEvent((e,t,n)=>{this.trackingCalls.push(new r.TrackingPayload(e,t,n))})}uninstall(){this._uninstall()}expectTrackToHaveBeenCalledWith1(e,t){this.expectTrackToHaveBeenCalledWith2(e,t,{})}expectTrackToHaveBeenCalledWith2(e,t,n){this.trackingCalls.some(o=>o.equalsWithSubsetOfArgs(new r.TrackingPayload(e,t,n)))}};(e=>{class r{equalsWithSubsetOfArgs(n){if(this.name!=n.name)return!1;for(let o of Object.keys(n.args))if(n.args[o]!==this.args[o])return!1;for(let o of Object.keys(n.options))if(n.options[o]!==this.options[o])return!1;return!0}constructor(n,o,i){this.name=n,this.args=o,this.options=i}}e.TrackingPayload=r})(qs||(qs={}));function Wo(r){if(!Gr())throw new Error(r)}function Fv(r){Vl=Vl+1;let e=X._new(1,Vl);for(let t=0,n=r.totalNodeCount();t<n&&r.findNode(e)!=null;t=t+1)Vl=Vl+1,e=X._new(1,Vl);return e}function Xr(r,e){let t=r.scene().createNode(Fv(r.scene()));return t.setVisible(!0),t.setOpacity(1),t.setType(e),e!="CANVAS"&&e!="DOCUMENT"&&(t.setRelativeTransform(J.new2()),t.setSize(new b(100,100))),r.appendChild(t),t}function qe(r,e){return ar(r,e,O.BLACK)}function Io(r,e,t){let n=Xr(r,"FRAME");return n.setName(e),n.setBackgroundOpacity(1),n.setIsBackgroundEnabled(!0),n.setIsFrameMaskDisabled(!1),n.setIsResizeToFit(!1),n.setTestOnlyFillPaints([t]),n.setStrokeAlign("CENTER"),n}function Zs(r,e,t,n,o){let i=Xr(r,"FRAME");return i.setName(e),i.setBackgroundOpacity(1),i.setIsBackgroundEnabled(!0),i.setIsFrameMaskDisabled(!1),i.setIsResizeToFit(!1),i.setStrokeAlign("CENTER"),i.setTestOnlyFillPaints(t),i.setTestOnlyStrokeGeometry(new wr([new Dr("NONZERO",0,Rt.forCenterStrokeAroundRect(o,10),o)],null,o,null)),i.setTestOnlyStrokePaints(n),i}function ar(r,e,t){let n=new $("SOLID");return n.setColor(t),n.setOpacity(1),n.setIsEnabled(!0),Io(r,e,n)}function Dv(r,e){let t=$.createLinearGradient([new je(O.new3(1,.5,0,1),.25),new je(O.new3(0,.5,1,1),.75)]);return Io(r,e,t)}function Ni(r){let e=Xr(r,"FRAME");return e.setName("Group"),e.setBackgroundOpacity(1),es(e,!1),e.setIsResizeToFit(!0),e}function kl(r){let e=Xr(r,"BOOLEAN_OPERATION");return e.setName("Boolean Operation"),e.setBackgroundOpacity(1),e.setIsBackgroundEnabled(!1),e.setIsResizeToFit(!0),e}function Ea(r,e){let t=Ni(r);return t.setName(e),t}function et(r){return qe(r,"Frame")}function wv(r){return Xr(r,"VECTOR")}function vn(r){return Xr(r,"RECTANGLE")}function Xe(r,e){let t=vn(r);return t.setName(e),t}function Lv(r,e){let t=Xr(r,"ROUNDED_RECTANGLE");return t.setCornerRadius(e),t}function A_(r){return Xr(r,"TEXT")}function WF(r,e){let t=A_(r);return t.setName(e),t}function Pi(r){return Xr(r,"SYMBOL")}function $a(r,e){let t=Xr(r,"INSTANCE");return t.setTestOnlySymbolData(new Ta(e.id(),zo.new1([],[]))),t}function mi(r){let e=new G(0,0,r.width(),r.height()),t=new Dr("NONZERO",0,St.fromRect(e),e);return new wr([t],null,t.bounds(),new So(new $r))}function xv(r,e){let t=new Dr("NONZERO",0,Rt.fromRoundedRect1(new da(2,G.new3(r),e,null,0)),r);return new wr([t],null,t.bounds(),new So(new $r))}function Bv(r){let e=Rt.new2();e.moveTo1(r.topLeft().x(),r.topLeft().y()).lineTo(r.topRight().x(),r.topRight().y()).lineTo(r.bottomLeft().x(),r.bottomLeft().y()).close();let t=new Dr("NONZERO",0,e,r);return new wr([t],null,t.bounds(),new So(new $r))}function Mv(r){let e=[];ht.INSTANCE.reset();for(let t of r)e.push(new Dr("NONZERO",0,Rt.fromRect(t),t)),ht.INSTANCE.include3(t);return new wr(e,null,ht.INSTANCE.build(),new So(new $r))}function Js(r,e){Yf(r,e.id())}function Yf(r,e){var o;let t=r.prototypeInteractions().length==0?Gt.createDefault():r.prototypeInteractions()[0],n=t.action()!=null?(o=t.action())==null?void 0:o.value:ir.createDefault();r.setTestOnlyPrototypeInteractions([t.withActions([n.withTransitionNodeID(e).withConnectionType("INTERNAL_NODE")])])}function Lr(r,e,t,n,o){return S_(r,e,t,n,o,!1)}function S_(r,e,t,n,o,i){switch(o){case"NAVIGATE":{Js(r,e);break}case"OVERLAY":{Hl(r,e);break}case"SWAP":{E_(r,e);break}case"SWAP_STATE":{KF(r,e);break}}let a=r.prototypeInteractions()[0];return r.setTestOnlyPrototypeInteractions([a.withEvent(a.event().withInteractionType(t)).withActions([a.action().value.withTransitionType(n).withTransitionShouldSmartAnimate(i)]).withStateManagementVersion(1)]),r.prototypeInteractions()[0]}function T_(r){var n;let e=r.prototypeInteractions().length==0?Gt.createDefault():r.prototypeInteractions()[0],t=e.action()!=null?(n=e.action())==null?void 0:n.value:ir.createDefault();r.setTestOnlyPrototypeInteractions([e.withActions([t.withConnectionType("BACK")])])}function Hl(r,e){Qf(r,e,b.new())}function Qf(r,e,t){var i;let n=r.prototypeInteractions().length==0?Gt.createDefault():r.prototypeInteractions()[0],o=n.action()!=null?(i=n.action())==null?void 0:i.value:ir.createDefault();r.setTestOnlyPrototypeInteractions([n.withActions([o.withTransitionNodeID(e.id()).withConnectionType("INTERNAL_NODE").withOverlayRelativePosition(t).withNavigationType("OVERLAY")])])}function E_(r,e){var o;let t=r.prototypeInteractions().length==0?Gt.createDefault():r.prototypeInteractions()[0],n=t.action()!=null?(o=t.action())==null?void 0:o.value:ir.createDefault();r.setTestOnlyPrototypeInteractions([t.withActions([n.withTransitionNodeID(e.id()).withConnectionType("INTERNAL_NODE").withNavigationType("SWAP")])])}function KF(r,e){var o;let t=r.prototypeInteractions().length==0?Gt.createDefault():r.prototypeInteractions()[0],n=t.action()!=null?(o=t.action())==null?void 0:o.value:ir.createDefault();r.setTestOnlyPrototypeInteractions([t.withActions([n.withTransitionNodeID(e.id()).withConnectionType("INTERNAL_NODE").withNavigationType("SWAP_STATE")])])}function Xf(r){var n;let e=r.prototypeInteractions().length==0?Gt.createDefault():r.prototypeInteractions()[0],t=e.action()!=null?(n=e.action())==null?void 0:n.value:ir.createDefault();r.setTestOnlyPrototypeInteractions([e.withActions([t.withConnectionType("CLOSE")])])}function I_(r,e){let t=r.prototypeInteractions().length==0?Gt.createDefault():r.prototypeInteractions()[0];r.setTestOnlyPrototypeInteractions([t.withEvent(t.event().withInteractionType(e))])}function He(r,e,t){let n=J.new2();n.translate1(e),r.setRelativeTransform(n),r.setSize(t)}function ie(r,e){let t=Xe(r,e);return t.setTestOnlyFillPaints([$.createSolid(O.RED,1)]),t.setTestOnlyFillGeometry(mi(G.new4(new b(0,0),t.size()))),t}function Ft(r,e,t,n){let o=Xe(r,e);return o.setTestOnlyFillPaints([$.createSolid(t,n)]),o.setTestOnlyFillGeometry(mi(G.new4(new b(0,0),o.size()))),o}function y_(r,e,t){let n=Xe(r,e);return n.setTestOnlyFillPaints(t),n.setTestOnlyFillGeometry(mi(G.new4(new b(0,0),n.size()))),n}function Pd(r,e,t){let n=Xe(r,e);return n.setSize(t),n.setTestOnlyFillPaints(Se.fromPaint(new $("IMAGE"))),n.setTestOnlyFillGeometry(mi(G.new4(new b(0,0),n.size()))),n}function qf(r,e,t){let n=Xr(r,"VECTOR");return n.setName(e),n.setSize(t),n.setTestOnlyFillPaints(Se.fromPaint(new $("IMAGE"))),n.setTestOnlyFillGeometry(Bv(G.new4(new b(0,0),n.size()))),n}function Ln(r,e,t,n,o){let i=Xe(r,e);return i.setSize(o),i.setTestOnlyFillPaints([$.createSolid(t,n)]),i.setTestOnlyFillGeometry(mi(G.new4(new b(0,0),i.size()))),i}function Zf(r,e,t,n,o){let i=Xr(r,"VECTOR");return i.setName(e),i.setSize(o),i.setTestOnlyFillPaints([$.createSolid(t,n)]),i.setTestOnlyFillGeometry(Bv(G.new4(new b(0,0),i.size()))),i}function Gv(r,e){let t=WF(r,e);return t.setTestOnlyFillPaints([$.createSolid(O.RED,1)]),t.setTestOnlyTextData(qi.forTests1()),t}function Jf(r){R_(r,[])}function R_(r,e){if(Wo("Should only be used in tests"),N()==null)throw new Error("Expected PrototypeLib to be initialized");let t=[r],n=[];for(let a=0,s=e.length;a<s;a=a+1){let l={};l.bytes=e[a],n.push(l)}let o={type:"NODE_CHANGES",sessionID:0,ackID:0,blobs:n,nodeChanges:t},i=xe().encodeMessage(o);N().applyLocalNodeChangesForTests(i)}function es(r,e){if(Wo("Writing to paints is only supported in tests because it's not fully implemented"),zt.isFrameLike(r.type())){let t=[],n=r.fillPaints();if(n!=null)for(let o=0,i=n.length;o<i;o=o+1){let a=n[o].clone();a.setIsEnabled(e),t.push(a)}r.setTestOnlyFillPaints(t)}else r.setIsBackgroundEnabled(!1)}var Vl=0;var Fd=(B=>(B[B.BOOL=0]="BOOL",B[B.DOUBLE=1]="DOUBLE",B[B.INT=2]="INT",B[B.STRING=3]="STRING",B[B.STRING_ENUM=4]="STRING_ENUM",B[B.AFFINE_TRANSFORM=5]="AFFINE_TRANSFORM",B[B.ARC_DATA=6]="ARC_DATA",B[B.GUID=7]="GUID",B[B.STYLE_ID=8]="STYLE_ID",B[B.OVERLAY_BACKGROUND_APPEARANCE=9]="OVERLAY_BACKGROUND_APPEARANCE",B[B.VECTOR=10]="VECTOR",B[B.EFFECT_LIST=11]="EFFECT_LIST",B[B.PAINT_LIST=12]="PAINT_LIST",B[B.PROTOTYPE_INTERACTION_LIST=13]="PROTOTYPE_INTERACTION_LIST",B[B.GEOMETRY=14]="GEOMETRY",B[B.PARENT_INDEX=15]="PARENT_INDEX",B[B.PROTOTYPE_DEVICE=16]="PROTOTYPE_DEVICE",B[B.PROTOTYPE_STARTING_POINT=17]="PROTOTYPE_STARTING_POINT",B[B.VIDEO_PLAYBACK=18]="VIDEO_PLAYBACK",B[B.KEY_TRIGGER=19]="KEY_TRIGGER",B[B.SYMBOL_DATA=20]="SYMBOL_DATA",B[B.TEXT_DATA=21]="TEXT_DATA",B[B.DERIVED_TEXT_DATA=22]="DERIVED_TEXT_DATA",B[B.VECTOR_DATA=23]="VECTOR_DATA",B[B.HYPERLINK=24]="HYPERLINK",B[B.MENTION=25]="MENTION",B[B.STRING_STRING_MULTIPLAYER_MAP=26]="STRING_STRING_MULTIPLAYER_MAP",B[B.NODE_BEHAVIORS=27]="NODE_BEHAVIORS",B[B.OTHER__=28]="OTHER__",B[B.END__=29]="END__",B))(Fd||{});function zl(r){switch(r){case 101:case 12:case 9:case 13:case 10:case 11:case 14:case 89:case 8:case 24:case 17:case 15:case 16:case 18:case 19:case 99:case 86:case 111:return 0;case 46:case 52:case 53:case 3:case 56:case 44:case 45:case 81:case 82:case 83:case 84:case 85:case 87:case 22:case 20:case 23:case 21:case 47:case 48:case 49:case 50:case 51:case 54:case 55:return 1;case 67:case 68:return 2;case 73:case 65:case 92:case 109:case 108:return 3;case 28:case 33:case 26:case 27:case 35:case 36:case 37:case 39:case 41:case 38:case 112:case 42:case 94:case 80:case 29:case 40:case 1:case 2:case 34:case 97:case 25:return 4;case 30:case 31:return 5;case 66:return 6;case 58:case 59:case 72:case 74:return 7;case 102:case 103:case 104:case 105:case 106:return 8;case 70:return 9;case 100:case 60:case 98:case 57:return 10;case 64:return 11;case 110:return 27;case 61:case 62:case 63:return 12;case 90:case 91:return 13;case 76:case 77:return 14;case 32:return 15;case 69:return 16;case 93:return 17;case 88:return 19;case 78:return 20;case 4:return 21;case 5:return 22;case 79:return 23;case 75:return 18;case 6:return 24;case 7:return 25;case 95:case 96:return 26;case 71:case 107:case 43:return 28;default:return 29}}var ch=ml(wc());function jf(r){return r}(function(r){r.INVALID=r("");function e(t){return t}r.toString=e})(jf||(jf={}));function Uv(r){return r}(function(r){r.INVALID=r("");function e(t){return t}r.toString=e})(Uv||(Uv={}));function Vv(r){return r}(function(r){r.INVALID=r("");function e(t){return t}r.toString=e})(Vv||(Vv={}));function kv(r){return r}(function(r){r.INVALID=r("");function e(t){return t}r.toString=e})(kv||(kv={}));function Wl(r){return r}(function(r){r.INVALID=r("");function e(t){return t}r.toString=e})(Wl||(Wl={}));function Hv(r){return r}(function(r){r.INVALID=r("");function e(t){return t}r.toString=e})(Hv||(Hv={}));function zv(r){return r}(function(r){r.INVALID=r("");function e(t){return t}r.toString=e})(zv||(zv={}));function Wv(r){return r}(function(r){r.INVALID=r("");function e(t){return t}r.toString=e})(Wv||(Wv={}));function Kv(r){return r}(function(r){r.INVALID=r("");function e(t){return t}r.toString=e})(Kv||(Kv={}));function Yv(r){return r}(function(r){r.INVALID=r("");function e(t){return t}r.toString=e})(Yv||(Yv={}));function Qv(r){return r}(function(r){r.INVALID=r("");function e(t){return t}r.toString=e})(Qv||(Qv={}));function Xv(r){return r}(function(r){r.INVALID=r("");function e(t){return t}r.toString=e})(Xv||(Xv={}));function qv(r){return r}(function(r){r.INVALID=r("");function e(t){return t}r.toString=e})(qv||(qv={}));function Zv(r){return r}(function(r){r.INVALID=r("");function e(t){return t}r.toString=e})(Zv||(Zv={}));function $f(r){return r}(function(r){r.INVALID=r("");function e(t){return t}r.toString=e})($f||($f={}));function Jv(r){return r}(function(r){r.INVALID=r("");function e(t){return t}r.toString=e})(Jv||(Jv={}));function jv(r){return r}(function(r){r.INVALID=r("");function e(t){return t}r.toString=e})(jv||(jv={}));function $v(r){return r}(function(r){r.INVALID=r("");function e(t){return t}r.toString=e})($v||($v={}));function Kl(r){return r}(function(r){r.INVALID=r("");function e(t){return t}r.toString=e})(Kl||(Kl={}));function eO(r){return r}(function(r){r.INVALID=r("");function e(t){return t}r.toString=e})(eO||(eO={}));function tO(r){return r}(function(r){r.INVALID=r("");function e(t){return t}r.toString=e})(tO||(tO={}));function rO(r){return r}(function(r){r.INVALID=r("");function e(t){return t}r.toString=e})(rO||(rO={}));function nO(r){return r}(function(r){r.INVALID=r("");function e(t){return t}r.toString=e})(nO||(nO={}));function oO(r){return r}(function(r){r.INVALID=r("");function e(t){return t}r.toString=e})(oO||(oO={}));function iO(r){return r}(function(r){r.INVALID=r("");function e(t){return t}r.toString=e})(iO||(iO={}));function aO(r){return r}(function(r){r.INVALID=r("");function e(t){return t}r.toString=e})(aO||(aO={}));function sO(r){return r}(function(r){r.INVALID=r("");function e(t){return t}r.toString=e})(sO||(sO={}));function lO(r){return r}(function(r){r.INVALID=r("");function e(t){return t}r.toString=e})(lO||(lO={}));var cO;(function(r){r.toString=yo,r.fromString=Ro,r.fromKiwi=vo,r.isEqual=Oo,r.isValid=Co})(cO||(cO={}));var dO;(function(r){r.toString=yo,r.fromString=Ro,r.fromKiwi=vo,r.isEqual=Oo,r.isValid=Co})(dO||(dO={}));var v_;(function(r){r.toString=yo,r.fromString=Ro,r.fromKiwi=vo,r.isEqual=Oo,r.isValid=Co})(v_||(v_={}));var O_;(function(r){r.toString=yo,r.fromString=Ro,r.fromKiwi=vo,r.isEqual=Oo,r.isValid=Co})(O_||(O_={}));var C_;(function(r){r.toString=yo,r.fromString=Ro,r.fromKiwi=vo,r.isEqual=Oo,r.isValid=Co})(C_||(C_={}));var b_;(function(r){r.toString=yo,r.fromString=Ro,r.fromKiwi=vo,r.isEqual=Oo,r.isValid=Co})(b_||(b_={}));var N_;(function(r){r.toString=yo,r.fromString=Ro,r.fromKiwi=vo,r.isEqual=Oo,r.isValid=Co})(N_||(N_={}));var Dd;(function(r){r.toString=yo,r.fromString=Ro,r.fromKiwi=vo,r.isEqual=Oo,r.isValid=Co})(Dd||(Dd={}));var P_;(function(r){r.toString=yo,r.fromString=Ro,r.fromKiwi=vo,r.isEqual=Oo,r.isValid=Co})(P_||(P_={}));var F_;(function(r){r.toString=yo,r.fromString=Ro,r.fromKiwi=vo,r.isEqual=Oo,r.isValid=Co})(F_||(F_={}));var D_;(function(r){r.toString=yo,r.fromString=Ro,r.fromKiwi=vo,r.isEqual=Oo,r.isValid=Co})(D_||(D_={}));var w_;(function(r){r.toString=yo,r.fromString=Ro,r.fromKiwi=vo,r.isEqual=Oo,r.isValid=Co})(w_||(w_={}));var L_;(function(r){r.toString=yo,r.fromString=Ro,r.fromKiwi=vo,r.isEqual=Oo,r.isValid=Co})(L_||(L_={}));var x_;(function(r){r.toString=yo,r.fromString=Ro,r.fromKiwi=vo,r.isEqual=Oo,r.isValid=Co})(x_||(x_={}));function yo({key:r,version:e}){return`${jf.toString(r)}/${$f.toString(e)}`}function Ro(r){let e=r.split("/");if(e.length!==2)return null;let[t,n]=e;return t&&n?{key:t,version:n}:null}function vo({key:r,version:e}){return!r||!e?null:{key:r,version:e}}function Oo(r,e){return!r||!e?r===e:r.key===e.key&&r.version===e.version}function Co({key:r,version:e}){return!!(r&&e)}var uO={sessionID:-1,localID:-1},Ko="-1:-1";function pO(r){return r?(r.localID|0)>=0&&(r.sessionID|0)>=0:!1}function _O(r){return r?`${r.sessionID|0}:${r.localID|0}`:null}function eg(r){if(!r)return null;let e=r.split(":");if(!e||e.length!==2)return null;let t=-1,n=-1;try{t=parseInt(e[0]),n=parseInt(e[1])}catch{return null}return!isFinite(t)||!isFinite(n)?null:{sessionID:t,localID:n}}var hO;(function(r){let t=Yo("CodeLibraryId:",D_);r.INVALID=t.fromLocalNodeIdStr(Ko),r.toString=t.toString,r.toKiwi=t.toKiwi,r.toGuidObjIfLocal=t.toGuidObjIfLocal,r.toGuidStrIfLocal=t.toGuidStrIfLocal,r.toRefIfSubscribed=t.toRefIfSubscribed,r.fromString=t.fromString,r.fromLocalNodeIdObj=t.fromLocalNodeIdObj,r.fromLocalNodeIdStr=t.fromLocalNodeIdStr,r.fromRef=t.fromRef,r.fromKiwi=t.fromKiwi,r.isValid=t.isValid})(hO||(hO={}));var mO;(function(r){let t=Yo("CodeFileId:",w_);r.INVALID=t.fromLocalNodeIdStr(Ko),r.toString=t.toString,r.toKiwi=t.toKiwi,r.toGuidObjIfLocal=t.toGuidObjIfLocal,r.toGuidStrIfLocal=t.toGuidStrIfLocal,r.toRefIfSubscribed=t.toRefIfSubscribed,r.fromString=t.fromString,r.fromLocalNodeIdObj=t.fromLocalNodeIdObj,r.fromLocalNodeIdStr=t.fromLocalNodeIdStr,r.fromRef=t.fromRef,r.fromKiwi=t.fromKiwi,r.isValid=t.isValid})(mO||(mO={}));var fO;(function(r){let t=Yo("CodeComponentId:",L_);r.INVALID=t.fromLocalNodeIdStr(Ko),r.toString=t.toString,r.toKiwi=t.toKiwi,r.toGuidObjIfLocal=t.toGuidObjIfLocal,r.toGuidStrIfLocal=t.toGuidStrIfLocal,r.toRefIfSubscribed=t.toRefIfSubscribed,r.fromString=t.fromString,r.fromLocalNodeIdObj=t.fromLocalNodeIdObj,r.fromLocalNodeIdStr=t.fromLocalNodeIdStr,r.fromRef=t.fromRef,r.fromKiwi=t.fromKiwi,r.isValid=t.isValid})(fO||(fO={}));var gO;(function(r){let t=Yo("ManagedStringId:",x_);r.INVALID=t.fromLocalNodeIdStr(Ko),r.toString=t.toString,r.toKiwi=t.toKiwi,r.toGuidObjIfLocal=t.toGuidObjIfLocal,r.toGuidStrIfLocal=t.toGuidStrIfLocal,r.toRefIfSubscribed=t.toRefIfSubscribed,r.fromString=t.fromString,r.fromLocalNodeIdObj=t.fromLocalNodeIdObj,r.fromLocalNodeIdStr=t.fromLocalNodeIdStr,r.fromRef=t.fromRef,r.fromKiwi=t.fromKiwi,r.isValid=t.isValid})(gO||(gO={}));var AO;(function(r){let t=Yo("ResponsiveSetId:",F_);r.INVALID=t.fromLocalNodeIdStr(Ko),r.toString=t.toString,r.toKiwi=t.toKiwi,r.toGuidObjIfLocal=t.toGuidObjIfLocal,r.toGuidStrIfLocal=t.toGuidStrIfLocal,r.toRefIfSubscribed=t.toRefIfSubscribed,r.fromString=t.fromString,r.fromLocalNodeIdObj=t.fromLocalNodeIdObj,r.fromLocalNodeIdStr=t.fromLocalNodeIdStr,r.fromRef=t.fromRef,r.fromKiwi=t.fromKiwi,r.isValid=t.isValid})(AO||(AO={}));var SO;(function(r){let t=Yo("SymbolId:",v_);r.INVALID=t.fromLocalNodeIdStr(Ko),r.toString=t.toString,r.toKiwi=t.toKiwi,r.toGuidObjIfLocal=t.toGuidObjIfLocal,r.toGuidStrIfLocal=t.toGuidStrIfLocal,r.toRefIfSubscribed=t.toRefIfSubscribed,r.fromString=t.fromString,r.fromLocalNodeIdObj=t.fromLocalNodeIdObj,r.fromLocalNodeIdStr=t.fromLocalNodeIdStr,r.fromRef=t.fromRef,r.fromKiwi=t.fromKiwi,r.isValid=t.isValid})(SO||(SO={}));var TO;(function(r){let t=Yo("StateGroupId:",O_);r.INVALID=t.fromLocalNodeIdStr(Ko),r.toString=t.toString,r.toKiwi=t.toKiwi,r.toGuidObjIfLocal=t.toGuidObjIfLocal,r.toGuidStrIfLocal=t.toGuidStrIfLocal,r.toRefIfSubscribed=t.toRefIfSubscribed,r.fromString=t.fromString,r.fromLocalNodeIdObj=t.fromLocalNodeIdObj,r.fromLocalNodeIdStr=t.fromLocalNodeIdStr,r.fromRef=t.fromRef,r.fromKiwi=t.fromKiwi,r.isValid=t.isValid})(TO||(TO={}));var EO;(function(r){let t=Yo("StyleId:",C_);r.INVALID=t.fromLocalNodeIdStr(Ko),r.toString=t.toString,r.toKiwi=t.toKiwi,r.toGuidObjIfLocal=t.toGuidObjIfLocal,r.toGuidStrIfLocal=t.toGuidStrIfLocal,r.toRefIfSubscribed=t.toRefIfSubscribed,r.fromString=t.fromString,r.fromLocalNodeIdObj=t.fromLocalNodeIdObj,r.fromLocalNodeIdStr=t.fromLocalNodeIdStr,r.fromRef=t.fromRef,r.fromKiwi=t.fromKiwi,r.isValid=t.isValid;function n(o){return o.guid?r.fromLocalNodeIdStr(o.guid):r.fromRef(o.ref)}r.fromBindingsObj=n})(EO||(EO={}));var IO;(function(r){let t=Yo("VariableID:",b_);r.INVALID=t.fromLocalNodeIdStr(Ko),r.toString=t.toString,r.toKiwi=t.toKiwi,r.toGuidObjIfLocal=t.toGuidObjIfLocal,r.toGuidStrIfLocal=t.toGuidStrIfLocal,r.toRefIfSubscribed=t.toRefIfSubscribed,r.fromString=t.fromString,r.fromLocalNodeIdObj=t.fromLocalNodeIdObj,r.fromLocalNodeIdStr=t.fromLocalNodeIdStr,r.fromRef=t.fromRef,r.fromKiwi=t.fromKiwi,r.isValid=t.isValid})(IO||(IO={}));var yO;(function(r){let t=Yo("VariableOverrideId:",N_);r.INVALID=t.fromLocalNodeIdStr(Ko),r.toString=t.toString,r.toKiwi=t.toKiwi,r.toGuidObjIfLocal=t.toGuidObjIfLocal,r.toGuidStrIfLocal=t.toGuidStrIfLocal,r.toRefIfSubscribed=t.toRefIfSubscribed,r.fromString=t.fromString,r.fromLocalNodeIdObj=t.fromLocalNodeIdObj,r.fromLocalNodeIdStr=t.fromLocalNodeIdStr,r.fromRef=t.fromRef,r.fromKiwi=t.fromKiwi,r.isValid=t.isValid})(yO||(yO={}));var Ia;(function(r){let e="VariableCollectionId:",t="VariableSetID:",n=Yo(e,Dd),o=Yo(t,Dd);r.INVALID=n.fromLocalNodeIdStr(Ko),r.toString=n.toString,r.toKiwi=i({current:n.toKiwi,deprecated:o.toKiwi}),r.toGuidObjIfLocal=i({current:n.toGuidObjIfLocal,deprecated:o.toGuidObjIfLocal}),r.toGuidStrIfLocal=i({current:n.toGuidStrIfLocal,deprecated:o.toGuidStrIfLocal}),r.toRefIfSubscribed=i({current:n.toRefIfSubscribed,deprecated:o.toRefIfSubscribed}),r.fromString=i({current:n.fromString,deprecated:o.fromString}),r.fromLocalNodeIdObj=n.fromLocalNodeIdObj,r.fromLocalNodeIdStr=n.fromLocalNodeIdStr,r.fromRef=n.fromRef,r.fromKiwi=n.fromKiwi,r.isValid=i({current:n.isValid,deprecated:o.isValid});function i({current:a,deprecated:s}){return l=>l.startsWith(t)?s(l):a(l)}})(Ia||(Ia={}));var RO;(function(r){let t=Yo("ModuleId:",P_);r.INVALID=t.fromLocalNodeIdStr(Ko),r.toString=t.toString,r.toKiwi=t.toKiwi,r.toGuidObjIfLocal=t.toGuidObjIfLocal,r.toGuidStrIfLocal=t.toGuidStrIfLocal,r.toRefIfSubscribed=t.toRefIfSubscribed,r.fromString=t.fromString,r.fromLocalNodeIdObj=t.fromLocalNodeIdObj,r.fromLocalNodeIdStr=t.fromLocalNodeIdStr,r.fromRef=t.fromRef,r.fromKiwi=t.fromKiwi,r.isValid=t.isValid})(RO||(RO={}));function Yo(r,e){function t(m){return m}function n(m,f){return m.startsWith(r)?f(m.slice(r.length)):null}function o(m){return eg(m)}function i(m){return e.fromString(m)}function a(m){return n(m,T=>{let y=i(T);if(y)return{assetRef:y};let E=o(T);if(E)return{guid:E}})??{guid:uO}}function s(m){return n(m,f=>i(f)?null:o(f))}function l(m){return n(m,f=>i(f)?null:f)}function d(m){return n(m,f=>i(f))}function c(m){return n(m,f=>o(f)||i(f)?m:null)}function p(m){return r+_O(m)}function u(m){return eg(m)?r+m:null}function _(m){return r+e.toString(m)}function h(m){if(!m)return null;let{guid:f,assetRef:T}=m;if(f&&!T)return p(f);if(!f&&T){let y=e.fromKiwi(T);if(y)return _(y)}return null}function S(m){let f=s(m);if(f)return pO(f);let T=d(m);return T?e.isValid(T):!1}return{toString:t,toKiwi:a,toGuidObjIfLocal:s,toGuidStrIfLocal:l,toRefIfSubscribed:d,fromString:c,fromLocalNodeIdObj:p,fromLocalNodeIdStr:u,fromRef:_,fromKiwi:h,isValid:S}}function H_(r){return z_(r.map(([e,t])=>new Array(e).fill(t,0,e)))}function z_(r){return r.reduce((e,t)=>e.concat(Array.isArray(t)?z_(t):t),[])}var vO=[0,1,2,3].concat(...H_([[2,4],[2,5],[4,6],[4,7],[8,8],[8,9],[16,10],[16,11],[32,12],[32,13],[64,14],[64,15],[2,0],[1,16],[1,17],[2,18],[2,19],[4,20],[4,21],[8,22],[8,23],[16,24],[16,25],[32,26],[32,27],[64,28],[64,29]]));function Sr(){let r=this;function e(o){let i=r.dyn_tree,a=r.stat_desc.static_tree,s=r.stat_desc.extra_bits,l=r.stat_desc.extra_base,d=r.stat_desc.max_length,c,p,u,_,h,S,m=0;for(_=0;_<=15;_++)o.bl_count[_]=0;for(i[o.heap[o.heap_max]*2+1]=0,c=o.heap_max+1;c<573;c++)p=o.heap[c],_=i[i[p*2+1]*2+1]+1,_>d&&(_=d,m++),i[p*2+1]=_,!(p>r.max_code)&&(o.bl_count[_]++,h=0,p>=l&&(h=s[p-l]),S=i[p*2],o.opt_len+=S*(_+h),a&&(o.static_len+=S*(a[p*2+1]+h)));if(m!==0){do{for(_=d-1;o.bl_count[_]===0;)_--;o.bl_count[_]--,o.bl_count[_+1]+=2,o.bl_count[d]--,m-=2}while(m>0);for(_=d;_!==0;_--)for(p=o.bl_count[_];p!==0;)u=o.heap[--c],!(u>r.max_code)&&(i[u*2+1]!=_&&(o.opt_len+=(_-i[u*2+1])*i[u*2],i[u*2+1]=_),p--)}}function t(o,i){let a=0;do a|=o&1,o>>>=1,a<<=1;while(--i>0);return a>>>1}function n(o,i,a){let s=[],l=0,d,c,p;for(d=1;d<=15;d++)s[d]=l=l+a[d-1]<<1;for(c=0;c<=i;c++)p=o[c*2+1],p!==0&&(o[c*2]=t(s[p]++,p))}r.build_tree=function(o){let i=r.dyn_tree,a=r.stat_desc.static_tree,s=r.stat_desc.elems,l,d,c=-1,p;for(o.heap_len=0,o.heap_max=573,l=0;l<s;l++)i[l*2]!==0?(o.heap[++o.heap_len]=c=l,o.depth[l]=0):i[l*2+1]=0;for(;o.heap_len<2;)p=o.heap[++o.heap_len]=c<2?++c:0,i[p*2]=1,o.depth[p]=0,o.opt_len--,a&&(o.static_len-=a[p*2+1]);for(r.max_code=c,l=Math.floor(o.heap_len/2);l>=1;l--)o.pqdownheap(i,l);p=s;do l=o.heap[1],o.heap[1]=o.heap[o.heap_len--],o.pqdownheap(i,1),d=o.heap[1],o.heap[--o.heap_max]=l,o.heap[--o.heap_max]=d,i[p*2]=i[l*2]+i[d*2],o.depth[p]=Math.max(o.depth[l],o.depth[d])+1,i[l*2+1]=i[d*2+1]=p,o.heap[1]=p++,o.pqdownheap(i,1);while(o.heap_len>=2);o.heap[--o.heap_max]=o.heap[1],e(o),n(i,r.max_code,o.bl_count)}}Sr._length_code=[0,1,2,3,4,5,6,7].concat(...H_([[2,8],[2,9],[2,10],[2,11],[4,12],[4,13],[4,14],[4,15],[8,16],[8,17],[8,18],[8,19],[16,20],[16,21],[16,22],[16,23],[32,24],[32,25],[32,26],[31,27],[1,28]]));Sr.base_length=[0,1,2,3,4,5,6,7,8,10,12,14,16,20,24,28,32,40,48,56,64,80,96,112,128,160,192,224,0];Sr.base_dist=[0,1,2,3,4,6,8,12,16,24,32,48,64,96,128,192,256,384,512,768,1024,1536,2048,3072,4096,6144,8192,12288,16384,24576];Sr.d_code=function(r){return r<256?vO[r]:vO[256+(r>>>7)]};Sr.extra_lbits=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0];Sr.extra_dbits=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];Sr.extra_blbits=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7];Sr.bl_order=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];function xn(r,e,t,n,o){let i=this;i.static_tree=r,i.extra_bits=e,i.extra_base=t,i.elems=n,i.max_length=o}var QF=[12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254,1,129,65,193,33,161,97,225,17,145,81,209,49,177,113,241,9,137,73,201,41,169,105,233,25,153,89,217,57,185,121,249,5,133,69,197,37,165,101,229,21,149,85,213,53,181,117,245,13,141,77,205,45,173,109,237,29,157,93,221,61,189,125,253,19,275,147,403,83,339,211,467,51,307,179,435,115,371,243,499,11,267,139,395,75,331,203,459,43,299,171,427,107,363,235,491,27,283,155,411,91,347,219,475,59,315,187,443,123,379,251,507,7,263,135,391,71,327,199,455,39,295,167,423,103,359,231,487,23,279,151,407,87,343,215,471,55,311,183,439,119,375,247,503,15,271,143,399,79,335,207,463,47,303,175,431,111,367,239,495,31,287,159,415,95,351,223,479,63,319,191,447,127,383,255,511,0,64,32,96,16,80,48,112,8,72,40,104,24,88,56,120,4,68,36,100,20,84,52,116,3,131,67,195,35,163,99,227],XF=H_([[144,8],[112,9],[24,7],[8,8]]);xn.static_ltree=z_(QF.map((r,e)=>[r,XF[e]]));var qF=[0,16,8,24,4,20,12,28,2,18,10,26,6,22,14,30,1,17,9,25,5,21,13,29,3,19,11,27,7,23],ZF=H_([[30,5]]);xn.static_dtree=z_(qF.map((r,e)=>[r,ZF[e]]));xn.static_l_desc=new xn(xn.static_ltree,Sr.extra_lbits,257,286,15);xn.static_d_desc=new xn(xn.static_dtree,Sr.extra_dbits,0,30,15);xn.static_bl_desc=new xn(null,Sr.extra_blbits,0,19,7);var JF=9,jF=8;function Zi(r,e,t,n,o){let i=this;i.good_length=r,i.max_lazy=e,i.nice_length=t,i.max_chain=n,i.func=o}var CO=0,V_=1,js=2,Fi=[new Zi(0,0,0,0,CO),new Zi(4,4,8,4,V_),new Zi(4,5,16,8,V_),new Zi(4,6,32,32,V_),new Zi(4,4,16,16,js),new Zi(8,16,32,32,js),new Zi(8,16,128,128,js),new Zi(8,32,128,256,js),new Zi(32,128,258,1024,js),new Zi(32,258,258,4096,js)],B_=["need dictionary","stream end","","","stream error","data error","","buffer error","",""],fi=0,M_=1,wd=2,G_=3,$F=32,tg=42,U_=113,Ld=666,rg=8,eD=0,ng=1,tD=2,br=3,k_=258,Qo=k_+br+1;function OO(r,e,t,n){let o=r[e*2],i=r[t*2];return o<i||o==i&&n[e]<=n[t]}function rD(){let r=this,e,t,n,o,i,a,s,l,d,c,p,u,_,h,S,m,f,T,y,E,v,A,I,C,g,R,D,P,U,B,M,F,w,V=new Sr,k=new Sr,H=new Sr;r.depth=[];let z,Q,K,j,pe,Pe;r.bl_count=[],r.heap=[],M=[],F=[],w=[];function at(){d=2*i,p[_-1]=0;for(let re=0;re<_-1;re++)p[re]=0;R=Fi[D].max_lazy,U=Fi[D].good_length,B=Fi[D].nice_length,g=Fi[D].max_chain,v=0,f=0,I=0,T=C=br-1,E=0,u=0}function Ke(){let re;for(re=0;re<286;re++)M[re*2]=0;for(re=0;re<30;re++)F[re*2]=0;for(re=0;re<19;re++)w[re*2]=0;M[256*2]=1,r.opt_len=r.static_len=0,Q=K=0}function _t(){V.dyn_tree=M,V.stat_desc=xn.static_l_desc,k.dyn_tree=F,k.stat_desc=xn.static_d_desc,H.dyn_tree=w,H.stat_desc=xn.static_bl_desc,pe=0,Pe=0,j=8,Ke()}r.pqdownheap=function(re,Te){let ae=r.heap,L=ae[Te],x=Te<<1;for(;x<=r.heap_len&&(x<r.heap_len&&OO(re,ae[x+1],ae[x],r.depth)&&x++,!OO(re,L,ae[x],r.depth));)ae[Te]=ae[x],Te=x,x<<=1;ae[Te]=L};function bt(re,Te){let ae=-1,L,x=re[0*2+1],W=0,Z=7,te=4;x===0&&(Z=138,te=3),re[(Te+1)*2+1]=65535;for(let se=0;se<=Te;se++)L=x,x=re[(se+1)*2+1],!(++W<Z&&L==x)&&(W<te?w[L*2]+=W:L!==0?(L!=ae&&w[L*2]++,w[16*2]++):W<=10?w[17*2]++:w[18*2]++,W=0,ae=L,x===0?(Z=138,te=3):L==x?(Z=6,te=3):(Z=7,te=4))}function Xt(){let re;for(bt(M,V.max_code),bt(F,k.max_code),H.build_tree(r),re=18;re>=3&&w[Sr.bl_order[re]*2+1]===0;re--);return r.opt_len+=3*(re+1)+5+5+4,re}function oe(re){r.pending_buf[r.pending++]=re}function vt(re){oe(re&255),oe(re>>>8&255)}function Er(re){oe(re>>8&255),oe(re&255&255)}function dt(re,Te){let ae,L=Te;Pe>16-L?(ae=re,pe|=ae<<Pe&65535,vt(pe),pe=ae>>>16-Pe,Pe+=L-16):(pe|=re<<Pe&65535,Pe+=L)}function We(re,Te){let ae=re*2;dt(Te[ae]&65535,Te[ae+1]&65535)}function mt(re,Te){let ae,L=-1,x,W=re[0*2+1],Z=0,te=7,se=4;for(W===0&&(te=138,se=3),ae=0;ae<=Te;ae++)if(x=W,W=re[(ae+1)*2+1],!(++Z<te&&x==W)){if(Z<se)do We(x,w);while(--Z!==0);else x!==0?(x!=L&&(We(x,w),Z--),We(16,w),dt(Z-3,2)):Z<=10?(We(17,w),dt(Z-3,3)):(We(18,w),dt(Z-11,7));Z=0,L=x,W===0?(te=138,se=3):x==W?(te=6,se=3):(te=7,se=4)}}function Qe(re,Te,ae){let L;for(dt(re-257,5),dt(Te-1,5),dt(ae-4,4),L=0;L<ae;L++)dt(w[Sr.bl_order[L]*2+1],3);mt(M,re-1),mt(F,Te-1)}function Ut(){Pe==16?(vt(pe),pe=0,Pe=0):Pe>=8&&(oe(pe&255),pe>>>=8,Pe-=8)}function $t(){dt(ng<<1,3),We(256,xn.static_ltree),Ut(),1+j+10-Pe<9&&(dt(ng<<1,3),We(256,xn.static_ltree),Ut()),j=7}function Wt(re,Te){let ae,L,x;if(r.dist_buf[Q]=re,r.lc_buf[Q]=Te&255,Q++,re===0?M[Te*2]++:(K++,re--,M[(Sr._length_code[Te]+256+1)*2]++,F[Sr.d_code(re)*2]++),(Q&8191)===0&&D>2){for(ae=Q*8,L=v-f,x=0;x<30;x++)ae+=F[x*2]*(5+Sr.extra_dbits[x]);if(ae>>>=3,K<Math.floor(Q/2)&&ae<Math.floor(L/2))return!0}return Q==z-1}function xr(re,Te){let ae,L,x=0,W,Z;if(Q!==0)do ae=r.dist_buf[x],L=r.lc_buf[x],x++,ae===0?We(L,re):(W=Sr._length_code[L],We(W+256+1,re),Z=Sr.extra_lbits[W],Z!==0&&(L-=Sr.base_length[W],dt(L,Z)),ae--,W=Sr.d_code(ae),We(W,Te),Z=Sr.extra_dbits[W],Z!==0&&(ae-=Sr.base_dist[W],dt(ae,Z)));while(x<Q);We(256,re),j=re[256*2+1]}function Br(){Pe>8?vt(pe):Pe>0&&oe(pe&255),pe=0,Pe=0}function qr(re,Te,ae){Br(),j=8,ae&&(vt(Te),vt(~Te)),r.pending_buf.set(l.subarray(re,re+Te),r.pending),r.pending+=Te}function Bn(re,Te,ae){dt((eD<<1)+(ae?1:0),3),qr(re,Te,!0)}function ei(re,Te,ae){let L,x,W=0;D>0?(V.build_tree(r),k.build_tree(r),W=Xt(),L=r.opt_len+3+7>>>3,x=r.static_len+3+7>>>3,x<=L&&(L=x)):L=x=Te+5,Te+4<=L&&re!=-1?Bn(re,Te,ae):x==L?(dt((ng<<1)+(ae?1:0),3),xr(xn.static_ltree,xn.static_dtree)):(dt((tD<<1)+(ae?1:0),3),Qe(V.max_code+1,k.max_code+1,W+1),xr(M,F)),Ke(),ae&&Br()}function Vt(re){ei(f>=0?f:-1,v-f,re),f=v,e.flush_pending()}function ti(){let re,Te,ae,L;do{if(L=d-I-v,L===0&&v===0&&I===0)L=i;else if(L==-1)L--;else if(v>=i+i-Qo){l.set(l.subarray(i,i+i),0),A-=i,v-=i,f-=i,re=_,ae=re;do Te=p[--ae]&65535,p[ae]=Te>=i?Te-i:0;while(--re!==0);re=i,ae=re;do Te=c[--ae]&65535,c[ae]=Te>=i?Te-i:0;while(--re!==0);L+=i}if(e.avail_in===0)return;re=e.read_buf(l,v+I,L),I+=re,I>=br&&(u=l[v]&255,u=(u<<m^l[v+1]&255)&S)}while(I<Qo&&e.avail_in!==0)}function ri(re){let Te=65535,ae;for(Te>n-5&&(Te=n-5);;){if(I<=1){if(ti(),I===0&&re==0)return fi;if(I===0)break}if(v+=I,I=0,ae=f+Te,(v===0||v>=ae)&&(I=v-ae,v=ae,Vt(!1),e.avail_out===0)||v-f>=i-Qo&&(Vt(!1),e.avail_out===0))return fi}return Vt(re==4),e.avail_out===0?re==4?wd:fi:re==4?G_:M_}function Yn(re){let Te=g,ae=v,L,x,W=C,Z=v>i-Qo?v-(i-Qo):0,te=B,se=s,le=v+k_,Ee=l[ae+W-1],Ie=l[ae+W];C>=U&&(Te>>=2),te>I&&(te=I);do if(L=re,!(l[L+W]!=Ie||l[L+W-1]!=Ee||l[L]!=l[ae]||l[++L]!=l[ae+1])){ae+=2,L++;do;while(l[++ae]==l[++L]&&l[++ae]==l[++L]&&l[++ae]==l[++L]&&l[++ae]==l[++L]&&l[++ae]==l[++L]&&l[++ae]==l[++L]&&l[++ae]==l[++L]&&l[++ae]==l[++L]&&ae<le);if(x=k_-(le-ae),ae=le-k_,x>W){if(A=re,W=x,x>=te)break;Ee=l[ae+W-1],Ie=l[ae+W]}}while((re=c[re&se]&65535)>Z&&--Te!==0);return W<=I?W:I}function De(re){let Te=0,ae;for(;;){if(I<Qo){if(ti(),I<Qo&&re==0)return fi;if(I===0)break}if(I>=br&&(u=(u<<m^l[v+(br-1)]&255)&S,Te=p[u]&65535,c[v&s]=p[u],p[u]=v),Te!==0&&(v-Te&65535)<=i-Qo&&P!=2&&(T=Yn(Te)),T>=br)if(ae=Wt(v-A,T-br),I-=T,T<=R&&I>=br){T--;do v++,u=(u<<m^l[v+(br-1)]&255)&S,Te=p[u]&65535,c[v&s]=p[u],p[u]=v;while(--T!==0);v++}else v+=T,T=0,u=l[v]&255,u=(u<<m^l[v+1]&255)&S;else ae=Wt(0,l[v]&255),I--,v++;if(ae&&(Vt(!1),e.avail_out===0))return fi}return Vt(re==4),e.avail_out===0?re==4?wd:fi:re==4?G_:M_}function Ot(re){let Te=0,ae,L;for(;;){if(I<Qo){if(ti(),I<Qo&&re==0)return fi;if(I===0)break}if(I>=br&&(u=(u<<m^l[v+(br-1)]&255)&S,Te=p[u]&65535,c[v&s]=p[u],p[u]=v),C=T,y=A,T=br-1,Te!==0&&C<R&&(v-Te&65535)<=i-Qo&&(P!=2&&(T=Yn(Te)),T<=5&&(P==1||T==br&&v-A>4096)&&(T=br-1)),C>=br&&T<=C){L=v+I-br,ae=Wt(v-1-y,C-br),I-=C-1,C-=2;do++v<=L&&(u=(u<<m^l[v+(br-1)]&255)&S,Te=p[u]&65535,c[v&s]=p[u],p[u]=v);while(--C!==0);if(E=0,T=br-1,v++,ae&&(Vt(!1),e.avail_out===0))return fi}else if(E!==0){if(ae=Wt(0,l[v-1]&255),ae&&Vt(!1),v++,I--,e.avail_out===0)return fi}else E=1,v++,I--}return E!==0&&(ae=Wt(0,l[v-1]&255),E=0),Vt(re==4),e.avail_out===0?re==4?wd:fi:re==4?G_:M_}function Mr(re){return re.total_in=re.total_out=0,re.msg=null,r.pending=0,r.pending_out=0,t=U_,o=0,_t(),at(),0}r.deflateInit=function(re,Te,ae,L,x,W){return L||(L=rg),x||(x=jF),W||(W=0),re.msg=null,Te==-1&&(Te=6),x<1||x>JF||L!=rg||ae<9||ae>15||Te<0||Te>9||W<0||W>2?-2:(re.dstate=r,a=ae,i=1<<a,s=i-1,h=x+7,_=1<<h,S=_-1,m=Math.floor((h+br-1)/br),l=new Uint8Array(i*2),c=[],p=[],z=1<<x+6,r.pending_buf=new Uint8Array(z*4),n=z*4,r.dist_buf=new Uint16Array(z),r.lc_buf=new Uint8Array(z),D=Te,P=W,Mr(re))},r.deflateEnd=function(){return t!=tg&&t!=U_&&t!=Ld?-2:(r.lc_buf=null,r.dist_buf=null,r.pending_buf=null,p=null,c=null,l=null,r.dstate=null,t==U_?-3:0)},r.deflateParams=function(re,Te,ae){let L=0;return Te==-1&&(Te=6),Te<0||Te>9||ae<0||ae>2?-2:(Fi[D].func!=Fi[Te].func&&re.total_in!==0&&(L=re.deflate(1)),D!=Te&&(D=Te,R=Fi[D].max_lazy,U=Fi[D].good_length,B=Fi[D].nice_length,g=Fi[D].max_chain),P=ae,L)},r.deflateSetDictionary=function(re,Te,ae){let L=ae,x,W=0;if(!Te||t!=tg)return-2;if(L<br)return 0;for(L>i-Qo&&(L=i-Qo,W=ae-L),l.set(Te.subarray(W,W+L),0),v=L,f=L,u=l[0]&255,u=(u<<m^l[1]&255)&S,x=0;x<=L-br;x++)u=(u<<m^l[x+(br-1)]&255)&S,c[x&s]=p[u],p[u]=x;return 0},r.deflate=function(re,Te){let ae,L,x,W,Z;if(Te>4||Te<0)return-2;if(!re.next_out||!re.next_in&&re.avail_in!==0||t==Ld&&Te!=4)return re.msg=B_[4],-2;if(re.avail_out===0)return re.msg=B_[7],-5;if(e=re,W=o,o=Te,t==tg&&(L=rg+(a-8<<4)<<8,x=(D-1&255)>>1,x>3&&(x=3),L|=x<<6,v!==0&&(L|=$F),L+=31-L%31,t=U_,Er(L)),r.pending!==0){if(e.flush_pending(),e.avail_out===0)return o=-1,0}else if(e.avail_in===0&&Te<=W&&Te!=4)return e.msg=B_[7],-5;if(t==Ld&&e.avail_in!==0)return re.msg=B_[7],-5;if(e.avail_in!==0||I!==0||Te!=0&&t!=Ld){switch(Z=-1,Fi[D].func){case CO:Z=ri(Te);break;case V_:Z=De(Te);break;case js:Z=Ot(Te);break;default:}if((Z==wd||Z==G_)&&(t=Ld),Z==fi||Z==wd)return e.avail_out===0&&(o=-1),0;if(Z==M_){if(Te==1)$t();else if(Bn(0,0,!1),Te==3)for(ae=0;ae<_;ae++)p[ae]=0;if(e.flush_pending(),e.avail_out===0)return o=-1,0}}return Te!=4?0:1}}function bO(){let r=this;r.next_in_index=0,r.next_out_index=0,r.avail_in=0,r.total_in=0,r.avail_out=0,r.total_out=0}bO.prototype={deflateInit:function(r,e){let t=this;return t.dstate=new rD,e||(e=15),t.dstate.deflateInit(t,r,e)},deflate:function(r){let e=this;return e.dstate?e.dstate.deflate(e,r):-2},deflateEnd:function(){let r=this;if(!r.dstate)return-2;let e=r.dstate.deflateEnd();return r.dstate=null,e},deflateParams:function(r,e){let t=this;return t.dstate?t.dstate.deflateParams(t,r,e):-2},deflateSetDictionary:function(r,e){let t=this;return t.dstate?t.dstate.deflateSetDictionary(t,r,e):-2},read_buf:function(r,e,t){let n=this,o=n.avail_in;return o>t&&(o=t),o===0?0:(n.avail_in-=o,r.set(n.next_in.subarray(n.next_in_index,n.next_in_index+o),e),n.next_in_index+=o,n.total_in+=o,o)},flush_pending:function(){let r=this,e=r.dstate.pending;e>r.avail_out&&(e=r.avail_out),e!==0&&(r.next_out.set(r.dstate.pending_buf.subarray(r.dstate.pending_out,r.dstate.pending_out+e),r.next_out_index),r.next_out_index+=e,r.dstate.pending_out+=e,r.total_out+=e,r.avail_out-=e,r.dstate.pending-=e,r.dstate.pending===0&&(r.dstate.pending_out=0))}};function nD(r){let e=this,t=new bO,n=oD(r&&r.chunkSize?r.chunkSize:64*1024),o=0,i=new Uint8Array(n),a=r?r.level:-1;typeof a>"u"&&(a=-1),t.deflateInit(a),t.next_out=i,e.append=function(s,l){let d,c,p=0,u=0,_=0,h=[];if(s.length){t.next_in_index=0,t.next_in=s,t.avail_in=s.length;do{if(t.next_out_index=0,t.avail_out=n,d=t.deflate(o),d!=0)throw new Error("deflating: "+t.msg);t.next_out_index&&(t.next_out_index==n?h.push(new Uint8Array(i)):h.push(i.slice(0,t.next_out_index))),_+=t.next_out_index,l&&t.next_in_index>0&&t.next_in_index!=p&&(l(t.next_in_index),p=t.next_in_index)}while(t.avail_in>0||t.avail_out===0);return h.length>1?(c=new Uint8Array(_),h.forEach(function(S){c.set(S,u),u+=S.length})):c=h[0]||new Uint8Array(0),c}},e.flush=function(){let s,l,d=0,c=0,p=[];do{if(t.next_out_index=0,t.avail_out=n,s=t.deflate(4),s!=1&&s!=0)throw new Error("deflating: "+t.msg);n-t.avail_out>0&&p.push(i.slice(0,t.next_out_index)),c+=t.next_out_index}while(t.avail_in>0||t.avail_out===0);return t.deflateEnd(),l=new Uint8Array(c),p.forEach(function(u){l.set(u,d),d+=u.length}),l}}function oD(r){return r+5*(Math.floor(r/16383)+1)}var NO=nD;var Xo=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],qO=1440,iD=0,aD=4,sD=9,lD=5,cD=[96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,192,80,7,10,0,8,96,0,8,32,0,9,160,0,8,0,0,8,128,0,8,64,0,9,224,80,7,6,0,8,88,0,8,24,0,9,144,83,7,59,0,8,120,0,8,56,0,9,208,81,7,17,0,8,104,0,8,40,0,9,176,0,8,8,0,8,136,0,8,72,0,9,240,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,200,81,7,13,0,8,100,0,8,36,0,9,168,0,8,4,0,8,132,0,8,68,0,9,232,80,7,8,0,8,92,0,8,28,0,9,152,84,7,83,0,8,124,0,8,60,0,9,216,82,7,23,0,8,108,0,8,44,0,9,184,0,8,12,0,8,140,0,8,76,0,9,248,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,196,81,7,11,0,8,98,0,8,34,0,9,164,0,8,2,0,8,130,0,8,66,0,9,228,80,7,7,0,8,90,0,8,26,0,9,148,84,7,67,0,8,122,0,8,58,0,9,212,82,7,19,0,8,106,0,8,42,0,9,180,0,8,10,0,8,138,0,8,74,0,9,244,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,204,81,7,15,0,8,102,0,8,38,0,9,172,0,8,6,0,8,134,0,8,70,0,9,236,80,7,9,0,8,94,0,8,30,0,9,156,84,7,99,0,8,126,0,8,62,0,9,220,82,7,27,0,8,110,0,8,46,0,9,188,0,8,14,0,8,142,0,8,78,0,9,252,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,194,80,7,10,0,8,97,0,8,33,0,9,162,0,8,1,0,8,129,0,8,65,0,9,226,80,7,6,0,8,89,0,8,25,0,9,146,83,7,59,0,8,121,0,8,57,0,9,210,81,7,17,0,8,105,0,8,41,0,9,178,0,8,9,0,8,137,0,8,73,0,9,242,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,202,81,7,13,0,8,101,0,8,37,0,9,170,0,8,5,0,8,133,0,8,69,0,9,234,80,7,8,0,8,93,0,8,29,0,9,154,84,7,83,0,8,125,0,8,61,0,9,218,82,7,23,0,8,109,0,8,45,0,9,186,0,8,13,0,8,141,0,8,77,0,9,250,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,198,81,7,11,0,8,99,0,8,35,0,9,166,0,8,3,0,8,131,0,8,67,0,9,230,80,7,7,0,8,91,0,8,27,0,9,150,84,7,67,0,8,123,0,8,59,0,9,214,82,7,19,0,8,107,0,8,43,0,9,182,0,8,11,0,8,139,0,8,75,0,9,246,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,206,81,7,15,0,8,103,0,8,39,0,9,174,0,8,7,0,8,135,0,8,71,0,9,238,80,7,9,0,8,95,0,8,31,0,9,158,84,7,99,0,8,127,0,8,63,0,9,222,82,7,27,0,8,111,0,8,47,0,9,190,0,8,15,0,8,143,0,8,79,0,9,254,96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,193,80,7,10,0,8,96,0,8,32,0,9,161,0,8,0,0,8,128,0,8,64,0,9,225,80,7,6,0,8,88,0,8,24,0,9,145,83,7,59,0,8,120,0,8,56,0,9,209,81,7,17,0,8,104,0,8,40,0,9,177,0,8,8,0,8,136,0,8,72,0,9,241,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,201,81,7,13,0,8,100,0,8,36,0,9,169,0,8,4,0,8,132,0,8,68,0,9,233,80,7,8,0,8,92,0,8,28,0,9,153,84,7,83,0,8,124,0,8,60,0,9,217,82,7,23,0,8,108,0,8,44,0,9,185,0,8,12,0,8,140,0,8,76,0,9,249,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,197,81,7,11,0,8,98,0,8,34,0,9,165,0,8,2,0,8,130,0,8,66,0,9,229,80,7,7,0,8,90,0,8,26,0,9,149,84,7,67,0,8,122,0,8,58,0,9,213,82,7,19,0,8,106,0,8,42,0,9,181,0,8,10,0,8,138,0,8,74,0,9,245,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,205,81,7,15,0,8,102,0,8,38,0,9,173,0,8,6,0,8,134,0,8,70,0,9,237,80,7,9,0,8,94,0,8,30,0,9,157,84,7,99,0,8,126,0,8,62,0,9,221,82,7,27,0,8,110,0,8,46,0,9,189,0,8,14,0,8,142,0,8,78,0,9,253,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,195,80,7,10,0,8,97,0,8,33,0,9,163,0,8,1,0,8,129,0,8,65,0,9,227,80,7,6,0,8,89,0,8,25,0,9,147,83,7,59,0,8,121,0,8,57,0,9,211,81,7,17,0,8,105,0,8,41,0,9,179,0,8,9,0,8,137,0,8,73,0,9,243,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,203,81,7,13,0,8,101,0,8,37,0,9,171,0,8,5,0,8,133,0,8,69,0,9,235,80,7,8,0,8,93,0,8,29,0,9,155,84,7,83,0,8,125,0,8,61,0,9,219,82,7,23,0,8,109,0,8,45,0,9,187,0,8,13,0,8,141,0,8,77,0,9,251,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,199,81,7,11,0,8,99,0,8,35,0,9,167,0,8,3,0,8,131,0,8,67,0,9,231,80,7,7,0,8,91,0,8,27,0,9,151,84,7,67,0,8,123,0,8,59,0,9,215,82,7,19,0,8,107,0,8,43,0,9,183,0,8,11,0,8,139,0,8,75,0,9,247,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,207,81,7,15,0,8,103,0,8,39,0,9,175,0,8,7,0,8,135,0,8,71,0,9,239,80,7,9,0,8,95,0,8,31,0,9,159,84,7,99,0,8,127,0,8,63,0,9,223,82,7,27,0,8,111,0,8,47,0,9,191,0,8,15,0,8,143,0,8,79,0,9,255],dD=[80,5,1,87,5,257,83,5,17,91,5,4097,81,5,5,89,5,1025,85,5,65,93,5,16385,80,5,3,88,5,513,84,5,33,92,5,8193,82,5,9,90,5,2049,86,5,129,192,5,24577,80,5,2,87,5,385,83,5,25,91,5,6145,81,5,7,89,5,1537,85,5,97,93,5,24577,80,5,4,88,5,769,84,5,49,92,5,12289,82,5,13,90,5,3073,86,5,193,192,5,24577],uD=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],pD=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,112,112],_D=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],hD=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],ts=15;function sg(){let r=this,e,t,n,o,i,a;function s(d,c,p,u,_,h,S,m,f,T,y){let E,v,A,I,C,g,R,D,P,U,B,M,F,w,V;U=0,C=p;do n[d[c+U]]++,U++,C--;while(C!==0);if(n[0]==p)return S[0]=-1,m[0]=0,0;for(D=m[0],g=1;g<=ts&&n[g]===0;g++);for(R=g,D<g&&(D=g),C=ts;C!==0&&n[C]===0;C--);for(A=C,D>C&&(D=C),m[0]=D,w=1<<g;g<C;g++,w<<=1)if((w-=n[g])<0)return-3;if((w-=n[C])<0)return-3;for(n[C]+=w,a[1]=g=0,U=1,F=2;--C!==0;)a[F]=g+=n[U],F++,U++;C=0,U=0;do(g=d[c+U])!==0&&(y[a[g]++]=C),U++;while(++C<p);for(p=a[A],a[0]=C=0,U=0,I=-1,M=-D,i[0]=0,B=0,V=0;R<=A;R++)for(E=n[R];E--!==0;){for(;R>M+D;){if(I++,M+=D,V=A-M,V=V>D?D:V,(v=1<<(g=R-M))>E+1&&(v-=E+1,F=R,g<V))for(;++g<V&&!((v<<=1)<=n[++F]);)v-=n[F];if(V=1<<g,T[0]+V>qO)return-3;i[I]=B=T[0],T[0]+=V,I!==0?(a[I]=C,o[0]=g,o[1]=D,g=C>>>M-D,o[2]=B-i[I-1]-g,f.set(o,(i[I-1]+g)*3)):S[0]=B}for(o[1]=R-M,U>=p?o[0]=192:y[U]<u?(o[0]=y[U]<256?0:96,o[2]=y[U++]):(o[0]=h[y[U]-u]+16+64,o[2]=_[y[U++]-u]),v=1<<R-M,g=C>>>M;g<V;g+=v)f.set(o,(B+g)*3);for(g=1<<R-1;(C&g)!==0;g>>>=1)C^=g;for(C^=g,P=(1<<M)-1;(C&P)!=a[I];)I--,M-=D,P=(1<<M)-1}return w!==0&&A!=1?-5:0}function l(d){let c;for(e||(e=[],t=[],n=new Int32Array(ts+1),o=[],i=new Int32Array(ts),a=new Int32Array(ts+1)),t.length<d&&(t=[]),c=0;c<d;c++)t[c]=0;for(c=0;c<ts+1;c++)n[c]=0;for(c=0;c<3;c++)o[c]=0;i.set(n.subarray(0,ts),0),a.set(n.subarray(0,ts+1),0)}r.inflate_trees_bits=function(d,c,p,u,_){let h;return l(19),e[0]=0,h=s(d,0,19,19,null,null,p,c,u,e,t),h==-3?_.msg="oversubscribed dynamic bit lengths tree":(h==-5||c[0]===0)&&(_.msg="incomplete dynamic bit lengths tree",h=-3),h},r.inflate_trees_dynamic=function(d,c,p,u,_,h,S,m,f){let T;return l(288),e[0]=0,T=s(p,0,d,257,uD,pD,h,u,m,e,t),T!=0||u[0]===0?(T==-3?f.msg="oversubscribed literal/length tree":T!=-4&&(f.msg="incomplete literal/length tree",T=-3),T):(l(288),T=s(p,d,c,0,_D,hD,S,_,m,e,t),T!=0||_[0]===0&&d>257?(T==-3?f.msg="oversubscribed distance tree":T==-5?(f.msg="incomplete distance tree",T=-3):T!=-4&&(f.msg="empty distance tree with lengths",T=-3),T):0)}}sg.inflate_trees_fixed=function(r,e,t,n){return r[0]=sD,e[0]=lD,t[0]=cD,n[0]=dD,0};var W_=0,PO=1,FO=2,DO=3,wO=4,LO=5,xO=6,og=7,BO=8,K_=9;function mD(){let r=this,e,t=0,n,o=0,i=0,a=0,s=0,l=0,d=0,c=0,p,u=0,_,h=0;function S(m,f,T,y,E,v,A,I){let C,g,R,D,P,U,B,M,F,w,V,k,H,z,Q,K;B=I.next_in_index,M=I.avail_in,P=A.bitb,U=A.bitk,F=A.write,w=F<A.read?A.read-F-1:A.end-F,V=Xo[m],k=Xo[f];do{for(;U<20;)M--,P|=(I.read_byte(B++)&255)<<U,U+=8;if(C=P&V,g=T,R=y,K=(R+C)*3,(D=g[K])===0){P>>=g[K+1],U-=g[K+1],A.win[F++]=g[K+2],w--;continue}do{if(P>>=g[K+1],U-=g[K+1],(D&16)!==0){for(D&=15,H=g[K+2]+(P&Xo[D]),P>>=D,U-=D;U<15;)M--,P|=(I.read_byte(B++)&255)<<U,U+=8;C=P&k,g=E,R=v,K=(R+C)*3,D=g[K];do if(P>>=g[K+1],U-=g[K+1],(D&16)!==0){for(D&=15;U<D;)M--,P|=(I.read_byte(B++)&255)<<U,U+=8;if(z=g[K+2]+(P&Xo[D]),P>>=D,U-=D,w-=H,F>=z)Q=F-z,F-Q>0&&2>F-Q?(A.win[F++]=A.win[Q++],A.win[F++]=A.win[Q++],H-=2):(A.win.set(A.win.subarray(Q,Q+2),F),F+=2,Q+=2,H-=2);else{Q=F-z;do Q+=A.end;while(Q<0);if(D=A.end-Q,H>D){if(H-=D,F-Q>0&&D>F-Q)do A.win[F++]=A.win[Q++];while(--D!==0);else A.win.set(A.win.subarray(Q,Q+D),F),F+=D,Q+=D,D=0;Q=0}}if(F-Q>0&&H>F-Q)do A.win[F++]=A.win[Q++];while(--H!==0);else A.win.set(A.win.subarray(Q,Q+H),F),F+=H,Q+=H,H=0;break}else if((D&64)===0)C+=g[K+2],C+=P&Xo[D],K=(R+C)*3,D=g[K];else return I.msg="invalid distance code",H=I.avail_in-M,H=U>>3<H?U>>3:H,M+=H,B-=H,U-=H<<3,A.bitb=P,A.bitk=U,I.avail_in=M,I.total_in+=B-I.next_in_index,I.next_in_index=B,A.write=F,-3;while(!0);break}if((D&64)===0){if(C+=g[K+2],C+=P&Xo[D],K=(R+C)*3,(D=g[K])===0){P>>=g[K+1],U-=g[K+1],A.win[F++]=g[K+2],w--;break}}else return(D&32)!==0?(H=I.avail_in-M,H=U>>3<H?U>>3:H,M+=H,B-=H,U-=H<<3,A.bitb=P,A.bitk=U,I.avail_in=M,I.total_in+=B-I.next_in_index,I.next_in_index=B,A.write=F,1):(I.msg="invalid literal/length code",H=I.avail_in-M,H=U>>3<H?U>>3:H,M+=H,B-=H,U-=H<<3,A.bitb=P,A.bitk=U,I.avail_in=M,I.total_in+=B-I.next_in_index,I.next_in_index=B,A.write=F,-3)}while(!0)}while(w>=258&&M>=10);return H=I.avail_in-M,H=U>>3<H?U>>3:H,M+=H,B-=H,U-=H<<3,A.bitb=P,A.bitk=U,I.avail_in=M,I.total_in+=B-I.next_in_index,I.next_in_index=B,A.write=F,0}r.init=function(m,f,T,y,E,v){e=W_,d=m,c=f,p=T,u=y,_=E,h=v,n=null},r.proc=function(m,f,T){let y,E,v,A=0,I=0,C=0,g,R,D,P;for(C=f.next_in_index,g=f.avail_in,A=m.bitb,I=m.bitk,R=m.write,D=R<m.read?m.read-R-1:m.end-R;;)switch(e){case W_:if(D>=258&&g>=10&&(m.bitb=A,m.bitk=I,f.avail_in=g,f.total_in+=C-f.next_in_index,f.next_in_index=C,m.write=R,T=S(d,c,p,u,_,h,m,f),C=f.next_in_index,g=f.avail_in,A=m.bitb,I=m.bitk,R=m.write,D=R<m.read?m.read-R-1:m.end-R,T!=0)){e=T==1?og:K_;break}i=d,n=p,o=u,e=PO;case PO:for(y=i;I<y;){if(g!==0)T=0;else return m.bitb=A,m.bitk=I,f.avail_in=g,f.total_in+=C-f.next_in_index,f.next_in_index=C,m.write=R,m.inflate_flush(f,T);g--,A|=(f.read_byte(C++)&255)<<I,I+=8}if(E=(o+(A&Xo[y]))*3,A>>>=n[E+1],I-=n[E+1],v=n[E],v===0){a=n[E+2],e=xO;break}if((v&16)!==0){s=v&15,t=n[E+2],e=FO;break}if((v&64)===0){i=v,o=E/3+n[E+2];break}if((v&32)!==0){e=og;break}return e=K_,f.msg="invalid literal/length code",T=-3,m.bitb=A,m.bitk=I,f.avail_in=g,f.total_in+=C-f.next_in_index,f.next_in_index=C,m.write=R,m.inflate_flush(f,T);case FO:for(y=s;I<y;){if(g!==0)T=0;else return m.bitb=A,m.bitk=I,f.avail_in=g,f.total_in+=C-f.next_in_index,f.next_in_index=C,m.write=R,m.inflate_flush(f,T);g--,A|=(f.read_byte(C++)&255)<<I,I+=8}t+=A&Xo[y],A>>=y,I-=y,i=c,n=_,o=h,e=DO;case DO:for(y=i;I<y;){if(g!==0)T=0;else return m.bitb=A,m.bitk=I,f.avail_in=g,f.total_in+=C-f.next_in_index,f.next_in_index=C,m.write=R,m.inflate_flush(f,T);g--,A|=(f.read_byte(C++)&255)<<I,I+=8}if(E=(o+(A&Xo[y]))*3,A>>=n[E+1],I-=n[E+1],v=n[E],(v&16)!==0){s=v&15,l=n[E+2],e=wO;break}if((v&64)===0){i=v,o=E/3+n[E+2];break}return e=K_,f.msg="invalid distance code",T=-3,m.bitb=A,m.bitk=I,f.avail_in=g,f.total_in+=C-f.next_in_index,f.next_in_index=C,m.write=R,m.inflate_flush(f,T);case wO:for(y=s;I<y;){if(g!==0)T=0;else return m.bitb=A,m.bitk=I,f.avail_in=g,f.total_in+=C-f.next_in_index,f.next_in_index=C,m.write=R,m.inflate_flush(f,T);g--,A|=(f.read_byte(C++)&255)<<I,I+=8}l+=A&Xo[y],A>>=y,I-=y,e=LO;case LO:for(P=R-l;P<0;)P+=m.end;for(;t!==0;){if(D===0&&(R==m.end&&m.read!==0&&(R=0,D=R<m.read?m.read-R-1:m.end-R),D===0&&(m.write=R,T=m.inflate_flush(f,T),R=m.write,D=R<m.read?m.read-R-1:m.end-R,R==m.end&&m.read!==0&&(R=0,D=R<m.read?m.read-R-1:m.end-R),D===0)))return m.bitb=A,m.bitk=I,f.avail_in=g,f.total_in+=C-f.next_in_index,f.next_in_index=C,m.write=R,m.inflate_flush(f,T);m.win[R++]=m.win[P++],D--,P==m.end&&(P=0),t--}e=W_;break;case xO:if(D===0&&(R==m.end&&m.read!==0&&(R=0,D=R<m.read?m.read-R-1:m.end-R),D===0&&(m.write=R,T=m.inflate_flush(f,T),R=m.write,D=R<m.read?m.read-R-1:m.end-R,R==m.end&&m.read!==0&&(R=0,D=R<m.read?m.read-R-1:m.end-R),D===0)))return m.bitb=A,m.bitk=I,f.avail_in=g,f.total_in+=C-f.next_in_index,f.next_in_index=C,m.write=R,m.inflate_flush(f,T);T=0,m.win[R++]=a,D--,e=W_;break;case og:if(I>7&&(I-=8,g++,C--),m.write=R,T=m.inflate_flush(f,T),R=m.write,D=R<m.read?m.read-R-1:m.end-R,m.read!=m.write)return m.bitb=A,m.bitk=I,f.avail_in=g,f.total_in+=C-f.next_in_index,f.next_in_index=C,m.write=R,m.inflate_flush(f,T);e=BO;case BO:return T=1,m.bitb=A,m.bitk=I,f.avail_in=g,f.total_in+=C-f.next_in_index,f.next_in_index=C,m.write=R,m.inflate_flush(f,T);case K_:return T=-3,m.bitb=A,m.bitk=I,f.avail_in=g,f.total_in+=C-f.next_in_index,f.next_in_index=C,m.write=R,m.inflate_flush(f,T);default:return T=-2,m.bitb=A,m.bitk=I,f.avail_in=g,f.total_in+=C-f.next_in_index,f.next_in_index=C,m.write=R,m.inflate_flush(f,T)}},r.free=function(){}}var MO=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Yl=0,ig=1,GO=2,UO=3,VO=4,kO=5,Y_=6,Q_=7,HO=8,$s=9;function fD(r,e){let t=this,n=Yl,o=0,i=0,a=0,s,l=[0],d=[0],c=new mD,p=0,u=new Int32Array(qO*3),_=0,h=new sg;t.bitk=0,t.bitb=0,t.win=new Uint8Array(e),t.end=e,t.read=0,t.write=0,t.reset=function(S,m){m&&(m[0]=_),n==Y_&&c.free(S),n=Yl,t.bitk=0,t.bitb=0,t.read=t.write=0},t.reset(r,null),t.inflate_flush=function(S,m){let f,T,y;return T=S.next_out_index,y=t.read,f=(y<=t.write?t.write:t.end)-y,f>S.avail_out&&(f=S.avail_out),f!==0&&m==-5&&(m=0),S.avail_out-=f,S.total_out+=f,S.next_out.set(t.win.subarray(y,y+f),T),T+=f,y+=f,y==t.end&&(y=0,t.write==t.end&&(t.write=0),f=t.write-y,f>S.avail_out&&(f=S.avail_out),f!==0&&m==-5&&(m=0),S.avail_out-=f,S.total_out+=f,S.next_out.set(t.win.subarray(y,y+f),T),T+=f,y+=f),S.next_out_index=T,t.read=y,m},t.proc=function(S,m){let f,T,y,E,v,A,I,C;for(E=S.next_in_index,v=S.avail_in,T=t.bitb,y=t.bitk,A=t.write,I=A<t.read?t.read-A-1:t.end-A;;){let g,R,D,P,U,B,M,F;switch(n){case Yl:for(;y<3;){if(v!==0)m=0;else return t.bitb=T,t.bitk=y,S.avail_in=v,S.total_in+=E-S.next_in_index,S.next_in_index=E,t.write=A,t.inflate_flush(S,m);v--,T|=(S.read_byte(E++)&255)<<y,y+=8}switch(f=T&7,p=f&1,f>>>1){case 0:T>>>=3,y-=3,f=y&7,T>>>=f,y-=f,n=ig;break;case 1:g=[],R=[],D=[[]],P=[[]],sg.inflate_trees_fixed(g,R,D,P),c.init(g[0],R[0],D[0],0,P[0],0),T>>>=3,y-=3,n=Y_;break;case 2:T>>>=3,y-=3,n=UO;break;case 3:return T>>>=3,y-=3,n=$s,S.msg="invalid block type",m=-3,t.bitb=T,t.bitk=y,S.avail_in=v,S.total_in+=E-S.next_in_index,S.next_in_index=E,t.write=A,t.inflate_flush(S,m)}break;case ig:for(;y<32;){if(v!==0)m=0;else return t.bitb=T,t.bitk=y,S.avail_in=v,S.total_in+=E-S.next_in_index,S.next_in_index=E,t.write=A,t.inflate_flush(S,m);v--,T|=(S.read_byte(E++)&255)<<y,y+=8}if((~T>>>16&65535)!=(T&65535))return n=$s,S.msg="invalid stored block lengths",m=-3,t.bitb=T,t.bitk=y,S.avail_in=v,S.total_in+=E-S.next_in_index,S.next_in_index=E,t.write=A,t.inflate_flush(S,m);o=T&65535,T=y=0,n=o!==0?GO:p!==0?Q_:Yl;break;case GO:if(v===0||I===0&&(A==t.end&&t.read!==0&&(A=0,I=A<t.read?t.read-A-1:t.end-A),I===0&&(t.write=A,m=t.inflate_flush(S,m),A=t.write,I=A<t.read?t.read-A-1:t.end-A,A==t.end&&t.read!==0&&(A=0,I=A<t.read?t.read-A-1:t.end-A),I===0)))return t.bitb=T,t.bitk=y,S.avail_in=v,S.total_in+=E-S.next_in_index,S.next_in_index=E,t.write=A,t.inflate_flush(S,m);if(m=0,f=o,f>v&&(f=v),f>I&&(f=I),t.win.set(S.read_buf(E,f),A),E+=f,v-=f,A+=f,I-=f,(o-=f)!==0)break;n=p!==0?Q_:Yl;break;case UO:for(;y<14;){if(v!==0)m=0;else return t.bitb=T,t.bitk=y,S.avail_in=v,S.total_in+=E-S.next_in_index,S.next_in_index=E,t.write=A,t.inflate_flush(S,m);v--,T|=(S.read_byte(E++)&255)<<y,y+=8}if(i=f=T&16383,(f&31)>29||(f>>5&31)>29)return n=$s,S.msg="too many length or distance symbols",m=-3,t.bitb=T,t.bitk=y,S.avail_in=v,S.total_in+=E-S.next_in_index,S.next_in_index=E,t.write=A,t.inflate_flush(S,m);if(f=258+(f&31)+(f>>5&31),!s||s.length<f)s=[];else for(C=0;C<f;C++)s[C]=0;T>>>=14,y-=14,a=0,n=VO;case VO:for(;a<4+(i>>>10);){for(;y<3;){if(v!==0)m=0;else return t.bitb=T,t.bitk=y,S.avail_in=v,S.total_in+=E-S.next_in_index,S.next_in_index=E,t.write=A,t.inflate_flush(S,m);v--,T|=(S.read_byte(E++)&255)<<y,y+=8}s[MO[a++]]=T&7,T>>>=3,y-=3}for(;a<19;)s[MO[a++]]=0;if(l[0]=7,f=h.inflate_trees_bits(s,l,d,u,S),f!=0)return m=f,m==-3&&(s=null,n=$s),t.bitb=T,t.bitk=y,S.avail_in=v,S.total_in+=E-S.next_in_index,S.next_in_index=E,t.write=A,t.inflate_flush(S,m);a=0,n=kO;case kO:for(;f=i,!(a>=258+(f&31)+(f>>5&31));){let w,V;for(f=l[0];y<f;){if(v!==0)m=0;else return t.bitb=T,t.bitk=y,S.avail_in=v,S.total_in+=E-S.next_in_index,S.next_in_index=E,t.write=A,t.inflate_flush(S,m);v--,T|=(S.read_byte(E++)&255)<<y,y+=8}if(f=u[(d[0]+(T&Xo[f]))*3+1],V=u[(d[0]+(T&Xo[f]))*3+2],V<16)T>>>=f,y-=f,s[a++]=V;else{for(C=V==18?7:V-14,w=V==18?11:3;y<f+C;){if(v!==0)m=0;else return t.bitb=T,t.bitk=y,S.avail_in=v,S.total_in+=E-S.next_in_index,S.next_in_index=E,t.write=A,t.inflate_flush(S,m);v--,T|=(S.read_byte(E++)&255)<<y,y+=8}if(T>>>=f,y-=f,w+=T&Xo[C],T>>>=C,y-=C,C=a,f=i,C+w>258+(f&31)+(f>>5&31)||V==16&&C<1)return s=null,n=$s,S.msg="invalid bit length repeat",m=-3,t.bitb=T,t.bitk=y,S.avail_in=v,S.total_in+=E-S.next_in_index,S.next_in_index=E,t.write=A,t.inflate_flush(S,m);V=V==16?s[C-1]:0;do s[C++]=V;while(--w!==0);a=C}}if(d[0]=-1,U=[],B=[],M=[],F=[],U[0]=9,B[0]=6,f=i,f=h.inflate_trees_dynamic(257+(f&31),1+(f>>5&31),s,U,B,M,F,u,S),f!=0)return f==-3&&(s=null,n=$s),m=f,t.bitb=T,t.bitk=y,S.avail_in=v,S.total_in+=E-S.next_in_index,S.next_in_index=E,t.write=A,t.inflate_flush(S,m);c.init(U[0],B[0],u,M[0],u,F[0]),n=Y_;case Y_:if(t.bitb=T,t.bitk=y,S.avail_in=v,S.total_in+=E-S.next_in_index,S.next_in_index=E,t.write=A,(m=c.proc(t,S,m))!=1)return t.inflate_flush(S,m);if(m=0,c.free(S),E=S.next_in_index,v=S.avail_in,T=t.bitb,y=t.bitk,A=t.write,I=A<t.read?t.read-A-1:t.end-A,p===0){n=Yl;break}n=Q_;case Q_:if(t.write=A,m=t.inflate_flush(S,m),A=t.write,I=A<t.read?t.read-A-1:t.end-A,t.read!=t.write)return t.bitb=T,t.bitk=y,S.avail_in=v,S.total_in+=E-S.next_in_index,S.next_in_index=E,t.write=A,t.inflate_flush(S,m);n=HO;case HO:return m=1,t.bitb=T,t.bitk=y,S.avail_in=v,S.total_in+=E-S.next_in_index,S.next_in_index=E,t.write=A,t.inflate_flush(S,m);case $s:return m=-3,t.bitb=T,t.bitk=y,S.avail_in=v,S.total_in+=E-S.next_in_index,S.next_in_index=E,t.write=A,t.inflate_flush(S,m);default:return m=-2,t.bitb=T,t.bitk=y,S.avail_in=v,S.total_in+=E-S.next_in_index,S.next_in_index=E,t.write=A,t.inflate_flush(S,m)}}},t.free=function(S){t.reset(S,null),t.win=null,u=null},t.set_dictionary=function(S,m,f){t.win.set(S.subarray(m,m+f),0),t.read=t.write=f},t.sync_point=function(){return n==ig?1:0}}var gD=32,AD=8,SD=0,zO=1,WO=2,KO=3,YO=4,QO=5,ag=6,xd=7,XO=12,rs=13,TD=[0,0,255,255];function ED(){let r=this;r.mode=0,r.method=0,r.was=[0],r.need=0,r.marker=0,r.wbits=0;function e(t){return!t||!t.istate?-2:(t.total_in=t.total_out=0,t.msg=null,t.istate.mode=xd,t.istate.blocks.reset(t,null),0)}r.inflateEnd=function(t){return r.blocks&&r.blocks.free(t),r.blocks=null,0},r.inflateInit=function(t,n){return t.msg=null,r.blocks=null,n<8||n>15?(r.inflateEnd(t),-2):(r.wbits=n,t.istate.blocks=new fD(t,1<<n),e(t),0)},r.inflate=function(t,n){let o,i;if(!t||!t.istate||!t.next_in)return-2;let a=t.istate;for(n=n==aD?-5:0,o=-5;;)switch(a.mode){case SD:if(t.avail_in===0)return o;if(o=n,t.avail_in--,t.total_in++,((a.method=t.read_byte(t.next_in_index++))&15)!=AD){a.mode=rs,t.msg="unknown compression method",a.marker=5;break}if((a.method>>4)+8>a.wbits){a.mode=rs,t.msg="invalid win size",a.marker=5;break}a.mode=zO;case zO:if(t.avail_in===0)return o;if(o=n,t.avail_in--,t.total_in++,i=t.read_byte(t.next_in_index++)&255,((a.method<<8)+i)%31!==0){a.mode=rs,t.msg="incorrect header check",a.marker=5;break}if((i&gD)===0){a.mode=xd;break}a.mode=WO;case WO:if(t.avail_in===0)return o;o=n,t.avail_in--,t.total_in++,a.need=(t.read_byte(t.next_in_index++)&255)<<24&4278190080,a.mode=KO;case KO:if(t.avail_in===0)return o;o=n,t.avail_in--,t.total_in++,a.need+=(t.read_byte(t.next_in_index++)&255)<<16&16711680,a.mode=YO;case YO:if(t.avail_in===0)return o;o=n,t.avail_in--,t.total_in++,a.need+=(t.read_byte(t.next_in_index++)&255)<<8&65280,a.mode=QO;case QO:return t.avail_in===0?o:(o=n,t.avail_in--,t.total_in++,a.need+=t.read_byte(t.next_in_index++)&255,a.mode=ag,2);case ag:return a.mode=rs,t.msg="need dictionary",a.marker=0,-2;case xd:if(o=a.blocks.proc(t,o),o==-3){a.mode=rs,a.marker=0;break}if(o==0&&(o=n),o!=1)return o;o=n,a.blocks.reset(t,a.was),a.mode=XO;case XO:return t.avail_in=0,1;case rs:return-3;default:return-2}},r.inflateSetDictionary=function(t,n,o){let i=0,a=o;if(!t||!t.istate||t.istate.mode!=ag)return-2;let s=t.istate;return a>=1<<s.wbits&&(a=(1<<s.wbits)-1,i=o-a),s.blocks.set_dictionary(n,i,a),s.mode=xd,0},r.inflateSync=function(t){let n,o,i,a,s;if(!t||!t.istate)return-2;let l=t.istate;if(l.mode!=rs&&(l.mode=rs,l.marker=0),(n=t.avail_in)===0)return-5;for(o=t.next_in_index,i=l.marker;n!==0&&i<4;)t.read_byte(o)==TD[i]?i++:t.read_byte(o)!==0?i=0:i=4-i,o++,n--;return t.total_in+=o-t.next_in_index,t.next_in_index=o,t.avail_in=n,l.marker=i,i!=4?-3:(a=t.total_in,s=t.total_out,e(t),t.total_in=a,t.total_out=s,l.mode=xd,0)},r.inflateSyncPoint=function(t){return!t||!t.istate||!t.istate.blocks?-2:t.istate.blocks.sync_point()}}function ZO(){}ZO.prototype={inflateInit:function(r){let e=this;return e.istate=new ED,r||(r=15),e.istate.inflateInit(e,r)},inflate:function(r){let e=this;return e.istate?e.istate.inflate(e,r):-2},inflateEnd:function(){let r=this;if(!r.istate)return-2;let e=r.istate.inflateEnd(r);return r.istate=null,e},inflateSync:function(){let r=this;return r.istate?r.istate.inflateSync(r):-2},inflateSetDictionary:function(r,e){let t=this;return t.istate?t.istate.inflateSetDictionary(t,r,e):-2},read_byte:function(r){return this.next_in[r]},read_buf:function(r,e){return this.next_in.subarray(r,r+e)}};function ID(r){let e=this,t=new ZO,n=r&&r.chunkSize?Math.floor(r.chunkSize*2):128*1024,o=iD,i=new Uint8Array(n),a=!1;t.inflateInit(),t.next_out=i,e.append=function(s,l){let d=[],c,p,u=0,_=0,h=0;if(s.length!==0){t.next_in_index=0,t.next_in=s,t.avail_in=s.length;do{if(t.next_out_index=0,t.avail_out=n,t.avail_in===0&&!a&&(t.next_in_index=0,a=!0),c=t.inflate(o),a&&c===-5){if(t.avail_in!==0)throw new Error("inflating: bad input")}else if(c!==0&&c!==1)throw new Error("inflating: "+t.msg);if((a||c===1)&&t.avail_in===s.length)throw new Error("inflating: bad input");t.next_out_index&&(t.next_out_index===n?d.push(new Uint8Array(i)):d.push(i.slice(0,t.next_out_index))),h+=t.next_out_index,l&&t.next_in_index>0&&t.next_in_index!=u&&(l(t.next_in_index),u=t.next_in_index)}while(t.avail_in>0||t.avail_out===0);return d.length>1?(p=new Uint8Array(h),d.forEach(function(S){p.set(S,_),_+=S.length})):p=d[0]||new Uint8Array(0),p}},e.flush=function(){t.inflateEnd()}}var JO=ID;var yD={chunkSize:524288,maxWorkers:typeof navigator<"u"&&navigator.hardwareConcurrency||2,terminateWorkerTimeout:5e3,useWebWorkers:!0,workerScripts:void 0},bo=Object.assign({},yD);function lg(){return bo}function Ql(r){if(r.baseURL!==void 0&&(bo.baseURL=r.baseURL),r.chunkSize!==void 0&&(bo.chunkSize=r.chunkSize),r.maxWorkers!==void 0&&(bo.maxWorkers=r.maxWorkers),r.terminateWorkerTimeout!==void 0&&(bo.terminateWorkerTimeout=r.terminateWorkerTimeout),r.useWebWorkers!==void 0&&(bo.useWebWorkers=r.useWebWorkers),r.Deflate!==void 0&&(bo.Deflate=r.Deflate),r.Inflate!==void 0&&(bo.Inflate=r.Inflate),r.workerScripts!==void 0){if(r.workerScripts.deflate){if(!Array.isArray(r.workerScripts.deflate))throw new Error("workerScripts.deflate must be an array");bo.workerScripts||(bo.workerScripts={}),bo.workerScripts.deflate=r.workerScripts.deflate}if(r.workerScripts.inflate){if(!Array.isArray(r.workerScripts.inflate))throw new Error("workerScripts.inflate must be an array");bo.workerScripts||(bo.workerScripts={}),bo.workerScripts.inflate=r.workerScripts.inflate}}}var Bd={application:{"andrew-inset":"ez",annodex:"anx","atom+xml":"atom","atomcat+xml":"atomcat","atomserv+xml":"atomsrv",bbolin:"lin",cap:["cap","pcap"],"cu-seeme":"cu","davmount+xml":"davmount",dsptype:"tsp",ecmascript:["es","ecma"],futuresplash:"spl",hta:"hta","java-archive":"jar","java-serialized-object":"ser","java-vm":"class",javascript:"js",m3g:"m3g","mac-binhex40":"hqx",mathematica:["nb","ma","mb"],msaccess:"mdb",msword:["doc","dot"],mxf:"mxf",oda:"oda",ogg:"ogx",pdf:"pdf","pgp-keys":"key","pgp-signature":["asc","sig"],"pics-rules":"prf",postscript:["ps","ai","eps","epsi","epsf","eps2","eps3"],rar:"rar","rdf+xml":"rdf","rss+xml":"rss",rtf:"rtf",smil:["smi","smil"],"xhtml+xml":["xhtml","xht"],xml:["xml","xsl","xsd"],"xspf+xml":"xspf",zip:"zip","vnd.android.package-archive":"apk","vnd.cinderella":"cdy","vnd.google-earth.kml+xml":"kml","vnd.google-earth.kmz":"kmz","vnd.mozilla.xul+xml":"xul","vnd.ms-excel":["xls","xlb","xlt","xlm","xla","xlc","xlw"],"vnd.ms-pki.seccat":"cat","vnd.ms-pki.stl":"stl","vnd.ms-powerpoint":["ppt","pps","pot"],"vnd.oasis.opendocument.chart":"odc","vnd.oasis.opendocument.database":"odb","vnd.oasis.opendocument.formula":"odf","vnd.oasis.opendocument.graphics":"odg","vnd.oasis.opendocument.graphics-template":"otg","vnd.oasis.opendocument.image":"odi","vnd.oasis.opendocument.presentation":"odp","vnd.oasis.opendocument.presentation-template":"otp","vnd.oasis.opendocument.spreadsheet":"ods","vnd.oasis.opendocument.spreadsheet-template":"ots","vnd.oasis.opendocument.text":"odt","vnd.oasis.opendocument.text-master":"odm","vnd.oasis.opendocument.text-template":"ott","vnd.oasis.opendocument.text-web":"oth","vnd.openxmlformats-officedocument.spreadsheetml.sheet":"xlsx","vnd.openxmlformats-officedocument.spreadsheetml.template":"xltx","vnd.openxmlformats-officedocument.presentationml.presentation":"pptx","vnd.openxmlformats-officedocument.presentationml.slideshow":"ppsx","vnd.openxmlformats-officedocument.presentationml.template":"potx","vnd.openxmlformats-officedocument.wordprocessingml.document":"docx","vnd.openxmlformats-officedocument.wordprocessingml.template":"dotx","vnd.smaf":"mmf","vnd.stardivision.calc":"sdc","vnd.stardivision.chart":"sds","vnd.stardivision.draw":"sda","vnd.stardivision.impress":"sdd","vnd.stardivision.math":["sdf","smf"],"vnd.stardivision.writer":["sdw","vor"],"vnd.stardivision.writer-global":"sgl","vnd.sun.xml.calc":"sxc","vnd.sun.xml.calc.template":"stc","vnd.sun.xml.draw":"sxd","vnd.sun.xml.draw.template":"std","vnd.sun.xml.impress":"sxi","vnd.sun.xml.impress.template":"sti","vnd.sun.xml.math":"sxm","vnd.sun.xml.writer":"sxw","vnd.sun.xml.writer.global":"sxg","vnd.sun.xml.writer.template":"stw","vnd.symbian.install":["sis","sisx"],"vnd.visio":["vsd","vst","vss","vsw"],"vnd.wap.wbxml":"wbxml","vnd.wap.wmlc":"wmlc","vnd.wap.wmlscriptc":"wmlsc","vnd.wordperfect":"wpd","vnd.wordperfect5.1":"wp5","x-123":"wk","x-7z-compressed":"7z","x-abiword":"abw","x-apple-diskimage":"dmg","x-bcpio":"bcpio","x-bittorrent":"torrent","x-cbr":["cbr","cba","cbt","cb7"],"x-cbz":"cbz","x-cdf":["cdf","cda"],"x-cdlink":"vcd","x-chess-pgn":"pgn","x-cpio":"cpio","x-csh":"csh","x-debian-package":["deb","udeb"],"x-director":["dcr","dir","dxr","cst","cct","cxt","w3d","fgd","swa"],"x-dms":"dms","x-doom":"wad","x-dvi":"dvi","x-httpd-eruby":"rhtml","x-font":"pcf.Z","x-freemind":"mm","x-gnumeric":"gnumeric","x-go-sgf":"sgf","x-graphing-calculator":"gcf","x-gtar":["gtar","taz"],"x-hdf":"hdf","x-httpd-php":["phtml","pht","php"],"x-httpd-php-source":"phps","x-httpd-php3":"php3","x-httpd-php3-preprocessed":"php3p","x-httpd-php4":"php4","x-httpd-php5":"php5","x-ica":"ica","x-info":"info","x-internet-signup":["ins","isp"],"x-iphone":"iii","x-iso9660-image":"iso","x-java-jnlp-file":"jnlp","x-jmol":"jmz","x-killustrator":"kil","x-koan":["skp","skd","skt","skm"],"x-kpresenter":["kpr","kpt"],"x-kword":["kwd","kwt"],"x-latex":"latex","x-lha":"lha","x-lyx":"lyx","x-lzh":"lzh","x-lzx":"lzx","x-maker":["frm","maker","frame","fm","fb","book","fbdoc"],"x-ms-wmd":"wmd","x-ms-wmz":"wmz","x-msdos-program":["com","exe","bat","dll"],"x-msi":"msi","x-netcdf":["nc","cdf"],"x-ns-proxy-autoconfig":["pac","dat"],"x-nwc":"nwc","x-object":"o","x-oz-application":"oza","x-pkcs7-certreqresp":"p7r","x-python-code":["pyc","pyo"],"x-qgis":["qgs","shp","shx"],"x-quicktimeplayer":"qtl","x-redhat-package-manager":"rpm","x-ruby":"rb","x-sh":"sh","x-shar":"shar","x-shockwave-flash":["swf","swfl"],"x-silverlight":"scr","x-stuffit":"sit","x-sv4cpio":"sv4cpio","x-sv4crc":"sv4crc","x-tar":"tar","x-tcl":"tcl","x-tex-gf":"gf","x-tex-pk":"pk","x-texinfo":["texinfo","texi"],"x-trash":["~","%","bak","old","sik"],"x-troff":["t","tr","roff"],"x-troff-man":"man","x-troff-me":"me","x-troff-ms":"ms","x-ustar":"ustar","x-wais-source":"src","x-wingz":"wz","x-x509-ca-cert":["crt","der","cer"],"x-xcf":"xcf","x-xfig":"fig","x-xpinstall":"xpi",applixware:"aw","atomsvc+xml":"atomsvc","ccxml+xml":"ccxml","cdmi-capability":"cdmia","cdmi-container":"cdmic","cdmi-domain":"cdmid","cdmi-object":"cdmio","cdmi-queue":"cdmiq","docbook+xml":"dbk","dssc+der":"dssc","dssc+xml":"xdssc","emma+xml":"emma","epub+zip":"epub",exi:"exi","font-tdpfr":"pfr","gml+xml":"gml","gpx+xml":"gpx",gxf:"gxf",hyperstudio:"stk","inkml+xml":["ink","inkml"],ipfix:"ipfix",json:"json","jsonml+json":"jsonml","lost+xml":"lostxml","mads+xml":"mads",marc:"mrc","marcxml+xml":"mrcx","mathml+xml":"mathml",mbox:"mbox","mediaservercontrol+xml":"mscml","metalink+xml":"metalink","metalink4+xml":"meta4","mets+xml":"mets","mods+xml":"mods",mp21:["m21","mp21"],mp4:"mp4s","oebps-package+xml":"opf","omdoc+xml":"omdoc",onenote:["onetoc","onetoc2","onetmp","onepkg"],oxps:"oxps","patch-ops-error+xml":"xer","pgp-encrypted":"pgp",pkcs10:"p10","pkcs7-mime":["p7m","p7c"],"pkcs7-signature":"p7s",pkcs8:"p8","pkix-attr-cert":"ac","pkix-crl":"crl","pkix-pkipath":"pkipath",pkixcmp:"pki","pls+xml":"pls","prs.cww":"cww","pskc+xml":"pskcxml","reginfo+xml":"rif","relax-ng-compact-syntax":"rnc","resource-lists+xml":"rl","resource-lists-diff+xml":"rld","rls-services+xml":"rs","rpki-ghostbusters":"gbr","rpki-manifest":"mft","rpki-roa":"roa","rsd+xml":"rsd","sbml+xml":"sbml","scvp-cv-request":"scq","scvp-cv-response":"scs","scvp-vp-request":"spq","scvp-vp-response":"spp",sdp:"sdp","set-payment-initiation":"setpay","set-registration-initiation":"setreg","shf+xml":"shf","sparql-query":"rq","sparql-results+xml":"srx",srgs:"gram","srgs+xml":"grxml","sru+xml":"sru","ssdl+xml":"ssdl","ssml+xml":"ssml","tei+xml":["tei","teicorpus"],"thraud+xml":"tfi","timestamped-data":"tsd","vnd.3gpp.pic-bw-large":"plb","vnd.3gpp.pic-bw-small":"psb","vnd.3gpp.pic-bw-var":"pvb","vnd.3gpp2.tcap":"tcap","vnd.3m.post-it-notes":"pwn","vnd.accpac.simply.aso":"aso","vnd.accpac.simply.imp":"imp","vnd.acucobol":"acu","vnd.acucorp":["atc","acutc"],"vnd.adobe.air-application-installer-package+zip":"air","vnd.adobe.formscentral.fcdt":"fcdt","vnd.adobe.fxp":["fxp","fxpl"],"vnd.adobe.xdp+xml":"xdp","vnd.adobe.xfdf":"xfdf","vnd.ahead.space":"ahead","vnd.airzip.filesecure.azf":"azf","vnd.airzip.filesecure.azs":"azs","vnd.amazon.ebook":"azw","vnd.americandynamics.acc":"acc","vnd.amiga.ami":"ami","vnd.anser-web-certificate-issue-initiation":"cii","vnd.anser-web-funds-transfer-initiation":"fti","vnd.antix.game-component":"atx","vnd.apple.installer+xml":"mpkg","vnd.apple.mpegurl":"m3u8","vnd.aristanetworks.swi":"swi","vnd.astraea-software.iota":"iota","vnd.audiograph":"aep","vnd.blueice.multipass":"mpm","vnd.bmi":"bmi","vnd.businessobjects":"rep","vnd.chemdraw+xml":"cdxml","vnd.chipnuts.karaoke-mmd":"mmd","vnd.claymore":"cla","vnd.cloanto.rp9":"rp9","vnd.clonk.c4group":["c4g","c4d","c4f","c4p","c4u"],"vnd.cluetrust.cartomobile-config":"c11amc","vnd.cluetrust.cartomobile-config-pkg":"c11amz","vnd.commonspace":"csp","vnd.contact.cmsg":"cdbcmsg","vnd.cosmocaller":"cmc","vnd.crick.clicker":"clkx","vnd.crick.clicker.keyboard":"clkk","vnd.crick.clicker.palette":"clkp","vnd.crick.clicker.template":"clkt","vnd.crick.clicker.wordbank":"clkw","vnd.criticaltools.wbs+xml":"wbs","vnd.ctc-posml":"pml","vnd.cups-ppd":"ppd","vnd.curl.car":"car","vnd.curl.pcurl":"pcurl","vnd.dart":"dart","vnd.data-vision.rdz":"rdz","vnd.dece.data":["uvf","uvvf","uvd","uvvd"],"vnd.dece.ttml+xml":["uvt","uvvt"],"vnd.dece.unspecified":["uvx","uvvx"],"vnd.dece.zip":["uvz","uvvz"],"vnd.denovo.fcselayout-link":"fe_launch","vnd.dna":"dna","vnd.dolby.mlp":"mlp","vnd.dpgraph":"dpg","vnd.dreamfactory":"dfac","vnd.ds-keypoint":"kpxx","vnd.dvb.ait":"ait","vnd.dvb.service":"svc","vnd.dynageo":"geo","vnd.ecowin.chart":"mag","vnd.enliven":"nml","vnd.epson.esf":"esf","vnd.epson.msf":"msf","vnd.epson.quickanime":"qam","vnd.epson.salt":"slt","vnd.epson.ssf":"ssf","vnd.eszigno3+xml":["es3","et3"],"vnd.ezpix-album":"ez2","vnd.ezpix-package":"ez3","vnd.fdf":"fdf","vnd.fdsn.mseed":"mseed","vnd.fdsn.seed":["seed","dataless"],"vnd.flographit":"gph","vnd.fluxtime.clip":"ftc","vnd.framemaker":["fm","frame","maker","book"],"vnd.frogans.fnc":"fnc","vnd.frogans.ltf":"ltf","vnd.fsc.weblaunch":"fsc","vnd.fujitsu.oasys":"oas","vnd.fujitsu.oasys2":"oa2","vnd.fujitsu.oasys3":"oa3","vnd.fujitsu.oasysgp":"fg5","vnd.fujitsu.oasysprs":"bh2","vnd.fujixerox.ddd":"ddd","vnd.fujixerox.docuworks":"xdw","vnd.fujixerox.docuworks.binder":"xbd","vnd.fuzzysheet":"fzs","vnd.genomatix.tuxedo":"txd","vnd.geogebra.file":"ggb","vnd.geogebra.tool":"ggt","vnd.geometry-explorer":["gex","gre"],"vnd.geonext":"gxt","vnd.geoplan":"g2w","vnd.geospace":"g3w","vnd.gmx":"gmx","vnd.grafeq":["gqf","gqs"],"vnd.groove-account":"gac","vnd.groove-help":"ghf","vnd.groove-identity-message":"gim","vnd.groove-injector":"grv","vnd.groove-tool-message":"gtm","vnd.groove-tool-template":"tpl","vnd.groove-vcard":"vcg","vnd.hal+xml":"hal","vnd.handheld-entertainment+xml":"zmm","vnd.hbci":"hbci","vnd.hhe.lesson-player":"les","vnd.hp-hpgl":"hpgl","vnd.hp-hpid":"hpid","vnd.hp-hps":"hps","vnd.hp-jlyt":"jlt","vnd.hp-pcl":"pcl","vnd.hp-pclxl":"pclxl","vnd.hydrostatix.sof-data":"sfd-hdstx","vnd.ibm.minipay":"mpy","vnd.ibm.modcap":["afp","listafp","list3820"],"vnd.ibm.rights-management":"irm","vnd.ibm.secure-container":"sc","vnd.iccprofile":["icc","icm"],"vnd.igloader":"igl","vnd.immervision-ivp":"ivp","vnd.immervision-ivu":"ivu","vnd.insors.igm":"igm","vnd.intercon.formnet":["xpw","xpx"],"vnd.intergeo":"i2g","vnd.intu.qbo":"qbo","vnd.intu.qfx":"qfx","vnd.ipunplugged.rcprofile":"rcprofile","vnd.irepository.package+xml":"irp","vnd.is-xpr":"xpr","vnd.isac.fcs":"fcs","vnd.jam":"jam","vnd.jcp.javame.midlet-rms":"rms","vnd.jisp":"jisp","vnd.joost.joda-archive":"joda","vnd.kahootz":["ktz","ktr"],"vnd.kde.karbon":"karbon","vnd.kde.kchart":"chrt","vnd.kde.kformula":"kfo","vnd.kde.kivio":"flw","vnd.kde.kontour":"kon","vnd.kde.kpresenter":["kpr","kpt"],"vnd.kde.kspread":"ksp","vnd.kde.kword":["kwd","kwt"],"vnd.kenameaapp":"htke","vnd.kidspiration":"kia","vnd.kinar":["kne","knp"],"vnd.koan":["skp","skd","skt","skm"],"vnd.kodak-descriptor":"sse","vnd.las.las+xml":"lasxml","vnd.llamagraphics.life-balance.desktop":"lbd","vnd.llamagraphics.life-balance.exchange+xml":"lbe","vnd.lotus-1-2-3":"123","vnd.lotus-approach":"apr","vnd.lotus-freelance":"pre","vnd.lotus-notes":"nsf","vnd.lotus-organizer":"org","vnd.lotus-screencam":"scm","vnd.lotus-wordpro":"lwp","vnd.macports.portpkg":"portpkg","vnd.mcd":"mcd","vnd.medcalcdata":"mc1","vnd.mediastation.cdkey":"cdkey","vnd.mfer":"mwf","vnd.mfmp":"mfm","vnd.micrografx.flo":"flo","vnd.micrografx.igx":"igx","vnd.mif":"mif","vnd.mobius.daf":"daf","vnd.mobius.dis":"dis","vnd.mobius.mbk":"mbk","vnd.mobius.mqy":"mqy","vnd.mobius.msl":"msl","vnd.mobius.plc":"plc","vnd.mobius.txf":"txf","vnd.mophun.application":"mpn","vnd.mophun.certificate":"mpc","vnd.ms-artgalry":"cil","vnd.ms-cab-compressed":"cab","vnd.ms-excel.addin.macroenabled.12":"xlam","vnd.ms-excel.sheet.binary.macroenabled.12":"xlsb","vnd.ms-excel.sheet.macroenabled.12":"xlsm","vnd.ms-excel.template.macroenabled.12":"xltm","vnd.ms-fontobject":"eot","vnd.ms-htmlhelp":"chm","vnd.ms-ims":"ims","vnd.ms-lrm":"lrm","vnd.ms-officetheme":"thmx","vnd.ms-powerpoint.addin.macroenabled.12":"ppam","vnd.ms-powerpoint.presentation.macroenabled.12":"pptm","vnd.ms-powerpoint.slide.macroenabled.12":"sldm","vnd.ms-powerpoint.slideshow.macroenabled.12":"ppsm","vnd.ms-powerpoint.template.macroenabled.12":"potm","vnd.ms-project":["mpp","mpt"],"vnd.ms-word.document.macroenabled.12":"docm","vnd.ms-word.template.macroenabled.12":"dotm","vnd.ms-works":["wps","wks","wcm","wdb"],"vnd.ms-wpl":"wpl","vnd.ms-xpsdocument":"xps","vnd.mseq":"mseq","vnd.musician":"mus","vnd.muvee.style":"msty","vnd.mynfc":"taglet","vnd.neurolanguage.nlu":"nlu","vnd.nitf":["ntf","nitf"],"vnd.noblenet-directory":"nnd","vnd.noblenet-sealer":"nns","vnd.noblenet-web":"nnw","vnd.nokia.n-gage.data":"ngdat","vnd.nokia.n-gage.symbian.install":"n-gage","vnd.nokia.radio-preset":"rpst","vnd.nokia.radio-presets":"rpss","vnd.novadigm.edm":"edm","vnd.novadigm.edx":"edx","vnd.novadigm.ext":"ext","vnd.oasis.opendocument.chart-template":"otc","vnd.oasis.opendocument.formula-template":"odft","vnd.oasis.opendocument.image-template":"oti","vnd.olpc-sugar":"xo","vnd.oma.dd2+xml":"dd2","vnd.openofficeorg.extension":"oxt","vnd.openxmlformats-officedocument.presentationml.slide":"sldx","vnd.osgeo.mapguide.package":"mgp","vnd.osgi.dp":"dp","vnd.osgi.subsystem":"esa","vnd.palm":["pdb","pqa","oprc"],"vnd.pawaafile":"paw","vnd.pg.format":"str","vnd.pg.osasli":"ei6","vnd.picsel":"efif","vnd.pmi.widget":"wg","vnd.pocketlearn":"plf","vnd.powerbuilder6":"pbd","vnd.previewsystems.box":"box","vnd.proteus.magazine":"mgz","vnd.publishare-delta-tree":"qps","vnd.pvi.ptid1":"ptid","vnd.quark.quarkxpress":["qxd","qxt","qwd","qwt","qxl","qxb"],"vnd.realvnc.bed":"bed","vnd.recordare.musicxml":"mxl","vnd.recordare.musicxml+xml":"musicxml","vnd.rig.cryptonote":"cryptonote","vnd.rn-realmedia":"rm","vnd.rn-realmedia-vbr":"rmvb","vnd.route66.link66+xml":"link66","vnd.sailingtracker.track":"st","vnd.seemail":"see","vnd.sema":"sema","vnd.semd":"semd","vnd.semf":"semf","vnd.shana.informed.formdata":"ifm","vnd.shana.informed.formtemplate":"itp","vnd.shana.informed.interchange":"iif","vnd.shana.informed.package":"ipk","vnd.simtech-mindmapper":["twd","twds"],"vnd.smart.teacher":"teacher","vnd.solent.sdkm+xml":["sdkm","sdkd"],"vnd.spotfire.dxp":"dxp","vnd.spotfire.sfs":"sfs","vnd.stepmania.package":"smzip","vnd.stepmania.stepchart":"sm","vnd.sus-calendar":["sus","susp"],"vnd.svd":"svd","vnd.syncml+xml":"xsm","vnd.syncml.dm+wbxml":"bdm","vnd.syncml.dm+xml":"xdm","vnd.tao.intent-module-archive":"tao","vnd.tcpdump.pcap":["pcap","cap","dmp"],"vnd.tmobile-livetv":"tmo","vnd.trid.tpt":"tpt","vnd.triscape.mxs":"mxs","vnd.trueapp":"tra","vnd.ufdl":["ufd","ufdl"],"vnd.uiq.theme":"utz","vnd.umajin":"umj","vnd.unity":"unityweb","vnd.uoml+xml":"uoml","vnd.vcx":"vcx","vnd.visionary":"vis","vnd.vsf":"vsf","vnd.webturbo":"wtb","vnd.wolfram.player":"nbp","vnd.wqd":"wqd","vnd.wt.stf":"stf","vnd.xara":"xar","vnd.xfdl":"xfdl","vnd.yamaha.hv-dic":"hvd","vnd.yamaha.hv-script":"hvs","vnd.yamaha.hv-voice":"hvp","vnd.yamaha.openscoreformat":"osf","vnd.yamaha.openscoreformat.osfpvg+xml":"osfpvg","vnd.yamaha.smaf-audio":"saf","vnd.yamaha.smaf-phrase":"spf","vnd.yellowriver-custom-menu":"cmp","vnd.zul":["zir","zirz"],"vnd.zzazz.deck+xml":"zaz","voicexml+xml":"vxml",widget:"wgt",winhlp:"hlp","wsdl+xml":"wsdl","wspolicy+xml":"wspolicy","x-ace-compressed":"ace","x-authorware-bin":["aab","x32","u32","vox"],"x-authorware-map":"aam","x-authorware-seg":"aas","x-blorb":["blb","blorb"],"x-bzip":"bz","x-bzip2":["bz2","boz"],"x-cfs-compressed":"cfs","x-chat":"chat","x-conference":"nsc","x-dgc-compressed":"dgc","x-dtbncx+xml":"ncx","x-dtbook+xml":"dtb","x-dtbresource+xml":"res","x-eva":"eva","x-font-bdf":"bdf","x-font-ghostscript":"gsf","x-font-linux-psf":"psf","x-font-otf":"otf","x-font-pcf":"pcf","x-font-snf":"snf","x-font-ttf":["ttf","ttc"],"x-font-type1":["pfa","pfb","pfm","afm"],"x-font-woff":"woff","x-freearc":"arc","x-gca-compressed":"gca","x-glulx":"ulx","x-gramps-xml":"gramps","x-install-instructions":"install","x-lzh-compressed":["lzh","lha"],"x-mie":"mie","x-mobipocket-ebook":["prc","mobi"],"x-ms-application":"application","x-ms-shortcut":"lnk","x-ms-xbap":"xbap","x-msbinder":"obd","x-mscardfile":"crd","x-msclip":"clp","x-msdownload":["exe","dll","com","bat","msi"],"x-msmediaview":["mvb","m13","m14"],"x-msmetafile":["wmf","wmz","emf","emz"],"x-msmoney":"mny","x-mspublisher":"pub","x-msschedule":"scd","x-msterminal":"trm","x-mswrite":"wri","x-nzb":"nzb","x-pkcs12":["p12","pfx"],"x-pkcs7-certificates":["p7b","spc"],"x-research-info-systems":"ris","x-silverlight-app":"xap","x-sql":"sql","x-stuffitx":"sitx","x-subrip":"srt","x-t3vm-image":"t3","x-tads":"gam","x-tex":"tex","x-tex-tfm":"tfm","x-tgif":"obj","x-xliff+xml":"xlf","x-xz":"xz","x-zmachine":["z1","z2","z3","z4","z5","z6","z7","z8"],"xaml+xml":"xaml","xcap-diff+xml":"xdf","xenc+xml":"xenc","xml-dtd":"dtd","xop+xml":"xop","xproc+xml":"xpl","xslt+xml":"xslt","xv+xml":["mxml","xhvml","xvml","xvm"],yang:"yang","yin+xml":"yin",envoy:"evy",fractals:"fif","internet-property-stream":"acx",olescript:"axs","vnd.ms-outlook":"msg","vnd.ms-pkicertstore":"sst","x-compress":"z","x-compressed":"tgz","x-gzip":"gz","x-perfmon":["pma","pmc","pml","pmr","pmw"],"x-pkcs7-mime":["p7c","p7m"],"ynd.ms-pkipko":"pko"},audio:{amr:"amr","amr-wb":"awb",annodex:"axa",basic:["au","snd"],flac:"flac",midi:["mid","midi","kar","rmi"],mpeg:["mpga","mpega","mp2","mp3","m4a","mp2a","m2a","m3a"],mpegurl:"m3u",ogg:["oga","ogg","spx"],"prs.sid":"sid","x-aiff":["aif","aiff","aifc"],"x-gsm":"gsm","x-ms-wma":"wma","x-ms-wax":"wax","x-pn-realaudio":"ram","x-realaudio":"ra","x-sd2":"sd2","x-wav":"wav",adpcm:"adp",mp4:"mp4a",s3m:"s3m",silk:"sil","vnd.dece.audio":["uva","uvva"],"vnd.digital-winds":"eol","vnd.dra":"dra","vnd.dts":"dts","vnd.dts.hd":"dtshd","vnd.lucent.voice":"lvp","vnd.ms-playready.media.pya":"pya","vnd.nuera.ecelp4800":"ecelp4800","vnd.nuera.ecelp7470":"ecelp7470","vnd.nuera.ecelp9600":"ecelp9600","vnd.rip":"rip",webm:"weba","x-aac":"aac","x-caf":"caf","x-matroska":"mka","x-pn-realaudio-plugin":"rmp",xm:"xm",mid:["mid","rmi"]},chemical:{"x-alchemy":"alc","x-cache":["cac","cache"],"x-cache-csf":"csf","x-cactvs-binary":["cbin","cascii","ctab"],"x-cdx":"cdx","x-chem3d":"c3d","x-cif":"cif","x-cmdf":"cmdf","x-cml":"cml","x-compass":"cpa","x-crossfire":"bsd","x-csml":["csml","csm"],"x-ctx":"ctx","x-cxf":["cxf","cef"],"x-embl-dl-nucleotide":["emb","embl"],"x-gamess-input":["inp","gam","gamin"],"x-gaussian-checkpoint":["fch","fchk"],"x-gaussian-cube":"cub","x-gaussian-input":["gau","gjc","gjf"],"x-gaussian-log":"gal","x-gcg8-sequence":"gcg","x-genbank":"gen","x-hin":"hin","x-isostar":["istr","ist"],"x-jcamp-dx":["jdx","dx"],"x-kinemage":"kin","x-macmolecule":"mcm","x-macromodel-input":["mmd","mmod"],"x-mdl-molfile":"mol","x-mdl-rdfile":"rd","x-mdl-rxnfile":"rxn","x-mdl-sdfile":["sd","sdf"],"x-mdl-tgf":"tgf","x-mmcif":"mcif","x-mol2":"mol2","x-molconn-Z":"b","x-mopac-graph":"gpt","x-mopac-input":["mop","mopcrt","mpc","zmt"],"x-mopac-out":"moo","x-ncbi-asn1":"asn","x-ncbi-asn1-ascii":["prt","ent"],"x-ncbi-asn1-binary":["val","aso"],"x-pdb":["pdb","ent"],"x-rosdal":"ros","x-swissprot":"sw","x-vamas-iso14976":"vms","x-vmd":"vmd","x-xtel":"xtel","x-xyz":"xyz"},image:{gif:"gif",ief:"ief",jpeg:["jpeg","jpg","jpe"],pcx:"pcx",png:"png","svg+xml":["svg","svgz"],tiff:["tiff","tif"],"vnd.djvu":["djvu","djv"],"vnd.wap.wbmp":"wbmp","x-canon-cr2":"cr2","x-canon-crw":"crw","x-cmu-raster":"ras","x-coreldraw":"cdr","x-coreldrawpattern":"pat","x-coreldrawtemplate":"cdt","x-corelphotopaint":"cpt","x-epson-erf":"erf","x-icon":"ico","x-jg":"art","x-jng":"jng","x-nikon-nef":"nef","x-olympus-orf":"orf","x-photoshop":"psd","x-portable-anymap":"pnm","x-portable-bitmap":"pbm","x-portable-graymap":"pgm","x-portable-pixmap":"ppm","x-rgb":"rgb","x-xbitmap":"xbm","x-xpixmap":"xpm","x-xwindowdump":"xwd",bmp:"bmp",cgm:"cgm",g3fax:"g3",ktx:"ktx","prs.btif":"btif",sgi:"sgi","vnd.dece.graphic":["uvi","uvvi","uvg","uvvg"],"vnd.dwg":"dwg","vnd.dxf":"dxf","vnd.fastbidsheet":"fbs","vnd.fpx":"fpx","vnd.fst":"fst","vnd.fujixerox.edmics-mmr":"mmr","vnd.fujixerox.edmics-rlc":"rlc","vnd.ms-modi":"mdi","vnd.ms-photo":"wdp","vnd.net-fpx":"npx","vnd.xiff":"xif",webp:"webp","x-3ds":"3ds","x-cmx":"cmx","x-freehand":["fh","fhc","fh4","fh5","fh7"],"x-pict":["pic","pct"],"x-tga":"tga","cis-cod":"cod",pipeg:"jfif"},message:{rfc822:["eml","mime","mht","mhtml","nws"]},model:{iges:["igs","iges"],mesh:["msh","mesh","silo"],vrml:["wrl","vrml"],"x3d+vrml":["x3dv","x3dvz"],"x3d+xml":["x3d","x3dz"],"x3d+binary":["x3db","x3dbz"],"vnd.collada+xml":"dae","vnd.dwf":"dwf","vnd.gdl":"gdl","vnd.gtw":"gtw","vnd.mts":"mts","vnd.vtu":"vtu"},text:{"cache-manifest":["manifest","appcache"],calendar:["ics","icz","ifb"],css:"css",csv:"csv",h323:"323",html:["html","htm","shtml","stm"],iuls:"uls",mathml:"mml",plain:["txt","text","brf","conf","def","list","log","in","bas"],richtext:"rtx",scriptlet:["sct","wsc"],texmacs:["tm","ts"],"tab-separated-values":"tsv","vnd.sun.j2me.app-descriptor":"jad","vnd.wap.wml":"wml","vnd.wap.wmlscript":"wmls","x-bibtex":"bib","x-boo":"boo","x-c++hdr":["h++","hpp","hxx","hh"],"x-c++src":["c++","cpp","cxx","cc"],"x-component":"htc","x-dsrc":"d","x-diff":["diff","patch"],"x-haskell":"hs","x-java":"java","x-literate-haskell":"lhs","x-moc":"moc","x-pascal":["p","pas"],"x-pcs-gcd":"gcd","x-perl":["pl","pm"],"x-python":"py","x-scala":"scala","x-setext":"etx","x-tcl":["tcl","tk"],"x-tex":["tex","ltx","sty","cls"],"x-vcalendar":"vcs","x-vcard":"vcf",n3:"n3","prs.lines.tag":"dsc",sgml:["sgml","sgm"],troff:["t","tr","roff","man","me","ms"],turtle:"ttl","uri-list":["uri","uris","urls"],vcard:"vcard","vnd.curl":"curl","vnd.curl.dcurl":"dcurl","vnd.curl.scurl":"scurl","vnd.curl.mcurl":"mcurl","vnd.dvb.subtitle":"sub","vnd.fly":"fly","vnd.fmi.flexstor":"flx","vnd.graphviz":"gv","vnd.in3d.3dml":"3dml","vnd.in3d.spot":"spot","x-asm":["s","asm"],"x-c":["c","cc","cxx","cpp","h","hh","dic"],"x-fortran":["f","for","f77","f90"],"x-opml":"opml","x-nfo":"nfo","x-sfv":"sfv","x-uuencode":"uu",webviewhtml:"htt"},video:{avif:".avif","3gpp":"3gp",annodex:"axv",dl:"dl",dv:["dif","dv"],fli:"fli",gl:"gl",mpeg:["mpeg","mpg","mpe","m1v","m2v","mp2","mpa","mpv2"],mp4:["mp4","mp4v","mpg4"],quicktime:["qt","mov"],ogg:"ogv","vnd.mpegurl":["mxu","m4u"],"x-flv":"flv","x-la-asf":["lsf","lsx"],"x-mng":"mng","x-ms-asf":["asf","asx","asr"],"x-ms-wm":"wm","x-ms-wmv":"wmv","x-ms-wmx":"wmx","x-ms-wvx":"wvx","x-msvideo":"avi","x-sgi-movie":"movie","x-matroska":["mpv","mkv","mk3d","mks"],"3gpp2":"3g2",h261:"h261",h263:"h263",h264:"h264",jpeg:"jpgv",jpm:["jpm","jpgm"],mj2:["mj2","mjp2"],"vnd.dece.hd":["uvh","uvvh"],"vnd.dece.mobile":["uvm","uvvm"],"vnd.dece.pd":["uvp","uvvp"],"vnd.dece.sd":["uvs","uvvs"],"vnd.dece.video":["uvv","uvvv"],"vnd.dvb.file":"dvb","vnd.fvt":"fvt","vnd.ms-playready.media.pyv":"pyv","vnd.uvvu.mp4":["uvu","uvvu"],"vnd.vivo":"viv",webm:"webm","x-f4v":"f4v","x-m4v":"m4v","x-ms-vob":"vob","x-smv":"smv"},"x-conference":{"x-cooltalk":"ice"},"x-world":{"x-vrml":["vrm","vrml","wrl","flr","wrz","xaf","xof"]}},X4=(()=>{let r={};for(let e in Bd)if(Bd.hasOwnProperty(e)){for(let t in Bd[e])if(Bd[e].hasOwnProperty(t)){let n=Bd[e][t];if(typeof n=="string")r[n]=e+"/"+t;else for(let o=0;o<n.length;o++)r[n[o]]=e+"/"+t}}return r})();var jO=[];for(let r=0;r<256;r++){let e=r;for(let t=0;t<8;t++)e&1?e=e>>>1^3988292384:e=e>>>1;jO[r]=e}var cg=class{constructor(e){this.crc=e||-1}append(e){let t=this.crc|0;for(let n=0,o=e.length|0;n<o;n++)t=t>>>8^jO[(t^e[n])&255];this.crc=t}get(){return~this.crc}},ns=cg;var dg=vD;function vD(r){if(typeof TextEncoder>"u"){r=unescape(encodeURIComponent(r));let e=new Uint8Array(r.length);for(let t=0;t<e.length;t++)e[t]=r.charCodeAt(t);return e}else return new TextEncoder().encode(r)}var ao={concat(r,e){if(r.length===0||e.length===0)return r.concat(e);let t=r[r.length-1],n=ao.getPartial(t);return n===32?r.concat(e):ao._shiftRight(e,n,t|0,r.slice(0,r.length-1))},bitLength(r){let e=r.length;if(e===0)return 0;let t=r[e-1];return(e-1)*32+ao.getPartial(t)},clamp(r,e){if(r.length*32<e)return r;r=r.slice(0,Math.ceil(e/32));let t=r.length;return e=e&31,t>0&&e&&(r[t-1]=ao.partial(e,r[t-1]&2147483648>>e-1,1)),r},partial(r,e,t){return r===32?e:(t?e|0:e<<32-r)+r*1099511627776},getPartial(r){return Math.round(r/1099511627776)||32},_shiftRight(r,e,t,n){for(n===void 0&&(n=[]);e>=32;e-=32)n.push(t),t=0;if(e===0)return n.concat(r);for(let a=0;a<r.length;a++)n.push(t|r[a]>>>e),t=r[a]<<32-e;let o=r.length?r[r.length-1]:0,i=ao.getPartial(o);return n.push(ao.partial(e+i&31,e+i>32?t:n.pop(),1)),n}},Md={bytes:{fromBits(r){let t=ao.bitLength(r)/8,n=new Uint8Array(t),o;for(let i=0;i<t;i++)(i&3)===0&&(o=r[i/4]),n[i]=o>>>24,o<<=8;return n},toBits(r){let e=[],t,n=0;for(t=0;t<r.length;t++)n=n<<8|r[t],(t&3)===3&&(e.push(n),n=0);return t&3&&e.push(ao.partial(8*(t&3),n)),e}}},ug={};ug.sha1=function(r){r?(this._h=r._h.slice(0),this._buffer=r._buffer.slice(0),this._length=r._length):this.reset()};ug.sha1.prototype={blockSize:512,reset:function(){let r=this;return r._h=this._init.slice(0),r._buffer=[],r._length=0,r},update:function(r){let e=this;typeof r=="string"&&(r=Md.utf8String.toBits(r));let t=e._buffer=ao.concat(e._buffer,r),n=e._length,o=e._length=n+ao.bitLength(r);if(o>9007199254740991)throw new Error("Cannot hash more than 2^53 - 1 bits");let i=new Uint32Array(t),a=0;for(let s=e.blockSize+n-(e.blockSize+n&e.blockSize-1);s<=o;s+=e.blockSize)e._block(i.subarray(16*a,16*(a+1))),a+=1;return t.splice(0,16*a),e},finalize:function(){let r=this,e=r._buffer,t=r._h;e=ao.concat(e,[ao.partial(1,1)]);for(let n=e.length+2;n&15;n++)e.push(0);for(e.push(Math.floor(r._length/4294967296)),e.push(r._length|0);e.length;)r._block(e.splice(0,16));return r.reset(),t},_init:[1732584193,4023233417,2562383102,271733878,3285377520],_key:[1518500249,1859775393,2400959708,3395469782],_f:function(r,e,t,n){if(r<=19)return e&t|~e&n;if(r<=39)return e^t^n;if(r<=59)return e&t|e&n|t&n;if(r<=79)return e^t^n},_S:function(r,e){return e<<r|e>>>32-r},_block:function(r){let e=this,t=e._h,n=Array(80);for(let d=0;d<16;d++)n[d]=r[d];let o=t[0],i=t[1],a=t[2],s=t[3],l=t[4];for(let d=0;d<=79;d++){d>=16&&(n[d]=e._S(1,n[d-3]^n[d-8]^n[d-14]^n[d-16]));let c=e._S(5,o)+e._f(d,i,a,s)+l+n[d]+e._key[Math.floor(d/20)]|0;l=s,s=a,a=e._S(30,i),i=o,o=c}t[0]=t[0]+o|0,t[1]=t[1]+i|0,t[2]=t[2]+a|0,t[3]=t[3]+s|0,t[4]=t[4]+l|0}};var pg={};pg.aes=class{constructor(r){let e=this;e._tables=[[[],[],[],[],[]],[[],[],[],[],[]]],e._tables[0][0][0]||e._precompute();let t=e._tables[0][4],n=e._tables[1],o=r.length,i,a,s,l=1;if(o!==4&&o!==6&&o!==8)throw new Error("invalid aes key size");for(e._key=[a=r.slice(0),s=[]],i=o;i<4*o+28;i++){let d=a[i-1];(i%o===0||o===8&&i%o===4)&&(d=t[d>>>24]<<24^t[d>>16&255]<<16^t[d>>8&255]<<8^t[d&255],i%o===0&&(d=d<<8^d>>>24^l<<24,l=l<<1^(l>>7)*283)),a[i]=a[i-o]^d}for(let d=0;i;d++,i--){let c=a[d&3?i:i-4];i<=4||d<4?s[d]=c:s[d]=n[0][t[c>>>24]]^n[1][t[c>>16&255]]^n[2][t[c>>8&255]]^n[3][t[c&255]]}}encrypt(r){return this._crypt(r,0)}decrypt(r){return this._crypt(r,1)}_precompute(){let r=this._tables[0],e=this._tables[1],t=r[4],n=e[4],o=[],i=[],a,s,l,d;for(let c=0;c<256;c++)i[(o[c]=c<<1^(c>>7)*283)^c]=c;for(let c=a=0;!t[c];c^=s||1,a=i[a]||1){let p=a^a<<1^a<<2^a<<3^a<<4;p=p>>8^p&255^99,t[c]=p,n[p]=c,d=o[l=o[s=o[c]]];let u=d*16843009^l*65537^s*257^c*16843008,_=o[p]*257^p*16843008;for(let h=0;h<4;h++)r[h][c]=_=_<<24^_>>>8,e[h][p]=u=u<<24^u>>>8}for(let c=0;c<5;c++)r[c]=r[c].slice(0),e[c]=e[c].slice(0)}_crypt(r,e){if(r.length!==4)throw new Error("invalid aes block size");let t=this._key[e],n=t.length/4-2,o=[0,0,0,0],i=this._tables[e],a=i[0],s=i[1],l=i[2],d=i[3],c=i[4],p=r[0]^t[0],u=r[e?3:1]^t[1],_=r[2]^t[2],h=r[e?1:3]^t[3],S=4,m,f,T;for(let y=0;y<n;y++)m=a[p>>>24]^s[u>>16&255]^l[_>>8&255]^d[h&255]^t[S],f=a[u>>>24]^s[_>>16&255]^l[h>>8&255]^d[p&255]^t[S+1],T=a[_>>>24]^s[h>>16&255]^l[p>>8&255]^d[u&255]^t[S+2],h=a[h>>>24]^s[p>>16&255]^l[u>>8&255]^d[_&255]^t[S+3],S+=4,p=m,u=f,_=T;for(let y=0;y<4;y++)o[e?3&-y:y]=c[p>>>24]<<24^c[u>>16&255]<<16^c[_>>8&255]<<8^c[h&255]^t[S++],m=p,p=u,u=_,_=h,h=m;return o}};var $O={getRandomValues(r){let e=new Uint32Array(r.buffer),t=n=>{let o=987654321,i=4294967295;return function(){return o=36969*(o&65535)+(o>>16)&i,n=18e3*(n&65535)+(n>>16)&i,(((o<<16)+n&i)/4294967296+.5)*(Math.random()>.5?1:-1)}};for(let n=0,o;n<r.length;n+=4){let i=t((o||Math.random())*4294967296);o=i()*987654071,e[n/4]=i()*4294967296|0}return r}},_g={};_g.ctrGladman=class{constructor(r,e){this._prf=r,this._initIv=e,this._iv=e}reset(){this._iv=this._initIv}update(r){return this.calculate(this._prf,r,this._iv)}incWord(r){if((r>>24&255)===255){let e=r>>16&255,t=r>>8&255,n=r&255;e===255?(e=0,t===255?(t=0,n===255?n=0:++n):++t):++e,r=0,r+=e<<16,r+=t<<8,r+=n}else r+=1<<24;return r}incCounter(r){(r[0]=this.incWord(r[0]))===0&&(r[1]=this.incWord(r[1]))}calculate(r,e,t){let n;if(!(n=e.length))return[];let o=ao.bitLength(e);for(let i=0;i<n;i+=4){this.incCounter(t);let a=r.encrypt(t);e[i]^=a[0],e[i+1]^=a[1],e[i+2]^=a[2],e[i+3]^=a[3]}return ao.clamp(e,o)}};var Xl={importKey(r){return new Xl.hmacSha1(Md.bytes.toBits(r))},pbkdf2(r,e,t,n){if(t=t||1e4,n<0||t<0)throw new Error("invalid params to pbkdf2");let o=(n>>5)+1<<2,i,a,s,l,d,c=new ArrayBuffer(o),p=new DataView(c),u=0,_=ao;for(e=Md.bytes.toBits(e),d=1;u<(o||1);d++){for(i=a=r.encrypt(_.concat(e,[d])),s=1;s<t;s++)for(a=r.encrypt(a),l=0;l<a.length;l++)i[l]^=a[l];for(s=0;u<(o||1)&&s<i.length;s++)p.setInt32(u,i[s]),u+=4}return c.slice(0,n/8)}};Xl.hmacSha1=class{constructor(r){let e=this,t=e._hash=ug.sha1,n=[[],[]],o=t.prototype.blockSize/32;e._baseHash=[new t,new t],r.length>o&&(r=t.hash(r));for(let i=0;i<o;i++)n[0][i]=r[i]^909522486,n[1][i]=r[i]^1549556828;e._baseHash[0].update(n[0]),e._baseHash[1].update(n[1]),e._resultHash=new t(e._baseHash[0])}reset(){let r=this;r._resultHash=new r._hash(r._baseHash[0]),r._updated=!1}update(r){let e=this;e._updated=!0,e._resultHash.update(r)}digest(){let r=this,e=r._resultHash.finalize(),t=new r._hash(r._baseHash[1]).update(e).finalize();return r.reset(),t}encrypt(r){if(this._updated)throw new Error("encrypt on already updated hmac called!");return this.update(r),this.digest(r)}};var el="Invalid pasword",ql=16,OD="raw",eC={name:"PBKDF2"},CD={name:"HMAC"},bD="SHA-1",ND=Object.assign({hash:CD},eC),tC=Object.assign({iterations:1e3,hash:{name:bD}},eC),PD=["deriveBits"],Ud=[8,12,16],Gd=[16,24,32],os=10,rC=[0,0,0,0],Z_=typeof crypto<"u",nC=Z_&&typeof crypto.subtle<"u",Ji=Md.bytes,oC=pg.aes,iC=_g.ctrGladman,aC=Xl.hmacSha1,X_=class{constructor(e,t,n){Object.assign(this,{password:e,signed:t,strength:n-1,pendingInput:new Uint8Array(0)})}async append(e){let t=this;if(t.password){let o=qo(e,0,Ud[t.strength]+2);await FD(t,o,t.password),t.password=null,t.aesCtrGladman=new iC(new oC(t.keys.key),Array.from(rC)),t.hmac=new aC(t.keys.authentication),e=qo(e,Ud[t.strength]+2)}let n=new Uint8Array(e.length-os-(e.length-os)%ql);return sC(t,e,n,0,os,!0)}flush(){let e=this,t=e.pendingInput,n=qo(t,0,t.length-os),o=qo(t,t.length-os),i=new Uint8Array(0);if(n.length){let s=Ji.toBits(n);e.hmac.update(s);let l=e.aesCtrGladman.update(s);i=Ji.fromBits(l)}let a=!0;if(e.signed){let s=qo(Ji.fromBits(e.hmac.digest()),0,os);for(let l=0;l<os;l++)s[l]!=o[l]&&(a=!1)}return{valid:a,data:i}}},q_=class{constructor(e,t){Object.assign(this,{password:e,strength:t-1,pendingInput:new Uint8Array(0)})}async append(e){let t=this,n=new Uint8Array(0);t.password&&(n=await DD(t,t.password),t.password=null,t.aesCtrGladman=new iC(new oC(t.keys.key),Array.from(rC)),t.hmac=new aC(t.keys.authentication));let o=new Uint8Array(n.length+e.length-e.length%ql);return o.set(n,0),sC(t,e,o,n.length,0)}flush(){let e=this,t=new Uint8Array(0);if(e.pendingInput.length){let o=e.aesCtrGladman.update(Ji.toBits(e.pendingInput));e.hmac.update(o),t=Ji.fromBits(o)}let n=qo(Ji.fromBits(e.hmac.digest()),0,os);return{data:hg(t,n),signature:n}}};function sC(r,e,t,n,o,i){let a=e.length-o;r.pendingInput.length&&(e=hg(r.pendingInput,e),t=BD(t,a-a%ql));let s;for(s=0;s<=a-ql;s+=ql){let l=Ji.toBits(qo(e,s,s+ql));i&&r.hmac.update(l);let d=r.aesCtrGladman.update(l);i||r.hmac.update(d),t.set(Ji.fromBits(d),s+n)}return r.pendingInput=qo(e,s),t}async function FD(r,e,t){await lC(r,t,qo(e,0,Ud[r.strength]));let n=qo(e,Ud[r.strength]),o=r.keys.passwordVerification;if(o[0]!=n[0]||o[1]!=n[1])throw new Error(el)}async function DD(r,e){let t=wD(new Uint8Array(Ud[r.strength]));return await lC(r,e,t),hg(t,r.keys.passwordVerification)}async function lC(r,e,t){let n=dg(e),o=await LD(OD,n,ND,!1,PD),i=await xD(Object.assign({salt:t},tC),o,8*(Gd[r.strength]*2+2)),a=new Uint8Array(i);r.keys={key:Ji.toBits(qo(a,0,Gd[r.strength])),authentication:Ji.toBits(qo(a,Gd[r.strength],Gd[r.strength]*2)),passwordVerification:qo(a,Gd[r.strength]*2)}}function wD(r){return Z_&&typeof crypto.getRandomValues=="function"?crypto.getRandomValues(r):$O.getRandomValues(r)}function LD(r,e,t,n,o){return Z_&&nC&&typeof crypto.subtle.importKey=="function"?crypto.subtle.importKey(r,e,t,n,o):Xl.importKey(e)}async function xD(r,e,t){return Z_&&nC&&typeof crypto.subtle.deriveBits=="function"?await crypto.subtle.deriveBits(r,e,t):Xl.pbkdf2(e,r.salt,tC.iterations,t)}function hg(r,e){let t=r;return r.length+e.length&&(t=new Uint8Array(r.length+e.length),t.set(r,0),t.set(e,r.length)),t}function BD(r,e){if(e&&e>r.length){let t=r;r=new Uint8Array(e),r.set(t,0)}return r}function qo(r,e,t){return r.subarray(e,t)}var Zl=12,J_=class{constructor(e,t){let n=this;Object.assign(n,{password:e,passwordVerification:t}),pC(n,e)}append(e){let t=this;if(t.password){let n=cC(t,e.subarray(0,Zl));if(t.password=null,n[Zl-1]!=t.passwordVerification)throw new Error(el);e=e.subarray(Zl)}return cC(t,e)}flush(){return{valid:!0,data:new Uint8Array(0)}}},j_=class{constructor(e,t){let n=this;Object.assign(n,{password:e,passwordVerification:t}),pC(n,e)}append(e){let t=this,n,o;if(t.password){t.password=null;let i=crypto.getRandomValues(new Uint8Array(Zl));i[Zl-1]=t.passwordVerification,n=new Uint8Array(e.length+i.length),n.set(dC(t,i),0),o=Zl}else n=new Uint8Array(e.length),o=0;return n.set(dC(t,e),o),n}flush(){return{data:new Uint8Array(0)}}};function cC(r,e){let t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=_C(r)^e[n],mg(r,t[n]);return t}function dC(r,e){let t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=_C(r)^e[n],mg(r,e[n]);return t}function pC(r,e){r.keys=[305419896,591751049,878082192],r.crcKey0=new ns(r.keys[0]),r.crcKey2=new ns(r.keys[2]);for(let t=0;t<e.length;t++)mg(r,e.charCodeAt(t))}function mg(r,e){r.crcKey0.append([e]),r.keys[0]=~r.crcKey0.get(),r.keys[1]=uC(r.keys[1]+hC(r.keys[0])),r.keys[1]=uC(Math.imul(r.keys[1],134775813)+1),r.crcKey2.append([r.keys[1]>>>24]),r.keys[2]=~r.crcKey2.get()}function _C(r){let e=r.keys[2]|2;return hC(Math.imul(e,e^1)>>>8)}function hC(r){return r&255}function uC(r){return r&4294967295}var Ag="deflate",$_="inflate",Vd="Invalid signature",fg=class{constructor(e,{signature:t,password:n,signed:o,compressed:i,zipCrypto:a,passwordVerification:s,encryptionStrength:l},{chunkSize:d}){let c=!!n;Object.assign(this,{signature:t,encrypted:c,signed:o,compressed:i,inflate:i&&new e({chunkSize:d}),crc32:o&&new ns,zipCrypto:a,decrypt:c&&a?new J_(n,s):new X_(n,o,l)})}async append(e){let t=this;return t.encrypted&&e.length&&(e=await t.decrypt.append(e)),t.compressed&&e.length&&(e=await t.inflate.append(e)),(!t.encrypted||t.zipCrypto)&&t.signed&&e.length&&t.crc32.append(e),e}async flush(){let e=this,t,n=new Uint8Array(0);if(e.encrypted){let o=e.decrypt.flush();if(!o.valid)throw new Error(Vd);n=o.data}if((!e.encrypted||e.zipCrypto)&&e.signed){let o=new DataView(new Uint8Array(4).buffer);if(t=e.crc32.get(),o.setUint32(0,t),e.signature!=o.getUint32(0,!1))throw new Error(Vd)}return e.compressed&&(n=await e.inflate.append(n)||new Uint8Array(0),await e.inflate.flush()),{data:n,signature:t}}},gg=class{constructor(e,{encrypted:t,signed:n,compressed:o,level:i,zipCrypto:a,password:s,passwordVerification:l,encryptionStrength:d},{chunkSize:c}){Object.assign(this,{encrypted:t,signed:n,compressed:o,deflate:o&&new e({level:i||5,chunkSize:c}),crc32:n&&new ns,zipCrypto:a,encrypt:t&&a?new j_(s,l):new q_(s,d)})}async append(e){let t=this,n=e;return t.compressed&&e.length&&(n=await t.deflate.append(e)),t.encrypted&&n.length&&(n=await t.encrypt.append(n)),(!t.encrypted||t.zipCrypto)&&t.signed&&e.length&&t.crc32.append(e),n}async flush(){let e=this,t,n=new Uint8Array(0);if(e.compressed&&(n=await e.deflate.flush()||new Uint8Array(0)),e.encrypted){n=await e.encrypt.append(n);let o=e.encrypt.flush();t=o.signature;let i=new Uint8Array(n.length+o.data.length);i.set(n,0),i.set(o.data,n.length),n=i}return(!e.encrypted||e.zipCrypto)&&e.signed&&(t=e.crc32.get()),{data:n,signature:t}}};function mC(r,e,t){if(e.codecType.startsWith(Ag))return new gg(r,e,t);if(e.codecType.startsWith($_))return new fg(r,e,t)}var fC="init",gC="append",Sg="flush",MD="message",AC=!0,eh=(r,e,t,n,o,i,a)=>(Object.assign(r,{busy:!0,codecConstructor:e,options:Object.assign({},t),scripts:a,terminate(){r.worker&&!r.busy&&(r.worker.terminate(),r.interface=null)},onTaskFinished(){r.busy=!1,o(r)}}),i?UD(r,n):GD(r,n));function GD(r,e){let t=mC(r.codecConstructor,r.options,e);return{async append(n){try{return await t.append(n)}catch(o){throw r.onTaskFinished(),o}},async flush(){try{return await t.flush()}finally{r.onTaskFinished()}},abort(){r.onTaskFinished()}}}function UD(r,e){let t,n={type:"module"};if(!r.interface){if(!AC)r.worker=o(n,e.baseURL);else try{r.worker=o({},e.baseURL)}catch{AC=!1,r.worker=o(n,e.baseURL)}r.worker.addEventListener(MD,s,!1),r.interface={append(l){return i({type:gC,data:l})},flush(){return i({type:Sg})},abort(){r.onTaskFinished()}}}return r.interface;function o(l,d){let c,p;c=r.scripts[0],typeof c=="function"&&(c=c());try{p=new URL(c,d)}catch{p=c}return new Worker(p,l)}async function i(l){if(!t){let d=r.options,c=r.scripts.slice(1);await a({scripts:c,type:fC,options:d,config:{chunkSize:e.chunkSize}})}return a(l)}function a(l){let d=r.worker,c=new Promise((p,u)=>t={resolve:p,reject:u});try{if(l.data)try{l.data=l.data.buffer,d.postMessage(l,[l.data])}catch{d.postMessage(l)}else d.postMessage(l)}catch(p){t.reject(p),t=null,r.onTaskFinished()}return c}function s(l){let d=l.data;if(t){let c=d.error,p=d.type;if(c){let u=new Error(c.message);u.stack=c.stack,t.reject(u),t=null,r.onTaskFinished()}else if(p==fC||p==Sg||p==gC){let u=d.data;p==Sg?(t.resolve({data:new Uint8Array(u),signature:d.signature}),t=null,r.onTaskFinished()):t.resolve(u&&new Uint8Array(u))}}}}var tl=[],Tg=[];function Eg(r,e,t){let o=!(!e.compressed&&!e.signed&&!e.encrypted)&&(e.useWebWorkers||e.useWebWorkers===void 0&&t.useWebWorkers),i=o&&t.workerScripts?t.workerScripts[e.codecType]:[];if(tl.length<t.maxWorkers){let s={};return tl.push(s),eh(s,r,e,t,a,o,i)}else{let s=tl.find(l=>!l.busy);return s?(SC(s),eh(s,r,e,t,a,o,i)):new Promise(l=>Tg.push({resolve:l,codecConstructor:r,options:e,webWorker:o,scripts:i}))}function a(s){if(Tg.length){let[{resolve:l,codecConstructor:d,options:c,webWorker:p,scripts:u}]=Tg.splice(0,1);l(eh(s,d,c,t,a,p,u))}else s.worker?(SC(s),Number.isFinite(t.terminateWorkerTimeout)&&t.terminateWorkerTimeout>=0&&(s.terminateTimeout=setTimeout(()=>{tl=tl.filter(l=>l!=s),s.terminate()},t.terminateWorkerTimeout))):tl=tl.filter(l=>l!=s)}}function SC(r){r.terminateTimeout&&(clearTimeout(r.terminateTimeout),r.terminateTimeout=null)}var TC=r=>{if(typeof URL.createObjectURL=="function"){let e=()=>URL.createObjectURL(new Blob([`const{Array:t,Object:e,Math:n,Error:r,Uint8Array:i,Uint16Array:o,Uint32Array:s,Int32Array:f,DataView:c,TextEncoder:l,crypto:u,postMessage:a}=globalThis,w=[];for(let t=0;256>t;t++){let e=t;for(let t=0;8>t;t++)1&e?e=e>>>1^3988292384:e>>>=1;w[t]=e}class h{constructor(t){this.t=t||-1}append(t){let e=0|this.t;for(let n=0,r=0|t.length;r>n;n++)e=e>>>8^w[255&(e^t[n])];this.t=e}get(){return~this.t}}const d={concat(t,e){if(0===t.length||0===e.length)return t.concat(e);const n=t[t.length-1],r=d.i(n);return 32===r?t.concat(e):d.o(e,r,0|n,t.slice(0,t.length-1))},l(t){const e=t.length;if(0===e)return 0;const n=t[e-1];return 32*(e-1)+d.i(n)},u(t,e){if(32*t.length<e)return t;const r=(t=t.slice(0,n.ceil(e/32))).length;return e&=31,r>0&&e&&(t[r-1]=d.h(e,t[r-1]&2147483648>>e-1,1)),t},h:(t,e,n)=>32===t?e:(n?0|e:e<<32-t)+1099511627776*t,i:t=>n.round(t/1099511627776)||32,o(t,e,n,r){for(void 0===r&&(r=[]);e>=32;e-=32)r.push(n),n=0;if(0===e)return r.concat(t);for(let i=0;i<t.length;i++)r.push(n|t[i]>>>e),n=t[i]<<32-e;const i=t.length?t[t.length-1]:0,o=d.i(i);return r.push(d.h(e+o&31,e+o>32?n:r.pop(),1)),r}},p={p:{k(t){const e=d.l(t)/8,n=new i(e);let r;for(let i=0;e>i;i++)0==(3&i)&&(r=t[i/4]),n[i]=r>>>24,r<<=8;return n},g(t){const e=[];let n,r=0;for(n=0;n<t.length;n++)r=r<<8|t[n],3==(3&n)&&(e.push(r),r=0);return 3&n&&e.push(d.h(8*(3&n),r)),e}}},y={v:function(t){t?(this.m=t.m.slice(0),this.S=t.S.slice(0),this._=t._):this.reset()}};y.v.prototype={blockSize:512,reset:function(){const t=this;return t.m=this.I.slice(0),t.S=[],t._=0,t},update:function(t){const e=this;"string"==typeof t&&(t=p.A.g(t));const n=e.S=d.concat(e.S,t),i=e._,o=e._=i+d.l(t);if(o>9007199254740991)throw new r("Cannot hash more than 2^53 - 1 bits");const f=new s(n);let c=0;for(let t=e.blockSize+i-(e.blockSize+i&e.blockSize-1);o>=t;t+=e.blockSize)e.C(f.subarray(16*c,16*(c+1))),c+=1;return n.splice(0,16*c),e},V:function(){const t=this;let e=t.S;const r=t.m;e=d.concat(e,[d.h(1,1)]);for(let t=e.length+2;15&t;t++)e.push(0);for(e.push(n.floor(t._/4294967296)),e.push(0|t._);e.length;)t.C(e.splice(0,16));return t.reset(),r},I:[1732584193,4023233417,2562383102,271733878,3285377520],B:[1518500249,1859775393,2400959708,3395469782],D:(t,e,n,r)=>t>19?t>39?t>59?t>79?void 0:e^n^r:e&n|e&r|n&r:e^n^r:e&n|~e&r,U:(t,e)=>e<<t|e>>>32-t,C:function(e){const r=this,i=r.m,o=t(80);for(let t=0;16>t;t++)o[t]=e[t];let s=i[0],f=i[1],c=i[2],l=i[3],u=i[4];for(let t=0;79>=t;t++){16>t||(o[t]=r.U(1,o[t-3]^o[t-8]^o[t-14]^o[t-16]));const e=r.U(5,s)+r.D(t,f,c,l)+u+o[t]+r.B[n.floor(t/20)]|0;u=l,l=c,c=r.U(30,f),f=s,s=e}i[0]=i[0]+s|0,i[1]=i[1]+f|0,i[2]=i[2]+c|0,i[3]=i[3]+l|0,i[4]=i[4]+u|0}};const b={getRandomValues(t){const e=new s(t.buffer),r=t=>{let e=987654321;const r=4294967295;return()=>(e=36969*(65535&e)+(e>>16)&r,(((e<<16)+(t=18e3*(65535&t)+(t>>16)&r)&r)/4294967296+.5)*(n.random()>.5?1:-1))};for(let i,o=0;o<t.length;o+=4){const t=r(4294967296*(i||n.random()));i=987654071*t(),e[o/4]=4294967296*t()|0}return t}},k={importKey:t=>new k.M(p.p.g(t)),P(t,e,n,i){if(n=n||1e4,0>i||0>n)throw new r("invalid params to pbkdf2");const o=1+(i>>5)<<2;let s,f,l,u,a;const w=new ArrayBuffer(o),h=new c(w);let y=0;const b=d;for(e=p.p.g(e),a=1;(o||1)>y;a++){for(s=f=t.encrypt(b.concat(e,[a])),l=1;n>l;l++)for(f=t.encrypt(f),u=0;u<f.length;u++)s[u]^=f[u];for(l=0;(o||1)>y&&l<s.length;l++)h.setInt32(y,s[l]),y+=4}return w.slice(0,i/8)},M:class{constructor(t){const e=this,n=e.R=y.v,r=[[],[]],i=n.prototype.blockSize/32;e.H=[new n,new n],t.length>i&&(t=n.hash(t));for(let e=0;i>e;e++)r[0][e]=909522486^t[e],r[1][e]=1549556828^t[e];e.H[0].update(r[0]),e.H[1].update(r[1]),e.K=new n(e.H[0])}reset(){const t=this;t.K=new t.R(t.H[0]),t.L=!1}update(t){this.L=!0,this.K.update(t)}digest(){const t=this,e=t.K.V(),n=new t.R(t.H[1]).update(e).V();return t.reset(),n}encrypt(t){if(this.L)throw new r("encrypt on already updated hmac called!");return this.update(t),this.digest(t)}}},g={name:"PBKDF2"},v=e.assign({hash:{name:"HMAC"}},g),m=e.assign({iterations:1e3,hash:{name:"SHA-1"}},g),S=["deriveBits"],z=[8,12,16],_=[16,24,32],I=[0,0,0,0],A=void 0!==u,C=A&&void 0!==u.subtle,V=p.p,B=class{constructor(t){const e=this;e.T=[[[],[],[],[],[]],[[],[],[],[],[]]],e.T[0][0][0]||e.j();const n=e.T[0][4],i=e.T[1],o=t.length;let s,f,c,l=1;if(4!==o&&6!==o&&8!==o)throw new r("invalid aes key size");for(e.B=[f=t.slice(0),c=[]],s=o;4*o+28>s;s++){let t=f[s-1];(s%o==0||8===o&&s%o==4)&&(t=n[t>>>24]<<24^n[t>>16&255]<<16^n[t>>8&255]<<8^n[255&t],s%o==0&&(t=t<<8^t>>>24^l<<24,l=l<<1^283*(l>>7))),f[s]=f[s-o]^t}for(let t=0;s;t++,s--){const e=f[3&t?s:s-4];c[t]=4>=s||4>t?e:i[0][n[e>>>24]]^i[1][n[e>>16&255]]^i[2][n[e>>8&255]]^i[3][n[255&e]]}}encrypt(t){return this.F(t,0)}decrypt(t){return this.F(t,1)}j(){const t=this.T[0],e=this.T[1],n=t[4],r=e[4],i=[],o=[];let s,f,c,l;for(let t=0;256>t;t++)o[(i[t]=t<<1^283*(t>>7))^t]=t;for(let u=s=0;!n[u];u^=f||1,s=o[s]||1){let o=s^s<<1^s<<2^s<<3^s<<4;o=o>>8^255&o^99,n[u]=o,r[o]=u,l=i[c=i[f=i[u]]];let a=16843009*l^65537*c^257*f^16843008*u,w=257*i[o]^16843008*o;for(let n=0;4>n;n++)t[n][u]=w=w<<24^w>>>8,e[n][o]=a=a<<24^a>>>8}for(let n=0;5>n;n++)t[n]=t[n].slice(0),e[n]=e[n].slice(0)}F(t,e){if(4!==t.length)throw new r("invalid aes block size");const n=this.B[e],i=n.length/4-2,o=[0,0,0,0],s=this.T[e],f=s[0],c=s[1],l=s[2],u=s[3],a=s[4];let w,h,d,p=t[0]^n[0],y=t[e?3:1]^n[1],b=t[2]^n[2],k=t[e?1:3]^n[3],g=4;for(let t=0;i>t;t++)w=f[p>>>24]^c[y>>16&255]^l[b>>8&255]^u[255&k]^n[g],h=f[y>>>24]^c[b>>16&255]^l[k>>8&255]^u[255&p]^n[g+1],d=f[b>>>24]^c[k>>16&255]^l[p>>8&255]^u[255&y]^n[g+2],k=f[k>>>24]^c[p>>16&255]^l[y>>8&255]^u[255&b]^n[g+3],g+=4,p=w,y=h,b=d;for(let t=0;4>t;t++)o[e?3&-t:t]=a[p>>>24]<<24^a[y>>16&255]<<16^a[b>>8&255]<<8^a[255&k]^n[g++],w=p,p=y,y=b,b=k,k=w;return o}},E=class{constructor(t,e){this.O=t,this.W=e,this.q=e}reset(){this.q=this.W}update(t){return this.G(this.O,t,this.q)}J(t){if(255==(t>>24&255)){let e=t>>16&255,n=t>>8&255,r=255&t;255===e?(e=0,255===n?(n=0,255===r?r=0:++r):++n):++e,t=0,t+=e<<16,t+=n<<8,t+=r}else t+=1<<24;return t}N(t){0===(t[0]=this.J(t[0]))&&(t[1]=this.J(t[1]))}G(t,e,n){let r;if(!(r=e.length))return[];const i=d.l(e);for(let i=0;r>i;i+=4){this.N(n);const r=t.encrypt(n);e[i]^=r[0],e[i+1]^=r[1],e[i+2]^=r[2],e[i+3]^=r[3]}return d.u(e,i)}},D=k.M;class U{constructor(t,n,r){e.assign(this,{password:t,signed:n,X:r-1,Y:new i(0)})}async append(e){const n=this;if(n.password){const i=K(e,0,z[n.X]+2);await(async(t,e,n)=>{await R(t,n,K(e,0,z[t.X]));const i=K(e,z[t.X]),o=t.keys.passwordVerification;if(o[0]!=i[0]||o[1]!=i[1])throw new r("Invalid pasword")})(n,i,n.password),n.password=null,n.Z=new E(new B(n.keys.key),t.from(I)),n.$=new D(n.keys.tt),e=K(e,z[n.X]+2)}return P(n,e,new i(e.length-10-(e.length-10)%16),0,10,!0)}flush(){const t=this,e=t.Y,n=K(e,0,e.length-10),r=K(e,e.length-10);let o=new i(0);if(n.length){const e=V.g(n);t.$.update(e);const r=t.Z.update(e);o=V.k(r)}let s=!0;if(t.signed){const e=K(V.k(t.$.digest()),0,10);for(let t=0;10>t;t++)e[t]!=r[t]&&(s=!1)}return{valid:s,data:o}}}class M{constructor(t,n){e.assign(this,{password:t,X:n-1,Y:new i(0)})}async append(e){const n=this;let r=new i(0);n.password&&(r=await(async(t,e)=>{const n=(r=new i(z[t.X]),A&&"function"==typeof u.getRandomValues?u.getRandomValues(r):b.getRandomValues(r));var r;return await R(t,e,n),H(n,t.keys.passwordVerification)})(n,n.password),n.password=null,n.Z=new E(new B(n.keys.key),t.from(I)),n.$=new D(n.keys.tt));const o=new i(r.length+e.length-e.length%16);return o.set(r,0),P(n,e,o,r.length,0)}flush(){const t=this;let e=new i(0);if(t.Y.length){const n=t.Z.update(V.g(t.Y));t.$.update(n),e=V.k(n)}const n=K(V.k(t.$.digest()),0,10);return{data:H(e,n),signature:n}}}function P(t,e,n,r,o,s){const f=e.length-o;let c;for(t.Y.length&&(e=H(t.Y,e),n=((t,e)=>{if(e&&e>t.length){const n=t;(t=new i(e)).set(n,0)}return t})(n,f-f%16)),c=0;f-16>=c;c+=16){const i=V.g(K(e,c,c+16));s&&t.$.update(i);const o=t.Z.update(i);s||t.$.update(o),n.set(V.k(o),c+r)}return t.Y=K(e,c),n}async function R(t,n,r){const o=(t=>{if(void 0===l){const e=new i((t=unescape(encodeURIComponent(t))).length);for(let n=0;n<e.length;n++)e[n]=t.charCodeAt(n);return e}return(new l).encode(t)})(n),s=await((t,e,n,r,i)=>A&&C&&"function"==typeof u.subtle.importKey?u.subtle.importKey("raw",e,n,!1,i):k.importKey(e))(0,o,v,0,S),f=await(async(t,e,n)=>A&&C&&"function"==typeof u.subtle.deriveBits?await u.subtle.deriveBits(t,e,n):k.P(e,t.salt,m.iterations,n))(e.assign({salt:r},m),s,8*(2*_[t.X]+2)),c=new i(f);t.keys={key:V.g(K(c,0,_[t.X])),tt:V.g(K(c,_[t.X],2*_[t.X])),passwordVerification:K(c,2*_[t.X])}}function H(t,e){let n=t;return t.length+e.length&&(n=new i(t.length+e.length),n.set(t,0),n.set(e,t.length)),n}function K(t,e,n){return t.subarray(e,n)}class L{constructor(t,n){e.assign(this,{password:t,passwordVerification:n}),F(this,t)}append(t){const e=this;if(e.password){const n=j(e,t.subarray(0,12));if(e.password=null,n[11]!=e.passwordVerification)throw new r("Invalid pasword");t=t.subarray(12)}return j(e,t)}flush(){return{valid:!0,data:new i(0)}}}class T{constructor(t,n){e.assign(this,{password:t,passwordVerification:n}),F(this,t)}append(t){const e=this;let n,r;if(e.password){e.password=null;const o=u.getRandomValues(new i(12));o[11]=e.passwordVerification,n=new i(t.length+o.length),n.set(x(e,o),0),r=12}else n=new i(t.length),r=0;return n.set(x(e,t),r),n}flush(){return{data:new i(0)}}}function j(t,e){const n=new i(e.length);for(let r=0;r<e.length;r++)n[r]=W(t)^e[r],O(t,n[r]);return n}function x(t,e){const n=new i(e.length);for(let r=0;r<e.length;r++)n[r]=W(t)^e[r],O(t,e[r]);return n}function F(t,e){t.keys=[305419896,591751049,878082192],t.et=new h(t.keys[0]),t.nt=new h(t.keys[2]);for(let n=0;n<e.length;n++)O(t,e.charCodeAt(n))}function O(t,e){t.et.append([e]),t.keys[0]=~t.et.get(),t.keys[1]=G(t.keys[1]+q(t.keys[0])),t.keys[1]=G(n.imul(t.keys[1],134775813)+1),t.nt.append([t.keys[1]>>>24]),t.keys[2]=~t.nt.get()}function W(t){const e=2|t.keys[2];return q(n.imul(e,1^e)>>>8)}function q(t){return 255&t}function G(t){return 4294967295&t}class J{constructor(t,{signature:n,password:r,signed:i,compressed:o,zipCrypto:s,passwordVerification:f,encryptionStrength:c},{rt:l}){const u=!!r;e.assign(this,{signature:n,encrypted:u,signed:i,compressed:o,it:o&&new t({rt:l}),ot:i&&new h,zipCrypto:s,decrypt:u&&s?new L(r,f):new U(r,i,c)})}async append(t){const e=this;return e.encrypted&&t.length&&(t=await e.decrypt.append(t)),e.compressed&&t.length&&(t=await e.it.append(t)),(!e.encrypted||e.zipCrypto)&&e.signed&&t.length&&e.ot.append(t),t}async flush(){const t=this;let e,n=new i(0);if(t.encrypted){const e=t.decrypt.flush();if(!e.valid)throw new r("Invalid signature");n=e.data}if((!t.encrypted||t.zipCrypto)&&t.signed){const n=new c(new i(4).buffer);if(e=t.ot.get(),n.setUint32(0,e),t.signature!=n.getUint32(0,!1))throw new r("Invalid signature")}return t.compressed&&(n=await t.it.append(n)||new i(0),await t.it.flush()),{data:n,signature:e}}}class N{constructor(t,{encrypted:n,signed:r,compressed:i,level:o,zipCrypto:s,password:f,passwordVerification:c,encryptionStrength:l},{rt:u}){e.assign(this,{encrypted:n,signed:r,compressed:i,st:i&&new t({level:o||5,rt:u}),ot:r&&new h,zipCrypto:s,encrypt:n&&s?new T(f,c):new M(f,l)})}async append(t){const e=this;let n=t;return e.compressed&&t.length&&(n=await e.st.append(t)),e.encrypted&&n.length&&(n=await e.encrypt.append(n)),(!e.encrypted||e.zipCrypto)&&e.signed&&t.length&&e.ot.append(t),n}async flush(){const t=this;let e,n=new i(0);if(t.compressed&&(n=await t.st.flush()||new i(0)),t.encrypted){n=await t.encrypt.append(n);const r=t.encrypt.flush();e=r.signature;const o=new i(n.length+r.data.length);o.set(n,0),o.set(r.data,n.length),n=o}return t.encrypted&&!t.zipCrypto||!t.signed||(e=t.ot.get()),{data:n,signature:e}}}const Q={init(t){t.scripts&&t.scripts.length&&importScripts.apply(void 0,t.scripts);const e=t.options;let n;self.initCodec&&self.initCodec(),e.codecType.startsWith("deflate")?n=self.Deflate:e.codecType.startsWith("inflate")&&(n=self.Inflate),X=((t,e,n)=>e.codecType.startsWith("deflate")?new N(t,e,n):e.codecType.startsWith("inflate")?new J(t,e,n):void 0)(n,e,t.config)},append:async t=>({data:await X.append(t.data)}),flush:()=>X.flush()};let X;function Y(e){return Z(e.map((([e,n])=>new t(e).fill(n,0,e))))}function Z(e){return e.reduce(((e,n)=>e.concat(t.isArray(n)?Z(n):n)),[])}addEventListener("message",(async t=>{const e=t.data,n=e.type,r=Q[n];if(r)try{e.data&&(e.data=new i(e.data));const t=await r(e)||{};if(t.type=n,t.data)try{t.data=t.data.buffer,a(t,[t.data])}catch(e){a(t)}else a(t)}catch(t){a({type:n,error:{message:t.message,stack:t.stack}})}}));const $=[0,1,2,3].concat(...Y([[2,4],[2,5],[4,6],[4,7],[8,8],[8,9],[16,10],[16,11],[32,12],[32,13],[64,14],[64,15],[2,0],[1,16],[1,17],[2,18],[2,19],[4,20],[4,21],[8,22],[8,23],[16,24],[16,25],[32,26],[32,27],[64,28],[64,29]]));function tt(){const t=this;function e(t,e){let n=0;do{n|=1&t,t>>>=1,n<<=1}while(--e>0);return n>>>1}t.ft=r=>{const i=t.ct,o=t.ut.lt,s=t.ut.wt;let f,c,l,u=-1;for(r.ht=0,r.dt=573,f=0;s>f;f++)0!==i[2*f]?(r.yt[++r.ht]=u=f,r.bt[f]=0):i[2*f+1]=0;for(;2>r.ht;)l=r.yt[++r.ht]=2>u?++u:0,i[2*l]=1,r.bt[l]=0,r.kt--,o&&(r.gt-=o[2*l+1]);for(t.vt=u,f=n.floor(r.ht/2);f>=1;f--)r.St(i,f);l=s;do{f=r.yt[1],r.yt[1]=r.yt[r.ht--],r.St(i,1),c=r.yt[1],r.yt[--r.dt]=f,r.yt[--r.dt]=c,i[2*l]=i[2*f]+i[2*c],r.bt[l]=n.max(r.bt[f],r.bt[c])+1,i[2*f+1]=i[2*c+1]=l,r.yt[1]=l++,r.St(i,1)}while(r.ht>=2);r.yt[--r.dt]=r.yt[1],(e=>{const n=t.ct,r=t.ut.lt,i=t.ut.zt,o=t.ut._t,s=t.ut.It;let f,c,l,u,a,w,h=0;for(u=0;15>=u;u++)e.At[u]=0;for(n[2*e.yt[e.dt]+1]=0,f=e.dt+1;573>f;f++)c=e.yt[f],u=n[2*n[2*c+1]+1]+1,u>s&&(u=s,h++),n[2*c+1]=u,c>t.vt||(e.At[u]++,a=0,o>c||(a=i[c-o]),w=n[2*c],e.kt+=w*(u+a),r&&(e.gt+=w*(r[2*c+1]+a)));if(0!==h){do{for(u=s-1;0===e.At[u];)u--;e.At[u]--,e.At[u+1]+=2,e.At[s]--,h-=2}while(h>0);for(u=s;0!==u;u--)for(c=e.At[u];0!==c;)l=e.yt[--f],l>t.vt||(n[2*l+1]!=u&&(e.kt+=(u-n[2*l+1])*n[2*l],n[2*l+1]=u),c--)}})(r),((t,n,r)=>{const i=[];let o,s,f,c=0;for(o=1;15>=o;o++)i[o]=c=c+r[o-1]<<1;for(s=0;n>=s;s++)f=t[2*s+1],0!==f&&(t[2*s]=e(i[f]++,f))})(i,t.vt,r.At)}}function et(t,e,n,r,i){const o=this;o.lt=t,o.zt=e,o._t=n,o.wt=r,o.It=i}tt.Ct=[0,1,2,3,4,5,6,7].concat(...Y([[2,8],[2,9],[2,10],[2,11],[4,12],[4,13],[4,14],[4,15],[8,16],[8,17],[8,18],[8,19],[16,20],[16,21],[16,22],[16,23],[32,24],[32,25],[32,26],[31,27],[1,28]])),tt.Vt=[0,1,2,3,4,5,6,7,8,10,12,14,16,20,24,28,32,40,48,56,64,80,96,112,128,160,192,224,0],tt.Bt=[0,1,2,3,4,6,8,12,16,24,32,48,64,96,128,192,256,384,512,768,1024,1536,2048,3072,4096,6144,8192,12288,16384,24576],tt.Et=t=>256>t?$[t]:$[256+(t>>>7)],tt.Dt=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],tt.Ut=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],tt.Mt=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],tt.Pt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];const nt=Y([[144,8],[112,9],[24,7],[8,8]]);et.Rt=Z([12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254,1,129,65,193,33,161,97,225,17,145,81,209,49,177,113,241,9,137,73,201,41,169,105,233,25,153,89,217,57,185,121,249,5,133,69,197,37,165,101,229,21,149,85,213,53,181,117,245,13,141,77,205,45,173,109,237,29,157,93,221,61,189,125,253,19,275,147,403,83,339,211,467,51,307,179,435,115,371,243,499,11,267,139,395,75,331,203,459,43,299,171,427,107,363,235,491,27,283,155,411,91,347,219,475,59,315,187,443,123,379,251,507,7,263,135,391,71,327,199,455,39,295,167,423,103,359,231,487,23,279,151,407,87,343,215,471,55,311,183,439,119,375,247,503,15,271,143,399,79,335,207,463,47,303,175,431,111,367,239,495,31,287,159,415,95,351,223,479,63,319,191,447,127,383,255,511,0,64,32,96,16,80,48,112,8,72,40,104,24,88,56,120,4,68,36,100,20,84,52,116,3,131,67,195,35,163,99,227].map(((t,e)=>[t,nt[e]])));const rt=Y([[30,5]]);function it(t,e,n,r,i){const o=this;o.Ht=t,o.Kt=e,o.Lt=n,o.Tt=r,o.jt=i}et.xt=Z([0,16,8,24,4,20,12,28,2,18,10,26,6,22,14,30,1,17,9,25,5,21,13,29,3,19,11,27,7,23].map(((t,e)=>[t,rt[e]]))),et.Ft=new et(et.Rt,tt.Dt,257,286,15),et.Ot=new et(et.xt,tt.Ut,0,30,15),et.Wt=new et(null,tt.Mt,0,19,7);const ot=[new it(0,0,0,0,0),new it(4,4,8,4,1),new it(4,5,16,8,1),new it(4,6,32,32,1),new it(4,4,16,16,2),new it(8,16,32,32,2),new it(8,16,128,128,2),new it(8,32,128,256,2),new it(32,128,258,1024,2),new it(32,258,258,4096,2)],st=["need dictionary","stream end","","","stream error","data error","","buffer error","",""];function ft(t,e,n,r){const i=t[2*e],o=t[2*n];return o>i||i==o&&r[e]<=r[n]}function ct(){const t=this;let e,r,s,f,c,l,u,a,w,h,d,p,y,b,k,g,v,m,S,z,_,I,A,C,V,B,E,D,U,M,P,R,H;const K=new tt,L=new tt,T=new tt;let j,x,F,O,W,q;function G(){let e;for(e=0;286>e;e++)P[2*e]=0;for(e=0;30>e;e++)R[2*e]=0;for(e=0;19>e;e++)H[2*e]=0;P[512]=1,t.kt=t.gt=0,x=F=0}function J(t,e){let n,r=-1,i=t[1],o=0,s=7,f=4;0===i&&(s=138,f=3),t[2*(e+1)+1]=65535;for(let c=0;e>=c;c++)n=i,i=t[2*(c+1)+1],++o<s&&n==i||(f>o?H[2*n]+=o:0!==n?(n!=r&&H[2*n]++,H[32]++):o>10?H[36]++:H[34]++,o=0,r=n,0===i?(s=138,f=3):n==i?(s=6,f=3):(s=7,f=4))}function N(e){t.qt[t.pending++]=e}function Q(t){N(255&t),N(t>>>8&255)}function X(t,e){let n;const r=e;q>16-r?(n=t,W|=n<<q&65535,Q(W),W=n>>>16-q,q+=r-16):(W|=t<<q&65535,q+=r)}function Y(t,e){const n=2*t;X(65535&e[n],65535&e[n+1])}function Z(t,e){let n,r,i=-1,o=t[1],s=0,f=7,c=4;for(0===o&&(f=138,c=3),n=0;e>=n;n++)if(r=o,o=t[2*(n+1)+1],++s>=f||r!=o){if(c>s)do{Y(r,H)}while(0!=--s);else 0!==r?(r!=i&&(Y(r,H),s--),Y(16,H),X(s-3,2)):s>10?(Y(18,H),X(s-11,7)):(Y(17,H),X(s-3,3));s=0,i=r,0===o?(f=138,c=3):r==o?(f=6,c=3):(f=7,c=4)}}function $(){16==q?(Q(W),W=0,q=0):8>q||(N(255&W),W>>>=8,q-=8)}function nt(e,r){let i,o,s;if(t.Gt[x]=e,t.Jt[x]=255&r,x++,0===e?P[2*r]++:(F++,e--,P[2*(tt.Ct[r]+256+1)]++,R[2*tt.Et(e)]++),0==(8191&x)&&E>2){for(i=8*x,o=_-v,s=0;30>s;s++)i+=R[2*s]*(5+tt.Ut[s]);if(i>>>=3,F<n.floor(x/2)&&i<n.floor(o/2))return!0}return x==j-1}function rt(e,n){let r,i,o,s,f=0;if(0!==x)do{r=t.Gt[f],i=t.Jt[f],f++,0===r?Y(i,e):(o=tt.Ct[i],Y(o+256+1,e),s=tt.Dt[o],0!==s&&(i-=tt.Vt[o],X(i,s)),r--,o=tt.Et(r),Y(o,n),s=tt.Ut[o],0!==s&&(r-=tt.Bt[o],X(r,s)))}while(x>f);Y(256,e),O=e[513]}function it(){q>8?Q(W):q>0&&N(255&W),W=0,q=0}function ct(e,n,r){X(0+(r?1:0),3),((e,n)=>{it(),O=8,Q(n),Q(~n),t.qt.set(a.subarray(e,e+n),t.pending),t.pending+=n})(e,n)}function lt(n){((e,n,r)=>{let i,o,s=0;E>0?(K.ft(t),L.ft(t),s=(()=>{let e;for(J(P,K.vt),J(R,L.vt),T.ft(t),e=18;e>=3&&0===H[2*tt.Pt[e]+1];e--);return t.kt+=14+3*(e+1),e})(),i=t.kt+3+7>>>3,o=t.gt+3+7>>>3,o>i||(i=o)):i=o=n+5,n+4>i||-1==e?o==i?(X(2+(r?1:0),3),rt(et.Rt,et.xt)):(X(4+(r?1:0),3),((t,e,n)=>{let r;for(X(t-257,5),X(e-1,5),X(n-4,4),r=0;n>r;r++)X(H[2*tt.Pt[r]+1],3);Z(P,t-1),Z(R,e-1)})(K.vt+1,L.vt+1,s+1),rt(P,R)):ct(e,n,r),G(),r&&it()})(0>v?-1:v,_-v,n),v=_,e.Nt()}function ut(){let t,n,r,i;do{if(i=w-A-_,0===i&&0===_&&0===A)i=c;else if(-1==i)i--;else if(_>=c+c-262){a.set(a.subarray(c,c+c),0),I-=c,_-=c,v-=c,t=y,r=t;do{n=65535&d[--r],d[r]=c>n?0:n-c}while(0!=--t);t=c,r=t;do{n=65535&h[--r],h[r]=c>n?0:n-c}while(0!=--t);i+=c}if(0===e.Qt)return;t=e.Xt(a,_+A,i),A+=t,3>A||(p=255&a[_],p=(p<<g^255&a[_+1])&k)}while(262>A&&0!==e.Qt)}function at(t){let e,n,r=V,i=_,o=C;const s=_>c-262?_-(c-262):0;let f=M;const l=u,w=_+258;let d=a[i+o-1],p=a[i+o];U>C||(r>>=2),f>A&&(f=A);do{if(e=t,a[e+o]==p&&a[e+o-1]==d&&a[e]==a[i]&&a[++e]==a[i+1]){i+=2,e++;do{}while(a[++i]==a[++e]&&a[++i]==a[++e]&&a[++i]==a[++e]&&a[++i]==a[++e]&&a[++i]==a[++e]&&a[++i]==a[++e]&&a[++i]==a[++e]&&a[++i]==a[++e]&&w>i);if(n=258-(w-i),i=w-258,n>o){if(I=t,o=n,n>=f)break;d=a[i+o-1],p=a[i+o]}}}while((t=65535&h[t&l])>s&&0!=--r);return o>A?A:o}t.bt=[],t.At=[],t.yt=[],P=[],R=[],H=[],t.St=(e,n)=>{const r=t.yt,i=r[n];let o=n<<1;for(;o<=t.ht&&(o<t.ht&&ft(e,r[o+1],r[o],t.bt)&&o++,!ft(e,i,r[o],t.bt));)r[n]=r[o],n=o,o<<=1;r[n]=i},t.Yt=(e,S,I,x,F,J)=>(x||(x=8),F||(F=8),J||(J=0),e.Zt=null,-1==S&&(S=6),1>F||F>9||8!=x||9>I||I>15||0>S||S>9||0>J||J>2?-2:(e.$t=t,l=I,c=1<<l,u=c-1,b=F+7,y=1<<b,k=y-1,g=n.floor((b+3-1)/3),a=new i(2*c),h=[],d=[],j=1<<F+6,t.qt=new i(4*j),s=4*j,t.Gt=new o(j),t.Jt=new i(j),E=S,D=J,(e=>(e.te=e.ee=0,e.Zt=null,t.pending=0,t.ne=0,r=113,f=0,K.ct=P,K.ut=et.Ft,L.ct=R,L.ut=et.Ot,T.ct=H,T.ut=et.Wt,W=0,q=0,O=8,G(),(()=>{w=2*c,d[y-1]=0;for(let t=0;y-1>t;t++)d[t]=0;B=ot[E].Kt,U=ot[E].Ht,M=ot[E].Lt,V=ot[E].Tt,_=0,v=0,A=0,m=C=2,z=0,p=0})(),0))(e))),t.re=()=>42!=r&&113!=r&&666!=r?-2:(t.Jt=null,t.Gt=null,t.qt=null,d=null,h=null,a=null,t.$t=null,113==r?-3:0),t.ie=(t,e,n)=>{let r=0;return-1==e&&(e=6),0>e||e>9||0>n||n>2?-2:(ot[E].jt!=ot[e].jt&&0!==t.te&&(r=t.st(1)),E!=e&&(E=e,B=ot[E].Kt,U=ot[E].Ht,M=ot[E].Lt,V=ot[E].Tt),D=n,r)},t.oe=(t,e,n)=>{let i,o=n,s=0;if(!e||42!=r)return-2;if(3>o)return 0;for(o>c-262&&(o=c-262,s=n-o),a.set(e.subarray(s,s+o),0),_=o,v=o,p=255&a[0],p=(p<<g^255&a[1])&k,i=0;o-3>=i;i++)p=(p<<g^255&a[i+2])&k,h[i&u]=d[p],d[p]=i;return 0},t.st=(n,i)=>{let o,w,b,V,U;if(i>4||0>i)return-2;if(!n.se||!n.fe&&0!==n.Qt||666==r&&4!=i)return n.Zt=st[4],-2;if(0===n.ce)return n.Zt=st[7],-5;var M;if(e=n,V=f,f=i,42==r&&(w=8+(l-8<<4)<<8,b=(E-1&255)>>1,b>3&&(b=3),w|=b<<6,0!==_&&(w|=32),w+=31-w%31,r=113,N((M=w)>>8&255),N(255&M)),0!==t.pending){if(e.Nt(),0===e.ce)return f=-1,0}else if(0===e.Qt&&V>=i&&4!=i)return e.Zt=st[7],-5;if(666==r&&0!==e.Qt)return n.Zt=st[7],-5;if(0!==e.Qt||0!==A||0!=i&&666!=r){switch(U=-1,ot[E].jt){case 0:U=(t=>{let n,r=65535;for(r>s-5&&(r=s-5);;){if(1>=A){if(ut(),0===A&&0==t)return 0;if(0===A)break}if(_+=A,A=0,n=v+r,(0===_||_>=n)&&(A=_-n,_=n,lt(!1),0===e.ce))return 0;if(_-v>=c-262&&(lt(!1),0===e.ce))return 0}return lt(4==t),0===e.ce?4==t?2:0:4==t?3:1})(i);break;case 1:U=(t=>{let n,r=0;for(;;){if(262>A){if(ut(),262>A&&0==t)return 0;if(0===A)break}if(3>A||(p=(p<<g^255&a[_+2])&k,r=65535&d[p],h[_&u]=d[p],d[p]=_),0===r||(_-r&65535)>c-262||2!=D&&(m=at(r)),3>m)n=nt(0,255&a[_]),A--,_++;else if(n=nt(_-I,m-3),A-=m,m>B||3>A)_+=m,m=0,p=255&a[_],p=(p<<g^255&a[_+1])&k;else{m--;do{_++,p=(p<<g^255&a[_+2])&k,r=65535&d[p],h[_&u]=d[p],d[p]=_}while(0!=--m);_++}if(n&&(lt(!1),0===e.ce))return 0}return lt(4==t),0===e.ce?4==t?2:0:4==t?3:1})(i);break;case 2:U=(t=>{let n,r,i=0;for(;;){if(262>A){if(ut(),262>A&&0==t)return 0;if(0===A)break}if(3>A||(p=(p<<g^255&a[_+2])&k,i=65535&d[p],h[_&u]=d[p],d[p]=_),C=m,S=I,m=2,0!==i&&B>C&&c-262>=(_-i&65535)&&(2!=D&&(m=at(i)),5>=m&&(1==D||3==m&&_-I>4096)&&(m=2)),3>C||m>C)if(0!==z){if(n=nt(0,255&a[_-1]),n&&lt(!1),_++,A--,0===e.ce)return 0}else z=1,_++,A--;else{r=_+A-3,n=nt(_-1-S,C-3),A-=C-1,C-=2;do{++_>r||(p=(p<<g^255&a[_+2])&k,i=65535&d[p],h[_&u]=d[p],d[p]=_)}while(0!=--C);if(z=0,m=2,_++,n&&(lt(!1),0===e.ce))return 0}}return 0!==z&&(n=nt(0,255&a[_-1]),z=0),lt(4==t),0===e.ce?4==t?2:0:4==t?3:1})(i)}if(2!=U&&3!=U||(r=666),0==U||2==U)return 0===e.ce&&(f=-1),0;if(1==U){if(1==i)X(2,3),Y(256,et.Rt),$(),9>1+O+10-q&&(X(2,3),Y(256,et.Rt),$()),O=7;else if(ct(0,0,!1),3==i)for(o=0;y>o;o++)d[o]=0;if(e.Nt(),0===e.ce)return f=-1,0}}return 4!=i?0:1}}function lt(){const t=this;t.le=0,t.ue=0,t.Qt=0,t.te=0,t.ce=0,t.ee=0}function ut(t){const e=new lt,o=(s=t&&t.rt?t.rt:65536)+5*(n.floor(s/16383)+1);var s;const f=new i(o);let c=t?t.level:-1;void 0===c&&(c=-1),e.Yt(c),e.se=f,this.append=(t,n)=>{let s,c,l=0,u=0,a=0;const w=[];if(t.length){e.le=0,e.fe=t,e.Qt=t.length;do{if(e.ue=0,e.ce=o,s=e.st(0),0!=s)throw new r("deflating: "+e.Zt);e.ue&&(e.ue==o?w.push(new i(f)):w.push(f.slice(0,e.ue))),a+=e.ue,n&&e.le>0&&e.le!=l&&(n(e.le),l=e.le)}while(e.Qt>0||0===e.ce);return w.length>1?(c=new i(a),w.forEach((t=>{c.set(t,u),u+=t.length}))):c=w[0]||new i(0),c}},this.flush=()=>{let t,n,s=0,c=0;const l=[];do{if(e.ue=0,e.ce=o,t=e.st(4),1!=t&&0!=t)throw new r("deflating: "+e.Zt);o-e.ce>0&&l.push(f.slice(0,e.ue)),c+=e.ue}while(e.Qt>0||0===e.ce);return e.re(),n=new i(c),l.forEach((t=>{n.set(t,s),s+=t.length})),n}}lt.prototype={Yt:function(t,e){const n=this;return n.$t=new ct,e||(e=15),n.$t.Yt(n,t,e)},st:function(t){const e=this;return e.$t?e.$t.st(e,t):-2},re:function(){const t=this;if(!t.$t)return-2;const e=t.$t.re();return t.$t=null,e},ie:function(t,e){const n=this;return n.$t?n.$t.ie(n,t,e):-2},oe:function(t,e){const n=this;return n.$t?n.$t.oe(n,t,e):-2},Xt:function(t,e,n){const r=this;let i=r.Qt;return i>n&&(i=n),0===i?0:(r.Qt-=i,t.set(r.fe.subarray(r.le,r.le+i),e),r.le+=i,r.te+=i,i)},Nt:function(){const t=this;let e=t.$t.pending;e>t.ce&&(e=t.ce),0!==e&&(t.se.set(t.$t.qt.subarray(t.$t.ne,t.$t.ne+e),t.ue),t.ue+=e,t.$t.ne+=e,t.ee+=e,t.ce-=e,t.$t.pending-=e,0===t.$t.pending&&(t.$t.ne=0))}};const at=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],wt=[96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,192,80,7,10,0,8,96,0,8,32,0,9,160,0,8,0,0,8,128,0,8,64,0,9,224,80,7,6,0,8,88,0,8,24,0,9,144,83,7,59,0,8,120,0,8,56,0,9,208,81,7,17,0,8,104,0,8,40,0,9,176,0,8,8,0,8,136,0,8,72,0,9,240,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,200,81,7,13,0,8,100,0,8,36,0,9,168,0,8,4,0,8,132,0,8,68,0,9,232,80,7,8,0,8,92,0,8,28,0,9,152,84,7,83,0,8,124,0,8,60,0,9,216,82,7,23,0,8,108,0,8,44,0,9,184,0,8,12,0,8,140,0,8,76,0,9,248,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,196,81,7,11,0,8,98,0,8,34,0,9,164,0,8,2,0,8,130,0,8,66,0,9,228,80,7,7,0,8,90,0,8,26,0,9,148,84,7,67,0,8,122,0,8,58,0,9,212,82,7,19,0,8,106,0,8,42,0,9,180,0,8,10,0,8,138,0,8,74,0,9,244,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,204,81,7,15,0,8,102,0,8,38,0,9,172,0,8,6,0,8,134,0,8,70,0,9,236,80,7,9,0,8,94,0,8,30,0,9,156,84,7,99,0,8,126,0,8,62,0,9,220,82,7,27,0,8,110,0,8,46,0,9,188,0,8,14,0,8,142,0,8,78,0,9,252,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,194,80,7,10,0,8,97,0,8,33,0,9,162,0,8,1,0,8,129,0,8,65,0,9,226,80,7,6,0,8,89,0,8,25,0,9,146,83,7,59,0,8,121,0,8,57,0,9,210,81,7,17,0,8,105,0,8,41,0,9,178,0,8,9,0,8,137,0,8,73,0,9,242,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,202,81,7,13,0,8,101,0,8,37,0,9,170,0,8,5,0,8,133,0,8,69,0,9,234,80,7,8,0,8,93,0,8,29,0,9,154,84,7,83,0,8,125,0,8,61,0,9,218,82,7,23,0,8,109,0,8,45,0,9,186,0,8,13,0,8,141,0,8,77,0,9,250,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,198,81,7,11,0,8,99,0,8,35,0,9,166,0,8,3,0,8,131,0,8,67,0,9,230,80,7,7,0,8,91,0,8,27,0,9,150,84,7,67,0,8,123,0,8,59,0,9,214,82,7,19,0,8,107,0,8,43,0,9,182,0,8,11,0,8,139,0,8,75,0,9,246,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,206,81,7,15,0,8,103,0,8,39,0,9,174,0,8,7,0,8,135,0,8,71,0,9,238,80,7,9,0,8,95,0,8,31,0,9,158,84,7,99,0,8,127,0,8,63,0,9,222,82,7,27,0,8,111,0,8,47,0,9,190,0,8,15,0,8,143,0,8,79,0,9,254,96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,193,80,7,10,0,8,96,0,8,32,0,9,161,0,8,0,0,8,128,0,8,64,0,9,225,80,7,6,0,8,88,0,8,24,0,9,145,83,7,59,0,8,120,0,8,56,0,9,209,81,7,17,0,8,104,0,8,40,0,9,177,0,8,8,0,8,136,0,8,72,0,9,241,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,201,81,7,13,0,8,100,0,8,36,0,9,169,0,8,4,0,8,132,0,8,68,0,9,233,80,7,8,0,8,92,0,8,28,0,9,153,84,7,83,0,8,124,0,8,60,0,9,217,82,7,23,0,8,108,0,8,44,0,9,185,0,8,12,0,8,140,0,8,76,0,9,249,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,197,81,7,11,0,8,98,0,8,34,0,9,165,0,8,2,0,8,130,0,8,66,0,9,229,80,7,7,0,8,90,0,8,26,0,9,149,84,7,67,0,8,122,0,8,58,0,9,213,82,7,19,0,8,106,0,8,42,0,9,181,0,8,10,0,8,138,0,8,74,0,9,245,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,205,81,7,15,0,8,102,0,8,38,0,9,173,0,8,6,0,8,134,0,8,70,0,9,237,80,7,9,0,8,94,0,8,30,0,9,157,84,7,99,0,8,126,0,8,62,0,9,221,82,7,27,0,8,110,0,8,46,0,9,189,0,8,14,0,8,142,0,8,78,0,9,253,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,195,80,7,10,0,8,97,0,8,33,0,9,163,0,8,1,0,8,129,0,8,65,0,9,227,80,7,6,0,8,89,0,8,25,0,9,147,83,7,59,0,8,121,0,8,57,0,9,211,81,7,17,0,8,105,0,8,41,0,9,179,0,8,9,0,8,137,0,8,73,0,9,243,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,203,81,7,13,0,8,101,0,8,37,0,9,171,0,8,5,0,8,133,0,8,69,0,9,235,80,7,8,0,8,93,0,8,29,0,9,155,84,7,83,0,8,125,0,8,61,0,9,219,82,7,23,0,8,109,0,8,45,0,9,187,0,8,13,0,8,141,0,8,77,0,9,251,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,199,81,7,11,0,8,99,0,8,35,0,9,167,0,8,3,0,8,131,0,8,67,0,9,231,80,7,7,0,8,91,0,8,27,0,9,151,84,7,67,0,8,123,0,8,59,0,9,215,82,7,19,0,8,107,0,8,43,0,9,183,0,8,11,0,8,139,0,8,75,0,9,247,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,207,81,7,15,0,8,103,0,8,39,0,9,175,0,8,7,0,8,135,0,8,71,0,9,239,80,7,9,0,8,95,0,8,31,0,9,159,84,7,99,0,8,127,0,8,63,0,9,223,82,7,27,0,8,111,0,8,47,0,9,191,0,8,15,0,8,143,0,8,79,0,9,255],ht=[80,5,1,87,5,257,83,5,17,91,5,4097,81,5,5,89,5,1025,85,5,65,93,5,16385,80,5,3,88,5,513,84,5,33,92,5,8193,82,5,9,90,5,2049,86,5,129,192,5,24577,80,5,2,87,5,385,83,5,25,91,5,6145,81,5,7,89,5,1537,85,5,97,93,5,24577,80,5,4,88,5,769,84,5,49,92,5,12289,82,5,13,90,5,3073,86,5,193,192,5,24577],dt=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],pt=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,112,112],yt=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],bt=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];function kt(){let t,e,n,r,i,o;function s(t,e,s,f,c,l,u,a,w,h,d){let p,y,b,k,g,v,m,S,z,_,I,A,C,V,B;_=0,g=s;do{n[t[e+_]]++,_++,g--}while(0!==g);if(n[0]==s)return u[0]=-1,a[0]=0,0;for(S=a[0],v=1;15>=v&&0===n[v];v++);for(m=v,v>S&&(S=v),g=15;0!==g&&0===n[g];g--);for(b=g,S>g&&(S=g),a[0]=S,V=1<<v;g>v;v++,V<<=1)if(0>(V-=n[v]))return-3;if(0>(V-=n[g]))return-3;for(n[g]+=V,o[1]=v=0,_=1,C=2;0!=--g;)o[C]=v+=n[_],C++,_++;g=0,_=0;do{0!==(v=t[e+_])&&(d[o[v]++]=g),_++}while(++g<s);for(s=o[b],o[0]=g=0,_=0,k=-1,A=-S,i[0]=0,I=0,B=0;b>=m;m++)for(p=n[m];0!=p--;){for(;m>A+S;){if(k++,A+=S,B=b-A,B=B>S?S:B,(y=1<<(v=m-A))>p+1&&(y-=p+1,C=m,B>v))for(;++v<B&&(y<<=1)>n[++C];)y-=n[C];if(B=1<<v,h[0]+B>1440)return-3;i[k]=I=h[0],h[0]+=B,0!==k?(o[k]=g,r[0]=v,r[1]=S,v=g>>>A-S,r[2]=I-i[k-1]-v,w.set(r,3*(i[k-1]+v))):u[0]=I}for(r[1]=m-A,s>_?d[_]<f?(r[0]=256>d[_]?0:96,r[2]=d[_++]):(r[0]=l[d[_]-f]+16+64,r[2]=c[d[_++]-f]):r[0]=192,y=1<<m-A,v=g>>>A;B>v;v+=y)w.set(r,3*(I+v));for(v=1<<m-1;0!=(g&v);v>>>=1)g^=v;for(g^=v,z=(1<<A)-1;(g&z)!=o[k];)k--,A-=S,z=(1<<A)-1}return 0!==V&&1!=b?-5:0}function c(s){let c;for(t||(t=[],e=[],n=new f(16),r=[],i=new f(15),o=new f(16)),e.length<s&&(e=[]),c=0;s>c;c++)e[c]=0;for(c=0;16>c;c++)n[c]=0;for(c=0;3>c;c++)r[c]=0;i.set(n.subarray(0,15),0),o.set(n.subarray(0,16),0)}this.ae=(n,r,i,o,f)=>{let l;return c(19),t[0]=0,l=s(n,0,19,19,null,null,i,r,o,t,e),-3==l?f.Zt="oversubscribed dynamic bit lengths tree":-5!=l&&0!==r[0]||(f.Zt="incomplete dynamic bit lengths tree",l=-3),l},this.we=(n,r,i,o,f,l,u,a,w)=>{let h;return c(288),t[0]=0,h=s(i,0,n,257,dt,pt,l,o,a,t,e),0!=h||0===o[0]?(-3==h?w.Zt="oversubscribed literal/length tree":-4!=h&&(w.Zt="incomplete literal/length tree",h=-3),h):(c(288),h=s(i,n,r,0,yt,bt,u,f,a,t,e),0!=h||0===f[0]&&n>257?(-3==h?w.Zt="oversubscribed distance tree":-5==h?(w.Zt="incomplete distance tree",h=-3):-4!=h&&(w.Zt="empty distance tree with lengths",h=-3),h):0)}}function gt(){const t=this;let e,n,r,i,o=0,s=0,f=0,c=0,l=0,u=0,a=0,w=0,h=0,d=0;function p(t,e,n,r,i,o,s,f){let c,l,u,a,w,h,d,p,y,b,k,g,v,m,S,z;d=f.le,p=f.Qt,w=s.he,h=s.de,y=s.write,b=y<s.read?s.read-y-1:s.end-y,k=at[t],g=at[e];do{for(;20>h;)p--,w|=(255&f.pe(d++))<<h,h+=8;if(c=w&k,l=n,u=r,z=3*(u+c),0!==(a=l[z]))for(;;){if(w>>=l[z+1],h-=l[z+1],0!=(16&a)){for(a&=15,v=l[z+2]+(w&at[a]),w>>=a,h-=a;15>h;)p--,w|=(255&f.pe(d++))<<h,h+=8;for(c=w&g,l=i,u=o,z=3*(u+c),a=l[z];;){if(w>>=l[z+1],h-=l[z+1],0!=(16&a)){for(a&=15;a>h;)p--,w|=(255&f.pe(d++))<<h,h+=8;if(m=l[z+2]+(w&at[a]),w>>=a,h-=a,b-=v,m>y){S=y-m;do{S+=s.end}while(0>S);if(a=s.end-S,v>a){if(v-=a,y-S>0&&a>y-S)do{s.ye[y++]=s.ye[S++]}while(0!=--a);else s.ye.set(s.ye.subarray(S,S+a),y),y+=a,S+=a,a=0;S=0}}else S=y-m,y-S>0&&2>y-S?(s.ye[y++]=s.ye[S++],s.ye[y++]=s.ye[S++],v-=2):(s.ye.set(s.ye.subarray(S,S+2),y),y+=2,S+=2,v-=2);if(y-S>0&&v>y-S)do{s.ye[y++]=s.ye[S++]}while(0!=--v);else s.ye.set(s.ye.subarray(S,S+v),y),y+=v,S+=v,v=0;break}if(0!=(64&a))return f.Zt="invalid distance code",v=f.Qt-p,v=v>h>>3?h>>3:v,p+=v,d-=v,h-=v<<3,s.he=w,s.de=h,f.Qt=p,f.te+=d-f.le,f.le=d,s.write=y,-3;c+=l[z+2],c+=w&at[a],z=3*(u+c),a=l[z]}break}if(0!=(64&a))return 0!=(32&a)?(v=f.Qt-p,v=v>h>>3?h>>3:v,p+=v,d-=v,h-=v<<3,s.he=w,s.de=h,f.Qt=p,f.te+=d-f.le,f.le=d,s.write=y,1):(f.Zt="invalid literal/length code",v=f.Qt-p,v=v>h>>3?h>>3:v,p+=v,d-=v,h-=v<<3,s.he=w,s.de=h,f.Qt=p,f.te+=d-f.le,f.le=d,s.write=y,-3);if(c+=l[z+2],c+=w&at[a],z=3*(u+c),0===(a=l[z])){w>>=l[z+1],h-=l[z+1],s.ye[y++]=l[z+2],b--;break}}else w>>=l[z+1],h-=l[z+1],s.ye[y++]=l[z+2],b--}while(b>=258&&p>=10);return v=f.Qt-p,v=v>h>>3?h>>3:v,p+=v,d-=v,h-=v<<3,s.he=w,s.de=h,f.Qt=p,f.te+=d-f.le,f.le=d,s.write=y,0}t.init=(t,o,s,f,c,l)=>{e=0,a=t,w=o,r=s,h=f,i=c,d=l,n=null},t.be=(t,y,b)=>{let k,g,v,m,S,z,_,I=0,A=0,C=0;for(C=y.le,m=y.Qt,I=t.he,A=t.de,S=t.write,z=S<t.read?t.read-S-1:t.end-S;;)switch(e){case 0:if(z>=258&&m>=10&&(t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,b=p(a,w,r,h,i,d,t,y),C=y.le,m=y.Qt,I=t.he,A=t.de,S=t.write,z=S<t.read?t.read-S-1:t.end-S,0!=b)){e=1==b?7:9;break}f=a,n=r,s=h,e=1;case 1:for(k=f;k>A;){if(0===m)return t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);b=0,m--,I|=(255&y.pe(C++))<<A,A+=8}if(g=3*(s+(I&at[k])),I>>>=n[g+1],A-=n[g+1],v=n[g],0===v){c=n[g+2],e=6;break}if(0!=(16&v)){l=15&v,o=n[g+2],e=2;break}if(0==(64&v)){f=v,s=g/3+n[g+2];break}if(0!=(32&v)){e=7;break}return e=9,y.Zt="invalid literal/length code",b=-3,t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);case 2:for(k=l;k>A;){if(0===m)return t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);b=0,m--,I|=(255&y.pe(C++))<<A,A+=8}o+=I&at[k],I>>=k,A-=k,f=w,n=i,s=d,e=3;case 3:for(k=f;k>A;){if(0===m)return t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);b=0,m--,I|=(255&y.pe(C++))<<A,A+=8}if(g=3*(s+(I&at[k])),I>>=n[g+1],A-=n[g+1],v=n[g],0!=(16&v)){l=15&v,u=n[g+2],e=4;break}if(0==(64&v)){f=v,s=g/3+n[g+2];break}return e=9,y.Zt="invalid distance code",b=-3,t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);case 4:for(k=l;k>A;){if(0===m)return t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);b=0,m--,I|=(255&y.pe(C++))<<A,A+=8}u+=I&at[k],I>>=k,A-=k,e=5;case 5:for(_=S-u;0>_;)_+=t.end;for(;0!==o;){if(0===z&&(S==t.end&&0!==t.read&&(S=0,z=S<t.read?t.read-S-1:t.end-S),0===z&&(t.write=S,b=t.ke(y,b),S=t.write,z=S<t.read?t.read-S-1:t.end-S,S==t.end&&0!==t.read&&(S=0,z=S<t.read?t.read-S-1:t.end-S),0===z)))return t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);t.ye[S++]=t.ye[_++],z--,_==t.end&&(_=0),o--}e=0;break;case 6:if(0===z&&(S==t.end&&0!==t.read&&(S=0,z=S<t.read?t.read-S-1:t.end-S),0===z&&(t.write=S,b=t.ke(y,b),S=t.write,z=S<t.read?t.read-S-1:t.end-S,S==t.end&&0!==t.read&&(S=0,z=S<t.read?t.read-S-1:t.end-S),0===z)))return t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);b=0,t.ye[S++]=c,z--,e=0;break;case 7:if(A>7&&(A-=8,m++,C--),t.write=S,b=t.ke(y,b),S=t.write,z=S<t.read?t.read-S-1:t.end-S,t.read!=t.write)return t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);e=8;case 8:return b=1,t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);case 9:return b=-3,t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);default:return b=-2,t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b)}},t.ge=()=>{}}kt.ve=(t,e,n,r)=>(t[0]=9,e[0]=5,n[0]=wt,r[0]=ht,0);const vt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];function mt(t,e){const n=this;let r,o=0,s=0,c=0,l=0;const u=[0],a=[0],w=new gt;let h=0,d=new f(4320);const p=new kt;n.de=0,n.he=0,n.ye=new i(e),n.end=e,n.read=0,n.write=0,n.reset=(t,e)=>{e&&(e[0]=0),6==o&&w.ge(t),o=0,n.de=0,n.he=0,n.read=n.write=0},n.reset(t,null),n.ke=(t,e)=>{let r,i,o;return i=t.ue,o=n.read,r=(o>n.write?n.end:n.write)-o,r>t.ce&&(r=t.ce),0!==r&&-5==e&&(e=0),t.ce-=r,t.ee+=r,t.se.set(n.ye.subarray(o,o+r),i),i+=r,o+=r,o==n.end&&(o=0,n.write==n.end&&(n.write=0),r=n.write-o,r>t.ce&&(r=t.ce),0!==r&&-5==e&&(e=0),t.ce-=r,t.ee+=r,t.se.set(n.ye.subarray(o,o+r),i),i+=r,o+=r),t.ue=i,n.read=o,e},n.be=(t,e)=>{let i,f,y,b,k,g,v,m;for(b=t.le,k=t.Qt,f=n.he,y=n.de,g=n.write,v=g<n.read?n.read-g-1:n.end-g;;){let S,z,_,I,A,C,V,B;switch(o){case 0:for(;3>y;){if(0===k)return n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);e=0,k--,f|=(255&t.pe(b++))<<y,y+=8}switch(i=7&f,h=1&i,i>>>1){case 0:f>>>=3,y-=3,i=7&y,f>>>=i,y-=i,o=1;break;case 1:S=[],z=[],_=[[]],I=[[]],kt.ve(S,z,_,I),w.init(S[0],z[0],_[0],0,I[0],0),f>>>=3,y-=3,o=6;break;case 2:f>>>=3,y-=3,o=3;break;case 3:return f>>>=3,y-=3,o=9,t.Zt="invalid block type",e=-3,n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e)}break;case 1:for(;32>y;){if(0===k)return n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);e=0,k--,f|=(255&t.pe(b++))<<y,y+=8}if((~f>>>16&65535)!=(65535&f))return o=9,t.Zt="invalid stored block lengths",e=-3,n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);s=65535&f,f=y=0,o=0!==s?2:0!==h?7:0;break;case 2:if(0===k)return n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);if(0===v&&(g==n.end&&0!==n.read&&(g=0,v=g<n.read?n.read-g-1:n.end-g),0===v&&(n.write=g,e=n.ke(t,e),g=n.write,v=g<n.read?n.read-g-1:n.end-g,g==n.end&&0!==n.read&&(g=0,v=g<n.read?n.read-g-1:n.end-g),0===v)))return n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);if(e=0,i=s,i>k&&(i=k),i>v&&(i=v),n.ye.set(t.Xt(b,i),g),b+=i,k-=i,g+=i,v-=i,0!=(s-=i))break;o=0!==h?7:0;break;case 3:for(;14>y;){if(0===k)return n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);e=0,k--,f|=(255&t.pe(b++))<<y,y+=8}if(c=i=16383&f,(31&i)>29||(i>>5&31)>29)return o=9,t.Zt="too many length or distance symbols",e=-3,n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);if(i=258+(31&i)+(i>>5&31),!r||r.length<i)r=[];else for(m=0;i>m;m++)r[m]=0;f>>>=14,y-=14,l=0,o=4;case 4:for(;4+(c>>>10)>l;){for(;3>y;){if(0===k)return n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);e=0,k--,f|=(255&t.pe(b++))<<y,y+=8}r[vt[l++]]=7&f,f>>>=3,y-=3}for(;19>l;)r[vt[l++]]=0;if(u[0]=7,i=p.ae(r,u,a,d,t),0!=i)return-3==(e=i)&&(r=null,o=9),n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);l=0,o=5;case 5:for(;i=c,258+(31&i)+(i>>5&31)>l;){let s,w;for(i=u[0];i>y;){if(0===k)return n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);e=0,k--,f|=(255&t.pe(b++))<<y,y+=8}if(i=d[3*(a[0]+(f&at[i]))+1],w=d[3*(a[0]+(f&at[i]))+2],16>w)f>>>=i,y-=i,r[l++]=w;else{for(m=18==w?7:w-14,s=18==w?11:3;i+m>y;){if(0===k)return n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);e=0,k--,f|=(255&t.pe(b++))<<y,y+=8}if(f>>>=i,y-=i,s+=f&at[m],f>>>=m,y-=m,m=l,i=c,m+s>258+(31&i)+(i>>5&31)||16==w&&1>m)return r=null,o=9,t.Zt="invalid bit length repeat",e=-3,n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);w=16==w?r[m-1]:0;do{r[m++]=w}while(0!=--s);l=m}}if(a[0]=-1,A=[],C=[],V=[],B=[],A[0]=9,C[0]=6,i=c,i=p.we(257+(31&i),1+(i>>5&31),r,A,C,V,B,d,t),0!=i)return-3==i&&(r=null,o=9),e=i,n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);w.init(A[0],C[0],d,V[0],d,B[0]),o=6;case 6:if(n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,1!=(e=w.be(n,t,e)))return n.ke(t,e);if(e=0,w.ge(t),b=t.le,k=t.Qt,f=n.he,y=n.de,g=n.write,v=g<n.read?n.read-g-1:n.end-g,0===h){o=0;break}o=7;case 7:if(n.write=g,e=n.ke(t,e),g=n.write,v=g<n.read?n.read-g-1:n.end-g,n.read!=n.write)return n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);o=8;case 8:return e=1,n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);case 9:return e=-3,n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);default:return e=-2,n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e)}}},n.ge=t=>{n.reset(t,null),n.ye=null,d=null},n.me=(t,e,r)=>{n.ye.set(t.subarray(e,e+r),0),n.read=n.write=r},n.Se=()=>1==o?1:0}const St=[0,0,255,255];function zt(){const t=this;function e(t){return t&&t.ze?(t.te=t.ee=0,t.Zt=null,t.ze.mode=7,t.ze._e.reset(t,null),0):-2}t.mode=0,t.method=0,t.Ie=[0],t.Ae=0,t.marker=0,t.Ce=0,t.Ve=e=>(t._e&&t._e.ge(e),t._e=null,0),t.Be=(n,r)=>(n.Zt=null,t._e=null,8>r||r>15?(t.Ve(n),-2):(t.Ce=r,n.ze._e=new mt(n,1<<r),e(n),0)),t.it=(t,e)=>{let n,r;if(!t||!t.ze||!t.fe)return-2;const i=t.ze;for(e=4==e?-5:0,n=-5;;)switch(i.mode){case 0:if(0===t.Qt)return n;if(n=e,t.Qt--,t.te++,8!=(15&(i.method=t.pe(t.le++)))){i.mode=13,t.Zt="unknown compression method",i.marker=5;break}if(8+(i.method>>4)>i.Ce){i.mode=13,t.Zt="invalid win size",i.marker=5;break}i.mode=1;case 1:if(0===t.Qt)return n;if(n=e,t.Qt--,t.te++,r=255&t.pe(t.le++),((i.method<<8)+r)%31!=0){i.mode=13,t.Zt="incorrect header check",i.marker=5;break}if(0==(32&r)){i.mode=7;break}i.mode=2;case 2:if(0===t.Qt)return n;n=e,t.Qt--,t.te++,i.Ae=(255&t.pe(t.le++))<<24&4278190080,i.mode=3;case 3:if(0===t.Qt)return n;n=e,t.Qt--,t.te++,i.Ae+=(255&t.pe(t.le++))<<16&16711680,i.mode=4;case 4:if(0===t.Qt)return n;n=e,t.Qt--,t.te++,i.Ae+=(255&t.pe(t.le++))<<8&65280,i.mode=5;case 5:return 0===t.Qt?n:(n=e,t.Qt--,t.te++,i.Ae+=255&t.pe(t.le++),i.mode=6,2);case 6:return i.mode=13,t.Zt="need dictionary",i.marker=0,-2;case 7:if(n=i._e.be(t,n),-3==n){i.mode=13,i.marker=0;break}if(0==n&&(n=e),1!=n)return n;n=e,i._e.reset(t,i.Ie),i.mode=12;case 12:return t.Qt=0,1;case 13:return-3;default:return-2}},t.Ee=(t,e,n)=>{let r=0,i=n;if(!t||!t.ze||6!=t.ze.mode)return-2;const o=t.ze;return i<1<<o.Ce||(i=(1<<o.Ce)-1,r=n-i),o._e.me(e,r,i),o.mode=7,0},t.De=t=>{let n,r,i,o,s;if(!t||!t.ze)return-2;const f=t.ze;if(13!=f.mode&&(f.mode=13,f.marker=0),0===(n=t.Qt))return-5;for(r=t.le,i=f.marker;0!==n&&4>i;)t.pe(r)==St[i]?i++:i=0!==t.pe(r)?0:4-i,r++,n--;return t.te+=r-t.le,t.le=r,t.Qt=n,f.marker=i,4!=i?-3:(o=t.te,s=t.ee,e(t),t.te=o,t.ee=s,f.mode=7,0)},t.Ue=t=>t&&t.ze&&t.ze._e?t.ze._e.Se():-2}function _t(){}function It(t){const e=new _t,o=t&&t.rt?n.floor(2*t.rt):131072,s=new i(o);let f=!1;e.Be(),e.se=s,this.append=(t,n)=>{const c=[];let l,u,a=0,w=0,h=0;if(0!==t.length){e.le=0,e.fe=t,e.Qt=t.length;do{if(e.ue=0,e.ce=o,0!==e.Qt||f||(e.le=0,f=!0),l=e.it(0),f&&-5===l){if(0!==e.Qt)throw new r("inflating: bad input")}else if(0!==l&&1!==l)throw new r("inflating: "+e.Zt);if((f||1===l)&&e.Qt===t.length)throw new r("inflating: bad input");e.ue&&(e.ue===o?c.push(new i(s)):c.push(s.slice(0,e.ue))),h+=e.ue,n&&e.le>0&&e.le!=a&&(n(e.le),a=e.le)}while(e.Qt>0||0===e.ce);return c.length>1?(u=new i(h),c.forEach((t=>{u.set(t,w),w+=t.length}))):u=c[0]||new i(0),u}},this.flush=()=>{e.Ve()}}_t.prototype={Be:function(t){const e=this;return e.ze=new zt,t||(t=15),e.ze.Be(e,t)},it:function(t){const e=this;return e.ze?e.ze.it(e,t):-2},Ve:function(){const t=this;if(!t.ze)return-2;const e=t.ze.Ve(t);return t.ze=null,e},De:function(){const t=this;return t.ze?t.ze.De(t):-2},Ee:function(t,e){const n=this;return n.ze?n.ze.Ee(n,t,e):-2},pe:function(t){return this.fe[t]},Xt:function(t,e){return this.fe.subarray(t,t+e)}},self.initCodec=()=>{self.Deflate=ut,self.Inflate=It};
`],{type:"text/javascript"}));r({workerScripts:{inflate:[e],deflate:[e]}})}};var th=class{constructor(){this.size=0}init(){this.initialized=!0}},kd=class extends th{},rh=class extends th{writeUint8Array(e){this.size+=e.length}};var rl=class extends kd{constructor(e){super(),this.array=e,this.size=e.length}readUint8Array(e,t){return this.array.slice(e,e+t)}},is=class extends rh{constructor(){super(),this.array=new Uint8Array(0)}writeUint8Array(e){super.writeUint8Array(e);let t=this.array;this.array=new Uint8Array(t.length+e.length),this.array.set(t),this.array.set(e,t.length)}getData(){return this.array}};var Ig="/",VD=new Date(2107,11,31),kD=new Date(1980,0,1);var HD="\0\u263A\u263B\u2665\u2666\u2663\u2660\u2022\u25D8\u25CB\u25D9\u2642\u2640\u266A\u266B\u263C\u25BA\u25C4\u2195\u203C\xB6\xA7\u25AC\u21A8\u2191\u2193\u2192\u2190\u221F\u2194\u25B2\u25BC !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~\u2302\xC7\xFC\xE9\xE2\xE4\xE0\xE5\xE7\xEA\xEB\xE8\xEF\xEE\xEC\xC4\xC5\xC9\xE6\xC6\xF4\xF6\xF2\xFB\xF9\xFF\xD6\xDC\xA2\xA3\xA5\u20A7\u0192\xE1\xED\xF3\xFA\xF1\xD1\xAA\xBA\xBF\u2310\xAC\xBD\xBC\xA1\xAB\xBB\u2591\u2592\u2593\u2502\u2524\u2561\u2562\u2556\u2555\u2563\u2551\u2557\u255D\u255C\u255B\u2510\u2514\u2534\u252C\u251C\u2500\u253C\u255E\u255F\u255A\u2554\u2569\u2566\u2560\u2550\u256C\u2567\u2568\u2564\u2565\u2559\u2558\u2552\u2553\u256B\u256A\u2518\u250C\u2588\u2584\u258C\u2590\u2580\u03B1\xDF\u0393\u03C0\u03A3\u03C3\xB5\u03C4\u03A6\u0398\u03A9\u03B4\u221E\u03C6\u03B5\u2229\u2261\xB1\u2265\u2264\u2320\u2321\xF7\u2248\xB0\u2219\xB7\u221A\u207F\xB2\u25A0 ".split(""),EC=r=>{let e="";for(let t=0;t<r.length;t++)e+=HD[r[t]];return e};var nh=zD;function zD(r,e){if(e&&e.trim().toLowerCase()=="cp437")return EC(r);if(typeof TextDecoder>"u"){let t=new FileReader;return new Promise((n,o)=>{t.onload=i=>n(i.target.result),t.onerror=()=>o(t.error),t.readAsText(new Blob([r]))})}else return new TextDecoder(e).decode(r)}var Rg="Abort error";async function vg(r,e,t,n,o,i,a){let s=Math.max(i.chunkSize,64);return l();async function l(d=0,c=0){let p=a.signal,u=o();if(d<u){yg(p,r);let _=await e.readUint8Array(d+n,Math.min(s,u-d)),h=_.length;yg(p,r);let S=await r.append(_);if(yg(p,r),c+=await IC(t,S),a.onprogress)try{a.onprogress(d+h,u)}catch{}return l(d+s,c)}else{let _=await r.flush();return c+=await IC(t,_.data),{signature:_.signature,length:c}}}}function yg(r,e){if(r&&r.aborted)throw e.abort(),new Error(Rg)}async function IC(r,e){return e.length&&await r.writeUint8Array(e),e.length}var WD=["filename","rawFilename","directory","encrypted","compressedSize","uncompressedSize","lastModDate","rawLastModDate","comment","rawComment","signature","extraField","rawExtraField","bitFlag","extraFieldZip64","extraFieldUnicodePath","extraFieldUnicodeComment","extraFieldAES","filenameUTF8","commentUTF8","offset","zip64","compressionMethod","extraFieldNTFS","lastAccessDate","creationDate","extraFieldExtendedTimestamp","version","versionMadeBy","msDosCompatible","internalFileAttribute","externalFileAttribute"],nl=class{constructor(e){WD.forEach(t=>this[t]=e[t])}};var oh="File format is not recognized",GC="End of central directory not found",UC="End of Zip64 central directory not found",VC="End of Zip64 central directory locator not found",kC="Central directory header not found",HC="Local file header not found",zC="Zip64 extra field not found",WC="File contains encrypted entry",KC="Encryption method not supported",Mg="Compression method not supported",yC="utf-8",RC="cp437",vC=["uncompressedSize","compressedSize","offset"],ol=class{constructor(e,t={}){Object.assign(this,{reader:e,options:t,config:lg()})}async*getEntriesGenerator(e={}){let t=this,n=t.reader;if(n.initialized||await n.init(),n.size<22)throw new Error(oh);let o=await jD(n,101010256,n.size,22,65535*16);if(!o)throw new Error(GC);let i=Hn(o),a=On(i,12),s=On(i,16),l=Zo(i,8),d=0;if(s==4294967295||a==4294967295||l==65535){let _=await as(n,o.offset-20,20),h=Hn(_);if(On(h,0)!=117853008)throw new Error(UC);s=ih(h,8);let S=await as(n,s,56),m=Hn(S),f=o.offset-20-56;if(On(m,0)!=101075792&&s!=f){let T=s;s=f,d=s-T,S=await as(n,s,56),m=Hn(S)}if(On(m,0)!=101075792)throw new Error(VC);l=ih(m,32),a=ih(m,40),s-=a}if(s<0||s>=n.size)throw new Error(oh);let c=0,p=await as(n,s,a),u=Hn(p);if(a){let _=o.offset-a;if(On(u,c)!=33639248&&s!=_){let h=s;s=_,d=s-h,p=await as(n,s,a),u=Hn(p)}}if(s<0||s>=n.size)throw new Error(oh);for(let _=0;_<l;_++){let h=new Gg(n,t.config,t.options);if(On(u,c)!=33639248)throw new Error(kC);YC(h,u,c+6);let S=!!h.bitFlag.languageEncodingFlag,m=c+46,f=m+h.filenameLength,T=f+h.extraFieldLength,y=Zo(u,c+4),E=(y&0)==0;Object.assign(h,{versionMadeBy:y,msDosCompatible:E,compressedSize:0,uncompressedSize:0,commentLength:Zo(u,c+32),directory:E&&(jl(u,c+38)&16)==16,offset:On(u,c+42)+d,internalFileAttribute:On(u,c+34),externalFileAttribute:On(u,c+38),rawFilename:p.subarray(m,f),filenameUTF8:S,commentUTF8:S,rawExtraField:p.subarray(f,T)});let v=T+h.commentLength;h.rawComment=p.subarray(T,v);let A=Jl(t,e,"filenameEncoding"),I=Jl(t,e,"commentEncoding"),[C,g]=await Promise.all([nh(h.rawFilename,h.filenameUTF8?yC:A||RC),nh(h.rawComment,h.commentUTF8?yC:I||RC)]);h.filename=C,h.comment=g,!h.directory&&h.filename.endsWith(Ig)&&(h.directory=!0),await QC(h,h,u,c+6);let R=new nl(h);if(R.getData=(D,P)=>h.getData(D,R,P),c=v,e.onprogress)try{e.onprogress(_+1,l,new nl(h))}catch{}yield R}return!0}async getEntries(e={}){let t=[],n=this.getEntriesGenerator(e),o=n.next();for(;!(await o).done;)t.push((await o).value),o=n.next();return t}async close(){}};var Gg=class{constructor(e,t,n){Object.assign(this,{reader:e,config:t,options:n})}async getData(e,t,n={}){let o=this,{reader:i,offset:a,extraFieldAES:s,compressionMethod:l,config:d,bitFlag:c,signature:p,rawLastModDate:u,compressedSize:_}=o,h=o.localDirectory={};i.initialized||await i.init();let S=await as(i,a,30),m=Hn(S),f=Jl(o,n,"password");if(f=f&&f.length&&f,s&&s.originalCompressionMethod!=99)throw new Error(Mg);if(l!=0&&l!=8)throw new Error(Mg);if(On(m,0)!=67324752)throw new Error(HC);YC(h,m,4),S=await as(i,a,30+h.filenameLength+h.extraFieldLength),h.rawExtraField=S.subarray(30+h.filenameLength),await QC(o,h,m,4),t.lastAccessDate=h.lastAccessDate,t.creationDate=h.creationDate;let T=o.encrypted&&h.encrypted,y=T&&!s;if(T){if(!y&&s.strength===void 0)throw new Error(KC);if(!f)throw new Error(WC)}let E=await Eg(d.Inflate,{codecType:$_,password:f,zipCrypto:y,encryptionStrength:s&&s.strength,signed:Jl(o,n,"checkSignature"),passwordVerification:y&&(c.dataDescriptor?u>>>8&255:p>>>24&255),signature:p,compressed:l!=0,encrypted:T,useWebWorkers:Jl(o,n,"useWebWorkers")},d);e.initialized||await e.init();let v=Jl(o,n,"signal"),A=a+30+h.filenameLength+h.extraFieldLength;return await vg(E,i,e,A,()=>_,d,{onprogress:n.onprogress,signal:v}),e.getData()}};function YC(r,e,t){let n=r.rawBitFlag=Zo(e,t+2),o=(n&1)==1,i=On(e,t+6);Object.assign(r,{encrypted:o,version:Zo(e,t),bitFlag:{level:(n&6)>>1,dataDescriptor:(n&8)==8,languageEncodingFlag:(n&2048)==2048},rawLastModDate:i,lastModDate:$D(i),filenameLength:Zo(e,t+22),extraFieldLength:Zo(e,t+24)})}async function QC(r,e,t,n){let o=e.rawExtraField,i=e.extraField=new Map,a=Hn(new Uint8Array(o)),s=0;try{for(;s<o.length;){let S=Zo(a,s),m=Zo(a,s+2);i.set(S,{type:S,data:o.slice(s+4,s+4+m)}),s+=4+m}}catch{}let l=Zo(t,n+4);e.signature=On(t,n+10),e.uncompressedSize=On(t,n+18),e.compressedSize=On(t,n+14);let d=i.get(1);d&&(XD(d,e),e.extraFieldZip64=d);let c=i.get(28789);c&&(await OC(c,"filename","rawFilename",e,r),e.extraFieldUnicodePath=c);let p=i.get(25461);p&&(await OC(p,"comment","rawComment",e,r),e.extraFieldUnicodeComment=p);let u=i.get(39169);u?(qD(u,e,l),e.extraFieldAES=u):e.compressionMethod=l;let _=i.get(10);_&&(ZD(_,e),e.extraFieldNTFS=_);let h=i.get(21589);h&&(JD(h,e),e.extraFieldExtendedTimestamp=h)}function XD(r,e){e.zip64=!0;let t=Hn(r.data);r.values=[];for(let o=0;o<Math.floor(r.data.length/8);o++)r.values.push(ih(t,0+o*8));let n=vC.filter(o=>e[o]==4294967295);for(let o=0;o<n.length;o++)r[n[o]]=r.values[o];vC.forEach(o=>{if(e[o]==4294967295)if(r[o]!==void 0)e[o]=r[o];else throw new Error(zC)})}async function OC(r,e,t,n,o){let i=Hn(r.data);r.version=jl(i,0),r.signature=On(i,1);let a=new ns;a.append(o[t]);let s=Hn(new Uint8Array(4));s.setUint32(0,a.get(),!0),r[e]=await nh(r.data.subarray(5)),r.valid=!o.bitFlag.languageEncodingFlag&&r.signature==On(s,0),r.valid&&(n[e]=r[e],n[e+"UTF8"]=!0)}function qD(r,e,t){let n=Hn(r.data);r.vendorVersion=jl(n,0),r.vendorId=jl(n,2);let o=jl(n,4);r.strength=o,r.originalCompressionMethod=t,e.compressionMethod=r.compressionMethod=Zo(n,5)}function ZD(r,e){let t=Hn(r.data),n=4,o;try{for(;n<r.data.length&&!o;){let i=Zo(t,n),a=Zo(t,n+2);i==1&&(o=r.data.slice(n+4,n+4+a)),n+=4+a}}catch{}try{if(o&&o.length==24){let i=Hn(o),a=i.getBigUint64(0,!0),s=i.getBigUint64(8,!0),l=i.getBigUint64(16,!0);Object.assign(r,{rawLastModDate:a,rawLastAccessDate:s,rawCreationDate:l});let d=bg(a),c=bg(s),p=bg(l),u={lastModDate:d,lastAccessDate:c,creationDate:p};Object.assign(r,u),Object.assign(e,u)}}catch{}}function JD(r,e){let t=Hn(r.data),n=jl(t,0),o=[],i=[];(n&1)==1&&(o.push("lastModDate"),i.push("rawLastModDate")),(n&2)==2&&(o.push("lastAccessDate"),i.push("rawLastAccessDate")),(n&4)==4&&(o.push("creationDate"),i.push("rawCreationDate"));let a=1;o.forEach((s,l)=>{if(r.data.length>=a+4){let d=On(t,a);e[s]=r[s]=new Date(d*1e3);let c=i[l];r[c]=d}a+=4})}async function jD(r,e,t,n,o){let i=new Uint8Array(4),a=Hn(i);ew(a,0,e);let s=n+o;return await l(n)||await l(Math.min(s,t));async function l(d){let c=t-d,p=await as(r,c,d);for(let u=p.length-n;u>=0;u--)if(p[u]==i[0]&&p[u+1]==i[1]&&p[u+2]==i[2]&&p[u+3]==i[3])return{offset:c+u,buffer:p.slice(u,u+n).buffer}}}function Jl(r,e,t){return e[t]===void 0?r.options[t]:e[t]}function $D(r){let e=(r&4294901760)>>16,t=r&65535;try{return new Date(1980+((e&65024)>>9),((e&480)>>5)-1,e&31,(t&63488)>>11,(t&2016)>>5,(t&31)*2,0)}catch{}}function bg(r){return new Date(Number(r/BigInt(1e4)-BigInt(116444736e5)))}function jl(r,e){return r.getUint8(e)}function Zo(r,e){return r.getUint16(e,!0)}function On(r,e){return r.getUint32(e,!0)}function ih(r,e){return Number(r.getBigUint64(e,!0))}function ew(r,e,t){r.setUint32(e,t,!0)}function Hn(r){return new DataView(r.buffer)}function as(r,e,t){return r.readUint8Array(e,t)}var Q5=new Uint8Array([7,0,2,0,65,69,3,0,0]);var j5=512*1024;var dw={},qC;try{qC=dw.url}catch{}Ql({baseURL:qC});TC(Ql);Ql({Deflate:NO,Inflate:JO});var zd,ya,Vg,Ug={env:{emscripten_notify_memory_growth:function(r){Vg=new Uint8Array(ya.exports.memory.buffer)}}},ah=class{init(){return zd||(typeof fetch<"u"?zd=fetch("data:application/wasm;base64,"+ZC).then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,Ug)).then(this._init):zd=WebAssembly.instantiate(Buffer.from(ZC,"base64"),Ug).then(this._init),zd)}_init(e){ya=e.instance,Ug.env.emscripten_notify_memory_growth(0)}decode(e,t=0){if(!ya)throw new Error("ZSTDDecoder: Await .init() before decoding.");let n=e.byteLength,o=ya.exports.malloc(n);Vg.set(e,o),t=t||Number(ya.exports.ZSTD_findDecompressedSize(o,n));let i=ya.exports.malloc(t),a=ya.exports.ZSTD_decompress(i,t,o,n),s=Vg.slice(i,i+a);return ya.exports.free(o),ya.exports.free(i),s}},ZC="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ";var Re=class r{blendMode(){return this._blendMode}blurColor(){return this._blurColor}blurOffset(){return this._blurOffset}blurRadius(){return this._blurRadius}spread(){return this._spread}isEnabled(){return this._isEnabled}opacity(){return this._opacity}showShadowBehindNode(){return this._showShadowBehindNode}type(){return this._type}setBlendMode(e){this._blendMode=e}setBlurColor(e){this._blurColor=e}setBlurOffset(e){this._blurOffset=e}setBlurOffset1(e){this._blurOffset=e.clone()}setBlurRadius(e){this._blurRadius=e}setSpread(e){this._spread=e}setIsEnabled(e){this._isEnabled=e}setOpacity(e){this._opacity=e}setShowShadowBehindNode(e){this._showShadowBehindNode=e}setType(e){this._type=e}clone(){let e=new r;return e.setBlendMode(this.blendMode()),e.setBlurColor(this.blurColor()),e.setBlurOffset1(this.blurOffset().clone()),e.setBlurRadius(this.blurRadius()),e.setSpread(this.spread()),e.setIsEnabled(this.isEnabled()),e.setOpacity(this.opacity()),e.setShowShadowBehindNode(this.showShadowBehindNode()),e.setType(this.type()),e}isVisibleForRendering(){switch(this.type()){case"DROP_SHADOW":return this.isEnabled()&&O.alpha(this.blurColor())>0&&this.opacity()>0;case"INNER_SHADOW":return this.isEnabled()&&O.alpha(this.blurColor())>0&&this.opacity()>0&&(this.blurRadius()>0||this.blurOffset().x()!=0||this.blurOffset().y()!=0||this.spread()>0);case"BACKGROUND_BLUR":return this.isEnabled()&&this.blurRadius()>0;case"FOREGROUND_BLUR":return this.isEnabled()&&this.blurRadius()>0}return!1}isEnabledAndVisible(){return this.isEnabled()&&this.opacity()>0}equals(e){return this.blendMode()==e.blendMode()&&this.blurColor()==e.blurColor()&&this.blurOffset().equals(e.blurOffset())&&this.blurRadius()==e.blurRadius()&&this.spread()==e.spread()&&this.showShadowBehindNode()==e.showShadowBehindNode()&&this.isEnabled()==e.isEnabled()&&this.opacity()==e.opacity()&&this.type()==e.type()}static createForegroundBlur(e){let t=new r;return t.setType("FOREGROUND_BLUR"),t.setBlurRadius(e),t}static createBackgroundBlur(e){let t=new r;return t.setType("BACKGROUND_BLUR"),t.setBlurRadius(e),t}static createInnerShadow(e,t,n,o){let i=new r;return i.setType("INNER_SHADOW"),i.setBlurRadius(e),i.setBlurOffset(t),i.setBlurColor(n),i.setOpacity(o),i}static createDropShadow(e,t,n,o,i=0,a=!0){let s=new r;return s.setType("DROP_SHADOW"),s.setBlurRadius(e),s.setBlurOffset(t),s.setBlurColor(n),s.setOpacity(o),s.setSpread(i),s.setShowShadowBehindNode(a),s}constructor(){this._blendMode="NORMAL",this._blurColor=O.TRANSPARENT,this._blurOffset=fe.FrozenVector_ZERO,this._blurRadius=0,this._spread=0,this._isEnabled=!0,this._opacity=1,this._showShadowBehindNode=!1,this._type="DROP_SHADOW"}};var $l=class{imageType(){return this._imageType}setImageType(e){this._imageType=e}constructor(e,t){this._ctx=null,this._decodeCallback=null,this._failureCallback=null,this._texture=null,this._imageHash=null,this._isImageMockLoading=!1,this._mockDecodedData=null,this._mockCompressedTexture=!1,this._imageType=1,this._ctx=e,this._imageHash=t}failureIsRetryable(){return null}width(){return 0}height(){return 0}url(){return"https://dummy-url"}hash(){return this._imageHash}state(){return this._mockDecodedData!=null?2:this._isImageMockLoading?1:0}gif(){return null}decodedData(){return this._mockDecodedData}texture(){return this._texture}setTexture(e){this._texture=e}loadDidFail(){return!1}isCompressedTexture(){return this._mockCompressedTexture}setIsCompressedTexture(e){this._mockCompressedTexture=e}primeWithCompressedData(e){}objectHash(){return`Image(${this._imageHash})`}fetchAndDecode(e,t,n){this._isImageMockLoading||(this._decodeCallback=t,this._failureCallback=n,this._isImageMockLoading=!0,this._ctx.markImageFetched(this))}imageLoads(){this._isImageMockLoading&&(this._mockDecodedData=Jt.createFromPixels(1,1,new Uint8Array(1)),this._decodeCallback(this._mockDecodedData),this._isImageMockLoading=!1)}imageFailsToLoad(){this._isImageMockLoading=!1,this._failureCallback(0)}freeMemoryForDecodedDataAndTexture(){return this.freeMemoryForDecodedData(),this._texture=null,!0}freeMemoryForDecodedData(){return this._mockDecodedData=null,this._isImageMockLoading=!1,!0}isDecoded(){return this._mockDecodedData!=null}isGIF(){return!1}};var ss=class r{constructor(e,t,n){this._hyperlinkBoxes=e,this._usedEmojiCodepoints=t,this._usedEmojiImages=n}hyperlinkBoxes(){return this._hyperlinkBoxes}usedEmojiCodepoints(){return this._usedEmojiCodepoints}usedEmojiImages(){return this._usedEmojiImages}static forTests(e){return new r([],e,[])}};var sh=class{constructor(e,t,n,o){this.node=e,this.property=t,this.oldVal=n,this.newVal=o}},Di=class Di{constructor(e){this._listeners=new Set;this._handle=0,this._observers=new jr,this._nodes=new Map,this._cachedRoot=null,this._isBetweenJoinStartAndJoinEnd=!1,this._loadedTlfs=[],this._deferUnregisteringNodes=!1,this._deferredUnregisters=null,this._handle=e}handle(){return this._handle}firstUserCanvasOrNull(){for(let e=0,t=this.root().childCount();e<t;e=e+1){let n=this.root().childAt1(e);if(n.type()=="CANVAS"&&!n.isInternalOnly())return n}return null}addObserver(e){this._observers.add(e)}removeObserver(e){this._observers.remove(e)}broadcastPropertyChange(e){var t,n;Di.VERBOSE&&console.log(`broadcasting change for property '${Tt[e.property]}' on node '${e.node.id()}'`),this._observers.forEach(o=>{o.handleSceneGraphEvent(e)}),(t=N())!=null&&t.modules().revisionNumberAccessor&&((n=N())==null||n.modules().revisionNumberAccessor.incrementRevisionNumber());for(let o of this._listeners)o()}onChange(e){return this._listeners.add(e),()=>{var t;return(t=this._listeners)==null?void 0:t.delete(e)}}getRevisionNumber(){var e,t;return(e=N())!=null&&e.modules().revisionNumberAccessor?(t=N())==null?void 0:t.modules().revisionNumberAccessor.getRevisionNumber():0}setAllTlfsLoaded(){this.setTlfsLoaded(e=>!0)}setTlfsLoaded(e){this._loadedTlfs=[],yn(this.root(),t=>t.type()=="DOCUMENT"||t.type()=="CANVAS"||t.type()=="SECTION"||t.type()=="SLIDE_GRID"||t.type()=="SLIDE_ROW"||t.isSlideModule()?0:t.isTopLevel()?(t.setHasBeenLoaded(e(t)),t.hasBeenLoaded()&&this._loadedTlfs.push(t),0):2)}hierarchyDebugString(){let e="",t=(n,o)=>{let i=n.symbolID(),a=i!=null?` -> ${i}`:"";e+=`${o}${n.id()} ${n.name()}${a}
`,o+="  ";for(let s=0,l=n.childCount();s<l;s=s+1)t(n.childAt1(s),o)};return t(this.root(),""),e}dangerouslyRegisterNode(e){if(e.scene()!=this)throw new Error("Scene mismatch when registering node");let t=this.findNode(e.id());if(t!=null&&t!=e)throw new Error("Unexpected existing node when registering node");this._nodes.set(e.id(),e)}dangerouslyUnregisterNode(e){if(this._deferUnregisteringNodes){this._deferredUnregisters.push(e);return}this._nodes.delete(e),X.isRoot(e)&&(this._cachedRoot=null)}dangerouslyDeferNodeRemovalScope(e){this._deferredUnregisters=[],this._deferUnregisteringNodes=!0,e(),this._deferUnregisteringNodes=!1;for(let t of this._deferredUnregisters)this.dangerouslyUnregisterNode(t);this._deferredUnregisters=null}markLoaded(){var e;(e=N())==null||e.markSceneLoaded(this)}destroy(){var e;(e=N())==null||e.destroyScene(this)}setFileKey(e){var t;(t=N())==null||t.modules().prototype.setSceneMetadata(e)}applyMessageToScene(e){var o;let t=Me.milliseconds();(o=N())==null||o.applyNodeChanges(e);let n=Me.milliseconds()-t;n>100&&console.warn(`applyMessageToScene took ${n/1e3} seconds`)}totalNodeCount(){return this._nodes.size}each(e){Ge.StringMap_each(this._nodes,(t,n)=>{e(n)})}findNode(e){return e==null?null:Ge.StringMap_get(this._nodes,e,null)}findNodeByStablePath(e){if(e==null||e.guids==null)return null;let t=N().findNode(this,e);return this.findNode(t)}findStyle(e){let t=N().sceneGraphTsApi().styleByIdOrNull(e);return this.findNode(t)}createNode(e){if(!Gr())throw new Error("Should not be creating nodes in TS Viewer while running fullview");let t={};return t.guid=X.toFigGUID(e),t.phase="CREATED",Jf(t),this.findNode(e)}removeNode(e){if(!Gr())throw new Error("Should not be removing nodes in TS Viewer while running fullview");let t={};t.guid=X.toFigGUID(e),t.phase="REMOVED",Jf(t);let n=this.findNode(e)}root(){var e;return this._cachedRoot==null&&(this._cachedRoot=this.findNode(X._new(0,0)),(e=this._cachedRoot)==null||e.updateIsRooted()),this._cachedRoot}regenerateDirtySymbolInstances(e){N().updateSymbolInstancesForTests()}updateDirtyStyleConsumers(){N().updateStylesForTests()}findNodeFromDeveloperFriendlyId(e){if(e.charCodeAt(0)==84){let t=e.slice(1).split(";");if(t.length!=3)return console.error("Table cell developer friendly id does not have 3 guids"),null;let n=X.fromString(t[0]),o=this.findNode(n);if(o==null)return console.error("Cannot find table from table cell developer friendly id"),null;let i=X.fromString(t[1]),a=X.fromString(t[2]);return o.getTableCellAt(i,a)}else if(e.charCodeAt(0)==73){let t=e.slice(1).split(";"),n=X.fromString(t[0]),o=this.findNode(n),i=null;i=(s,l)=>{if(s==null)return null;if(l(s))return s;for(let d=0,c=s.childCount();d<c;d=d+1){let p=i(s.childAt1(d),l);if(p!=null)return p}return null};let a=new ut(t.map(s=>X.fromString(s)));return i(o,s=>ut.equals(s.stablePath(),a))}else return this.findNode(e)}static createCanvasInScene(e,t){let n=e.createNode(t);return n.setType("CANVAS"),n.setVisible(!0),n.setOpacity(1),n.setName("canvas"),n.setCurrentViewportSize(new b(1e6,1e6)),e.root().appendChild(n),n}static createLoadedFrameWithCanvasContent(e,t){let n=new ht,o=[];yn(t,l=>l.isTopLevel()?(n.include3(l.fullSizeCanvasSpaceBoundingBox()),o.push(l),2):0);let i=n.build();i.expand1(150);let a=t.fillPaintsToRender()[0].asSinglePaint();a.opacity()==0&&(a=$.createSolid(O.WHITE,1));let s=Io(t,"frame",a);He(s,i.topLeft(),i.size()),s.setTestOnlyFillGeometry(mi(s.fullSizeCanvasSpaceBoundingBox()));for(let l of o){let d=l.relativeTransform().clone();d.translate1(s.relativeTransform().translation().negative()),l.setParentIndex(new Qr(X.invalid(),nr.fromString(""))),s.appendChild(l),l.setRelativeTransform(d)}return e.setTlfsLoaded(l=>l==s?!0:l.hasBeenLoaded()),s}static createScene(e,t){return N().createSceneAndSetActive(e,t)}static createSceneWithCanvasForTests1(){return Di.createSceneWithCanvasForTests2(Y.ViewerMode.PROTOTYPE)}static createSceneWithCanvasForTests2(e){var n;Y.setViewerMode(e);let t=Di.createScene(Di.MAGIC_SESSION_ID_FOR_NON_MULTIPLAYER,null);return(n=N())==null||n.modules().prototype.setSceneMetadata("1"),Di.createCanvasInScene(t,X._new(0,1)),t.markLoaded(),t}};Di.MAX_GUID_VALUE=2147483647,Di.MAGIC_SESSION_ID_FOR_NON_MULTIPLAYER=Di.MAX_GUID_VALUE-1,Di.VERBOSE=!1;var nt=Di;function kg(r){return r.x()==375&&r.y()==812?"APPLE_IPHONE_X_SILVER":r.x()==414&&r.y()==736?"APPLE_IPHONE_8_PLUS_SILVER":r.x()==375&&r.y()==667?"APPLE_IPHONE_8_SILVER":r.x()==320&&r.y()==568?"APPLE_IPHONE_SE_SILVER":r.x()==411&&r.y()==731?"GOOGLE_PIXEL_2_CLEARLY_WHITE":r.x()==768&&r.y()==1024?"APPLE_IPAD_MINI_4_SILVER":r.x()==1024&&r.y()==1366?"APPLE_IPAD_PRO_SILVER":r.x()==1440&&r.y()==990?"MICROSOFT_SURFACE_PRO_3":r.x()==1368&&r.y()==912?"MICROSOFT_SURFACE_PRO_4":r.x()==312&&r.y()==390?"APPLE_WATCH_42MM_STEEL_PLUS_WHITE_CLOSED":r.x()==272&&r.y()==340?"APPLE_WATCH_38MM_STEEL_PLUS_WHITE_CLOSED":null}var _e=class _e{constructor(e,t=null){this._paths=new Map;this._imageManager=e,this._videoManager=t}static hash(e,t){return t instanceof Array&&t.length===0?e:t}static hasFileHeader(e){for(let t=0,n=_e.FILE_HEADER.length;t<n;t=t+1)if(t>=e.length||e[t]!=_e.FILE_HEADER[t])return!1;return!0}static parseChunkType(e){return e.length!=_e.CHUNK_TAG_LEN?_e.ChunkType.UNKNOWN:(n=>{for(let o=0,i=e.length;o<i;o=o+1)if(e[o]!=n[o])return!1;return!0})(_e.THUMBNAIL_CHUNK_TAG)?_e.ChunkType.THUMBNAIL:_e.ChunkType.UNKNOWN}static readInt32(e,t){return e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24}static _logVerbose(e){console.log(e)}static _logVerbosePropertyChange(e,t){console.log(`decoded property change '${t}' for node '${e}'`)}static encodeGUID(e){return X.toFigGUID(e)}static encodeGUIDPath(e){let t={};return e.guids!=null&&(t.guids=e.guids.map(n=>_e.encodeGUID(n))),t}static encodeInstanceStateChange(e,t){let n={};return n.stateID=_e.encodeGUID(e.newStateId()),n.interactionID=_e.encodeGUID(e.interactionAddress.interactionId),e.interactionAddress.hotspotStablePath!=null&&(n.hotspotStablePath=_e.encodeGUIDPath(e.interactionAddress.hotspotStablePath)),e.stablePath!=null&&(n.instanceStablePath=_e.encodeGUIDPath(e.stablePath)),n.phase=t,n}static encodePrototypeStateChange(e){let t={};if(e.oldStateAndOverlays!=null){let n={};e.oldStateAndOverlays.stateId!=null&&(n.baseScreenID=_e.encodeGUID(e.oldStateAndOverlays.stateId),n.overlays=e.oldStateAndOverlays.overlays.map(o=>_e.encodeOverlayData(o,null))),t.oldState=n}if(e.newStateAndOverlays!=null){let n={};e.newStateAndOverlays.stateId!=null&&(n.baseScreenID=_e.encodeGUID(e.newStateAndOverlays.stateId),n.overlays=e.newStateAndOverlays.overlays.map(o=>_e.encodeOverlayData(o,null))),t.newState=n}return e.interactionAddress.hotspotStablePath!=null&&(t.hotspotBlueprintID=_e.encodeGUIDPath(e.interactionAddress.hotspotStablePath)),t.isHotspotInNewPresentedState=[6,7].indexOf(e.cause)==-1,t.interactionID=_e.encodeGUID(e.interactionAddress.interactionId),t.direction=e.direction==0?"FORWARD":"REVERSE",t}static encodeOverlayData(e,t){let n={};return n.hotspotBlueprintId=_e.encodeGUIDPath(e.openingHotspotStablePath),t!=null&&(n.hotspotGuid=_e.encodeGUID(t)),n.overlayGuid=_e.encodeGUID(e.id),n.prototypeInteractionGuid=_e.encodeGUID(e.openingInteractionId),n.swapGuid=_e.encodeGUID(e.overlayDataModelId),n}static encodeMatrix(e){let t={};return t.m00=e.m00(),t.m01=e.m01(),t.m02=e.m02(),t.m10=e.m10(),t.m11=e.m11(),t.m12=e.m12(),t}static encodeVector1(e){let t={};return t.x=e.x(),t.y=e.y(),t}static encodeVector2(e){let t={};return t.x=e.x(),t.y=e.y(),t}static decodeGUID(e){let t=null,n=e.sessionID|0;if(n<0){let o=e.localID|0;n==-1&&(o==-1||o==-2)?t=X._new(n,o):(Oe("Negative session ID encountered in GUID deserialization"),t=X._new(e.sessionID,e.localID))}else t=X._new(e.sessionID,e.localID);return Je.asGUID(t)}static decodeGUID_instanceHACK(e){return X._new(e.sessionID|0,e.localID)}static decodeGUIDPath(e){if(e.guids===void 0)return null;let t=[];for(let n of e.guids){let o=_e.decodeGUID(n);if(o==null)return null;t.push(o)}return new ut(t)}static decodeStyleId(e){let t=e.guid!=null?_e.decodeGUID(e.guid):null,n=e.assetRef!=null?{key:Wl(e.assetRef.key),version:Kl(e.assetRef.version)}:null,o={guid:t,ref:n};return Je.asStyleId(o)}static decodeVariableSetId(e){return Ia.fromKiwi(e)}static decodeParentIndex(e){return new Qr(_e.decodeGUID(e.guid),nr.fromString(e.position))}static decodeVector(e){return new b(e.x,e.y)}static decodeMatrix(e){return new J(e.m00,e.m01,e.m02,e.m10,e.m11,e.m12)}static decodeColor(e){return O.new3(e.r,e.g,e.b,e.a)}static decodeFontName(e){let t=e.postscript!==void 0?e.postscript:"";return new Kp(e.family,e.style,t)}static decodeNumber(e){return new Wp(e.value,e.units)}static decodeStops(e){let t=[];for(let n of e)t.push(new je(_e.decodeColor(n.color),n.position));return t}static decodePrototypeDevice(e){let t=_e.decodeVector(e.size),n=e.presetIdentifier!==void 0?e.presetIdentifier:null;e.type=="PRESET"&&(n==null||n.length==0)&&(n=kg(t));let o=e.rotation!==void 0?e.rotation:"NONE";return new sn(e.type,t,n,o)}static decodePrototypeStartingPoint(e){return new Ri(e.name,e.description,nr.fromString(e.position))}static encodePrototypeStartingPoint(e){let t={};return t.name=e.name,t.description=e.description,t.position=nr.toString(e.position),t}static decodeOverlayBackgroundAppearance(e){return new vi(e.backgroundType!==void 0?e.backgroundType:"NONE",e.backgroundColor!==void 0?_e.decodeColor(e.backgroundColor):O.TRANSPARENT)}static decodeVideoPlayback(e){return{autoplay:e.autoplay!==void 0?e.autoplay:!1,mediaLoop:e.mediaLoop!==void 0?e.mediaLoop:!1,muted:e.muted!==void 0?e.muted:!1,showControls:e.showControls!==void 0?e.showControls:!1}}static decodeEffects(e){let t=[];for(let o of e){let i=new Re;i.setType(o.type),o.color!==void 0&&(i.setBlurColor(O.withAlpha(_e.decodeColor(o.color),255)),i.setOpacity(o.color.a)),o.blendMode!==void 0&&i.setBlendMode(o.blendMode),o.offset!==void 0&&i.setBlurOffset1(_e.decodeVector(o.offset)),o.radius!==void 0&&i.setBlurRadius(o.radius),o.visible!==void 0&&i.setIsEnabled(o.visible),o.spread!==void 0&&i.setSpread(o.spread),o.showShadowBehindNode!==void 0?i.setShowShadowBehindNode(o.showShadowBehindNode):i.setShowShadowBehindNode(!0),t.push(i)}let n=t;return Je.asEffectList(n)}static decodeExportConstraint(e){return e.type!==void 0&&e.value!==void 0?new xl(e.type,e.value):new xl("CONTENT_SCALE",1)}static decodeExportSettings(e,t){let n=[];for(let o of e){let i=null;o.suffix!==void 0?i=o.suffix:i="";let a=null;o.imageType!==void 0?a=o.imageType:a="PNG";let s=null;o.constraint!==void 0?s=_e.decodeExportConstraint(o.constraint):s=new xl("CONTENT_SCALE",1);let l=t;o.contentsOnly!==void 0&&(l=o.contentsOnly),n.push(new Yp(i,a,s,l))}return n}static decodePrototypeInteractions(e){return e.map(t=>_e.decodePrototypeInteraction(t))}static decodePrototypeInteraction(e){let t=e.id!==void 0?_e.decodeGUID(e.id):null,n=e.event!==void 0?_e.decodePrototypeEvent(e.event):null,o=e.actions!==void 0?e.actions.map(s=>_e.decodePrototypeAction(s)):null,i=e.isDeleted!==void 0?e.isDeleted:!1,a=e.stateManagementVersion!==void 0?e.stateManagementVersion:0;return new Gt(t,n,o,i,a)}static encodePrototypeInteractionForTests(e){let t={};t.id=_e.encodeGUID(e.id()),t.isDeleted=e.isDeleted(),t.stateManagementVersion=e.stateManagementVersion(),t.event=_e.encodePrototypeEventForTests(e.event());let n=[],o=e.actions();for(let i=0,a=o.length;i<a;i=i+1){let s=o[i];n.push(_e.encodePrototypeActionForTests(s))}return t.actions=n,t}static decodePrototypeEvent(e){let t=e.interactionType!==void 0?e.interactionType:null,n=e.interactionMaintained!==void 0?new ce(e.interactionMaintained):null,o=e.interactionDuration!==void 0?new ce(e.interactionDuration):null,i=e.keyTrigger!==void 0?e.keyTrigger:null,a=e.transitionTimeout!==void 0?new ce(e.transitionTimeout):null,s=e.mediaHitTime!==void 0?new ce(e.mediaHitTime):null;return new kn(t,n,o,i,a,s)}static encodePrototypeEventForTests(e){let t={};return t.interactionType=e.interactionType(),t.interactionMaintained=e.interactionMaintained(),t.interactionDuration=e.interactionDuration(),t.keyTrigger=e.keyTrigger(),t.keyTrigger.keyCodes=e.keyTrigger().keyCodes,t.keyTrigger.triggerDevice=e.keyTrigger().triggerDevice,t.transitionTimeout=e.transitionTimeout(),t.mediaHitTime=e.mediaHitTime(),t}static decodeConditionalActions(e){let t=[],n=e.actions!==void 0?e.actions.map(i=>_e.decodePrototypeAction(i)):t,o=e.condition!==void 0?_e.variableDataToJson(e.condition):"";return new Nd(n,o)}static encodeConditionalActionsForTests(e){let t={},n=[],o=e.actions();for(let i=0,a=o.length;i<a;i=i+1){let s=o[i];n.push(_e.encodePrototypeActionForTests(s))}return t.actions=n,t}static decodePrototypeAction(e){let t=e.transitionNodeID!==void 0?_e.decodeGUID(e.transitionNodeID):null,n=e.transitionType!==void 0?e.transitionType:null,o=e.transitionDuration!==void 0?new ce(e.transitionDuration):null,i=e.easingType!==void 0?e.easingType:null,a=e.easingFunction!==void 0?e.easingFunction:null,s=e.transitionShouldSmartAnimate!==void 0?new ce(e.transitionShouldSmartAnimate):null,l=e.connectionType!==void 0?e.connectionType:null,d=e.connectionURL!==void 0?e.connectionURL:null,c=e.overlayRelativePosition!==void 0?_e.decodeVector(e.overlayRelativePosition):null,p=e.navigationType!==void 0?e.navigationType:null,u=e.transitionPreserveScroll!==void 0?new ce(e.transitionPreserveScroll):null,_=e.extraScrollOffset!==void 0?_e.decodeVector(e.extraScrollOffset):null,h=e.mediaAction!==void 0?e.mediaAction:null,S=e.transitionResetVideoPosition!==void 0?new ce(e.transitionResetVideoPosition):null,m=e.openUrlInNewTab!==void 0?new ce(e.openUrlInNewTab):null,f=e.mediaSkipToTime!==void 0?new ce(e.mediaSkipToTime):null,T=e.mediaSkipByAmount!==void 0?new ce(e.mediaSkipByAmount):null,y=e.transitionResetScrollPosition!==void 0?new ce(e.transitionResetScrollPosition):null,E=e.conditionalActions!==void 0?e.conditionalActions.map(B=>_e.decodeConditionalActions(B)):null,v=e.transitionResetInteractiveComponents!==void 0?new ce(e.transitionResetInteractiveComponents):null,A=e.targetVariable!==void 0&&e.targetVariable.id?gd.toString(e.targetVariable.id):null,I=e.targetVariable!==void 0&&e.targetVariable.nodeFieldAlias?_e.nodeFieldAliasToJson(e.targetVariable.nodeFieldAlias):null,C=e.targetVariableData!==void 0?_e.variableDataToJson(e.targetVariableData):null,g=e.targetVariableModeID!==void 0?_e.decodeGUID(e.targetVariableModeID):null,R=e.targetVariableSetID!==void 0?_e.decodeVariableSetId(e.targetVariableSetID):null,D=e.targetVariableSetKey!==void 0?e.targetVariableSetKey:null,P=e.animationType!==void 0?e.animationType:null,U=e.animationPhase!==void 0?e.animationPhase:null;return new ir(t,n,o,i,a,s,l,d,c,p,u,_,h,S,m,f,T,y,E,v,A,C,g,R,D,I,P,U)}static variableDataToJson(e){var o,i,a,s;let t={},n=e.dataType;switch(t.type=_e.variableDataTypeToEnumValue(n),t.resolvedType=_e.variableResolvedDataTypeToEnumValue(e.resolvedDataType),n){case"BOOLEAN":{t.value=e.value.boolValue;break}case"STRING":{t.value=e.value.textValue;break}case"FLOAT":{t.value=e.value.floatValue;break}case"COLOR":{let l={};l.r=e.value.colorValue.r,l.g=e.value.colorValue.g,l.b=e.value.colorValue.b,l.a=e.value.colorValue.a,t.value=l;break}case"ALIAS":{t.value=gd.toString(e.value.alias);break}case"NODE_FIELD_ALIAS":{t.value=_e.nodeFieldAliasToJson(e.value.nodeFieldAliasValue);break}case"CMS_ALIAS":{let l=(o=e.value)==null?void 0:o.cmsAliasValue;t.value=l?_e.cmsAliasToJson(l):{};break}case"JS_RUNTIME_ALIAS":{let l=(i=e.value)==null?void 0:i.jsRuntimeAliasValue;t.value=l?_e.jsRuntimeAliasToJson(l):{};break}case"MANAGED_STRING_ALIAS":{let l=(a=e.value)==null?void 0:a.managedStringAliasValue;t.value=l?_e.managedStringAliasToJson(l):{};break}case"PROP_REF":{let l=(s=e.value)==null?void 0:s.propRefValue;t.value=l?_e.componentPropRefToJson(l):{};break}case"EXPRESSION":{t.value=_e.expressionToJson(e.value.expressionValue);break}case"MAP":throw new Error("Did not implement variableDataToJson for MAP data type")}return t}static variableDataTypeToEnumValue(e){switch(e){case"BOOLEAN":return 0;case"FLOAT":return 1;case"STRING":return 2;case"ALIAS":return 3;case"COLOR":return 4;case"EXPRESSION":return 5;case"MAP":return 6;case"SYMBOL_ID":return 7;case"FONT_STYLE":return 8;case"TEXT_DATA":return 9;case"INVALID":return 10;case"NODE_FIELD_ALIAS":return 11;case"CMS_ALIAS":return 12;case"PROP_REF":return 13;case"IMAGE":return 14;case"MANAGED_STRING_ALIAS":return 15;case"LINK":return 16;case"JS_RUNTIME_ALIAS":return 17}throw new Error(`Invalid variable data type: ${e}`)}static variableResolvedDataTypeToEnumValue(e){switch(e){case"BOOLEAN":return 0;case"FLOAT":return 1;case"STRING":return 2;case"COLOR":return 3;case"MAP":return 4;case"SYMBOL_ID":return 5;case"FONT_STYLE":return 6;case"TEXT_DATA":return 7;case"IMAGE":return 8;case"LINK":return 9;case"JS_RUNTIME_ALIAS":return 10}throw new Error(`Invalid resolved variable data type: ${e}`)}static expressionToJson(e){let t={};t.expressionFunction=_e.expressionFunctionToEnumValue(e.expressionFunction);let n=[];for(let o=0;o<e.expressionArguments.length;o=o+1)n.push(_e.variableDataToJson(e.expressionArguments[o]));return t.expressionArguments=n,t}static nodeFieldAliasToJson(e){let t={};return t.stablePathToNode=_e.decodeGUIDPath(e.stablePathToNode),t.nodeField=e.nodeField,t.indexOrKey=e.indexOrKey,t}static cmsAliasToJson(e){let t={};return e&&(t.collectionId=e.collectionId,t.itemId=e.itemId,t.fieldId=e.fieldId),t}static jsRuntimeAliasToJson(e){let t={};return e&&(t.lookupKey=e.lookupKey),t}static managedStringAliasToJson(e){let t={};return e&&(t.managedStringId=e.managedStringId?Mp.toString(e.managedStringId):""),t}static componentPropRefToJson(e){let t={};return e&&(t.defId=e.defId),t}static expressionFunctionToEnumValue(e){switch(e){case"ADDITION":return 0;case"SUBTRACTION":return 1;case"RESOLVE_VARIANT":return 2;case"MULTIPLY":return 3;case"DIVIDE":return 4;case"EQUALS":return 5;case"NOT_EQUAL":return 6;case"LESS_THAN":return 7;case"LESS_THAN_OR_EQUAL":return 8;case"GREATER_THAN":return 9;case"GREATER_THAN_OR_EQUAL":return 10;case"AND":return 11;case"OR":return 12;case"NOT":return 13;case"STRINGIFY":return 14;case"TERNARY":return 15;case"VAR_MODE_LOOKUP":return 16;case"NEGATE":return 17;case"IS_TRUTHY":return 18}throw new Error(`Invalid expression function: ${e}`)}static encodePrototypeActionForTests(e){let t={};t.transitionNodeID=_e.encodeGUID(e.transitionNodeID()),t.transitionType=e.transitionType(),t.transitionDuration=e.transitionDuration(),t.easingType=e.easingType(),t.easingFunction=e.easingFunctionValues(),t.transitionShouldSmartAnimate=e.transitionShouldSmartAnimate(),t.connectionType=e.connectionType(),t.connectionURL=e.connectionURL(),t.overlayRelativePosition=_e.encodeVector1(e.overlayRelativePosition()),t.navigationType=e.navigationType(),t.transitionPreserveScroll=e.transitionPreserveScroll(),t.extraScrollOffset=_e.encodeVector1(e.extraScrollOffset()),t.mediaAction=e.mediaAction(),t.transitionResetVideoPosition=e.transitionResetVideoPosition(),t.openUrlInNewTab=e.openUrlInNewTab(),t.mediaSkipToTime=e.mediaSkipToTime(),t.mediaSkipByAmount=e.mediaSkipByAmount(),t.transitionResetScrollPosition=e.transitionResetScrollPosition();let n=[],o=e.conditionalActions();for(let i=0,a=o.length;i<a;i=i+1){let s=o[i];n.push(_e.encodeConditionalActionsForTests(s))}return t.conditionalActions=n,t.transitionResetInteractiveComponents=e.transitionResetInteractiveComponents(),t.animationType=e.animationType(),t.animationPhase=e.animationPhase(),t}static serializeValueToKiwiForTests1(e,t){let n={},o=[];return _e.serializeValueToKiwiForTests2(e,t,n,o),new Un(n,o)}static serializeValueToKiwiForTests2(e,t,n,o){if(!Gr())throw new Error("Should only serialize values to kiwi when running tests");if(e==61||e==62){let i=Je.asPaintList(t);if(i==null)throw new Error("attempt to set null paint list");let a=[];for(let s=0,l=i.length;s<l;s=s+1){let d=i[s].asSinglePaint(),c={};if(c.type=d.type(),c.opacity=d.opacity(),c.visible=d.isEnabled(),c.blendMode=d.blendMode(),c.transform=_e.encodeMatrix(d.transform()),d.colorStops()!=null){let u=[];for(let _=0,h=d.colorStops().length;_<h;_=_+1){let S=d.colorStops()[_],m={},f={};f.r=O.redF(S.color),f.g=O.greenF(S.color),f.b=O.blueF(S.color),f.a=O.alphaF(S.color),m.color=f,m.position=S.position,u.push(m)}c.stops=u}let p={};if(p.r=O.redF(d.color()),p.g=O.greenF(d.color()),p.b=O.blueF(d.color()),p.a=O.alphaF(d.color()),c.color=p,d.image()!=null){let u={};u.hash=Ur.hexToBytes(d.image().hash()),c.image=u,c.imageScaleMode=d.imageScaleMode()}a.push(c)}e==61?n.fillPaints=a:e==62&&(n.strokePaints=a)}else if(e==78){let i=t;if(i==null)throw new Error("attempt to set null symbol data");let a={};a.symbolID=_e.encodeGUID(i.masterID);let s=[];zo.map(i.instanceOverrides).each((l,d)=>{let c={};c.guidPath=_e.encodeGUIDPath(l),or.each(d,(p,u)=>{_e.serializeValueToKiwiForTests2(p,u,c,[])}),s.push(c)}),a.symbolOverrides=s,n.symbolData=a}else if(e==76||e==77){let i=t;if(i==null)throw new Error("attempt to set null geometry");let a=[];for(let s=0,l=i.regions.length;s<l;s=s+1){let d=i.regions[s],c={};c.windingRule=d.windingRule,c.styleID=d.styleID,c.commandsBlob=o.length,o.push(Rt.mutableData(d.path().toBezierPath().getMutableClone()).bytes()),a.push(c)}e==76?n.fillGeometry=a:n.strokeGeometry=a}else if(e==4){let i=t;if(i==null)throw new Error("attempt to set null textData");let a={};a.characters=i.characters();let s=[];i.styleOverrideTable().forEachStyle((l,d)=>{Wi.each(d,(c,p)=>{let _=_e.serializeValueToKiwiForTests1(c,p).a;_.styleID=l,s.push(_)})}),a.styleOverrideTable=s,n.textData=a}else if(e==5){let i=t;if(i==null)throw new Error("attempt to set null textData");let a={},s=[];i.usedEmojiCodepoints().forEach(l=>{let d={};d.emojiCodePoints=l,s.push(d)}),a.glyphs=s,a.hyperlinkBoxes=i.hyperlinkBoxes().map(l=>({guid:l.guid,bounds:l.bounds,hyperlinkID:l.hyperlinkID,url:l.url})),n.derivedTextData=a}else if(e==64){let i=Je.asEffectList(t);if(i==null)throw new Error("attempt to set null effects");let a=[];for(let s=0,l=i.length;s<l;s=s+1){let d=i[s],c={};c.blendMode=d.blendMode(),c.radius=d.blurRadius(),c.spread=d.spread(),c.visible=d.isEnabled(),c.showShadowBehindNode=d.showShadowBehindNode(),c.type=d.type();let p={};p.r=O.redF(d.blurColor()),p.g=O.greenF(d.blurColor()),p.b=O.blueF(d.blurColor()),p.a=d.opacity(),c.color=p;let u=_e.encodeVector2(d.blurOffset());c.offset=u,a.push(c)}n.effects=a}else if(e==59){let i=Je.asGUID(t);if(i==null)throw new Error("attempt to set null overridenSymbolID");n.overriddenSymbolID=_e.encodeGUID(i)}else if(e==90||e==91){let i=t;if(i==null)throw new Error("attempt to set null prototypeInteractions");let a=[];for(let s=0,l=i.length;s<l;s=s+1){let c=i[s];a.push(_e.encodePrototypeInteractionForTests(c))}e==90?n.prototypeInteractions=a:e==91&&(n.objectAnimations=a)}else if(e==112){let i=Je.asStringEnum(t,null);if(i==null)throw new Error("Bad node phase");n.phase=i}else{let i=zl(e);throw new Error(`unsupported setter for node field ${Tt[e]} and type ${Fd[i]}`)}}_imageDecoded(e,t,n){this._imageManager!=null&&this._imageManager.onNewImage(e,t,n)}_imageByHexHashOrNull(e,t){var n;return(n=this._imageManager)==null?void 0:n.findImageByHexHash(e,t)}decodeImage(e,t,n){let o=Ur.bytesToHex(e.hash),i=this._imageByHexHashOrNull(o,1);if(i==null){let a=null;if(e.dataBlob!==void 0){let s=e.dataBlob;s<0||s>=t.length?console.warn(`ignoring invalid compressed data index ${s} for blob count ${t.length}`):a=t[s].bytes}Xn?i=new $l(null,o):i=Ur.createImage(e.hash,a,n),this._imageDecoded(o,1,i)}return i}decodeVideo(e){let t=new Uint8Array(e.hash);return this._videoManager.buildVideoResource(t)}decodeEmojiImage(e,t){let n=e.map(i=>i.toString(16)).join("-"),o=this._imageByHexHashOrNull([n,t].join("-"),0);return o==null&&(o=Ur.createEmojiImage2(n,t),this._imageDecoded([n,t].join("-"),0,o)),o}decodePaints(e,t){let n=[];for(let i of e){let a=new $(i.type);if(i.blendMode!==void 0&&a.setBlendMode(i.blendMode),i.color!==void 0){let s=_e.decodeColor(i.color);a.setOpacity(O.alphaF(s)),a.setColor(O.withAlpha(s,255))}if(i.opacity!==void 0&&a.setOpacity(a.opacity()*i.opacity),i.stops!==void 0&&a.setColorStops1(_e.decodeStops(i.stops)),i.transform!==void 0&&a.setTransform1(_e.decodeMatrix(i.transform)),i.visible!==void 0&&a.setIsEnabled(i.visible),i.imageScaleMode!==void 0&&a.setImageScaleMode(i.imageScaleMode),i.rotation!==void 0&&a.setRotationDeg(i.rotation),i.scale!==void 0&&a.setScalingFactor(i.scale),i.paintFilter!==void 0&&a.setFilterColorAdjust(i.paintFilter),i.originalImageWidth!==void 0&&a.setOriginalImageWidth(i.originalImageWidth),i.originalImageHeight!==void 0&&a.setOriginalImageHeight(i.originalImageHeight),i.emojiCodePoints!==void 0)a.setImage(this.decodeEmojiImage(i.emojiCodePoints,"apple"));else{let s=!1;i.animatedImage!==void 0&&i.animatedImage.hash!==void 0?(a.setImage(this.decodeImage(i.animatedImage,t,0)),i.animationFrame!==void 0&&i.animationFrame!=0&&(s=!0)):i.video!==void 0&&i.video.hash!==void 0?(a.setVideo(this.decodeVideo(i.video)),i.image!==void 0&&i.image.hash!==void 0&&a.setImage(this.decodeImage(i.image,t,1))):i.image!==void 0&&i.image.hash!==void 0&&a.setImage(this.decodeImage(i.image,t,1)),!s&&i.imageThumbnail!==void 0&&i.imageThumbnail.hash!==void 0&&a.setImageThumbnail(this.decodeImage(i.imageThumbnail,t,1))}a.opacity()!=0&&a.opacity()<1/250&&a.setOpacity(1/250),n.push(a)}let o=n;return Je.asPaintList(o)}decodePath(e,t){let n=Dt.IntMap_get(this._paths,e,null);return n==null&&(e<0||e>=t.length?(console.warn(`ignoring invalid path index ${e} for blob count ${t.length}`),n=new Rt(new fn)):n=new Rt(new fn(new Uint8Array(t[e].bytes))),this._paths.set(e,n)),n}decodeGeometry(e,t){let n=[],o=null;for(let i of e){let a="ODD";if(i.commandsBlob===void 0){console.warn("ignoring path with missing required field: 'commandsBlob'");continue}i.windingRule!==void 0&&(a=i.windingRule);let s=this.decodePath(i.commandsBlob,t);n.push(new Dr(a,0,s,s.bounds())),i.styleID!==void 0&&(o==null&&(o=[]),o.push(i.styleID))}ht.INSTANCE.reset();for(let i of n)ht.INSTANCE.include3(i.bounds());return new wr(n,o,ht.INSTANCE.build(),null)}decodeTextData(e,t){let n=e.styleOverrideTable!==void 0?this.decodeStyleOverrideTable(e.styleOverrideTable,t):new $r,o=null,i=n.styleByID2();for(let a of Array.from(i.keys())){let s=i.get(a),l=or.get(s,3,null);if(l!=null){if(o==null)o=l;else if(l!==o){o="mixed";break}}}return new qi(n,o,e.characters!==void 0?e.characters:"",e.lines!==void 0?e.lines:[],e.characterStyleIDs!==void 0?e.characterStyleIDs:[])}decodeDerivedTextData(e,t){let n=e.hyperlinkBoxes!==void 0?e.hyperlinkBoxes:[];return new ss(n,[],[])}decodeVectorData(e,t){let n=e.styleOverrideTable!==void 0?this.decodeStyleOverrideTable(e.styleOverrideTable,t):new $r;return new f_(n)}decodeSymbolData(e,t){return e.symbolID===void 0?(console.warn("ignoring symbol data with missing required field: 'symbolID'"),null):new Ta(_e.decodeGUID(e.symbolID),e.symbolOverrides!==void 0?this.decodeOverrides(e.symbolOverrides,t):zo._new())}decodeOverrides(e,t){let n=zo._new();for(let o of e)if(o.guidPath!==void 0){let i=_e.decodeGUIDPath(o.guidPath),a=or._new();this.decodeNodeChange(o,t,(s,l)=>{or.set(a,s,l)}),zo.map(n).set(i,a)}return n}decodeStyleOverrideTable(e,t){let n=new Map;for(let o of e)o.styleID!==void 0&&this.decodeNodeChange(o,t,(i,a)=>{n.has(o.styleID)||n.set(o.styleID,or._new()),or.set(n.get(o.styleID),i,a)});return new $r(n)}decodeNodeChange(e,t,n){e.type!==void 0&&n(25,e.type),e.backgroundColor!==void 0&&n(67,_e.decodeColor(e.backgroundColor)),e.backgroundEnabled!==void 0&&n(9,e.backgroundEnabled),e.backgroundOpacity!==void 0&&n(46,e.backgroundOpacity),e.blendMode!==void 0&&n(28,e.blendMode),e.connectionType!==void 0&&n(33,e.connectionType),e.connectionURL!==void 0&&n(73,e.connectionURL),e.cornerRadius!==void 0&&n(52,e.cornerRadius),e.rectangleTopLeftCornerRadius!==void 0&&n(47,e.rectangleTopLeftCornerRadius),e.rectangleTopRightCornerRadius!==void 0&&n(48,e.rectangleTopRightCornerRadius),e.rectangleBottomLeftCornerRadius!==void 0&&n(49,e.rectangleBottomLeftCornerRadius),e.rectangleBottomRightCornerRadius!==void 0&&n(50,e.rectangleBottomRightCornerRadius),e.rectangleCornerRadiiIndependent!==void 0&&n(15,e.rectangleCornerRadiiIndependent),e.cornerSmoothing!==void 0&&n(53,e.cornerSmoothing),e.easingType!==void 0&&n(35,e.easingType),e.effects!==void 0&&n(64,_e.decodeEffects(e.effects)),e.arcData!==void 0&&n(66,e.arcData),e.shapeWithTextType!==void 0&&n(94,e.shapeWithTextType),e.fillGeometry!==void 0&&n(76,this.decodeGeometry(e.fillGeometry,t)),e.fillPaints!==void 0&&n(61,this.decodePaints(e.fillPaints,t)),e.textDecorationFillPaints!==void 0&&n(63,this.decodePaints(e.textDecorationFillPaints,t)),e.frameMaskDisabled!==void 0&&n(13,e.frameMaskDisabled),e.interactionType!==void 0&&n(36,e.interactionType),e.internalOnly!==void 0&&n(12,e.internalOnly),e.isStateGroup!==void 0&&n(89,e.isStateGroup),e.mask!==void 0&&n(10,e.mask),e.maskIsOutline!==void 0&&n(11,e.maskIsOutline),e.name!==void 0&&n(65,e.name),e.navigationType!==void 0&&n(37,e.navigationType),e.opacity!==void 0&&n(44,sr.Math_clamp(e.opacity,0,1)),e.overlayBackgroundInteraction!==void 0&&n(39,e.overlayBackgroundInteraction),e.overlayBackgroundAppearance!==void 0&&n(70,_e.decodeOverlayBackgroundAppearance(e.overlayBackgroundAppearance)),e.overlayPositionType!==void 0&&n(38,e.overlayPositionType),e.overlayRelativePosition!==void 0&&n(60,_e.decodeVector(e.overlayRelativePosition)),e.overriddenSymbolID!==void 0&&n(59,_e.decodeGUID(e.overriddenSymbolID)),e.overrideKey!==void 0&&n(58,_e.decodeGUID(e.overrideKey)),e.parentIndex!==void 0&&n(32,_e.decodeParentIndex(e.parentIndex)),e.prototypeBackgroundColor!==void 0&&n(68,_e.decodeColor(e.prototypeBackgroundColor)),e.prototypeDevice!==void 0&&n(69,_e.decodePrototypeDevice(e.prototypeDevice)),e.prototypeStartNodeID!==void 0&&n(72,_e.decodeGUID(e.prototypeStartNodeID)),e.prototypeStartingPoint!==void 0&&n(93,_e.decodePrototypeStartingPoint(e.prototypeStartingPoint)),e.resizeToFit!==void 0&&n(14,e.resizeToFit),e.scrollDirection!==void 0&&n(41,e.scrollDirection),e.size!==void 0&&n(57,_e.decodeVector(e.size)),e.strokeAlign!==void 0&&n(29,e.strokeAlign),e.strokeGeometry!==void 0&&n(77,this.decodeGeometry(e.strokeGeometry,t)),e.strokePaints!==void 0&&n(62,this.decodePaints(e.strokePaints,t)),e.symbolData!==void 0&&n(78,this.decodeSymbolData(e.symbolData,t)),e.videoPlayback!==void 0&&n(75,_e.decodeVideoPlayback(e.videoPlayback)),e.stackReverseZIndex!==void 0&&n(86,e.stackReverseZIndex),e.textData!==void 0&&n(4,this.decodeTextData(e.textData,t)),e.derivedTextData!==void 0&&n(5,this.decodeDerivedTextData(e.derivedTextData,t)),e.vectorData!==void 0&&n(79,this.decodeVectorData(e.vectorData,t)),e.transform!==void 0&&n(30,_e.decodeMatrix(e.transform)),e.transitionNodeID!==void 0&&n(74,_e.decodeGUID(e.transitionNodeID)),e.transitionType!==void 0&&n(34,e.transitionType),e.transitionShouldSmartAnimate!==void 0&&n(19,e.transitionShouldSmartAnimate),e.transitionDuration!==void 0&&n(54,e.transitionDuration),e.transitionTimeout!==void 0&&n(55,e.transitionTimeout),e.interactionMaintained!==void 0&&n(17,e.interactionMaintained),e.interactionDuration!==void 0&&n(56,e.interactionDuration),e.transitionPreserveScroll!==void 0&&n(18,e.transitionPreserveScroll),e.visible!==void 0&&n(8,e.visible),e.styleType!==void 0&&n(40,e.styleType),e.styleIdForFill!==void 0&&n(102,_e.decodeStyleId(e.styleIdForFill)),e.styleIdForStrokeFill!==void 0&&n(103,_e.decodeStyleId(e.styleIdForStrokeFill)),e.styleIdForEffect!==void 0&&n(105,_e.decodeStyleId(e.styleIdForEffect)),e.styleIdForText!==void 0&&n(104,_e.decodeStyleId(e.styleIdForText)),e.horizontalConstraint!==void 0&&n(26,e.horizontalConstraint),e.verticalConstraint!==void 0&&n(27,e.verticalConstraint),e.scrollBehavior!==void 0&&n(42,e.scrollBehavior),e.keyTrigger!==void 0&&n(88,e.keyTrigger),e.prototypeInteractions!==void 0&&n(90,_e.decodePrototypeInteractions(e.prototypeInteractions)),e.objectAnimations!==void 0&&n(91,_e.decodePrototypeInteractions(e.objectAnimations)),e.fontSize!==void 0&&n(3,e.fontSize),e.textAlignHorizontal!==void 0&&n(1,e.textAlignHorizontal),e.textAlignVertical!==void 0&&n(2,e.textAlignVertical),e.strokeWeight!==void 0&&n(51,e.strokeWeight),e.hyperlink!==void 0&&n(6,e.hyperlink),e.mention!==void 0&&n(7,e.mention),e.interactiveSlideConfigData!==void 0&&n(95,e.interactiveSlideConfigData),e.interactiveSlideParticipantData!==void 0&&n(96,e.interactiveSlideParticipantData),e.slideSpeakerNotes!==void 0&&n(109,e.slideSpeakerNotes),e.isSkippedSlide!==void 0&&n(111,e.isSkippedSlide),e.slideSpeakerNotes!==void 0&&n(108,e.slideThumbnailHash),e.transitionType!==void 0&&e.transitionType=="MAGIC_MOVE"&&n(34,"SMART_ANIMATE")}decompressZlibOrZstd(e){let t=new Go;try{let n=Hi.inflateRaw(e);t.resolve(n)}catch{let n=new ah;n.init().then(i=>{t.resolve(n.decode(e))},i=>{t.resolve(null)})}return t}async decodeSceneForViewerAndPrototypeLib1(e){return this.decodeSceneForViewerAndPrototypeLib2(e,null)}_isProbablyZipFile(e){return e[0]==80&&e[1]==75}async decodeSceneFromCanvas(e,t){let n=e.length,o=_e.FILE_HEADER.length;if(_e.hasFileHeader(e)&&o+4<=n){let i=_e.readInt32(e,o);if(o=o+4,i>=1&&o+4<=n){let a=_e.readInt32(e,o);if(o=o+4,o+a+4<=n){let s=await this.decompressZlibOrZstd(e.subarray(o,o+a)).realPromise(),l=ch.createKiwiCodec(!!Y.getFeatureFlags().use_new_kiwi_codec_in_viewer,ch.decodeBinarySchema(s));o=o+a;let d=_e.readInt32(e,o);if(o=o+4,o+d<=n){let c=e.subarray(o,o+d);o=o+d;let p=!1;for(;o<n;){o+4>e.length&&console.error(`ran out of bytes, ${o} (offset) + 4 > ${e.length} (bytes) but ${o} < ${n} (length)`);let h=_e.readInt32(e,o);if(o=o+4,h==0||h<_e.CHUNK_TAG_LEN)continue;o+_e.CHUNK_TAG_LEN>n&&console.error(`not enough bytes to read chunk tag, ${o} (offset) + ${_e.CHUNK_TAG_LEN} (tag length) > ${n} (length) but chunkLength = ${h}`);let S=e.subarray(o,o+_e.CHUNK_TAG_LEN);o=o+_e.CHUNK_TAG_LEN;let m=h-_e.CHUNK_TAG_LEN;switch(o+m>n&&console.error(`not enough bytes to read data, ${o} (offset) + ${m} (dataLength) > ${n} (length)`),o=o+m,_e.parseChunkType(S)){case _e.ChunkType.THUMBNAIL:{p&&console.error(`hasThumbnail = ${p} and chunk type of ${S} is THUMBNAIL`),p=!0;break}case _e.ChunkType.UNKNOWN:break}}let u=await this.decompressZlibOrZstd(new Uint8Array(c)).realPromise(),_=l.decodeMessage(u);if(_.type!==void 0&&_.type=="NODE_CHANGES"){let h=nt.createScene(nt.MAGIC_SESSION_ID_FOR_NON_MULTIPLAYER,i);return t!=null&&h.setFileKey(t),h.applyMessageToScene(u),h}}}}}return console.error("Scene decoding from canvas did not successfully create a scene."),null}async decodeSceneForViewerAndPrototypeLib2(e,t){if(this._isProbablyZipFile(e)){let i=(await new ol(new rl(e)).getEntries()).find(a=>a.filename==="canvas.fig");if(!(i!=null&&i.getData))throw new Error("Cannot find canvas.fig in zip file");e=await i.getData(new is)}return this.decodeSceneFromCanvas(e,t)}async decodeSceneWithImages(e,t){if(!this._isProbablyZipFile(e))return this.decodeSceneFromCanvas(e,t);let o=await new ol(new rl(e)).getEntries(),i=null;for(let a of o)if(a.filename==="canvas.fig"){if(!(a!=null&&a.getData))throw new Error("Entry find ${entry.filename} in zip file does not have data");i=await this.decodeSceneFromCanvas(await(a==null?void 0:a.getData(new is)),t)}else if(/images\/[0-9a-f]+/.test(a.filename)&&(a!=null&&a.getData)){let s=await(a==null?void 0:a.getData(new is)),l=a.filename.split("/")[1],d=this._imageByHexHashOrNull(l,1);d?d.primeWithCompressedData(s):(d=Ur.createImage(Ur.hexToBytes(l),s,1),this._imageDecoded(l,1,d));let c=s.slice(0,12).toString()===Sf;d.setIsCompressedTexture(c)}return i}};_e.VERBOSE=!1,_e.FILE_HEADER=[102,105,103,45,107,105,119,105],_e.CHUNK_TAG_LEN=8,_e.THUMBNAIL_CHUNK_TAG=[137,80,78,71,13,10,26,10];var ot=_e;(t=>{let r;(i=>(i[i.THUMBNAIL=0]="THUMBNAIL",i[i.UNKNOWN=1]="UNKNOWN"))(r=t.ChunkType||(t.ChunkType={}));class e{constructor(o){this.timeSpentApplyingMessageToSceneMs=o}}t.TimingInfo=e})(ot||(ot={}));var zn;(o=>{function r(i,a){return i==a?!0:i==33?a==74||a==73:!1}o.affects=r;function e(i){return i==61||i==62||i==102||i==103||i==4||i==5}o.affectsImagesUsedByNode=e;function t(i){switch(i){case 112:case 32:case 8:case 111:case 33:case 73:case 56:case 17:case 36:case 41:case 68:case 69:case 90:case 91:case 72:case 93:case 42:case 54:case 74:case 18:case 55:case 34:case 37:case 38:case 60:case 39:case 70:return!0}return!1}o.isPrototypeStructuralChange=t;function n(i){switch(i){case 36:case 17:case 56:case 88:case 92:case 74:case 34:case 54:case 35:case 55:case 19:case 33:case 73:case 60:case 37:case 18:case 4:case 5:return!0}return!1}o.isInteractionProperty=n})(zn||(zn={}));function $C(r,e){switch(e){case 28:return xe().BlendMode[r];case 33:return xe().ConnectionType[r];case 26:return xe().ConstraintType[r];case 27:return xe().ConstraintType[r];case 35:return xe().EasingType[r];case 36:return xe().InteractionType[r];case 37:return xe().NavigationType[r];case 39:return xe().OverlayBackgroundInteraction[r];case 41:return xe().ScrollDirection[r];case 38:return xe().OverlayPositionType[r];case 112:return xe().NodePhase[r];case 42:return xe().ScrollBehavior[r];case 94:return xe().ShapeWithTextType[r];case 80:return xe().StackMode[r];case 29:return xe().StrokeAlign[r];case 40:return xe().StyleType[r];case 1:return xe().TextAlignHorizontal[r];case 2:return xe().TextAlignVertical[r];case 34:return xe().TransitionType[r];case 25:return xe().NodeType[r];default:throw new Error(`Given field ${Tt[e]} is not a string enum field`)}}function dh(r,e,t){switch(zl(t)){case 0:return r.getBool(e,t);case 1:return r.getDouble(e,t);case 2:return r.getInt(e,t);case 3:return r.getString(e,t);case 4:return $C(r.getInt(e,t),t);case 5:return r.getAffineTransform(e,t);case 6:return r.getArcData(e,t);case 7:return r.getGUID(e,t);case 8:return r.getStyleId(e,t);case 10:return r.getVector(e,t);case 11:return r.getEffectList(e);case 12:return r.getPaintList(e,t);case 15:return r.getParentIndex(e);case 13:case 9:case 19:case 17:case 16:case 18:case 24:case 25:case 26:case 27:return r.getField(e,t);case 20:case 23:return null;case 14:case 21:case 22:case 28:return null;default:return Oe(`Unhandled node field ${Tt[t]} in getCppNodeValue`),null}}function eb(r,e,t,n,o){switch(zl(n)){case 0:return r.getBool_SGEO(o);case 1:return r.getDouble_SGEO(o);case 2:return r.getInt_SGEO(o,n);case 3:return r.getString_SGEO(o);case 4:return $C(r.getInt_SGEO(o,n),n);case 5:return r.getAffineTransform_SGEO(o);case 6:return r.getArcData_SGEO(o);case 7:return r.getGUID_SGEO(o);case 8:return r.getStyleId_SGEO(o);case 10:return r.getVector_SGEO(o);case 11:return r.getEffectList_SGEO(o);case 12:return r.getPaintList_SGEO(o);case 15:return r.getParentIndex_SGEO(o);case 13:return r.getPrototypeInteractions_SGEO(o);case 9:case 19:case 17:case 16:case 18:case 24:case 25:case 26:case 27:return r.getField_SGEO(o);case 20:case 23:return null;case 14:case 21:case 22:case 28:return null;default:return Oe(`Unhandled node field ${Tt[n]} in getCppSGEOValue`),null}}function wi(r,e,t,n){let o=ot.serializeValueToKiwiForTests1(t,n),i=o.a,a=o.b;i.guid=ot.encodeGUID(e.id()),R_(i,a)}var Wd=class{constructor(e){this._imagesByNodeId=null,this._nodeIdsByImage=null,e.addAppObserver(this),this._imagesByNodeId=new Map,this._nodeIdsByImage=new eo(t=>t.objectHash())}imagesUsedByNode(e){return Ge.StringMap_get(this._imagesByNodeId,e,new Map)}nodesUsedByImage(e){return Array.from(this._nodeIdsByImage.get(e,new Map).values())}nodesThatUseAnImage(){return Array.from(this._imagesByNodeId.keys())}handleSceneChange(e,t){e!=null&&e.removeObserver(this),t!=null&&t.addObserver(this),this._imagesByNodeId=new Map,this._nodeIdsByImage.clear(),t!=null&&this._addImageNodeReferencesInSubtree(t.root())}handleActiveCanvasChange(e,t){}handleActivePrototypeStartingPointChange(e,t){}_trackImageUse(e,t){this._imagesByNodeId.has(e.id())||this._imagesByNodeId.set(e.id(),new Map),this._imagesByNodeId.get(e.id()).set(t.objectHash(),t),this._nodeIdsByImage._in(t)||this._nodeIdsByImage.set(t,new Map),this._nodeIdsByImage.get(t).set(e.id(),e.id())}_removeImageUse(e,t){Array.from(this._imagesByNodeId.keys()).indexOf(e.id())!=-1&&(this._imagesByNodeId.get(e.id()).delete(t.objectHash()),this._imagesByNodeId.get(e.id()).size==0&&this._imagesByNodeId.delete(e.id())),this._nodeIdsByImage._in(t)&&(this._nodeIdsByImage.get(t).delete(e.id()),this._nodeIdsByImage.get(t).size==0&&this._nodeIdsByImage.remove(t))}handleSceneGraphEvent(e){if(e.property===112)return;let t=zn.affectsImagesUsedByNode(e.property);if(!(!(t||e.property==8||e.property==32)||!(e.node.isVisibleInCanvas()||e.property==8&&Je.asBool(e.oldVal)&&!Je.asBool(e.newVal)&&(e.node.parent()!=null&&e.node.parent().isVisibleInCanvas())))){if(t){let o=e.node.collectUniqueUsedImages(),i=Ge.StringMap_get(this._imagesByNodeId,e.node.id(),new Map);for(let a of Array.from(i.keys()))o.has(a)||this._removeImageUse(e.node,i.get(a));for(let a of Array.from(o.keys()))i.has(a)||this._trackImageUse(e.node,o.get(a))}else if(e.property==8){let o=Je.asBool(e.oldVal)&&(e.node.parent()!=null?e.node.parent().isVisibleInCanvas():!1),i=Je.asBool(e.newVal)&&(e.node.parent()!=null?e.node.parent().isVisibleInCanvas():!1);!o&&i?this._addImageNodeReferencesInSubtree(e.node):o&&!i&&this._removeImageNodeReferencesInSubtree(e.node)}else if(e.property==32){let o=e.oldVal!=null&&Je.isParentIndex(e.oldVal)?Je.asParentIndex(e.oldVal):null,i=e.newVal!=null&&Je.isParentIndex(e.newVal)?Je.asParentIndex(e.newVal):null,a=o!=null?e.node.scene().findNode(o.id):null,s=i!=null?e.node.scene().findNode(i.id):null,l=a!=null&&a.isRooted(),d=s!=null&&s.isRooted();l&&!d?this._removeImageNodeReferencesInSubtree(e.node):!l&&d&&this._addImageNodeReferencesInSubtree(e.node)}}}_removeImageNodeReferencesInSubtree(e){for(let t=0,n=e.childCount();t<n;t=t+1)this._removeImageNodeReferencesInSubtree(e.childAt1(t));e.forEachSinglePaint(t=>{(t.type()=="IMAGE"||t.type()=="EMOJI"||t.type()=="VIDEO")&&(t.image()!=null&&this._removeImageUse(e,t.image()),t.imageThumbnail()!=null&&this._removeImageUse(e,t.imageThumbnail()))}),e.forEachEmojiInTextData(t=>{this._removeImageUse(e,t)})}_addImageNodeReferencesInSubtree(e){if(e.visible()){for(let t=0,n=e.childCount();t<n;t=t+1)this._addImageNodeReferencesInSubtree(e.childAt1(t));e.forEachSinglePaint(t=>{(t.type()=="IMAGE"||t.type()=="EMOJI"||t.type()=="VIDEO")&&(t.image()!=null&&this._trackImageUse(e,t.image()),t.imageThumbnail()!=null&&this._trackImageUse(e,t.imageThumbnail()))}),e.forEachEmojiInTextData(t=>{this._trackImageUse(e,t)})}}};var uh=class{clear(){this._images=[],this._imageByHash=new Map}allImages(){return this._images}appendIfMissing(e){this._imageByHash.has(e.objectHash())||(this._imageByHash.set(e.objectHash(),e),this._images.push(e))}count(){return this._images.length}isEmpty(){return this.count()==0}takeFirst(){let e=this._images.shift();return e&&this._imageByHash.delete(e.objectHash()),e}constructor(){this._images=[],this._imageByHash=new Map}};var ph=class{constructor(e,t,n,o){this._startConditionSeconds=-1,this._endConditionSeconds=-1,this._numSuccesses=0,this._numFailures=0,this._numGIFs=0,this._loadType=e,this._delaySeconds=t,this._startCondition=n,this._endCondition=o}reset(){this._startConditionSeconds=-1,this._endConditionSeconds=-1,this._numSuccesses=0,this._numFailures=0}_hasMetStartCondition(){return this._startConditionSeconds>=0}_hasMetEndCondition(){return this._endConditionSeconds>=0}onFrame(){!this._hasMetStartCondition()&&this._startCondition()&&(this._startConditionSeconds=Me.seconds()),this._hasMetStartCondition()&&!this._hasMetEndCondition()&&this._endCondition()&&(this._endConditionSeconds=Me.seconds()),this._hasMetStartCondition()&&this._hasMetEndCondition()&&Me.seconds()-this._endConditionSeconds>=this._delaySeconds&&(this.trackEvent(),this.reset()),this._hasMetStartCondition()&&this._hasMetEndCondition()&&!this._endCondition()&&(this._endConditionSeconds=-1)}trackSuccess(e){this._hasMetStartCondition()&&(this._numSuccesses=this._numSuccesses+1),e==0&&(this._numGIFs=this._numGIFs+1)}trackFailure(e){this._hasMetStartCondition()&&(this._numFailures=this._numFailures+1),e==0&&(this._numGIFs=this._numGIFs+1)}trackEvent(){Ae.trackEvent("images_loaded",{viewer_mode:Y.getViewerMode(),load_type:this._loadType,num_successes:this._numSuccesses,num_failures:this._numFailures,num_gifs:this._numGIFs,duration_s:this._endConditionSeconds-this._startConditionSeconds,fast_image_decode:Ur.browserSupportsFastImageDecoding()},{forwardToDatadog:!0})}};var Kd=class r{delayBetweenInvalidations(){return Xn||oa?0:Y.useReducedImageLoadingInvalidateDelay()?1:2}constructor(e,t){this._scene=null,this._appState=e,this._previousFileKey="",this._imageResources=new Map,this._emojiResources=new Map,this.MAX_SIMULTANEOUS_PRELOADING=4,this._imageQueue=new p_,this._outboundRequestPriorities=new Map,this._requestsInFlight=0,this._needsUpdate=!1,this._needAllThumbnails=!0,this._newlyLoadedImages=new uh,this._topLevelGuidsNeeded=new Dn,this.onImageLoaded=null,this.lastImageLoadedCallbackTime=0,this._pendingRequestSuccessForImage=new Map,this._pendingRequestFailureForImage=new Map,this._shouldInvestigateNextImageFailure=!0,mn()!==null&&!mn().getImageMemoryStats&&(mn().getImageMemoryStats=()=>{let o=Rr.getMax("WEBGL_TEXTURE (Image)"),i=Rr.getMax("Decoded image data in RAM (MB)");return{vramMaxForImages:o,ramMaxForImages:i}},mn().getNumRequestsInFlight=()=>this._requestsInFlight),this._imageUseTracker=new Wd(e),this._prototypeStructure=e.prototypeStructure(),this._showImageFetchFailureUI=t,e.addAppObserver(this),e.addFrameObserver(this),e.prototypeState().addObserver(this);let n=2.5;this._thumbLoadTracker=new ph("thumbs_loaded",n,()=>this._computeTopImagePriority().type==4,()=>this._computeTopImagePriority().type<4),this._fullsizeImageLoadTracker=new ph("fullsize_images_loaded",n,()=>this._computeTopImagePriority().type>=3,()=>this._computeTopImagePriority().type<3)}handleStateChangeAborted(e){}handleStateChangeCommitted(e,t){}handleStateChangeInitiated(e){var t,n;if(dn.advanceGeneration(),e.oldStateId()==null&&this._onTransitionGraphChange(),this._restartGIFsOnEnteringScreens(e),this.clearUnneededTextures(e),this._needAllThumbnails){let o=(n=(t=this._scene)==null?void 0:t.findNode(e.newStateId()))==null?void 0:n.canvas();this.preloadAllThumbnails(o)}}handleStateChangeRequested(e){}handleFitModeChange(e,t){}handleRestartPrototype(){}clearQueuesAndDecodedDataForAllImages(e){this._imageQueue.clear(),this._clearDecodedDataForAllImagesRecursive(e)}_clearDecodedDataForAllImagesRecursive(e){if(e!=null){this.clearDecodedDataForAllImages(e);for(let t=0,n=e.childCount();t<n;t=t+1){let o=e.childAt1(t);this._clearDecodedDataForAllImagesRecursive(o)}}}clearDecodedDataForAllImages(e){this._appState.isPreloaded||(e.forEachSinglePaint(t=>{if(t.image()==null)return;let n=this._imageUseTracker.nodesUsedByImage(t.image());t.image().freeMemoryForDecodedDataAndTexture()&&n.forEach(o=>{var i,a;(a=(i=this._scene)==null?void 0:i.findNode(o))==null||a.invalidateRenderTreeForSelfAndParents()})}),e.forEachSinglePaint(t=>{if(t.imageThumbnail()==null)return;let n=this._imageUseTracker.nodesUsedByImage(t.imageThumbnail());t.imageThumbnail().freeMemoryForDecodedDataAndTexture()&&n.forEach(o=>{var i,a;(a=(i=this._scene)==null?void 0:i.findNode(o))==null||a.invalidateRenderTreeForSelfAndParents()})}),e.forEachEmojiInTextData(t=>{let n=this._imageUseTracker.nodesUsedByImage(t);t.freeMemoryForDecodedDataAndTexture()&&n.forEach(o=>{var i,a;(a=(i=this._scene)==null?void 0:i.findNode(o))==null||a.invalidateRenderTreeForSelfAndParents()})}))}clearQueuesAndDecodedDataForFullResolutionImages(e){this._imageQueue.clear();let t=this._appState.currentFileKey();e!=null&&this._previousFileKey!=null&&this._previousFileKey.length>1&&t!=this._previousFileKey&&this._clearDecodedDataForFullResolutionImagesRecursive(e),this._previousFileKey=t}_clearDecodedDataForFullResolutionImagesRecursive(e){if(e!=null){this.clearDecodedDataForFullResolutionImages(e);for(let t=0,n=e.childCount();t<n;t=t+1){let o=e.childAt1(t);this._clearDecodedDataForFullResolutionImagesRecursive(o)}}}clearDecodedDataForFullResolutionImages(e){this._appState.isPreloaded||(e.forEachSinglePaint(t=>{var o,i;if(t.image()==null||t.imageThumbnail()!=null&&t.image().objectHash()==t.imageThumbnail().objectHash()||!t.image().isDecoded())return;let n=this._imageUseTracker.nodesUsedByImage(t.image());for(let a of n){let s=(i=(o=this._scene)==null?void 0:o.findNode(a))==null?void 0:i.topLevelAncestor();if(s!=null&&this._topLevelGuidsNeeded._in(s.id()))return}t.image().freeMemoryForDecodedDataAndTexture()&&n.forEach(a=>{var s,l;(l=(s=this._scene)==null?void 0:s.findNode(a))==null||l.invalidateRenderTreeForSelfAndParents()})}),e.forEachEmojiInTextData(t=>{var o,i;let n=this._imageUseTracker.nodesUsedByImage(t);for(let a of n){let s=(i=(o=this._scene)==null?void 0:o.findNode(a))==null?void 0:i.topLevelAncestor();if(s!=null&&this._topLevelGuidsNeeded._in(s.id()))return}t.freeMemoryForDecodedDataAndTexture()&&n.forEach(a=>{var s,l;(l=(s=this._scene)==null?void 0:s.findNode(a))==null||l.invalidateRenderTreeForSelfAndParents()})}))}_restartGIFsOnEnteringScreens(e){var o,i;if(e.newStateId()!=null&&e.newStateId()!=e.oldStateId()){let a=(o=this._scene)==null?void 0:o.findNode(e.newStateId());a!=null&&this._restartGIFsInSubtree(a)}let t=e.newOverlayData(),n=e.oldOverlayData();for(let a=0,s=t.length;a<s;a=a+1)if(a>=n.length||n[a].id!=t[a].id){let l=(i=this._scene)==null?void 0:i.findNode(t[a].id);l!=null&&this._restartGIFsInSubtree(l)}}_restartGIFsInSubtree(e){e.restartGifs(),e.forEachChild(t=>{this._restartGIFsInSubtree(t)})}clearUnneededTextures(e){if(!(this._scene==null||this._appState.isPreloaded)&&this._appState.baseScreenId()!=null){this._topLevelGuidsNeeded=new Dn,this._prototypeStructure.getPrerenderingJobs().forEach(t=>{let n=t.asScreen();n!=null&&this._topLevelGuidsNeeded.add(n.nodeId)}),e.oldStateId()!=null&&this._topLevelGuidsNeeded.add(e.oldStateId()),e.newStateId()!=null&&this._topLevelGuidsNeeded.add(e.newStateId());for(let t of this._imageUseTracker.nodesThatUseAnImage()){let n=this._scene.findNode(X.fromString(t));if(n==null)continue;let o=n.topLevelAncestor();o!=null&&this._topLevelGuidsNeeded._in(o.id())||this.clearDecodedDataForFullResolutionImages(n)}}}handleSceneChange(e,t){e!=null&&this.clearQueuesAndDecodedDataForFullResolutionImages(e.root()),this._scene=t,this._needAllThumbnails=!0,e!=null&&e.removeObserver(this),t!=null&&t.addObserver(this),this._onTransitionGraphChange()}preloadAllThumbnails(e){this._scene==null||e==null||(Ge.StringMap_each(r.getThumbnailsInSubtree(e),(t,n)=>{this._imageQueue.insertOrUpdate(n,dn.OTHER)}),this._needAllThumbnails=!1)}handleActiveCanvasChange(e,t){this.clearQueuesAndDecodedDataForFullResolutionImages(e),this.preloadAllThumbnails(t)}handleActivePrototypeStartingPointChange(e,t){}handleSceneGraphEvent(e){(e.property==74||e.property==72||e.property==32)&&this._onTransitionGraphChange()}resetForRenderingTests(){this._imageQueue.clear(),this._newlyLoadedImages.clear(),this.lastImageLoadedCallbackTime=0}onFrame(){this._needsUpdate&&this._traverseSceneForImages(),!this._newlyLoadedImages.isEmpty()&&Me.seconds()-this.lastImageLoadedCallbackTime>=this.delayBetweenInvalidations()&&(this.lastImageLoadedCallbackTime=Me.seconds(),this._onImagesLoaded()),this._thumbLoadTracker.onFrame(),this._fullsizeImageLoadTracker.onFrame(),this._needsUpdate=!1}_computeTopImagePriority(){let e=dn.OTHER;this._imageQueue.count()>0&&(e=dn.max(e,this._imageQueue.maxPriority().value));for(let t of Array.from(this._outboundRequestPriorities.values()))e=dn.max(e,t);return e}findImageByHexHash(e,t){return t==0?Ge.StringMap_get(this._emojiResources,e,null):Ge.StringMap_get(this._imageResources,e,null)}getImageLoadingProgress(){let e=this._imageResources.size+this._emojiResources.size,t=0;return this._imageResources.forEach(n=>{(n.isDecoded()||n.loadDidFail()&&!n.failureIsRetryable())&&t++}),this._emojiResources.forEach(n=>{(n.isDecoded()||n.loadDidFail()&&!n.failureIsRetryable())&&t++}),{loaded:t,total:e}}static getImagesInSubtree(e){let t=new Map,n=new Map;r._getImagesInSubtree(e,t,n);let o=[];return t.forEach(i=>{o.push(i)}),n.forEach(i=>{o.push(i)}),o}preloadAllImages(){var n;let e=(n=this._appState.scene())==null?void 0:n.root();if(!e)return;let t=r.getImagesInSubtree(e);for(let o of t)this._imageQueue.insertOrUpdate(o,dn.OTHER)}onNewImage(e,t,n){let o=t==0?this._emojiResources:this._imageResources;o.has(e)||(o.set(e,n),this._appState.baseScreenId()==null)||(this._imageQueue.insertOrUpdate(n,dn.OTHER),this._processNextItemFromRenderQueues())}requestImageForRendering(e,t){this._imageQueue.insertOrUpdate(e,t),this._processNextItemFromRenderQueues()}_onImagesLoaded(){if(this.onImageLoaded!=null){if(this._scene!=null)for(let e=0,t=this._newlyLoadedImages.allImages().length;e<t;e=e+1){let n=this._newlyLoadedImages.allImages()[e];for(let o of this._imageUseTracker.nodesUsedByImage(n)){let i=this._scene.findNode(o);i!=null&&this.onImageLoaded(i)}}this._newlyLoadedImages.clear()}}_onTransitionGraphChange(){this._needsUpdate=!0}_traverseSceneForImages(){let e=this._appState.baseScreenId();this._scene!=null&&e!=null&&this._processNextItemFromRenderQueues()}postMessageToPerfTests(e){mn().figmaPerfTesting&&mn().postMessage({name:e,value:0},"*")}incrementRequestsInFlight(e){this._requestsInFlight=this._requestsInFlight+e,Rr.trackNumber("Image requests in flight",this._requestsInFlight),this._requestsInFlight==0&&this.postMessageToPerfTests("IMAGES_FINISHED_LOADING")}_requestImage(e,t,n,o){this._pendingRequestSuccessForImage.has(e.objectHash())||this._pendingRequestSuccessForImage.set(e.objectHash(),[]),this._pendingRequestSuccessForImage.get(e.objectHash()).push(n),this._pendingRequestFailureForImage.has(e.objectHash())||this._pendingRequestFailureForImage.set(e.objectHash(),[]),this._pendingRequestFailureForImage.get(e.objectHash()).push(o),e!=null&&e.state()==1&&this._processNextItemFromRenderQueues(),this._outboundRequestPriorities.set(e.objectHash(),dn.max(t,Ge.StringMap_get(this._outboundRequestPriorities,e.objectHash(),dn.OTHER))),this.incrementRequestsInFlight(1),e.fetchAndDecode(1,i=>{this._thumbLoadTracker.trackSuccess(e.imageType()),this._fullsizeImageLoadTracker.trackSuccess(e.imageType()),this.incrementRequestsInFlight(-1),this._newlyLoadedImages.appendIfMissing(e);let a=this._pendingRequestSuccessForImage.get(e.objectHash())??[];for(let s of a)s(i);this._pendingRequestSuccessForImage.set(e.objectHash(),[]),this._pendingRequestFailureForImage.set(e.objectHash(),[]),this._outboundRequestPriorities.delete(e.objectHash()),this._processNextItemFromRenderQueues()},i=>{if((ja.ImagePriorityType_isOnScreen(t.type)||ja.ImagePriorityType_isPrerender(t.type))&&i==0&&this._shouldInvestigateNextImageFailure){this._shouldInvestigateNextImageFailure=!1;let l=d=>{d==0?(this._showImageFetchFailureUI(),Ae.trackEvent("show_image_failure_ui",{imagePriority:Cd[t.type]})):this._shouldInvestigateNextImageFailure=!0};new po(e.url()).get().then(d=>{l(d.status)},d=>{l(d.status)})}this._thumbLoadTracker.trackFailure(e.imageType()),this._fullsizeImageLoadTracker.trackFailure(e.imageType()),this.incrementRequestsInFlight(-1),this._processNextItemFromRenderQueues();let s=this._pendingRequestFailureForImage.get(e.objectHash())??[];for(let l of s)l(t);this._pendingRequestSuccessForImage.set(e.objectHash(),[]),this._pendingRequestFailureForImage.set(e.objectHash(),[]),this._outboundRequestPriorities.delete(e.objectHash())})}_processNextItemFromRenderQueues(){if(this._requestsInFlight>=this.MAX_SIMULTANEOUS_PRELOADING||this._imageQueue.count()==0)return;let e=this._imageQueue.peek(),t=this._imageQueue.getPriority(e);this._imageQueue.remove(e),this._requestImage(e,t.value,n=>{},n=>{var i;if(n.type==2||n.type==4)for(let a of this._imageUseTracker.nodesUsedByImage(e)){let s=(i=this._scene)==null?void 0:i.findNode(a);s!=null&&s.forEachSinglePaint(l=>{let d=l.imageThumbnail()!=null&&l.imageThumbnail().objectHash()==e.objectHash(),c=l.imageThumbnail()!=null&&l.image()!=null&&l.image().objectHash()==l.imageThumbnail().objectHash();if(d&&!c&&l.image()!=null){let p=e!=null?e.objectHash():null,u=l.image()!=null?l.image().objectHash():null;console.warn(`Failed to fetch thumbnail ${p}; fetching full size image ${u}`);let _=n.type==2?dn.forType(1):n.type==4?dn.forType(3):dn.OTHER;this.requestImageForRendering(l.image(),_)}})}})}hasPendingImages(){return this._needsUpdate||this._requestsInFlight>0||ja.ImagePriorityType_isOnScreen(this._computeTopImagePriority().type)||!this._newlyLoadedImages.isEmpty()}static getThumbnailsInSubtree(e){let t=new Map,n=new Map;return r._getImagesInSubtree(e,t,n),n}static _getImagesInSubtree(e,t,n){e.forEachSinglePaint(o=>{o.image()!=null&&t.set(o.image().objectHash(),o.image()),o.imageThumbnail()!=null&&n.set(o.imageThumbnail().objectHash(),o.imageThumbnail())}),e.forEachEmojiInTextData(o=>{n.set(o.objectHash(),o)});for(let o=0,i=e.childCount();o<i;o=o+1){let a=e.childAt1(o);r._getImagesInSubtree(a,t,n)}}};var Ra;(t=>{function r(n){return n!=-1}t.WeakHandle_isValid=r;function e(n){return n}t.WeakHandle_toInt=e})(Ra||(Ra={}));var _h=class{textAlignHorizontal(){N().prepareCppNodeForAccess(this);let e=N().nodeTsApiGenerated().getTextAlignHorizontal(ee.PROTOTYPE_LIB);return xe().TextAlignHorizontal[e]}setTextAlignHorizontal(e){N().prepareCppNodeForAccess(this);let t=xe().TextAlignHorizontal[e];N().nodeTsApiGenerated().setTextAlignHorizontal(t,ee.PROTOTYPE_LIB)}textAlignVertical(){N().prepareCppNodeForAccess(this);let e=N().nodeTsApiGenerated().getTextAlignVertical(ee.PROTOTYPE_LIB);return xe().TextAlignVertical[e]}setTextAlignVertical(e){N().prepareCppNodeForAccess(this);let t=xe().TextAlignVertical[e];N().nodeTsApiGenerated().setTextAlignVertical(t,ee.PROTOTYPE_LIB)}fontSize(){return N().prepareCppNodeForAccess(this),N().nodeTsApiGenerated().getFontSize(ee.PROTOTYPE_LIB)}setFontSize(e){N().prepareCppNodeForAccess(this);let t=e;N().nodeTsApiGenerated().setFontSize(t,ee.PROTOTYPE_LIB)}visible(){return N().prepareCppNodeForAccess(this),N().nodeTsApiGenerated().getVisible(ee.PROTOTYPE_LIB)}setVisible(e){N().prepareCppNodeForAccess(this);let t=e;N().nodeTsApiGenerated().setVisible(t,ee.PROTOTYPE_LIB)}isBackgroundEnabled(){return N().prepareCppNodeForAccess(this),N().nodeTsApiGenerated().getBackgroundEnabled(ee.PROTOTYPE_LIB)}setIsBackgroundEnabled(e){N().prepareCppNodeForAccess(this);let t=e;N().nodeTsApiGenerated().setBackgroundEnabled(t,ee.PROTOTYPE_LIB)}isMask(){return N().prepareCppNodeForAccess(this),N().nodeTsApiGenerated().getIsMask(ee.PROTOTYPE_LIB)}setIsMask(e){N().prepareCppNodeForAccess(this);let t=e;N().nodeTsApiGenerated().setIsMask(t,ee.PROTOTYPE_LIB)}isMaskOutline_DEPRECATED(){return N().prepareCppNodeForAccess(this),N().nodeTsApiGenerated().getIsMaskOutline_DEPRECATED(ee.PROTOTYPE_LIB)}setIsMaskOutline_DEPRECATED(e){N().prepareCppNodeForAccess(this);let t=e;N().nodeTsApiGenerated().setIsMaskOutline_DEPRECATED(t,ee.PROTOTYPE_LIB)}isInternalOnly(){return N().prepareCppNodeForAccess(this),N().nodeTsApiGenerated().getIsInternalOnly(ee.PROTOTYPE_LIB)}setIsInternalOnly(e){N().prepareCppNodeForAccess(this);let t=e;N().nodeTsApiGenerated().setIsInternalOnly(t,ee.PROTOTYPE_LIB)}isFrameMaskDisabled(){return N().prepareCppNodeForAccess(this),N().nodeTsApiGenerated().getIsFrameClippingDisabled(ee.PROTOTYPE_LIB)}setIsFrameMaskDisabled(e){N().prepareCppNodeForAccess(this);let t=e;N().nodeTsApiGenerated().setIsFrameClippingDisabled(t,ee.PROTOTYPE_LIB)}isResizeToFit(){return N().prepareCppNodeForAccess(this),N().nodeTsApiGenerated().getResizeToFit(ee.PROTOTYPE_LIB)}setIsResizeToFit(e){N().prepareCppNodeForAccess(this);let t=e;N().nodeTsApiGenerated().setResizeToFit(t,ee.PROTOTYPE_LIB)}rectangleCornerRadiiIndependent(){return N().prepareCppNodeForAccess(this),N().nodeTsApiGenerated().getRectangleCornerRadiiIndependent(ee.PROTOTYPE_LIB)}setRectangleCornerRadiiIndependent(e){N().prepareCppNodeForAccess(this);let t=e;N().nodeTsApiGenerated().setRectangleCornerRadiiIndependent(t,ee.PROTOTYPE_LIB)}rectangleCornerToolIndependent(){return N().prepareCppNodeForAccess(this),N().nodeTsApiGenerated().getRectangleCornerToolIndependent(ee.PROTOTYPE_LIB)}setRectangleCornerToolIndependent(e){N().prepareCppNodeForAccess(this);let t=e;N().nodeTsApiGenerated().setRectangleCornerToolIndependent(t,ee.PROTOTYPE_LIB)}borderTopWeight(){return N().prepareCppNodeForAccess(this),N().nodeTsApiGenerated().getBorderTopWeight(ee.PROTOTYPE_LIB)}setBorderTopWeight(e){N().prepareCppNodeForAccess(this);let t=e;N().nodeTsApiGenerated().setBorderTopWeight(t,ee.PROTOTYPE_LIB)}borderBottomWeight(){return N().prepareCppNodeForAccess(this),N().nodeTsApiGenerated().getBorderBottomWeight(ee.PROTOTYPE_LIB)}setBorderBottomWeight(e){N().prepareCppNodeForAccess(this);let t=e;N().nodeTsApiGenerated().setBorderBottomWeight(t,ee.PROTOTYPE_LIB)}borderLeftWeight(){return N().prepareCppNodeForAccess(this),N().nodeTsApiGenerated().getBorderLeftWeight(ee.PROTOTYPE_LIB)}setBorderLeftWeight(e){N().prepareCppNodeForAccess(this);let t=e;N().nodeTsApiGenerated().setBorderLeftWeight(t,ee.PROTOTYPE_LIB)}borderRightWeight(){return N().prepareCppNodeForAccess(this),N().nodeTsApiGenerated().getBorderRightWeight(ee.PROTOTYPE_LIB)}setBorderRightWeight(e){N().prepareCppNodeForAccess(this);let t=e;N().nodeTsApiGenerated().setBorderRightWeight(t,ee.PROTOTYPE_LIB)}borderStrokeWeightsIndependent(){return N().prepareCppNodeForAccess(this),N().nodeTsApiGenerated().getBorderStrokeWeightsIndependent(ee.PROTOTYPE_LIB)}setBorderStrokeWeightsIndependent(e){N().prepareCppNodeForAccess(this);let t=e;N().nodeTsApiGenerated().setBorderStrokeWeightsIndependent(t,ee.PROTOTYPE_LIB)}horizontalConstraint(){N().prepareCppNodeForAccess(this);let e=N().nodeTsApiGenerated().getHorizontalConstraint(ee.PROTOTYPE_LIB);return xe().ConstraintType[e]}setHorizontalConstraint(e){N().prepareCppNodeForAccess(this);let t=xe().ConstraintType[e];N().nodeTsApiGenerated().setHorizontalConstraint(t,ee.PROTOTYPE_LIB)}verticalConstraint(){N().prepareCppNodeForAccess(this);let e=N().nodeTsApiGenerated().getVerticalConstraint(ee.PROTOTYPE_LIB);return xe().ConstraintType[e]}setVerticalConstraint(e){N().prepareCppNodeForAccess(this);let t=xe().ConstraintType[e];N().nodeTsApiGenerated().setVerticalConstraint(t,ee.PROTOTYPE_LIB)}blendMode(){N().prepareCppNodeForAccess(this);let e=N().nodeTsApiGenerated().getBlendMode(ee.PROTOTYPE_LIB);return xe().BlendMode[e]}setBlendMode(e){N().prepareCppNodeForAccess(this);let t=xe().BlendMode[e];N().nodeTsApiGenerated().setBlendMode(t,ee.PROTOTYPE_LIB)}strokeAlign(){N().prepareCppNodeForAccess(this);let e=N().nodeTsApiGenerated().getStrokeAlign(ee.PROTOTYPE_LIB);return xe().StrokeAlign[e]}setStrokeAlign(e){N().prepareCppNodeForAccess(this);let t=xe().StrokeAlign[e];N().nodeTsApiGenerated().setStrokeAlign(t,ee.PROTOTYPE_LIB)}overlayPositionType(){N().prepareCppNodeForAccess(this);let e=N().nodeTsApiGenerated().getOverlayPositionType(ee.PROTOTYPE_LIB);return xe().OverlayPositionType[e]}setOverlayPositionType(e){N().prepareCppNodeForAccess(this);let t=xe().OverlayPositionType[e];N().nodeTsApiGenerated().setOverlayPositionType(t,ee.PROTOTYPE_LIB)}overlayBackgroundInteraction(){N().prepareCppNodeForAccess(this);let e=N().nodeTsApiGenerated().getOverlayBackgroundInteraction(ee.PROTOTYPE_LIB);return xe().OverlayBackgroundInteraction[e]}setOverlayBackgroundInteraction(e){N().prepareCppNodeForAccess(this);let t=xe().OverlayBackgroundInteraction[e];N().nodeTsApiGenerated().setOverlayBackgroundInteraction(t,ee.PROTOTYPE_LIB)}styleType(){N().prepareCppNodeForAccess(this);let e=N().nodeTsApiGenerated().getStyleType(ee.PROTOTYPE_LIB);return xe().StyleType[e]}setStyleType(e){N().prepareCppNodeForAccess(this);let t=xe().StyleType[e];N().nodeTsApiGenerated().setStyleType(t,ee.PROTOTYPE_LIB)}overflowDirection(){N().prepareCppNodeForAccess(this);let e=N().nodeTsApiGenerated().getOverflowDirection(ee.PROTOTYPE_LIB);return xe().ScrollDirection[e]}setOverflowDirection(e){N().prepareCppNodeForAccess(this);let t=xe().ScrollDirection[e];N().nodeTsApiGenerated().setOverflowDirection(t,ee.PROTOTYPE_LIB)}scrollBehavior(){N().prepareCppNodeForAccess(this);let e=N().nodeTsApiGenerated().getScrollBehavior(ee.PROTOTYPE_LIB);return xe().ScrollBehavior[e]}setScrollBehavior(e){N().prepareCppNodeForAccess(this);let t=xe().ScrollBehavior[e];N().nodeTsApiGenerated().setScrollBehavior(t,ee.PROTOTYPE_LIB)}maskType(){N().prepareCppNodeForAccess(this);let e=N().nodeTsApiGenerated().getMaskType(ee.PROTOTYPE_LIB);return xe().MaskType[e]}setMaskType(e){N().prepareCppNodeForAccess(this);let t=xe().MaskType[e];N().nodeTsApiGenerated().setMaskType(t,ee.PROTOTYPE_LIB)}opacity(){return N().prepareCppNodeForAccess(this),N().nodeTsApiGenerated().getOpacity(ee.PROTOTYPE_LIB)}setOpacity(e){N().prepareCppNodeForAccess(this);let t=e;N().nodeTsApiGenerated().setOpacity(t,ee.PROTOTYPE_LIB)}localOpacity(){return N().prepareCppNodeForAccess(this),N().nodeTsApiGenerated().getLocalOpacity(ee.PROTOTYPE_LIB)}setLocalOpacity(e){N().prepareCppNodeForAccess(this);let t=e;N().nodeTsApiGenerated().setLocalOpacity(t,ee.PROTOTYPE_LIB)}backgroundOpacity(){return N().prepareCppNodeForAccess(this),N().nodeTsApiGenerated().getBackgroundOpacity(ee.PROTOTYPE_LIB)}setBackgroundOpacity(e){N().prepareCppNodeForAccess(this);let t=e;N().nodeTsApiGenerated().setBackgroundOpacity(t,ee.PROTOTYPE_LIB)}rectangleTopLeftCornerRadius(){return N().prepareCppNodeForAccess(this),N().nodeTsApiGenerated().getRectangleTopLeftCornerRadius(ee.PROTOTYPE_LIB)}setRectangleTopLeftCornerRadius(e){N().prepareCppNodeForAccess(this);let t=e;N().nodeTsApiGenerated().setRectangleTopLeftCornerRadius(t,ee.PROTOTYPE_LIB)}rectangleTopRightCornerRadius(){return N().prepareCppNodeForAccess(this),N().nodeTsApiGenerated().getRectangleTopRightCornerRadius(ee.PROTOTYPE_LIB)}setRectangleTopRightCornerRadius(e){N().prepareCppNodeForAccess(this);let t=e;N().nodeTsApiGenerated().setRectangleTopRightCornerRadius(t,ee.PROTOTYPE_LIB)}rectangleBottomLeftCornerRadius(){return N().prepareCppNodeForAccess(this),N().nodeTsApiGenerated().getRectangleBottomLeftCornerRadius(ee.PROTOTYPE_LIB)}setRectangleBottomLeftCornerRadius(e){N().prepareCppNodeForAccess(this);let t=e;N().nodeTsApiGenerated().setRectangleBottomLeftCornerRadius(t,ee.PROTOTYPE_LIB)}rectangleBottomRightCornerRadius(){return N().prepareCppNodeForAccess(this),N().nodeTsApiGenerated().getRectangleBottomRightCornerRadius(ee.PROTOTYPE_LIB)}setRectangleBottomRightCornerRadius(e){N().prepareCppNodeForAccess(this);let t=e;N().nodeTsApiGenerated().setRectangleBottomRightCornerRadius(t,ee.PROTOTYPE_LIB)}strokeWeight(){return N().prepareCppNodeForAccess(this),N().nodeTsApiGenerated().getStrokeWeight(ee.PROTOTYPE_LIB)}setStrokeWeight(e){N().prepareCppNodeForAccess(this);let t=e;N().nodeTsApiGenerated().setStrokeWeight(t,ee.PROTOTYPE_LIB)}cornerRadius(){return N().prepareCppNodeForAccess(this),N().nodeTsApiGenerated().getCornerRadius(ee.PROTOTYPE_LIB)}setCornerRadius(e){N().prepareCppNodeForAccess(this);let t=e;N().nodeTsApiGenerated().setCornerRadius(t,ee.PROTOTYPE_LIB)}cornerSmoothing(){return N().prepareCppNodeForAccess(this),N().nodeTsApiGenerated().getCornerSmoothing(ee.PROTOTYPE_LIB)}setCornerSmoothing(e){N().prepareCppNodeForAccess(this);let t=e;N().nodeTsApiGenerated().setCornerSmoothing(t,ee.PROTOTYPE_LIB)}sizeVectorF(){return N().prepareCppNodeForAccess(this),N().nodeTsApiGenerated().getSize(ee.PROTOTYPE_LIB)}setSizeVectorF(e){N().prepareCppNodeForAccess(this);let t=e;N().nodeTsApiGenerated().setSize(t,ee.PROTOTYPE_LIB)}overrideKey(){return N().prepareCppNodeForAccess(this),N().nodeTsApiGenerated().getOverrideKey(ee.PROTOTYPE_LIB)}setOverrideKey(e){N().prepareCppNodeForAccess(this);let t=e;N().nodeTsApiGenerated().setOverrideKey(t,ee.PROTOTYPE_LIB)}overriddenSymbolID(){return N().prepareCppNodeForAccess(this),N().nodeTsApiGenerated().getOverriddenSymbolID(ee.PROTOTYPE_LIB)}stackPaddingLeft(){return N().prepareCppNodeForAccess(this),N().nodeTsApiGenerated().getStackPaddingLeft(ee.PROTOTYPE_LIB)}setStackPaddingLeft(e){N().prepareCppNodeForAccess(this);let t=e;N().nodeTsApiGenerated().setStackPaddingLeft(t,ee.PROTOTYPE_LIB)}stackPaddingTop(){return N().prepareCppNodeForAccess(this),N().nodeTsApiGenerated().getStackPaddingTop(ee.PROTOTYPE_LIB)}setStackPaddingTop(e){N().prepareCppNodeForAccess(this);let t=e;N().nodeTsApiGenerated().setStackPaddingTop(t,ee.PROTOTYPE_LIB)}stackPaddingRight(){return N().prepareCppNodeForAccess(this),N().nodeTsApiGenerated().getStackPaddingRight(ee.PROTOTYPE_LIB)}setStackPaddingRight(e){N().prepareCppNodeForAccess(this);let t=e;N().nodeTsApiGenerated().setStackPaddingRight(t,ee.PROTOTYPE_LIB)}stackPaddingBottom(){return N().prepareCppNodeForAccess(this),N().nodeTsApiGenerated().getStackPaddingBottom(ee.PROTOTYPE_LIB)}setStackPaddingBottom(e){N().prepareCppNodeForAccess(this);let t=e;N().nodeTsApiGenerated().setStackPaddingBottom(t,ee.PROTOTYPE_LIB)}stackSpacing(){return N().prepareCppNodeForAccess(this),N().nodeTsApiGenerated().getStackSpacing(ee.PROTOTYPE_LIB)}setStackSpacing(e){N().prepareCppNodeForAccess(this);let t=e;N().nodeTsApiGenerated().setStackSpacing(t,ee.PROTOTYPE_LIB)}stackReverseZIndex(){return N().prepareCppNodeForAccess(this),N().nodeTsApiGenerated().getStackReverseZIndex(ee.PROTOTYPE_LIB)}setStackReverseZIndex(e){N().prepareCppNodeForAccess(this);let t=e;N().nodeTsApiGenerated().setStackReverseZIndex(t,ee.PROTOTYPE_LIB)}stackCounterSpacing(){return N().prepareCppNodeForAccess(this),N().nodeTsApiGenerated().getStackCounterSpacing(ee.PROTOTYPE_LIB)}setStackCounterSpacing(e){N().prepareCppNodeForAccess(this);let t=e;N().nodeTsApiGenerated().setStackCounterSpacing(t,ee.PROTOTYPE_LIB)}isStateGroup(){return N().prepareCppNodeForAccess(this),N().nodeTsApiGenerated().getIsStateGroup(ee.PROTOTYPE_LIB)}setIsStateGroup(e){N().prepareCppNodeForAccess(this);let t=e;N().nodeTsApiGenerated().setIsStateGroup(t,ee.PROTOTYPE_LIB)}shapeWithTextType(){N().prepareCppNodeForAccess(this);let e=N().nodeTsApiGenerated().getShapeWithTextType(ee.PROTOTYPE_LIB);return xe().ShapeWithTextType[e]}setShapeWithTextType(e){N().prepareCppNodeForAccess(this);let t=xe().ShapeWithTextType[e];N().nodeTsApiGenerated().setShapeWithTextType(t,ee.PROTOTYPE_LIB)}usedAsBaseScreen(){return N().prepareCppNodeForAccess(this),N().nodeTsApiGenerated().getUsedAsBaseScreen(ee.PROTOTYPE_LIB)}setUsedAsBaseScreen(e){N().prepareCppNodeForAccess(this);let t=e;N().nodeTsApiGenerated().setUsedAsBaseScreen(t,ee.PROTOTYPE_LIB)}hasBeenLoaded(){return N().prepareCppNodeForAccess(this),N().nodeTsApiGenerated().getHasBeenLoaded(ee.PROTOTYPE_LIB)}setHasBeenLoaded(e){N().prepareCppNodeForAccess(this);let t=e;N().nodeTsApiGenerated().setHasBeenLoaded(t,ee.PROTOTYPE_LIB)}isSkippedSlide(){return N().prepareCppNodeForAccess(this),N().nodeTsApiGenerated().getIsSkippedSlide(ee.PROTOTYPE_LIB)}setIsSkippedSlide(e){N().prepareCppNodeForAccess(this);let t=e;N().nodeTsApiGenerated().setIsSkippedSlide(t,ee.PROTOTYPE_LIB)}};var ct=class ct extends _h{constructor(e,t,n){super(),this._scene=null,this._id=null,this._scrollingLogic=null,this._handle=0,this._cachedType=null,this._absoluteTransform=yt.FrozenAffineTransform_IDENTITY,this._flags=5,this._cachedChildren=[],this._cachedParent=null,this._isPartOfLoop=!1,this.transitioningFrom=null,this.animatingFrom=null,this.sourceNodeForTransition=null,this._lastParent=null,this._lazyInteractionsMigrationValue=null,this._cachedCanvasSpaceGeometryBounds=Yr.FrozenRect_EMPTY,this._cachedCanvasSpaceRenderedBounds=Yr.FrozenRect_EMPTY,this._cachedCanvasSpaceScrollingBounds=Yr.FrozenRect_EMPTY,this._renderTree=null,this._renderTreeAsBaseScreen=null,this._renderTreeWithoutBackgroundBlurs=null,this._renderTreeForShadowRoot=null,this._renderTreeForShadowDescendant=null,this._renderTreeForKnockoutShadowRoot=null,this._renderTreeForKnockoutShadowDescendant=null,this._overlayCacheKey=null,this._scene=t,this._id=n,this._scrollingLogic=new Xp(this),this._handle=e}handle(){return this._handle}updateAfterPropertyChange(e){e==32?(this.updateDirtyFlagsForPropertyChange(e,this._lastParent),this._lastParent=this.parent()):this.updateDirtyFlagsForPropertyChange(e,null),e==25&&(this._cachedType=null)}linkToParent(e,t){e!=null&&(this._cachedParent=e,this._addFlagsToSelfAndChildren(1),e._cachedChildren.splice(t,0,this),this.updateIsRooted())}unlinkFromParent(){this._cachedParent!=null&&(ne.List_removeOne(this._cachedParent._cachedChildren,this),this._cachedParent=null,this.updateIsRooted())}hasOverflowingContentInScrollDirection(){return this._scrollingLogic.hasOverflowingContentInScrollDirection()}scrollsInPreferredDirection(e){return this._scrollingLogic.scrollsInPreferredDirection(e)}scrollAndClipBoundsBySelfAndAncestors(e,t){return this._scrollingLogic.scrollAndClipBoundsBySelfAndAncestors(e,t)}canvasSpaceScrolledBounds(e){return this._scrollingLogic.canvasSpaceScrolledBounds(e)}canvasSpaceScrolledInteractiveBounds(e){return this._scrollingLogic.canvasSpaceScrolledInteractiveBounds(e)}scrollDirection(){return this._scrollingLogic.scrollDirection()}scrollDirectionWithScrollableContent(){return this._scrollingLogic.scrollDirectionWithScrollableContent()}isFixed(){return this._scrollingLogic.isFixed()}isStandardScrolling(){return this._scrollingLogic.isStandardScrolling()}isStickyScrolling(){return this._scrollingLogic.isStickyScrolling()}defaultScrollOffset(){return this._scrollingLogic.defaultScrollOffset()}canvasSpaceContentBounds(){return this._scrollingLogic.canvasSpaceContentBounds()}nodeSpaceScrollableContentBounds(){return this._scrollingLogic.nodeSpaceScrollableContentBounds()}minScrollOffsetX(){return this._scrollingLogic.minScrollOffsetX()}minScrollOffsetY(){return this._scrollingLogic.minScrollOffsetY()}maxScrollOffsetX(){return this._scrollingLogic.maxScrollOffsetX()}maxScrollOffsetY(){return this._scrollingLogic.maxScrollOffsetY()}hasOverflowingContentInXDirection(){return this._scrollingLogic.hasOverflowingContentInXDirection()}hasOverflowingContentInYDirection(){return this._scrollingLogic.hasOverflowingContentInYDirection()}isSpreadEligibleNode(){return zt.isFrameLike(this.type())?this.isFrameBackgroundVisible()&&this.clipsToBoundingRectangle():zt.isRectOrEllipseLike(this.type())}id(){return this._id}isRooted(){return(2&this._flags)!=0}parent(){return Y.getFeatureFlags().prototype_animate_parent&&this.sourceNodeForTransition&&this.sourceNodeForTransition.parent()&&!this._cachedParent?this.sourceNodeForTransition.parent():this._cachedParent}scene(){return this._scene}isInvisibleOrTransparent(){return!this.visible()||this.opacity()<=0}containerSupportsFillStrokeAndCorners(){return N().prepareCppNodeForAccess(this),N().nodeTsApi().containerSupportsFillStrokeAndCorners(ee.PROTOTYPE_LIB)}fillPaintsToRender(){return this.containerSupportsFillStrokeAndCorners()?this.fillPaints():this.hasNodeProperty(46)&&this.hasNodeProperty(67)?[$.createSolid(this.computedBackgroundColor(),1)]:Se.EMPTY}computedBackgroundColor(){return this.isBackgroundEnabled()?O.multiplyOpacity(this.backgroundColor(),this.backgroundOpacity()):O.TRANSPARENT}isInsideOutlineMask(){return this.isMask()&&(this.isMaskOutline_DEPRECATED()||this.maskType()=="OUTLINE")||(this.parent()!=null?this.parent().isInsideOutlineMask():!1)}isOrInSymbol(){return this.type()=="SYMBOL"?!0:this.parent()!=null?this.parent().isOrInSymbol():!1}isStack(){return N().prepareCppNodeForAccess(this),N().nodeTsApi().getIsStack(ee.PROTOTYPE_LIB)}isInstanceSublayer(){return this.stablePath().guids.length>1}isPrimaryInstance(){return this.stablePath().guids.length==1&&this.isInstance()}isState(){return this.type()=="SYMBOL"&&this.parent()!=null&&this.parent().isStateGroup()}isInstance(){return this.type()=="INSTANCE"}isOrInInstance(){return this.isInstanceSublayer()||this.isPrimaryInstance()}isSymbol(){return this.type()=="SYMBOL"}findContainingPrimaryInstance(){return this.isOrInInstance()?this.scene().findNode(this.stablePath().guids[0]):null}getBackingSymbolParent(){var e;return this.isInstance()?(e=this.scene().findNode(this.symbolID()))==null?void 0:e.parent():null}findNearestAncestorOrSelf(e){let t=this;for(;t!=null&&t.type()!="CANVAS"&&t.type()!="DOCUMENT";){if(t.type()==e)return t;t=t.parent()}return null}findContainingCanvasOrSelf(){let e=this;for(;e!=null;){if(e.type()=="CANVAS")return e;if(e.parent()==null)break;e=e.parent()}return null}constrainsAnchoredChildren(){return zt.isFrameLike(this.type())&&!this.isResizeToFit()}size(){return this._scrollingLogic.nodeSize()}minSize(){return N().prepareCppNodeForAccess(this),N().nodeTsApiGenerated().getMinSize(ee.PROTOTYPE_LIB)}maxSize(){return N().prepareCppNodeForAccess(this),N().nodeTsApiGenerated().getMaxSize(ee.PROTOTYPE_LIB)}prototypeDevice(){return Y.deviceFramesSupported()?this.storedPrototypeDevice():sn.DEFAULT}findContainingCanvasOrParent(){let e=this.parent();for(;e!=null&&e.type()!="CANVAS"&&e.parent()!=null;)e=e.parent();return e}guidPath(){return N().getOverridePath(this)}stablePath(){return N().getStablePath(this)}removeSelfAndSubtree(){N().prepareCppNodeForAccess(this),N().nodeTsApi().removeSelfAndChildren(ee.PROTOTYPE_LIB)}type(){if(this._cachedType==null||this._cachedType=="NONE"){N().prepareCppNodeForAccess(this);let e=N().nodeTsApiGenerated().getType(ee.PROTOTYPE_LIB);this._cachedType=xe().NodeType[e]}return this._cachedType}setType(e){N().prepareCppNodeForAccess(this);let t=xe().NodeType[e];N().nodeTsApiGenerated().setType(t,ee.PROTOTYPE_LIB)}name(){return N().prepareCppNodeForAccess(this),N().nodeTsApi().getName(ee.PROTOTYPE_LIB)}setName(e){N().prepareCppNodeForAccess(this);let t=N().nodeTsApi().setName(e,ee.PROTOTYPE_LIB);t!=""&&Oe(t)}scrollOffset(){N().prepareCppNodeForAccess(this);let e=N().nodeTsApi().getScrollOffset(ee.PROTOTYPE_LIB);return new b(e.x,e.y)}setScrollOffset(e){N().prepareCppNodeForAccess(this);let t=N().nodeTsApi().setScrollOffset({x:e.x(),y:e.y()},ee.PROTOTYPE_LIB);t!=""&&Oe(t)}scrollSpeedMultiplier(){var t;let e=this.behaviors();return((t=e==null?void 0:e.scrollParallax)==null?void 0:t.speed)??1}currentViewportSize(){N().prepareCppNodeForAccess(this);let e=N().nodeTsApi().getCurrentViewportSize(ee.PROTOTYPE_LIB);return new b(e.x,e.y)}setCurrentViewportSize(e){N().prepareCppNodeForAccess(this);let t=N().nodeTsApi().setCurrentViewportSize({x:e.x(),y:e.y()},ee.PROTOTYPE_LIB);t!=""&&Oe(t)}fullSize(){N().prepareCppNodeForAccess(this);let e=N().nodeTsApiGenerated().getSize(ee.PROTOTYPE_LIB);return new b(e.x,e.y)}originalSize(){N().prepareCppNodeForAccess(this);let{x:e,y:t}=N().modules().prototype.getOriginalNodeSize(this.id());return e>0&&t>0?new b(e,t):this.fullSize()}setSize(e){N().prepareCppNodeForAccess(this),this.setSizeVectorF({x:e.x(),y:e.y()})}relativeTransform(){N().prepareCppNodeForAccess(this);let e=N().nodeTsApi().getRelativeTransform(ee.PROTOTYPE_LIB);return new J(e.m00,e.m01,e.m02,e.m10,e.m11,e.m12)}setRelativeTransform(e){N().prepareCppNodeForAccess(this);let t=N().nodeTsApi().setRelativeTransform(e.m00(),e.m01(),e.m02(),e.m10(),e.m11(),e.m12(),ee.PROTOTYPE_LIB);t!=""&&Oe(t)}overlayTransform(){N().prepareCppNodeForAccess(this);let e=N().nodeTsApi().getOverlayTransform(ee.PROTOTYPE_LIB);return new J(e.m00,e.m01,e.m02,e.m10,e.m11,e.m12)}setOverlayTransform(e){N().prepareCppNodeForAccess(this);let t=N().nodeTsApi().setOverlayTransform(e.m00(),e.m01(),e.m02(),e.m10(),e.m11(),e.m12(),ee.PROTOTYPE_LIB);t!=""&&Oe(t)}behaviors(){return N().prepareCppNodeForAccess(this),N().nodeTsApi().getBehaviors(ee.PROTOTYPE_LIB)}setBehavior(e,t){N().prepareCppNodeForAccess(this);let o={...N().nodeTsApi().getBehaviors(ee.PROTOTYPE_LIB)??{},[e]:t};N().nodeTsApi().setBehaviors(o,ee.PROTOTYPE_LIB)}interactiveSlideElementType(){return N().prepareCppNodeForAccess(this),N().nodeTsApi().interactiveSlideElementType(ee.PROTOTYPE_LIB)}interactiveSlideConfigData(){return N().prepareCppNodeForAccess(this),N().nodeTsApi().getInteractiveSlideConfigData(ee.PROTOTYPE_LIB)}setInteractiveSlideConfigData(e,t){return N().prepareCppNodeForAccess(this),N().nodeTsApi().setInteractiveSlideConfigData(e,t,ee.PROTOTYPE_LIB)}interactiveSlideParticipantData(){return N().prepareCppNodeForAccess(this),N().nodeTsApi().getInteractiveSlideParticipantData(ee.PROTOTYPE_LIB)}setInteractiveSlideParticipantData(e,t){return N().prepareCppNodeForAccess(this),N().nodeTsApi().setInteractiveSlideParticipantData(e,t,ee.PROTOTYPE_LIB)}slideSpeakerNotes(){return N().prepareCppNodeForAccess(this),N().nodeTsApi().getSlideSpeakerNotes(ee.PROTOTYPE_LIB)}slideThumbnailHash(){return N().prepareCppNodeForAccess(this),N().nodeTsApi().getSlideThumbnailHash(ee.PROTOTYPE_LIB)}stackMode(){N().prepareCppNodeForAccess(this);let e=N().nodeTsApi().getStackMode(ee.PROTOTYPE_LIB);return xe().StackMode[e]}setStackMode(e){N().prepareCppNodeForAccess(this);let t=xe().StackMode[e];N().nodeTsApi().setStackMode(t,ee.PROTOTYPE_LIB)}arcData(){return N().prepareCppNodeForAccess(this),N().nodeTsApi().getArcData(ee.PROTOTYPE_LIB)}setArcData(e){N().prepareCppNodeForAccess(this);let t=N().nodeTsApi().setArcData(e.startingAngle,e.endingAngle,e.innerRadius,ee.PROTOTYPE_LIB);t!=""&&Oe(t)}backgroundColor(){N().prepareCppNodeForAccess(this);let e=N().nodeTsApi().getBackgroundColor(ee.PROTOTYPE_LIB);return O.new3(e.red,e.green,e.blue,e.alpha)}setBackgroundColor(e){N().prepareCppNodeForAccess(this);let t=N().nodeTsApi().setBackgroundColor(O.toColorF(e),ee.PROTOTYPE_LIB);t!=""&&Oe(t)}prototypeBackgroundColor(){N().prepareCppNodeForAccess(this);let e=N().nodeTsApi().getPrototypeBackgroundColor(ee.PROTOTYPE_LIB);return O.fromColorF(e)}setPrototypeBackgroundColor(e){N().prepareCppNodeForAccess(this);let t={red:O.redF(e),green:O.greenF(e),blue:O.blueF(e),alpha:O.alphaF(e)},n=N().nodeTsApi().setPrototypeBackgroundColor(t,ee.PROTOTYPE_LIB);n!=""&&Oe(n)}parentIndex(){N().prepareCppNodeForAccess(this);let e=N().nodeTsApi().getParentIndex(ee.PROTOTYPE_LIB),t=e.parent;return new Qr(t,e.position)}setParentIndex(e){N().prepareCppNodeForAccess(this);let t={parent:e.id,position:e.position},n=N().nodeTsApi().setParentIndex(t,ee.PROTOTYPE_LIB);n!=""&&Oe(n)}fillPaints(){return N().prepareCppNodeForAccess(this),N().nodeTsApi().getSkewFillPaints(ee.PROTOTYPE_LIB)}textDecorationFillPaints(){return N().prepareCppNodeForAccess(this),N().nodeTsApi().getSkewTextDecorationFillPaints(ee.PROTOTYPE_LIB)}getBoundVariables(){return N().prepareCppNodeForAccess(this),N().nodeTsApi().getBoundVariables(ee.PROTOTYPE_LIB)}getResolvedVariableModes(){return N().prepareCppNodeForAccess(this),N().nodeTsApi().getResolvedVariableModes(ee.PROTOTYPE_LIB)}getResolvedVariableModesForPrototype(){return N().prepareCppNodeForAccess(this),N().nodeTsApi().getResolvedVariableModesForPrototype(ee.PROTOTYPE_LIB)}getResolvedVariableModesWithSetKeys(){return N().prepareCppNodeForAccess(this),N().nodeTsApi().getResolvedVariableModesWithSetKeys(ee.PROTOTYPE_LIB)}getExplicitVariableModes(){return N().prepareCppNodeForAccess(this),N().nodeTsApi().getExplicitVariableModes(ee.PROTOTYPE_LIB)}getExplicitVariableModesWithSetKeys(){return N().prepareCppNodeForAccess(this),N().nodeTsApi().getExplicitVariableModesWithSetKeys(ee.PROTOTYPE_LIB)}setExplicitVariableModeForCollection(e,t){return N().prepareCppNodeForAccess(this),N().nodeTsApi().setExplicitVariableModeForCollection(e,t,ee.PROTOTYPE_LIB)}setExplicitVariableModeForCollectionWithSetKey(e,t){return N().prepareCppNodeForAccess(this),N().nodeTsApi().setExplicitVariableModeForCollectionWithSetKey(e,t,ee.PROTOTYPE_LIB)}clearExplicitVariableConsumerModeForCollection(e){return N().prepareCppNodeForAccess(this),N().nodeTsApi().clearExplicitVariableConsumerModeForCollection(e,ee.PROTOTYPE_LIB)}clearExplicitVariableConsumerModeForCollectionWithSetKey(e){return N().prepareCppNodeForAccess(this),N().nodeTsApi().clearExplicitVariableConsumerModeForCollectionWithSetKey(e,ee.PROTOTYPE_LIB)}setTestOnlyFillPaints(e){Wo("Paint serialization only partially implemented in TS Viewer"),wi(N(),this,61,e)}strokePaints(){return N().prepareCppNodeForAccess(this),N().nodeTsApi().getSkewStrokePaints(ee.PROTOTYPE_LIB)}codeSnapshotPaints(){return N().prepareCppNodeForAccess(this),N().nodeTsApi().getSkewCodeSnapshotPaints(ee.PROTOTYPE_LIB)}setTestOnlyStrokePaints(e){Wo("Paint serialization only partially implemented in TS Viewer"),wi(N(),this,62,e)}effects(){return N().prepareCppNodeForAccess(this),N().nodeTsApi().getSkewEffects(ee.PROTOTYPE_LIB)}setTestOnlyEffects(e){Wo("Effect serialization only partially implemented in TS Viewer"),wi(N(),this,64,e)}symbolID(){return this.isInstance()?(N().prepareCppNodeForAccess(this),N().nodeTsApi().getSymbolId(ee.PROTOTYPE_LIB)):X.invalid()}setTestOnlySymbolData(e){Wo("SymbolData serialization only partially implemented in TS Viewer"),wi(N(),this,78,e)}fillGeometry(){if(!1)return mi(this.canvasSpaceBoundingBox());N().prepareCppNodeForAccess(this);let e=N().nodeTsApi().getFillGeometryRegions(ee.PROTOTYPE_LIB);return N().idlRegionsToGeometry(e,null)}setTestOnlyFillGeometry(e){Wo("Geometry serialization only partially implemented in TS Viewer"),wi(N(),this,76,e)}strokeGeometry(){N().prepareCppNodeForAccess(this);let e=N().nodeTsApi().getStrokeGeometryRegions(ee.PROTOTYPE_LIB);return N().idlRegionsToGeometry(e,null)}setTestOnlyStrokeGeometry(e){Wo("Geometry serialization only partially implemented in TS Viewer"),wi(N(),this,77,e)}textGeometry(){let e=this.textData();if(e==null)return null;N().prepareCppNodeForAccess(this);let t=N().nodeTsApi().getTextGeometryRegions(ee.PROTOTYPE_LIB),n=new So(e.styleOverrideTable());return N().idlRegionsToTextGeometry(t,n)}prototypeInteractions(){N().prepareCppNodeForAccess(this);let e=N().nodeTsApi().getPrototypeInteractions(ee.PROTOTYPE_LIB);return Ra.WeakHandle_isValid(e)?N().modules().prototypeInteractions_Internal.getOrCreateSkewCopy(e):[]}setTestOnlyPrototypeInteractions(e){Wo("PrototypeInteraction[] serialization only partially implemented in TS Viewer"),wi(N(),this,90,e)}objectAnimations(){return N().prepareCppNodeForAccess(this),N().nodeTsApi().getObjectAnimationsSkew(ee.PROTOTYPE_LIB)}setTestOnlyObjectAnimations(e){Wo("PrototypeInteraction[] serialization only partially implemented in TS Viewer"),wi(N(),this,91,e)}getObjectAnimationInteraction(e){return this.objectAnimations().find(n=>n.id()===e.interactionId)??null}getObjectAnimationAction(e){let t=this.getObjectAnimationInteraction(e);if(t==null)return null;let n=t.getAllActions();return 0<=e.actionIndex&&e.actionIndex<n.length?n[e.actionIndex]:null}prototypeStartingPoint(){N().prepareCppNodeForAccess(this);let e=N().nodeTsApi().getPrototypeStartingPoint(ee.PROTOTYPE_LIB);if(e==null)return null;let t=e;return new Ri(t.name,t.description,nr.fromString(t.position))}setPrototypeStartingPoint(e){N().prepareCppNodeForAccess(this);let t={name:e.name,description:e.description,position:nr.toString(e.position)},n=N().nodeTsApi().setPrototypeStartingPoint(t,ee.PROTOTYPE_LIB);n!=""&&Oe(n)}storedPrototypeDevice(){N().prepareCppNodeForAccess(this);let e=N().nodeTsApi().getPrototypeDevice(ee.PROTOTYPE_LIB);if(e==null)return null;let t=e;return new sn(xe().PrototypeDeviceType[t.type],new b(t.size.x,t.size.y),t.presetIdentifier,xe().DeviceRotation[t.rotation])}setPrototypeDevice(e){N().prepareCppNodeForAccess(this);let t={type:xe().PrototypeDeviceType[e.type],size:{x:e.nonRotatedSize.x(),y:e.nonRotatedSize.y()},presetIdentifier:e.presetIdentifier,rotation:xe().DeviceRotation[e.rotation]};N().updatePrototypeDevice(t)}overlayBackgroundAppearance(){N().prepareCppNodeForAccess(this);let e=N().nodeTsApi().getOverlayBackgroundAppearance(ee.PROTOTYPE_LIB);if(e==null)return null;let t=e;return new vi(xe().OverlayBackgroundType[t.backgroundType],O.fromColorF(t.backgroundColor))}setOverlayBackgroundAppearance(e){N().prepareCppNodeForAccess(this);let t={backgroundType:xe().OverlayBackgroundType[e.backgroundType],backgroundColor:O.toColorF(e.backgroundColor)},n=N().nodeTsApi().setOverlayBackgroundAppearance(t,ee.PROTOTYPE_LIB);n!=""&&Oe(n)}textData(){N().prepareCppNodeForAccess(this);let e=N().nodeTsApi().getTextData(ee.PROTOTYPE_LIB);return Ra.WeakHandle_isValid(e)?N().modules().textData_Internal.getOrCreateSkewCopy(e):null}setTestOnlyTextData(e){Wo("TextData serialization only partially implemented in TS Viewer"),wi(N(),this,4,e)}derivedTextData(){N().prepareCppNodeForAccess(this);let e=N().nodeTsApi().getDerivedTextData(ee.PROTOTYPE_LIB);return Ra.WeakHandle_isValid(e)?N().modules().derivedTextData_Internal.getOrCreateSkewCopy(e):null}setTestOnlyDerivedTextData(e){Wo("DerivedTextData serialization only partially implemented in TS Viewer"),wi(N(),this,5,e)}vectorData(){N().prepareCppNodeForAccess(this);let e=N().nodeTsApi().getVectorData(ee.PROTOTYPE_LIB);return Ra.WeakHandle_isValid(e)?N().modules().compiledVectorData_Internal.getOrCreateSkewCopy(e):null}hasDefaultStrokeParameters(){return N().prepareCppNodeForAccess(this),N().nodeTsApi().getHasDefaultStrokeParameters(ee.PROTOTYPE_LIB)}strokeJoin(){switch(N().prepareCppNodeForAccess(this),N().nodeTsApi().getStrokeJoin(ee.PROTOTYPE_LIB)){default:case 0:return"MITER";case 1:return"BEVEL";case 2:return"ROUND"}}setStrokeJoin(e){N().prepareCppNodeForAccess(this);let t=0;switch(e){case"MITER":t=0;break;case"BEVEL":t=1;break;case"ROUND":t=2;break}N().nodeTsApi().setStrokeJoin(t,ee.PROTOTYPE_LIB)}setStrokeMiterLimit(e){N().prepareCppNodeForAccess(this),N().nodeTsApi().setStrokeMiterLimit(e,ee.PROTOTYPE_LIB)}strokeMiterLimit(){return N().prepareCppNodeForAccess(this),N().nodeTsApi().getStrokeMiterLimit(ee.PROTOTYPE_LIB)}videoPlayback(){return N().prepareCppNodeForAccess(this),N().nodeTsApi().getVideoPlayback(ee.PROTOTYPE_LIB)}setVideoPlayback(e){N().prepareCppNodeForAccess(this),N().nodeTsApi().setVideoPlayback(e,ee.PROTOTYPE_LIB)}accessibleLabel(){return N().prepareCppNodeForAccess(this),N().nodeTsApi().getAccessibleLabel(ee.PROTOTYPE_LIB)}hasNodeProperty(e){return N().hasNodeProperty(this,e)}get(e,t=null){let n=dh(N(),this,e);return n??t}getSerializedPropertyForTests(e){let t;switch(e){case"effects":{t=64;break}case"fillPaints":{t=61;break}case"strokePaints":{t=62;break}case"prototypeInteractions":case"objectAnimations":{t=90;break}default:throw"unknown property name in getSerializedPropertyForTests"+e}return ot.serializeValueToKiwiForTests1(t,this.get(t)).a[e]}each(e){N().forEachField(this,t=>{e(t,this.get(t))})}isVisibleInCanvas(){return N().prepareCppNodeForAccess(this),N().nodeTsApi().isVisibleInCanvas(ee.PROTOTYPE_LIB)}supportsBackgroundPaints(){return zt.isFrameLike(this.type())&&!this.containerSupportsFillStrokeAndCorners()}supportsGeometry(){return zt.isGeometryLeaf(this.type())||zt.isFrameLike(this.type())&&this.containerSupportsFillStrokeAndCorners()}findPrototypeInteraction(e){if(e==null)return null;let t=this.prototypeInteractions().filter(n=>X.equals(n.id(),e));return t.length==0?null:(t.length>1&&Oe("Found multiple prototype interactions with the same GUID"),t[0])}updateDirtyFlagsForPropertyChange(e,t){this._handlePropertyChangeForTransform(e),this._handlePropertyChangeForBounds(e,t),this._handlePropertyChangeForRenderTree(e,t),this._handlePropertyChangeForInteractions(e)}_handlePropertyChangeForTransform(e){if((e==99||e==30||e==69||e==42||e==100)&&this._addFlagsToSelfAndChildren(1),e==26||e==27){let t=this;for(;t!=null&&!(t.isFixed()||t.hasOwnConstraintValues());)t=t.parent();t!=null&&t.isFixed()&&t.dirtyTransform()}}_handlePropertyChangeForInteractions(e){zn.isInteractionProperty(e)&&(this._lazyInteractionsMigrationValue=null)}map(e){return this._cachedChildren.map(e)}forEachChild(e,t=!1){for(let n=0;n<this._cachedChildren.length;n++)e(this.childAt2(n,t))}forEachDescendantPreorder(e){this._cachedChildren.forEach(t=>{e(t),t.forEachDescendantPreorder(e)})}children(){return this._cachedChildren}childCount(){return this._cachedChildren.length}childAt1(e){return this.childAt2(e,!1)}childAt2(e,t){return t&&this.stackReverseZIndex()&&this.isStack()?this._cachedChildren[this.childCount()-e-1]:this._cachedChildren[e]}indexInParent(){if(this._cachedParent==null)return-1;let e=this._cachedParent._cachedChildren.indexOf(this);return this._cachedParent.stackReverseZIndex()&&this._cachedParent.isStack()&&(e=this._cachedParent.childCount()-e-1),e}updateIsRooted(){let e=this._cachedParent!=null?this._cachedParent.isRooted():this==this._scene.root();if(e!=this.isRooted()){this._flags=e?this._flags|2:this._flags&-3,e&&this._addFlagsToSelfAndChildren(1);for(let t of this._cachedChildren)t.updateIsRooted()}}appendChild(e){let t=this._cachedChildren.length==0?nr.FIRST_POSITION:nr.after(ne.List_last(this._cachedChildren).parentIndex().position);e.setParentIndex(new Qr(this.id(),t))}collectUniqueUsedImages(){let e=new Map;return this.forEachSinglePaint(t=>{(t.type()=="IMAGE"||t.type()=="EMOJI"||t.type()=="VIDEO")&&(t.image()!=null&&e.set(t.image().objectHash(),t.image()),t.imageThumbnail()!=null&&e.set(t.imageThumbnail().objectHash(),t.imageThumbnail()))}),this.forEachEmojiInTextData(t=>{e.set(t.objectHash(),t)}),e}forEachSinglePaint(e){var n,o;let t=i=>{let a=i.asVolatilePaint();a!=null&&(e(a.from()),e(a.to()));let s=i.asSinglePaint();s!=null&&e(s)};this.fillPaints().forEach(t),this.strokePaints().forEach(t),this.codeSnapshotPaints().forEach(t),(o=(n=this.textData())==null?void 0:n.styleOverrideTable())==null||o.forEachFillPaint(this.scene(),i=>{i.forEach(t)}),this.hasPerRegionFillPaints()&&this.forEachRegionWithFillPaintBatch((i,a)=>{a.forEach(t)})}forEachEmojiInTextData(e){var t,n;this._cachedType=="TEXT"&&((n=(t=this.derivedTextData())==null?void 0:t.usedEmojiImages())==null||n.forEach(o=>{e(o)}))}textHyperlinkBoxes(){var e;return this._cachedType!="TEXT"?[]:((e=this.derivedTextData())==null?void 0:e.hyperlinkBoxes())??[]}textHasMixedFontSizes(){return this._cachedType!="TEXT"||this.textData()==null||this.textData().fontSizes()===null?!1:this.textData().fontSizes()==="mixed"?!0:(N().prepareCppNodeForAccess(this),this.textData().fontSizes()!=N().nodeTsApiGenerated().getFontSize(ee.PROTOTYPE_LIB))}restartGifs(){this.forEachSinglePaint(e=>{let t=e.image();if(t==null||!t.isGIF())return;let n=t.gif();n!=null&&n.restart()})}clipsToBoundingRectangle(){return zt.isFrameLike(this.type())&&!this.isFrameMaskDisabled()&&!this.isResizeToFit()}isAxisAligned(){let t=this.absoluteTransform();return Math.abs(t.m00())<1e-4&&Math.abs(t.m11())<1e-4||Math.abs(t.m01())<1e-4&&Math.abs(t.m10())<1e-4}isAxisAlignedRectFill(){return this.fillGeometry()!=null&&this.fillPaints().length!=0&&this.strokePaints().length==0&&this.fillGeometry().isRect()&&this.isAxisAligned()}isInSymbol(){let e=!1;for(let t=this;t!=null;t=t.parent())if(t.type()=="SYMBOL"){e=!0;break}return e}_addScrollableChildFramesToListRecursive(e){for(let t of this._cachedChildren)t.scrollDirection()!="NONE"&&e.push(t),t._addScrollableChildFramesToListRecursive(e)}scrollableFrameDescendants(){let e=[];return this._addScrollableChildFramesToListRecursive(e),e}isGroup(){return zt.isFrameLike(this.type())&&this.isResizeToFit()}hasOwnConstraintValues(){return this.type()!="BOOLEAN_OPERATION"&&this.type()!="CANVAS"&&this.type()!="DOCUMENT"&&!this.isGroup()}_collectConstraintValuesInSubtree(e){let t=null;return yn(this,n=>{if(!n.hasOwnConstraintValues())return 0;let o=e(n);if(t==null)t=new ce(o);else if(t.value!=o)return t=null,1;return 2}),t}horizontalConstraintOfSubtree(){return this._collectConstraintValuesInSubtree(e=>e.horizontalConstraint())}verticalConstraintOfSubtree(){return this._collectConstraintValuesInSubtree(e=>e.verticalConstraint())}_withOverriddenFrameRole(e,t){this._scrollingLogic.overrideRole(e),this._addFlagsToSelfAndChildren(1),this._invalidateRenderTreeForSelf();for(let n=0,o=this.childCount();n<o;n=n+1){let i=this.childAt1(n);i.isFixed()&&yn(i,a=>{a._invalidateRenderTreeForSelf()})}t(),this._scrollingLogic.clearRoleOverride()}actingAsOverlayOrSublayerForRendertreeGeneration(e){this._withOverriddenFrameRole(1,e)}actingAsBaseScreenForRendertreeGeneration(e){this._withOverriddenFrameRole(0,e)}_translateFixedElementIfNecessary(e){if(!this.isFixed()||this.parent()==null||this.parent().scrollDirection()=="NONE")return;let t=this.parent();if(ln.scrollsHorizontally(t.scrollDirection())){let n=this.horizontalConstraintOfSubtree();n!=null&&(n.value=="MAX"?e.translate2(t.size().x()-t.fullSize().x(),0):n.value=="CENTER"&&e.translate2((t.size().x()-t.fullSize().x())/2,0))}if(ln.scrollsVertically(t.scrollDirection())){let n=this.verticalConstraintOfSubtree();n!=null&&(n.value=="MAX"?e.translate2(0,t.size().y()-t.fullSize().y()):n.value=="CENTER"&&e.translate2(0,(t.size().y()-t.fullSize().y())/2))}}hasPerRegionFillPaints(){if(this.type()!="VECTOR"||this.fillGeometry()==null)return!1;let e=this.fillGeometry().styleIDs;return e==null?!1:e.some(t=>t!=0)}forEachRegionWithFillPaintBatch(e){var i;let t=this.fillGeometry(),n=(i=this.vectorData())==null?void 0:i.paintOverrides,o=this.fillPaints();if(!(n==null||t==null))for(let a=0;a<t.regions.length;a=a+1){let s=o;if(a<t.styleIDs.length){let d=t.styleIDs[a],c=n.get(d,this.scene());c!=null&&(s=c)}let l=t.regions[a];e(l,s)}}relativeTransformAccountingForFixedOffset(){let e=this.relativeTransform().clone();return this._translateFixedElementIfNecessary(e),e}absoluteTransform(){if(this.isRooted()&&1&this._flags){let e=this.relativeTransformAccountingForFixedOffset();if(this._cachedParent!=null){let t=this._cachedParent.absoluteTransform().clone();t.multiply(e),e=t}this._absoluteTransform=e,this._flags&=-2}return this._absoluteTransform}dirtyTransform(){this._addFlagsToSelfAndChildren(1),this._addFlagsToSelfAndChildren(4)}copyNodeCachedTransformAndBounds(e){this._absoluteTransform=e._absoluteTransform,this._cachedCanvasSpaceGeometryBounds=e._cachedCanvasSpaceGeometryBounds,this._cachedCanvasSpaceRenderedBounds=e._cachedCanvasSpaceRenderedBounds,this._cachedCanvasSpaceScrollingBounds=e._cachedCanvasSpaceScrollingBounds,Y.getFeatureFlags().prototype_animate_parent&&(this.sourceNodeForTransition=e)}_addFlagsToParents(e){this.parent()!=null&&this.parent()._addFlagsToSelfAndParents(e)}_addFlagsToSelfAndParents(e){for(let t=this;t!=null;t=t.parent())t._flags|=e}_addFlagsToSelfAndChildren(e){this._flags|=e;for(let t of this._cachedChildren)t._addFlagsToSelfAndChildren(e)}isFrameBackgroundVisible(){if(!zt.isFrameLike(this.type()))return!1;let e=this.containerSupportsFillStrokeAndCorners()?this.fillPaints():null;if(e==null)return O.alpha(this.computedBackgroundColor())>0;for(let t=0,n=e.length;t<n;t=t+1)if(e[t].isEnabledAndVisible())return!0;return!1}hasBackgroundBlurs(){if(this.effects().filter(t=>t.type()=="BACKGROUND_BLUR").length>0)return!0;let e=!1;return this.forEachChild(t=>{t.hasBackgroundBlurs()&&(e=!0)}),e}hasNonZeroStrokeWeight(){return N().prepareCppNodeForAccess(this),N().nodeTsApi().getHasNonZeroStrokeWeight(ee.PROTOTYPE_LIB)}styleId(){return N().prepareCppNodeForAccess(this),N().nodeTsApi().styleId(ee.PROTOTYPE_LIB)}inheritedStyleId(e){return N().prepareCppNodeForAccess(this),N().nodeTsApi().inheritedStyleId(e,ee.PROTOTYPE_LIB)}setInheritStyleId(e,t){return N().prepareCppNodeForAccess(this),N().nodeTsApi().setInheritStyleId(e,t,ee.PROTOTYPE_LIB)}setStyleSortPosition(e){return N().prepareCppNodeForAccess(this),N().nodeTsApi().setStyleSortPosition(e,ee.PROTOTYPE_LIB)}tableCellRowId(){return N().prepareCppNodeForAccess(this),N().nodeTsApi().tableCellColumnId(ee.PROTOTYPE_LIB)}tableCellColumnId(){return N().prepareCppNodeForAccess(this),N().nodeTsApi().tableCellColumnId(ee.PROTOTYPE_LIB)}getTableCellAt(e,t){N().prepareCppNodeForAccess(this);let n=N().nodeTsApi().getTableCellGuid(ee.PROTOTYPE_LIB,e,t);return this._scene.findNode(n)}canvasSpaceGeometryBounds(){return this._updateBoundsIfNeeded(),this._cachedCanvasSpaceGeometryBounds}canvasSpaceRenderedBounds(){return this._updateBoundsIfNeeded(),this._cachedCanvasSpaceRenderedBounds}canvasSpaceScrollingBounds(){return this._updateBoundsIfNeeded(),this._cachedCanvasSpaceScrollingBounds}canvasSpaceInteractiveBounds(){let e=this.fillOrTextGeometry(),t=this.strokeGeometry(),n=G.new2(),o=this.size();n.setTo1(0,0,o.x(),o.y());let i=new ht;i.include3(n),e!=null&&i.include3(e.bounds),t!=null&&this.strokeAlign()!="INSIDE"&&i.include3(t.bounds);let a=i.build();return a.transformInto1(a,this.absoluteTransform()),a}canvasSpacePreviewBounds(){let e=this.strokeGeometry(),t=this.fullSize();Y.getFeatureFlags().viewer_ensure_nonzero_preview_bounds&&(t=t.max(new b(Number.EPSILON,Number.EPSILON)));let n=new ht;n.include3(new G(0,0,t.x(),t.y())),e!=null&&this.strokeAlign()!="INSIDE"&&n.include3(e.bounds);let o=n.build();if(o.transformInto1(o,this.absoluteTransform()),this._scrollingLogic.shouldResizeToFitViewport()){let i=this.parent().prototypeDevice(),a=i.type=="NONE"||i.type=="PRESENTATION"?this.parent().currentViewportSize():i.size(),s=this.findContainingCanvasOrParent();if(i=s.prototypeDevice(),a=i.type=="NONE"||i.type=="PRESENTATION"?s.currentViewportSize():i.size(),!o.size().min(a).equals(o.size())){let l=G.new4(this.canvasSpaceBoundingBox().topLeft(),a);o.intersectWith(l)}}return o}canvasSpaceBoundingBox(){let e=G.new2(),t=this.size();return e.setTo1(0,0,t.x(),t.y()),e.transformInto1(e,this.absoluteTransform()),e}fullSizeCanvasSpaceBoundingBox(){let e=G.new2(),t=this.originalSize();return e.setTo1(0,0,t.x(),t.y()),e.transformInto1(e,this.absoluteTransform()),e}_updateBoundsIfNeeded(){if(!this.isRooted()||!(4&this._flags))return;for(let n of this._cachedChildren)n._updateBoundsIfNeeded();ct._geometryBuilder.reset(),ct._renderedBuilder.reset(),ct._scrollingBuilder.reset(),ct._effectBuilder.reset();let e=0,t=this.effects();for(let n=0,o=t.length;n<o;n=n+1){let i=t[n];i.isEnabledAndVisible()&&i.type()=="FOREGROUND_BLUR"&&(e+=i.blurRadius())}e>0&&(ct._effectBuilder.include1(-e,-e),ct._effectBuilder.include1(e,e));for(let n=0,o=t.length;n<o;n=n+1){let i=t[n];if(i.isEnabledAndVisible()&&i.type()=="DROP_SHADOW"){let a=e+i.blurRadius()+i.spread();ct._effectBuilder.include1(i.blurOffset().x()-a,i.blurOffset().y()-a),ct._effectBuilder.include1(i.blurOffset().x()+a,i.blurOffset().y()+a)}}if(zt.isGeometryLeaf(this.type())){let n=this.fillOrTextGeometry(),o=this.strokeGeometry(),i=this.absoluteTransform();n!=null&&ct._geometryBuilder.include4(n.bounds,i),o!=null&&(this.strokeAlign()!="INSIDE"||n==null||n.regions.length==0||n.bounds.isInvalid())&&ct._geometryBuilder.include4(o.bounds,i)}else for(let n of this._cachedChildren)n.isInvisibleOrTransparent()||(ct._geometryBuilder.include3(n._cachedCanvasSpaceGeometryBounds),ct._renderedBuilder.include3(n._cachedCanvasSpaceRenderedBounds)),n.visible()&&ct._scrollingBuilder.include3(n._cachedCanvasSpaceScrollingBounds);if(zt.isFrameLike(this.type())){let n=this.canvasSpaceBoundingBox();if(this.clipsToBoundingRectangle()){let o=ct._geometryBuilder.build(),i=ct._renderedBuilder.build(),a=ct._scrollingBuilder.build();o.intersectWith(n),i.intersectWith(n),a.intersectWith(n),ct._geometryBuilder.reset(),ct._renderedBuilder.reset(),ct._scrollingBuilder.reset(),ct._geometryBuilder.include3(o),ct._renderedBuilder.include3(i),ct._scrollingBuilder.include3(a)}if(this.containerSupportsFillStrokeAndCorners()){let o=this.fillOrTextGeometry(),i=this.strokeGeometry(),a=this.absoluteTransform();o!=null&&ct._geometryBuilder.include4(o.bounds,a),i!=null&&(this.strokeAlign()!="INSIDE"||o==null||o.regions.length==0||o.bounds.isInvalid())&&ct._geometryBuilder.include4(i.bounds,a)}(this.isFrameBackgroundVisible()||this.parent()!=null&&this.parent().type()=="CANVAS"&&this.clipsToBoundingRectangle())&&(ct._geometryBuilder.include3(n),ct._renderedBuilder.include3(n)),ct._scrollingBuilder.include3(n)}this._cachedCanvasSpaceGeometryBounds=ct._geometryBuilder.build(),ct._renderedBuilder.include3(this._cachedCanvasSpaceGeometryBounds),ct._scrollingBuilder.include3(this._cachedCanvasSpaceGeometryBounds),ct._effectBuilder.isValidOrZeroArea()&&(ct._effectBuilder.buildTo(ct._effectBounds),ct._renderedBuilder.include3(ct._applyEffectSpread(this._cachedCanvasSpaceGeometryBounds,ct._effectBounds)),ct._scrollingBuilder.include3(ct._applyEffectSpread(this._cachedCanvasSpaceGeometryBounds,ct._effectBounds))),this._cachedCanvasSpaceRenderedBounds=ct._renderedBuilder.build(),this._cachedCanvasSpaceScrollingBounds=ct._scrollingBuilder.build(),this._flags&=-5}_handlePropertyChangeForBounds(e,t){switch(e){case 28:case 26:case 27:case 12:case 59:case 78:case 65:case 33:case 73:case 35:case 56:case 17:case 36:case 68:case 69:case 72:case 54:case 74:case 18:case 55:case 34:case 37:case 98:break;case 67:case 8:{this._addFlagsToParents(4);break}default:{this._addFlagsToParents(4),this._addFlagsToSelfAndChildren(4),e==32&&t!=null&&t._addFlagsToSelfAndParents(4);break}}}developerFriendlyId(){if(this.type()=="TABLE_CELL"){let n=this.parent();return n==null?(console.error("Orphaned table cell"),null):"T"+[n.id(),this.tableCellRowId(),this.tableCellColumnId()].map(i=>i).join(";")}if(!this.isInstanceSublayer())return this.id();let e=this;for(;e!=null&&!e.isPrimaryInstance();)e=e.parent();return e==null?(console.error("Unable to find primary instance backing node"),null):"I"+this.stablePath().guids.map(n=>n).join(";")}fillOrTextGeometry(){return this.type()=="TEXT"?this.textGeometry():this.fillGeometry()}fillRegionPaints(){return ct._computeRegionPaintsFromStyles(this.fillOrTextGeometry(),this.fillPaints(),this.scene())}strokeRegionPaints(){return ct._computeRegionPaintsFromStyles(this.strokeGeometry(),this.strokePaints(),this.scene())}hasMoreThanOneCornerRadius(){let e=this.rectangleTopLeftCornerRadius();return this.rectangleTopRightCornerRadius()!=e||this.rectangleBottomLeftCornerRadius()!=e||this.rectangleBottomRightCornerRadius()!=e}isRoundedRect(){return this.type()=="RECTANGLE"||this.type()=="ROUNDED_RECTANGLE"||this.type()=="STAMP"||zt.isFrameLike(this.type())}roundedRectInfo(){return this._instantiateRoundedRect()}_instantiateRoundedRect(){if(this.rectangleCornerRadiiIndependent()){let e=[this.rectangleTopLeftCornerRadius(),this.rectangleTopRightCornerRadius(),this.rectangleBottomRightCornerRadius(),this.rectangleBottomLeftCornerRadius()];return new da(1,fe.FrozenVector_ZERO,this.size(),e,this.cornerSmoothing())}else return new da(0,fe.FrozenVector_ZERO,this.size(),this.cornerRadius(),this.cornerSmoothing())}fillGeometryForSpread(e,t,n){let o=null;if(this.type()=="ELLIPSE"){let i={m00:e.m00(),m01:e.m01(),m02:e.m02(),m10:e.m10(),m11:e.m11(),m12:e.m12()},a=N().getFillGeometryForSpread(i,t,this);o=new no(a)}else{let i=this._instantiateRoundedRect();i.transform(e),i.adjustCornerRadiiForSpread(t),o=St.fromRoundedRect(i)}return new wt(new Et(o,"NONZERO"),n)}strokeGeometryForSpread(e,t,n,o){let i=null,a=this.strokeAlign()=="INSIDE"?2:this.strokeAlign()=="CENTER"?1:0,s=!n.subtractScalar(2*t+a*this.strokeWeight()).isPositive(),l=2-a;if(Se.containsAtLeastOneVisiblePaint(this.fillPaints())||s){let d=J.new2(),p=n.addScalar(this.strokeWeight()*l).addScalar(2*t).divide(n),u=-t-this.strokeWeight()*l/2;if(d.translate2(u,u),d.scale3(p),this.type()=="ELLIPSE"){let _=new G(0,0,this.size().x(),this.size().y());d.transformRect(_),i=Rt.forEllipse(_)}else{let _=this._instantiateRoundedRect();_.transform(d),i=Rt.fromRoundedRectWithSpread(_,t+l*this.strokeWeight()/2)}}else{if(this.strokeWeight()+2*t<=0)return null;if(this.type()=="ELLIPSE"){let d=G.new4(fe.FrozenVector_ZERO,this.size());e.transformRect(d),d.expand1(l*this.strokeWeight()/2),i=Rt.forEllipse(d),d.contract(2*t+this.strokeWeight()),i.append(Rt.forEllipse(d))}else{let d=this._instantiateRoundedRect();d.transform(e),d.expand(l*this.strokeWeight()/2),i=Rt.fromRoundedRectWithSpread(d,t+l*this.strokeWeight()/2),d.contract(2*t+this.strokeWeight()),i.append(Rt.fromRoundedRectWithSpread(d,-(2*t+this.strokeWeight())))}}return new wt(new Et(i,"ODD"),o)}isTopLevel(){return this.parent()!=null&&this.parent().isTopLevelParent()}isTopLevelParent(){return ct.isTopLevelParentNodeType(this.type())}static isTopLevelParentNodeType(e){return e=="CANVAS"||e=="SECTION"||e=="SLIDE_ROW"||e=="SLIDE_GRID"||e=="MODULE"}topLevelAncestor(){let e=this;for(;e!=null;){if(e.isTopLevel())return e;e=e.parent()}return null}isSlideModule(){return this.type()=="MODULE"&&this.childCount()==1&&this.childAt1(0).type()=="SLIDE"}canvas(){if(this.type()=="CANVAS")return this;let e=this.findContainingCanvasOrParent();return(e==null?void 0:e.type())=="CANVAS"?e:null}isAncestorOf(e){for(let t=e;t!=null;t=t.parent())if(t==this)return!0;return!1}forSelfAndAncestors(e){for(let t=this;t!=null;t=t.parent())e(t)}findContainingStateGroupOrSelf(){for(let e=this;e!=null;e=e.parent())if(e.isStateGroup())return e;return null}findContainingScrollingFrameOrSelf(){for(let e=this;e!=null;e=e.parent())if(e.scrollDirection()!="NONE"&&!e.isTooRotatedToScroll())return e;return null}findContainingInstanceOrSelf(){for(let e=this;e!=null;e=e.parent())if(e.type()=="INSTANCE")return e;return null}findAllSectionsInNode(){let e=this,t=[];t.push(e);let n=[];for(;t.length>0;){let o=t.shift();for(let i=0,a=o.childCount();i<a;i=i+1){let s=o.childAt1(i);s!=null&&s.type()=="SECTION"&&(t.push(s),n.push(s))}}return n}findAllTopLevelNodesInNode(e){let t=[];if(e.type()!="CANVAS"&&e.type()!="SECTION")return t;let n=[];for(n.push(e);n.length>0;){let o=n.shift();for(let i=0,a=o.childCount();i<a;i=i+1){let s=o.childAt1(i);s.type()=="SECTION"&&n.push(s),t.push(s)}}return t}buildAncestors(){let e=[];return this.forSelfAndAncestors(t=>{e.push(t)}),e.reverse(),e}isAboveInLayerOrder(e){let t=this.buildAncestors(),n=e.buildAncestors();for(let o=0,i=Math.min(t.length,n.length);o<i;o=o+1)if(t[o]!=n[o]){let a=t[o],s=n[o];return a.indexInParent()>s.indexInParent()}return t.length==n.length?!1:t.length>n.length}isTooRotatedToScroll(){return Math.abs(this.absoluteTransform().toAngle())>=Math.PI/180}debugString(){let e="";if(e+=this.hierarchyString()+`

`,this.type()=="INSTANCE"){let t=`stablePath: ${this.stablePath()}`;e+=t+`

`}return e+=`{
`,this.each((t,n)=>{e+=`  ${Tt[t]}: ${Je.toString(n)}
`}),e+="}",e+=`

`,e}paintsDebugString(){let e=this.strokePaints().some(t=>t.isEnabledAndVisible())?` strokeAlign=${this.strokeAlign()} weight=${this.strokeWeight()}`:"";return`Node type=${this.type()} size=${this.size()}
 -- fills=[${this.fillPaints().map(t=>t.debugString()).join(", ")}]
 -- strokes=[${this.strokePaints().map(t=>t.debugString()).join(", ")}]`+e}_makeIndent(e,t){let o="";if(t){for(let i=0,a=2*(e-1);i<a;i=i+1)o+="-";return o+="> ",o}else{for(let i=0,a=2*e;i<a;i=i+1)o+=" ";return o}}hierarchyString(){let e=[],t=this._hierarchyStringForAncestors(e);return t==0&&(e.push("(null parent)"),t=t+1),this._hierarchyStringWithChildren(t,!0,e),e.join(`
`)}_hierarchyStringLocal(e,t){let n=this._makeIndent(e,t);return n+=`${this.type()}: '${this.name()??"null"}' (${this.id()})`,(this.isInstanceSublayer()||this.isPrimaryInstance())&&(n+=` stablePath: ${this.stablePath()}`),this.isInSymbol()&&(n+=` (overrideKey: ${this.overrideKey()})`),this.type()=="INSTANCE"&&(n+=` (symbol: ${this.symbolID()??"null"})`),n+=` hasBeenLoaded: ${this.hasBeenLoaded()?"\u2714":"\u25FB\uFE0F"}`,n}_hierarchyStringForAncestors(e){let t=0,n=[];for(this.forSelfAndAncestors(o=>{o!=this&&n.push(o)});n.length>0;)e.push(n.pop()._hierarchyStringLocal(t,!1)),t=t+1;return t}_hierarchyStringWithChildren(e,t,n){n.push(this._hierarchyStringLocal(e,t));for(let o=0,i=this.childCount();o<i;o=o+1)this.childAt1(o)._hierarchyStringWithChildren(e+1,!1,n)}_invalidateRenderTreeForSelf(){this._renderTree=null,this._renderTreeAsBaseScreen=null,this._renderTreeWithoutBackgroundBlurs=null,this._renderTreeForShadowRoot=null,this._renderTreeForShadowDescendant=null,this._renderTreeForKnockoutShadowRoot=null,this._renderTreeForKnockoutShadowDescendant=null}invalidateRenderTreeForSelfAndParents(){for(let e=this;e!=null;e=e.parent())e._invalidateRenderTreeForSelf()}invalidateRenderTreeForChildren(){for(let e=0,t=this.childCount();e<t;e=e+1){let n=this.childAt1(e);n._invalidateRenderTreeForSelf(),n.invalidateRenderTreeForChildren()}}invalidateNestedBackgroundBlurRenderTrees(e,t){var a;let n=this.topLevelAncestor();if(!this.isTopLevelParent()&&(n==null||!e.has(n.id())))return!1;let o=(a=this._renderTree)==null?void 0:a.value;if(o!=null&&!o.hasBackgroundBlurs())return!1;if(this.transitioningFrom!=null){if(o==null||o.hasBackgroundBlurs()){let s=this.topLevelAncestor();if(s!=null&&e.has(s.id()))return this._invalidateRenderTreeForSelf(),!0}return!1}let i=!1;for(let s=0,l=this.childCount();s<l;s=s+1)i=this.childAt2(s,!0).invalidateNestedBackgroundBlurRenderTrees(e,t)||i;if(i)return this._invalidateRenderTreeForSelf(),!0;if(!zt.isGeometryLeaf(this.type())&&!zt.isFrameLike(this.type()))return!1;if(this.effects().length!=0){let s=this.supportsGeometry()?this.canvasSpaceGeometryBounds():this.canvasSpaceBoundingBox();for(let l=0,d=this.effects().length;l<d;l=l+1){let c=this.effects()[l];if(c.isVisibleForRendering()&&c.type()=="BACKGROUND_BLUR"){let p=G.new3(s).expandedBy1(c.blurRadius()),u=!1,_=this.topLevelAncestor();if(_!=null&&e.has(_.id())&&(u=!0),u)return this._invalidateRenderTreeForSelf(),t.push(p),!0}}}return!1}getCachedRenderTree(){return this._renderTree}getCachedRenderTreeForBaseScreen(){return this._renderTreeAsBaseScreen}renderTree1(){return this.renderTree2(new Nt(this))}renderTree2(e){if(e.overlayRenderData()!=null&&e.overlayRenderData().hasTransition()&&e.hasBackgroundBlurs()){let t=new ye.GenerateArgs(ye.RenderMode.NORMAL);return ye.generateRenderTree(e,t)}if(this._renderTree==null){let t=new ye.GenerateArgs(ye.RenderMode.NORMAL);this.actingAsOverlayOrSublayerForRendertreeGeneration(()=>{this._renderTree=new ce(ye.generateRenderTree(e,t))}),(this._renderTree.value==null||!this._renderTree.value.hasBackgroundBlurs())&&(this._renderTreeWithoutBackgroundBlurs=this._renderTree)}return this._renderTree.value}renderTreeForBaseScreen1(){return this.renderTreeForBaseScreen2(new Nt(this))}renderTreeForBaseScreen2(e){if(this._renderTreeAsBaseScreen==null){let t=new ye.GenerateArgs(ye.RenderMode.NORMAL);this.actingAsBaseScreenForRendertreeGeneration(()=>{this._renderTreeAsBaseScreen=new ce(ye.generateRenderTree(e,t))})}return this._renderTreeAsBaseScreen.value}renderTreeWithoutBackgroundBlurs(){if(this._renderTreeWithoutBackgroundBlurs==null){let e=new Nt(this),t=new ye.GenerateArgs(ye.RenderMode.WITHOUT_BACKGROUND_BLURS);this._renderTreeWithoutBackgroundBlurs=new ce(ye.generateRenderTree(e,t))}return this._renderTreeWithoutBackgroundBlurs.value}renderTreeForShadowRoot1(){return this.renderTreeForShadowRoot2(new Nt(this))}renderTreeForShadowRoot2(e){if(this._renderTreeForShadowRoot==null){let t=new ye.GenerateArgs(ye.RenderMode.SHADOW,e.uniqueIdentifier());this._renderTreeForShadowRoot=new ce(ye.generateRenderTree(e,t))}return this._renderTreeForShadowRoot.value}renderTreeForShadowDescendant1(){return this.renderTreeForShadowDescendant2(new Nt(this))}renderTreeForShadowDescendant2(e){if(this._renderTreeForShadowDescendant==null){let t=new ye.GenerateArgs(ye.RenderMode.SHADOW);this._renderTreeForShadowDescendant=new ce(ye.generateRenderTree(e,t))}return this._renderTreeForShadowDescendant.value}renderTreeForKnockoutShadowRoot1(){return this.renderTreeForKnockoutShadowRoot2(new Nt(this))}renderTreeForKnockoutShadowRoot2(e){if(this._renderTreeForKnockoutShadowRoot==null){let t=new ye.GenerateArgs(ye.RenderMode.KNOCKOUT_SHADOW,e.uniqueIdentifier());this._renderTreeForKnockoutShadowRoot=new ce(ye.generateRenderTree(e,t))}return this._renderTreeForKnockoutShadowRoot.value}renderTreeForKnockoutShadowDescendant1(){return this.renderTreeForKnockoutShadowDescendant2(new Nt(this))}renderTreeForKnockoutShadowDescendant2(e){if(this._renderTreeForKnockoutShadowDescendant==null){let t=new ye.GenerateArgs(ye.RenderMode.KNOCKOUT_SHADOW);this._renderTreeForKnockoutShadowDescendant=new ce(ye.generateRenderTree(e,t))}return this._renderTreeForKnockoutShadowDescendant.value}renderTreeForOverlay(e){let t=!1;e.overlayRenderData()!=null&&this._overlayCacheKey!=e.overlayRenderData().overlayCacheKey()&&(this._invalidateRenderTreeForSelf(),t=!0);let n=this.renderTree2(e);return t&&(this._overlayCacheKey=e.overlayRenderData().overlayCacheKey()),n}renderTreeForSlideThumbnail1(){return this.renderTreeForSlideThumbnail2(new Nt(this))}renderTreeForSlideThumbnail2(e){let t=new ye.GenerateArgs(ye.RenderMode.SLIDE_THUMBNAIL);return new ce(ye.generateRenderTree(e,t)).value}containsIndependentBordersStrokeMask(){return N().prepareCppNodeForAccess(this),N().nodeTsApi().getContainsIndependentBordersStrokeMask(ee.PROTOTYPE_LIB)}generateStrokeAndStrokeMaskGeometries(e,t,n){let o=this.strokeGeometry(),i=this.strokeGeometry().styleIDs,a=new Set(i);(!a.has(0)||!a.has(1))&&Oe("Expected IDs 0 and 1 in stroke mask geometry");for(let s=0;s<o.regions.length;s++){let l=s<i.length?i[s]:0,d=o.regions[s];if(d.bounds().isEmpty())continue;let c=Et.getOrCreate(d.path(),d.windingRule);if(l==1)t.push(new wt(c,Se.SOLID_BLACK));else{let p=Se.isolatedPaints(n);for(let u=0;u<p.length;u++)e.push(new wt(c,p[u]))}}}_handlePropertyChangeForRenderTree(e,t){switch(e){case 30:case 86:{this.invalidateRenderTreeForSelfAndParents(),this.invalidateRenderTreeForChildren();break}case 32:{this.invalidateRenderTreeForSelfAndParents(),t!=null&&t.invalidateRenderTreeForSelfAndParents();break}case 100:case 69:{let n=this.findAllTopLevelNodesInNode(this);for(let o=0,i=n.length;o<i;o=o+1){let a=n[o];a!=null&&a.invalidateRenderTreeForSelfAndParents()}break}case 67:case 9:case 46:case 28:case 61:case 3:case 13:case 10:case 11:case 44:case 45:case 14:case 89:case 42:case 41:case 57:case 29:case 77:case 62:case 1:case 2:case 4:case 5:case 79:case 25:case 8:case 64:case 102:case 103:case 104:case 105:case 66:case 76:case 78:case 52:case 47:case 48:case 49:case 50:case 15:case 53:case 65:{this.invalidateRenderTreeForSelfAndParents();break}}}static _applyEffectSpread(e,t){if(t!=null){let n=e.clone();return n.translate1(t.centerX(),t.centerY()),n.expand2(t.width()/2,t.height()/2),n}return e}static _computeRegionPaintsFromStyles(e,t,n){if(e!=null){let o=t!=null?t.filter(s=>s.isEnabledAndVisible()):[],i=new Map,a=e.paintOverrides;return o.length==0&&o.push($.TRANSPARENT),e.regions.map(s=>{let l=o,d=s.styleID;if(d!=0&&a!=null){let c=Dt.IntMap_get(i,d,null);if(c==null){let p=a.get(d,n);p!=null&&(c=p.filter(u=>u.isEnabledAndVisible()),i.set(d,c))}c!=null&&(l=c)}return l})}return ct.EMPTY_REGION_PAINTS}};ct._geometryBuilder=new ht,ct._renderedBuilder=new ht,ct._scrollingBuilder=new ht,ct._effectBuilder=new ht,ct._effectBounds=G.new2(),ct.EMPTY_REGION_PAINTS=[];var hh=ct;var Hg=class{constructor(e,t){this.clone=e,this.source=t}},zg=class{constructor(e,t){this.transitionRootStablePath=e,this.cloneOps=t}},ec=class{constructor(e,t){this._appState=null,this._modules=null,this._cachedViewNode=null,this._modules=e,this._appState=t,t.addFrameObserver(this._prototype())}modules(){return this._modules}appState(){return this._appState}nodeTsApi(){var e;return(e=this._modules)==null?void 0:e.nodeTsApi}nodeTsApiGenerated(){var e;return(e=this._modules)==null?void 0:e.nodeTsApiGenerated}sceneGraphTsApi(){var e;return(e=this._modules)==null?void 0:e.sceneGraphTsApi}_prototype(){var e;return(e=this._modules)==null?void 0:e.prototype}fonts(){var e;return(e=this._modules)==null?void 0:e.fonts}dumpFileForTests(){return this._prototype().dumpFile()}getNodeChangesForSwap(e,t,n,o){let i=this._prototype().getNodeChangesForSwap(e.guids,t,n),a=this._appState.scene(),s=i.clones.map(l=>{let d=a.findNode(l.clone),c=a.findNode(l.source);return o&&c===null&&Ae.trackDefinedEvent("prototype.null_source_for_swap_v2",{sourceNodeId:l.source}),new Hg(d,c)});return new zg(new ut(i.transitionRootStablePath),s)}runSetVariable(e,t,n,o){return this._prototype().runSetVariable(e,t,n,o)}runSetProperty(e,t,n,o){return this._prototype().runSetProperty(e,t,n,o)}runSetVariableMode(e,t,n){return this._prototype().runSetVariableMode(e,t,n)}getFirstTruthyConditionalIndex(e,t){return this._prototype().getFirstTruthyConditionalIndex(e,t)}getICActionsForSetVariableAction(e,t,n,o,i){return this._prototype().getICActionsForSetVariableAction(e,t,n,o,i)}getICActionsForSetPropertyAction(e,t,n,o,i){return this._prototype().getICActionsForSetPropertyAction(e,t,n,o,i)}shouldDisallowSwap(e,t){return this._prototype().shouldDisallowSwap(e.guids,t)}applyExistingVariableChangesToIFLLoadedNodes(){this._prototype().applyExistingVariableChangesToIFLLoadedNodes()}getChangedVariables(){return this._prototype().getChangedVariables()}updateImmutableFramesAndLayoutDirtyGroupsAndStacks(){this._prototype().updateImmutableFramesAndLayoutDirtyGroupsAndStacks()}prepareCppNodeForAccess(e){e!=this._cachedViewNode&&(this.nodeTsApi().setGlobalUnstableNodeByHandle(e.handle()),this._cachedViewNode=e)}createSceneAndSetActive(e,t){let n=this._prototype().initializeActiveSceneWithDangerousLoadingFlag(e,t),o=Cn.instance.findScene(n);if(o==null)throw new Error("Failed to create scene in C++");return this._setSceneAsActiveIfNeeded(o),o}destroyScene(e){this._prototype().destroyScene(e.handle())}markSceneLoaded(e){this._prototype().markSceneLoaded(e.handle())}resetLocalChanges(){this._prototype().resetLocalChanges()}updateCurrentBaseScreenIDs(e){this._prototype().updateCurrentBaseScreenIDs(e)}cloneNode(e){return this._prototype().cloneNode(e)}setNodeToInitialObjectAnimationState(e,t){this._prototype().setNodeToInitialObjectAnimationState(e,t)}setNodeToFinalObjectAnimationState(e,t){this._prototype().setNodeToFinalObjectAnimationState(e,t)}resetNodeAnimationState(e,t){this._prototype().resetNodeAnimationState(e,t)}previewSceneAt(e,t,n){this._prototype().previewSceneAt(e,t,n)}updatePrototypeDevice(e){this._prototype().setOverridePrototypeDevice(e,ee.PROTOTYPE_LIB)}updateResponsiveSize(e,t,n){this._prototype().updateResponsiveSize(e,t,n)}isOrContainsBaseScreen(e){return this._prototype().isOrContainsBaseScreen(e)}resetLocalVariableChanges(){this._prototype().resetLocalVariableChanges()}resetLocalVariableModeChanges(){this._prototype().resetLocalVariableModeChanges()}resetLocalNodeSizeChanges(e){this._prototype().resetLocalNodeSizeChanges(e)}resetLocalInstanceChanges(e){this._prototype().resetLocalInstanceChanges(e)}resetLocalNestedInstanceChanges(e){this._prototype().resetLocalNestedInstanceChanges(e)}nodeHasLocalSymbolChanges(e){return this._prototype().nodeHasLocalSymbolChanges(e)}getNumStateTransitions(e){return this._prototype().getNumStateTransitions(e)}_setSceneAsActiveIfNeeded(e){this._prototype().getActiveScene()!=e.handle()&&this._prototype().setActiveScene(e.handle())}applyNodeChanges(e){this._prototype().applyNodeChanges(e,hn)}reset(){this._prototype()!=null&&this._prototype().reset()}findNode(e,t){return this._setSceneAsActiveIfNeeded(e),this._prototype().findNodeByStablePath(t.guids)}idlRegionsToGeometry(e,t){if(e===null||e==null)return null;let n=[],o=[];ht.INSTANCE.reset();for(let a of e){let s=new no(a.path),l=new Dr(a.windingRule==1?"ODD":"NONZERO",a.styleID,s,s.bounds());n.push(l),o.push(a.styleID),ht.INSTANCE.include3(l.bounds())}let i=t??new So(new $r(new Map));return new wr(n,o,ht.INSTANCE.build(),i)}idlRegionsToTextGeometry(e,t){if(e==null)return null;let n=[],o=[],i=[],a=[],s="apple";ht.INSTANCE.reset();for(let d of e){let c=new no(d.path),p=d.decorationPath?new no(d.decorationPath):void 0,u=new Dr(d.windingRule==1?"ODD":"NONZERO",d.styleID,c,c.bounds());if(n.push(u),i.push(d.styleID),p){let _=new Dr(d.windingRule==1?"ODD":"NONZERO",d.styleID,p,p.bounds());o.push(_),i.push(d.styleID)}a.push(d.emojiCodePoints),s=d.emojiImageSet,ht.INSTANCE.include3(u.bounds())}let l=t??new So(new $r(new Map));return new zp(n,i,ht.INSTANCE.build(),l,a,s,o)}getFillGeometryForSpread(e,t,n){return this.prepareCppNodeForAccess(n),this._prototype().getFillGeometryForSpread(e,t,ee.PROTOTYPE_LIB)}getAffineTransform(e,t){return this.prepareCppNodeForAccess(e),this._prototype().getAffineTransform(t),new J(pt.retAffineTransform_m00,pt.retAffineTransform_m01,pt.retAffineTransform_m02,pt.retAffineTransform_m10,pt.retAffineTransform_m11,pt.retAffineTransform_m12)}getAffineTransform_SGEO(e){return this._prototype().getAffineTransform_SGEO(e),new J(pt.retAffineTransform_m00,pt.retAffineTransform_m01,pt.retAffineTransform_m02,pt.retAffineTransform_m10,pt.retAffineTransform_m11,pt.retAffineTransform_m12)}getArcData(e,t){this.prepareCppNodeForAccess(e),this._prototype().getArcData(t);let n={};return n.startingAngle=pt.retArcData_startAngle,n.endingAngle=pt.retArcData_endAngle,n.innerRadius=pt.retArcData_innerRadius,n}getArcData_SGEO(e){this._prototype().getArcData_SGEO(e);let t={};return t.startingAngle=pt.retArcData_startAngle,t.endingAngle=pt.retArcData_endAngle,t.innerRadius=pt.retArcData_innerRadius,t}getBool(e,t){return this.prepareCppNodeForAccess(e),this._prototype().getBool(t)}getBool_SGEO(e){return this._prototype().getBool_SGEO(e)}getDouble(e,t){return this.prepareCppNodeForAccess(e),this._prototype().getDouble(t)}getDouble_SGEO(e){return this._prototype().getDouble_SGEO(e)}getEffectList(e){return this.prepareCppNodeForAccess(e),this._prototype().getEffectList()}getEffectList_SGEO(e){return this._prototype().getEffectList_SGEO(e)}getGUID(e,t){return this.prepareCppNodeForAccess(e),this._prototype().getGUID(t),X._new(pt.retGUID_sessionId,pt.retGUID_localId)}getGUID_SGEO(e){return this._prototype().getGUID_SGEO(e),X._new(pt.retGUID_sessionId,pt.retGUID_localId)}getStyleId(e,t){return this.prepareCppNodeForAccess(e),this._prototype().getStyleId(t),{guid:pt.retStyleId.guid,ref:pt.retStyleId.ref}}getStyleId_SGEO(e){return this._prototype().getStyleId_SGEO(e),{guid:pt.retStyleId.guid,ref:pt.retStyleId.ref}}getInt(e,t){return this.prepareCppNodeForAccess(e),this._prototype().getInt(t)}getInt_SGEO(e,t){return this._prototype().getInt_SGEO(e,t)}getPaintList(e,t){return this.prepareCppNodeForAccess(e),this._prototype().getPaintList(t)}getPaintList_SGEO(e){return this._prototype().getPaintList_SGEO(e)}getField(e,t){this.prepareCppNodeForAccess(e);let n=this._prototype().getField(t);if(n.length==0)return null;let o=xe().decodeMessage(n);if(o.nodeChanges===void 0||o.nodeChanges.length!=1)throw new Error("Bad NODE_CHANGES from getField");let i=o.nodeChanges[0],a=[],s=null;return this._appState.serialization().decodeNodeChange(i,a,(l,d)=>{s=d}),s}getField_SGEO(e){let t=this._prototype().getField_SGEO(e);if(t.length==0)return null;let n=xe().decodeMessage(t);if(n.nodeChanges===void 0||n.nodeChanges.length!=1)throw new Error("Bad NODE_CHANGES from getField_SGEO");let o=n.nodeChanges[0],i=[],a=null;return this._appState.serialization().decodeNodeChange(o,i,(s,l)=>{a=l}),a}getParentIndex(e){this.prepareCppNodeForAccess(e);let t=this._prototype().getParentIndex();return Qr.fromString(t)}getParentIndex_SGEO(e){return Qr.fromString(this._prototype().getParentIndex_SGEO(e))}getPrototypeInteractions_SGEO(e){let t=this._prototype().getPrototypeInteractions_SGEO(e);return Ra.WeakHandle_isValid(t)?this._modules.prototypeInteractions_Internal.getOrCreateSkewCopy(t):[]}getString(e,t){return this.prepareCppNodeForAccess(e),this._prototype().getString(t)}getString_SGEO(e){return this._prototype().getString_SGEO(e)}getVector(e,t){return this.prepareCppNodeForAccess(e),this._prototype().getVector(t),new b(pt.retVector_x,pt.retVector_y)}getVector_SGEO(e){return this._prototype().getVector_SGEO(e),new b(pt.retVector_x,pt.retVector_y)}getOverridePath(e){return this.prepareCppNodeForAccess(e),new ut(this._prototype().overridePath())}getStablePath(e){return this.prepareCppNodeForAccess(e),new ut(this._prototype().stablePath())}hasNodeProperty(e,t){return this.prepareCppNodeForAccess(e),this._prototype().hasNodeProperty(t)}forEachField(e,t){this.prepareCppNodeForAccess(e),pt.forEachFieldCallback=t,this._prototype().forEachField(),pt.forEachFieldCallback=null}applyLocalNodeChangesForTests(e){if(!Gr())throw new Error("Should not be calling applyLocalNodeChangesForTests outside of tests");this._prototype().applyLocalNodeChangesForTests(e)}clearDirtyTextLayoutForTests(e){if(!Gr())throw new Error("Should not be calling flushLayoutForTests outside of tests");this._prototype().clearDirtyTextLayoutForTests(e.handle())}updateSymbolInstancesForTests(){if(!Gr())throw new Error("Should not be calling applyLocalNodeChangesForTests outside of tests");this._prototype().updateSymbolInstancesForTests()}updateStylesForTests(){if(!Gr())throw new Error("Should not be calling applyLocalNodeChangesForTests outside of tests");this._prototype().updateStylesForTests()}updateFontForTests(e,t){if(!Gr())throw new Error("Should not be calling applyLocalNodeChangesForTests outside of tests");this._prototype().updateFontForTests(e,t)}initializeRenderer(){this._prototype().initializeRenderer()}topLevelPrototypeStartingPointsSorted(e){return this._prototype().topLevelPrototypeStartingPointsSorted(e)??[]}},mh=class mh{isReady(){return this._isReady}createScene(e){return new nt(e)}setViewer(e){this._viewer=e}getViewer(){return this._viewer}handleUncompressedMessage(e,t){if(this._multiplayer==null)throw new Error("Multiplayer hasn't been set");this._multiplayer.handleUncompressedMessage(e,t)}getSceneLoadingPhase(){if(this._multiplayer==null)throw new Error("Multiplayer hasn't been set");return this._multiplayer.getSceneLoadingPhase()}handleUncompressedSchema(e){if(this._multiplayer==null)throw new Error("Multiplayer hasn't been set");return this._multiplayer.handleUncompressedSchema(e)}willReceiveNodeChanges(){if(this._multiplayer==null)throw new Error("Multiplayer hasn't been set");this._multiplayer.willReceiveNodeChanges()}didReceiveNodeChanges(e,t){if(this._multiplayer==null)throw new Error("Multiplayer hasn't been set");this._multiplayer.didReceiveNodeChanges(e,t)}setMultiplayer(e){this._multiplayer=e}findScene(e){return N().modules().prototype.getScene(e)}findNode(e){return Dt.IntMap_get(this._nodes,e,null)}setReverseVariantBindingsForICsDisabled(e){let t=this._reverseVariantBindingsForICsDisabled;return this._reverseVariantBindingsForICsDisabled=e,t}reverseVariantBindingsForICsDisabled(){return this._reverseVariantBindingsForICsDisabled}ready(){this._isReady=!0}track(e,t){Ae.trackEvent(e,t)}triggerViewerEvent(e,t){this._viewer!==null&&this._viewer.trigger(e,t)}getBaseScreenId(){var e,t;return((t=(e=this._viewer)==null?void 0:e.getBaseScreenId)==null?void 0:t.call(e))??""}isScalingModeResponsive(){var e,t;return((t=(e=this._viewer)==null?void 0:e.isScalingModeResponsive)==null?void 0:t.call(e))??!1}Node_created(e,t,n,o){if(t!=null){let i=new hh(e,t,X._new(n,o));this._nodes.set(e,i),t.dangerouslyRegisterNode(i)}else throw new Error("Cannot create node with null scene")}Node_destroyed(e){let t=this.findNode(e);if(t!=null){let n=t.scene();n!=null&&n.dangerouslyUnregisterNode(t.id()),this._nodes.delete(e)}}triggerSceneGraphEvent(e,t,n){let o=this.findNode(e);if(o==null)return;let i=o.scene();if(i!=null){let a=t,s=o.id(),l=eb(N(),i,s,a,n),d=null,c=!1;a==112?Je.asStringEnum(l,"CREATED")=="CREATED"?(d="REMOVED",c=!0):d="CREATED":d=dh(N(),o,a),i.broadcastPropertyChange(new sh(o,a,l,d)),c&&i.dangerouslyUnregisterNode(s)}}updateNodeAfterPropertyChange(e,t){let n=this.findNode(e);n!=null&&n.updateAfterPropertyChange(t)}linkNodeToParent(e,t,n){let o=this.findNode(e);o!=null&&o.linkToParent(this.findNode(t),n)}unlinkNodeFromParent(e){let t=this.findNode(e);t!=null&&t.unlinkFromParent()}debugPrototypeActionFromPreview(e){top.postMessage({debugPrototypeActionFromPreview:e},window.origin)}retAffineTransform(e,t,n,o,i,a){pt.retAffineTransform_m00=e,pt.retAffineTransform_m01=t,pt.retAffineTransform_m02=n,pt.retAffineTransform_m10=o,pt.retAffineTransform_m11=i,pt.retAffineTransform_m12=a}retArcData(e,t,n){pt.retArcData_startAngle=e,pt.retArcData_endAngle=t,pt.retArcData_innerRadius=n}retGUID(e,t){pt.retGUID_sessionId=e,pt.retGUID_localId=t}retStyleId(e){pt.retStyleId=e}retVector(e,t){pt.retVector_x=e,pt.retVector_y=t}forEachFieldCallback(e){pt.forEachFieldCallback!=null&&pt.forEachFieldCallback(e)}constructor(){this._viewer=null,this._isReady=!1,this._multiplayer=null,this._nodes=new Map,this._reverseVariantBindingsForICsDisabled=!1}};mh.instance=new mh;var Cn=mh,pt;(S=>(S.retAffineTransform_m00=0,S.retAffineTransform_m01=0,S.retAffineTransform_m02=0,S.retAffineTransform_m10=0,S.retAffineTransform_m11=0,S.retAffineTransform_m12=0,S.retArcData_startAngle=0,S.retArcData_endAngle=0,S.retArcData_innerRadius=0,S.retGUID_sessionId=0,S.retGUID_localId=0,S.retStyleId=null,S.retVector_x=0,S.retVector_y=0,S.forEachFieldCallback=null))(pt||(pt={}));var Yd;(a=>{function r(s,l,d){s.set(l,d)}a.Map_set1=r;function e(s,l){return s.get(l)}a.Map_get1=e;function t(s,l,d){let c=s.get(l);return c!==void 0?c:d}a.Map_getOrDefault=t;function n(s){return Array.from(s.keys())}a.Map_keys=n;function o(s){return Array.from(s.values())}a.Map_values=o;function i(s,l){let d=new Map;for(let c=0,p=s.length;c<p;c=c+1)d.set(s[c],l[c]);return d}a.Map_new1=i})(Yd||(Yd={}));var tb;(n=>{function r(o,i){return o.get(i)}n.WeakMap_get1=r;function e(o,i,a){o.set(i,a)}n.WeakMap_set1=e;function t(o,i){let a=new WeakMap;for(let s=0,l=o.length;s<l;s=s+1)a.set(o[s],i[s]);return a}n.WeakMap_new1=t})(tb||(tb={}));var va=class r{startAnimation(e,t){this._animationCurve=e,this._animationStartTime=Me.seconds(),this._animationEndTime=this._animationStartTime+t}animationProgress(){let e=(Me.seconds()-this._animationStartTime)/(this._animationEndTime-this._animationStartTime);return this._animationCurve==r.Curve.EASE_IN_OUT?e*=e*e*(e*(e*6-15)+10):(e=1-e,e=1-e*e*e*e*e),Math.min(e,1)}constructor(){this._animationCurve=r.Curve.EASE_IN_OUT,this._animationStartTime=0,this._animationEndTime=0}};(e=>{let r;(o=>(o[o.EASE_IN_OUT=0]="EASE_IN_OUT",o[o.DECAY=1]="DECAY"))(r=e.Curve||(e.Curve={}))})(va||(va={}));var No=class No{zoomScale(){return this._boundsMapping.viewPixelsPerCanvasPixel()}viewSpaceBounds(){return this._boundsMapping.viewSpaceBounds()}resetStateForTests(){this._boundsMapping=new fh,this._useClamping=!1,this._alreadySetAnimationClamp=!1,this._dummyOffset=b.new(),this._isInvalid=!0,this._scrollPadding=[0,0,0,0],this._boundsOfDevicePreview=G.new2(),this._minZoom=0,this._isAnimating=!1,this._animationOffsetStart=null,this._animationOffsetEnd=null,this._clampedAnimationOffsetEnd=b.new(),this._animationZoomScaleStart=1,this._animationZoomScaleEnd=1,this._animationEndBounds=G.new2()}pixelSpaceBounds(e){let t=this.viewSpaceBounds();return new G(t.left()*e,t.top()*e,t.width()*e,t.height()*e)}_clampingBoundsForCanvasSpaceOffset(){return this._boundsMapping.clampingBoundsForCanvasSpaceOffset()}copyFrom(e){this._boundsMapping=e._boundsMapping.clone(),this._boundsOfDevicePreview.copyFrom(e._boundsOfDevicePreview),this._isInvalid=e._isInvalid,this._minZoom=e._minZoom,this._scrollPadding=e._scrollPadding}offsetX(){return this.offset().x()}offsetY(){return this.offset().y()}offset(){return this._boundsMapping.canvasSpaceOrigin().negative()}_setCanvasSpaceOffsetTo(e){this._boundsMapping.setCanvasSpaceOriginTo(e.negative())}canvasSpaceToViewSpace1(){return Y.isInlinePreview()?this.canvasSpaceToViewSpace2(1):this.canvasSpaceToViewSpace2(0)}canvasSpaceToViewSpace2(e){return this._boundsMapping.canvasSpaceToViewSpace(e)}viewSpaceToCanvasSpace1(){return Y.isInlinePreview()?this._boundsMapping.viewSpaceToCanvasSpace(1):this._boundsMapping.viewSpaceToCanvasSpace(0)}viewSpaceToCanvasSpace2(e){return this._boundsMapping.viewSpaceToCanvasSpace(e)}viewSpaceToClipSpace(){let e=J.new2().copyFrom(yt.FrozenAffineTransform_IDENTITY);return e.copyFrom(yt.FrozenAffineTransform_IDENTITY),e.scale4(1,-1),e.translate2(-1,-1),e.scale4(2/this.viewSpaceBounds().width(),2/this.viewSpaceBounds().height()),e}canvasSpaceToClipSpace1(){return Y.isInlinePreview()?this.canvasSpaceToClipSpace2(1):this.canvasSpaceToClipSpace2(0)}canvasSpaceToClipSpace2(e){let t=this.viewSpaceToClipSpace();return t.multipliedBy2(this.canvasSpaceToViewSpace2(e)),t}computeCanvasSpaceBounds1(e){Y.isInlinePreview()?this.computeCanvasSpaceBounds2(e,1):this.computeCanvasSpaceBounds2(e,0)}computeCanvasSpaceBounds2(e,t){this._boundsMapping.computeCanvasSpaceBounds(e,t)}isInvalid(){return this._isInvalid}invalidate(){this._isInvalid=!0}setBounds(e){this.viewSpaceBounds().equals(e)||(this._boundsMapping.setViewSpaceBounds(e),this._isInvalid=!0)}_setCamera1(e,t,n,o){e==1?this._setCameraWithAnimation(t,n,va.Curve.EASE_IN_OUT,o):(this._isAnimating=!1,(!this.offset().equals(t)||this.zoomScale()!=n)&&(this._setCanvasSpaceOffsetTo(t),this._boundsMapping.setViewPixelsPerCanvasPixel(n),this._isInvalid=!0))}_setCamera2(e,t,n){this._setCamera1(e,t,n,No.ANIMATION_DURATION)}_setCameraWithAnimation(e,t,n,o){this._animationManager.startAnimation(n,o),this._animationOffsetStart=this.offset().clone(),this._animationOffsetEnd=e.clone(),this._animationZoomScaleStart=this.zoomScale(),this._animationZoomScaleEnd=this._clampedZoomScale(t),this._calculateBoundsForClamping(this._animationZoomScaleEnd,this._animationEndBounds),this._clampedAnimationOffsetEnd.setTo(sr.Math_clamp(e.x(),this._animationEndBounds.left(),this._animationEndBounds.right()),sr.Math_clamp(e.y(),this._animationEndBounds.top(),this._animationEndBounds.bottom())),this._isAnimating=!0,this._isInvalid=!0}_clampCameraOffset(){if(!this._useClamping)return;this._dummyOffset.copyFrom(this.offset()),this._updateBoundsForClamping(),this._setCanvasSpaceOffsetTo(this._dummyOffset);let e=sr.Math_clamp(this.offsetX(),this._clampingBoundsForCanvasSpaceOffset().left(),this._clampingBoundsForCanvasSpaceOffset().right()),t=sr.Math_clamp(this.offsetY(),this._clampingBoundsForCanvasSpaceOffset().top(),this._clampingBoundsForCanvasSpaceOffset().bottom()),n=1e-6;if(Math.abs(this.offsetX()-e)>n||Math.abs(this.offsetY()-t)>n)if(this._isAnimating&&this._animationZoomScaleStart==this._animationZoomScaleEnd)this.offsetX()!=e&&(this._animationOffsetStart=new b(e,this._animationOffsetStart.y()),this._animationOffsetEnd=new b(e,this._animationOffsetEnd.y()),this._setCanvasSpaceOffsetTo(new b(e,this.offset().y()))),this.offsetY()!=t&&(this._animationOffsetStart=new b(this._animationOffsetStart.x(),t),this._animationOffsetEnd=new b(this._animationOffsetEnd.x(),t),this._setCanvasSpaceOffsetTo(new b(this.offset().x(),t))),this._animationOffsetStart.equals(this._animationOffsetEnd)&&(this._isAnimating=!1);else if(this._isAnimating){if(this._alreadySetAnimationClamp)return;this._animationOffsetStart=this.offset(),this._animationOffsetEnd=this._clampedAnimationOffsetEnd,this._alreadySetAnimationClamp=!0}else this._setCamera2(0,new b(e,t),this.zoomScale());this.zoomScale()<this._minZoom&&this._boundsMapping.setViewPixelsPerCanvasPixel(this._minZoom)}setCameraZoom(e,t){let n=e==1&&this._isAnimating;this._setCamera2(e,n?this._animationOffsetEnd:this.offset(),t)}adjustCameraZoom1(e,t){let n=e==1&&this._isAnimating;this._setCamera2(e,n?this._animationOffsetEnd:this.offset(),(n?this._animationZoomScaleEnd:this.zoomScale())*t)}adjustCameraZoom2(e,t,n){let o=e==1&&this._isAnimating;this._setCamera1(e,o?this._animationOffsetEnd:this.offset(),(o?this._animationZoomScaleEnd:this.zoomScale())*t,n)}adjustCameraZoomRounded(e,t){let n=e==1&&this._isAnimating;this.setCameraZoom(1,Math.pow(2,Math.round(Math.log((n?this._animationZoomScaleEnd:this.zoomScale())*t)/Math.log(2))))}setCameraOffset1(e,t){this.setCameraOffset2(e,t,No.ANIMATION_DURATION)}setCameraOffset2(e,t,n){let o=e==1&&this._isAnimating;this._setCamera1(e,t,o?this._animationZoomScaleEnd:this.zoomScale(),n),this._clampCameraOffset()}panCamera(e){this._setCamera2(0,this.offset().add(e.divideScalar(this.zoomScale())),this.zoomScale()),this._clampCameraOffset()}flingCameraOffset(e,t){this._setCameraWithAnimation((this._isAnimating?this._animationOffsetEnd:this.offset()).add(e.divideScalar(this.zoomScale())),this._isAnimating?this._animationZoomScaleEnd:this.zoomScale(),va.Curve.DECAY,t),this._clampCameraOffset()}adjustCameraZoomWithPin(e,t){let n=this._clampedZoomScale(this.zoomScale()*e);this._setCamera2(0,this.offset().add(t.subtract(this.viewSpaceBounds().size().divideScalar(2)).multiplyScalar(1/n-1/this.zoomScale())),n),this._clampCameraOffset()}adjustCameraZoomAndOffset(e,t,n){let o=this._clampedZoomScale(this.zoomScale()*e);this._setCamera2(0,this.offset().add(n.subtract(this.viewSpaceBounds().size().divideScalar(2)).divideScalar(o)).subtract(t.subtract(this.viewSpaceBounds().size().divideScalar(2)).divideScalar(this.zoomScale())),o),this._clampCameraOffset()}zoomToFit1(e,t,n){this._zoomToFit(e,t,No.ZOOM_TO_FIT_PADDING,n)}zoomToFit2(e,t){this._zoomToFit(e,t,No.ZOOM_TO_FIT_PADDING,No.ANIMATION_DURATION)}zoomToFitExactly(e,t){this._zoomToFit(e,t,0,No.ANIMATION_DURATION)}_zoomToFit(e,t,n,o){t.isEmpty()||(this._setCamera1(e,t.center().negative(),this.viewSpaceBounds().size().subtractScalar(2*n).divide(t.size()).minComponent(),o),this._clampCameraOffset())}prepareForRendering(){if(this._isAnimating){let e=this._animationManager.animationProgress();e>=1?(this._setCanvasSpaceOffsetTo(this._animationOffsetEnd.clone()),this._boundsMapping.setViewPixelsPerCanvasPixel(this._animationZoomScaleEnd),this._isAnimating=!1,this._alreadySetAnimationClamp=!1):(this._boundsMapping.setViewPixelsPerCanvasPixel(1/(1/this._animationZoomScaleStart+(1/this._animationZoomScaleEnd-1/this._animationZoomScaleStart)*e)),this._setCanvasSpaceOffsetTo(this._animationOffsetEnd.subtract(this._animationOffsetStart).multiplyScalar(e).add(this._animationOffsetStart)))}this._isInvalid=this._isAnimating}getScaleFactorForCurrentTlf(e,t,n){let o=Fn.canvasSpaceContentSize(e,n);if(o.x()===0||o.y()===0)return 1;switch(t.fitMode){case"scale-down-width":return o.x()>this.viewSpaceBounds().width()?this.viewSpaceBounds().width()/o.x():1;case"fit-width":return this.viewSpaceBounds().width()/o.x();case"scale-down":case"contain":{let i=1/Math.max(o.x()/this.viewSpaceBounds().width(),o.y()/this.viewSpaceBounds().height());return t.fitMode=="scale-down"&&(i=Math.min(i,1)),i=Math.ceil(i*e.y())/e.y(),i}case"min-zoom":return 1;case"none":return 1;case"free":return 0;default:return 1}}_clampedZoomScale(e){let t=Math.max(this._minZoom,No.ZOOM_MIN);return Math.max(t,Math.min(e,No.ZOOM_MAX))}setScrollPadding(e){this._scrollPadding=e}previewBoundsIncludingDeviceFrame(e,t,n){return n!=null&&Ka.hasDevice(n.type)?Fn.adjustNodeBoundsForDevice(e,n):Y.isInlinePreview()?e:t}_snapOffsetToPixelGrid(e,t){let n=e.add(t).multiplyScalar(this.zoomScale()*2);n.setX(Math.floor(n.x())),n.setY(Math.floor(n.y()));let o=n.divideScalar(this.zoomScale()*2).subtract(t);return t.add(o.subtract(e))}_calculateBoundsForClamping(e,t){let n=this._boundsOfDevicePreview.isInvalid()?G.new2():this._boundsOfDevicePreview,o=Math.min((this.viewSpaceBounds().width()/2-this._scrollPadding[2])/e,n.width()/2),i=Math.min((this.viewSpaceBounds().height()/2-this._scrollPadding[3])/e,n.height()/2),a=Math.min((this.viewSpaceBounds().width()/2-this._scrollPadding[0])/e,n.width()/2),s=Math.min((this.viewSpaceBounds().height()/2-this._scrollPadding[1])/e,n.height()/2),l=-n.right()+o,d=-n.bottom()+i,c=-n.left()-a,p=-n.top()-s,u=c-l,_=p-d;t.setTo1(l,d,u,_)}_updateBoundsForClamping(){let e=G.new2();this._calculateBoundsForClamping(this.zoomScale(),e),this._boundsMapping.setClampingBoundsForCanvasSpaceOffset(e)}updateForBaseScreen(e,t,n){this.updateForCurrentPreview(e==null?void 0:e.canvasSpaceBoundingBox(),e==null?void 0:e.canvasSpacePreviewBounds(),t,n)}updateForCurrentPreview(e,t,n,o){if(t==null||e==null){this._useClamping=!1;return}switch(this._boundsOfDevicePreview.copyFrom(this.previewBoundsIncludingDeviceFrame(e,t,o)),this._minZoom=this.getScaleFactorForCurrentTlf(t.size(),n,o),n.fitMode){case"free":{this._useClamping=!1;break}case"min-zoom":case"scale-down-width":case"none":case"fit-width":{this._useClamping=!0,this._updateBoundsForClamping(),this._clampCameraOffset();let i=o!=null&&o.type!="NONE";wp(n,i)||this.setCameraZoom(0,this._minZoom);break}case"contain":case"scale-down":{this._useClamping=!0;let i=this._snapOffsetToPixelGrid(t.topLeft(),this._boundsOfDevicePreview.center().negative());this._boundsMapping.setClampingBoundsForCanvasSpaceOffset(new G(i.x(),i.y(),0,0)),this._setCamera2(0,i,this._minZoom);break}}}constructor(){this._boundsMapping=new fh,this._useClamping=!1,this._alreadySetAnimationClamp=!1,this._boundsOfDevicePreview=G.new2(),this._dummyOffset=b.new(),this._isInvalid=!0,this._scrollPadding=[0,0,0,0],this._minZoom=0,this._animationManager=new va,this._isAnimating=!1,this._animationOffsetStart=null,this._animationOffsetEnd=null,this._clampedAnimationOffsetEnd=b.new(),this._animationZoomScaleStart=1,this._animationZoomScaleEnd=1,this._animationEndBounds=G.new2()}};No.ZOOM_MIN=Math.pow(2,-6),No.ZOOM_MAX=Math.pow(2,8),No.ZOOM_TO_FIT_PADDING=50,No.ANIMATION_DURATION=.2;var Jo=No,fh=class r{canvasSpaceOrigin(){return this._defaultCanvasSpaceOrigin().add(this._canvasSpaceOriginDelta)}setCanvasSpaceOriginTo(e){this._canvasSpaceOriginDelta=e.subtract(this._defaultCanvasSpaceOrigin())}viewSpaceBounds(){return this._viewSpaceBounds}setViewSpaceBounds(e){this._viewSpaceBounds=e}viewPixelsPerCanvasPixel(){return this._viewPixelsPerCanvasPixel}setViewPixelsPerCanvasPixel(e){isNaN(e)||e<=0?this._viewPixelsPerCanvasPixel=1:this._viewPixelsPerCanvasPixel=e}clampingBoundsForCanvasSpaceOffset(){return this._clampingBoundsForCanvasSpaceOffset}setClampingBoundsForCanvasSpaceOffset(e){this._clampingBoundsForCanvasSpaceOffset.copyFrom(e)}canvasSpaceToViewSpace(e){let t=Gn.new2().translatedBy2(this._viewSpaceBounds.width()/2,this._viewSpaceBounds.height()/2).scaledBy(this._viewPixelsPerCanvasPixel).translatedBy1(this.canvasSpaceOrigin().negative()),n=Gn.new2();if(e==0){let o=b.new(this.canvasSpaceOrigin()).rounded(),i=t.transformPoint(o),a=-(i.x()-Math.floor(i.x())),s=-(i.y()-Math.floor(i.y()));n.translate1(a,s)}return n.multiply(t),n}viewSpaceToCanvasSpace(e){let t=this.canvasSpaceToViewSpace(e).clone();return t.invert(),t}computeCanvasSpaceBounds(e,t){this._viewSpaceBounds.transformInto2(e,this.viewSpaceToCanvasSpace(t))}_defaultCanvasSpaceOrigin(){return this._clampingBoundsForCanvasSpaceOffset!=null?this._clampingBoundsForCanvasSpaceOffset.bottomRight().negative():fe.FrozenVector_ZERO}clone(){let e=new r;return e._canvasSpaceOriginDelta=this._canvasSpaceOriginDelta.clone(),e._viewPixelsPerCanvasPixel=this._viewPixelsPerCanvasPixel,e._viewSpaceBounds=this._viewSpaceBounds.clone(),e._clampingBoundsForCanvasSpaceOffset=this._clampingBoundsForCanvasSpaceOffset.clone(),e}constructor(){this._canvasSpaceOriginDelta=b.new(),this._viewPixelsPerCanvasPixel=1,this._viewSpaceBounds=G.new2(),this._clampingBoundsForCanvasSpaceOffset=G.new2()}};var Qd=class r{constructor(e,t,n){this._numStatesTransferred=0;this._numStatesReset=0;this._appState=null,this._prototypeState=null,this._semanticChangeHistoryStorage=new Xa,this._stateGroupsInteracted=new Set,this._semanticPathInteracted=new Set,this._swapStateCallback=null,this._appState=e,this._prototypeState=t,this._swapStateCallback=n,this._prototypeState.addObserver(this),this._prototypeState.addHsmObserver(this)}static getStateGroupID(e){var o;let t=e!=null?e.scene().findNode(e==null?void 0:e.symbolID()):null,n=(o=t==null?void 0:t.findContainingStateGroupOrSelf())==null?void 0:o.id();return n??X.invalid()}getComponentHistory(e,t){if(e.length==0)return[];let n=this._semanticChangeHistoryStorage.getData(e,t);return n??[]}setComponentHistory(e,t,n){this._semanticChangeHistoryStorage.insert(e,t,n)}handleStateChangeCommitted(e,t){}_transferChildComponentStates(e){e!=null&&e.forEachChild(t=>{this._setInstanceChangeHistory(t),this._transferChildComponentStates(t)})}_hasStateToTranfer(e,t){return t.length>0&&e.symbolID()!=ne.List_last(t).newStateId()}_setInstanceChangeHistory(e){if(e!=null&&this._isInteractiveComponent(e)&&this._nodeHasBeenInteractedWith(e)){let t=gr.getSemanticNodePath(new Nt(e)),n=this.getComponentHistory(t,r.getStateGroupID(e)),o=this._prototypeState.getStateMachineOrNull(e.stablePath());o!=null&&this._hasStateToTranfer(e,n)&&!this._stateAlreadyManagedByVariables(e)&&(o.setChangeHistory(n),this._swapStateCallback(e.stablePath(),ne.List_last(n).newStateId(),Es.MATERIALIZE_SWAPPED_OUT_TREE),this._numStatesTransferred++)}}_resetChildComponentStates(e,t){e!=null&&e.forEachChild(n=>{this._clearInstanceChangeHistory(n,t),this._resetChildComponentStates(n,t)})}_nodeIsInstance(e){return e!=null&&e.type()=="INSTANCE"}_nodeHasStoredState(e,t){let n=N();return!t&&n!=null&&this._nodeIsInstance(e)?n.nodeHasLocalSymbolChanges(e.id()):!1}_clearInstanceChangeHistory(e,t){var n,o;if(e!=null&&(this._isInteractiveComponent(e)||this._nodeHasStoredState(e,t))&&!this._stateAlreadyManagedByVariables(e)){this._numStatesReset++,t?(n=N())==null||n.resetLocalNestedInstanceChanges([e.id()]):(o=N())==null||o.resetLocalInstanceChanges([e.id()]);let i=gr.getSemanticNodePath(new Nt(e));this._semanticChangeHistoryStorage.remove(i,r.getStateGroupID(e))}}_hasStateToStore(e,t,n){if(t==null||t.length==0)return!1;if(n==null||n.length==0)return!0;let o=ne.List_last(n);return e.symbolID()!=o.newStateId()}_storeChangeHistory(e){if(e!=null&&this._isInteractiveComponent(e)&&this._nodeHasBeenInteractedWith(e)){let t=this._prototypeState.getStateMachineOrNull(e.stablePath());if(t!=null){let n=gr.getSemanticNodePath(new Nt(e)),o=r.getStateGroupID(e),i=this.getComponentHistory(n,o),a=t.changeHistory();this._hasStateToStore(e,a,i)&&!this._stateAlreadyManagedByVariables(e)&&this.setComponentHistory(n,o,a)}}}_storeChangeHistoryForChildren(e){e!=null&&e.forEachChild(t=>{this._storeChangeHistory(t),this._storeChangeHistoryForChildren(t)})}_semanticPathToString(e){let t=gr.getSemanticNodePath(new Nt(e)),n=":/:",o=r.getStateGroupID(e);return t.length==1?t[0].toStringWithPrefix(!0):t.reduce((i,a,s)=>s==0?i:i+a.toString()+n,"")+n+o}_recordInteraction(e,t){if(t.transitionParameters.navigationType=="SWAP_STATE"&&!$e.isTransientAction(t.cause)){let n=this._appState.scene().findNodeByStablePath(e);if(n==null)return;let o=this._semanticPathToString(n);this._semanticPathInteracted.add(o)}}_semanticPathHasBeenInteractedWith(e){return this._semanticPathInteracted.has(this._semanticPathToString(e))}_nodeHasBeenInteractedWith(e){return r.getStateGroupID(e)!=X.invalid()?this._semanticPathHasBeenInteractedWith(e):!1}_isInteractiveComponent(e){return this._nodeIsInstance(e)?r.getStateGroupID(e)!=X.invalid():!1}_stateAlreadyManagedByVariables(e){return e!=null&&e.getBoundVariables().componentProperties}handleStateChangeAborted(e){}handleStateChangeInitiated(e){if(e.stateManagementVersion()==1){let t=e.oldStateAndOverlays.topId(),n=e.newStateAndOverlays.topId(),o=this._appState.scene().findNode(t),i=this._appState.scene().findNode(n);this._storeChangeHistory(o),this._storeChangeHistoryForChildren(o),e.resetInteractiveComponents()==0?(this._numStatesReset=0,this._clearInstanceChangeHistory(i,!1),this._resetChildComponentStates(i,!1),this._sendStateResetLog()):(this._numStatesTransferred=0,this._setInstanceChangeHistory(i),this._transferChildComponentStates(i),this._sendStateTransferLog())}}handleStateChangeRequested(e){}handleFitModeChange(e,t){}handleRestartPrototype(){this._semanticChangeHistoryStorage.uninitialize1(),this._stateGroupsInteracted=new Set,this._semanticPathInteracted=new Set}handleHsmAborted(e,t){}handleHsmCommitted(e,t,n){t.stateManagementVersion()==1&&this._recordInteraction(e,t)}handleHsmRequested(e,t){if(t.stateManagementVersion()==1){let n=this._appState.scene().findNodeByStablePath(e);this._storeChangeHistoryForChildren(n)}}handleHsmInitiated(e,t){if(t.stateManagementVersion()==1){let n=this._appState.scene().findNodeByStablePath(e);t.resetInteractiveComponents()!=0?(this._numStatesTransferred=0,this._transferChildComponentStates(n),this._sendStateTransferLog()):(this._numStatesReset=0,this._resetChildComponentStates(n,!0),this._sendStateResetLog())}}_sendStateTransferLog(){this._numStatesTransferred>0&&Ae.trackDefinedEvent("prototype.viewer_interaction_state_transferred",{count:this._numStatesTransferred})}_sendStateResetLog(){this._numStatesReset>0&&Ae.trackDefinedEvent("prototype.viewer_interaction_state_reset",{count:this._numStatesReset})}debugString(){return this._semanticChangeHistoryStorage.toString2(e=>{let t="",n=Math.max(e.length-4,0);n!=0&&(t="..., ");for(let o=n,i=e.length;o<i;o=o+1){let a=e[o];t+=`${(a==null?void 0:a.oldStateId())??"null"}->${a==null?void 0:a.newStateId()}`,o!=e.length-1&&(t+=", ")}return t})}};var gh=class r{opacity1(){return this._opacity}translation1(){return this._translation}transform1(){return this._transform}scaling1(){return this._scaling}transformOrigin1(){return this._transformOrigin}fillPaints1(){return this._fillPaints}textDecorationPaints(){return this._textDecorationPaints}fillPaintsToString(){return this._fillPaints.map(e=>e.debugString()).join(", ")}strokePaints1(){return this._strokePaints}cornerRadii1(){return this._cornerRadii}rectangleSize1(){return this._rectangleSize}clone(){var t,n;let e=new r;return e._opacity=this._opacity,e._translation=this._translation.clone(),e._transform=this._transform.clone(),e._scaling=this._scaling,e._transformOrigin=(t=this._transformOrigin)==null?void 0:t.clone(),e._fillPaints=this._fillPaints,e._textDecorationPaints=this._textDecorationPaints,e._strokePaints=this._strokePaints,e._cornerRadii=this._cornerRadii,e._rectangleSize=(n=this._rectangleSize)==null?void 0:n.clone(),e}_areVectorsEqual(e,t){return e==null&&t==null?!0:e==null||t==null?!1:e.equals(t)}equals(e){return this._opacity==e.opacity1()&&this._transform.equals1(e.transform1())&&this._scaling.equals(e.scaling1())&&this._areVectorsEqual(this._transformOrigin,e.transformOrigin1())&&this.translation1().equals(e.translation1())&&Mt.FrozenList_equals(this._fillPaints,e.fillPaints1(),(t,n)=>t.equals1(n))&&Mt.FrozenList_equals(this._strokePaints,e.strokePaints1(),(t,n)=>t.equals1(n))&&Mt.FrozenList_equals(this._textDecorationPaints,e.textDecorationPaints(),(t,n)=>t.equals1(n))&&this._cornerRadii.equals(e.cornerRadii1())&&this._areVectorsEqual(this._rectangleSize,e.rectangleSize1())}equalTransformsUpToTranslation(e,t){return this.equalTransformsUpToTranslationAndScaling(e,t)&&this._scaling.equals(e.scaling1())}equalTransformsUpToTranslationAndScaling(e,t){let n=to.from(this.transform1()),o=to.from(e.transform1()),i=Math.abs(n.angleDegrees-o.angleDegrees)<=t,a=Math.abs(n.m00-o.m00)<=t&&Math.abs(n.m01-o.m01)<=t&&Math.abs(n.m10-o.m10)<=t&&Math.abs(n.m11-o.m11)<=t;return i&&a}opacity2(e){return this._opacity=e,this}translation2(e){return this._translation=e,this}transform2(e){return e!=null,this._transform=e,this}scaling2(e){return this._scaling=e,this}transformOrigin2(e){return this._transformOrigin=e,this}fillPaints2(e){return this._fillPaints=e,this}strokePaints2(e){return this._strokePaints=e,this}setTextDecorationPaints(e){return this._textDecorationPaints=e,this}cornerRadii2(e){return this._cornerRadii=e,this}rectangleSize2(e){return this._rectangleSize=e,this}withScaledTranslation(e){return this.clone().translation2(this._translation.multiply(e))}constructor(){this._opacity=1,this._translation=b.new(),this._transform=yt.FrozenAffineTransform_new1(),this._scaling=b.new().withOnesForZeros(),this._transformOrigin=null,this._fillPaints=[],this._textDecorationPaints=[],this._strokePaints=[],this._cornerRadii=Ao.ZEROS,this._rectangleSize=null}},un=class r{constructor(e){e?(this._isTransformEqual=!1,this._from=e._from.clone(),this._to=e._to.clone(),this._shouldDoLegacyImageRectSizeTransition=e._shouldDoLegacyImageRectSizeTransition,this._shouldTransitionGeometryForRoundedRectangles=e._shouldTransitionGeometryForRoundedRectangles,this._isTransformEqual=e._isTransformEqual):(this._shouldDoLegacyImageRectSizeTransition=!1,this._shouldTransitionGeometryForRoundedRectangles=!1,this._from=new gh,this._to=new gh,this._isTransformEqual=!0)}from(){return this._from}to(){return this._to}opacity(e,t){return this._from.opacity2(e),this._to.opacity2(t),this}translation(e,t){return this._from.translation2(e),this._to.translation2(t),this}transform(e,t){return this._isTransformEqual=e.equals2(t,1e-6),this._from.transform2(e),this._to.transform2(t),this}scaling(e,t){return this._from.scaling2(e),this._to.scaling2(t),this}shouldDoLegacyImageRectSizeTransition(e){return this._shouldDoLegacyImageRectSizeTransition=e,this}transitionGeometryForRoundedRectangles(e,t,n,o){return this._from.rectangleSize2(e),this._from.cornerRadii2(t),this._to.rectangleSize2(n),this._to.cornerRadii2(o),this._shouldTransitionGeometryForRoundedRectangles=!0,this}transformOrigin(e,t){return this._from.transformOrigin2(e),this._to.transformOrigin2(t),this}fillPaints1(e,t){return this._from.fillPaints2(e),this._to.fillPaints2(t),this}strokePaints1(e,t){return this._from.strokePaints2(e),this._to.strokePaints2(t),this}_getPaints(e,t,n){let o=[];for(let i=0,a=t.length;i<a;i=i+1){let s=t[i],l=n[i];if(s.equals2(l))o.push(s);else{let d=s,c=l;d.opacity()==0&&(d=l.cloneAsSinglePaint(),d.setOpacity(0)),c.opacity()==0&&(c=s.cloneAsSinglePaint(),c.setOpacity(0)),o.push(_d.create(d,c,this._from.transformOrigin1().multiplyScalar(2),this._to.transformOrigin1().multiplyScalar(2),e))}}return o}fillGeometryForRoundedRectangles(e,t){if(!this._shouldTransitionGeometryForRoundedRectangles||this._from.rectangleSize1()==null||this._to.rectangleSize1()==null)return null;let n=Math.max(1-t.top(),t.bottom(),1),o=G.new4(fe.FrozenVector_ZERO,this._from.rectangleSize1().multiplyScalar(n).max(this._to.rectangleSize1().multiplyScalar(n))),i=new Ed("NONZERO",0,()=>{let a=b.lerp(this._from.rectangleSize1(),this._to.rectangleSize1(),e()),s=this._from.cornerRadii1().toList(),l=this._to.cornerRadii1().toList(),d=[];for(let c=0;c<4;c=c+1)d.push(Math.max(kt.double_lerp(s[c],l[c],e()),0));return new St(new G(0,0,Math.abs(a.x()),Math.abs(a.y())),Ao.fromList(d))},o);return new wr([i],[],o,null)}fillGeometryForSpreadDynamic(e,t,n,o,i,a){if(!this._shouldTransitionGeometryForRoundedRectangles||this._from.rectangleSize1()==null||this._to.rectangleSize1()==null)return null;let s=this._from.rectangleSize1().addScalar(2*t),l=this._to.rectangleSize1().addScalar(2*t),d=Math.max(1-a.top(),a.bottom(),1),c=G.new4(fe.FrozenVector_ZERO,this._from.rectangleSize1().multiplyScalar(d).max(this._to.rectangleSize1().multiplyScalar(d))).expandedBy1(t),p=this._from.cornerRadii1().toList(),u=this._to.cornerRadii1().toList();for(let h=0;h<4;h=h+1)p[h]=p[h]==0?0:p[h]+t,u[h]=u[h]==0?0:u[h]+t;let _=new Ed("NONZERO",0,()=>{let h=b.lerp(s,l,n()),S=[];for(let m=0;m<4;m=m+1)S.push(Math.max(kt.double_lerp(p[m],u[m],n()),0));return new St(new G(-t,-t,Math.abs(h.x()),Math.abs(h.y())),Ao.fromList(S))},c);return new Bl(()=>new Et(_.path(),_.windingRule),o,_.bounds(),ft.forDynamicGeometry(i))}fillPaints2(e){return this._getPaints(e,this._from.fillPaints1(),this._to.fillPaints1())}strokePaints2(e){return this._getPaints(e,this._from.strokePaints1(),this._to.strokePaints1())}setTextDecorationPaints(e){return this._getPaints(e,this._from.textDecorationPaints(),this._to.textDecorationPaints())}hasTransitioningPaints(){return this._to.fillPaints1().length!=0&&this._from.fillPaints1().length!=0||this._to.strokePaints1().length!=0&&this._from.strokePaints1().length!=0||this._to.textDecorationPaints().length!=0&&this._from.textDecorationPaints().length!=0}hasLegacyTransitioningSizesForImageRect(){return this._shouldDoLegacyImageRectSizeTransition}hasTransitioningGeometryForRoundedRectangles(){return this._shouldTransitionGeometryForRoundedRectangles}hasTransitioningTranslation(){return this._from.translation1()==null&&this._to.translation1()==null?!1:this._from.translation1()==null||this.to().translation1()==null?!0:!this._from.translation1().equals(this.to().translation1())}hasTransitioningTransform(){return this._from.transform1()==null&&this._to.transform1()==null?!1:this._from.transform1()==null||this.to().transform1()==null?!0:!this._from.transform1().equals1(this.to().transform1())}hasTransitioningScaling(){return this._from.scaling1()==null&&this._to.scaling1()==null?!1:this._from.scaling1()==null||this.to().scaling1()==null?!0:!this._from.scaling1().equals(this.to().scaling1())}hasTransitioningTransformOrigin(){return this._from.transformOrigin1()==null&&this._to.transformOrigin1()==null?!1:this._from.transformOrigin1()==null||this.to().transformOrigin1()==null?!0:!this._from.transformOrigin1().equals(this.to().transformOrigin1())}interpolateOpacity(e){return kt.double_clamp(kt.double_lerp(this.from().opacity1(),this.to().opacity1(),e),0,1)}interpolateTranslation(e){return b.lerp(this.from().translation1(),this.to().translation1(),e)}interpolateTransform(e){let t=this.from().transform1(),n=this.to().transform1();if(t.toAngle()!=n.toAngle()&&this.from().transformOrigin1()!=null&&this.to().transformOrigin1()!=null){let o=t.clone().translatedBy1(this.from().transformOrigin1()),i=n.clone().translatedBy1(this.to().transformOrigin1()),a=to.lerp1(o,i,e),s=b.lerp(this.from().transformOrigin1(),this.to().transformOrigin1(),e),l=J.new2().translatedBy1(s.negative());return a.multiply(l),a}else return this._isTransformEqual?t:to.lerp1(t,n,e)}interpolateScaling(e){return b.lerp(this.from().scaling1(),this.to().scaling1(),e)}clone(){return new r(this)}withScaledTranslation(e){let t=this.clone();return t._from=t._from.withScaledTranslation(e),t._to=t._to.withScaledTranslation(e),t}},he=class he{constructor(){this._reversed=null;arguments.length==0?(this._enteringFrameTransition=new un,this._exitingFrameTransition=new un,this._drawsEnteringFrameOnTopOfExitingFrame=!0,this._isDissolve=!1):arguments.length==4&&(this._enteringFrameTransition=arguments[0],this._exitingFrameTransition=arguments[1],this._drawsEnteringFrameOnTopOfExitingFrame=arguments[2],this._isDissolve=arguments[3])}enteringFrameTransition(){return this._enteringFrameTransition}exitingFrameTransition(){return this._exitingFrameTransition}drawsEnteringFrameOnTopOfExitingFrame(){return this._drawsEnteringFrameOnTopOfExitingFrame}isDissolve(){return this._isDissolve}enteringFrameTranslation(e,t){return this._enteringFrameTransition.translation(e,t),this._reversed=null,this}enteringFrameOpacity(e,t){return this._enteringFrameTransition.opacity(e,t),this._reversed=null,this}exitingFrameTranslation(e,t){return this._exitingFrameTransition.translation(e,t),this._reversed=null,this}exitingFrameOpacity(e,t){return this._exitingFrameTransition.opacity(e,t),this._reversed=null,this}drawExitingFrameOnTopOfEnteringFrame(){return this._drawsEnteringFrameOnTopOfExitingFrame=!1,this._reversed=null,this}dissolve(){return this._isDissolve=!0,this._reversed=null,this}freeze(){return this}clone(){return new he(this._enteringFrameTransition.clone(),this._exitingFrameTransition.clone(),this._drawsEnteringFrameOnTopOfExitingFrame,this._isDissolve)}reversed(){if(this._reversed==null){let e=new he().enteringFrameTranslation(this.exitingFrameTransition().to().translation1(),this.exitingFrameTransition().from().translation1()).enteringFrameOpacity(this.exitingFrameTransition().to().opacity1(),this.exitingFrameTransition().from().opacity1()).exitingFrameTranslation(this.enteringFrameTransition().to().translation1(),this.enteringFrameTransition().from().translation1()).exitingFrameOpacity(this.enteringFrameTransition().to().opacity1(),this.enteringFrameTransition().from().opacity1());this.isDissolve()&&e.dissolve(),this.drawsEnteringFrameOnTopOfExitingFrame()&&e.drawExitingFrameOnTopOfEnteringFrame(),this._reversed=e}return this._reversed}withScaledTranslation(e){return new he(this._enteringFrameTransition.withScaledTranslation(e),this._exitingFrameTransition.withScaledTranslation(e),this._drawsEnteringFrameOnTopOfExitingFrame,this._isDissolve)}static get(e){switch(e){case"INSTANT_TRANSITION":return he.INSTANT_TRANSITION;case"DISSOLVE":return he.DISSOLVE;case"SMART_ANIMATE":return he.DISSOLVE;case"SLIDE_FROM_LEFT":return he.SLIDE_FROM_LEFT;case"SLIDE_FROM_RIGHT":return he.SLIDE_FROM_RIGHT;case"SLIDE_FROM_TOP":return he.SLIDE_FROM_TOP;case"SLIDE_FROM_BOTTOM":return he.SLIDE_FROM_BOTTOM;case"PUSH_FROM_LEFT":return he.PUSH_FROM_LEFT;case"PUSH_FROM_RIGHT":return he.PUSH_FROM_RIGHT;case"PUSH_FROM_TOP":return he.PUSH_FROM_TOP;case"PUSH_FROM_BOTTOM":return he.PUSH_FROM_BOTTOM;case"MOVE_FROM_LEFT":return he.MOVE_FROM_LEFT;case"MOVE_FROM_RIGHT":return he.MOVE_FROM_RIGHT;case"MOVE_FROM_TOP":return he.MOVE_FROM_TOP;case"MOVE_FROM_BOTTOM":return he.MOVE_FROM_BOTTOM;case"SLIDE_OUT_TO_LEFT":return he.SLIDE_OUT_TO_LEFT;case"SLIDE_OUT_TO_RIGHT":return he.SLIDE_OUT_TO_RIGHT;case"SLIDE_OUT_TO_TOP":return he.SLIDE_OUT_TO_TOP;case"SLIDE_OUT_TO_BOTTOM":return he.SLIDE_OUT_TO_BOTTOM;case"MOVE_OUT_TO_LEFT":return he.MOVE_OUT_TO_LEFT;case"MOVE_OUT_TO_RIGHT":return he.MOVE_OUT_TO_RIGHT;case"MOVE_OUT_TO_TOP":return he.MOVE_OUT_TO_TOP;case"MOVE_OUT_TO_BOTTOM":return he.MOVE_OUT_TO_BOTTOM;case"FADE":return he.DISSOLVE;case"MAGIC_MOVE":return he.DISSOLVE}throw new Error(`Unhandled transition type ${e}`)}};he.SLIDE_BACK_FRAME_OPACITY_START=1,he.SLIDE_BACK_FRAME_OPACITY_END=.5,he.OFFSCREEN_LEFT=new b(-1,0),he.OFFSCREEN_RIGHT=new b(1,0),he.OFFSCREEN_TOP=new b(0,-1),he.OFFSCREEN_BOTTOM=new b(0,1),he.CENTER=b.new(),he.INSTANT_TRANSITION=new he().freeze(),he.DISSOLVE=new he().dissolve().freeze(),he.SLIDE_FROM_LEFT=new he().enteringFrameTranslation(he.OFFSCREEN_LEFT,he.CENTER).exitingFrameTranslation(he.CENTER,he.OFFSCREEN_RIGHT.divideScalar(4)).exitingFrameOpacity(he.SLIDE_BACK_FRAME_OPACITY_START,he.SLIDE_BACK_FRAME_OPACITY_END).freeze(),he.SLIDE_FROM_RIGHT=new he().enteringFrameTranslation(he.OFFSCREEN_RIGHT,he.CENTER).exitingFrameTranslation(he.CENTER,he.OFFSCREEN_LEFT.divideScalar(4)).exitingFrameOpacity(he.SLIDE_BACK_FRAME_OPACITY_START,he.SLIDE_BACK_FRAME_OPACITY_END).freeze(),he.SLIDE_FROM_TOP=new he().enteringFrameTranslation(he.OFFSCREEN_TOP,he.CENTER).exitingFrameTranslation(he.CENTER,he.OFFSCREEN_BOTTOM.divideScalar(4)).exitingFrameOpacity(he.SLIDE_BACK_FRAME_OPACITY_START,he.SLIDE_BACK_FRAME_OPACITY_END).freeze(),he.SLIDE_FROM_BOTTOM=new he().enteringFrameTranslation(he.OFFSCREEN_BOTTOM,he.CENTER).exitingFrameTranslation(he.CENTER,he.OFFSCREEN_TOP.divideScalar(4)).exitingFrameOpacity(he.SLIDE_BACK_FRAME_OPACITY_START,he.SLIDE_BACK_FRAME_OPACITY_END).freeze(),he.SLIDE_OUT_TO_LEFT=he.SLIDE_FROM_RIGHT.reversed(),he.SLIDE_OUT_TO_RIGHT=he.SLIDE_FROM_LEFT.reversed(),he.SLIDE_OUT_TO_TOP=he.SLIDE_FROM_BOTTOM.reversed(),he.SLIDE_OUT_TO_BOTTOM=he.SLIDE_FROM_TOP.reversed(),he.PUSH_FROM_LEFT=new he().enteringFrameTranslation(he.OFFSCREEN_LEFT,he.CENTER).exitingFrameTranslation(he.CENTER,he.OFFSCREEN_RIGHT).freeze(),he.PUSH_FROM_RIGHT=he.PUSH_FROM_LEFT.reversed(),he.PUSH_FROM_TOP=new he().enteringFrameTranslation(he.OFFSCREEN_TOP,he.CENTER).exitingFrameTranslation(he.CENTER,he.OFFSCREEN_BOTTOM).freeze(),he.PUSH_FROM_BOTTOM=he.PUSH_FROM_TOP.reversed(),he.MOVE_FROM_LEFT=new he().enteringFrameTranslation(he.OFFSCREEN_LEFT,he.CENTER).freeze(),he.MOVE_FROM_RIGHT=new he().enteringFrameTranslation(he.OFFSCREEN_RIGHT,he.CENTER).freeze(),he.MOVE_FROM_TOP=new he().enteringFrameTranslation(he.OFFSCREEN_TOP,he.CENTER).freeze(),he.MOVE_FROM_BOTTOM=new he().enteringFrameTranslation(he.OFFSCREEN_BOTTOM,he.CENTER).freeze(),he.MOVE_OUT_TO_LEFT=he.MOVE_FROM_RIGHT.reversed(),he.MOVE_OUT_TO_RIGHT=he.MOVE_FROM_LEFT.reversed(),he.MOVE_OUT_TO_TOP=he.MOVE_FROM_BOTTOM.reversed(),he.MOVE_OUT_TO_BOTTOM=he.MOVE_FROM_TOP.reversed();var Tr=he;var tc=class tc{constructor(e,t){this.hotspotStablePath=e,this.interactionId=t}};tc.EXTERNAL_INTERACTION_ID=X._new(-1,-2),tc.EXTERNAL=new tc(null,tc.EXTERNAL_INTERACTION_ID);var so=tc,kr=class r{static getDefault(){return new r("INSTANT_TRANSITION",0,null,!1,fe.FrozenVector_new1(),"NAVIGATE",!1,fe.FrozenVector_new1(),!1,!0,!1,!1,1,"NONE")}static fromPrototypeAction(e,t){return e==null?r.getDefault():new r(e.transitionType(),e.transitionDuration(),e.easingFunction,e.transitionShouldSmartAnimate(),e.overlayRelativePosition(),e.navigationType(),e.transitionPreserveScroll(),e.extraScrollOffset(),e.transitionResetVideoPosition(),e.openUrlInNewTab(),e.transitionResetScrollPosition(),e.transitionResetInteractiveComponents(),t,e.animationType())}withTransitionPreserveScroll(e){return new r(this.transitionType,this.transitionDuration,this.easingFunction,this.transitionShouldSmartAnimate,this.overlayRelativePosition,this.navigationType,e,this.extraScrollOffset,this.transitionResetVideoPosition,this.openUrlInNewTab,this.transitionResetScrollPosition,this.transitionResetInteractiveComponents,this.stateManagementVersion,this.animationType)}withDefaultStateManagementSettings(){return new r(this.transitionType,this.transitionDuration,this.easingFunction,this.transitionShouldSmartAnimate,this.overlayRelativePosition,this.navigationType,this.transitionPreserveScroll,this.extraScrollOffset,!1,this.openUrlInNewTab,!1,!1,this.stateManagementVersion,this.animationType)}withStateManagementSettings(e){return e==null?this:new r(this.transitionType,this.transitionDuration,this.easingFunction,this.transitionShouldSmartAnimate,this.overlayRelativePosition,this.navigationType,this.transitionPreserveScroll,this.extraScrollOffset,e.transitionResetVideoPosition,this.openUrlInNewTab,e.transitionResetScrollPosition,e.transitionResetInteractiveComponents,e.stateManagementVersion,e.animationType)}constructor(e,t,n,o,i,a,s,l,d,c,p,u,_,h){this.transitionType=e,this.transitionDuration=t,this.easingFunction=n,this.transitionShouldSmartAnimate=o,this.overlayRelativePosition=i,this.navigationType=a,this.transitionPreserveScroll=s,this.extraScrollOffset=l,this.transitionResetVideoPosition=d,this.openUrlInNewTab=c,this.transitionResetScrollPosition=p,this.transitionResetInteractiveComponents=u,this.stateManagementVersion=_,this.animationType=h}},lo=class{constructor(e,t){this.interactionId=e,this.actionIndex=t}debugString(){return`[animationState] interactionId: ${this.interactionId}, actionIndex: ${this.actionIndex}`}compareTo(e,t){let n=-1,o=-1;if(t.forEach((i,a)=>{let s=i.id();s===this.interactionId&&(n=a),s===e.interactionId&&(o=a)}),!(n<0||o<0))return this.interactionId===e.interactionId?this.actionIndex-e.actionIndex:n-o}},cr=class{topId(){return this.overlays.length>0?ne.List_last(this.overlays).id:this.stateId}debugString(e){let t=a=>{let s=e.findNode(a);return`[nodeId.toString]: ${(s==null?void 0:s.name())??"null"}`},n="  ",o="[";for(let a=0,s=this.overlays.length;a<s;a=a+1){let l=this.overlays[a];o+=n+t(l.id),a!=this.overlays.length-1&&(o+=`,
`)}o+="]";let i=this.animationState?this.animationState.debugString():"";return`PresentedState(
`+n+t(this.stateId)+`,
`+n+o+i+`
)`}statesAndOverlaysIncluded(){let e=new Set;this.stateId!=null&&X.isValid(this.stateId)&&e.add(this.stateId);for(let t of this.overlays)X.isValid(t.id)&&e.add(t.id);return e}constructor(e,t,n=null){this.stateId=e,this.overlays=t,this.animationState=n}},Hr=class r{constructor(){if(arguments[0]==0){let[,e]=arguments;this.stablePath=null,this.oldStateAndOverlays=null,this.newStateAndOverlays=null,this.cause=0,this.canvasSpaceTriggerBoundsOrNull=null,this.direction=0,this.transitionParameters=kr.getDefault(),this.interactionAddress=so.EXTERNAL,this.stablePath=e,this.oldStateAndOverlays=new cr(null,[]),this.newStateAndOverlays=new cr(null,[])}else if(arguments[0]==1){let[,e,t,n]=arguments;this.stablePath=null,this.oldStateAndOverlays=null,this.newStateAndOverlays=null,this.cause=0,this.canvasSpaceTriggerBoundsOrNull=null,this.direction=0,this.transitionParameters=kr.getDefault(),this.interactionAddress=so.EXTERNAL,this.stablePath=e,this.oldStateAndOverlays=t,this.newStateAndOverlays=n}else if(arguments[0]==2){let[,e,t,n,o,i,a,s]=arguments;this.stablePath=null,this.oldStateAndOverlays=null,this.newStateAndOverlays=null,this.cause=0,this.canvasSpaceTriggerBoundsOrNull=null,this.direction=0,this.transitionParameters=kr.getDefault(),this.interactionAddress=so.EXTERNAL,this.stablePath=e,this.oldStateAndOverlays=new cr(t,[]),this.newStateAndOverlays=new cr(n,[]),this.direction=0,this.cause=s,this.interactionAddress=o,this.transitionParameters=a,this.canvasSpaceTriggerBoundsOrNull=i}else if(arguments[0]==3){let[,e,t,n,o,i,a,s,l]=arguments;this.stablePath=null,this.oldStateAndOverlays=null,this.newStateAndOverlays=null,this.cause=0,this.canvasSpaceTriggerBoundsOrNull=null,this.direction=0,this.transitionParameters=kr.getDefault(),this.interactionAddress=so.EXTERNAL,this.stablePath=e,this.oldStateAndOverlays=t,this.newStateAndOverlays=n,this.direction=s,this.cause=l,this.interactionAddress=o,this.transitionParameters=a,this.canvasSpaceTriggerBoundsOrNull=i}else if(arguments[0]==4){let[,e,t,n,o,i,a,s]=arguments;this.stablePath=null,this.oldStateAndOverlays=null,this.newStateAndOverlays=null,this.cause=0,this.canvasSpaceTriggerBoundsOrNull=null,this.direction=0,this.transitionParameters=kr.getDefault(),this.interactionAddress=so.EXTERNAL,this.stablePath=e,this.oldStateAndOverlays=t,this.newStateAndOverlays=n,this.interactionAddress=i,this.direction=a,this.transitionParameters=s,this.cause=o}}static forClosingTopNOverlays(e,t,n,o,i,a){let l=n[n.length-e].openingTransition.withTransitionPreserveScroll(!0).withDefaultStateManagementSettings();return new r(3,ut.ROOT_STABLE_PATH(),new cr(t,n),new cr(t,n.slice(0,n.length-e)),o,i,l,1,a)}oldStateId(){var e;return(e=this.oldStateAndOverlays)==null?void 0:e.stateId}newStateId(){var e;return(e=this.newStateAndOverlays)==null?void 0:e.stateId}oldObjectAnimationState(){var e;return(e=this.oldStateAndOverlays)==null?void 0:e.animationState}newObjectAnimationState(){var e;return(e=this.newStateAndOverlays)==null?void 0:e.animationState}isObjectAnimation(){return this.newObjectAnimationState()!=null}isBaseScreenTransition(){return this.oldStateId()!==this.newStateId()}objectAnimationTargetNode(e){let t=this.newObjectAnimationState();if(!t)return null;let n=this.newStateId(),o=e.findNode(n);if(!o)throw new Error("Expected slide node");let i=o.objectAnimations().find(l=>l.id()===t.interactionId);if(!i)throw new Error("Could not find interaction matching the prototype state change's interaction id");if(i.actions().length===0)throw new Error("Expected interaction with at least one action");let a=t.actionIndex;if(a<0||a>=i.actions().length)throw new Error("Action index out of bounds");let s=i.actions()[a].transitionNodeID();return e.findNode(s)}canInstantlyCommit(){return this.direction==0?!1:this.transitionParameters.transitionType=="INSTANT_TRANSITION"||this.transitionParameters.animationType!="NONE"}oldOverlayData(){var e;return(e=this.oldStateAndOverlays)==null?void 0:e.overlays}newOverlayData(){var e;return(e=this.newStateAndOverlays)==null?void 0:e.overlays}oldOverlays(e){var t;return e.bindOverlays((t=this.oldStateAndOverlays)==null?void 0:t.overlays)}newOverlays(e){var t;return e.bindOverlays((t=this.newStateAndOverlays)==null?void 0:t.overlays)}isTransientChange(e){let t=X.equals(this.oldStateAndOverlays.stateId,this.newStateAndOverlays.stateId);switch(this.transitionParameters.navigationType){case"OVERLAY":case"SWAP":case"SCROLL_TO":return!0;default:break}return(e?$e.isForwardTransientAction(this.cause):$e.isTransientAction(this.cause))||t}debugString(e){var t,n;return`${(t=this.oldStateAndOverlays)==null?void 0:t.debugString(e)}
=>
${(n=this.newStateAndOverlays)==null?void 0:n.debugString(e)}`}easingFunction(){return this.transitionParameters.easingFunction}preserveScroll(){return this.transitionParameters.transitionPreserveScroll?1:0}resetScroll(){return this.transitionParameters.transitionResetScrollPosition?0:1}resetInteractiveComponents(){return this.transitionParameters.transitionResetInteractiveComponents?0:1}stateManagementVersion(){return this.transitionParameters.stateManagementVersion}getFramePairTransition(){let e=Tr.get(this.transitionParameters.transitionType);return this.direction==1?e.reversed():e}getNewOrChangedFrames(e){let t=[];if(!X.equals(this.oldStateId(),this.newStateId())&&this.newStateId()!=null){let n=e.findNode(this.newStateId());n!=null&&t.push(n)}for(let n=0,o=this.newOverlayData().length;n<o;n=n+1)if(n>=this.oldOverlayData().length||!X.equals(this.oldOverlayData()[n].id,this.newOverlayData()[n].id)){let i=e.findNode(this.newOverlayData()[n].id);i!=null&&t.push(i)}return t}getInsertedFrameIds(){let e=[];!X.equals(this.oldStateId(),this.newStateId())&&this.newStateId()!=null&&e.push(this.newStateId());let t=new Dn;this.oldOverlayData().forEach(n=>{t.add(n.id)});for(let n=0,o=this.newOverlayData().length;n<o;n=n+1){let i=this.newOverlayData()[n].id;t._in(i)||e.push(i)}return e}getRemovedFrameIds(){let e=[];!X.equals(this.oldStateId(),this.newStateId())&&this.newStateId()!=null&&e.push(this.oldStateId());let t=new Dn;this.newOverlayData().forEach(n=>{t.add(n.id)});for(let n=0,o=this.oldOverlayData().length;n<o;n=n+1){let i=this.oldOverlayData()[n].id;t._in(i)||e.push(i)}return e}},Wn=class r{static getDefaultExternalExecution(){return new r(so.EXTERNAL,kr.getDefault(),null)}static forNoodle(e,t,n){let o=new so(r.stablePathForHotspot(e),t.id()),i=t.action().value;if(n!=null)i=n;else for(let l of t.getAllValidTransitionActionsInInteraction()){i=l;break}let a=kr.fromPrototypeAction(i,t.stateManagementVersion()),s=t.event().interactionType()=="ON_HOVER"?e.canvasSpaceInteractiveBounds():null;return new r(o,a,s)}static forExternalOpenOverlay(e){let t=new so(r.stablePathForHotspot(e),X._new(-1,-2));return new r(t,kr.getDefault(),null)}static stablePathForHotspot(e){let t=null;return t=e.stablePath(),t}constructor(e,t,n){this.interactionAddress=e,this.transitionParameters=t,this.canvasSpaceTriggerBoundsOrNull=n}};function Xd(r){let e=r.slice();return e.sort((t,n)=>{let o=t.fullSizeCanvasSpaceBoundingBox(),i=n.fullSizeCanvasSpaceBoundingBox();return i.top()<=o.bottom()&&i.bottom()>=o.top()?o.x()==i.x()?Lo.string_compare(t.id(),n.id()):o.x()-i.x()|0:o.y()-i.y()|0}),e}function nb(r,e){let t=[];for(let o of e){let i=r.findNode(o);i!=null&&t.push(i)}return Xd(t).map(o=>o.id())}var rc=(n=>(n[n.FRAME_LIST=0]="FRAME_LIST",n[n.NONLINEAR=1]="NONLINEAR",n[n.SLIDESHOW=2]="SLIDESHOW",n))(rc||{}),Ah=class{constructor(e){this._appState=e}getNextBaseScreenNode(){let e=this.getNextBaseScreenId();return e?this._appState.scene().findNode(e):null}getNextObjectAnimation(){return null}getPreviousObjectAnimation(){return null}getCurrentObjectAnimation(){return this._appState.prototypeState().getCurrentAnimationState()}getNavigateForwardEnabled(){return this.getNextBaseScreenId()!=null||this.getNextObjectAnimation()!=null||this.shouldCommitInitiatedChangeOnNavigate()&&this._appState.prototypeState().getInitiatedChange()!==null}getNavigateBackwardEnabled(){return this._appState.prototypeState().getPreviousBaseScreenId()!=null||this.getCurrentObjectAnimation()!=null}shouldCommitInitiatedChangeOnNavigate(){return Y.getFeatureFlags().viewer_commit_only_on_navigate??!1}navigationOrderTypeString(){return rc[this.navigationOrderType()]}},Sh=class extends Ah{navigationOrderType(){return 1}isLinear(){return!1}getNextBaseScreenId(){let e=this._appState.prototypeState().getCurrentBaseScreenIndex(),t=this.topLevelPrototypeNodesInOrder();return e<0?null:e>=t.length-1?this._appState.prototypeState().getUpcomingTlf():X.fromString(t[e+1])}topLevelPrototypeNodesInOrder(){return this._appState.prototypeState().getTlfHistory()}nodeToRestartPrototypeOn(e){if(e==null||e.type()!="CANVAS"&&e.type()!="SECTION")return null;let t=this._appState.prototypeStructure().activePrototypeStartNodeOrDefault();if(t!=null)return t;let n=ls.visuallySortedTopLevelFrames(e);return n.length>0?n[0]:null}},Th=class extends Ah{isLinear(){return!0}getNextBaseScreenId(){let e=this._appState.prototypeState().getCurrentBaseScreenIndex(),t=this.topLevelPrototypeNodesInOrder();return e<0||e>=t.length-1?null:X.fromString(t[e+1])}static visuallySortedTopLevelFrames(e){if(e==null)return[];let t=[];for(let i of e.children())N().isOrContainsBaseScreen(i.id())&&t.push(i);let n=Xd(t),o=[];for(let i of n)i.type()!="SECTION"?o.push(i):Ir(o,ls.visuallySortedTopLevelFrames(i));return o}},ls=class r extends Th{navigationOrderType(){return 0}topLevelPrototypeNodesInOrder(){let e=this._appState.getActiveCanvas();return e==null?[]:r.visuallySortedTopLevelFrames(e).map(t=>t.id())}nodeToRestartPrototypeOn(e){if(e==null||e.type()!="CANVAS"&&e.type()!="SECTION")return null;let t=this._appState.prototypeStructure().activePrototypeStartNodeOrDefault();if(t!=null)return t;let n=r.visuallySortedTopLevelFrames(e);return n.length>0?n[0]:null}static visuallySortedTopLevelFrames(e){if(e==null)return[];let t=[];for(let i of e.children())N().isOrContainsBaseScreen(i.id())&&t.push(i);let n=Xd(t),o=[];for(let i of n)i.type()!="SECTION"?o.push(i):Ir(o,r.visuallySortedTopLevelFrames(i));return o}},qd=class extends Th{navigationOrderType(){return 2}getNextObjectAnimation(){if(!Y.getFeatureFlags().piper_object_animations)return null;let e=this._appState.prototypeState().getCurrentBaseScreenNode();if(!e)return null;let t=e.objectAnimations();if(t.length==0)return null;let n=this._appState.prototypeState().getCurrentAnimationState();if(n==null)return new lo(t[0].id(),0);{let o=t.findIndex(a=>a.id()===n.interactionId);if(o===-1)return null;let i=t[o];return n.actionIndex+1<i.getAllActions().length?new lo(i.id(),n.actionIndex+1):o+1<t.length?new lo(t[o+1].id(),0):null}}getPreviousObjectAnimation(){if(!Y.getFeatureFlags().piper_object_animations)return null;let e=this._appState.prototypeState().getCurrentBaseScreenNode();if(!e||e.objectAnimations().length==0)return null;let t=this._appState.prototypeState().getCurrentAnimationState();if(t==null)return null;{let n=e.objectAnimations().findIndex(i=>i.id()===t.interactionId);if(n===-1||n===0)return null;let o=e.objectAnimations()[n-1];return new lo(o.id(),o.getAllActions().length-1)}}shouldCommitInitiatedChangeOnNavigate(){return!0}topLevelPrototypeNodesInOrder(){let e=this._appState.getActiveCanvas();if(e==null)return[];let t=e.children().find(o=>(o==null?void 0:o.type())==="SLIDE_GRID");if(t==null)return[];let n=[];return t.forEachDescendantPreorder(o=>{o.type()=="SLIDE"&&o.isVisibleInCanvas()&&!o.isSkippedSlide()&&n.push(o)}),n.map(o=>o.id())}nodeToRestartPrototypeOn(e){let t=this.topLevelPrototypeNodesInOrder();return t.length>0?this._appState.scene().findNode(X.fromString(t[0])):null}};var Zd=class r{constructor(e,t,n,o,i,a,s){this.id=null,this.overlayDataModelId=null,this.openingHotspotStablePath=null,this.openingInteractionId=null,this.openingTransition=null,this.oldOverlayDerivedModes=null,this.newOverlayExplicitModes=null,this.id=e,this.overlayDataModelId=t,this.openingHotspotStablePath=n,this.openingInteractionId=o,this.openingTransition=i,this.oldOverlayDerivedModes=a,this.newOverlayExplicitModes=s}cloneWithId(e,t){return new r(e,this.overlayDataModelId,this.openingHotspotStablePath,this.openingInteractionId,this.openingTransition,t)}openingTransitionType(){return this.openingTransition.transitionType}},nc=class{constructor(e,t,n,o,i,a,s,l){this.overlayId=e,this.overlayNode=t,this.bounds=n,this.baseTlfCursor=o,this.backgroundAppearance=i,this.backgroundTransitionProgress=a,this.transform=s,this.animationTransform=l}},Oa=class{constructor(e=new Map){this._hasTransitionComputed=!1;this._hasTransition=!1;this._multiOverlayMap=e}hasTransition(){if(this._hasTransitionComputed)return this._hasTransition;for(let e of Array.from(this._multiOverlayMap.keys()))if(this._multiOverlayMap.get(e).backgroundTransitionProgress!=null||this._multiOverlayMap.get(e).transform!=null||this._multiOverlayMap.get(e).animationTransform!=null){this._hasTransition=!0,this._hasTransitionComputed=!0;break}return this._hasTransition}count(){return this._multiOverlayMap.size}addEntry(e,t){this._multiOverlayMap.set(e,t),this._hasTransitionComputed=!1}removeEntry(e){this._multiOverlayMap.delete(e),this._hasTransitionComputed=!1}get(e){return Ge.StringMap_get(this._multiOverlayMap,e,null)}keys(){return Array.from(this._multiOverlayMap.keys())}overlayCacheKey(){let e=[];for(let t of this.keys())e.push(t);return new ut(e)}},Jd=class{id(){return this._data.id}overlayDataModelId(){return this._data.overlayDataModelId}openingHotspotStablePath(){return this._data.openingHotspotStablePath}previousOverlay(){return this._previousOverlay}openingTransitionType(){return this._data.openingTransitionType()}node(){return this.scene.findNode(this.id())}backgroundInteraction(){let e=this.scene.findNode(this._data.overlayDataModelId);return e==null?"NONE":e.overlayBackgroundInteraction()}backgroundAppearance(){let e=this.scene.findNode(this._data.overlayDataModelId);return e==null?new vi:e.overlayBackgroundAppearance()}positionType(){let e=this.scene.findNode(this._data.overlayDataModelId);return e==null?"CENTER":e.overlayPositionType()}relativePosition(){return this._data.openingTransition.overlayRelativePosition}renderedOrigin(e){let t=this.node();if(t==null)return fe.FrozenVector_new1();let n=null;if(this.positionType()=="MANUAL"){if(this._stackPosition>0){let i=this.scene.findNode(this._previousOverlay.id()).canvasSpaceBoundingBox(),a=this._previousOverlay.renderedOrigin(e),s=this.scene.findNodeByStablePath(this.openingHotspotStablePath());s!=null&&(n=s.canvasSpaceScrolledBounds(1).topLeft().add(a.subtract(i.topLeft())))}if(n==null){let o=this.scene.findNodeByStablePath(this.openingHotspotStablePath());o!=null&&(n=o.canvasSpaceScrolledBounds(1).topLeft())}if(n==null)return fe.FrozenVector_new1()}return jd.BoundOverlay_computeOrigin(t,e,this._data.openingTransition,n,this.positionType())}renderedBounds(e){let t=this.scene.findNode(this._data.id);if(t==null)return Yr.FrozenRect_new1();let n=t.canvasSpaceBoundingBox().size(),o=this.renderedOrigin(e);return Yr.FrozenRect_new4(o.x(),o.y(),n.x(),n.y())}deltaFromRenderedPositionToCanvasSpacePosition(e){let t=this.scene.findNode(this._data.id);return t==null?new b(0,0):this.renderedOrigin(e).subtract(t.canvasSpaceBoundingBox().topLeft())}baseTlfSpaceToOverlaySpace1(e,t){let n=this.scene.findNode(this._data.id);if(n==null||t==null||e==null)return fe.FrozenVector_ZERO;let o=this.renderedOrigin(e),i=n.canvasSpaceBoundingBox().topLeft();return t.add(i).subtract(o)}baseTlfSpaceToOverlaySpace2(e,t){return G.new4(this.baseTlfSpaceToOverlaySpace1(e,t.topLeft()),t.size())}overlaySpaceToBaseTlfSpace1(e,t){let n=this.baseTlfSpaceToOverlaySpace1(e,t);return t.add(t.subtract(n))}overlaySpaceToBaseTlfSpace2(e,t){return G.new4(this.overlaySpaceToBaseTlfSpace1(e,t.topLeft()),t.size())}constructor(e,t,n,o){this.scene=e,this._data=t,this._previousOverlay=n,this._stackPosition=o}},jd;(t=>{function r(n,o,i,a,s){if(n==null)return b.new();let l=n.canvasSpaceBoundingBox().size();if(s=="MANUAL")return new b(a.x()+i.overlayRelativePosition.x(),a.y()+i.overlayRelativePosition.y());{let d=o.canvasSpaceBoundingBox(),c=d.topLeft(),p=d.size(),u=c.x();switch(s){case"TOP_LEFT":case"BOTTOM_LEFT":break;case"TOP_CENTER":case"CENTER":case"BOTTOM_CENTER":{u+=p.x()/2-l.x()/2;break}case"TOP_RIGHT":case"BOTTOM_RIGHT":{u+=p.x()-l.x();break}}let _=c.y();switch(s){case"TOP_LEFT":case"TOP_CENTER":case"TOP_RIGHT":break;case"CENTER":{_+=p.y()/2-l.y()/2;break}case"BOTTOM_LEFT":case"BOTTOM_CENTER":case"BOTTOM_RIGHT":{_+=p.y()-l.y();break}}return new b(u,_)}}t.BoundOverlay_computeOrigin=r;function e(n,o,i,a,s){let l=n.canvasSpaceBoundingBox().size(),d=r(n,o,i,a,s);return Yr.FrozenRect_new4(d.x(),d.y(),l.x(),l.y())}t.BoundOverlay_computeNewBounds=e})(jd||(jd={}));function ob(r){return r==="ON_HOVER"||r==="ON_PRESS"}var $d=class{constructor(e){this._noodleMap=new ji,this._cachedCleanedUpTransitionMapByTlf=null,this._scene=null,this._appState=null,this.triggerPotentialTimedTransition=null,this.triggerPotentialTimedTransitionForSpecificRootNode=null,this.createVideoTriggerEventsForNodesInFrame=null,this.createVideoTriggerEventsForAllNodesOnscreen=null,this._topmostScreenChangeCounter=0,this._appState=e,this._appState.addAppObserver(this)}_setPrototypeInteractionsInNoodleMap(e,t){t.some(o=>o.isValid())?this._noodleMap.update(e,t):this._noodleMap.update(e,[])}getStateGroupStateSwapInteractionCounts(){return this._noodleMap.stateGroupStateSwapInteractionCounts}_setHyperlinkInteractionInNoodleMap(e){if(Yt.isNodeInteractableBecauseOfHyperlinks(e)){let t=Yt.createFakeHyperlinkInteraction();this._setPrototypeInteractionsInNoodleMap(e,[t])}}cleanedUpMediaEndInteractionMap(){return this.cleanedUpInteractionMapForPrefilteredType(2)}cleanedUpMediaHitInteractionMap(){return this.cleanedUpInteractionMapForPrefilteredType(3)}cleanedUpInteractionMapForPrefilteredType(e){return new ji.CleanedMap(this._noodleMap,e,t=>{var i,a;let n=(i=this._scene)==null?void 0:i.findNode(t),o=(a=this._noodleMap.noodleNodes.get(t,null))==null?void 0:a.prefilteredInteractionsByType.get(e);return Yt.cleanedInteractionsForNodeFromDirtyInteractions(this._appState,n,o==null?void 0:o.asList())})}cleanedUpInteractionMap(){return new ji.CleanedMap(this._noodleMap,0,e=>{var n;let t=(n=this._scene)==null?void 0:n.findNode(e);return Yt.cleanedInteractionsForNode(this._appState,t)})}cleanedUpTransitionMap(){return new ji.CleanedMap(this._noodleMap,1,e=>{let t=[];return this.cleanedUpInteractionMap().getHotspotInteractions(e).forEach(n=>{n.interactionContainsTransitionAction()&&t.push(n)}),t})}cleanedUpTransitionMapByTLF(){if(this._cachedCleanedUpTransitionMapByTlf==null){let e=new eo(t=>t);for(let t of this.cleanedUpTransitionMap().hotspots()){let n=this._scene.findNode(t);if(n!=null){let o=null,i=n.topLevelAncestor();i!=null&&i.visible()&&(o=i.id()),o!=null&&(e._in(o)||e.set(o,[]),Ir(e.get(o),this.cleanedUpTransitionMap().getHotspotInteractions(t).slice()))}}this._cachedCleanedUpTransitionMapByTlf=e}return this._cachedCleanedUpTransitionMapByTlf}rawInteractionMapForTests(){return new ji.RawMapForTests(this._noodleMap)}handleSceneChange(e,t){this._scene=t,e!=null&&e.removeObserver(this),t!=null&&t.addObserver(this)}handleActiveCanvasChange(e,t){this._noodleMap.noodleNodes.clear(),this._noodleMap.stateGroupStateSwapInteractionCounts.clear(),this._noodleMap.guidsForPrefilterType.forEach(n=>n.clear()),this._noodleMap.queuedInteractionChanges=[],t!=null&&this._addConnectionsFromSubtree(t),this._cachedCleanedUpTransitionMapByTlf=null}handleActivePrototypeStartingPointChange(e,t){}_addConnectionsFromSubtree(e){this._setPrototypeInteractionsInNoodleMap(e,e.prototypeInteractions()),this._setHyperlinkInteractionInNoodleMap(e);for(let t=0,n=e.childCount();t<n;t=t+1){let o=e.childAt1(t);this._addConnectionsFromSubtree(o)}}_removeConnectionsFromSubtree(e){this._noodleMap.update(e,[]);for(let t=0,n=e.childCount();t<n;t=t+1)this._removeConnectionsFromSubtree(e.childAt1(t))}topmostScreenChangeCounter(){return this._topmostScreenChangeCounter}handleSceneGraphEvent(e){let t=!1;if((zn.isInteractionProperty(e.property)||zn.affects(e.property,90)||zn.affects(e.property,91))&&(e.node.isRooted()&&(this._setPrototypeInteractionsInNoodleMap(e.node,e.node.prototypeInteractions()),this._setHyperlinkInteractionInNoodleMap(e.node),t=!0),X.equals(this._appState.baseScreenId(),e.node.id())&&e.node.prototypeInteractions().forEach(n=>{this._topmostScreenChangeCounter=this._topmostScreenChangeCounter+1,n.event().interactionType()=="AFTER_TIMEOUT"?this.triggerPotentialTimedTransition!=null&&this.triggerPotentialTimedTransition():(n.event().interactionType()=="ON_MEDIA_HIT"||n.event().interactionType()=="ON_MEDIA_END")&&this.createVideoTriggerEventsForAllNodesOnscreen!=null&&this.createVideoTriggerEventsForAllNodesOnscreen()})),e.property==8||e.property==9||e.property==14||e.property==89)t=!0,this._noodleMap.invalidateBackRefsForDestinationAndChildren(e.node),this._noodleMap.invalidateHotspotAndChildren(e.node);else if(e.property==32){let n=e.oldVal!=null&&Je.isParentIndex(e.oldVal)?Je.asParentIndex(e.oldVal):null,o=e.newVal!=null&&Je.isParentIndex(e.newVal)?Je.asParentIndex(e.newVal):null,i=n!=null?e.node.scene().findNode(n.id):null,a=o!=null?e.node.scene().findNode(o.id):null,s=i!=null&&i.isRooted(),l=a!=null&&a.isRooted();s&&!l?(this._removeConnectionsFromSubtree(e.node),t=!0):!s&&l&&(this._addConnectionsFromSubtree(e.node),t=!0,this.createVideoTriggerEventsForNodesInFrame!=null&&this.createVideoTriggerEventsForNodesInFrame(e.node)),s&&l&&i.id()!=a.id()&&(t=!0),this._noodleMap.invalidateBackRefsForDestinationAndChildren(e.node)}e.property==8&&this.triggerPotentialTimedTransitionForSpecificRootNode!=null&&this.triggerPotentialTimedTransitionForSpecificRootNode(e.node),t&&(this._cachedCleanedUpTransitionMapByTlf=null)}};var Eh=class{invalidateCaches(){this.caches.set(0,null),this.caches.set(1,null),this.caches.set(2,null),this.caches.set(3,null)}constructor(){this.interactions=new ci(e=>e.id()),this.backReferences=new eo(e=>e),this.caches=new Map([[0,null],[1,null],[2,null],[3,null]]),this.prefilteredInteractionsByType=new Map}},Wg=new Map([[3,r=>r.event().interactionType()=="ON_MEDIA_HIT"],[2,r=>r.event().interactionType()=="ON_MEDIA_END"]]);var ji=class{constructor(){this.queuedInteractionChanges=[];this.noodleNodes=new eo(e=>e),this.stateGroupStateSwapInteractionCounts=new eo(e=>e),this.guidsForPrefilterType=new Map([[2,new ci(e=>e)],[3,new ci(e=>e)]])}update(e,t){var i,a,s;let n=((a=(i=this.noodleNodes.get(e.id(),null))==null?void 0:i.interactions)==null?void 0:a.asList())??[];for(let l=0,d=n.length;l<d;l=l+1){let c=n[l];this._eraseInteraction(e,c)}for(let l=0,d=t.length;l<d;l=l+1){let c=t[l];this._addInteraction(e,c)}let o=this.noodleNodes.get(e.id(),null);if(o!=null&&o.interactions.count()==0&&o.backReferences.count()==0){for(let l of Wg.keys())(s=this.guidsForPrefilterType.get(l))!=null&&s._in(e.id())&&Oe("Removing noodleNode which is still referenced in guidsForPrefilterType");this.noodleNodes.remove(e.id())}}_updateStateGroupSwapInteractionCounts(e,t,n){if(Y.shouldPreventVolatileCaching())return;if(Y&&!Y.viewerICCacheOpt()){this.stateGroupStateSwapInteractionCounts.clear();return}let o=e.getBackingSymbolParent();if(!(!o||!o.isStateGroup())){for(let i of t.allActions())if(i.navigationType()=="SWAP_STATE"){let a=this.stateGroupStateSwapInteractionCounts.get(o.id(),0),s=n?1:-1;this.stateGroupStateSwapInteractionCounts.set(o.id(),a+s)}}}_processQueuedInteractionChanges(){for(;this.queuedInteractionChanges.length>0;){let e=this.queuedInteractionChanges[0];switch(e.change){case 0:this._updatePrefilteredInteractionsForAddedInteraction(e.interaction,e.guid);case 1:this._updatePrefilteredInteractionsForRemovedInteraction(e.interaction,e.guid)}this.queuedInteractionChanges.shift()}}_addInteraction(e,t){let n=e.id(),o=this.noodleNodes.get(n,null)??new Eh;this.noodleNodes.set(n,o),o.interactions.add(t);for(let i of t.allActions()){let a=i.transitionNodeID();if(ib(a,i.connectionType())){let s=this.noodleNodes.get(a,null);s==null&&(s=new Eh,this.noodleNodes.set(a,s)),s.backReferences.set(n,s.backReferences.get(n,0)+1)}}o.invalidateCaches(),this._updateStateGroupSwapInteractionCounts(e,t,!0),Y?Y.viewerCreateVideoTriggersOpt()?(this._processQueuedInteractionChanges(),this._updatePrefilteredInteractionsForAddedInteraction(t,n)):this.queuedInteractionChanges=[]:this.queuedInteractionChanges.push({interaction:t,guid:n,change:0})}_updatePrefilteredInteractionsForAddedInteraction(e,t){let n=this.noodleNodes.get(t,null);e!=null&&n!=null&&Wg.forEach((o,i)=>{if(o(e)){let a=n.prefilteredInteractionsByType.get(i)??new ci(s=>s.id());n.prefilteredInteractionsByType.set(i,a),a.add(e),this.guidsForPrefilterType.get(i).add(t)}})}_eraseInteraction(e,t){let n=e.id(),o=this.noodleNodes.get(n,null);o!=null&&o.interactions.remove(t);for(let i of t.allActions()){let a=i.transitionNodeID();if(ib(a,i.connectionType())){let s=this.noodleNodes.get(a,null);s!=null&&(s.backReferences.set(n,s.backReferences.get(n)-1),s.backReferences.get(n)<=0&&s.backReferences.remove(n))}}o.invalidateCaches(),this._updateStateGroupSwapInteractionCounts(e,t,!1),Y?Y.viewerCreateVideoTriggersOpt()?(this._processQueuedInteractionChanges(),this._updatePrefilteredInteractionsForRemovedInteraction(t,n)):this.queuedInteractionChanges=[]:this.queuedInteractionChanges.push({interaction:t,guid:n,change:1})}_updatePrefilteredInteractionsForRemovedInteraction(e,t){let n=this.noodleNodes.get(t,null);if(e!=null&&n!=null)for(let o of Wg.keys()){let i=n.prefilteredInteractionsByType.get(o);i==null||i.remove(e),(!i||(i==null?void 0:i.count())<1)&&this.guidsForPrefilterType.get(o).remove(t)}}invalidateHotspotAndChildren(e){yn(e,t=>(this.noodleNodes._in(t.id())&&this.noodleNodes.get(t.id()).invalidateCaches(),0))}invalidateBackRefsForDestinationAndChildren(e){yn(e,t=>(this.noodleNodes._in(t.id())&&this.noodleNodes.get(t.id()).backReferences.each((o,i)=>{this.noodleNodes.get(o).invalidateCaches()}),0))}};(t=>{class r{_in(o){return this.noodleMap.noodleNodes._in(o)&&this.getHotspotInteractions(o).length!=0}hotspots(){return this.noodleMap.noodleNodes.keys().filter(o=>this.getHotspotInteractions(o).length!=0)}getHotspotInteractions(o){return this.noodleMap.noodleNodes.get(o).interactions.asList()}constructor(o){this.noodleMap=o}}t.RawMapForTests=r;class e{_in(o){return this.noodleMap.noodleNodes._in(o)?this.getHotspotInteractions(o).length!=0:!1}hotspots(){return this.cacheType===2||this.cacheType===3?this.noodleMap.guidsForPrefilterType.get(this.cacheType).asList().filter(o=>this.noodleMap.noodleNodes.get(o)==null?(Oe("GUID in guidsForPrefilterType not in noodleNodes"),!1):this.getHotspotInteractions(o).length!=0):this.noodleMap.noodleNodes.keys().filter(o=>this.getHotspotInteractions(o).length!=0)}getHotspotInteractions(o){let i=this.noodleMap.noodleNodes.get(o);return i.caches.get(this.cacheType)==null&&i.caches.set(this.cacheType,this.computeCacheForHotspot(o)),i.caches.get(this.cacheType)}constructor(o,i,a){this.noodleMap=o,this.cacheType=i,this.computeCacheForHotspot=a}}t.CleanedMap=e})(ji||(ji={}));function ib(r,e){return r!=null&&X.isValid(r)&&(e=="INTERNAL_NODE"||e=="UPDATE_MEDIA_RUNTIME")}var jo=class{constructor(e,t=null){this.node=e,this.hyperlink=t}canvasSpaceScrolledInteractiveBounds(e){let t=this.node.canvasSpaceScrolledInteractiveBounds(e);return this.hyperlink!=null?Yr.FrozenRect_new4(this.hyperlink.bounds.x+t.x(),this.hyperlink.bounds.y+t.y(),this.hyperlink.bounds.w,this.hyperlink.bounds.h):t}},Ih=class{asScreen(){return null}asSmartAnimate(){return null}constructor(){}},zr=class r extends Ih{asScreen(){return this}hash(){let e=`${this.nodeId}-${r.FrameRole[this.role]}`;return this.role==r.FrameRole.OVERLAY?e+`-${this.overlayStackPosition}`:e}static forBaseScreen(e){return new r(e,r.FrameRole.BASE_SCREEN,0,null,null)}static forOverlay(e,t,n,o){return new r(e,r.FrameRole.OVERLAY,t,n,o)}constructor(e,t,n,o,i){super(),this.nodeId=e,this.role=t,this.overlayStackPosition=n,this.prototypeAction=o,this.precedingOverlays=i}};(e=>{let r;(o=>(o[o.BASE_SCREEN=0]="BASE_SCREEN",o[o.OVERLAY=1]="OVERLAY"))(r=e.FrameRole||(e.FrameRole={}))})(zr||(zr={}));var Kg=class extends Ih{asSmartAnimate(){return this}hash(){return`Smart animate ${this.srcNodeId} -> ${this.dstNodeId} w/ ${this.transitionType}`}constructor(e,t,n,o,i){super(),this.srcNodeId=e,this.dstNodeId=t,this.role=n,this.transitionType=o,this.easingFunction=i}},eu;(e=>{function r(t,n){if(n=="URL"){if(t!="ON_CLICK"&&t!="MOUSE_UP")return!1}else if(n=="BACK"&&ob(t))return!1;return!0}e.isValidForConnection=r})(eu||(eu={}));var gi=class gi{constructor(e){this._nodeTransitionTracker=null,this._appState=null,this._emitter=null,this._cachedPrerenderJobList=[],this._shouldNotifyTopLevelPrototypeNodesInvalidated=!1,this._appState=e,this._emitter=Kt.getEventEmitter(),this._appState.addAppObserver(this),this._appState.prototypeState().addObserver(this),this._nodeTransitionTracker=new $d(e),this._appState.addFrameObserver(this)}nodeTransitionTracker(){return this._nodeTransitionTracker}handleSceneChange(e,t){e!=null&&e.removeObserver(this),t!=null&&t.addObserver(this),this._cachedPrerenderJobList=null,this._shouldNotifyTopLevelPrototypeNodesInvalidated=!0}handleActiveCanvasChange(e,t){this._cachedPrerenderJobList=null,this._shouldNotifyTopLevelPrototypeNodesInvalidated=!0}handleActivePrototypeStartingPointChange(e,t){this._cachedPrerenderJobList=null,this._shouldNotifyTopLevelPrototypeNodesInvalidated=!0}handleSceneGraphEvent(e){if(zn.isPrototypeStructuralChange(e.property)||e.property==14||e.property==89||e.property==9||e.property==30){this._cachedPrerenderJobList=null;let t=this._appState.prototypeState();t.isApplyingStateChangeMutation()||t.isResettingStateChangeMutations()||(this._shouldNotifyTopLevelPrototypeNodesInvalidated=!0)}}onFrame(){this._shouldNotifyTopLevelPrototypeNodesInvalidated&&(this._emitter.trigger("topLevelFramesListInvalidated"),this._emitter.trigger("navigationInfoInvalidated"),this._shouldNotifyTopLevelPrototypeNodesInvalidated=!1)}handleStateChangeAborted(e){this._cachedPrerenderJobList=null}handleStateChangeCommitted(e,t){}handleStateChangeInitiated(e){this._cachedPrerenderJobList=null}handleStateChangeRequested(e){}handleFitModeChange(e,t){}handleRestartPrototype(){}_scene(){return this._appState.scene()}_baseScreenId(){return this._appState.prototypeState().getCurrentBaseScreenId()}getPrerenderingJobs(e){return this._cachedPrerenderJobList==null&&(this._cachedPrerenderJobList=this.computePrerenderJobsForStartNode(this._baseScreenId(),gi.MAX_PRERENDER_JOB_COUNT)),this._cachedPrerenderJobList}navigationOrder(){switch(this._appState.editorType()){case"SLIDES":return new qd(this._appState);default:return this.topLevelPrototypeStartingPointNodeIdsSorted().length>0||Y.getViewerMode()==Y.ViewerMode.MIRROR?new Sh(this._appState):new ls(this._appState)}}navigationOrderType(){return this.navigationOrder().navigationOrderType()}isLinear(){return this.navigationOrder().isLinear()}transitionDirectionBetweenFrames(e,t){if(!this.isLinear())return;if(this.navigationOrderType()!==2)return 0;let n=this._scene().findNode(t);if(!n)return;if(!n.objectAnimations().length)return 0;if(!this._scene().findNode(e))return 0;let i=this.navigationOrder().topLevelPrototypeNodesInOrder(),a=i.findIndex(l=>l===e);return i.findIndex(l=>l===t)-a>0?0:1}activePrototypeStartNodeOrDefault(){if(this._scene()==null)return null;if(this._appState.activePrototypeStartingPointNodeId()!=null){let t=this._scene().findNode(this._appState.activePrototypeStartingPointNodeId());if(t!=null&&t.visible())return t}let[e]=this.topLevelPrototypeStartingPointNodeIdsSorted();return e?this._scene().findNode(X.fromString(e)):null}nodeToRestartPrototypeOn(e){return this.navigationOrder().nodeToRestartPrototypeOn(e)}getDestinationFrame(e){var n,o,i;let t=(n=this._scene())==null?void 0:n.findNode(e);if(t==null)return null;if(t.type()=="SECTION"){let a=this._appState.prototypeState().getLastFrameOrSectionVisitedInSection(t.id()),s=(o=this._scene())==null?void 0:o.findNode(a);if((s==null?void 0:s.type())=="SECTION")for(;s.type()!="FRAME";)a=this._appState.prototypeState().getLastFrameOrSectionVisitedInSection(a),s=(i=this._scene())==null?void 0:i.findNode(a);return s}return t}validDestinationForPrototypeFromId(e){let t=this.getDestinationFrame(e);return t==null||!t.isTopLevel()||!t.isVisibleInCanvas()||t.isStateGroup()||t.isGroup()||t.isSkippedSlide()||zt.isImmutableFrame(t.type())?null:t}topLevelPrototypeNodesInOrder(){return this.navigationOrder().topLevelPrototypeNodesInOrder()}topLevelPrototypeStartingPointNodeIdsSorted(){let e=this._appState.getActiveCanvas();return e==null?[]:N().topLevelPrototypeStartingPointsSorted(e.id())}prototypeStartingPointsData(){let e=this._appState.getActiveCanvas();return e==null||e.type()!="CANVAS"?null:N().topLevelPrototypeStartingPointsSorted(e.id()).map(n=>{let o=this._scene().findNode(n);if(o)return{id:o.id(),name:o.prototypeStartingPoint().name,description:o.prototypeStartingPoint().description}}).filter(Boolean)}prerenderJobsForBaseScreen(){return this.prerenderJobsAfter(zr.forBaseScreen(this._baseScreenId()))}prerenderJobsAfter(e){var a;let t=(a=this._scene())==null?void 0:a.findNode(e.nodeId);if(t==null)return[];let n=new Map,o=[],i=s=>{n.has(s.hash())||(n.set(s.hash(),!0),o.push(s))};if(e.role==0){let s=this.topLevelPrototypeNodesInOrder(),l=s.indexOf(e.nodeId);if(l!=-1){let d=l+1,c=null;d<s.length?c=X.fromString(s[d]):c=this._appState.prototypeStructure().navigationOrder().getNextBaseScreenId(),c!=null&&i(zr.forBaseScreen(c))}}return this.forTransitionInFrame(t,s=>{for(let l of s.allActions()){if(l==null||!X.isValid(l.transitionNodeID()))return!0;let d=l.transitionType(),c=!1;if(l.navigationType()=="SWAP_STATE")return!0;if(e.role==0&&(d=="SMART_ANIMATE"||Rn.supportsSmartAnimate(d)&&l.transitionShouldSmartAnimate())&&(c=!0),e.role==1&&d=="SMART_ANIMATE"&&l.navigationType()=="SWAP"&&(c=!0),c&&i(new Kg(t.id(),l.transitionNodeID(),e.role,d,l.easingFunction)),l.navigationType()=="NAVIGATE"){i(zr.forBaseScreen(l.transitionNodeID()));let p=this._scene().findNode(l.transitionNodeID());p!=null&&p.setUsedAsBaseScreen(!0)}else if(l.navigationType()=="OVERLAY"){let p=e.precedingOverlays!=null?e.precedingOverlays.slice():[];p.push(l.transitionNodeID()),i(zr.forOverlay(l.transitionNodeID(),e.overlayStackPosition+1,l,p));let u=this._scene().findNode(l.transitionNodeID());u!=null&&u.setUsedAsBaseScreen(!1)}else if(l.navigationType()=="SWAP"){if(e.role==1){let p=e.precedingOverlays!=null?e.precedingOverlays.slice():null;p!=null&&(p[p.length-1]=l.transitionNodeID()),i(zr.forOverlay(l.transitionNodeID(),e.overlayStackPosition,l,p))}else i(zr.forBaseScreen(l.transitionNodeID()));this._scene().findNode(l.transitionNodeID()).setUsedAsBaseScreen(e.role==0)}}return!0}),o}prerenderJobForPreviousNode(){return this.prerenderJobForNodeBefore(this._baseScreenId())}prerenderJobForNodeBefore(e){var i;if(((i=this._scene())==null?void 0:i.findNode(e))==null)return null;let n=this.topLevelPrototypeNodesInOrder(),o=n.indexOf(e);if(o!=-1){let a=o-1;if(a>=0)return zr.forBaseScreen(X.fromString(n[a]))}return null}computePrerenderJobsForStartNode(e,t){if(e==null)return[];let n=[zr.forBaseScreen(e)],o=[zr.forBaseScreen(e)],i=new Map,a=0;for(i.set(n[0].hash(),!0);a<n.length;){let s=n[a],l=[],d=this.prerenderJobForNodeBefore(s.nodeId);if(d!=null&&l.push(d),Ir(l,this.prerenderJobsAfter(s)),l.forEach(c=>{if(o.length<t&&!i.has(c.hash())){let p=c.asScreen();p!=null&&n.push(p),o.push(c),i.set(c.hash(),!0)}}),n.length==t)break;a=a+1}return o}forTransitionInFrame(e,t){let n=this._nodeTransitionTracker.cleanedUpTransitionMapByTLF();if(n._in(e.id())){let o=n.get(e.id());for(let i=0,a=o.length;i<a;i=i+1){let s=o[i];if(!t(s))return}}}forInteractionInFrame(e,t){this.forInteractionInFrames([e],t)}getInteractionsGroupedByType(e){let t=this._nodeTransitionTracker.cleanedUpInteractionMap(),n={};for(let o of t.hotspots()){let i=this._scene().findNode(o);if(i!=null)for(let a of e)a!=null&&a.isAncestorOf(i)&&t.getHotspotInteractions(o).forEach(s=>{let l=s.event().interactionType().toString();n[l]||(n[l]=[]),n[l].push({node:i,interaction:s})})}return n}static getNodeInteractionPairs(e,t){if(t!==null)return t[e]||[]}forInteractionInFrames(e,t){let n=this._nodeTransitionTracker.cleanedUpInteractionMap();for(let o of n.hotspots()){let i=this._scene().findNode(o);if(i!=null)for(let a of e)a!=null&&a.isAncestorOf(i)&&n.getHotspotInteractions(o).forEach(s=>{t(i,s)})}}forHotspotInMap(e,t){for(let n of Array.from(e.keys())){let o=this._scene().findNode(n);if(o!=null){let i=!1;if(gi.isNodeInteractableBecauseOfHyperlinks(o)){for(let a of e.get(n))for(let s of a.allActions())if(s.connectionURL()=="HYPERLINK"){for(let l of o.textHyperlinkBoxes())t(new jo(o,l)),i=!0;break}}i||t(new jo(o))}}}findPrototypeInteractionWithId(e,t){if(!this._scene())return null;let n=this._scene().findNode(e),o=gi.cleanedInteractionsForNode(this._appState,n);for(let i=0,a=o.length;i<a;i=i+1){let s=o[i];if(s.id()==t)return s}return null}findPrototypeInteractionsWithTransition(e,t){let n=this._scene().findNode(e),o=gi.cleanedInteractionsForNode(this._appState,n),i=[];return o.forEach(a=>{for(let s of a.getAllValidTransitionActionsInInteraction())if(s!=null&&s.transitionNodeID()==t){i.push(a);break}}),i}findPrototypeInteractionsWithInteractionType(e,t){let n=gi.cleanedInteractionsForNode(this._appState,e);if(n.length==0)return n;let o=[],i=[];return n.forEach(a=>{a.event().interactionType()==t&&(a.action()!=null&&a.action().value.navigationType()=="SWAP_STATE"&&a.action().value.connectionType()=="INTERNAL_NODE"?i.push(a):o.push(a))}),e.isInstanceSublayer()&&i.sort((a,s)=>{var c,p;let l=Gt.whichInstanceToSwap(e,(c=a.action())==null?void 0:c.value.transitionNodeID()).stablePath(),d=Gt.whichInstanceToSwap(e,(p=s.action())==null?void 0:p.value.transitionNodeID()).stablePath();return l.guids.length<d.guids.length?-1:1}),Ir(o,i),o}findHotspotsWithInteractionFilter(e,t,n,o){return this.findHotspotsWithNoodleFilter(e,t,(i,a)=>n(a),o)}findHotspotsWithInteractionFilterWithinMultipleNodes(e,t,n){return this.findHotspotsWithNoodleFilterWithinMultipleNodes(e,t,(o,i)=>n(i))}findHotspotsWithNoodleFilter(e,t,n,o){let i=[];return e==null?i:this.findHotspotsWithNoodleFilterWithinMultipleNodes(new Set([e]),t,n,o)}findHotspotsWithNoodleFilterWithinMultipleNodes(e,t,n,o){let i=[];if(e==null||e.size==0)return i;let a=new Map,s=(l,d)=>{!n(l,d)||!d.allActions().some(p=>eu.isValidForConnection(d.event().interactionType(),p.connectionType()))||(a.has(l.id())||a.set(l.id(),[]),a.get(l.id()).push(d))};if(o)for(let l of o)s(l.node,l.interaction);else this.forInteractionInFrames(Array.from(e.values()),s);return this.forHotspotInMap(a,l=>{(t==0||!e.has(l.node))&&i.push(l)}),i.sort((l,d)=>l.node.isAboveInLayerOrder(d.node)?-1:1),i}findHotspotsWithInteractionType(e,t,n,o){return this.findHotspotsWithInteractionFilter(e,t,i=>i.event().interactionType()==n,o)}findAllHotspots(e,t){return this.findHotspotsWithInteractionFilter(e,t,n=>!0)}hotspotOnPresentedNode(e,t,n,o){let i=n!="MOUSE_OUT"&&n!="MOUSE_LEAVE",a=this._appState.prototypeStructure().findHotspotsWithInteractionType(e,0,n,o),s=null;for(let l of a)l.canvasSpaceScrolledInteractiveBounds(0).contains2(t)==i&&(s==null||l.node.isAboveInLayerOrder(s.node))&&(s=l);return s}static createFakeHyperlinkInteraction(){let e=new kn("ON_CLICK",null,null,{},null,null),t=ir.NULL_ACTION.withConnectionType("URL").withConnectionURL("HYPERLINK");return new Gt(X.invalid(),e,[t],!1,0)}static cleanedInteractionsForNode(e,t){if(t==null)return[];let n=t.prototypeInteractions();return this.cleanedInteractionsForNodeFromDirtyInteractions(e,t,n)}static cleanedInteractionsForNodeFromDirtyInteractions(e,t,n){let o=[];if(t==null||n==null)return o;for(let i=0,a=n.length;i<a;i=i+1){let s=n[i];if(s.actions()==null||s.actions().length==0)continue;let l=[];for(let d=0,c=s.actions().length;d<c;d=d+1){let p=s.actions()[d],u=null;if(X.isValid(p.transitionNodeID())){let _=e.getActiveCanvas(),h=gi.cleanedUpTransitionDestinationId(_,t==null?void 0:t.id(),p.transitionNodeID(),p.navigationType(),p.connectionType());h!==null&&h!=null&&(u=p.withTransitionNodeID(h))}else t.isVisibleInCanvas()&&gi.isPrototypeActionInteractableBecauseOfConnection(p)&&(u=p);u!=null&&l.push(u)}l.length!=0&&o.push(s.withActions(l))}return o.length==0&&gi.isNodeInteractableBecauseOfHyperlinks(t)&&o.push(gi.createFakeHyperlinkInteraction()),o}static cleanedUpTransitionDestinationId(e,t,n,o,i){return N().modules().prototype.cleanedUpTransitionDestination(e!=null?e.handle():-1,t,n,xe().NavigationType[o],xe().ConnectionType[i])}static adjacentBaseScreens(e,t){let n=t.scene(),o=new ci(s=>s),i=null,a=new Dn;return i=s=>{if(s==null||a._in(s.id())||!e._in(s.id()))return;a.add(s.id());let l=e.get(s.id());for(let d=0,c=l.length;d<c;d=d+1){let p=l[d];for(let u of p.allActions()){if(u==null||!X.isValid(u.transitionNodeID()))continue;let _=n.findNode(u.transitionNodeID());if(_==null){Oe("null destination when finding reachable TLFs?");continue}let h=u.connectionType()!="UPDATE_MEDIA_RUNTIME"&&u.connectionType()!="SET_VARIABLE"&&u.connectionType()!="SET_VARIABLE_MODE";u.navigationType()=="NAVIGATE"&&h||u.navigationType()=="SWAP"&&X.equals(s.id(),t.id())?o.add(_.id()):(u.navigationType()=="OVERLAY"||u.navigationType()=="SWAP")&&i(_)}}},i(t),o}static isNodeInteractableBecauseOfHyperlinks(e){return e.type()=="TEXT"&&e.textHyperlinkBoxes().length>0}static isPrototypeActionInteractableBecauseOfConnection(e){return e.connectionURL()!=null||e.connectionType()=="BACK"||e.connectionType()=="CLOSE"||e.connectionType()=="SET_VARIABLE"||e.connectionType()=="SET_VARIABLE_MODE"||e.connectionType()=="UPDATE_MEDIA_RUNTIME"||e.connectionType()=="CONDITIONAL"}};gi.MAX_PRERENDER_JOB_COUNT=10;var Yt=gi;var ba=class r{constructor(e){this.VERBOSE_LOGS=!1,this._observers=new jr,this._isNotifyingStateChangeObservers=!1,this._interactionsEnabled=!0,this._disengageObservationOnClick=!0,this._disableNewStateChanges=!1,this._currentFitMode="none",this._currentContentScalingMode="fixed",this._isDragging=!1,this._actionCounter=0,this._transitionOnClick=!0,this._changeHistory=[],this._changeHistoryBeforeNodeChanges=[],this._initiatedChange=null,this._initiatedChangeBeforeNodeChanges=null,this._initiatedHistory=null,this._lastInitiatedTopLevelStateChange=null,this._baseScreenWasValidDestinationBeforeNodeChanges=!1,this._ongoingNavigateRepairsInvalidState=!1,this._shouldNotifyNavigationInfoInvalidated=!1,this._tlfHistory=[],this._upcomingTlfs=new Set,this._guidToVideoStateChangeMap=new Map,this._screensNeedValidating=!1,this._removedPrimaryInstances=[],this._enqueueUpcomingTlfsDeadline=0,this._forceInitiateStateChangeForTests=!1,this._requestedStateChange=null,this._requestedStateChangeAtMs=-1,this._visitedScreenIds=new Dn,this._isApplyingStateChangeMutation=!1,this._isResettingStateChangeMutations=!1,this._initiatedInstanceChanges=new Map,this._lastInitiatedInstanceStateChange=null,this._setVariableActionHistory=[],this._variableIdToSetVariableActionHistoryIndex=new Map,this._hsmObservers=new jr,this._activeSlidesPrototypeEmbed=null,this._appState=e,this._appState.addAppObserver(this),this._appState.addFrameObserver(this),this.componentStateSyncer=new Qd(this._appState,this,(t,n,o)=>this._getFullscreenNodeChangesForStateSwap(t,n,o)),this._emitter=Kt.getEventEmitter(),this._hsmRoot=new oc(this),this._onStateSwapFailedDueToCycle=()=>{this._emitter.trigger("stateSwapFailedDueToCycle")},this.resetState()}hasRequestedStateChange(){return this._requestedStateChange!==null}handleSceneChange(e,t){e!=null&&e.removeObserver(this),t!=null&&t.addObserver(this),this._hsmRoot=new oc(this),this._initiatedInstanceChanges=new Map,t!=null&&this.createOrRepairStateMachinesForInsertedSubtree(t.root()),this._visitedScreenIds=new Dn,this._enforceValidPrototypeState()}resetState(){this.resetPrototype(),this._currentFitMode="none",this._currentContentScalingMode="fixed",this._transitionOnClick=!0}handleActiveCanvasChange(e,t){}handleActivePrototypeStartingPointChange(e,t){this._enforceValidPrototypeState()}handleSceneGraphEvent(e){if(zn.isPrototypeStructuralChange(e.property)&&(this._screensNeedValidating=!0,this._deferEnqueueUpcomingTlfs()),e.property==112)Je.asString(e.newVal)=="REMOVED"&&!this.isApplyingStateChangeMutation()&&e.node.isPrimaryInstance()&&this._removedPrimaryInstances.push(e.node.id());else if(e.property==78&&e.node.isInstance()){let t=e.node.symbolID()??X.invalid();X.isValid(t)||console.warn("Unexpected invalid symbolID for instance in instance generation"),this.createOrRepairInstanceStateMachineIfNeeded(e.node,t)}else if(e.property==32){let t=e.oldVal!=null&&Je.isParentIndex(e.oldVal)?Je.asParentIndex(e.oldVal):null,n=e.newVal!=null&&Je.isParentIndex(e.newVal)?Je.asParentIndex(e.newVal):null,o=t!=null?e.node.scene().findNode(t.id):null,i=n!=null?e.node.scene().findNode(n.id):null,a=o!=null&&o.isRooted(),s=i!=null&&i.isRooted();!a&&s?this.createOrRepairStateMachinesForInsertedSubtree(e.node):a&&!s&&(this.isApplyingStateChangeMutation()||yn(e.node,l=>{if(l.isInstance()){let d=this._getStateMachineOrNull(l.stablePath());if(d!=null)return this.commitInstanceStateChange(d),2}return 0}))}else e.property==65&&gr.clearCachedNodePaths()}didApplyNodeChanges(){if(this._screensNeedValidating&&(this._enforceValidPrototypeState(),this._screensNeedValidating=!1),this._removedPrimaryInstances.length>0){for(let e of this._removedPrimaryInstances)this.commitChangesBelowInstanceTransitionRoot(new ut([e])),this._hsmRoot.removeChild(e);this._removedPrimaryInstances=[]}}onFrame(){this._shouldNotifyNavigationInfoInvalidated&&(this._emitter.trigger("navigationInfoInvalidated"),this._shouldNotifyNavigationInfoInvalidated=!1),this._enqueueUpcomingTlfsDeadline!=0&&Me.milliseconds()>this._enqueueUpcomingTlfsDeadline&&this._enqueueUpcomingTlfs()}_filterOverlays(e){let t=e.length;for(let n=0;n<e.length;n=n+1){let o=this._appState.prototypeStructure().validDestinationForPrototypeFromId(e[n].id);if(o==null){t=n;break}o.setUsedAsBaseScreen(!1)}return t==e.length?e:e.slice(0,t)}_filterPresentedState(e){if(e==null)return null;if(e.stateId==null&&e.overlays.length==0)return e;let t=this._appState.prototypeStructure().validDestinationForPrototypeFromId(e.stateId);if(t==null)return new cr(null,[]);t.setUsedAsBaseScreen(!0);let n=this._filterOverlays(e.overlays);return n==e.overlays?e:new cr(e.stateId,n)}_filterChange(e){if(e==null)return null;let t=this._filterPresentedState(e.oldStateAndOverlays),n=this._filterPresentedState(e.newStateAndOverlays);return t==e.oldStateAndOverlays&&n==e.newStateAndOverlays?e:new Hr(1,ut.ROOT_STABLE_PATH(),t,n)}_getBaseScreenIdFromChangeOrHistory(e,t){return e!=null?e.newStateAndOverlays.stateId:t&&t.length>0?ne.List_last(t).newStateAndOverlays.stateId:null}_getAnimationStateFromChangeOrHistory(e,t){return e!=null?e.newStateAndOverlays.animationState:t&&t.length>0?ne.List_last(t).newStateAndOverlays.animationState:null}enforceValidPrototypeStateForTesting(){this._enforceValidPrototypeState()}_enforceValidPrototypeState(){let e=!1;if(this._initiatedChange!=null){let o=!Y.getFeatureFlags().viewer_only_check_new_state_id&&this._initiatedChange.oldStateId()!=null&&this._appState.prototypeStructure().validDestinationForPrototypeFromId(this._initiatedChange.oldStateId())==null,i=this._appState.prototypeStructure().validDestinationForPrototypeFromId(this._initiatedChange.newStateId())==null;e=o||i,o&&(this.mostRecentFixInvalidStateInitiator+=" oldIsInvalid"),i&&(this.mostRecentFixInvalidStateInitiator+=" newIsInvalid")}else if(this._changeHistory&&this._changeHistory.length>0){let o=ne.List_last(this._changeHistory).newStateId(),i=this._appState.prototypeStructure().validDestinationForPrototypeFromId(o)==null;e=i,i&&(this.mostRecentFixInvalidStateInitiator+=" currentIsInvalid")}else return;if(e){this.restartPrototype(0);return}let t=null,n=null;if(this._initiatedChange!=null){let o=this._filterChange(this._initiatedChange);this._initiatedChange!=o&&(n=this._initiatedHistory.slice(),t=o)}else if(this._changeHistory&&this._changeHistory.length>0){let o=ne.List_last(this._changeHistory),i=this._filterChange(o);i!=o&&(n=this._changeHistory.slice(),t=i)}t!=null&&n!=null&&(ne.List_removeLast(n),n.push(t),this._requestStateChange(t,n),this.mostRecentFixInvalidStateInitiator+=" PrototypeState._enforceValidPrototypeState",this.commitStateChange())}getTlfHistory(){return this._tlfHistory}getLastChangeInHistory(){return this._changeHistory&&this._changeHistory.length<1?null:ne.List_last(this._changeHistory)}getHistoryCount(){return this._changeHistory.length}getInitiatedChange(){return this._initiatedChange}getCurrentBaseScreenId(){return this._getBaseScreenIdFromChangeOrHistory(this._initiatedChange,this._changeHistory)}getCurrentAnimationState(){return this._getAnimationStateFromChangeOrHistory(this._initiatedChange,this._changeHistory)}getCurrentBaseScreenNode(){var t;let e=this.getCurrentBaseScreenId();return e==null?null:(t=this._appState.scene())==null?void 0:t.findNode(e)}getCurrentBaseScreenIndex(){let e=this.getCurrentBaseScreenId();return e==null?-1:this._appState.prototypeStructure().topLevelPrototypeNodesInOrder().indexOf(e)}getPreviousBaseScreenId(){let e=this._appState.prototypeStructure().topLevelPrototypeNodesInOrder(),t=this.getCurrentBaseScreenIndex();return t<1?null:X.fromString(e[t-1])}getPreviousAndNextNBaseScreenIds(e){let t=this._appState.prototypeStructure().topLevelPrototypeNodesInOrder(),n=this.getCurrentBaseScreenIndex(),o=Math.max(0,n-e),i=Math.min(t.length-1,n+e),a=[];for(let s=o;s<=i;s=s+1)s!=n&&a.push(X.fromString(t[s]));return a}getPreviousBaseScreenNode(){return this._appState.scene().findNode(this.getPreviousBaseScreenId())}getCurrentOverlays(){return this.bindOverlays(this.getCurrentOverlayData())}getCurrentOverlayData(){return this._initiatedChange!=null?this._initiatedChange.newOverlayData():this._changeHistory&&this._changeHistory.length>0?ne.List_last(this._changeHistory).newOverlayData():[]}getCurrentOverlayIds(){return this.getCurrentOverlays().map(e=>e.id())}getOpenOverlayData(e){let t=this.getCurrentOverlays();for(let n=0,o=t.length;n<o;n=n+1){let i=t[n];if(X.equals(i.id(),e))return i}return null}getTopmostScreenAndPoint(e){let t=this.getCurrentBaseScreenNode(),n=this.getTopmostOverlayNode();return n?[n,this.getTopmostOverlay().baseTlfSpaceToOverlaySpace1(t,e)]:[t,e]}getTopmostScreen(){return this.getTopmostOverlayNode()??this.getCurrentBaseScreenNode()}getTopmostScreenId(){return this.getTopmostOverlayId()??this.getCurrentBaseScreenId()}getTopmostOverlay(){let e=this.getCurrentOverlays();return e.length>0?ne.List_last(e):null}getTopmostOverlayId(){let e=this.getCurrentOverlays();return e.length>0?ne.List_last(e).id():null}getTopmostOverlayNode(){var t;let e=this.getCurrentOverlays();return e.length==0?null:(t=this._appState.scene())==null?void 0:t.findNode(ne.List_last(e).id())}getSecondTopmostOverlayNodeOrBaseScreen(){var t;let e=this.getCurrentOverlays();return e.length==0?null:e.length==1?this.getCurrentBaseScreenNode():(t=this._appState.scene())==null?void 0:t.findNode(e[e.length-2].id())}getLayersIds(){let e=this.getCurrentBaseScreenId();if(e==null)return[];let t=this.getCurrentOverlayIds().slice();return t.unshift(e),t}getPreviousNonTransientChange(){let e=this._changeHistory.slice();for(;this._changeHistory&&e.length>0&&ne.List_last(e).isTransientChange();)e.pop();if(e.length==0)return null;for(;this._changeHistory&&e.length>0;){let t=e.pop();if(!(e.length>0&&ne.List_last(e).isTransientChange()||this._appState.prototypeStructure().validDestinationForPrototypeFromId(t.oldStateId())==null))return t}return null}bindOverlays(e){let t=[];for(let n=0,o=e.length;n<o;n=n+1)t.push(new Jd(this._appState.scene(),e[n],n>0?t[n-1]:null,n));return t}getOngoingNavigateRepairsInvalidState(){return this._ongoingNavigateRepairsInvalidState}lastNodeForBaseScreen(){var t;let e=null;return this._initiatedChange!=null?e=this._initiatedChange.oldStateId():this._changeHistory&&this._changeHistory.length>0&&(e=ne.List_last(this._changeHistory).newStateId()),e==null?null:(t=this._appState.scene())==null?void 0:t.findNode(e)}nextNodeForBaseScreen(){var e,t;return((e=this._initiatedChange)==null?void 0:e.newStateId())==null?null:(t=this._appState.scene())==null?void 0:t.findNode(this._initiatedChange.newStateId())}lastNodeForOverlayAt(e){var n;let t=null;if(this._initiatedChange!=null)t=this._initiatedChange.oldOverlayData();else if(this._changeHistory&&this._changeHistory.length>0)t=ne.List_last(this._changeHistory).newOverlayData();else return null;return t.length<=e?null:(n=this._appState.scene())==null?void 0:n.findNode(t[e].id)}nextNodeForOverlayAt(e){var n;if(this._initiatedChange==null)return null;let t=this._initiatedChange.newOverlayData();return t.length<=e?null:(n=this._appState.scene())==null?void 0:n.findNode(t[e].id)}displayedOverlayCount(){return this._initiatedChange!=null?Math.max(this._initiatedChange.oldOverlayData().length,this._initiatedChange.newOverlayData().length):this._changeHistory&&this._changeHistory.length>0?ne.List_last(this._changeHistory).newOverlayData().length:0}nodeForOverlayAt(e){var n;let t=this.getCurrentOverlayData();return t.length<=e?null:(n=this._appState.scene())==null?void 0:n.findNode(t[e].id)}getCurrentFitMode(){return this._currentFitMode}getCurrentContentScalingMode(){return this._currentContentScalingMode}getCurrentScalingInfo(){return{fitMode:this._currentFitMode,contentScalingMode:this._currentContentScalingMode}}setScalingInfoFromParameter(e,t){let n={};switch(e){case"contain":{n.fitMode="contain",n.contentScalingMode="fixed";break}case"scale-down":{n.fitMode="scale-down",n.contentScalingMode="fixed";break}case"min-zoom":{n.fitMode="min-zoom",n.contentScalingMode="fixed";break}case"scale-down-width":{n.fitMode="scale-down-width",n.contentScalingMode="fixed";break}case"fit-width":{n.fitMode="fit-width",n.contentScalingMode="fixed";break}case"free":{n.fitMode="free",n.contentScalingMode="fixed";break}case"responsive":{n.fitMode="contain",n.contentScalingMode="responsive";break}default:{n.fitMode="scale-down",n.contentScalingMode="fixed";break}}if(t)switch(t){case"responsive":{n.contentScalingMode="responsive";break}case"fixed":{n.contentScalingMode="fixed";break}default:break}let o={fitMode:this._currentFitMode,contentScalingMode:this._currentContentScalingMode},i=!1;n.fitMode!=this._currentFitMode&&(this._currentFitMode=n.fitMode,i=!0),n.contentScalingMode!==this._currentContentScalingMode&&(this._currentContentScalingMode=n.contentScalingMode,i=!0),i&&this._notifyFitModeChange(o,{fitMode:this._currentFitMode,contentScalingMode:this._currentContentScalingMode})}_notifyFitModeChange(e,t){this._observers.forEach(n=>{n.handleFitModeChange(e,t)})}actionCounter(){return this._actionCounter}setTransitionOnClick(e){this._transitionOnClick=e}getTransitionOnClick(){return this._transitionOnClick}setInteractionsEnabled(e){this._interactionsEnabled=e}interactionsEnabled(){return this._interactionsEnabled}disengageObservationOnClick(){return this._disengageObservationOnClick}setDisengageObservationOnClick(e){this._disengageObservationOnClick=e}isDragging(){return this._isDragging}setIsDragging(e){this._isDragging=e}showDeviceFrame(){return this._showDeviceFrame}setShowDeviceFrame(e){this._showDeviceFrame=e}showTransparentBackground(){return this._showTransparentBackground}setShowTransparentBackground(e){this._showTransparentBackground=e}addObserver(e){this._observers.add(e)}removeObserver(e){this._observers.remove(e)}closeOverlayAtAndAbove(e,t){let n=Wn.getDefaultExternalExecution();this._closeOverlayAtAndAbove(e,n.interactionAddress,n.canvasSpaceTriggerBoundsOrNull,0,null,t)}closeOverlayForHotspot(e,t,n,o){var d;let i=null,a=null,s=0;e!=null&&t!=null?(i=(d=e.topLevelAncestor())==null?void 0:d.id(),a=Wn.forNoodle(e,t,o),s=$e.fromInteractionType(t.event().interactionType())):(Oe("closeOverlayForHotspot called with null hotspot"),i=this.getTopmostOverlayId(),a=Wn.getDefaultExternalExecution(),s=0);let l=this.getCurrentOverlayData();for(let c=l.length-1;c>=0;c=c-1)if(X.equals(l[c].id,i)){this._closeOverlayAtAndAbove(c,a.interactionAddress,a.canvasSpaceTriggerBoundsOrNull,s,null,n);return}}_closeOverlayAtAndAbove(e,t,n,o,i,a){if(!this._allowNewStateChanges())return;this._clearInitiatedChangesBeforeNewChange();let s=this.getCurrentOverlayData();if(s.length>e){let l=Hr.forClosingTopNOverlays(s.length-e,this.getCurrentBaseScreenId(),s,t,n,o);if(i==null)switch(a){case 0:{i=this._changeHistory.slice();break}case 1:{i=Mt.FrozenList_cloneAndAppendOne(this._changeHistory,l);break}case 2:{i=[l];break}}this._requestStateChange(l,i)}}navigateToFrameAndCloseOverlaysOrRestart(e,t){var o;this.mostRecentFixInvalidStateInitiator=t;let n=null;if(e!=null){let i=this._appState.scene().findNode(e),a=i==null?void 0:i.findContainingCanvasOrSelf();if(a!=null&&this._appState.setActiveCanvas(a),n=(o=this._appState.prototypeStructure())==null?void 0:o.validDestinationForPrototypeFromId(e),this._appState.prototypeStructure().navigationOrder().navigationOrderType()===2&&(n==null?void 0:n.type())!=="SLIDE"){let[s]=this._appState.prototypeStructure().topLevelPrototypeNodesInOrder();s&&(n=this._appState.scene().findNode(s))}n||(this.mostRecentFixInvalidStateInitiator=`${t} invalid`)}else this.mostRecentFixInvalidStateInitiator=`${t} null`;n!=null?this.navigateToFrameAndCloseOverlays(n.id()):this.restartPrototype(0)}navigateToFrameAndCloseOverlays(e,t=null,n=2,o=0,i=0,a=null,s=null){var E,v;if(!this._allowNewStateChanges())return;this._clearInitiatedChangesBeforeNewChange();let l=this.getCurrentBaseScreenNode(),d=(E=this._appState.prototypeStructure())==null?void 0:E.getDestinationFrame(e);if((l==null?void 0:l.type())==="SLIDE"&&!d||d!=null&&d.isSkippedSlide()){let A=this._appState.prototypeStructure().topLevelPrototypeNodesInOrder(),I=A[A.indexOf(l.id())+1];d=(v=this._appState.prototypeStructure())==null?void 0:v.getDestinationFrame(I)}if(d!=null){this._appState.prototypeStructure().validDestinationForPrototypeFromId(d.id())||Ae.trackDefinedEvent("prototype.viewer_navigation_invalid_destination",{cause:i,nodeType:d.type(),interactionId:(a==null?void 0:a.id())??"",enforcePrototypeSecurityBoundaries:this._appState.prototypeSecurityBoundariesEnforced});let A=this._appState.scene().findNode(e);A!=null&&A.type()=="SECTION"&&Ae.trackDefinedEvent("prototype.navigate_to_section",{}),d.setUsedAsBaseScreen(!0),e=d.id()}else{Ae.trackDefinedEvent("prototype.navigate_to_null_frame",{isInlinePreview:Y.isInlinePreview(),enforcePrototypeSecurityBoundaries:this._appState.prototypeSecurityBoundariesEnforced});return}let c=this.getCurrentOverlayData(),p=this.getCurrentAnimationState();if(X.equals(e,l==null?void 0:l.id())&&(l==null?void 0:l.scene())==(d==null?void 0:d.scene())&&c.length==0)return;let u=l!=null?l.id():null,_=[],h;t!=null&&a!=null?h=Wn.forNoodle(t,a,s):(h=Wn.getDefaultExternalExecution(),this._appState.prototypeStructure().navigationOrder().navigationOrderType()===2&&(h.transitionParameters.transitionResetVideoPosition=!0));let S=null;if(o===1){let A=this._appState.scene().findNode(e),I=A==null?void 0:A.objectAnimations();if(I&&I.length>0){let C=I[I.length-1];S=new lo(C.id(),C.getAllActions().length-1)}}let m=new Hr(3,ut.ROOT_STABLE_PATH(),new cr(u,c,p),new cr(e,_,S),h.interactionAddress,h.canvasSpaceTriggerBoundsOrNull,h.transitionParameters,o,i),f=[];switch(n){case 0:{f=this._changeHistory;break}case 1:{f=Mt.FrozenList_cloneAndAppendOne(this._changeHistory,m);break}case 2:{f=[m];break}}let T=d!==null?d.findNearestAncestorOrSelf("SECTION"):null;if(T!==null){let A=this._getStateMachineOrNull(new ut([T.id()]));if(A===null||this._shouldDisableNewChangesInStateMachine(A))return;A.clearInitiatedChangesInSelfAndSubstates();let I=[];switch(n){case 0:{I=A.changeHistory();break}case 1:{I=Mt.FrozenList_cloneAndAppendOne(A.changeHistory(),m);break}case 2:{I=[m];break}}this._requestAndSaveSectionStateChange(A,m,I,f);let C=T,g=T.parent();for(;g!==null&&g.type()==="SECTION";){let R=new Hr(3,ut.ROOT_STABLE_PATH(),new cr(u,c),new cr(C.id(),_),h.interactionAddress,h.canvasSpaceTriggerBoundsOrNull,h.transitionParameters,o,i),D=this._getStateMachineOrNull(new ut([g.id()]));if(D===null||this._shouldDisableNewChangesInStateMachine(D))return;switch(D.clearInitiatedChangesInSelfAndSubstates(),n){case 0:{I=D.changeHistory();break}case 1:{I=Mt.FrozenList_cloneAndAppendOne(D.changeHistory(),R);break}case 2:{I=[R];break}}this._saveSectionStateChange(D,R,I),C=g,g=C.parent()}}else this._requestStateChange(m,f)}playObjectAnimation(e,t,n){if(!this._allowNewStateChanges())return;if(this._initiatedChange){this.commitStateChange();return}let o=kr.getDefault();if(t!=null){let l=e.getObjectAnimationInteraction(t),d=e.getObjectAnimationAction(t);if(l==null||d==null)return;o=kr.fromPrototypeAction(d,l.stateManagementVersion())}let i=this.getCurrentAnimationState(),a=new Hr(3,ut.ROOT_STABLE_PATH(),new cr(e.id(),[],i),new cr(e.id(),[],t),so.EXTERNAL,null,o,n,0);this.logVerbose(()=>`[PrototypeState] playObjectAnimation: ${a.debugString(this._appState.scene())}`);let s=Mt.FrozenList_cloneAndAppendOne(this._changeHistory,a);this._requestStateChange(a,s)}overlayFrame(e,t,n,o,i,a){var h,S;if(!this._allowNewStateChanges()||this.getCurrentBaseScreenId()==null||t==null)return;this._clearInitiatedChangesBeforeNewChange();let s=i!=null?Wn.forNoodle(t,i,a):Wn.forExternalOpenOverlay(t),l=this.getCurrentOverlayData(),d=(h=this._appState.prototypeStructure())==null?void 0:h.getDestinationFrame(e);if(d==null){Oe("tried to open to null overlay");return}(S=N())==null||S.resetLocalNodeSizeChanges(d.id());let c=new Zd(d.id(),e,s.interactionAddress.hotspotStablePath,s.interactionAddress.interactionId,s.transitionParameters,this._getOverlayDerivedModes(this.getSecondTopmostOverlayNodeOrBaseScreen()??this.getCurrentBaseScreenNode(),d)),p=this.getCurrentBaseScreenId(),u=new Hr(3,ut.ROOT_STABLE_PATH(),new cr(p,l),new cr(p,Mt.FrozenList_cloneAndAppendOne(l,c)),s.interactionAddress,s.canvasSpaceTriggerBoundsOrNull,s.transitionParameters,n,o);d.setUsedAsBaseScreen(!1);let _=Mt.FrozenList_cloneAndAppendOne(this._changeHistory,u);this._requestStateChange(u,_)}getSetVariableActionHistoryLength(){return this._setVariableActionHistory.length}getSetVariableModeActionHistoryLength(){return this._setVariableModeActionHistory.length}createMultiplayerSetVariableAction(e,t,n,o){let i={nodeForFindingTopmostScreenId:X.toFigGUID(e),targetVariableId:t,targetVariableData:JSON.stringify(n),resolvedVariableModes:JSON.stringify(o)};this._addVariableToHistory(i)}createMultiplayerSetVariableModeAction(e,t,n){let o={nodeForFindingTopmostScreenId:X.toFigGUID(e),targetVariableSetId:Ia.toKiwi(t),targetVariableModeId:n};this._addVariableModeToHistory(o)}performMultiplayerSetVariableAction(e){N().runSetVariable(X.fromFigGUID(e.nodeForFindingTopmostScreenId),e.targetVariableId,JSON.parse(e.targetVariableData),JSON.parse(e.resolvedVariableModes)),this._addVariableToHistory(e)}performMultiplayerSetVariableModeAction(e){N().runSetVariableMode(X.fromFigGUID(e.nodeForFindingTopmostScreenId),Ia.fromKiwi(e.targetVariableSetId),e.targetVariableModeId),this._addVariableModeToHistory(e)}_addVariableToHistory(e){let t=e.targetVariableId;if(this._variableIdToSetVariableActionHistoryIndex.has(t)){let n=this._variableIdToSetVariableActionHistoryIndex.get(t);this._setVariableActionHistory[n]=e}else this._variableIdToSetVariableActionHistoryIndex.set(t,this._setVariableActionHistory.length),this._setVariableActionHistory.push(e);this._notifyMultiplayerSetVariableActionHistory()}_addVariableModeToHistory(e){let t=Ia.fromKiwi(e.targetVariableSetId);if(!Ia.isValid(t)){Ae.trackEvent("variable_set_mode_action_invalid_id",{variableSetID:t});return}if(this._variableSetIdToSetVariableModeActionHistoryIndex.has(t)){let n=this._variableSetIdToSetVariableModeActionHistoryIndex.get(t);this._setVariableModeActionHistory[n]=e}else this._variableSetIdToSetVariableModeActionHistoryIndex.set(t,this._setVariableModeActionHistory.length),this._setVariableModeActionHistory.push(e);this._notifyMultiplayerSetVariableModeActionHistory(),this._setOverlaysToParentModes(this.getCurrentOverlayData(),this.getCurrentBaseScreenId(),!0)}_notifyMultiplayerSetVariableActionHistory(){this._observers.forEach(e=>{var t;(t=e.handleSetVariableAction)==null||t.call(e,this._setVariableActionHistory)})}_notifyMultiplayerSetVariableModeActionHistory(){this._observers.forEach(e=>{var t;(t=e.handleSetVariableModeAction)==null||t.call(e,this._setVariableModeActionHistory)})}resetVariablePrototypeState(){N().resetLocalVariableChanges(),N().resetLocalVariableModeChanges(),this.resetSetVariableActionHistory(),this.resetSetVariableModeActionHistory()}resetSetVariableActionHistory(){this._setVariableActionHistory=[],this._variableIdToSetVariableActionHistoryIndex=new Map,this._notifyMultiplayerSetVariableActionHistory()}resetSetVariableModeActionHistory(){this._setVariableModeActionHistory=[],this._variableSetIdToSetVariableModeActionHistoryIndex=new Map,this._notifyMultiplayerSetVariableModeActionHistory()}createVideoStateChange(e,t,n,o,i){if(e==null||t==null||n==null)return;let a={targetNodeId:X.toFigGUID(e),isPlaying:t,isPlayingSound:n,currentTimes:o,actionTakenTimestamp:i};this._addVideoStateChangeToHistory(a)}performMultiplayerVideoStateChange(e,t){this._appState.videoManager().multiplayerUpdateVideoRuntimes(e,t),this._addVideoStateChangeToHistory(t)}_addVideoStateChangeToHistory(e){if(!e.targetNodeId)return;let t=X.fromFigGUID(e.targetNodeId);this._guidToVideoStateChangeMap.set(t,e),this._notifyMultiplayerVideoStateChangeToHistory()}_notifyMultiplayerVideoStateChangeToHistory(){this._observers.forEach(e=>{var t;(t=e.handleVideoStateChange)==null||t.call(e,Array.from(this._guidToVideoStateChangeMap.values()))})}getVideoStateChangeForGuid(e){return this._guidToVideoStateChangeMap.get(e)}allVisibleVideosAreLoaded(){var e;return((e=this._appState.videoManager())==null?void 0:e.allVisibleVideosAreLoaded())??!1}snapshotLatestVideoStateChanges(){var e;(e=this._appState.videoManager())==null||e.snapshotVideoStates()}getVideoStateChanges(){return Array.from(this._guidToVideoStateChangeMap.values())}resetSectionsState(){let e=this._appState.getActiveCanvas();if(e!=null){let t=e.findAllSectionsInNode();for(let n of t){let o=this._getStateMachineOrNull(new ut([n.id()]));o!=null&&o.resetHistoryToFirstFrameInSection(n)}}}setActiveSlidesPrototypeEmbedGUID(e){this._activeSlidesPrototypeEmbed=e,this._notifyMultiplayerActiveSlidesPrototypeEmbedChange(e),this._emitter.trigger("activeSlidesPrototypeEmbedChange",e)}getActiveSlidesPrototypeEmbedGUID(){return this._activeSlidesPrototypeEmbed}_notifyMultiplayerActiveSlidesPrototypeEmbedChange(e){this._observers.forEach(t=>{var n;(n=t.handleActiveSlidesEmbeddedPrototypeChange)==null||n.call(t,e)})}resetPrototype(){var e;this._appState.scene()!=null&&(this._clearInitiatedChangesBeforeNewChange(),this._isResettingStateChangeMutations=!0,(e=N())==null||e.resetLocalChanges(),this._initiatedInstanceChanges=new Map,this._isResettingStateChangeMutations=!1,this._clearOverlays(this.getCurrentOverlayData()),this.resetSectionsState(),gr.clearCachedNodePaths(),this.componentStateSyncer.handleRestartPrototype()),this._initiatedChange=null,this._initiatedHistory=null,this._changeHistory=[],this._tlfHistory=[],this._upcomingTlfs=new Set,this.resetSetVariableActionHistory(),this.resetSetVariableModeActionHistory(),this._actionCounter=this._actionCounter+1,this._lastInitiatedTopLevelStateChange=null,this._lastInitiatedInstanceStateChange=null}restartPrototype(e){var o;if(this.logVerbose(()=>`[PrototypeState] restartPrototype started for ${Ca[e]}`),this.mostRecentBaseScreenIdChangeInitiator="PrototypeState.restartPrototype "+Ca[e],this.resetPrototype(),this._observers.forEach(i=>{i.handleRestartPrototype()}),Y.getViewerMode()==Y.ViewerMode.MIRROR)return;if(((o=this._appState.scene())==null?void 0:o.findNode(this._appState.activePrototypeStartingPointNodeId()))==null){let i=this._appState.prototypeStructure().activePrototypeStartNodeOrDefault();i!=null&&(this._appState.prototypeState().mostRecentFixInvalidStateInitiator="PrototypeState.restartPrototype",this._appState.setActivePrototypeStartingPointNodeId(i.id()))}let n=this._appState.prototypeStructure().nodeToRestartPrototypeOn(this._appState.getActiveCanvas());n!=null&&(e==0&&(this._ongoingNavigateRepairsInvalidState=!0),this.navigateToFrameAndCloseOverlays(n.id()),this.tryToInitiateRequestedStateChange(r.InitiateRequestedStateChangePolicy.FORCE_INITIATE_NOW)),this.logVerbose(()=>`[PrototypeState] restartPrototype finished for ${Ca[e]}`)}returnToState1(e){this.returnToState2(null,null,e,0,null,null)}returnToState2(e,t,n,o,i,a){var p;if(!this._allowNewStateChanges()||this._changeHistory.length<=1)return;let s=n!=2,l=null;this._clearInitiatedChangesBeforeNewChange();let d=this._changeHistory.slice(),c=null;for(e!=null&&t!=null?c=Wn.forNoodle(e,t,a):c=Wn.getDefaultExternalExecution();d.length>1&&(s&&ne.List_last(d).isTransientChange());)l=d.pop();if(n==0||d.length<=1){((p=t==null?void 0:t.event())==null?void 0:p.interactionType())=="DRAG"&&this._returnToOverlayState(c,o,l==null?void 0:l.oldOverlayData(),l,d);return}for(l=ne.List_last(d);d.length>1;){let u=d.pop();if(d.length>1&&s&&ne.List_last(d).isTransientChange())continue;let h=u.oldStateId();if(X.equals(h,this.getCurrentBaseScreenId()))this._returnToOverlayState(c,o,u.oldOverlayData(),l,d);else{if(this._appState.prototypeStructure().validDestinationForPrototypeFromId(u.oldStateId())==null)continue;this._returnToFrame(h,c,o,l,d,i)}break}}_returnToFrame(e,t,n,o,i,a){var _;let s=(_=this._appState.prototypeStructure())==null?void 0:_.getDestinationFrame(e),l=o.transitionParameters.withStateManagementSettings(a),d=new Hr(4,ut.ROOT_STABLE_PATH(),new cr(this.getCurrentBaseScreenId(),this.getCurrentOverlayData()),new cr(e,[]),n,t.interactionAddress,1,l);if(s!=null)s.setUsedAsBaseScreen(!0);else{Oe("tried to return to deleted frame");return}let c=!1,p=s.findNearestAncestorOrSelf("SECTION"),u=this.getCurrentBaseScreenNode().findNearestAncestorOrSelf("SECTION");if(p!=null&&u!=null){if(p==u||p==u.parent()){let h=this._getStateMachineOrNull(new ut([p.id()])),S=ne.List_last(h.changeHistory()),m=Mt.FrozenList_cloneAndRemoveOne(h.changeHistory(),S);this._requestAndSaveSectionStateChange(h,d,m,i),c=!0}else if(u==p.parent()){d=new Hr(4,ut.ROOT_STABLE_PATH(),new cr(this.getCurrentBaseScreenId(),this.getCurrentOverlayData()),new cr(p.id(),[]),n,t.interactionAddress,1,o.transitionParameters);let h=this._getStateMachineOrNull(new ut([u.id()])),S=ne.List_last(h.changeHistory()),m=Mt.FrozenList_cloneAndRemoveOne(h.changeHistory(),S);this._requestAndSaveSectionStateChange(h,d,m,i),c=!0}}c||this._requestStateChange(d,i)}_returnToOverlayState(e,t,n,o,i){var s;let a=this.getCurrentOverlayData();if(n.length<a.length)this._closeOverlayAtAndAbove(n.length,e.interactionAddress,e.canvasSpaceTriggerBoundsOrNull,t,i,0);else{for(let c=0,p=n.length;c<p;c=c+1){let u=(s=this._appState.prototypeStructure())==null?void 0:s.getDestinationFrame(n[c].id);if(u==null)break;u.setUsedAsBaseScreen(!1)}let l=this.getCurrentBaseScreenId(),d=new Hr(4,ut.ROOT_STABLE_PATH(),new cr(l,this.getCurrentOverlayData()),new cr(l,n),t,e.interactionAddress,1,o.transitionParameters);this._requestStateChange(d,i)}}swapTopOverlay(e,t,n,o,i){var h,S;if(!this._allowNewStateChanges())return;let a=this.getCurrentOverlayData(),s=this.getCurrentBaseScreenId();if(s==null||a.length==0)return;this._clearInitiatedChangesBeforeNewChange();let l=(h=this._appState.prototypeStructure())==null?void 0:h.getDestinationFrame(e);if(l==null){Oe("tried to swap to null overlay");return}(S=N())==null||S.resetLocalNodeSizeChanges(l.id());let d=a.slice();d[d.length-1]=d[d.length-1].cloneWithId(l.id(),this._getOverlayDerivedModes(this.getSecondTopmostOverlayNodeOrBaseScreen(),l));let c=null,p=0;t!=null&&o!=null?(c=Wn.forNoodle(t,o,i),p=$e.fromInteractionType(o.event().interactionType())):(c=Wn.getDefaultExternalExecution(),p=0);let u=new Hr(3,ut.ROOT_STABLE_PATH(),new cr(s,a),new cr(s,d),c.interactionAddress,c.canvasSpaceTriggerBoundsOrNull,c.transitionParameters,0,p);if(l==null){Oe("tried to swap to null overlay");return}l.setUsedAsBaseScreen(!1);let _=Mt.FrozenList_cloneAndAppendOne(this._changeHistory,u);this._requestStateChange(u,_)}baseScreenWasValidDestinationBeforeNodeChanges(){return this._baseScreenWasValidDestinationBeforeNodeChanges}checkValidBaseScreenBeforeNodeChanges(){this._baseScreenWasValidDestinationBeforeNodeChanges||(this._initiatedChangeBeforeNodeChanges=this._initiatedChange,this._changeHistoryBeforeNodeChanges=this._changeHistory,this._baseScreenWasValidDestinationBeforeNodeChanges=this._appState.prototypeStructure().validDestinationForPrototypeFromId(this._getBaseScreenIdBeforeNodeChanges())!=null)}checkValidBaseScreenAfterNodeChanges(){if(!this._baseScreenWasValidDestinationBeforeNodeChanges)return;let e=this._appState.prototypeStructure();if(e.validDestinationForPrototypeFromId(this.getCurrentBaseScreenId())==null){if(e.validDestinationForPrototypeFromId(this._getBaseScreenIdBeforeNodeChanges())==null)return;this._initiatedChange=this._initiatedChangeBeforeNodeChanges,this._changeHistory=this._changeHistoryBeforeNodeChanges}this._initiatedChangeBeforeNodeChanges=null,this._changeHistoryBeforeNodeChanges=[],this._baseScreenWasValidDestinationBeforeNodeChanges=!1}_getBaseScreenIdBeforeNodeChanges(){return this._getBaseScreenIdFromChangeOrHistory(this._initiatedChangeBeforeNodeChanges,this._changeHistoryBeforeNodeChanges)}_clearInitiatedChangesBeforeNewChange(){this._disableNewStateChanges=!0,this._appState.scene()!=null&&this._forEachTransitioningStateMachine(e=>{let t=this._getStateMachineOrNull(e);return t!=null&&t.clearInitiatedChangesInSelfAndSubstates(),0}),this._initiatedChange!=null&&(this.mostRecentFixInvalidStateInitiator="PrototypeState._clearInitiatedChangesBeforeNewChange",this.commitStateChange()),this._disableNewStateChanges=!1}_allowNewStateChanges(){return this.interactionsEnabled()&&!this._disableNewStateChanges}abortStateChange(){if(this._initiatedChange==null)return;let e=this._initiatedChange;this._initiatedChange=null,this._initiatedHistory=null,this._broadcastStateChange(e,2,null),this._handleOverlaysModeSetting(e,2),this._enforceValidPrototypeState()}commitStateChange(){if(this._initiatedChange==null||this._initiatedHistory==null)return;let e=this._initiatedChange;this._changeHistory=this._initiatedHistory,this._initiatedChange=null,this._initiatedHistory=null,this.logVerbose(()=>`[PrototypeState] commitTopLevelChange ${e.debugString(this._appState.scene())}`);let t=[],n=o=>{t.push(o)};if(this._broadcastStateChange(e,3,n),this._handleOverlaysModeSetting(e,3),this._allowNewStateChanges())for(let o of t)o();Y.isInlinePreview()||this._enforceValidPrototypeState()}_enqueueUpcomingTlfs(){let e=this.getCurrentBaseScreenNode();if(e==null)return;let t=Yt.adjacentBaseScreens(this._appState.prototypeStructure().nodeTransitionTracker().cleanedUpTransitionMapByTLF(),e);for(let n of t.asList())this._upcomingTlfs.add(n);this._shouldNotifyNavigationInfoInvalidated=!0,this._enqueueUpcomingTlfsDeadline=0}getUpcomingTlf(){for(;this._upcomingTlfs.size>0;){let e=nb(this._appState.scene(),Array.from(this._upcomingTlfs.values()).map(t=>X.fromString(t)))[0];if(this._appState.prototypeStructure().topLevelPrototypeNodesInOrder().indexOf(e)>=0){this._upcomingTlfs.delete(e);continue}return this._appState.scene().findNode(e)==null?null:X.fromString(e)}return null}setForceInitiateStateChangeForTests(e){this._forceInitiateStateChangeForTests=e}_requestStateChange(e,t){var n;this._broadcastStateChange(e,0,null),this._requestedStateChange=new r.StateChangeRequest(e,t),this._requestedStateChangeAtMs=Me.milliseconds(),this._emitter.trigger("requestedStateChange",{interactionId:(n=e==null?void 0:e.interactionAddress)==null?void 0:n.interactionId,cause:$e[e.cause],destinationId:e.newStateId()}),this._disableNewStateChanges=!0,this.tryToInitiateRequestedStateChange(r.InitiateRequestedStateChangePolicy.WAIT_UNTIL_DESTINATIONS_LOADED)}_requestAndSaveSectionStateChange(e,t,n,o){this._appState.scene()!=null&&(e.stage(t,n),this._requestStateChange(t,o),X.equals(t.oldStateId(),t.newStateId())||this.commitSectionStateChange(e))}_saveSectionStateChange(e,t,n){this._appState.scene()!=null&&(e.stage(t,n),X.equals(t.oldStateId(),t.newStateId())||this.commitSectionStateChange(e))}tryToInitiateRequestedStateChange(e){this._requestedStateChange!=null&&(this._forceInitiateStateChangeForTests||e==r.InitiateRequestedStateChangePolicy.FORCE_INITIATE_NOW?this._initiateStateChange(this._requestedStateChange.change,this._requestedStateChange.history):Array.from(this._requestedStateChange.change.newStateAndOverlays.statesAndOverlaysIncluded()).every(o=>{var a;let i=(a=this._appState.scene())==null?void 0:a.findNode(o);return i==null?!1:i.hasBeenLoaded()})&&this._initiateStateChange(this._requestedStateChange.change,this._requestedStateChange.history))}_maybeTrackStateChangeInitiated(e){var n;let t=e.newStateAndOverlays.statesAndOverlaysIncluded();for(let o of t)this._visitedScreenIds._in(o)||this._visitedScreenIds.add(o);if(this._requestedStateChangeAtMs>0){let o=Me.milliseconds()-this._requestedStateChangeAtMs;if(o>100){let i={prototypeType:this._appState.prototypeStructure().navigationOrder().navigationOrderTypeString(),incrementalFrameLoading:!0,timeWaitedForLoadingMs:o,interactionId:(n=e==null?void 0:e.interactionAddress)==null?void 0:n.interactionId,interactionCause:$e[e.cause],destinationId:e.newStateId(),enforcePrototypeSecurityBoundaries:this._appState.prototypeSecurityBoundariesEnforced},a=this._appState.requestedFrameMetricsTracker().getMetricsForRequestedNode(e.newStateId());this._appState.requestedFrameMetricsTracker().clear(),a&&(i.destinationWasLoaded=a.wasAlreadyLoaded,i.destinationWasInWorkingSet=a.wasAlreadyInWorkingSet),Ae.trackDefinedEvent("prototype.viewer_reached_unloaded_frame",i)}}}_initializeStateForObjectAnimation(e){let t=e.oldStateId(),n=e.newStateId(),o=this._appState.scene().findNode(n);if(o==null)return;let i=o.objectAnimations();if(!i.length)return;let a=-1,s=0;if(t!=n)e.direction==0?a=0:e.direction==1&&(a=i.length-1,s=i[a].getAllActions().length-1);else{if(e.direction==0)return;if(e.direction==1)if(e.newObjectAnimationState()==null)a=0;else{let l=e.newObjectAnimationState();if(l==null)return;a=i.findIndex(d=>d.id()==l.interactionId),s=l.actionIndex}}this.logVerbose(()=>`[PrototypeState] _initializeAnimationStateForNewBaseScreen with animation index ${a} with direction ${e.direction}`),a!=-1&&N().previewSceneAt(n,a,s)}_initiateStateChange(e,t){this._disableNewStateChanges=!0,this._updateCurrentBaseScreenIDs(e);for(let i of e.getRemovedFrameIds())this._forEachMaterializedStateInTlf(i,a=>{if(a.changeHistory().length>0&&ne.List_last(a.changeHistory()).isTransientChange(!0)){let s=$e.getOppositeTransientAction(ne.List_last(a.changeHistory()).cause);return this.returnInstanceToState(a.stablePath,0,s),a.clearInitiatedChangesInSelfAndSubstates(),2}return 0});this._emitter.trigger("requestedStateChangeInitiated"),this._maybeTrackStateChangeInitiated(e),this._requestedStateChange=null,this._requestedStateChangeAtMs=-1,this._disableNewStateChanges=!1,this._initiatedChange=e,this._initiatedHistory=t;let n=e.newStateId(),o=this._tlfHistory.indexOf(n);this._initializeStateForObjectAnimation(e),o<0&&ne.List_appendOne(this._tlfHistory,n),this._shouldNotifyNavigationInfoInvalidated=!0,this.logVerbose(()=>`[PrototypeState] initiateTopLevelChange ${e.debugString(this._appState.scene())}`),this._lastInitiatedTopLevelStateChange=e,this._actionCounter=this._actionCounter+1,this._broadcastStateChange(e,1,null),this._handleOverlaysModeSetting(e,1),(e==null?void 0:e.oldStateId())!=(e==null?void 0:e.newStateId())&&(this._ongoingNavigateRepairsInvalidState=!1),e.canInstantlyCommit()&&(this.mostRecentFixInvalidStateInitiator="PrototypeState._initiateStateChange",this.commitStateChange()),this._deferEnqueueUpcomingTlfs()}_updateCurrentBaseScreenIDs(e){var n;let t=e.newStateAndOverlays.statesAndOverlaysIncluded();(n=N())==null||n.modules().prototype.updateCurrentBaseScreenIDs(t)}_handleOverlaysModeSetting(e,t){let n=e.oldOverlayData(),o=n.length,i=e.newOverlayData(),a=i.length;if(!(a==0&&o==0)){if(a>o)t==1?this._setOverlaysToParentModes(i.slice(o),e.oldStateAndOverlays.topId()):t==2&&this._clearOverlays(i.slice(o));else if(a<o)t==3&&this._clearOverlays(n.slice(a));else if(a>0&&o>0&&a===o&&i[a-1].id!=n[o-1].id){let s=[i[a-1]];t==1?this._setOverlaysToParentModes(s,this.getSecondTopmostOverlayNodeOrBaseScreen().id()):t==2&&this._clearOverlays(s),t==3&&this._clearOverlays([n[o-1]])}}}_getOverlayDerivedModes(e,t){let n=t.getExplicitVariableModesWithSetKeys(),o=t.getResolvedVariableModesWithSetKeys(),i=e.getResolvedVariableModesWithSetKeys();return Object.entries(i).filter(([a,s])=>o[a]!=null&&n[a]==null)}_setOverlaysToParentModes(e,t,n){var i;let o=t;e.forEach(a=>{let s=this._appState.scene().findNode(a.id),l=this._appState.scene().findNode(o),d=l.getResolvedVariableModesWithSetKeys(),c=[];n?a.newOverlayExplicitModes.forEach(([p,u])=>{d[p]!=u&&s.setExplicitVariableModeForCollectionWithSetKey(p,d[p]),c.push([p,d[p]])}):this._getOverlayDerivedModes(l,s).forEach(([p,u])=>{s.setExplicitVariableModeForCollectionWithSetKey(p,d[p]),c.push([p,d[p]])}),a.newOverlayExplicitModes=c,o=a.id}),(i=N())==null||i.updateImmutableFramesAndLayoutDirtyGroupsAndStacks()}_clearOverlays(e){var t;e.forEach(n=>{let o=this._appState.scene().findNode(n.id);if(o==null)return;let i=o.getExplicitVariableModesWithSetKeys();n.oldOverlayDerivedModes.filter(([a,s])=>i[a]!=null&&(n.newOverlayExplicitModes[a]==null||i[a]==n.newOverlayExplicitModes[a])).forEach(([a,s])=>{o.clearExplicitVariableConsumerModeForCollectionWithSetKey(a)})}),(t=N())==null||t.updateImmutableFramesAndLayoutDirtyGroupsAndStacks()}lastInitiatedTopLevelStateChange(){return this._lastInitiatedTopLevelStateChange}_broadcastStateChange(e,t,n){let o=this._isNotifyingStateChangeObservers;switch(o&&Oe("[PrototypeState] An observer performed a prototype state change while another state change was still being broadcasted."),this._isNotifyingStateChangeObservers=!0,t){case 0:{this._observers.forEach(i=>{i.handleStateChangeRequested(e)});break}case 1:{this._observers.forEach(i=>{i.handleStateChangeInitiated(e)});break}case 2:{this._observers.forEach(i=>{i.handleStateChangeAborted(e)});break}case 3:{this._observers.forEach(i=>{i.handleStateChangeCommitted(e,n)});break}}this._isNotifyingStateChangeObservers=o}debugHSMTree(){console.log("== Component SST =="),console.log(this.componentStateSyncer.debugString()),console.log("== Component HSM =="),console.log(this._hsmRoot.debugHierarchy(this._appState.scene()))}addHsmObserver(e){this._hsmObservers.add(e)}removeHsmObserver(e){this._hsmObservers.remove(e)}_getStateMachineOrNull(e){let t=e==null?void 0:e.guids;if(t==null)return null;let n=this._hsmRoot;for(let o of t){if(n==null)break;n=n.childOrNull(o)}return n}getStateMachineOrNull(e){return this._getStateMachineOrNull(e)}_getStateMachineOrNullWithString(e){return this._getStateMachineOrNull(ut.fromString(e))}_getParentStateMachineOrNull(e){return e.guids.length==0?null:this._getStateMachineOrNull(e.slice2(0,e.guids.length-1))}_forMaterializedStateMachineAndDescendants(e,t){var i;let o=[this._getStateMachineOrNull(e)];for(;o.length>0;){let a=o.pop();if(a!=null){let s=((i=this._appState.scene())==null?void 0:i.findNodeByStablePath(a.stablePath))==null,l=0;s?a==this._hsmRoot?l=0:l=2:l=t(a);let d=!1;switch(l){case 1:{d=!0;break}case 0:{Ir(o,a.getChildren());break}case 2:continue}if(d)break}}}createOrRepairStateMachinesForInsertedSubtree(e){yn(e,t=>{if(t.isInstance()){let n=t.symbolID()??X.invalid();X.isValid(n)||console.warn("Unexpected null symbolData for instance in instance generation"),this.createOrRepairInstanceStateMachineIfNeeded(t,n)}else t.type()=="SECTION"&&this.createOrRepairSectionStateMachineIfNeeded(t,t.id())})}createOrRepairSectionStateMachineIfNeeded(e,t){let n=this._getParentStateMachineOrNull(e.stablePath());if(n==null){Oe("Could not create or repair state machine for section with null parent");return}let o=ne.List_last(e.stablePath().guids),i=n.childOrNull(o);if(i!=null)if(X.equals(i.stateId(),t)){this._isResettingStateChangeMutations&&i.resetHistoryToFirstFrameInSection(e);return}else i.initiatedChange()!=null&&this.commitSectionStateChange(i);n.setChild(o,new oc(this,e,t,!0))}createOrRepairInstanceStateMachineIfNeeded(e,t){let n=this._getParentStateMachineOrNull(e.stablePath());if(n==null){console.warn("Could not create or repair state machine with null parent");return}let o=ne.List_last(e.stablePath().guids),i=n.childOrNull(o);if(i!=null){if(X.equals(i.stateId(),t)){this._isResettingStateChangeMutations&&i.resetHistoryToState(t);return}else if(i.initiatedChange()!=null){if(this.isApplyingStateChangeMutation())return;this.commitInstanceStateChange(i)}}n.setChild(o,new oc(this,e,t))}actionCounterForState(e){let t=this._getStateMachineOrNull(e);return t==null?-1:t.actionCounter}actionCountersForStateAndAncestors(e){let t=[this.actionCounter()];for(let n=0,o=e.guids.length;n<o;n=n+1)t.push(this.actionCounterForState(e.slice2(0,n+1)));return t}getStateMachineInitiatedChange(e){let t=this._getStateMachineOrNull(e);return t==null?void 0:t.initiatedChange()}getStateMachineLastChangeInHistory(e){let t=this._getStateMachineOrNull(e);return t==null||t.changeHistory().length==0?null:t!==null?ne.List_last(t.changeHistory()):null}getLastFrameOrSectionVisitedInSection(e){if(e==null)return null;let t=this.getStateMachineLastChangeInHistory(new ut([e]));return t!=null?t.newStateAndOverlays.stateId:null}getState(e){let t=this._getStateMachineOrNull(e);return t==null?void 0:t.stateId()}_forEachMaterializedStateInTlf(e,t){var o;let n=(o=this._appState.scene())==null?void 0:o.findNode(e);n==null||!n.isTopLevel()||yn(n,i=>{if(i.isInstance()){let a=this._getStateMachineOrNull(i.stablePath());if(a!=null)return t(a)}return 0})}_forEachTransitioningStateMachine(e){for(let t of Array.from(this._initiatedInstanceChanges.keys()))if(Array.from(this._initiatedInstanceChanges.keys()).indexOf(t)!=-1){let n=this._initiatedInstanceChanges.get(t);if(e(n.stablePath)==1)break}}getOnscreenStates(){let e=[],t=this.getLayersIds();for(let n of t)this._forEachMaterializedStateInTlf(n,o=>{if(!1){let i=this._appState.scene().findNodeByStablePath(o.stablePath)}return e.push(new Un(o.stablePath,o.stateId())),0});return e}forMaterializedStateInstanceAndDescendants(e,t){this._forMaterializedStateMachineAndDescendants(e,n=>t(n.stablePath))}_deferEnqueueUpcomingTlfs(){this._enqueueUpcomingTlfsDeadline=Me.milliseconds()+(hn?0:250)}lastInitiatedInstanceStateChange(){return this._lastInitiatedInstanceStateChange}_forStateMachineAndParents(e,t){let n=e.guids,o=[],i=this._hsmRoot,a=0;for(;i!=null&&a<n.length;)i=i.childOrNull(n[a]),i!=null&&o.push(i),a=a+1;if(!(o.length==0||!ut.equals(ne.List_last(o).stablePath,e))){for(let s=o.length-1;s>=0;s=s-1)if(t(o[s])==1)return}}_shouldDisableNewChangesInStateMachine(e){var o;let t=(o=this._appState.scene())==null?void 0:o.findNodeByStablePath(e.stablePath);if(t==null)return!0;let n=t;for(;n!=null;){let i=this._getStateMachineOrNull(n.stablePath());if(i!=null&&i.isClearingChangesInSelfAndSubstates())return!0;n=n.parent()}return!1}swapInstanceToState1(e,t,n,o,i,a){this.swapInstanceToState2(e,t,n,o,i,a,null)}swapInstanceToState2(e,t,n,o,i,a,s){this.logVerbose(()=>`[HSM] >>>>>>>> swap instance ${e} to state -> ${t} cause: ${$e[o]}`);let l=this._getStateMachineOrNull(e);if(l==null||this._shouldDisableNewChangesInStateMachine(l)||this._validatedStateSwapDestination(l.stateId(),t)==null)return;l.clearInitiatedChangesInSelfAndSubstates();let c=n!=null&&i!=null?Wn.forNoodle(n,i,s):Wn.getDefaultExternalExecution(),p=new Hr(2,l.stablePath,l.stateId(),t,c.interactionAddress,c.canvasSpaceTriggerBoundsOrNull,c.transitionParameters,o),u=null;switch(a){case 0:{u=l.changeHistory();break}case 1:{u=Mt.FrozenList_cloneAndAppendOne(l.changeHistory(),p);break}case 2:{u=[p];break}}let _=this._shouldDisallowSwap(e,t);_==Ts.DISALLOWED_CYCLE?this._onStateSwapFailedDueToCycle():_==Ts.ALLOWED&&this._requestInstanceStateChange(l,p,u)}returnInstanceToState(e,t,n){this.logVerbose(()=>`[HSM] >>>>>>>> return instance ${e} to previous state cause: ${$e[n]}`);let o=this._getStateMachineOrNull(e);if(o==null||this._shouldDisableNewChangesInStateMachine(o)||(o.clearInitiatedChangesInSelfAndSubstates(),o.changeHistory().length<=1))return;let i=o.cloneHistoryForReturnToState(t,(p,u)=>this._validatedStateSwapDestination(p,u)),a=i.a,s=i.b,l=this._validatedStateSwapDestination(o.stateId(),ne.List_last(s).newStateId());if(l==null)return;let d=new Hr(2,o.stablePath,o.stateId(),l.id(),a.interactionAddress,a.canvasSpaceTriggerBoundsOrNull,a.transitionParameters,n),c=this._shouldDisallowSwap(o.stablePath,l.id());c==Ts.DISALLOWED_CYCLE?this._onStateSwapFailedDueToCycle():c==Ts.ALLOWED&&this._requestInstanceStateChange(o,d,s)}_requestInstanceStateChange(e,t,n){this._forMaterializedStateMachineAndDescendants(e.stablePath,i=>{if(i!=e&&i.changeHistory().length>0&&ne.List_last(i.changeHistory()).isTransientChange(!0)){let a=$e.getOppositeTransientAction(ne.List_last(i.changeHistory()).cause);return this.returnInstanceToState(i.stablePath,0,a),i.clearInitiatedChangesInSelfAndSubstates(),2}return 0});let o=this._appState.scene();if(o!=null){e.stage(t,n),this._initiatedInstanceChanges.set(e.stablePath.toString(),t),this._lastInitiatedInstanceStateChange=t;let i=this._appState.scene().findNodeByStablePath(t.interactionAddress.hotspotStablePath),a=new Map,s=null;this._isApplyingStateChangeMutation=!0,e.broadcastHsmStateChange(this._hsmObservers,t,0,null),o.dangerouslyDeferNodeRemovalScope(()=>{let c=this._getFullscreenNodeChangesForStateSwap(e.stablePath,t.newStateId(),Es.MATERIALIZE_SWAPPED_OUT_TREE,!0);for(let p of c.cloneOps)p.clone.copyNodeCachedTransformAndBounds(p.source),a.set(p.source,p.clone);s=this._appState.scene().findNodeByStablePath(c.transitionRootStablePath)});let l=Yd.Map_getOrDefault(a,i,null),d=Yd.Map_getOrDefault(a,s,null);s!=null&&d!=null?s.transitioningFrom=new Id(d,t.stablePath,l):Oe("Failed to find swapped out node after state swap"),X.equals(t.oldStateId(),t.newStateId())||(this._forEachTransitioningStateMachine(c=>{if(!ut.equals(t.stablePath,c)){let p=o.findNodeByStablePath(c);if(s!=null&&s.isAncestorOf(p)){let u=this._getStateMachineOrNull(c);this.commitInstanceStateChange(u)}}return 0}),this._deferEnqueueUpcomingTlfs()),this._isApplyingStateChangeMutation=!1}e.actionCounter=e.actionCounter+1,e.broadcastHsmStateChange(this._hsmObservers,t,1,null),this.logVerbose(()=>`[HSM] initiate ${t.oldStateId()} -> ${t.newStateId()} finished for ${e.stablePath} -- ${t.transitionParameters.transitionType} !`)}commitChangesBelowStablePath(e){var n,o;let t=(n=this._appState.scene())==null?void 0:n.findNodeByStablePath(e);for(let i of Array.from(this._initiatedInstanceChanges.keys())){let a=this._initiatedInstanceChanges.get(i);if(a!=null){let s=this._getStateMachineOrNull(a.stablePath);s!=null&&t!=null&&t.isAncestorOf((o=this._appState.scene())==null?void 0:o.findNodeByStablePath(s.stablePath))&&this.commitInstanceStateChange(s)}}}commitChangesBelowInstanceTransitionRoot(e){let t=this._findTransitionRootForSwappedPath(e),n=t==null?e:t.stablePath();this.commitChangesBelowStablePath(n)}commitInstanceStateChange(e){if(e.initiatedChange()==null)return;let t=e.initiatedChange();e.setChangeHistory(e.initiatedChangeHistory()),e.stage(null,null),this._initiatedInstanceChanges.delete(e.stablePath.toString()),X.equals(t.oldStateId(),t.newStateId())||this._finishStateSwapMutation(t.stablePath);let n=[],o=i=>{n.push(i)};if(e.broadcastHsmStateChange(this._hsmObservers,t,3,o),!e.isClearingChangesInSelfAndSubstates())for(let i of n)i();this.logVerbose(()=>`[HSM] commit ${t.oldStateId()} -> ${t.newStateId()} finished for ${t.stablePath} -- ${t.transitionParameters.transitionType} !`)}commitSectionStateChange(e){e.initiatedChange()!=null&&(e.setChangeHistory(e.initiatedChangeHistory()),e.stage(null,null))}abortInstanceStateChange(e){let t=this._getStateMachineOrNull(e);if(t==null||t.initiatedChange()==null)return;let n=t.initiatedChange();if(this._appState.scene()!=null){t.stage(null,null),this._initiatedInstanceChanges.delete(t.stablePath.toString());let i=this._findTransitionRootForSwappedPath(e),a=i.transitioningFrom.exitingTransitionRoot;this._isApplyingStateChangeMutation=!0,i.transitioningFrom=null,a.removeSelfAndSubtree(),t.broadcastHsmStateChange(this._hsmObservers,n,0,null),this._getFullscreenNodeChangesForStateSwap(t.stablePath,n.oldStateId(),Es.SKIP_MATERIALIZATION),this._isApplyingStateChangeMutation=!1}t.broadcastHsmStateChange(this._hsmObservers,n,2,null),this.logVerbose(()=>`[HSM] abort ${n.oldStateId()} -> ${n.newStateId()} finished for ${t.stablePath} -- ${n.transitionParameters.transitionType} !`)}_validatedStateSwapDestination(e,t){var s,l;let n=(s=this._appState.scene())==null?void 0:s.findNode(e),o=n==null?void 0:n.parent();if((n==null?void 0:n.type())!="SYMBOL"||o==null||!o.isStateGroup())return null;let i=(l=this._appState.scene())==null?void 0:l.findNode(t),a=i==null?void 0:i.parent();return(i==null?void 0:i.type())!="SYMBOL"||a==null||!a.isStateGroup()||X.equals(e,t)?null:X.equals(o.id(),a.id())?i:null}isApplyingStateChangeMutation(){return this._isApplyingStateChangeMutation}isResettingStateChangeMutations(){return this._isResettingStateChangeMutations}_findTransitionRootForSwappedPath(e){var n;let t=(n=this._appState.scene())==null?void 0:n.findNodeByStablePath(e);for(;t!=null;){if(t.transitioningFrom!=null&&t.transitioningFrom.swappedStablePath==e)return t;t=t.parent()}return null}_finishStateSwapMutation(e){let t=this._findTransitionRootForSwappedPath(e);if(this.logVerbose(()=>`[PrototypeState] _finishStateSwapMutation started for ${e}`),t==null)return;let n=t.transitioningFrom.exitingTransitionRoot;this._isApplyingStateChangeMutation=!0,t.transitioningFrom=null,n.removeSelfAndSubtree(),this._isApplyingStateChangeMutation=!1,t.invalidateRenderTreeForSelfAndParents(),t.invalidateRenderTreeForChildren(),this.logVerbose(()=>`[PrototypeState] _finishStateSwapMutation finished for ${e}`)}_getFullscreenNodeChangesForStateSwap(e,t,n,o){return N().getNodeChangesForSwap(e,t,n,o)}_shouldDisallowSwap(e,t){return N().shouldDisallowSwap(e,t)}logVerbose(e){this.VERBOSE_LOGS&&(this.debugHSMTree(),console.log(e()))}};(t=>{class r{constructor(o,i){this.change=o,this.history=i}}t.StateChangeRequest=r;let e;(i=>(i[i.WAIT_UNTIL_DESTINATIONS_LOADED=0]="WAIT_UNTIL_DESTINATIONS_LOADED",i[i.FORCE_INITIATE_NOW=1]="FORCE_INITIATE_NOW"))(e=t.InitiateRequestedStateChangePolicy||(t.InitiateRequestedStateChangePolicy={}))})(ba||(ba={}));var Ca=(t=>(t[t.FIX_INVALID_STATE=0]="FIX_INVALID_STATE",t[t.USER_REQUESTED=1]="USER_REQUESTED",t))(Ca||{});var oc=class{constructor(e,t,n,o){this.stablePath=null,this._changeHistory=null,this._initiatedChange=null,this._initiatedChangeHistory=null,this._isNotifyingStateChangeObservers=!1,this.actionCounter=0,this._children=new Map,this._isClearingChangesInSelfAndSubstates=!1,this._prototypeState=e,t?(this.stablePath=t.stablePath(),o?this.resetHistoryToFirstFrameInSection(t):this.resetHistoryToState(n)):(this.stablePath=new ut([]),this.setChangeHistory([]))}changeHistory(){return this._changeHistory}setChangeHistory(e){this._changeHistory=e}debugHierarchy(e){return this._debugHierarchy(0,e)}_debugHierarchy(e,t){let n="";for(let u=0,_=e;u<_;u=u+1)n+="  ";n+=this.stablePath.toString()+": ";let o="missing state name",i="(N/A)";if(this.stateId()!=null){let u=t.findNode(this.stateId());u!=null&&(o=u.name()??"null state name"),i="("+this.stateId()+")"}n+="<"+o+" "+i+">";let a="[",s=0,l=3,d=this.changeHistory();d.length>l&&(a+="..., ",s=d.length-l);for(let u=s,_=d.length;u<_;u=u+1){let h=d[u];a+=`${(h==null?void 0:h.oldStateId())??"null"}->${h==null?void 0:h.newStateId()}`,u!=d.length-1&&(a+=", ")}a+="]",n+=" "+a;let c=t.findNodeByStablePath(this.stablePath);if(c!=null){let u=c.name()??"null node name";n+=" "+u}let p=this.initiatedChange()!=null?`{${this.initiatedChange().oldStateId()??"null"}->${this.initiatedChange().newStateId()}}`:"";n+=" "+p+`
`;for(let u of Array.from(this._children.values()))n+=u._debugHierarchy(e+1,t);return n}removeChild(e){this._children.delete(e)}setChild(e,t){this._children.set(e,t)}childOrNull(e){return Ge.StringMap_get(this._children,e,null)}getChildren(){return Array.from(this._children.values())}stage(e,t){this._initiatedChange=e,this._initiatedChangeHistory=t}initiatedChange(){return this._initiatedChange}initiatedChangeHistory(){return this._initiatedChangeHistory}stateId(){var t,n;if(((t=this.initiatedChange())==null?void 0:t.newStateId())!=null)return(n=this.initiatedChange())==null?void 0:n.newStateId();let e=this.changeHistory();return e!=null&&e.length>0?ne.List_last(e).newStateId():X.invalid()}clearInitiatedChangesInSelfAndSubstates(){this._isClearingChangesInSelfAndSubstates=!0,this._prototypeState.commitChangesBelowInstanceTransitionRoot(this.stablePath),this._isClearingChangesInSelfAndSubstates=!1}isClearingChangesInSelfAndSubstates(){return this._isClearingChangesInSelfAndSubstates}cloneHistoryForReturnToState(e,t){let n=e!=2,o=null,i=this.changeHistory().slice();for(;i.length>1&&(n&&ne.List_last(i).isTransientChange());)o=i.pop();if(e==0||i.length<=1)return new Un(o,i);for(o=ne.List_last(i);i.length>1;){let a=i.pop();if(!(i.length>1&&n&&ne.List_last(i).isTransientChange()||t(a.newStateId(),a.oldStateId())==null))break}return new Un(o,i)}resetHistoryToState(e){let t=new Hr(2,this.stablePath,null,e,so.EXTERNAL,null,kr.getDefault(),0);this.setChangeHistory([t])}resetHistoryToFirstFrameInSection(e){let t=ls.visuallySortedTopLevelFrames(e);if(t.length>0){let n=t[0];if(n!=null){let o=new Hr(2,this.stablePath,null,n.id(),so.EXTERNAL,null,kr.getDefault(),0);this.setChangeHistory([o])}}else this.setChangeHistory([])}broadcastHsmStateChange(e,t,n,o){let i=this._isNotifyingStateChangeObservers;switch(i&&console.warn("[PrototypeState] An observer performed a prototype state change while another state change was still being broadcasted."),this._isNotifyingStateChangeObservers=!0,n){case 0:{e.forEach(a=>{a.handleHsmRequested(this.stablePath,t)});break}case 1:{e.forEach(a=>{a.handleHsmInitiated(this.stablePath,t)});break}case 2:{e.forEach(a=>{a.handleHsmAborted(this.stablePath,t)});break}case 3:{e.forEach(a=>{a.handleHsmCommitted(this.stablePath,t,o)});break}}this._isNotifyingStateChangeObservers=i}};var Rh=class{track(e,t){this._frameRequestInfo.set(e,t)}getMetricsForRequestedNode(e){return this._frameRequestInfo.get(e)}clear(){this._frameRequestInfo.clear()}constructor(){this._frameRequestInfo=new Map}};var vh=class{hash(){return Ur.bytesToHex(this._hash)}binaryHash(){return this._hash}getVideoManager(){return this._videoManager}size(e){let t=this._videoManager.getVideoRuntimeForPaint(e);return t?t.size():new b(0,0)}didLoad(e){let t=this._videoManager.getVideoRuntimeForPaint(e);return t==null?!1:t.isReadyToPlay()}getOrCreateTexture(e,t,n){let o=this._videoManager.getVideoRuntimeForPaint(e);return o==null||o.shouldDisplayThumbnail?null:o.getOrCreateTexture(t,n)}pause(e){let t=this._videoManager.getVideoRuntimeForPaint(e);t!=null&&t.pause()}constructor(e,t){this.id=pw++,this._hash=e,this._videoManager=t,this._loadComplete=!1}},pw=0;var Kn;(e=>e.VERBOSE_LOGS=!1)(Kn||(Kn={}));var ac=class ac{constructor(e,t,n){this._videoLoadAttemptId=0;this.id=(ac.nextID=ac.nextID+1)+-1,this._videoResolver=t,this._hash=e,this._videoManager=n,this._loadTimeTracker=new Yg,this._loadComplete=!1,this._texture=null,this._player=null,this._isInErrorState=!1,this._isErrorRetryable=null,this._fileTypeLoading="hls",this._loop=!1,this._seeking=!1,this._overrideSeeking=!1,this._prevReadyState=ic.HAVE_NOTHING,this.overriddenPlayingState=null,this.overriddenMutedState=null,this.shouldDisplayThumbnail=!0,this._MP4VideoUrl=null}clone(){let e=new ac(this._hash,this._videoResolver,this._videoManager);return this._videoManager.enqueueVideoOrStartLoad(e),e}isReadyToPlay(){if(this._player==null||!this._loadComplete||this._isInErrorState)return!1;if(Pt.ios()||this.isSeeking())return this._player.readyState()>ic.HAVE_NOTHING;{let e=this._player.currentTime()==this._player.duration()&&this._player.readyState()>=ic.HAVE_CURRENT_DATA;return this._player.readyState()>=ic.HAVE_FUTURE_DATA||e}}isInErrorState(){return this._isInErrorState}isErrorRetryable(){return this._isErrorRetryable}uninitialize(){this._player!=null&&(this.pause(),this.setMuted(!1),this.resetToStartTime(),this._player.dispose())}toString(){if(this._player==null)return`Runtime(id=${this.id},  <NO VIDEO INFORMATION> )`;let e=this._player.currentTime()|0,t=gt.int_remainder(e,60)<10?`0${gt.int_remainder(e,60)}`:`${gt.int_remainder(e,60)}`,o=`${(e/60|0)<10?`0${e/60|0}`:`${e/60|0}`}:${t}`;return this._isInErrorState?`Runtime(id=${this.id}, <LOADING ERROR>)`:`Runtime(id=${this.id}, time=${o}, ready=${this.isReadyToPlay()}, P=${!this._player.paused()}, M=${this._player.muted()}, L=${this._loop})`}_setMuted(e,t){if(this._player!=null){Pt.ios()&&!e&&this._videoManager.muteAllOtherVideos(this);try{this._player.muted(e),t&&(this.overriddenMutedState=new ce(e))}catch{Ae.trackEvent("video_mute_failure",{errorState:this._isInErrorState,loadComplete:this._loadComplete,fileType:this._fileTypeLoading})}}}setMutedByVideoAction(e){this._setMuted(e,!0)}setMuted(e){this._setMuted(e,!1)}muted(){return this._player!=null?this._player.muted():!0}setLoop(e){this._loop=e}size(){return this._player==null?null:new b(this._player.videoWidth(),this._player.videoHeight())}_pause(e){Kn.VERBOSE_LOGS&&console.log("VideoResource #",this.id,": Pausing"),this._player!=null&&(this._player.pause(),e&&(this.overriddenPlayingState=new ce(!1)))}pauseByVideoAction(){this._pause(!0)}pause(){this._pause(!1)}_play(e,t){Kn.VERBOSE_LOGS&&(e?console.log("VideoResource #",this.id,": Loop playback"):console.log("VideoResource #",this.id,": Start playback")),this._player!=null&&this.isReadyToPlay()&&(this.shouldDisplayThumbnail=!1,this._player.play().then(n=>{t&&(this.overriddenPlayingState=new ce(!0)),this.reportPlaySuccessAnalytics()},n=>{let o=n.message+"";o.indexOf("The play() request was interrupted")!=-1?this.reportPlayFailureAnalytics(e?`Loop error: ${o}`:o):(console.warn("User has yet to interact with page, starting video muted",n),this.setMuted(!0),this._player.play().then(i=>{this.reportPlaySuccessAnalytics()},i=>{let a=i.message+"";e&&(a=`Loop error: ${a}`),this.reportPlayFailureAnalytics(a)}))}))}_playLoop(){this._play(!0,!1)}playByVideoAction(){this._play(!1,!0)}play(){this._play(!1,!1)}duration(){return this._player!=null?this._player.liveTracker!=null?this._player.liveTracker.seekableEnd():this._player.duration():0}currentTime1(){return this._player!=null?this._player.currentTime():0}currentTime2(e){this._player!=null&&(this._player.paused()&&this._player.one("timeupdate",t=>{this.invalidateTexture()}),this._player.currentTime(e))}resetToStartTime(){this.currentTime2(0)}isPlaying(){return this._player==null?!1:!this._player.paused()}setIsSeeking(e){this._overrideSeeking=e}isSeeking(){return this._seeking||this._overrideSeeking}invalidateTexture(){if(this._texture==null)return;this._texture.invalidateVideoFrame()}_handleOnLoadedMetadata(e){var t;Kn.VERBOSE_LOGS&&console.log("VideoResource #",this.id,": Loading completed"),this.reportLoadSuccessAnalytics(e),this._loadComplete=!0,window.vid=this,(t=this._videoManager)==null||t.onVideoLoaded(this)}_getVideoLoadAttemptIdAndIncrement(){return(this._videoLoadAttemptId++).toString()}_beginLoadingHLS(e){this._loadTimeTracker.start(),this._fileTypeLoading="hls",this._player.src({type:"application/x-mpegURL",src:this._videoResolver.manifestUrl}),this._player.one("error",t=>{this._loadTimeTracker.end(),console.warn("Reverting to fallback media source"),this.reportLoadFailureAnalytics("Failed to access HLS manifest",e),this._beginLoadingMP4(e)})}_beginLoadingMP4(e,t=!1){this._loadTimeTracker.start(),this._fileTypeLoading="mp4",this._videoResolver.fetchMp4Url().then2(n=>{t?fetch(n).then(o=>o.blob()).then(o=>{this._player.src({type:"video/mp4",src:URL.createObjectURL(o)})}):this._player.src({type:"video/mp4",src:n}),this._player.one("error",o=>{this._loadTimeTracker.end(),this._isInErrorState=!0,this._isErrorRetryable=!1;try{this.reportLoadFailureAnalytics(`Failed to access mp4. Error code: ${o.code} Message: ${o.message}`,e)}catch{this.reportLoadFailureAnalytics("Failed to access mp4.",e)}})},({message:n,statusCode:o})=>{this._loadTimeTracker.end(),this.reportLoadFailureAnalytics(`Failed to acquire mp4 url. ${n}`,e),this._isInErrorState=!0,this._isErrorRetryable=o!=404})}startLoadIfNeeded(e=!1){if(this._player!=null&&!e||e&&this._isPreloaded)return;this._isPreloaded=e;let t=this._getVideoLoadAttemptIdAndIncrement(),n=document.createElement("video");if(n.crossOrigin="anonymous",n.style.display="none",document.body.appendChild(n),this._player=Zn.instance().getPlayer(n,e?"auto":void 0),this._player==null){Zn.instance().isLibAvailable()&&(this._isInErrorState=!0,this._isErrorRetryable=!1,this.reportLoadFailureAnalytics("Failed to create VideoJS player",t));return}this._player.muted(!0),this._player.playsinline(!0),this._player.autoplay(!1),this._player.loop(!1),this._player.ready(()=>{this._player.on("ended",o=>{this._loop?this._playLoop():this.resetToDefaultState()}),this._player.on("seeking",o=>{this._seeking=!0}),this._player.on("seeked",o=>{this._seeking=!1}),this._player.on("loadedmetadata",o=>{this._handleOnLoadedMetadata(t)})}),e?this._beginLoadingMP4(t,!0):this._beginLoadingHLS(t)}on(e,t){let n=o=>{t(this._player)};return this._player!=null&&this._player.on(e,n),n}off(e,t){this._player!=null&&this._player.off(e,t)}getHtmlVideoElement(){return this._player==null||!this._loadComplete?null:kc.VideoJsPlayer_getBackingVideo(this._player)}getOrCreateTexture(e,t){if(this._texture==null&&this._loadComplete){let n=kc.VideoJsPlayer_getBackingVideo(this._player);this._texture=e.createTextureWithVideo(t,n,yr.IMAGE)}return!this.isReadyToPlay()||this.isInErrorState()?null:this._texture}resetToDefaultState(){this.overriddenPlayingState=null,this.overriddenMutedState=null}_getCurrentLocation(){return window.location.href.indexOf("/community/")!=-1?"community_viewer":"viewer"}reportLoadFailureAnalytics(e,t){this._loadTimeTracker.end();let n=this._loadTimeTracker.getLoadTime();n<0||(console.warn("Video failed to load:",e),Ae.trackDefinedEvent("prototype.video_load",{status:"failure",hash:this._hash,load_time:n,file_type:this._fileTypeLoading,reason:e,location:this._getCurrentLocation(),attempt_id:t,runtime_id:this.id.toString()}))}reportLoadSuccessAnalytics(e){this._loadTimeTracker.end();let t=this._loadTimeTracker.getLoadTime();t<0||Ae.trackDefinedEvent("prototype.video_load",{status:"success",hash:this._hash,load_time:t,file_type:this._fileTypeLoading,width:this._player.videoWidth(),height:this._player.videoHeight(),location:this._getCurrentLocation(),attempt_id:e,runtime_id:this.id.toString()})}reportPlaySuccessAnalytics(){Ae.trackDefinedEvent("prototype.video_play",{status:"success",hash:this._hash,location:this._getCurrentLocation()})}reportPlayFailureAnalytics(e){Ae.trackDefinedEvent("prototype.video_play",{status:"failure",hash:this._hash,reason:e,location:this._getCurrentLocation()})}};ac.nextID=0;var al=ac,ic;(i=>(i.HAVE_NOTHING=0,i.HAVE_METADATA=1,i.HAVE_CURRENT_DATA=2,i.HAVE_FUTURE_DATA=3,i.HAVE_ENOUGH_DATA=4))(ic||(ic={}));var Yg=class{start(){this._endConditionSeconds=-1,this._startConditionSeconds=Me.seconds()}end(){this._endConditionSeconds=Me.seconds()}getLoadTime(){return this._endConditionSeconds<0||this._startConditionSeconds<0?-1:this._endConditionSeconds-this._startConditionSeconds}constructor(){this._startConditionSeconds=-1,this._endConditionSeconds=-1}},tu=class extends Xa{uninitialize1(){this.uninitialize2(e=>{e.uninitialize()})}toString1(){return this.toString2(e=>e.toString())}constructor(){super()}};var ru=class{constructor(e){this._hash=e}},nu=class extends Go{},qg=new class extends ru{get manifestUrl(){return""}fetchMp4Url(){let r=new nu;return r.resolve(""),r}}(""),Qg=class extends ru{constructor(t){super(t);this._cachedMp4Url=void 0;let n=Ct.getVideoPrefixUrl(),o=n!=null&&n.endsWith("/")?n:n+"/";this._metaMp4Url=`${o}${this._hash}`,this._manifestUrl=`${this._metaMp4Url}/manifest`}get manifestUrl(){return this._manifestUrl}fetchMp4Url(){let t=new nu;return this._cachedMp4Url?(t.resolve(this._cachedMp4Url),t):(new po(this._metaMp4Url).userIdHeader().get().then(n=>{let o=null;try{o=JSON.parse(n.text)}catch{t.reject({message:"Failed to parse response"});return}let i=new ce(o.status);if(i.value===void 0){t.reject({message:"Failed to parse status from response"});return}if(i.value!=200){t.reject({message:`Status is ${i.value}: ${o.message}`,statusCode:i.value});return}let a=o.meta;if(a===void 0){t.reject({message:"Failed to parse signed_url",statusCode:i.value});return}let s=a.signed_url;if(s===void 0){t.reject({message:"Failed to parse signed_url",statusCode:i.value});return}this._cachedMp4Url=s,t.resolve(s)},n=>{t.reject({message:"Request failed",statusCode:n.status})}),t)}},Xg=class extends ru{constructor(e){super(e),this._mp4Url=`/test/videos/${e}`}get manifestUrl(){return""}fetchMp4Url(){let e=new nu;return e.resolve(this._mp4Url),e}};function ab(r){return hn?new Xg(r):new Qg(r)}var Oh=class{constructor(e){this._visiblePaints=new Set([]),this._appState=null,this._lastStateChange=null,this._appState=e}isPaintVisible(e){return this._visiblePaints.has(e)}forEachVisiblePaint(e){for(let t=0,n=Array.from(this._visiblePaints.values()).length;t<n;t=t+1)e(Array.from(this._visiblePaints.values())[t])}refreshVisibleVideosIfNeeded(){this.handlePrototypeStateChange(this._lastStateChange)}handlePrototypeStateChange(e){var a;if(e==null)return;this._visiblePaints=new Set;let t=e.newStateId(),n=(a=this._appState.scene())==null?void 0:a.findNode(t);if(n==null)return;this._lastStateChange=e,this._gatherVisibleVideoResources(n);let o=e.newOverlayData();for(let s=0,l=o.length;s<l;s=s+1){let d=this._appState.scene().findNode(o[s].id);this._gatherVisibleVideoResources(d)}let i="";this.forEachVisiblePaint(s=>{i+=" "+s.id().toString()+","}),Kn.VERBOSE_LOGS&&console.log("Found these visible paints:",i)}_gatherVisibleVideoResources(e){if(!e.visible())return;for(let n=0,o=e.childCount();n<o;n=n+1)this._gatherVisibleVideoResources(e.childAt1(n));let t=null;if(e.getCachedRenderTree()!=null)t=e.getCachedRenderTree();else if(e.getCachedRenderTreeForBaseScreen()!=null)t=e.getCachedRenderTreeForBaseScreen();else return;this._gatherVideosFromRenderNode(t.value)}_gatherVideosFromRenderNode(e){if(e!=null)switch(e.op()){case 3:{this._gatherVideosFromFillNode(e);break}case 4:{this._gatherVideosFromFillStrokeNode(e);break}case 5:{this._gatherVideosFromMaskNode(e);break}case 1:{this._gatherVideosFromGroupNode(e);break}case 6:{let t=e;this._gatherVideosFromRenderNode(t.child);break}case 2:{let t=e;this._gatherVideosFromRenderNode(t.child);break}case 9:{let t=e;this._gatherVideosFromRenderNode(t.alpha);break}case 7:{let t=e;this._gatherVideosFromRenderNode(t.child);break}case 8:{let t=e;this._gatherVideosFromRenderNode(t.tree);break}case 10:{let t=e;this._gatherVideosFromRenderNode(t.child);break}case 11:{let t=e;this._gatherVideosFromRenderNode(t.child);break}case 12:{let t=e;this._gatherVideosFromRenderNode(t.startChild),this._gatherVideosFromRenderNode(t.endChild);break}case 0:{let t=e;this._gatherVideosFromRenderNode(t.child);break}}}_gatherVideosFromFillNode(e){let t=e.geometry.paints;Se.forEachPaintWithVideo(t,n=>{this._visiblePaints.add(n)})}_gatherVideosFromFillStrokeNode(e){let t=e.fillGeometries;for(let n=0,o=t.length;n<o;n=n+1){let i=t[n].paints;Se.forEachPaintWithVideo(i,a=>{this._visiblePaints.add(a)})}for(let n=0,o=e.strokeGeometries.length;n<o;n=n+1){let i=e.strokeGeometries[n].paints;Se.forEachPaintWithVideo(i,a=>{this._visiblePaints.add(a)})}}_gatherVideosFromMaskNode(e){this._gatherVideosFromRenderNode(e.color)}_gatherVideosFromGroupNode(e){for(let t=0,n=e.children.length;t<n;t=t+1)this._gatherVideosFromRenderNode(e.children[t])}getLastTopLevelStateChange(){return this._lastStateChange}};var Li=class Li extends al{constructor(t,n,o,i){super(t,qg,i);this.guid="";this._isPlaying=!1;this._isPlayingSound=!0;this._currentTime=0;this._isReady=!1;this._duration=1/0;this.eventListener=t=>{var o,i,a,s;if((t==null?void 0:t.origin)!==Li.eventOrigin)return;let n=this.parseEventData(t);if(!(!n||n.id!==this.channelId||n.channel!==Li.channel))switch(n.event){case"onReady":this._isReady=!0;break;case"infoDelivery":if(typeof((o=n.info)==null?void 0:o.playerState)=="number"&&(n.info.playerState===1||n.info.playerState===2||n.info.playerState===3)){let l=n.info.playerState===1||n.info.playerState===3;this._isPlaying!==l&&(this._isPlaying=l,this._videoManager.updateVideoRuntime(this.getMediaAction(l?"PLAY":"PAUSE"),this.guid))}if(typeof((i=n.info)==null?void 0:i.muted)=="boolean"){let l=n.info.muted===!1;this._isPlayingSound!==l&&(this._isPlayingSound=l)}typeof((a=n.info)==null?void 0:a.currentTime)=="number"&&(this.shouldSeek(n.info.currentTime)&&this._videoManager.updateVideoRuntime(this.getMediaAction("SKIP_TO",{mediaSkipToTime:new ce(n.info.currentTime)}),this.guid),this._currentTime=n.info.currentTime),typeof((s=n.info)==null?void 0:s.duration)=="number"&&(this._duration=n.info.duration);break}};this.guid=n,this.iframe=o,this.channelId=Li.currentChannelId++,this.subscribeToEvents()}subscribeToEvents(){var t;window.addEventListener("message",this.eventListener),(t=this.iframe.contentWindow)==null||t.postMessage(JSON.stringify({event:"listening",id:this.channelId,channel:Li.channel}),"*")}issueCommand(t,n){var o,i;(i=(o=this.iframe)==null?void 0:o.contentWindow)==null||i.postMessage(JSON.stringify({event:"command",func:t,args:n}),Li.eventOrigin)}parseEventData(t){try{return JSON.parse(t.data)}catch{return null}}getMediaAction(t,n={}){let o=ir.NULL_ACTION.withTransitionNodeID(this.guid).withMediaAction(t);return n.mediaSkipToTime?o.withMediaSkipToTime(n.mediaSkipToTime.value):o}shouldSeek(t){return!isNaN(t)&&Math.abs(this._currentTime-t)>2}clone(){let t=new Li(this._hash,this.guid,this.iframe,this._videoManager);return this._videoManager.enqueueVideoOrStartLoad(t),t}isReadyToPlay(){return this._isReady}isInErrorState(){return!1}uninitialize(){window.removeEventListener("message",this.eventListener)}toString(){return`YoutubeRuntime(${this.guid})`}_setMuted(t,n){}muted(){return!this._isPlayingSound}size(){return new b(0,0)}_pause(t){this._isPlaying&&(this._isPlaying=!1,this.issueCommand("pauseVideo"))}_play(t,n){this._isPlaying||(n&&this._isPlayingSound&&(this._isPlayingSound=!1,this.issueCommand("mute")),this._isPlaying=!0,this.issueCommand("playVideo"))}duration(){return this._duration}currentTime1(){return this._currentTime}currentTime2(t){this.shouldSeek(t)&&(this._currentTime=t,this.issueCommand("seekTo",[t,!0]))}isPlaying(){return this._isPlaying}resetToDefaultState(){this.issueCommand("stopVideo")}setLoop(t){}invalidateTexture(){}startLoadIfNeeded(){}on(t,n){return i=>{}}off(t,n){}reportLoadFailureAnalytics(t){}reportLoadSuccessAnalytics(){}reportPlayFailureAnalytics(t){}};Li.currentChannelId=1,Li.channel="widget",Li.eventOrigin="https://www.youtube.com";var Ch=Li;var lc=class r{constructor(e,t,n,o){this.status=r.Status.PENDING,this.interactionType=e,this.interactionID=t,this.hotspotNodeID=n,this.listener=o,this.internalEventListeners=[]}};(e=>{let r;(i=>(i[i.PENDING=0]="PENDING",i[i.ACTIVE=1]="ACTIVE",i[i.SUPERCEDED=2]="SUPERCEDED"))(r=e.Status||(e.Status={}))})(lc||(lc={}));var sc=class{constructor(e,t){this.nodePath=e,this.videoPlayback=t}},ou=class{constructor(e,t){this.eventName=e,this.listener=t}},sb="VideoManager",iu=class r{runtimeStorage(){return this._runtimeStorage}subscribeToVideoRuntimeUpdates(e){let t=this._videoRuntimeUpdateSubscriptionKey;return this._videoRuntimeUpdateSubscriptionKey+=1,this._videoRuntimeUpdateSubscriptions.set(t,e),()=>{this._videoRuntimeUpdateSubscriptions.delete(t)}}_fireVideoRuntimeSubscriptions(){this._videoRuntimeUpdateSubscriptions.forEach(e=>e())}associatePaintWithNode(e,t){this._needToRecalculateVisibleVideos=!0;let n=t.uniqueIdentifier();this._paintToNodeGUIDMap.set(e,n);let o=this._nodeGUIDToVideoHashesMap.get(n);o||(o=[],this._nodeGUIDToVideoHashesMap.set(n,o)),o.push(e.video().hash()),this._guidToVideoMetadata.set(n,new sc(gr.getSemanticNodePath(t),t.videoPlayback())),this._paintsForPlaybackSettingsRefresh.add(e),this._fireVideoRuntimeSubscriptions()}associateYoutubeWithNode(e,t){let n=e;if(!this._hashToRuntimeMap.has(n)){let a=new Ch(n,e,t,this);this._hashToRuntimeMap.set(n,a)}let o=this.getNodePathForNode(e);this._guidToVideoMetadata.set(e,new sc(o,{autoplay:!1,mediaLoop:!1,muted:!1,showControls:!1}));let i=this._hashToRuntimeMap.get(n).clone();this._runtimeStorage.insert(o,n,i),this._fireVideoRuntimeSubscriptions()}disassociateYoutubeWithNode(e){let t=e;this._hashToRuntimeMap.has(t)&&this._hashToRuntimeMap.delete(t),this._guidToVideoMetadata.has(e)&&this._guidToVideoMetadata.delete(e);let n=this.getNodePathForNode(e);this._runtimeStorage.remove(n,t),this._fireVideoRuntimeSubscriptions()}getNodePathForNode(e){let t=this._appState.scene();if(!t)return[];let n=t.findNode(e);if(!n)return[];let o=[];for(;n;)o.unshift(new Qa(n.name(),this.getPositionOutOfAllSiblingsWithSameName(n))),n=n.parent();return o}getPositionOutOfAllSiblingsWithSameName(e){let t=0,n=e.parent();if(n){let o=!1;n.forEachChild(i=>{o=o||i.id()===e.id(),!o&&i.name()===e.name()&&(t+=1)})}return t}constructor(e){this._appState=null,this._guidToVideoMetadata=new Map,this._hashToRuntimeMap=new Map,this._nodeGUIDToVideoHashesMap=new Map,this._paintToNodeGUIDMap=new Map,this._runtimeStorage=new tu,this._deferredRuntimes=new Set,this._deferredInteractionEvents=new Set,this._visibilityTracker=null,this._needToRecalculateVisibleVideos=!1,this._framePotentiallyReadyToPlay=!0,this._paintsForPlaybackSettingsRefresh=new Set,this._lastTransitionShouldForceStateRefresh=!1,this._userHasInteractedWithPage=!1,this._appState=e,this._visibilityTracker=new Oh(e),this._lastPlayedVideo=null,this._appState.addFrameObserver(this),this._appState.prototypeState().addObserver(this),this._appState.prototypeState().addHsmObserver(this),this._appState.addActionObserver(this),this._appState.addAppObserver(this),this._videoRuntimeUpdateSubscriptionKey=0,this._videoRuntimeUpdateSubscriptions=new Map}getNodeMetadata(e){if(this._guidToVideoMetadata.has(e))return this._guidToVideoMetadata.get(e)}getVideoRuntimeForPaint(e){var a;if(!this._paintToNodeGUIDMap.has(e))return null;let t=this._paintToNodeGUIDMap.get(e);if(!t)return null;let n=(a=this.getNodeMetadata(t))==null?void 0:a.nodePath;if(!n)return null;let o=e.video().hash();return this._runtimeStorage.getData(n,o)}getPlaybackSettingsForPaint(e){if(!this._paintToNodeGUIDMap.has(e))return null;let t=this._paintToNodeGUIDMap.get(e),n=this.getNodeMetadata(t).videoPlayback;return n==null&&(n={autoplay:!0,mediaLoop:!0,muted:!1,showControls:!1}),n}_populateRuntimesForVisibleVideos(){this._visibilityTracker.forEachVisiblePaint(e=>{if(!this._paintToNodeGUIDMap.has(e))return;let t=this._paintToNodeGUIDMap.get(e),n=this.getNodeMetadata(t).nodePath;if(this.getVideoRuntimeForPaint(e)!=null)return;let o=e.video().hash(),i=this._hashToRuntimeMap.get(o).clone();this._runtimeStorage.insert(n,o,i)})}getVideoRuntimesForNode(e){var o;let t=(o=this.getNodeMetadata(e))==null?void 0:o.nodePath;if(t==null)return null;let n=this._runtimeStorage.getAllDataForNode(t);return n==null?null:Ad._filter(n,i=>(this._nodeGUIDToVideoHashesMap.get(e)??[]).includes(i))}updateVideoRuntime(e,t){let n=X.isValid(e.transitionNodeID())?e.transitionNodeID():t;if(!this._guidToVideoMetadata.has(n))return;let o,i,a=[],s=this.getVideoRuntimesForNode(n);s!=null&&(s.forEach((l,d)=>{if(l==null)return;let c=e.mediaAction();switch(c){case"PLAY":{this.playVideo(l,n,c);break}case"PAUSE":{l.pauseByVideoAction();break}case"TOGGLE_PLAY_PAUSE":{l.isPlaying()?l.pauseByVideoAction():this.playVideo(l,n,c);break}case"MUTE":{l.setMutedByVideoAction(!0);break}case"UNMUTE":{l.setMutedByVideoAction(!1);break}case"TOGGLE_MUTE_UNMUTE":{l.setMutedByVideoAction(!l.muted());break}case"SKIP_FORWARD":{let p=e.mediaSkipByAmount(),u=Math.min(l.currentTime1()+p,l.duration()-.01);l.currentTime2(u);break}case"SKIP_BACKWARD":{let p=e.mediaSkipByAmount(),u=Math.max(0,l.currentTime1()-p);l.currentTime2(u);break}case"SKIP_TO":{let p=e.mediaSkipToTime(),u=Math.max(0,p);u=Math.min(u,l.duration()-.01),l.currentTime2(u);break}}o=l.isPlaying(),i=!l.muted(),a.push(l.currentTime1()*1e3)}),o!=null&&i!=null&&a.length>0&&this._createVideoStateChangeInPrototypeState(n,o,i,a))}snapshotVideoStates(e=[...this._guidToVideoMetadata.keys()]){e.forEach(t=>{let n=null,o=null,i=[],a=this.getVideoRuntimesForNode(t);a!=null&&(a.forEach(s=>{n=s.isPlaying(),o=!s.muted(),i.push(s.currentTime1()*1e3)}),n!=null&&o!=null&&i.length>0&&this._createVideoStateChangeInPrototypeState(t,n,o,i))})}_createVideoStateChangeInPrototypeState(e,t,n,o){this._appState.prototypeState().createVideoStateChange(e,t,n,o,this._currentTruncatedTimeInMilliseconds())}resetVideoStateChanges(e){Array.from(e.keys()).forEach(t=>{if(!this._guidToVideoMetadata.has(t))return;let n=this.getVideoRuntimesForNode(t);if(n==null)return;let o=[];n.forEach((i,a)=>{o.push(i.currentTime1())}),this._createDefaultVideoStateChangeInPrototypeState(t,o)})}_createDefaultVideoStateChangeInPrototypeState(e,t){var i;let n=(i=this.getNodeMetadata(e))==null?void 0:i.videoPlayback,o=!(n!=null&&n.muted);this._appState.prototypeState().createVideoStateChange(e,(n==null?void 0:n.autoplay)??!1,o,t,this._currentTruncatedTimeInMilliseconds())}multiplayerUpdateVideoRuntimes(e,t){let n=X.fromFigGUID(t.targetNodeId);if(!this._guidToVideoMetadata.has(n))return;let o=this.getVideoRuntimesForNode(n);if(o==null)return;let i=0;o.forEach((a,s)=>{if(a!=null){if(t.isPlaying!=a.isPlaying()&&(a.isPlaying()?a.pauseByVideoAction():(a.playByVideoAction(),this._lastPlayedVideo=n)),t.isPlayingSound!=!a.muted()&&a.setMutedByVideoAction(!t.isPlayingSound),!a.isPlaying()||t.currentTimes[i]!=e[i]){let l=this._currentTruncatedTimeInMilliseconds()-t.actionTakenTimestamp,c=(a.isPlaying()?t.currentTimes[i]+l:t.currentTimes[i])%(a.duration()*1e3);a.currentTime2(c/1e3)}i+=1}})}_currentTruncatedTimeInMilliseconds(){return Date.now()%1e6}_registerDeferredInteractionEvent(e){if(e.status==1)return;let t=this.getVideoRuntimesForNode(e.hotspotNodeID);if(t!=null){for(let n of Array.from(t.keys())){let o=t.get(n);if(e.interactionType=="ON_MEDIA_END"){let i=o.on("ended",a=>{e.listener(a)});e.internalEventListeners.push(new ou("ended",i))}else if(e.interactionType=="ON_MEDIA_HIT"){let i=o.on("timeupdate",a=>{e.listener(a)});e.internalEventListeners.push(new ou("timeupdate",i)),i=o.on("play",a=>{e.listener(a)}),e.internalEventListeners.push(new ou("play",i))}}e.status=1}}_deregisterDeferredInteractionEvent(e){if(e.status!=2)return;let t=this.getVideoRuntimesForNode(e.hotspotNodeID);if(t!=null)for(let n of Array.from(t.keys())){let o=t.get(n);for(let i of e.internalEventListeners)o.off(i.eventName,i.listener)}}_getListenerForInteractionEvent(e,t,n){let o=null;if(e=="ON_MEDIA_END")o=i=>{n()};else if(e=="ON_MEDIA_HIT"){let i=!1;o=a=>{let s=a.currentTime(),l=a.liveTracker?a.liveTracker.seekableEnd():a.duration();t>l&&(t=l);let d=.3;if(s>=t-d&&s<t){let c=Math.ceil((t-s)*1e3)|0;setTimeout(()=>{let p=a.currentTime(),u=a.paused()&&p<t,_=p>=t&&p<t+d;!i&&!u&&_&&(i=!0,n())},c)}else i=!1}}else console.error("videoManager.addInteractionEvent() should only be called with video trigger events");return o}addInteractionEvent(e,t,n,o){let i=e.event().interactionType(),a=this._getListenerForInteractionEvent(i,n,o),s=new lc(i,e.id(),t,a);for(let l of Array.from(this._deferredInteractionEvents.values()))l.interactionID==s.interactionID&&(l.status=2,Zn.instance().isLibAvailable()&&(this._deregisterDeferredInteractionEvent(l),this._deferredInteractionEvents.delete(l)));Zn.instance().isLibAvailable()&&this._registerDeferredInteractionEvent(s),this._deferredInteractionEvents.add(s)}onFrame(){if(Kn.VERBOSE_LOGS&&console.log(this.debugString()),this._visibilityTracker!=null){if(this._needToRecalculateVisibleVideos&&(this._visibilityTracker.refreshVisibleVideosIfNeeded(),this._populateRuntimesForVisibleVideos(),this._framePotentiallyReadyToPlay=!0,this._needToRecalculateVisibleVideos=!1,Kn.VERBOSE_LOGS&&console.log(this.debugString())),this._framePotentiallyReadyToPlay&&this.allVisibleVideosAreLoaded()){this._framePotentiallyReadyToPlay=!1,this._applyPlaybackSettingsToVisibleVideos();for(let e of Array.from(this._deferredInteractionEvents.values()))e.status==0?this._registerDeferredInteractionEvent(e):e.status==2&&(this._deregisterDeferredInteractionEvent(e),this._deferredInteractionEvents.delete(e));Kn.VERBOSE_LOGS&&console.log(this.debugString())}this._invalidateTexturesOfPlayingVideos()}}resetAllRuntimesWithinNode(e){let t=new Nt(this._appState.scene().findNode(e)),n=gr.getSemanticNodePath(t),o=this._runtimeStorage.getSubTrie(n),i=[];o!=null&&o.forEach(a=>{a.resetToStartTime(),i.push(a.currentTime1())}),this._createDefaultVideoStateChangeInPrototypeState(e,i)}resetAllRuntimesWithinTLFNode(e){let t=this._appState.scene().findNode(e);if(!t){na.loge(sb,"Cannot find TLF node for resetAllRuntimesWithinTLFNode",{tlfGuid:e},{reportAsSentryError:!0,logToConsole:0});return}for(let i=0,a=t.childCount();i<a;i=i+1){let s=t.childAt1(i);this.resetAllRuntimesWithinNode(s.id())}let n=this._runtimeStorage.getSubTrie([new Qa(t.name(),0)]),o=[];n!=null&&n.forEach(i=>{i.resetToStartTime(),o.push(i.currentTime1())}),this._createDefaultVideoStateChangeInPrototypeState(e,o)}handleHsmAborted(e,t){}handleHsmCommitted(e,t,n){if(this._lastTransitionShouldForceStateRefresh=t.transitionParameters.transitionResetVideoPosition,t.transitionParameters.transitionResetVideoPosition){let o=this._appState.scene().findNodeByStablePath(e);o&&this.resetAllRuntimesWithinNode(o.id())}this.reactToStateChange(this._visibilityTracker.getLastTopLevelStateChange(),t.getInsertedFrameIds())}handleHsmInitiated(e,t){}handleHsmRequested(e,t){}handleStateChangeCommitted(e,t){if(this._lastTransitionShouldForceStateRefresh=e.transitionParameters.transitionResetVideoPosition,e.transitionParameters.transitionResetVideoPosition){this.resetAllRuntimesWithinTLFNode(e.newStateId());let n=e.newOverlayData();for(let o=0,i=n.length;o<i;o=o+1)this.resetAllRuntimesWithinNode(n[o].id)}this.reactToStateChange(e,e.getInsertedFrameIds())}handleStateChangeAborted(e){}handleStateChangeInitiated(e){}handleStateChangeRequested(e){}handleFitModeChange(e,t){}handleRestartPrototype(){this._appState.isPreloaded||(this._lastPlayedVideo=null,this._deleteVisibleRuntimes(),this._framePotentiallyReadyToPlay=!0)}reactToStateChange(e,t){this._recalculateVisibleVideoPaints(e);let n=!0,o=new Set;this._visibilityTracker.forEachVisiblePaint(s=>{if(!this._paintToNodeGUIDMap.has(s))return;let l=s.video().hash(),d=this._paintToNodeGUIDMap.get(s),c=this.getNodeMetadata(d).nodePath,p=this.getVideoRuntimeForPaint(s);p!=null&&(o.add(p.id),this._lastPlayedVideo===d&&(n=!1));let u=this._appState.scene().findNode(d);for(let _ of t){let h=this._appState.scene().findNode(_);h!=null&&h.isAncestorOf(u)&&this._paintsForPlaybackSettingsRefresh.add(s)}if(p==null){let _=this._hashToRuntimeMap.get(l).clone();this._runtimeStorage.insert(c,l,_)}}),n&&(this._lastPlayedVideo=null);let i=Array.from(this._guidToVideoMetadata.entries()),a=new Set;i.forEach(([s,l])=>{var c;let d=(c=this._runtimeStorage.getAllDataForNode(l.nodePath))==null?void 0:c.values();d&&Array.from(d).forEach(p=>{!o.has(p.id)&&p.isPlaying()&&(p.pause(),a.add(s))})}),this.snapshotVideoStates([...a]),this._framePotentiallyReadyToPlay=!0}handleAction(e,t){this._userHasInteractedWithPage||(e==5||e==6||e==8||e==9||e==10)&&(this._userHasInteractedWithPage=!0,this._visibilityTracker.forEachVisiblePaint(n=>{let o=this.getVideoRuntimeForPaint(n),i=this.getPlaybackSettingsForPaint(n);o!=null&&i!=null&&!i.muted&&o.setMuted(i.muted)}),this._appState.removeActionObserver(this))}_applyPlaybackSettingsToVisibleVideos(){let e=[];this._visibilityTracker.forEachVisiblePaint(t=>{if(!this._paintsForPlaybackSettingsRefresh.has(t))return;this._paintsForPlaybackSettingsRefresh.delete(t);let n=this.getVideoRuntimeForPaint(t),o=this.getPlaybackSettingsForPaint(t),i=this._paintToNodeGUIDMap.get(t);if(!n||!o||!i)return;e.push(i),n.setLoop(o.mediaLoop),this._lastTransitionShouldForceStateRefresh&&n.resetToDefaultState();let s=n.overriddenMutedState==null?o.muted:n.overriddenMutedState.value;n.setMuted(s),(n.overriddenPlayingState==null?o.autoplay:n.overriddenPlayingState.value)?this.playVideo(n,i,void 0,"_applyPlaybackSettingsToVisibleVideo"):n.pause()}),this.snapshotVideoStates(e)}_invalidateTexturesOfPlayingVideos(){this._visibilityTracker.forEachVisiblePaint(e=>{let t=this.getVideoRuntimeForPaint(e);t!=null&&(t.isPlaying()||t.isSeeking())&&t.invalidateTexture()})}_recalculateVisibleVideoPaints(e){Kn.VERBOSE_LOGS&&console.log("Recalculating visible paints"),this._visibilityTracker.handlePrototypeStateChange(e),this._visibilityTracker.forEachVisiblePaint(t=>{let n=this.getVideoRuntimeForPaint(t);n!=null&&n.startLoadIfNeeded()}),this._framePotentiallyReadyToPlay=!0}_deleteVisibleRuntimes(){Kn.VERBOSE_LOGS&&console.log("Deleting existing runtimes"),this._runtimeStorage.uninitialize1()}buildVideoResource(e){this.initializeRuntimes();let t=new vh(e,this);return this.addToHashToRuntimeMap(t),t}addToHashToRuntimeMap(e){let t=e.hash();if(!this._hashToRuntimeMap.has(t)){let n=ab(t),o=new al(t,n,this);this._hashToRuntimeMap.set(t,o)}}initializeRuntimes(){Zn.instance().hasRequestedLibrary()||(Zn.instance().onSuccess=()=>{for(let e of Array.from(this._deferredRuntimes.values()))e.startLoadIfNeeded()},Zn.instance().requestLibrary())}allVisibleVideosAreLoaded(){let e=!0;return this._visibilityTracker.forEachVisiblePaint(t=>{let n=this.getVideoRuntimeForPaint(t);n!=null&&!n.isReadyToPlay()&&!n.isInErrorState()&&(e=!1)}),e}onVideoLoaded(e){this._fireVideoRuntimeSubscriptions();let t=this._appState.imageManager();t==null||t.onImageLoaded==null||(this.allVisibleVideosAreLoaded()?(Kn.VERBOSE_LOGS&&console.log("VideoManager - - : All videos in frame are loaded!"),this._appState.baseScreenNode()!=null&&t.onImageLoaded(this._appState.baseScreenNode())):Kn.VERBOSE_LOGS&&console.log("VideoManager - - : Not all videos in frame are loaded"))}handleSceneChange(e,t){e!=null&&e.removeObserver(this),t!=null&&t.addObserver(this)}handleActiveCanvasChange(e,t){}handleActivePrototypeStartingPointChange(e,t){}handleSceneGraphEvent(e){e.property==75&&(this._guidToVideoMetadata.set(e.node.id(),new sc(gr.getSemanticNodePath(new Nt(e.node)),e.newVal)),this._paintToNodeGUIDMap.forEach((t,n)=>{t==e.node.id()&&this._paintsForPlaybackSettingsRefresh.add(n)}),this._framePotentiallyReadyToPlay=!0)}debugString(){let e=`VideoManager 
`;return e+="Need to recalculate visible videos: "+this._needToRecalculateVisibleVideos.toString()+`
`,e+="Frame may be ready to start playing videos: "+this._framePotentiallyReadyToPlay.toString()+`
`,e+=`	Loading Runtimes:
`,this._hashToRuntimeMap.forEach((t,n)=>{e+="		hash: "+n+" -> "+t.toString()+`
`}),e+=`	VisiblePaints:
`,this._visibilityTracker.forEachVisiblePaint(t=>{let n=this.getPlaybackSettingsForPaint(t);n!=null?e+="		"+t.debugString()+" muted="+n.muted.toString()+" loop="+n.mediaLoop.toString()+" autoplay="+n.autoplay.toString()+" hash: "+t.video().hash()+`
`:e+="		"+t.debugString()+` (no playback settings found) 
`}),e+=`	Paint -> GUID:
`,this._paintToNodeGUIDMap.forEach((t,n)=>{e+="		P="+n.id().toString()+" => "+t+`
`}),e}enqueueVideoOrStartLoad(e){Zn.instance().isLibAvailable()?e.startLoadIfNeeded():this._deferredRuntimes.add(e)}muteAllOtherVideos(e){this._runtimeStorage.forEach(t=>{t.id!=e.id&&t.setMuted(!0)})}playNextVisibleVideo(){let e=(d,c)=>{let p=d.canvasSpaceRenderedBounds().x(),u=c.canvasSpaceRenderedBounds().x();if(p!==u)return p-u;{let _=d.canvasSpaceRenderedBounds().y(),h=c.canvasSpaceRenderedBounds().y();return _-h}},t=[],n=new Set;if(this._visibilityTracker.forEachVisiblePaint(d=>{if(!this._paintToNodeGUIDMap.has(d))return;let c=this._paintToNodeGUIDMap.get(d);if(!c||n.has(c))return;let p=this.getPlaybackSettingsForPaint(d);if(p!=null&&p.autoplay)return;let u=this._appState.scene().findNode(c);u!=null&&(n.add(c),t.push({node:u,paint:d}))}),t.sort((d,c)=>e(d.node,c.node)),t.length===0)return!1;let i=t.findIndex(d=>d.node.id()===this._lastPlayedVideo)+1;if(i>=t.length)return!1;let a=t[i],s=a.paint,l=this.getVideoRuntimeForPaint(s);return l?(this.playVideo(l,a.node.id(),void 0,"playNextVisibleVideo"),!0):!1}preloadAllVideos(){var n,o;let e=(n=this._appState.scene())==null?void 0:n.root();if(!e)return;let t=[];for(let{video:i,paint:a,node:s}of r.getVideosInSubtree(e)){this._hashToRuntimeMap.has(i.hash())||(this.initializeRuntimes(),this.addToHashToRuntimeMap(i));let l=this._hashToRuntimeMap.get(i.hash());l==null||l.startLoadIfNeeded(!0),this.enqueueVideoOrStartLoad(l);let d=this._paintToNodeGUIDMap.get(a);d||(this.associatePaintWithNode(a,new Nt(s)),d=this._paintToNodeGUIDMap.get(a));let c=d&&((o=this.getNodeMetadata(d))==null?void 0:o.nodePath);c&&l&&(this._runtimeStorage.insert(c,i.hash(),l),t.push(l))}return t}static getVideosInSubtree(e){let t=new Map;r._getVideosInSubtree(e,t);let n=[];return t.forEach(o=>{n.push(o)}),n}static _getVideosInSubtree(e,t){e.forEachSinglePaint(n=>{n.video()!=null&&t.set(n.video().hash(),{video:n.video(),paint:n,node:e})});for(let n=0,o=e.childCount();n<o;n=n+1){let i=e.childAt1(n);r._getVideosInSubtree(i,t)}}getVideoLoadingProgress(e){return{loaded:e.reduce((n,o)=>{let i=o.isReadyToPlay()||o.isInErrorState()&&!o.isErrorRetryable();return n+(i?1:0)},0),total:e.length}}playVideo(e,t,n,o){if(n?e.playByVideoAction():e.play(),this._lastPlayedVideo=t,!Y.getFeatureFlags().video_manager_track_play_invisible_video_error)return;let i=!1;this._visibilityTracker.forEachVisiblePaint(a=>{let s=X.fromString(this._paintToNodeGUIDMap.get(a)??"");t===s&&(i=!0)}),!i&&na.loge(sb,"Attempting to play non-visible video",{videoNodeId:t,runtimeId:e.id,mediaAction:n,source:o},{logToConsole:0,reportAsSentryError:!0})}};var jt=class{constructor(){this.isPreloaded=!1;this.prototypeSecurityBoundariesEnforced=!1;this._appObservers=new jr,this._actionObservers=new jr,this._frameObservers=new jr,this._scene=null,this._canvas=null,this._prototypeState=null,this._prototypeStructure=null,this._imageManager=null,this._videoManager=null,this._requestedFrameMetricsTracker=new Rh,this._serialization=null,this._currentFileKey="",this._activePrototypeStartingPointNodeId=null,this._renderDots=!1,this._fontListPromise=Promise.resolve(),this._emitter=null,this._pendingSetActiveCanvas=null,this._emitter=Kt.getEventEmitter(),this._prototypeState=new ba(this),this._prototypeStructure=new Yt(this),this._imageManager=new Kd(this,()=>{this._emitter.trigger("showImageFetchFailureUI")}),this._videoManager=new iu(this),this._serialization=new ot(this._imageManager,this._videoManager),Xn&&N()==null&&zu(new ec(Mi,this))}emitter(){return this._emitter}scene(){return this._scene}prototypeState(){return this._prototypeState}prototypeStructure(){return this._prototypeStructure}imageManager(){return this._imageManager}videoManager(){return this._videoManager}requestedFrameMetricsTracker(){return this._requestedFrameMetricsTracker}serialization(){return this._serialization}currentFileKey(){return this._currentFileKey}setCurrentFileKey(e){this._currentFileKey=e}fontListPromise(){return this._fontListPromise}setFontListPromise(e){this._fontListPromise=e}renderDots(){return this._renderDots}setRenderDots(e){this._renderDots=e}baseScreenId(){return this._prototypeState.getCurrentBaseScreenId()}currentFitMode(){return this._prototypeState.getCurrentFitMode()}currentScalingInfo(){return this._prototypeState.getCurrentScalingInfo()}baseScreenNode(){return this._scene==null?null:this._prototypeState.getCurrentBaseScreenNode()}needsAlphaGPUBackingStore(){return!!new URLSearchParams(window.location.search).get("needsAlpha")}editorType(){return this._editorType}setEditorType(e){this._editorType!=e&&(this._editorType=e)}addAppObserver(e){this._appObservers.add(e)}removeAppObserver(e){this._appObservers.remove(e)}addActionObserver(e){this._actionObservers.add(e)}removeActionObserver(e){this._actionObservers.remove(e)}addFrameObserver(e){this._frameObservers.add(e)}removeFrameObserver(e){this._frameObservers.remove(e)}nodeTransitionTracker(){return this._prototypeStructure.nodeTransitionTracker()}triggerAction1(e){this.triggerAction2(e,null)}triggerAction2(e,t){this._actionObservers.forEach(n=>{n.handleAction(e,t)})}onFrame(){this._frameObservers.forEach(e=>{e.onFrame()})}resetStateForTests(){this._prototypeState.resetState()}setScene(e){var t;if(e!=this._scene){let n=this._scene;this._scene=e,(t=this._scene)==null||t.markLoaded(),this._appObservers.forEach(o=>{o.handleSceneChange(n,e)}),n!=null&&n.destroy(),this._scene==null?this.setActiveCanvas(null):this.setActiveCanvas(this._scene.firstUserCanvasOrNull())}}requestSetActiveCanvas(e){e.hasBeenLoaded()?this.setActiveCanvas(e):(this._pendingSetActiveCanvas=e,this.triggerAction2(11,e))}trySettingRequestedActiveCanvas(){this._pendingSetActiveCanvas!=null&&this._pendingSetActiveCanvas.hasBeenLoaded()&&(this.setActiveCanvas(this._pendingSetActiveCanvas),this._pendingSetActiveCanvas=null)}setActiveCanvas(e){if(this._canvas!=e){let t=this._canvas;this._canvas=e,this._appObservers.forEach(n=>{n.handleActiveCanvasChange(t,this._canvas)})}}getActiveCanvas(){return this._canvas!=null&&this._scene==null?(console.warn("getActiveCanvas called with null scene but non-null canvas"),null):this._canvas}activePrototypeDevice(){var e;return(e=this.getActiveCanvas())==null?void 0:e.prototypeDevice()}storedPrototypeDevice(){var e;return(e=this.getActiveCanvas())==null?void 0:e.storedPrototypeDevice()}activePrototypeStartingPointNodeId(){return this._activePrototypeStartingPointNodeId}setActivePrototypeStartingPointNodeId(e){let t=this._activePrototypeStartingPointNodeId;this._activePrototypeStartingPointNodeId=e,this._appObservers.forEach(n=>{n.handleActivePrototypeStartingPointChange(t,e)})}};function hw(){return AssertLib}function xi(r,e){hw()(r,e)}function ds(r,e,t=""){xi(Math.abs(r-e)<1e-6,`Expected ${r} to approximately equal ${e}. ${t}`)}function bh(r,e,t){ds(e,t,`Expected velocity at timestep ${r} to equal ${e}, got ${t}`)}var cb=ml(lb());var en=class en{constructor(e){this._valueBySnapshotId=null,this._isDirty=!1,this._valueBySnapshotId=e}getValueOrNull(e){return Ge.StringMap_get(this._valueBySnapshotId,e,null)}updateValue(e,t){this._valueBySnapshotId.set(e,t),this._isDirty=!0}toString(){let e=Array.from(this._valueBySnapshotId.keys());e.sort((n,o)=>Lo.string_compare(n,o));let t="";for(let n of e)t+=`
${en._PREFIX}snapshotId: ${n}
`,t+=this._valueBySnapshotId.get(n);return t}isDirty(){return this._isDirty}static _createEmptyDefaultDirtyAtPath(e){if(en._snapshotFileCache.has(e))throw new Error("Snapshot file at path already exists in cache");return en._snapshotFileCache.set(e,new en(new Map)),en._snapshotFileCache.get(e)._isDirty=!0,en._snapshotFileCache.get(e)}static loadOrCreateFromPath(e){let t=Ge.StringMap_get(en._snapshotFileCache,e,null);return t!=null?Promise.resolve(t):ProtoTestHost_readFile(e).then(n=>{let o=Ge.StringMap_get(en._snapshotFileCache,e,null);return o??(n==null?(console.log(`[Snapshot] Create empty default dirty snapshot at path ${e}`),en._createEmptyDefaultDirtyAtPath(e)):(en._snapshotFileCache.set(e,new en(en._snapshotStringToMap(n))),en._snapshotFileCache.get(e)))})}static _snapshotStringToMap(e){let t=new Map,n=e.split(`
`),o=null,i=null;for(let a of n){let s=`${en._PREFIX}snapshotId: `;a.startsWith(s)?(o!=null&&t.set(o,i.join(`
`)),o=a.slice(s.length),i=[]):i!=null&&i.push(a)}return o!=null&&t.set(o,i.join(`
`)),t}static flushSnapshotUpdates(){let e=[];return Ge.StringMap_each(en._snapshotFileCache,(t,n)=>{n.isDirty()&&e.push(en._saveToPath(t,n))}),Promise.all(e)}static _saveToPath(e,t){return console.log(`[Snapshot] Saving to file ${e}`),ProtoTestHost_writeFile(e,t.toString())}};en._PREFIX="#*#* ",en._snapshotFileCache=new Map;var cc=en;var sl=class{constructor(e){this._testFilepath=null,this._testFilepath=e}asyncAssertMatchesSnapshot(e,t){if(Nh==null)throw new Error("asyncAssertMatchesSnapshot called outside of a test");let o=this._testFilepath.split(".ts").join(".snapshot.txt"),i=Nh+" -- "+e,a=ProtoTestHost_env.UPDATE_SNAPSHOTS!==void 0;return gw(o,i).then(s=>{let l=new RegExp("\\d+\\.\\d*","g"),d=t.replaceAll(l,c=>`${Math.round(parseFloat(c)*1e3)/1e3}`);if(s==null||a){fw(o,i,d);return}if(s!==d)throw new Error(`${lu}Snapshot ${i} in file ${o} did not match previous value. Here's a diff that changes the ${ub}stored snapshot${lu} into the ${db}received value${lu}:

${mw(s,d)}`)})}},Na;(i=>{function r(){return i.hasSetExpectedErrorsBeenCalled=!1,Mi.interactionTestHelpers.resetExpectedErrorsAndGetErrorString(Vu.VIEWER_TEST)}i.resetExpectedErrorsAndGetErrorString=r;function e(a){if(i.hasSetExpectedErrorsBeenCalled)throw new Error("Can only call setExpectedErrors once per test");i.hasSetExpectedErrorsBeenCalled=!0,Mi.interactionTestHelpers.setExpectedErrors(a)}i.setExpectedErrors=e;function t(){i.isUnhandledErrorsExpected=!0}i.setUnhandledErrorsExpected=t,i.hasSetExpectedErrorsBeenCalled=!1,i.isUnhandledErrorsExpected=!1})(Na||(Na={}));function me(r,e){Jg(r,()=>new Promise((t,n)=>{e(),setTimeout(()=>{t()},0)}))}function ue(r,e){Jg(r,e)}function ll(r,e){Jg(r,()=>e().then(t=>{}))}function Jg(r,e){su.push(r);let t=su.join(" -- ");ne.List_removeLast(su);let n=()=>{new jt;let o=e();return N().reset(),o};it(r,()=>{Nh=t,$o=[],Na.isUnhandledErrorsExpected=!1;let o=Na.resetExpectedErrorsAndGetErrorString();return o.length>0&&$o.push(new Error("Errors detected from before test started. Maybe from test harness initialization, or from a previous test: "+o)),n().catch(i=>{$o.push(i)}).then(()=>{let i=Na.resetExpectedErrorsAndGetErrorString();if(i.length>0&&$o.push(new Error(i)),Nh=null,Na.isUnhandledErrorsExpected){if($o.length==0)throw new Error("Expected errors, but none were triggered")}else{$o=$o.filter(s=>s.message.indexOf("/api/web_logger/metrics/unhandled_error")==-1);let a=$o.length>1?$o.length.toString()+` unhandled errors: 
`:`Unhandled error: 
`;if($o.length==1)throw $o[0];if($o.length>1){for(let s of $o)a+=s.message,a+=`
`,a+=s.stack;throw new Error(a)}}})})}function At(r,e){su.push(r),describe(r,()=>{e()}),ne.List_removeLast(su)}function mw(r,e){let t=cb.diffLines(r,e),n="";return t.forEach(o=>{let i="",a="";o.added?(i="+ ",a=db):o.removed?(i="- ",a=ub):(i="  ",a=lu),n+=`${a}${i}${o.value}${lu}
`}),n}function fw(r,e,t){cc.loadOrCreateFromPath(r).then(n=>{n.updateValue(e,t)})}function gw(r,e){return cc.loadOrCreateFromPath(r).then(t=>t.getValueOrNull(e))}var $o=[],su=[],Nh=null,db="\x1B[32m",ub="\x1B[31m",lu="\x1B[0m";var cl=class{constructor(e,t,n){var o;this._property=0,this._activeCanvasGUID=null,this._onChange=null,this._property=t,this._activeCanvasGUID=(o=e.getActiveCanvas())==null?void 0:o.id(),this._onChange=n,e.addAppObserver(this)}handleSceneChange(e,t){e!=null&&e.removeObserver(this),t!=null&&t.addObserver(this)}handleActiveCanvasChange(e,t){if(t==null)return;this._activeCanvasGUID=t.id();let n=e==null?void 0:e.get(this._property),o=t.get(this._property);n!=o&&this._onChange(o)}handleActivePrototypeStartingPointChange(e,t){}handleSceneGraphEvent(e){var t;e.property==this._property&&X.equals((t=e.node)==null?void 0:t.id(),this._activeCanvasGUID)&&e.oldVal!=e.newVal&&this._onChange(e.newVal)}};var SA=ml(wc());function $g(r){switch(r){case 2:case 4:return 0;case 1:case 3:case 5:return 1;default:return 2}}var dc=class{createBallisticScrollSimulation(e,t,n,o,i,a){return null}applyOverscrollBehavior(e,t,n,o){return t}constructor(){}};var ps=class{constructor(){this._startTime=0,this._startTime=Me.seconds()}endPos(){return new b(this._xSimulation().endPos(),this._ySimulation().endPos())}pos1(){return this.pos2(this.elapsed())}pos2(e){return new b(this._xSimulation().pos(e),this._ySimulation().pos(e))}dPos(e){return new b(this._xSimulation().dPos(e),this._ySimulation().dPos(e))}elapsed(){return Me.seconds()-this._startTime}isDone1(){return this.isDone2(this.elapsed())}isOverscrolled(){return!1}isDone2(e){return this._xSimulation().isDone(e)&&this._ySimulation().isDone(e)}xSimulation(e){return this._xSimulation().typeAt(e)}ySimulation(e){return this._ySimulation().typeAt(e)}},cu=class cu{static withDampingRatio(e,t,n){return new cu(e,t,n*2*Math.sqrt(e*t))}constructor(e,t,n){this.mass=e,this.stiffness=t,this.damping=n}};cu.DEFAULT_SPRING=cu.withDampingRatio(.5,100,1.1);var uc=cu,pc=class{constructor(e,t){this.velocity=e,this.distance=t}};function eA(){return typeof window<"u"&&typeof ho()=="number"?new pc(1/(.05*ho()),1/ho()):new pc(1/.05,1)}var _c=class{constructor(e,t,n){this._friction=.015;this._initialVelocityPenetration=3.065;this._decelerationRate=Math.log(.78)/Math.log(.9);this._pos=e,this._velocity=t,this._vSign=Math.abs(this._velocity)/this._velocity|0,this._duration=n??this._flingDuration(t),this._distance=Math.abs(t*this._duration/this._initialVelocityPenetration)}duration(){return this._duration}pos(e){if(this._duration==0)return this._pos;let t=sr.Math_clamp(e/this._duration,0,1);return this._pos+this._distance*this._flingDistancePenetration(t)*this._vSign}dPos(e){if(this._duration==0)return this._velocity;let t=sr.Math_clamp(e/this._duration,0,1);return this._distance*this._flingVelocityPenetration(t)*this._vSign/this._duration}isDone(e){return e>=this._duration}endPos(){return this._pos+this._distance}_decelerationForFriction(e){return e*61774.04968}_flingDuration(e){let t=this._friction*this._decelerationForFriction(.84),n=Math.log(.35*Math.abs(e)/t);return Math.exp(n/(this._decelerationRate-1))}_flingDistancePenetration(e){return 1.2*e*e*e-3.27*e*e+this._initialVelocityPenetration*e}_flingVelocityPenetration(e){return 3.6*e*e-6.54*e+this._initialVelocityPenetration}},du=class{constructor(e,t,n,o=eA()){this._drag=e,this._dragLog=Math.log(e),this._p=t,this._v=n,this._tolerance=o}pos(e){return this._p+this._v*Math.pow(this._drag,e)/this._dragLog-this._v/this._dragLog}dPos(e){return this._v*Math.pow(this._drag,e)}endPos(){return this._p-this._v/this._dragLog}timeAtPos(e){if(e==this._p)return 0;let t=this.endPos();return this._v==0||(this._v>0?e<this._p||e>t:e>this._p||e<t)?1/0:Math.log(this._dragLog*(e-this._p)/this._v+1)/this._dragLog}isDone(e){return Math.abs(this.dPos(e))<this._tolerance.velocity}},_s=class{constructor(e,t,n,o,i=eA()){let a=t-n,s=e.damping*e.damping-4*e.mass*e.stiffness;this._r1=(-e.damping-Math.sqrt(s))/(2*e.mass),this._r2=(-e.damping+Math.sqrt(s))/(2*e.mass),this._c2=(-(a*this._r1)+o)/(this._r2-this._r1),this._c1=a-this._c2,this._end=n,this._tolerance=i}endPos(){return this._end}pos(e){return this._end+this._c1*Math.pow(Math.E,this._r1*e)+this._c2*Math.pow(Math.E,this._r2*e)}dPos(e){return this._c1*this._r1*Math.pow(Math.E,this._r1*e)+this._c2*this._r2*Math.pow(Math.E,this._r2*e)}isDone(e){return Math.abs(this.pos(e)-this._end)<=this._tolerance.distance&&Math.abs(this.dPos(e))<=this._tolerance.velocity}},hc=class{pos(e){return this._c}dPos(e){return 0}isDone(e){return!0}endPos(){return this._c}constructor(e){this._c=e}};var uu=class{applyOverscrollBehavior(e,t,n,o){let i=e.subtract(n),s=e.subtract(t).divide(o).makeAbs(),l=this._frictionFactor2(s);return n.add(l.multiply(i))}_frictionFactor1(e){return e==0?1:.52*Math.pow(1-e,2)}_frictionFactor2(e){return new b(this._frictionFactor1(e.x()),this._frictionFactor1(e.y()))}createBallisticScrollSimulation(e,t,n,o,i,a){return new mc(e,t,n,o,i,a)}constructor(){}},mc=class extends ps{constructor(e,t,n,o,i,a){super(),this._xSim=null,this._ySim=null;let s=uc.DEFAULT_SPRING;this._xSim=new Ph(e.x(),t.x(),n,o,s),this._ySim=new Ph(e.y(),t.y(),i,a,s)}_xSimulation(){return this._xSim}_ySimulation(){return this._ySim}isOverscrolled(){return this._xSimulation().typeAt(this.elapsed())==1||this._ySimulation().typeAt(this.elapsed())==1}},Ph=class{constructor(e,t,n,o,i){if(this._frictionSimulationIOS=null,this._springSimulation=null,this._fixedSolution=null,this._startTime=0,this._springTime=0,this._timeOffset=0,e<n)this._springSimulation=new _s(i,e,n,t),this._springTime=-1/0;else if(e>o)this._springSimulation=new _s(i,e,o,t),this._springTime=-1/0;else if(t==0)this._fixedSolution=new hc(e);else{this._frictionSimulationIOS=new du(Aw,e,t);let a=this._frictionSimulationIOS.endPos();t>0&&a>o?(this._springTime=this._frictionSimulationIOS.timeAtPos(o),this._springSimulation=new _s(i,o,o,Math.min(this._frictionSimulationIOS.dPos(this._springTime),pb))):t<0&&a<n?(this._springTime=this._frictionSimulationIOS.timeAtPos(n),this._springSimulation=new _s(i,n,n,Math.min(this._frictionSimulationIOS.dPos(this._springTime),pb))):this._springTime=1/0}}_simulation(e){return this._fixedSolution!=null?this._fixedSolution:e>this._springTime?(this._timeOffset=isFinite(this._springTime)?this._springTime:0,this._springSimulation):(this._timeOffset=0,this._frictionSimulationIOS)}typeAt(e){return this._fixedSolution!=null?2:e<=this._springTime?0:1}endPos(){return this._fixedSolution!=null?this._fixedSolution.pos(0):isFinite(this._springTime)||this._springTime<0?this._springSimulation.endPos():this._frictionSimulationIOS.endPos()}pos(e){return this._simulation(e).pos(e-this._timeOffset)}dPos(e){return this._simulation(e).dPos(e-this._timeOffset)}isDone(e){return this._simulation(e).isDone(e-this._timeOffset)}},pb=5e3,Aw=.135;var pu=class{createBallisticScrollSimulation(e,t,n,o,i,a){return new rA(e,t,n,o,i,a)}applyOverscrollBehavior(e,t,n,o){return t}constructor(){}},rA=class extends ps{constructor(e,t,n,o,i,a){if(super(),this._xSim=null,this._ySim=null,Math.abs(t.x())>Math.abs(t.y())){this._xSim=new fc(e.x(),t.x(),n,o);let s=Math.abs(t.y())>=_b?t.y():0;this._ySim=new fc(e.y(),s,i,a,this._xSimulation().duration())}else{this._ySim=new fc(e.y(),t.y(),i,a);let s=Math.abs(t.x())>=_b?t.x():0;this._xSim=new fc(e.x(),s,n,o,this._ySimulation().duration())}}_xSimulation(){return this._xSim}_ySimulation(){return this._ySim}},fc=class{constructor(e,t,n,o,i){this._duration=-1/0,this._min=n,this._max=o,t==0?this._simulation=new hc(e):i?this._simulation=new _c(e,t):(this._simulation=new _c(e,t,i),this._duration=this._simulation.duration()),this._startTime=Me.seconds()}duration(){return this._duration}pos(e){let t=this._simulation.pos(e);return t<=this._min?this._min:t>=this._max?this._max:t}dPos(e){return this._simulation.dPos(e)}endPos(){return this._simulation.endPos()}isDone(e){if(this._simulation.isDone(e))return!0;let t=this.pos(e);return t>=this._max||t<=this._min}elapsed(){return Me.seconds()-this._startTime}typeAt(e){return 0}},_b=50;var _u=class extends ps{constructor(e,t,n,o){super(),this._xSim=null,this._ySim=null,this._xSim=new Fh(e.x(),t.x(),n,o),this._ySim=new Fh(e.y(),t.y(),n,o)}_xSimulation(){return this._xSim}_ySimulation(){return this._ySim}},Fh=class{constructor(e,t,n,o){this._begin=0,this._end=0,this._duration=0,this._curve=null,this._begin=e,this._end=t,this._duration=n,this._curve=o}pos(e){let t=sr.Math_clamp(e/this._duration,0,1);return t==0?this._begin:t==1?this._end:this._begin+(this._end-this._begin)*this._curve.get(t)}dPos(e){return(this.pos(e+.001)-this.pos(e-.001))/(2*.001)}endPos(){return this._end}isDone(e){return e>this._duration}typeAt(e){return 3}};var mb=new Map([["http:",80],["https:",443]]);function Sw(r){return r==="http:"||r==="https:"}function Tw(r){if(Sw(r.protocol)){let e=r.port?parseInt(r.port):mb.get(r.protocol);return{scheme:r.protocol,hostname:r.hostname,port:e}}else return"INVALID_ORIGIN"}function Ew(r,e){return e.scheme==="ALL"||e.scheme.scheme===r}function Iw(r,e){if(e.hostname==="ALL"||e.hostname.hostname===r)return!0;try{let t=decodeURI(e.hostname.hostname);if(t.startsWith("*."))return new RegExp(`^${t.replace(/\./g,"\\.").replace("*",".*")}$`).test(r)}catch{return!1}return!1}function yw(r,e){return e.port==="ALL"||e.port.port===r}function Rw(r,e){return Ew(r.scheme,e)&&Iw(r.hostname,e)&&yw(r.port,e)?"ALLOWED":"DENIED"}var hb="embedkit-wildcard-placeholder.";function vw(r){return r.map(e=>{let t=e.includes("*."),n=t?e.replace("*.",hb):e,o=new URL(n),i=t?o.hostname.replace(hb,"%2A."):o.hostname;return{scheme:{scheme:o.protocol},hostname:{hostname:i},port:{port:o.port?parseInt(o.port):mb.get(o.protocol)}}})}function Ow(r,e){let t=vw(e);for(let n of t)if(Rw(r,n)==="ALLOWED")return"ALLOWED";return"DENIED"}function nA(r,e){let t;try{t=new URL(r)}catch{return"DENIED"}let n=Tw(t);return n==="INVALID_ORIGIN"?"DENIED":Ow(n,e)}var oA={clientId:null,allowedEmbedOrigins:null,embedHost:null};function fb(){try{if(window.top===window)return null;if(window.location.origin===window.parent.location.origin)return window.location.origin}catch{return null}}var hs;(S=>{function r(m){S._mockEmbedListener=m}S.setMockListener=r;function e(m,f,T){f.addObserver(new p(m,f)),S._prototypeObserver=new u(m),oA=T,Y.getFeatureFlags().embedkit_v2_embed_api&&!Y.getFeatureFlags().embedkit_v2_enforce_embed_origins&&T.clientId==null&&console.warn("[Figma Embed Kit] To continue using the Embed API for sending and receiving messages from your Figma embeds, you must register a Figma OAuth app, specify in the app's configuration the domains where you're hosting embeds, and provide the app's client ID in your embed URL using the client-id parameter. You need to do this by December 5th, 2024."),m.prototypeState().addObserver(S._prototypeObserver),m.prototypeState().addHsmObserver(S._prototypeObserver),Kt.getEventEmitter().on("sceneDidCompleteInitialLoad",v=>{m.scene().addObserver(S._prototypeObserver),o(0,{})}),Kt.getEventEmitter().on("requestClose",v=>{o(4,{})});let y=window;if(y===null)return;let E=Y.getFeatureFlags().embedkit_v2_enforce_embed_origins;y.addEventListener("message",v=>{let A=v.data;if(!A)return;let I=A.type;if(!S.VALID_MESSAGE_TYPES.has(I))return;let C=A.data;if(!fb()&&Y.getFeatureFlags().embedkit_v2_embed_api){let{clientId:R,allowedEmbedOrigins:D}=oA;if(R==null){if(E){console.error("[Figma Embed Kit] You must register an app and provide a client-id to enable the Embed API.");return}console.warn("[Figma Embed Kit] Starting on December 5th, 2024, you must register an app and provide a client-id to enable the Embed API. Please do so to avoid any disruption to your users.")}else if(D==null){if(E){console.error(`[Figma Embed Kit] The app (${R}) must have allowed embed origins set to enable the Embed API.`);return}console.warn(`[Figma Embed Kit] Starting on December 5th, 2024, to use the Embed API, you must set allowed embed origins for your app (${R}).`)}if(D&&nA(v.origin,D)==="DENIED"){if(E){console.error(`[Figma Embed Kit] The origin ${v.origin} does not match any allowed embed origins for the app (${R}). It must be be one of the following: ${D.join(", ")}`);return}console.warn(`[Figma Embed Kit] The origin ${v.origin} does not match any allowed embed origins for the app (${R}). It must be be one of the following: ${D.join(", ")}. Starting on December 5th, 2024, this will be enforced.`)}}n(m,f,I,C)})}S.init=e,S.VALID_MESSAGE_TYPES=new Set(["NAVIGATE_TO_FRAME_AND_CLOSE_OVERLAYS","NAVIGATE_BACKWARD","NAVIGATE_FORWARD","CHANGE_COMPONENT_STATE","RESTART"]);function n(m,f,T,y){var E,v,A;if(S.VALID_MESSAGE_TYPES.has(T))switch(T){case"NAVIGATE_TO_FRAME_AND_CLOSE_OVERLAYS":{let I=X.fromString(y.nodeId),C=X.fromString(y.startingPointNodeId);if(Y.isInlinePreview()&&(m.prototypeState().mostRecentBaseScreenIdChangeInitiator="EmbedAPI._receiveFromHost",m.prototypeState().resetPrototype(),f.handleRestartPrototype(),m.videoManager().handleRestartPrototype()),!(Y.isInlinePreview()&&I==null))if(X.isValid(I)){let g=(E=m.scene())==null?void 0:E.findNode(I);if(g!=null){C&&(m.prototypeState().mostRecentFixInvalidStateInitiator="EmbedAPI._receiveFromHost",m.setActivePrototypeStartingPointNodeId(C));let R=C&&g.topLevelAncestor()==null?C:I;m.prototypeState().navigateToFrameAndCloseOverlays(R,null,2,0,0,null,null)}else S._prototypeObserver.setPendingNodeId(I)}else console.error(`Expected node id; got '${y.nodeId}' instead`);break}case"NAVIGATE_BACKWARD":{f.navigateBackward(18);break}case"NAVIGATE_FORWARD":{f.navigateForward(19);break}case"CHANGE_COMPONENT_STATE":{let I=(v=m.scene())==null?void 0:v.findNodeFromDeveloperFriendlyId(y.nodeId),C=(A=m.scene())==null?void 0:A.findNodeFromDeveloperFriendlyId(y.newVariantId);if(I==null){console.error(`Could not find node from specified node id '${y.nodeId}'`);return}if(C==null){console.error(`Could not find variant for CHANGE_COMPONENT_STATE from id '${y.newVariantId}'`);return}m.prototypeState().swapInstanceToState2(I.stablePath(),C.id(),null,0,null,1,null);break}case"RESTART":{m.prototypeState().restartPrototype(1);break}default:break}}S._receiveFromHost=n;function o(m,f){let T={type:c[m],data:f};if(S._mockEmbedListener!=null){(0,S._mockEmbedListener)(T);return}let y=window;if(y===null||y.parent===null||y.parent.postMessage===void 0||y.top===y)return;if(!fb()&&Y.getFeatureFlags().embedkit_v2_embed_api){let{clientId:v,allowedEmbedOrigins:A}=oA,I=Y.getFeatureFlags().embedkit_v2_enforce_embed_origins;if(v==null){if(I)return}else if(v!=null&&A==null||A.length===0){if(I){console.error(`[Figma Embed Kit] The app (${v}) must have allowed embed origins set to enable the Embed API.`);return}console.warn(`[Figma Embed Kit] Starting on December 5th, 2024, to use the Embed API, you must set allowed embed origins for your app (${v}). Please do so to avoid any disruption to your users.`)}}y.parent.postMessage(T,"*")}function i(m,f){for(let T=m.childCount()-1;T>=0;T=T-1)i(m.childAt2(T,!0),f);f(m)}S._forEachNodeInHitTestOrder=i;function a(m,f){let T=null,y=null;return i(m,E=>{if(T!=null)return;let v=E.canvasSpaceScrolledInteractiveBounds(0);if(E.isVisibleInCanvas()&&v.contains2(f)){T=E;let A=E.canvasSpaceScrolledInteractiveBounds(1);y=f.subtract(A.topLeft())}}),T==null?null:new d(T,y)}S.findClickInfoForUnhandledMouseRelease=a;function s(m,f,T){if(f.node==null){Oe("Hotspot node is null");return}let y=m.baseScreenNode();if(y==null)return;let E=m.prototypeState().getTopmostOverlayNode(),v=E??y,A=T;E!=null&&(A=m.prototypeState().getTopmostOverlay().baseTlfSpaceToOverlaySpace1(y,T));let I=A.subtract(f.node.canvasSpaceScrolledInteractiveBounds(1).topLeft()),C={};C.handled=!0,C.presentedNodeId=v.developerFriendlyId(),C.targetNodeId=f.node.developerFriendlyId(),C.targetNodeMousePosition=I.toJSON();let g=f.node.findContainingScrollingFrameOrSelf();if(g!=null){let R=g.canvasSpaceScrolledInteractiveBounds(1),D=A.subtract(R.topLeft());C.nearestScrollingFrameId=g.developerFriendlyId(),C.nearestScrollingFrameMousePosition=D.toJSON(),C.nearestScrollingFrameOffset=g.scrollOffset().toJSON()}else C.nearestScrollingFrameId=null,C.nearestScrollingFrameMousePosition=null,C.nearestScrollingFrameOffset=null;o(1,C)}S.willTriggerClickLikeHotspot=s;function l(m,f){let T=m.baseScreenNode();if(T==null)return;let y=m.prototypeState().getTopmostOverlayNode(),E=f;y!=null&&(E=m.prototypeState().getTopmostOverlay().baseTlfSpaceToOverlaySpace1(T,f));let v=y??T,A=a(v,E),I={};I.handled=!1,I.presentedNodeId=v.developerFriendlyId(),I.targetNodeId=A!=null?A.node.developerFriendlyId():null,I.targetNodeMousePosition=A!=null?A.nodeSpacePoint.toJSON():null;let C=A!=null?A.node.findContainingScrollingFrameOrSelf():null;if(C!=null){let g=C.canvasSpaceScrolledInteractiveBounds(1),R=E.subtract(g.topLeft());I.nearestScrollingFrameId=C.developerFriendlyId(),I.nearestScrollingFrameMousePosition=R.toJSON(),I.nearestScrollingFrameOffset=C.scrollOffset().toJSON()}else I.nearestScrollingFrameId=null,I.nearestScrollingFrameMousePosition=null,I.nearestScrollingFrameOffset=null;o(1,I)}S.notifyUnhandledMouseRelease=l;class d{constructor(f,T){this.node=f,this.nodeSpacePoint=T}}S.ClickedLayer=d;let c;(v=>(v[v.INITIAL_LOAD=0]="INITIAL_LOAD",v[v.MOUSE_PRESS_OR_RELEASE=1]="MOUSE_PRESS_OR_RELEASE",v[v.PRESENTED_NODE_CHANGED=2]="PRESENTED_NODE_CHANGED",v[v.NEW_STATE=3]="NEW_STATE",v[v.REQUEST_CLOSE=4]="REQUEST_CLOSE"))(c=S.MessageType||(S.MessageType={}));class p{willTriggerHotspot(f,T,y,E){let v=y==4||y==8||y==9||y==3;if(E!=null&&v){let A=this._canvasView.viewport().viewSpaceToCanvasSpace1().transformPoint(E.clone());s(this._appState,f,A)}}didScrollNode(f){}constructor(f,T){this._appState=f,this._canvasView=T}}S.EmbedCanvasViewObserver=p;class u{constructor(f){this.appState=null,this._pendingNodeId=null,this.appState=f}setPendingNodeId(f){this._pendingNodeId=f}handleSceneGraphEvent(f){this._pendingNodeId!=null&&this.appState.prototypeStructure().validDestinationForPrototypeFromId(this._pendingNodeId)&&(Y.isInlinePreview()?(this.appState.prototypeState().mostRecentFixInvalidStateInitiator="EmbedPrototypeObserver.handleSceneGraphEvent",this.appState.setActivePrototypeStartingPointNodeId(this._pendingNodeId),this.appState.prototypeState().navigateToFrameAndCloseOverlays(this._pendingNodeId,null,2,0,0,null,null)):this.appState.prototypeState().navigateToFrameAndCloseOverlays(this._pendingNodeId),this._pendingNodeId=null)}handlePresentedNodeChanged(f){if(f==null)return;let T=this.appState.baseScreenNode();if(!Y.isInlinePreview()&&T==null)return;let y=this.appState.prototypeState().getTopmostOverlayNode(),E=y??T,v={};v.presentedNodeId=E==null?void 0:E.developerFriendlyId(),v.isStoredInHistory=!$e.isTransientAction(f.cause);let A={};this.appState.prototypeState().getOnscreenStates().forEach(I=>{let C=I.a,g=I.b,R=this.appState.scene().findNodeByStablePath(C);R!=null&&(A[R.developerFriendlyId()]=g)}),v.stateMappings=A,o(2,v)}handleInteractiveComponentStateChange(f,T){if(T==null)return;let y=this.appState.scene().findNodeByStablePath(f);if(y==null)return;let E={};E.nodeId=y.developerFriendlyId(),E.currentVariantId=T.oldStateId(),E.newVariantId=T.newStateId(),E.isStoredInHistory=!$e.isTransientAction(T.cause),E.isTimedChange=T.cause==1,o(3,E)}handleStateChangeAborted(f){this.handlePresentedNodeChanged(f)}handleStateChangeCommitted(f,T){}handleStateChangeInitiated(f){this.handlePresentedNodeChanged(f)}handleStateChangeRequested(f){}handleFitModeChange(f,T){}handleRestartPrototype(){}handleHsmAborted(f,T){this.handleInteractiveComponentStateChange(f,T)}handleHsmCommitted(f,T,y){}handleHsmInitiated(f,T){this.handleInteractiveComponentStateChange(f,T)}handleHsmRequested(f,T){}}S.EmbedPrototypeObserver=u,S._mockEmbedListener=null,S._prototypeObserver=null})(hs||(hs={}));var Dh=class{onClick(){this._timeOfLastClick=Me.seconds()}getOpacity(){let e=Me.seconds()-this._timeOfLastClick;return e<this._animationDuration?1-this._easingFunction.get(e):0}constructor(){this._animationDuration=.7,this._easingFunction=Vn.makeEasingFunction([0,0,.58,1],.7),this._timeOfLastClick=0}},wh=class{constructor(e,t){this._context=e,this._materialStrings=Pr.instance(),this._hotspotMaterial=this._context.createMaterial("hotspot",Le.getPositionF4(),this._materialStrings.GLSLX_SOURCE_RENDER_HOTSPOT_VERTEX,this._materialStrings.GLSLX_SOURCE_RENDER_HOTSPOT_FRAGMENT);let n=new Uint8Array(new Float32Array([0,0,0,1,0,1,0,0,1,0,1,1,1,1,1,0]).buffer);this._hotspotQuad=t.allocateSmallManagedArea(Le.getPositionF4(),n)}draw(e,t,n,o,i){if(o<=0)return;let a=e;for(let s of n){let l=J.new2();l.copyFrom(a);let d=s.canvasSpaceBounds;l.translate2(d.x(),d.y()),l.scale4(d.width(),d.height());let c=G.new2();s.canvasSpaceClipBounds.transformInto1(c,a);let p=new b(2/d.width(),2/d.height());p.divideUpdate(t*i),Be.Material_setUniformMat32(this._hotspotMaterial,this._materialStrings.GLSLX_NAME_U_VERTEX_TRANSFORM,l),Be.Material_setUniformVec22(this._hotspotMaterial,this._materialStrings.GLSLX_NAME_U_STROKE_PROPORTION,p),this._hotspotMaterial.setUniformVec41(this._materialStrings.GLSLX_NAME_U_UV_HOTSPOT_CLIPPING_RECT,c.x(),c.y(),c.width(),c.height()),this._hotspotMaterial.setUniformFloat(this._materialStrings.GLSLX_NAME_U_HOTSPOT_OPACITY,o),this._context.draw(1,this._hotspotMaterial,this._hotspotQuad,It.UNPREMULTIPLIED,lr.NONE,null)}}},hu=class{constructor(e,t){this.canvasSpaceBounds=e,this.canvasSpaceClipBounds=t}},mu=class{constructor(){this.backgroundColor=0,this.hotspots=null,this.hotspotOpacity=0,this.particles=null,this.mouse=null,this.renderDots=!1}};var Lh=class{constructor(e,t){this._didFinishZooming=null,this._drawIdleCount=0,this._userIdleCount=0,this._isFirstFrame=!1,this._justInteracted=!1,this._zoomInProgress=!1,this._previousZoomScale=1,this._previousRenderStatus=2,this._emitter=null,this._didFinishZooming=e,this._emitter=t}handleSceneChange(){this._isFirstFrame=!0}updateZoomScaleNow(e){this._previousZoomScale=e,this._didFinishZooming(this._previousZoomScale)}handleInteraction(){this._justInteracted=!0}justInteracted(){return this._justInteracted}advanceFrame(e){e.isInvalid()||this._justInteracted?(this._userIdleCount=0,this._drawIdleCount=0):this._userIdleCount=this._userIdleCount+1,this._previousRenderStatus!=2?this._drawIdleCount=0:this._drawIdleCount=this._drawIdleCount+1,this._isFirstFrame&&(this._userIdleCount=0,this._isFirstFrame=!1,this.updateZoomScaleNow(e.zoomScale()));let t=this._zoomInProgress;this._zoomInProgress=this._previousZoomScale!=e.zoomScale(),this._zoomInProgress&&!t&&this._emitter.trigger("zoomStart");let n=this._userIdleCount>=2;this._zoomInProgress&&n&&this.updateZoomScaleNow(e.zoomScale()),!this._zoomInProgress&&t&&this._emitter.trigger("zoomStop"),this._justInteracted=!1}shouldRenderOptionalTiles(){return Y.shouldApplyMobileOptimizations()?this._userIdleCount>6&&this._drawIdleCount<120:this._userIdleCount>6}zoomInProgress(){return this._zoomInProgress}previousZoomScale(){return this._previousZoomScale}setPreviousRenderStatus(e){this._previousRenderStatus=e}};var aA=class{delayedHotspotId(){return this._delayedHotspotId}interaction(){return this._interaction}action(){return this._action}counter(){return this._counter}reset(){this._delayedHotspotId=null,this._interaction="ON_CLICK",this._action=0,this._counter=this._counter+1}set(e,t,n){this._delayedHotspotId=e,this._interaction=t,this._action=n,this._counter=this._counter+1}constructor(){this._delayedHotspotId=null,this._interaction="ON_CLICK",this._action=0,this._counter=0}},xh=class{resetEntry(e,t){this.resetAllEntriesMatchingPredicate((n,o)=>X.equals(n,e)&&o==t)}resetAllEntries(){this._maintainedDataEntries.length=0}resetAllEntriesWithInteractionType(e){this.resetAllEntriesMatchingPredicate((t,n)=>n==e)}resetAllEntriesMatchingPredicate(e){this._maintainedDataEntries=this._maintainedDataEntries.filter(t=>!e(t.delayedHotspotId(),t.interaction()))}set(e,t,n){let o=this.getByHotspotAndInteractionType(e,t);if(o==null){let i=new aA;i.set(e,t,n),this._maintainedDataEntries.push(i),o=i}else o.set(e,t,n);return o.counter()}getByHotspotAndInteractionType(e,t){for(let n of this._maintainedDataEntries)if(X.equals(n.delayedHotspotId(),e)&&n.interaction()==t)return n;return null}constructor(){this._maintainedDataEntries=[]}};var Bh=class{constructor(e){this._appState=null,this._currentlyEnteredNodesGUIDsOrderedInnerToOuter=[],this.currentlyEnteredGUIDsSet=new Set,this._previouslyEnteredNodesGUIDsOrderedInnerToOuter=[],this.previouslyEnteredGUIDsSet=new Set,this._appState=e}reset(){this._currentlyEnteredNodesGUIDsOrderedInnerToOuter.length=0,this.currentlyEnteredGUIDsSet.clear(),this._previouslyEnteredNodesGUIDsOrderedInnerToOuter.length=0,this.previouslyEnteredGUIDsSet.clear()}updateEnteredNodes(e,t){this._previouslyEnteredNodesGUIDsOrderedInnerToOuter=this._currentlyEnteredNodesGUIDsOrderedInnerToOuter,this._currentlyEnteredNodesGUIDsOrderedInnerToOuter=this._getNodesEnteredByCanvasSpacePoint(e,t),this.currentlyEnteredGUIDsSet=new Set(this._currentlyEnteredNodesGUIDsOrderedInnerToOuter),this.previouslyEnteredGUIDsSet=new Set(this._previouslyEnteredNodesGUIDsOrderedInnerToOuter)}getNewlyEnteredMouseEnterHotspotsInOrderOfEntering(e){let t=this._currentlyEnteredNodesGUIDsOrderedInnerToOuter.filter(i=>!this.previouslyEnteredGUIDsSet.has(i));t.reverse();let n=new Map;for(let i=0,a=t.length;i<a;i=i+1)n.set(t[i],i);let o=e.filter(i=>n.has(i.node.id()));return o.sort((i,a)=>gt.int_compare(n.get(i.node.id()),n.get(a.node.id()))),o}getNewlyLeftMouseLeaveHotspotsInOrderOfLeaving(e){let t=this._previouslyEnteredNodesGUIDsOrderedInnerToOuter.filter(i=>!this.currentlyEnteredGUIDsSet.has(i)),n=new Map;for(let i=0,a=t.length;i<a;i=i+1)n.set(t[i],i);let o=e.filter(i=>n.has(i.node.id()));return o.sort((i,a)=>gt.int_compare(n.get(i.node.id()),n.get(a.node.id()))),o}markNodesAsNotEnteredWithoutTriggeringMouseLeave(e){let t=new Set(e);this._currentlyEnteredNodesGUIDsOrderedInnerToOuter=this._currentlyEnteredNodesGUIDsOrderedInnerToOuter.filter(n=>!t.has(n))}resetNoLongerMaintainedMouseEnterOrLeaveInteractions(e){e.resetAllEntriesMatchingPredicate((t,n)=>{let o=n=="MOUSE_ENTER"&&!this.currentlyEnteredGUIDsSet.has(t),i=n=="MOUSE_LEAVE"&&this.currentlyEnteredGUIDsSet.has(t);return o||i})}_getNodesEnteredByCanvasSpacePoint(e,t){if(this._appState.baseScreenNode()==null)return[];let o=[],[i,a]=this._appState.prototypeState().getTopmostScreenAndPoint(e),s=Yt.getNodeInteractionPairs("MOUSE_ENTER",t),l=Yt.getNodeInteractionPairs("MOUSE_LEAVE",t),d=this._appState.prototypeStructure().findHotspotsWithInteractionFilter(i,0,p=>{let u=p.event().interactionType();return u=="MOUSE_LEAVE"||u=="MOUSE_ENTER"},[...s??[],...l??[]]),c=null;for(let p of d)p.canvasSpaceScrolledInteractiveBounds(0).contains2(a)&&(c==null||p.node.isAboveInLayerOrder(c.node))&&(c=p);if(c!=null&&c.node){let p=c.node;for(;p!=i;)o.push(p.id()),p=p.parent();o.push(i.id())}return o}};var Cw=["APPLE_IPHONE_14_PRO","APPLE_IPHONE_14_PLUS","APPLE_IPHONE_15","APPLE_WATCH_45MM","APPLE_WATCH_SERIES_10_42MM","APPLE_WATCH_SERIES_10_46MM","APPLE_IPHONE_16"],gb=r=>Cw.some(e=>r.startsWith(e));var fu=class{constructor(e,t,n,o){this._delayFrames=0,this._onChange=null,this._equals=null,this._nextUpdateAfterFrameCount=-1,this._value=null,this._queuedValue=null,this._delayFrames=t,this._equals=n,this._onChange=o,e(this)}onFrame(){this._nextUpdateAfterFrameCount>0&&(this._nextUpdateAfterFrameCount=this._nextUpdateAfterFrameCount-1,this._nextUpdateAfterFrameCount<=0&&(this._value=this._queuedValue,this._queuedValue=null,this._nextUpdateAfterFrameCount=-1,this._onChange()))}_updateQueuedValue(e){this._queuedValue=new ce(e),this._nextUpdateAfterFrameCount=this._delayFrames}hasQueuedValue(){return this._queuedValue!=null}queueValue(e){if(this._value==null){this._value=new ce(e),this._onChange();return}if(this._queuedValue!=null){if(this._equals(this._queuedValue.value,e))return;this._updateQueuedValue(e);return}else this._equals(this._value.value,e)||this._updateQueuedValue(e)}getValue(){return this._value.value}clear(){this._value=null,this._queuedValue=null,this._nextUpdateAfterFrameCount=-1}unregister(e){e(this)}};function gu(r,e){let t=new WeakMap,n=null;return o=>{let i=e(o);if(i===null)return n==null&&(n=new ce(r(o))),n.value;if(t.has(i))return t.get(i);let a=r(o);return t.set(i,a),a}}function lA(r){return gu(r,e=>e)}function bw(r,e,t){let n=gu(o=>gu(i=>r(o,i),t),e);return(o,i)=>n(o)(i)}function Ab(r,e,t,n){let o=bw((i,a)=>gu(s=>r(i,a,s),n),e,t);return(i,a,s)=>o(i,a)(s)}function Sb(r,e,t,n,o){let i=Ab((a,s,l)=>gu(d=>r(a,s,l,d),o),e,t,n);return(a,s,l,d)=>i(a,s,l)(d)}var Mh=class{constructor(e,t){this._deviceImageManager=new Fn,this._hasPendingFrame=!1,this._context=e,this._bufferPool=t,this._materialStrings=Pr.instance();let n=new Uint8Array(new Float32Array([0,0,0,1,0,1,0,0,1,0,1,1,1,1,1,0]).buffer);this._deviceFrameQuad=this._bufferPool.allocateSmallManagedArea(Le.getPositionF4(),n),this._deviceFrameMaterial=this._context.createMaterial("deviceFrame",Le.getPositionF4(),this._materialStrings.GLSLX_SOURCE_RENDER_DEVICE_FRAME_VERTEX,this._materialStrings.GLSLX_SOURCE_RENDER_DEVICE_FRAME_FRAGMENT)}clearOnContextReset(){this._hasPendingFrame=!1,this._deviceImageManager.clearOnContextReset()}flush(){this._hasPendingFrame&&(this._context.draw(1,this._deviceFrameMaterial,this._deviceFrameQuad,It.PREMULTIPLIED,lr.NONE,null),this._hasPendingFrame=!1)}isWaitingForDeviceFrameToLoad(e){let t=Fn.infoForDevice(e);if(t==null)return!1;let n=this._deviceImageManager.getImage(t,this._context).imageResource;return!n.isDecoded()&&!n.loadDidFail()}canRenderDeviceFrame(e){let t=Fn.infoForDevice(e);return t==null?!1:this._deviceImageManager.getImage(t,this._context).imageResource.isDecoded()}pixelAtPosition(e,t,n){if(t==null)return O.TRANSPARENT;let o=Fn.infoForDevice(n);if(o==null)return O.TRANSPARENT;let i=this._deviceImageManager.getImage(o,this._context).imageResource;if(!i.isDecoded()||i.width()<=0||i.height()<=0)return O.TRANSPARENT;let a=i.decodedData(),s=n.canvasSpaceTopLeftOffset(o),l=t.topLeft().subtract(s),d=n.canvasSpaceImageSize(o),c=e.subtract(l).divide(d);switch(n.rotation){case"NONE":break;case"CCW_90":{c=new b(1-c.y(),c.x());break}default:break}let p=c.x()*o.nonRotatedImageSize.x()|0,u=c.y()*o.nonRotatedImageSize.y()|0;return a.pixelAtIndex(p,u)}drawPrototypeDeviceIfAny(e,t,n,o){if(n==null)return;let i=Fn.infoForDevice(t);if(i==null)return;let a=this._deviceImageManager.getImage(i,this._context).imageResource;if(!a.isDecoded()&&!a.loadDidFail()){e.invalidate();return}if(a.width()<=0||a.height()<=0)return;let s=a.texture().width()/i.scaleFactor,l=a.texture().height()/i.scaleFactor,d=i.nonRotatedOffset,c=n.topLeft().subtract(d),p=G.new2();p.setTo1(c.x(),c.y(),s,l);let u=J.new2();u.copyFrom(o),u.translate2(p.x(),p.y()),t.rotation=="CCW_90"&&(u.translate1(i.nonRotatedOffset),u.rotate(-Math.PI/2),u.translate1(i.nonRotatedOffset.negative()),u.translate2(-i.nonRotatedFramePresetSize.x(),0)),u.scale4(p.width(),p.height()),Be.Material_setUniformMat32(this._deviceFrameMaterial,this._materialStrings.GLSLX_NAME_U_VERTEX_TRANSFORM,u),this._deviceFrameMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_TEXTURE0,a.texture(),0),this._hasPendingFrame=!0}async preloadDeviceImage(e){let t=Fn.infoForDevice(e);if(t!=null)return this._deviceImageManager.getImage(t,this._context).loadPromise}};var Au=class{constructor(e){this._dirtyNewBoundsBuilder=new ht,this._dirtyOldBoundsBuilder=new ht,this._cachedCanvasSpaceBounds=new Map,this._dirtyNodes=new Map,this._canvasSpaceDirtyNewBounds=G.new2(),this._canvasSpaceDirtyOldBounds=G.new2(),this._onBoundsInvalidate=e}initCanvas(e){this._dirtyNodes=new Map,this._cachedCanvasSpaceBounds=new Map,e!=null&&this._initCachedBounds(e)}handleSceneGraphEvent(e){switch(e.property){case 65:case 33:case 73:case 35:case 56:case 17:case 36:case 72:case 54:case 74:case 18:case 55:case 34:case 37:case 98:break;case 26:case 27:case 41:case 69:{this.dirtyNode(e.node);break}default:{this.dirtyNode(e.node);break}}}handleImageLoaded(e){this.dirtyNode(e)}dirtyNode(e){this._dirtyNodes.set(e.id(),e.id())}invalidateDirtyTiles(e,t){if(e==null||this._dirtyNodes.size==0)return;let n=[],o=new Map;this._dirtyOldBoundsBuilder.reset(),this._dirtyNewBoundsBuilder.reset(),Ge.StringMap_each(this._dirtyNodes,(i,a)=>{let s=e.scene().findNode(a);if(s!=null&&s.type()=="CANVAS"){this._onBoundsInvalidate(null);return}let l=s==null?void 0:s.topLevelAncestor();if(l!=null){if(!l.hasBeenLoaded())return;o.set(l.id(),!0)}let d=Ge.StringMap_get(this._cachedCanvasSpaceBounds,i,null),c=s==null?void 0:s.canvasSpaceRenderedBounds();if(d!=null&&this._dirtyOldBoundsBuilder.include3(d),c!=null?(this._dirtyNewBoundsBuilder.include3(c),this._cachedCanvasSpaceBounds.set(i,c)):this._cachedCanvasSpaceBounds.delete(i),t.overlayRenderData()!=null){let p=t.overlayRenderData();if(p!=null)for(let u of p.keys()){let _=p.get(u),h=d!=null&&d.overlaps(_.bounds),S=c!=null&&c.overlaps(_.bounds);(h||S)&&o.set(_.overlayId,!0)}}}),Ae.perfTimerScope("invalidateNestedBackgroundBlurRenderTrees",Ae.ProfileLevel.LEGACY,()=>{e.invalidateNestedBackgroundBlurRenderTrees(o,n)});for(let i=0,a=n.length;i<a;i=i+1){let s=n[i];this._dirtyOldBoundsBuilder.include3(s)}this._dirtyOldBoundsBuilder.isValid()&&(this._dirtyOldBoundsBuilder.buildTo(this._canvasSpaceDirtyOldBounds),this._onBoundsInvalidate(this._canvasSpaceDirtyOldBounds)),this._dirtyNewBoundsBuilder.isValid()&&(this._dirtyNewBoundsBuilder.buildTo(this._canvasSpaceDirtyNewBounds),this._onBoundsInvalidate(this._canvasSpaceDirtyNewBounds)),this._dirtyNodes=new Map}_initCachedBounds(e){for(let t=0,n=e.childCount();t<n;t=t+1){let o=e.childAt1(t);this._cachedCanvasSpaceBounds.set(o.id(),o.canvasSpaceRenderedBounds()),this._initCachedBounds(o)}}};var Nw=-1,Tb=!1,Qt=class Qt{addProperty(e){return this.transition=e(this.transition!=null?this.transition:new un),this}dissolve(){return this.isDissolve=!0,this.transition=new un().transform(this.transition.from().transform1(),this.transition.to().transform1()),this}static buildStrategy(e,t){let n=new Qt;for(let o of Qt.propertyFunctions)if(o(e,t,n),n.isDissolve)return n;return n}static forDiscreteProperties(e,t,n){return n=Qt.nodeTypeToRenderSetMap.get(e.type())==Qt.nodeTypeToRenderSetMap.get(t.type())?n:n.dissolve(),n=e.blendMode()==t.blendMode()?n:n.dissolve(),n=e.clipsToBoundingRectangle()==t.clipsToBoundingRectangle()?n:n.dissolve(),n=e.isFixed()==t.isFixed()?n:n.dissolve(),n}static forSizes(e,t,n){let o=e.size(),i=t.size();if(n.addProperty(l=>l.transformOrigin(o.divideScalar(2),i.divideScalar(2))),n.transition.hasLegacyTransitioningSizesForImageRect()||n.transition.hasTransitioningGeometryForRoundedRectangles()||e.type()=="ROUNDED_RECTANGLE"&&t.type()=="ROUNDED_RECTANGLE")return n;let a=t.isResizeToFit()||zt.isFrameLike(t.type())&&!t.clipsToBoundingRectangle();return(e.isResizeToFit()||zt.isFrameLike(e.type())&&!e.clipsToBoundingRectangle())&&Qt._filterPaints3(e.fillPaintsToRender()).length==0&&a&&Qt._filterPaints3(t.fillPaintsToRender()).length==0||o.equals(i)?n:n.dissolve()}static forOpacity(e,t,n){return n.addProperty(o=>o.opacity(e,t))}static forRelativeTransforms(e,t,n){return n.addProperty(o=>o.transform(e,t))}static forFillPaints(e,t,n){let o=Qt._filterPaints2(e),i=Qt._filterPaints2(t);return Qt._maybeInterpolatePaints(o,i,n,a=>a.fillPaints1(o,i))}static forStrokePaints(e,t,n){let o=Qt._filterPaints2(e),i=Qt._filterPaints2(t);return Qt._maybeInterpolatePaints(o,i,n,a=>a.strokePaints1(o,i))}static _filterPaints1(e){return Qt._filterPaints2(e)}static _filterPaints2(e){return e.filter(t=>t.isEnabled())}static _filterPaints3(e){return Qt._filterPaints2(e)}static _maybeInterpolatePaints(e,t,n,o){return!n.transition.hasTransitioningGeometryForRoundedRectangles()&&Mt.FrozenList_equals(e,t,(i,a)=>i.equals1(a))?n:Mt.FrozenList_equals(e,t,(i,a)=>i.type()==a.type()&&i.blendMode()==a.blendMode())?n.addProperty(o):n.dissolve()}static forGeometryAndPaints(e,t,n){var c,p;let o=e.supportsGeometry(),i=t.supportsGeometry();if(!o&&!i)return n;if(o!=i)return n.dissolve();let a=((c=e.fillGeometry())==null?void 0:c.regions)??[],s=((p=t.fillGeometry())==null?void 0:p.regions)??[],l=(zt.isFrameLike(e.type())&&e.containerSupportsFillStrokeAndCorners()||["RECTANGLE","ROUNDED_RECTANGLE"].indexOf(e.type())!=-1)&&e.strokePaints().length==0&&a.length==1&&St.isRoundedRectSupportedIgnoringCornerSmoothing(e.roundedRectInfo()),d=(zt.isFrameLike(t.type())&&t.containerSupportsFillStrokeAndCorners()||["RECTANGLE","ROUNDED_RECTANGLE"].indexOf(t.type())!=-1)&&t.strokePaints().length==0&&s.length==1&&St.isRoundedRectSupportedIgnoringCornerSmoothing(t.roundedRectInfo());if(l&&d){if(a.length!=0&&s.length!=0){let u=e.fillGeometry().regions[0].bounds().size(),_=t.fillGeometry().regions[0].bounds().size(),h=Ao.fromRoundedRect(e.roundedRectInfo()),S=Ao.fromRoundedRect(t.roundedRectInfo());(!h.equals(S)||!u.equals(_))&&n.addProperty(m=>m.transitionGeometryForRoundedRectangles(u,h,_,S))}}else{let u=!1;if(e.isAxisAlignedRectFill()&&t.isAxisAlignedRectFill())for(let _ of[e.fillPaints(),t.fillPaints()]){for(let h=0,S=_.length;h<S;h=h+1)if(_[h].type()=="IMAGE"||_[h].type()=="VIDEO"){u=!0;break}if(u)break}if(u&&!e.fillOrTextGeometry().geometryEquals(t.fillOrTextGeometry())){let _=Qt._filterPaints1(e.fillRegionPaints()[0]),h=Qt._filterPaints1(t.fillRegionPaints()[0]);if(Mt.FrozenList_equals(_,h,(S,m)=>S.type()==m.type()))return n.addProperty(S=>S.fillPaints1(_,h)),n.addProperty(S=>S.shouldDoLegacyImageRectSizeTransition(!0)),n}n=Qt._forGeometryStructure(e.fillOrTextGeometry(),t.fillOrTextGeometry(),n)}return n=Qt._forGeometryPaints(e.fillRegionPaints(),t.fillRegionPaints(),n,(u,_,h)=>Qt.forFillPaints(u,_,h)),n=Qt._forGeometryStructure(e.strokeGeometry(),t.strokeGeometry(),n),n=Qt._forGeometryPaints(e.strokeRegionPaints(),t.strokeRegionPaints(),n,(u,_,h)=>Qt.forStrokePaints(u,_,h)),n}static forEffects(e,t,n){let o=e.filter(a=>a.isVisibleForRendering()),i=t.filter(a=>a.isVisibleForRendering());return ne.List_equalsWithComparison(o,i,(a,s)=>a.equals(s))?n:n.dissolve()}static _forGeometryStructure(e,t,n){return e!=null&&t!=null?e.geometryEquals(t)?n:n.dissolve():e==null&&t==null?n:n.dissolve()}static _forGeometryPaints(e,t,n,o){if(e.length==t.length){for(let i=0,a=e.length;i<a;i=i+1)if(n=o(e[i],t[i],n),n.isDissolve)return n;return n}return n.dissolve()}constructor(){this.isDissolve=!1,this.transition=new un}};Qt.propertyFunctions=[(e,t,n)=>{let o=e.overlayTransform().clone();o.multiply(e.relativeTransformAccountingForFixedOffset());let i=t.overlayTransform().clone();i.multiply(t.relativeTransformAccountingForFixedOffset()),Qt.forRelativeTransforms(o,i,n)},(e,t,n)=>{Qt.forGeometryAndPaints(e,t,n)},(e,t,n)=>{Qt.forSizes(e,t,n)},(e,t,n)=>{Qt.forDiscreteProperties(e,t,n)},(e,t,n)=>{Qt.forOpacity(e.opacity(),t.opacity(),n)},(e,t,n)=>{Qt.forEffects(e.effects(),t.effects(),n)}],Qt.nodeTypeToRenderSetMap=[["NONE","DOCUMENT","SLICE"],["CANVAS","GROUP","FRAME","SYMBOL","INSTANCE","CONNECTOR","STICKY","SHAPE_WITH_TEXT","CODE_BLOCK","MEDIA","SECTION_OVERLAY","TABLE","TABLE_CELL","SLIDE","MODULE"],["ELLIPSE","LINE","RECTANGLE","REGULAR_POLYGON","ROUNDED_RECTANGLE","STAR","VECTOR","STAMP","WASHI_TAPE"],["BOOLEAN_OPERATION"],["TEXT"]].reduce((e,t,n)=>(t.forEach(o=>{e.set(o,n)}),e),new Map);var gc=Qt;var Po=class r{constructor(e,t,n,o){this._lastInputTForAbsoluteTransform=-1;this._oldSceneNode=e,this._oldCanvasToRenderTreeTransform=t,this._newSceneNode=n,this._newCanvasToRenderTreeTransform=o,this._children=[],this._enabledTraits=Nw,this._parent=null,this._transition=null,this._isDissolve=!1,this._scalesIndependentlyOfParent=!1,this._forceMask=!1,this._interpolateScalingToCachedAbsoluteTransform=new Map}get isDissolve(){return this._isDissolve}get scalesIndependentlyOfParent(){return this._scalesIndependentlyOfParent}get forceMask(){return this._forceMask}get enabledTraits(){return this._enabledTraits}get transition(){return this._transition}setTransition(e){this._transition=e,this._referenceTransitionForChildrenNodes=e}clearTransitionForDissolveRenderTrees(){let e=this.transition.clone().transform(J.new2(),J.new2());this._transition=e}get parent(){return this._parent}get children(){return this._children}static debugStringRecursive(e,t,n,o){var s,l;t.result+=t.indent,n||(t.result+=o?"\u2514\u2500":"\u251C\u2500");let i=t.indent.length;n||(t.indent+=o?"  ":"\u2502 "),t.result+=`${((s=e._oldSceneNode)==null?void 0:s.name())??"null"} -> ${((l=e._newSceneNode)==null?void 0:l.name())??"null"}`,e.forceMask&&(t.result+=" (.MASK)");let a=e.transition;if(a!=null){let d=a.from(),c=a.to();if(t.result+=e.isDissolve?" (dissolve)":"",t.result+=a.hasTransitioningPaints()&&4&e.enabledTraits?` (paints) ${d.fillPaintsToString()} -> ${c.fillPaintsToString()}`:"",t.result+=a.hasTransitioningGeometryForRoundedRectangles()&&16&e.enabledTraits?" (geometry)":"",(d.opacity1()!=1||d.opacity1()!=c.opacity1())&&(t.result+=` (opacity: ${d.opacity1()} -> ${c.opacity1()})`),d.translation1().equals(c.translation1())||(t.result+=` (translation: ${d.translation1()} -> ${c.translation1()})`),!d.transform1().equals1(c.transform1())){let p=to.from(d.transform1()),u=to.from(c.transform1());p.translation.approximatelyEquals(u.translation,1e-6)||(t.result+=` (translation: ${p.translation} -> ${u.translation})`),p.scale.approximatelyEquals(u.scale,1e-6)||(t.result+=` (scale: ${p.scale} -> ${u.scale})`),p.angleDegrees!=u.angleDegrees&&(t.result+=` (angle: ${p.angleDegrees} deg -> ${u.angleDegrees} deg)`)}}t.result+=`
`;for(let d=0,c=e.children.length;d<c;d=d+1)this.debugStringRecursive(e.children[d],t,!1,d==e.children.length-1);e.isDissolve&&(this.debugStringRecursive(e.forDissolveStart1(),t,!1,!1),this.debugStringRecursive(e.forDissolveEnd1(),t,!1,!0)),t.indent=t.indent.slice(0,i)}static _generatePlanForMatchedNodes(e,t,n,o,i,a){let s=gc.buildStrategy(e,n);if(s.transition.hasLegacyTransitioningSizesForImageRect()){let d=s.transition;d.scaling(new b(1,1),n.size().divide(e.size()));let c=new r(e,t,n,o);return c._isDissolve=!1,c.setTransition(d),c}let l=this.getMagicMovePlan1(e,t,n,o,i,null,e.isFixed()?Tr.DISSOLVE:a);return l._isDissolve=s.isDissolve,l.setTransition(s.transition),l}static _generatePlanForRemovedNode(e,t,n){let o=new r(e,t,null,null);if(n!=null&&n.isDissolve()){let i=new un().opacity(e.opacity(),0);i.transform(e.relativeTransformAccountingForFixedOffset(),e.relativeTransformAccountingForFixedOffset()),o.setTransition(i)}else{let i=new un().transform(e.relativeTransformAccountingForFixedOffset(),e.relativeTransformAccountingForFixedOffset());n!=null?(i.translation(n.exitingFrameTransition().from().translation1(),n.exitingFrameTransition().to().translation1()),i.opacity(e.opacity()*n.exitingFrameTransition().from().opacity1(),e.opacity()*n.exitingFrameTransition().to().opacity1())):i.opacity(e.opacity(),e.opacity()),o.setTransition(i)}return e.forEachChild(i=>{o._appendChild(this._generatePlanForRemovedNode(i,t,null))},!0),o}static _generatePlanForInsertedNode(e,t,n){let o=new r(null,null,e,t);if(n!=null&&n.isDissolve()){let i=new un().opacity(0,e.opacity());i.transform(e.relativeTransformAccountingForFixedOffset(),e.relativeTransformAccountingForFixedOffset()),o.setTransition(i)}else{let i=new un().transform(e.relativeTransformAccountingForFixedOffset(),e.relativeTransformAccountingForFixedOffset());n!=null?(i.translation(n.enteringFrameTransition().from().translation1(),n.enteringFrameTransition().to().translation1()),i.opacity(e.opacity()*n.enteringFrameTransition().from().opacity1(),e.opacity()*n.enteringFrameTransition().to().opacity1())):i.opacity(e.opacity(),e.opacity()),o.setTransition(i)}return e.forEachChild(i=>{o._appendChild(this._generatePlanForInsertedNode(i,t,null))},!0),o}static _matchKey(e){return e.name()}static _getNodeMatches(e,t,n,o){if(!o&&(e.type()=="BOOLEAN_OPERATION"||t.type()=="BOOLEAN_OPERATION"))return;let i=new Map;t.forEachChild(a=>{if(!a.visible())return;let s=this._matchKey(a),l=null;i.has(s)?l=i.get(s):(l=[],i.set(s,l)),l.push(a)}),e.forEachChild(a=>{if(!a.visible())return;let s=this._matchKey(a),l=Ge.StringMap_get(i,s,null);if(l==null||l.length==0)return;let d=l.shift();n.set(a.id(),d),n.set(d.id(),a),this._getNodeMatches(a,d,n,o)})}static getNodeMatches(e,t){let n=new Map;return this._getNodeMatches(e,t,n,!1),n}static getMagicMovePlan1(e,t,n,o,i,a,s){a==null&&(a=new un);let l=e.isTopLevel()&&n.isTopLevel(),d=new r(e,t,n,o);if(e.type()=="BOOLEAN_OPERATION"||n.type()=="BOOLEAN_OPERATION")return d;for(let p=0;p<n.childCount();p=p+1){let u=n.childAt2(p,!0),_=Ge.StringMap_get(i,u.id(),null);_==null?d._appendChild(this._generatePlanForInsertedNode(u,o,s)):d._appendChild(this._generatePlanForMatchedNodes(_,t,u,o,i,s))}let c=0;for(;c<e.childCount();){let p=[],u=c,_=c;for(;c<e.childCount();){let y=e.childAt2(c,!0);if(i.has(y.id()))break;p.push(this._generatePlanForRemovedNode(y,t,s)),_=c,c=c+1}if(p.length==0){c=c+1;continue}let h=-1,S=d.children.length;if(u-1>=0){let y=e.childAt2(u-1,!0);if(y!=null){let E=Ge.StringMap_get(i,y.id(),null);E!=null&&(h=d.indexOfSceneNodeInChildren(E))}}if(_+1<e.childCount()){let y=e.childAt2(_+1,!0);if(y!=null){let E=Ge.StringMap_get(i,y.id(),null);E!=null&&(S=d.indexOfSceneNodeInChildren(E))}}let m=Math.min(h,S),f=Math.max(h,S),T=s.drawsEnteringFrameOnTopOfExitingFrame()?m+1:f;d.insertChildren(T,p)}if(l){d._enabledTraits&=-5,d._enabledTraits&=-9,d._enabledTraits&=-65,d._enabledTraits&=-3,d._enabledTraits&=-33,d._enabledTraits&=-129;let p=e.clipsToBoundingRectangle()&&e.containerSupportsFillStrokeAndCorners()||n.clipsToBoundingRectangle()&&n.containerSupportsFillStrokeAndCorners(),u=new r(e,t,n,o);u._enabledTraits=156,p&&(u._enabledTraits&=-9),u._isDissolve=!0,u.setTransition(new un);let _=p;if(e.fillGeometry()!=null&&n.fillGeometry()!=null&&(_=_&&!e.fillGeometry().geometryEquals(n.fillGeometry())),_){let m=d,f=new r(e,t,n,o);f._enabledTraits=20,f.setTransition(new un),f._forceMask=!0,f._isDissolve=!0,d=new r(e,t,n,o),d._enabledTraits=0,d._isDissolve=!1,d.setTransition(new un),d._appendChild(f),d._appendChild(m)}else d._enabledTraits|=130;let h=[u,d];if(p){let m=new r(e,t,n,o);m._enabledTraits=24,m._isDissolve=!0,m.setTransition(new un),h.push(m)}a.opacity(e.opacity(),n.opacity());let S=new r(e,t,n,o);return S._enabledTraits=224,S.insertChildren(0,h),S.setTransition(a),S}else return d}static getMagicMovePlanForStateSwapTransition(e,t){var s;let n=this.getNodeMatches(e,t),o=((s=t.parent())==null?void 0:s.absoluteTransform())??yt.FrozenAffineTransform_IDENTITY,i=this._generatePlanForMatchedNodes(e,yt.FrozenAffineTransform_IDENTITY,t,yt.FrozenAffineTransform_IDENTITY,n,Tr.DISSOLVE),a=i.transition;return i.setTransition(a.clone().transform(o.clone().multipliedBy1(a.from().transform1()),o.clone().multipliedBy1(a.to().transform1()))),Tb&&(console.log("------------------------------"),console.log("getMagicMovePlanForStateSwapTransition between interactive component states"),console.log(i.debugString()),console.log("------------------------------")),i}static getMagicMovePlan2(e,t,n,o,i){let a=this.getNodeMatches(e,n),s=new un().transform(t.clone().multipliedBy1(e.absoluteTransform()),o.clone().multipliedBy1(n.absoluteTransform()));return this.getMagicMovePlan1(e,t,n,o,a,s,i)}static renderTreeForMagicMove(e,t,n,o,i){let a=J.new2().copyFrom(e.absoluteTransform());a.invert();let s=J.new2();s.leftMultiply(a),s.leftMultiply(t.absoluteTransform());let l=yt.FrozenAffineTransform_IDENTITY,d=e.size().max(t.size()),c=this.getMagicMovePlan2(e,s,t,l,i.withScaledTranslation(d)),p=!0,u=()=>p?0:n(),_=new Ai(c,null,u,o),h=ye.renderTreeWithPerfLogging1(_,"renderTreeForMagicMove");return Tb&&(console.log("------------------------------"),console.log(`renderTreeForMagicMove between top-level frames ${e.id()} -> ${t.id()}`),console.log(c.debugString()),console.log(h.debugString1()),console.log("------------------------------")),p=!1,h}forDissolveStart1(){return this.forDissolveStart2(null)}forDissolveStart2(e){let t=new r(this._oldSceneNode,this._oldCanvasToRenderTreeTransform,null,null);t._enabledTraits=this._enabledTraits,t._forceMask=this._forceMask;let n=this._referenceTransitionForChildrenNodes.clone().opacity(this._oldSceneNode.opacity(),this._oldSceneNode.opacity());return this._oldSceneNode!=null&&this._newSceneNode!=null&&(this._oldSceneNode.type()=="TEXT"||this._newSceneNode.type()=="TEXT"?this._maybeUpdateDissolveTransitionsForText(this._oldSceneNode,this._newSceneNode,o=>{n.scaling(fe.FrozenVector_ONE,new b(o,o))},n.to().transform1(),o=>{n.transform(n.from().transform1(),o)}):n.hasTransitioningGeometryForRoundedRectangles()||n.scaling(fe.FrozenVector_ONE,Gh(this._newSceneNode).divide(Gh(this._oldSceneNode))),n.transformOrigin(this._oldSceneNode.size().divideScalar(2),this._newSceneNode.size().divideScalar(2))),t._isDissolve=!1,t.setTransition(n),e!=null&&(n.from().scaling1().divide(n.to().scaling1()).equals(e.from().scaling1().divide(e.to().scaling1()))||(t._scalesIndependentlyOfParent=!0)),this.children.forEach(o=>{o._oldSceneNode!=null&&t._appendChild(o.forDissolveStart2(n))}),t}forDissolveEnd1(){return this.forDissolveEnd2(null)}forDissolveEnd2(e){let t=new r(null,null,this._newSceneNode,this._newCanvasToRenderTreeTransform);t._enabledTraits=this._enabledTraits,t._forceMask=this._forceMask;let n=this._referenceTransitionForChildrenNodes.clone().opacity(this._newSceneNode.opacity(),this._newSceneNode.opacity());return this._oldSceneNode!=null&&this._newSceneNode!=null&&(this._oldSceneNode.type()=="TEXT"||this._newSceneNode.type()=="TEXT"?this._maybeUpdateDissolveTransitionsForText(this._newSceneNode,this._oldSceneNode,o=>{n.scaling(new b(o,o),fe.FrozenVector_ONE)},n.from().transform1(),o=>{n.transform(o,n.to().transform1())}):n.hasTransitioningGeometryForRoundedRectangles()||n.scaling(Gh(this._oldSceneNode).divide(Gh(this._newSceneNode)),fe.FrozenVector_ONE),n.transformOrigin(this._oldSceneNode.size().divideScalar(2),this._newSceneNode.size().divideScalar(2))),t._isDissolve=!1,t.setTransition(n),e!=null&&(n.from().scaling1().divide(n.to().scaling1()).equals(e.from().scaling1().divide(e.to().scaling1()))||(t._scalesIndependentlyOfParent=!0)),this.children.forEach(o=>{o._newSceneNode!=null&&t._appendChild(o.forDissolveEnd2(n))}),t}_maybeUpdateDissolveTransitionsForText(e,t,n,o,i){if(t.type()!="TEXT"||e.type()!="TEXT")return;let a=t.textGeometry(),s=e.textGeometry(),l=1;!t.textHasMixedFontSizes()&&!e.textHasMixedFontSizes()&&t.fontSize()>0&&e.fontSize()>0&&(l=t.fontSize()/e.fontSize(),n(l));let d=b.new(),c=G.new4(t.relativeTransform().translation(),t.size()),p=G.new4(e.relativeTransform().translation(),e.size()),u=null,_=null,h=G.new2();switch(t.textAlignHorizontal()==e.textAlignHorizontal()?(u=a.bounds,_=s.bounds):(u=c,_=p),h.copyFrom(_).scaledBy1(l),e.textAlignHorizontal()){case"RIGHT":{d.setX(u.right()-_.right()-(h.right()-_.right()));break}case"CENTER":case"JUSTIFIED":{d.setX(u.center().x()-_.center().x()-(h.center().x()-_.center().x()));break}}switch(t.textAlignVertical()==e.textAlignVertical()?(u=a.bounds,_=s.bounds):(u=c,_=p),h.copyFrom(_).scaledBy1(l),e.textAlignVertical()){case"BOTTOM":{d.setY(u.bottom()-_.bottom()-(h.bottom()-_.bottom()));break}case"CENTER":{d.setY(u.center().y()-_.center().y()-(h.center().y()-_.center().y()));break}}if(!d.equals(b.new())){let S=J.new3(o);S.translate1(d),i(S)}}sceneNode(){return this._oldSceneNode??this._newSceneNode}isEverVisible(){return this._isSceneNodeEverVisible(this._oldSceneNode)||this._isSceneNodeEverVisible(this._newSceneNode)}_isSceneNodeEverVisible(e){return e!=null&&e.visible()&&e.opacity()>0}absoluteTransform1(e){return Y.smartAnimateCacheTransform()?this.absoluteTransform2WithCaching(e,1):this.absoluteTransform2(e,1)}invalidateCachedAbsoluteTransformsForSelf(){Y.smartAnimateCacheTransform()&&(this._lastInputTForAbsoluteTransform=-1,this._interpolateScalingToCachedAbsoluteTransform[0]=null,this._interpolateScalingToCachedAbsoluteTransform[1]=null)}absoluteTransform2WithCaching(e,t){return e!=this._lastInputTForAbsoluteTransform&&(this._lastInputTForAbsoluteTransform=e,this._interpolateScalingToCachedAbsoluteTransform[0]=null,this._interpolateScalingToCachedAbsoluteTransform[1]=null),this._interpolateScalingToCachedAbsoluteTransform[t]||(this._interpolateScalingToCachedAbsoluteTransform[t]=this.absoluteTransform2(e,t)),this._interpolateScalingToCachedAbsoluteTransform[t]}absoluteTransform2(e,t){let n=J.new2();if(this._transition!=null){let o=this._transition.interpolateTranslation(e);n.translate1(o)}if(this._parent!=null&&n.multiply(this._parent.absoluteTransform2(e,0)),this._transition!=null){let o=this._transition.interpolateTransform(e);if(n.multiply(o),t){let i=this._transition.interpolateScaling(e);n.scale3(i)}}return n}rotatesOrScales1(){return this.rotatesOrScales2(!0)}rotatesOrScales2(e){let t=this._transition!=null;return e?t=t&&!this._transition.from().equalTransformsUpToTranslation(this._transition.to(),1e-10):t=t&&!this._transition.from().equalTransformsUpToTranslationAndScaling(this._transition.to(),1e-10),this._parent!=null&&(t=t||this._parent.rotatesOrScales2(!1)),t}_appendChild(e){e._parent=this,this._children.push(e)}insertChildren(e,t){for(let n of t)n._parent=this;uS(this._children,e,t)}removeChild(e){this._children.splice(e,1)}debugString(){let e=new cA;return r.debugStringRecursive(this,e,!0,!0),e.result}indexOfSceneNodeInChildren(e){for(let t=0;t<this.children.length;t=t+1){let n=this.children[t];if(n._oldSceneNode==e||n._newSceneNode==e)return t}return-1}indexInParent(){return this._parent!=null?this._parent.children.indexOf(this):-1}},cA=class{constructor(){this.result="",this.indent=""}},Ai=class r{constructor(){this._sceneNodeCursor=null;arguments.length==4?(this._planNode=arguments[0],this._node=arguments[1],this._getEasedT=arguments[2],this._easingFunction=arguments[3]):arguments.length==3&&(this._planNode=arguments[0],this._node=null,this._getEasedT=arguments[1],this._easingFunction=arguments[2]),this._updateSceneNodeCursorForCurrentPlanNode()}clone(){return new r(this._planNode,this._node,this._getEasedT,this._easingFunction)}_updateSceneNodeCursorForCurrentPlanNode(){let e=this._planNode.sceneNode();if(e==null){this._sceneNodeCursor=null;return}this._sceneNodeCursor==null?this._sceneNodeCursor=new Nt(e):this._sceneNodeCursor.setNode(e)}moveToChildAt(e){this._planNode=this._planNode.children[e],this._node=this._node!=null&&e<this._node.childCount()?this._node.childAt2(e,!0):null,this._updateSceneNodeCursorForCurrentPlanNode()}moveToParent(){this._planNode=this._planNode.parent,this._node=this._node!=null?this._node.parent():null,this._updateSceneNodeCursorForCurrentPlanNode()}isRoot(){return this._planNode.parent==null}hasTransitioningPaints(){return this._planNode.transition.hasTransitioningPaints()}indexInParent(){return this._planNode.indexInParent()}renderableContentType(){return this.hasCustomRenderTree()?mr.RenderableContentType.CUSTOM_RENDER_TREE:16&this._planNode.enabledTraits?this._sceneNodeCursor!=null?this._sceneNodeCursor.renderableContentType():mr.RenderableContentType.NON_RENDERABLE:mr.RenderableContentType.RENDERABLE_GROUP}isFrameLike(){return this._planNode.isDissolve?!1:zt.isFrameLike(this.type())}isTopLevel(){return!1}paintsDebugString(){return`AnimationPlanNode [from=${this._planNode._oldSceneNode.paintsDebugString()}] [to=${this._planNode._newSceneNode.paintsDebugString()}]`}subtreeWillChange(){var t,n,o,i;if(this._planNode.cachedSubtreeWillChange!==void 0)return this._planNode.cachedSubtreeWillChange;if(this._sceneNodeCursor.node!=null&&this._sceneNodeCursor.node.isTopLevel())return this._planNode.cachedSubtreeWillChange=!0,!0;if((t=this._planNode._oldSceneNode)!=null&&t.hasBackgroundBlurs()||(n=this._planNode._newSceneNode)!=null&&n.hasBackgroundBlurs())return this._planNode.cachedSubtreeWillChange=!0,!0;if(((o=this._planNode._oldSceneNode)==null?void 0:o.effects().filter(a=>a.type()=="DROP_SHADOW"&&a.isVisibleForRendering()).length)>0||((i=this._planNode._newSceneNode)==null?void 0:i.effects().filter(a=>a.type()=="DROP_SHADOW"&&a.isVisibleForRendering()).length)>0)return this._planNode.cachedSubtreeWillChange=!0,!0;if(!this._planNode.isEverVisible())return this._planNode.cachedSubtreeWillChange=!1,!1;if(this.willChange()!==0)return this._planNode.cachedSubtreeWillChange=!0,!0;if(this._planNode.isDissolve||this._planNode.transition!=null&&(this._planNode.transition.hasTransitioningPaints()||this._planNode.transition.hasTransitioningGeometryForRoundedRectangles()))return this._planNode.cachedSubtreeWillChange=!0,!0;if(this.childCount()===0)return this._planNode.cachedSubtreeWillChange=!1,!1;for(let a=this.childCount()-1;a>=0;a=a-1){this.moveToChildAt(a);let s=this.subtreeWillChange();if(this.moveToParent(),s!=!1)return this._planNode.cachedSubtreeWillChange=!0,!0}return this._planNode.cachedSubtreeWillChange}willChange(){if(this._planNode.transition==null||!this._planNode.isEverVisible())return 0;let e=0;return this._planNode.transition.from().opacity1()!=this._planNode.transition.to().opacity1()&&(e|=2),(this._planNode.transition.hasTransitioningTranslation()||this._planNode.transition.hasTransitioningTransform()||this._planNode.transition.hasTransitioningScaling()||this._planNode.transition.hasTransitioningTransformOrigin())&&(e|=1),this._planNode.scalesIndependentlyOfParent&&(e|=1),e}size(){return this._planNode.sceneNode().size()}shouldOptimizeShadowForAnimation(e){return e==null||e.equals(fe.FrozenVector_ZERO)?!1:this._planNode.rotatesOrScales1()}hasCustomRenderTree(){return this._planNode.isDissolve}customRenderTree(e){var t,n,o,i;if(this._planNode.isDissolve){let a=this._planNode.indexInParent(),s=this._planNode.forDissolveStart1();(t=this._planNode.parent)==null||t.insertChildren(a,[s]);let l=ye.generateRenderTree(new r(s,this._getEasedT,this._easingFunction),e);(n=this._planNode.parent)==null||n.removeChild(a);let d=null;if(this._node!=null&&this._node.hasBackgroundBlurs())d=ye.generateRenderTree(new Nt(this._node),e);else{let p=this._planNode.forDissolveEnd1();(o=this._planNode.parent)==null||o.insertChildren(a,[p]),d=ye.generateRenderTree(new r(p,this._getEasedT,this._easingFunction),e),(i=this._planNode.parent)==null||i.removeChild(a)}let c=new cn(l,d,ft.forAnimateableDissolve(this._planNode.sceneNode().id()),this._getEasedT);return this._planNode.clearTransitionForDissolveRenderTrees(),this._planNode.invalidateCachedAbsoluteTransformsForSelf(),this._planNode.cachedSubtreeWillChange=!0,c}throw new Error("Unhandled customRenderTree case")}opacity(){return 32&this._planNode.enabledTraits?this._planNode.transition!=null?this._planNode.transition.interpolateOpacity(this._getEasedT()):this._sceneNodeCursor.opacity():1}absoluteTransform(){return this._planNode.absoluteTransform1(this._getEasedT())}maxTransformScale(){let e=this._planNode.transition;if(e==null)return 1;let t=e.from().scaling1(),o=e.to().scaling1().divide(t).minComponent();return Math.max(o,1)}scene(){return this._sceneNodeCursor.scene()}parent(){if(this._planNode.parent==null)return null;let e=this._node!=null?this._node.parent():null;return new r(this._planNode.parent,e,this._getEasedT,this._easingFunction)}blendMode(){return 32&this._planNode.enabledTraits?this._sceneNodeCursor.blendMode():"PASS_THROUGH"}visible(){return this._sceneNodeCursor.visible()}isVisibleMask(){return this._planNode.forceMask?!0:128&this._planNode.enabledTraits?this._sceneNodeCursor.isVisibleMask():!1}maskType(){return this._sceneNodeCursor.maskType()}isSpreadEligibleNode(){return this._sceneNodeCursor.isSpreadEligibleNode()}type(){return this._sceneNodeCursor.type()}childCount(){return this._planNode.children.length}clipsChildren(){return 2&this._planNode.enabledTraits?this._sceneNodeCursor.clipsChildren():!1}stopsMaskPropagation(){return this._planNode.forceMask?!0:128&this._planNode.enabledTraits?this._sceneNodeCursor.stopsMaskPropagation():!1}strokeAlign(){return this._sceneNodeCursor.strokeAlign()}strokeWeight(){return this._sceneNodeCursor.strokeWeight()}hasDefaultStrokeParameters(){return this._sceneNodeCursor.hasDefaultStrokeParameters()}strokeJoin(){return this._sceneNodeCursor.strokeJoin()}setStrokeJoin(e){this._sceneNodeCursor.setStrokeJoin(e)}strokeMiterLimit(){return this._sceneNodeCursor.strokeMiterLimit()}setStrokeMiterLimit(e){this._sceneNodeCursor.setStrokeMiterLimit(e)}uniqueIdentifier(){return this._sceneNodeCursor.id()}isInsideOutlineMask(){return this._sceneNodeCursor.isInsideOutlineMask()}textData(){return this._sceneNodeCursor.textData()}derivedTextData(){return this._sceneNodeCursor.derivedTextData()}arcData(){return this._sceneNodeCursor.arcData()}isRoundedRect(){return this._sceneNodeCursor.isRoundedRect()}roundedRectInfo(){return this._sceneNodeCursor.roundedRectInfo()}fillGeometry(){if(16&this._planNode.enabledTraits){if(this._planNode.transition!=null&&this._planNode.transition.hasTransitioningGeometryForRoundedRectangles())return this._planNode.transition.fillGeometryForRoundedRectangles(this._getEasedT,this._easingFunction.bounds)}else return null;return this._sceneNodeCursor.fillGeometry()}strokeGeometry(){return 16&this._planNode.enabledTraits?this._sceneNodeCursor.strokeGeometry():null}fillGeometryForSpread(e,t,n){return 16&this._planNode.enabledTraits&&this._planNode.transition!=null&&this._planNode.transition.hasTransitioningGeometryForRoundedRectangles()?this._planNode.transition.fillGeometryForSpreadDynamic(e,t,this._getEasedT,n,this.uniqueIdentifier(),this._easingFunction.bounds):this._sceneNodeCursor.fillGeometryForSpread(e,t,n)}strokeGeometryForSpread(e,t,n,o){return this._sceneNodeCursor.strokeGeometryForSpread(e,t,n,o)}textGeometry(){return 16&this._planNode.enabledTraits?this._sceneNodeCursor.textGeometry():null}getCachedRenderTree(){return null}getCachedBaseScreenRenderTree(){return null}renderTree(){if(this._sceneNodeCursor!=null&&!this.subtreeWillChange()){let t=null;return this._sceneNodeCursor.node.getCachedRenderTreeForBaseScreen()!=null?t=this._sceneNodeCursor.node.renderTreeForBaseScreen1():t=this._sceneNodeCursor.renderTree(),this.wrapNonAnimatingSubTreeWithPositionTransform(t)}let e=new ye.GenerateArgs(ye.RenderMode.NORMAL);return ye.generateRenderTree(this.clone(),e)}renderTreeWithoutBackgroundBlurs(){if(this._sceneNodeCursor!=null&&!this.subtreeWillChange()){let t=this._sceneNodeCursor.renderTreeWithoutBackgroundBlurs();return this.wrapNonAnimatingSubTreeWithPositionTransform(t)}let e=new ye.GenerateArgs(ye.RenderMode.WITHOUT_BACKGROUND_BLURS);return ye.generateRenderTree(this.clone(),e)}renderTreeForShadowRoot(){if(this._sceneNodeCursor!=null&&!this.subtreeWillChange()){let t=this._sceneNodeCursor.renderTreeForShadowRoot();return this.wrapNonAnimatingSubTreeWithPositionTransform(t)}let e=new ye.GenerateArgs(ye.RenderMode.SHADOW,this.uniqueIdentifier());return ye.generateRenderTree(this.clone(),e)}renderTreeForShadowDescendant(){if(this._sceneNodeCursor!=null&&!this.subtreeWillChange()){let t=this._sceneNodeCursor.renderTreeForShadowDescendant();return this.wrapNonAnimatingSubTreeWithPositionTransform(t)}let e=new ye.GenerateArgs(ye.RenderMode.SHADOW);return ye.generateRenderTree(this.clone(),e)}renderTreeForKnockoutShadowRoot(){if(this._sceneNodeCursor!=null&&!this.subtreeWillChange()){let t=this._sceneNodeCursor.renderTreeForKnockoutShadowRoot();return this.wrapNonAnimatingSubTreeWithPositionTransform(t)}let e=new ye.GenerateArgs(ye.RenderMode.KNOCKOUT_SHADOW,this.uniqueIdentifier());return ye.generateRenderTree(this.clone(),e)}renderTreeForKnockoutShadowDescendant(){if(this._sceneNodeCursor!=null&&!this.subtreeWillChange()){let t=this._sceneNodeCursor.renderTreeForKnockoutShadowDescendant();return this.wrapNonAnimatingSubTreeWithPositionTransform(t)}let e=new ye.GenerateArgs(ye.RenderMode.KNOCKOUT_SHADOW);return ye.generateRenderTree(this.clone(),e)}renderTreeForSlideThumbnail(){if(this._sceneNodeCursor!=null&&!this.subtreeWillChange()){let t=this._sceneNodeCursor.renderTreeForSlideThumbnail();return this.wrapNonAnimatingSubTreeWithPositionTransform(t)}let e=new ye.GenerateArgs(ye.RenderMode.SLIDE_THUMBNAIL);return ye.generateRenderTree(this.clone(),e)}wrapNonAnimatingSubTreeWithPositionTransform(e){if(e==null)return null;if(this._planNode._oldSceneNode==null){let t=this._planNode._newSceneNode.absoluteTransform(),n=this.absoluteTransform().clone();return n=n.multipliedBy1(t.inverse()),new Eo(e,n)}else return new Eo(e,this._planNode._oldCanvasToRenderTreeTransform)}isFixed(){return this._sceneNodeCursor.isFixed()}isStandardScrolling(){return this._sceneNodeCursor.isStandardScrolling()}isStickyScrolling(){return this._sceneNodeCursor.isStickyScrolling()}scrollOffset(){return 1&this._planNode.enabledTraits?this._sceneNodeCursor.scrollOffset():fe.FrozenVector_ZERO}scrollSpeedMultiplier(){return this._sceneNodeCursor.scrollSpeedMultiplier()}scrollDirection(){return 1&this._planNode.enabledTraits?this._sceneNodeCursor.scrollDirection():"NONE"}hasOverflowingContentInScrollDirection(){return 1&this._planNode.enabledTraits?this._sceneNodeCursor.hasOverflowingContentInScrollDirection():!1}effects(){return this._planNode.isDissolve||!(64&this._planNode.enabledTraits)?[]:this._sceneNodeCursor.effects()}fillPaints(){var t;if(!(4&this._planNode.enabledTraits))return Se.EMPTY;if(this._planNode.forceMask)return[$.createSolid(O.BLACK,1)];let e=((t=this._planNode.transition)==null?void 0:t.fillPaints2(this._getEasedT))??[];return e.length==0?this._sceneNodeCursor.fillPaints():e}strokePaints(){var t;if(!(8&this._planNode.enabledTraits))return Se.EMPTY;let e=((t=this._planNode.transition)==null?void 0:t.strokePaints2(this._getEasedT))??[];return e.length==0?this._sceneNodeCursor.strokePaints():e}textDecorationFillPaints(){var t;if(!(256&this._planNode.enabledTraits))return Se.EMPTY;if(this._planNode.forceMask)return[$.createSolid(O.BLACK,1)];let e=((t=this._planNode.transition)==null?void 0:t.setTextDecorationPaints(this._getEasedT))??[];return e.length==0?this._sceneNodeCursor.textDecorationFillPaints():e}fillPaintsToRender(){return 4&this._planNode.enabledTraits?this._sceneNodeCursor.fillPaintsToRender():Se.EMPTY}videoPlayback(){return this._sceneNodeCursor.videoPlayback()}containerSupportsFillStrokeAndCorners(){return this._sceneNodeCursor.containerSupportsFillStrokeAndCorners()}isGroup(){return this._sceneNodeCursor.isGroup()}hasNonZeroStrokeWeight(){return this._sceneNodeCursor.hasNonZeroStrokeWeight()}hasPerRegionFillPaints(){return this._sceneNodeCursor.hasPerRegionFillPaints()}forEachRegionWithFillPaintBatch(e){this._sceneNodeCursor.forEachRegionWithFillPaintBatch(e)}overrideKey(){return this._sceneNodeCursor.node.overrideKey()}name(){return this._sceneNodeCursor.node.name()}getSemanticNodePath(){return this._sceneNodeCursor.getSemanticNodePath()}hasBackgroundBlurs(){return this._sceneNodeCursor.hasBackgroundBlurs()}overlayRenderData(){return this._sceneNodeCursor.overlayRenderData()}containsIndependentBordersStrokeMask(){return this._sceneNodeCursor.containsIndependentBordersStrokeMask()}generateStrokeAndStrokeMaskGeometries(e,t,n){return this._sceneNodeCursor.generateStrokeAndStrokeMaskGeometries(e,t,n)}canvasSpaceContentBounds(){return this._sceneNodeCursor.canvasSpaceContentBounds()}};function Gh(r){if(r.fillGeometry()!=null&&r.fillGeometry().regions.length!=0)return r.size();let e=r.size().x()<=.1,t=r.size().y()<=.1;if(e==t)return r.size();let n=Math.max(r.strokeWeight(),.1),o=b.new(r.size());return e?o.setX(n):o.setY(n),o}var Si=class r{constructor(){var e,t;if(arguments.length==6){let n=arguments[0],o=arguments[2];if(this._stateGroupSwapInteractionCounts=arguments[3],this._ongoingObjectAnimation=arguments[4],this._objectAnimationProgressTracker=arguments[5],this._sceneCursor=null,this._activeTransitionKey=null,this._activeTransitionIndexInParent=-1,this._planTrees=new Map,this.transitionMap=arguments[1],n.transitioningFrom!=null){let i=n.transitioningFrom.swappedStablePath.toString();this._activeTransitionKey=i;let a=this._getOrCreateSmartAnimatePlanTreeAt(n,this._activeTransitionKey);if(a!=null){let s=this.transitionMap.get(i).progress,l=this.transitionMap.get(i).change.transitionParameters;this._activeCursor=new Ai(a,n,s,l.easingFunction);return}}if(n.animationFrom&&this._ongoingObjectAnimation!=null){if(this._ongoingObjectAnimation.change.objectAnimationTargetNode(n.scene())!=n)throw new Error("Ongoing object animation target node does not match node with animatingFrom set");let i=n.id();this._activeTransitionKey=i;let a=this._getOrCreateObjectAnimationPlanTree(n,this._activeTransitionKey);if(a!=null){let s=()=>this._objectAnimationProgressTracker.progress(),l=this._ongoingObjectAnimation.change.transitionParameters;this._activeCursor=new Ai(a,n,s,l.easingFunction);return}}this._sceneCursor=new Nt(n,o),this._activeCursor=this._sceneCursor}else if(arguments.length==1){let n=arguments[0];this._sceneCursor=(e=n._sceneCursor)==null?void 0:e.clone(),this._planTrees=n._planTrees,n._activeCursor==n._sceneCursor?this._activeCursor=this._sceneCursor:this._activeCursor=(t=n._activeCursor)==null?void 0:t.clone(),this._activeTransitionKey=n._activeTransitionKey,this._activeTransitionIndexInParent=n._activeTransitionIndexInParent,this.transitionMap=n.transitionMap,this._stateGroupSwapInteractionCounts=n._stateGroupSwapInteractionCounts,this._ongoingObjectAnimation=n._ongoingObjectAnimation,this._objectAnimationProgressTracker=n._objectAnimationProgressTracker}}clone(){return new r(this)}_getOrCreateSmartAnimatePlanTreeAt(e,t){let n=this.transitionMap.get(t).change.transitionParameters;if(n.transitionType=="SMART_ANIMATE"||Rn.supportsSmartAnimate(n.transitionType)&&n.transitionShouldSmartAnimate){if(!this._planTrees.has(t)){let o=Po.getMagicMovePlanForStateSwapTransition(e.transitioningFrom.exitingTransitionRoot,e);this._planTrees.set(t,o)}return this._planTrees.get(t)}return null}_getOrCreateObjectAnimationPlanTree(e,t){if(this._planTrees.has(t))return this._planTrees.get(t)??null;if(!e.animatingFrom)throw new Error("Expected target node to have an animatingFrom node");let n=Po.getMagicMovePlanForStateSwapTransition(e.animatingFrom,e);return this._planTrees.set(t,n),n}moveToChildAt(e){if(this._activeTransitionKey==null&&this._sceneCursor!=null){let t=this._sceneCursor.node.childAt2(e,!0);if(t.transitioningFrom!=null){this._activeTransitionIndexInParent=e;let n=t.transitioningFrom.swappedStablePath.toString();this._activeTransitionKey=n;let o=this._getOrCreateSmartAnimatePlanTreeAt(t,this._activeTransitionKey);if(o!=null){let i=this.transitionMap.get(n).progress,a=this.transitionMap.get(n).change.transitionParameters;this._sceneCursor.moveToChildAt(e),this._activeCursor=new Ai(o,t,i,a.easingFunction);return}}else if(t.animatingFrom!=null&&this._ongoingObjectAnimation!=null){let n=t.id();this._activeTransitionKey=n;let o=this._getOrCreateObjectAnimationPlanTree(t,this._activeTransitionKey);if(o!=null){let i=this._ongoingObjectAnimation.change.transitionParameters,a=()=>{let s=this._objectAnimationProgressTracker.progress();return i.easingFunction?i.easingFunction.get(s):s};this._sceneCursor.moveToChildAt(e),this._activeCursor=new Ai(o,t,a,i.easingFunction);return}}}this._activeCursor.moveToChildAt(e)}moveToParent(){this._activeCursor.isRoot()?(this._sceneCursor.moveToParent(),this._activeCursor=this._sceneCursor,this._activeTransitionIndexInParent=-1,this._activeTransitionKey=null):(this._activeCursor==this._sceneCursor&&(this._activeTransitionKey=null),this._activeCursor.moveToParent())}isRoot(){return this._activeCursor.isRoot()?this._sceneCursor==null||this._sceneCursor==this._activeCursor:!1}indexInParent(){return!this.isRoot()&&this._activeCursor.isRoot()?this._activeTransitionIndexInParent:this._activeCursor.indexInParent()}renderableContentType(){return this._activeCursor==this._sceneCursor&&this._sceneCursor.node.transitioningFrom!=null?mr.RenderableContentType.CUSTOM_RENDER_TREE:this._activeCursor.renderableContentType()}isFrameLike(){return this._activeCursor==this._sceneCursor&&this._sceneCursor.node.transitioningFrom!=null?!1:this._activeCursor.isFrameLike()}isTopLevel(){return this._activeTransitionKey!=null||this._sceneCursor==null?!1:this._sceneCursor.node.isTopLevel()}paintsDebugString(){return`PlaybackCursor ${this._sceneCursor.node.paintsDebugString()}`}willChange(){return this._activeCursor.willChange()}shouldOptimizeShadowForAnimation(e){return this._activeCursor.shouldOptimizeShadowForAnimation(e)}customRenderTree(e){if(this._sceneCursor==this._activeCursor&&this._sceneCursor.node.transitioningFrom!=null){let t=this.transitionMap.get(this._activeTransitionKey).progress,n=this.transitionMap.get(this._activeTransitionKey).change,o=n.transitionParameters,i=Tr.get(o.transitionType);n.direction==1&&(i=i.reversed());let a=this._sceneCursor.node,s=a.transitioningFrom.exitingTransitionRoot,l=h=>S=>rt.forTranslation(rt.forOpacity(S,ft.forAnimateableOpacity(a.id()),()=>h.interpolateOpacity(t())),ft.forAnimateableTranslation(a.id()),()=>p.multiply(h.interpolateTranslation(t()))),d=ye.generateRenderTree(new Ks(a,this.overlayRenderData(),l(i.enteringFrameTransition())),e),c=ye.generateRenderTree(new Ks(s,this.overlayRenderData(),l(i.exitingFrameTransition()),a,s),e),p=a.size().max(s.size()),u=null;d!=null&&(u=d),u!=null?(u=rt.forOpacity(u,ft.forAnimateableOpacity(a.id()),()=>i.enteringFrameTransition().interpolateOpacity(t())),u=rt.forTranslation(u,ft.forAnimateableTranslation(a.id()),()=>p.multiply(i.enteringFrameTransition().interpolateTranslation(t())))):u=new ke([]);let _=null;if(c!=null&&(_=c),_!=null?(_=rt.forOpacity(_,ft.forAnimateableOpacity(s.id()),()=>i.exitingFrameTransition().interpolateOpacity(t())),_=rt.forTranslation(_,ft.forAnimateableTranslation(s.id()),()=>p.multiply(i.exitingFrameTransition().interpolateTranslation(t())))):_=new ke([]),i.isDissolve()){let h=ft.forAnimateableDissolve(a.id());return new cn(_,u,h,t)}else return i.drawsEnteringFrameOnTopOfExitingFrame()?ke.wrap([_,u]):ke.wrap([u,_])}return this._activeCursor.customRenderTree(e)}name(){return this._activeCursor.name()}scene(){return this._activeCursor.scene()}parent(){if(this.isRoot())return null;let e=this.clone();return e.moveToParent(),e}blendMode(){return this._activeCursor.blendMode()}opacity(){return this._activeCursor.opacity()}visible(){return this._activeCursor.visible()}isVisibleMask(){return this._activeCursor.isVisibleMask()}maskType(){return this._activeCursor.maskType()}isSpreadEligibleNode(){return this._activeCursor.isSpreadEligibleNode()}type(){return this._activeCursor.type()}childCount(){return this._activeCursor.childCount()}absoluteTransform(){return this._activeCursor.absoluteTransform()}maxTransformScale(){return this._activeCursor.maxTransformScale()}clipsChildren(){return this._activeCursor.clipsChildren()}stopsMaskPropagation(){return this._activeCursor.stopsMaskPropagation()}arcData(){return this._activeCursor.arcData()}isRoundedRect(){return this._activeCursor.isRoundedRect()}roundedRectInfo(){return this._activeCursor.roundedRectInfo()}fillGeometry(){return this._activeCursor.fillGeometry()}strokeGeometry(){return this._activeCursor.strokeGeometry()}fillGeometryForSpread(e,t,n){return this._activeCursor.fillGeometryForSpread(e,t,n)}strokeGeometryForSpread(e,t,n,o){return this._activeCursor.strokeGeometryForSpread(e,t,n,o)}size(){return this._activeCursor.size()}strokeAlign(){return this._activeCursor.strokeAlign()}strokeWeight(){return this._activeCursor.strokeWeight()}hasDefaultStrokeParameters(){return this._activeCursor.hasDefaultStrokeParameters()}strokeJoin(){return this._activeCursor.strokeJoin()}setStrokeJoin(e){this._activeCursor.setStrokeJoin(e)}strokeMiterLimit(){return this._activeCursor.strokeMiterLimit()}setStrokeMiterLimit(e){this._activeCursor.setStrokeMiterLimit(e)}uniqueIdentifier(){return this._activeCursor.uniqueIdentifier()}isInsideOutlineMask(){return this._activeCursor.isInsideOutlineMask()}textData(){return this._activeCursor.textData()}derivedTextData(){return this._activeCursor.derivedTextData()}textGeometry(){return this._activeCursor.textGeometry()}getCachedRenderTree(){return this._activeCursor.getCachedRenderTree()}_shouldPreemptivelyMarkAsVolatile(){if(Y.shouldPreventVolatileCaching())return!1;let e=this._sceneCursor.node.canvas().parent().scene(),t=this._sceneCursor.node;if(!t.isInstance())return!1;let n=Y.viewerICCacheOpt();if(!n&&t.stablePath().guids.length>1+1)return!1;let i=t.getBackingSymbolParent();return i==null||!i.isStateGroup()?!1:n?this._stateGroupSwapInteractionCounts.get(i.id(),0)>0:!0}renderTree(){if(this._sceneCursor==null){let e=new ye.GenerateArgs(ye.RenderMode.NORMAL);return ye.generateRenderTree(this.clone(),e)}else if(this._activeCursor==this._sceneCursor){let e=this._sceneCursor.node.renderTree2(this);return this._shouldPreemptivelyMarkAsVolatile()&&e!=null?rt.forStateSwap(e):e}else{if(this._activeCursor.isRoot())return this._sceneCursor.node.renderTree2(this);{let e=new ye.GenerateArgs(ye.RenderMode.NORMAL);return ye.generateRenderTree(this.clone(),e)}}}renderTreeWithoutBackgroundBlurs(){return this._activeCursor.renderTreeWithoutBackgroundBlurs()}renderTreeForShadowRoot(){if(this._sceneCursor!=null&&(this._activeCursor==this._sceneCursor||this._activeCursor.isRoot()))return this._sceneCursor.node.renderTreeForShadowRoot2(this);{let e=new ye.GenerateArgs(ye.RenderMode.SHADOW,this.uniqueIdentifier());return ye.generateRenderTree(this.clone(),e)}}renderTreeForShadowDescendant(){if(this._sceneCursor!=null&&(this._activeCursor==this._sceneCursor||this._activeCursor.isRoot()))return this._sceneCursor.node.renderTreeForShadowDescendant2(this);{let e=new ye.GenerateArgs(ye.RenderMode.SHADOW);return ye.generateRenderTree(this.clone(),e)}}renderTreeForKnockoutShadowRoot(){if(this._sceneCursor!=null&&(this._activeCursor==this._sceneCursor||this._activeCursor.isRoot()))return this._sceneCursor.node.renderTreeForKnockoutShadowRoot2(this);{let e=new ye.GenerateArgs(ye.RenderMode.KNOCKOUT_SHADOW,this.uniqueIdentifier());return ye.generateRenderTree(this.clone(),e)}}renderTreeForKnockoutShadowDescendant(){if(this._sceneCursor!=null&&(this._activeCursor==this._sceneCursor||this._activeCursor.isRoot()))return this._sceneCursor.node.renderTreeForKnockoutShadowDescendant2(this);{let e=new ye.GenerateArgs(ye.RenderMode.KNOCKOUT_SHADOW);return ye.generateRenderTree(this.clone(),e)}}renderTreeForSlideThumbnail(){if(this._sceneCursor!=null&&(this._activeCursor==this._sceneCursor||this._activeCursor.isRoot()))return this._sceneCursor.node.renderTreeForSlideThumbnail2(this);{let e=new ye.GenerateArgs(ye.RenderMode.SLIDE_THUMBNAIL);return ye.generateRenderTree(this.clone(),e)}}isFixed(){return this._activeCursor.isFixed()}isStandardScrolling(){return this._activeCursor.isStandardScrolling()}isStickyScrolling(){return this._activeCursor.isStickyScrolling()}scrollOffset(){return this._activeCursor.scrollOffset()}scrollSpeedMultiplier(){return this._activeCursor.scrollSpeedMultiplier()}scrollDirection(){return this._activeCursor.scrollDirection()}hasOverflowingContentInScrollDirection(){return this._activeCursor.hasOverflowingContentInScrollDirection()}effects(){return this._activeCursor.effects()}fillPaints(){return this._activeCursor.fillPaints()}textDecorationFillPaints(){return this._activeCursor.textDecorationFillPaints()}strokePaints(){return this._activeCursor.strokePaints()}fillPaintsToRender(){return this._activeCursor.fillPaintsToRender()}videoPlayback(){return this._activeCursor.videoPlayback()}containerSupportsFillStrokeAndCorners(){return this._activeCursor.containerSupportsFillStrokeAndCorners()}isGroup(){return this._activeCursor.isGroup()}hasNonZeroStrokeWeight(){return this._activeCursor.hasNonZeroStrokeWeight()}hasPerRegionFillPaints(){return this._activeCursor.hasPerRegionFillPaints()}forEachRegionWithFillPaintBatch(e){this._activeCursor.forEachRegionWithFillPaintBatch(e)}overrideKey(){return this._activeCursor.overrideKey()}getSemanticNodePath(){return gr.getSemanticNodePathHelper(this)}hasBackgroundBlurs(){return this._activeCursor.hasBackgroundBlurs()}overlayRenderData(){return this._activeCursor.overlayRenderData()}containsIndependentBordersStrokeMask(){return this._activeCursor.containsIndependentBordersStrokeMask()}generateStrokeAndStrokeMaskGeometries(e,t,n){return this._activeCursor.generateStrokeAndStrokeMaskGeometries(e,t,n)}canvasSpaceContentBounds(){return this._activeCursor.canvasSpaceContentBounds()}};var Uh=class Uh{static initialize(e){Uh.safeModeOptions=e}};Uh.safeModeOptions=null;var Ac=Uh;var pn=class r{willStartTransitionWithDuration(e){this._durationSeconds=e,this._elapsedSeconds=0,this._timeOfLastTransitionFrame=Me.seconds(),this._timeOfTransitionStart=this._timeOfLastTransitionFrame,this.frameTimesMs.length=0,this._progressAtStart=0,this._lastProgress=0}transitionEnded(){this._lastProgress=-1,this._progressType=r.ProgressType.FORWARD,this._externalOnTickProgress=null;let e=this._externalOnTransitionEnded;return this._externalOnTransitionEnded=null,e!=null?e():r.TransitionEndedAction.COMMIT}isTransitionInProgress(){return this.isProgressControlledExternally()?!0:this._progressType==r.ProgressType.REVERSE?0<this._lastProgress&&this._lastProgress<=1:0<=this._lastProgress&&this._lastProgress<1}duration(){return this._durationSeconds}progress(){return this._lastProgress}isProgressControlledExternally(){return this._progressType==r.ProgressType.EXTERNAL}pinProgressToRealTimeWithDuration(e,t,n){this._progressAtStart=e,this._durationSeconds=t,this._progressType=n?r.ProgressType.REVERSE:r.ProgressType.FORWARD,this._elapsedSeconds=0,this._timeOfLastTransitionFrame=Me.seconds(),this._timeOfTransitionStart=this._timeOfLastTransitionFrame,this.frameTimesMs.length=0}pinProgressToExternalControl(e,t){this._externalOnTickProgress=e,this._externalOnTransitionEnded=t,this._progressType=r.ProgressType.EXTERNAL,this._timeOfTransitionStart=Me.seconds(),this.frameTimesMs.length=0}advanceToNextFrame(){if(this.isProgressControlledExternally())this._lastProgress=this._externalOnTickProgress();else if(this._durationSeconds>0){let e=Me.seconds(),t=e-this._timeOfLastTransitionFrame;this.frameTimesMs.push(1e3*t),t=Math.min(t,1/30),this._elapsedSeconds+=t,this._timeOfLastTransitionFrame=e;let n=this._progressType==r.ProgressType.REVERSE?-1:1;this._lastProgress=sr.Math_clamp(n*this._elapsedSeconds/this._durationSeconds+this._progressAtStart,0,1)}else this._lastProgress=this._progressType==r.ProgressType.REVERSE?0:1}constructor(){this._lastProgress=-1,this._durationSeconds=-1,this._elapsedSeconds=-1,this._timeOfLastTransitionFrame=-1,this._progressAtStart=0,this._timeOfTransitionStart=-1,this.frameTimesMs=[],this._progressType=r.ProgressType.FORWARD,this._externalOnTickProgress=null,this._externalOnTransitionEnded=null}};(t=>{let r;(a=>(a[a.FORWARD=0]="FORWARD",a[a.REVERSE=1]="REVERSE",a[a.EXTERNAL=2]="EXTERNAL"))(r=t.ProgressType||(t.ProgressType={}));let e;(i=>(i[i.ABORT=0]="ABORT",i[i.COMMIT=1]="COMMIT"))(e=t.TransitionEndedAction||(t.TransitionEndedAction={}))})(pn||(pn={}));var dl;(t=>{function r(n,o){n(o)}t.applyTo=r;function e(n){return n}t._new=e})(dl||(dl={}));var Vh=class{constructor(e){this._dragToAnimateBehavior=null,this._canvasView=null,this._canvasView=e}clearDrag(e){this._dragToAnimateBehavior==e&&(this._canvasView.removeInteractionObserver(this._dragToAnimateBehavior),this._dragToAnimateBehavior=null)}removeFrom(e){this.clearDrag(this._dragToAnimateBehavior)}getTransitionMixin(e,t,n){let o=t.interactionAddress.hotspotStablePath!=null?e.findNodeByStablePath(t.interactionAddress.hotspotStablePath):null;if(o==null)return null;switch(t.cause){case 5:{if(!n&&$e.getControlSource(t.cause)!=0){let i=dr.computeDragVector2(t,o,e);if(i!=null&&i.length()>0)return dl._new(a=>{this._dragToAnimateBehavior!=null&&this.clearDrag(this._dragToAnimateBehavior),this._dragToAnimateBehavior=new dr(this,i,a,t.easingFunction()),this._canvasView.addInteractionObserver(this._dragToAnimateBehavior)})}break}}return null}getTransitionMixinForStateSwap(e,t,n){switch(t.cause){case 5:{if(!n&&$e.getControlSource(t.cause)!=0){let o=dr.computeDragVectorForStateSwap(t,e);if(o!=null&&o.length()>0)return dl._new(i=>{this._dragToAnimateBehavior!=null&&this.clearDrag(this._dragToAnimateBehavior),this._dragToAnimateBehavior=new dr(this,o,i,t.easingFunction()),this._canvasView.addInteractionObserver(this._dragToAnimateBehavior)})}break}}return null}},$i=class $i{static computeOverlaySwipeDragVector(e,t,n){let o=n.size(),i=e.drawsEnteringFrameOnTopOfExitingFrame()?e.enteringFrameTransition():e.exitingFrameTransition();return o.multiply(i.to().translation1().subtract(i.from().translation1()))}static computeScreenSwipeDragVector(e,t,n){let o=t.size().max(n.size()),i=e.drawsEnteringFrameOnTopOfExitingFrame()?e.enteringFrameTransition():e.exitingFrameTransition();return o.multiply(i.to().translation1().subtract(i.from().translation1()))}static computeSmartAnimateDragVector(e,t,n){if(t!=null&&n!=null&&e!=null){let o=Po.getNodeMatches(t,n),i=Ge.StringMap_get(o,e.id(),null);if(i!=null){let a=t.absoluteTransform().inverse().multipliedBy1(e.absoluteTransform()).transformPoint(e.size().divideScalar(2));return n.absoluteTransform().inverse().multipliedBy1(i.absoluteTransform()).transformPoint(i.size().divideScalar(2)).subtract(a)}}return null}static computeDragVectorImpl(e,t,n,o,i,a,s){if(e==null)return null;if(t!=null&&n!=null){if(i=="SMART_ANIMATE"||Rn.supportsSmartAnimate(i)&&s){let c=$i.computeSmartAnimateDragVector(e,t,n);if(c!=null&&c.length()>0)return c}if(["DISSOLVE","INSTANT_TRANSITION","SMART_ANIMATE"].indexOf(i)==-1){let c=Tr.get(i);o==1&&(c=c.reversed());let p=null;if(["OVERLAY","SWAP"].indexOf(a)!=-1?p=$i.computeOverlaySwipeDragVector(c,t,n):p=$i.computeScreenSwipeDragVector(c,t,n),p.length()>0)return p}}return null}static computeDragVector1(e,t,n,o,i){if(e==null||t==null)return null;let a=null;for(let h of t.allActions())if(["INTERNAL_NODE","BACK","CLOSE"].indexOf(h.connectionType())!=-1){a=h;break}if(a==null)return null;let s=a.connectionType(),l=null,d=null,c=a.transitionShouldSmartAnimate(),p=0,u=n,_=null;if(s=="INTERNAL_NODE")if(d=a.navigationType(),l=a.transitionType(),d=="SWAP_STATE"){let h=Gt.whichInstanceToSwap(e,a.transitionNodeID());h!=null&&(u=h,_=e.scene().findNode(a.transitionNodeID()))}else d=="SWAP"&&(u=e.topLevelAncestor()),_=o.getDestinationFrame(a.transitionNodeID());else if(s=="BACK"){let h=i.getPreviousNonTransientChange();if(h==null)return null;_=o.getDestinationFrame(h.oldStateId()),l=h.transitionParameters.transitionType,d="NAVIGATE",p=1}else if(s=="CLOSE"){_=e.topLevelAncestor();let h=i.getOpenOverlayData(_.id());if(h==null)return null;l=h.openingTransitionType(),d="OVERLAY",p=1}return $i.computeDragVectorImpl(e,u,_,p,l,d,c)}static computeDragVector2(e,t,n){let o=null,i=null;if(e.oldStateId()==e.newStateId()&&e.oldOverlayData().length>0&&e.oldOverlayData().length==e.newOverlayData().length){let s=e.oldOverlayData()[e.oldOverlayData().length-1],l=e.newOverlayData()[e.newOverlayData().length-1];o=n.findNode(s.id),i=n.findNode(l.id)}else if(o=n.findNode(e.oldStateId()),e.transitionParameters.navigationType=="OVERLAY"){let s=e.direction==1?e.getRemovedFrameIds():e.getInsertedFrameIds();i=n.findNode(s[0])}else i=n.findNode(e.newStateId());return $i.computeDragVectorImpl(t,o,i,e.direction,e.transitionParameters.transitionType,e.transitionParameters.navigationType,e.transitionParameters.transitionShouldSmartAnimate)}static computeDragVectorForStateSwap(e,t){var a,s;let n=t.findNodeByStablePath(e.stablePath),o=(a=n==null?void 0:n.transitioningFrom)==null?void 0:a.exitingTransitionRoot,i=(s=n==null?void 0:n.transitioningFrom)==null?void 0:s.hotspotInExitingTree;return $i.computeDragVectorImpl(i,o,n,e.direction,e.transitionParameters.transitionType,e.transitionParameters.navigationType,e.transitionParameters.transitionShouldSmartAnimate)}constructor(e,t,n,o){var i;this._dragStartPosition=null,this._currPointerPosition=null,this._lastPointerPosition=null,this._currPointerTime=-1,this._lastPointerTime=-1,this._didRecordPointerPosition=!1,this._pointerVelocity=null,this._shouldRevertTransition=!1,this._behaviorManager=null,this._dragVector=null,this._easingFunction=null,this._transitionProgress=null,this._lastPointerTime=Me.seconds(),this._behaviorManager=e,this._dragVector=t,this._easingFunction=o,this._transitionProgress=n,(i=this._transitionProgress)==null||i.pinProgressToExternalControl(()=>this.onTickProgress(),()=>this.onTransitionEnded())}handleDrag(e){this._lastPointerTime=this._currPointerTime,this._lastPointerPosition=this._currPointerPosition,this._currPointerTime=Me.seconds(),this._currPointerPosition=e,this._didRecordPointerPosition=!0}handleDragStart(e){this._dragStartPosition=e}handleRelease(e){if(this._transitionProgress!=null&&this._transitionProgress.isProgressControlledExternally()){let t=this._transitionProgress.progress(),n=this._easingFunction!=null?this._easingFunction.invert(t):t,o=this.signedDragSpeed(),i=this._transitionProgress.duration(),a=i>0?$i.DRAG_SPEED_THRESHOLD_MULTIPLE/i:0,s=o>=a,l=o<=-a;this._shouldRevertTransition=!1,t>=.5?this._shouldRevertTransition=l:this._shouldRevertTransition=!s;let d=1;if(this._shouldRevertTransition&&(d=sr.Math_clamp(Math.log(n+.5)/Math.log(2)+1,.02,1)),Math.abs(o)>=1/i){let c=this._easingFunction!=null?this._easingFunction.getDerivative(n,o):1;d=Math.abs(o/c)}this._transitionProgress.pinProgressToRealTimeWithDuration(n,i/d,this._shouldRevertTransition)}}onTickProgress(){if(this._dragVector!=null){if(this._currPointerPosition!=null&&this._dragStartPosition!=null){if(this._lastPointerPosition!=null&&this._lastPointerTime!=-1){let n=this._currPointerTime;this._didRecordPointerPosition||(this._lastPointerTime=this._currPointerTime,this._lastPointerPosition=this._currPointerPosition,n=Me.seconds(),this._currPointerTime=n),this._pointerVelocity=this._currPointerPosition.subtract(this._lastPointerPosition).divideScalar(n-this._lastPointerTime)}let e=this._currPointerPosition.subtract(this._dragStartPosition),t=sr.Math_clamp(e.dot(this._dragVector)/Math.pow(this._dragVector.length(),2),0,1);return this._didRecordPointerPosition=!1,t}return this._didRecordPointerPosition=!1,0}return this._didRecordPointerPosition=!1,1}onTransitionEnded(){return this._dragStartPosition=null,this._dragVector=null,this._easingFunction=null,this._transitionProgress=null,this._behaviorManager!=null&&this._behaviorManager.clearDrag(this),this._shouldRevertTransition?pn.TransitionEndedAction.ABORT:pn.TransitionEndedAction.COMMIT}signedDragSpeed(){return this._pointerVelocity==null||this._dragVector==null?0:this._dragVector.length()>0?this._pointerVelocity.dot(this._dragVector)/Math.pow(this._dragVector.length(),2):0}};$i.DRAG_SPEED_THRESHOLD_MULTIPLE=.15;var dr=$i;var Sc=ml(wc());var Su=class{constructor(){if(arguments[0]==0){let[,e]=arguments;this.ws=null,this.ws=e}else if(arguments[0]==1){let[,e]=arguments;this.ws=null,this.ws=new WebSocket(e)}}url(){return this.ws.url}readyState(){return this.ws.readyState}setBinaryType(e){this.ws.binaryType=e}binaryType(){return this.ws.binaryType}setOnclose(e){this.ws.onclose=t=>{e(t)}}setOnerror(e){this.ws.onerror=t=>{e(t)}}setOnmessage(e){this.ws.onmessage=t=>{e(new uA(t))}}setOnopen(e){this.ws.onopen=t=>{e(t)}}close(){this.ws.close()}send1(e){this.ws.send(e)}send2(e){this.ws.send(e)}equals(e){var t;return this.ws==((t=e==null?void 0:e.asHTMLSocket())==null?void 0:t.ws)}asHTMLSocket(){return this}asMockSocket(){return null}},kh=class kh{simulateDidOpen(){if(this._readyState=Fo.Socket_OPEN,this._onopen!=null){let e={meta:"Fake open event for testing"};this._onopen(e)}}simulateDidClose(){if(this._readyState=Fo.Socket_CLOSED,this._onclose!=null){let e={meta:"Fake close event for testing"};this._onclose(e)}}simulateMessage(e){this._onmessage!=null&&this._onmessage(e)}url(){return kh.FAKE_URL}readyState(){return this._readyState}setBinaryType(e){this._binaryType=e}binaryType(){return this._binaryType}setOnclose(e){this._onclose=e}setOnerror(e){this._onerror=e}setOnmessage(e){this._onmessage=e}setOnopen(e){this._onopen=e}close(){this._readyState=Fo.Socket_CLOSING}send1(e){if(this._readyState!=Fo.Socket_OPEN)throw new Error("Failed to execute 'send' on 'WebSocket': Still in CONNECTING state.");this.sent.push(new Uint8Array(e))}send2(e){if(this._readyState!=Fo.Socket_OPEN)throw new Error("Failed to execute 'send' on 'WebSocket': Still in CONNECTING state.");this.sent.push(new Uint8Array(e.buffer,e.byteOffset,e.byteLength))}equals(e){return(e==null?void 0:e.asMockSocket())==this}asHTMLSocket(){return null}asMockSocket(){return this}constructor(){this._readyState=Fo.Socket_CONNECTING,this._binaryType="blob",this._onclose=null,this._onerror=null,this._onmessage=null,this._onopen=null,this.sent=[]}};kh.FAKE_URL="ws://fake_url_for_tests_value_does_not_matter.com";var dA=kh;var uA=class{isArrayBuffer(){return this.messageEvent.data[Symbol.toStringTag]==="ArrayBuffer"}isBlob(){return this.messageEvent.data instanceof Blob}isString(){return typeof this.messageEvent.data=="string"}dataAsArrayBuffer(){return this.messageEvent.data}dataAsBlob(){return this.messageEvent.data}dataAsString(){return this.messageEvent.data}constructor(e){this.messageEvent=e}},Fo;(o=>(o.Socket_CONNECTING=0,o.Socket_OPEN=1,o.Socket_CLOSING=2,o.Socket_CLOSED=3))(Fo||(Fo={}));var ur=class ur{static logVerbose(e){ur.VERBOSE_LOGS&&console.log("[IncrementalFrameLoader]",e())}static MAX_SLIDESHOW_PRELOAD_DISTANCE(){return 2}constructor(e,t){this._multiplayer=null,this._appState=null,this._emitter=null,this._canvas=null,this._currentQueries=new Pa,this._previousSceneGraphReply=new Pa,this._rootLevelSceneGraphQuery=Nr.create(X._new(0,0),1),this._requestedTlfIds=new Dn,this._currentTlfIds=[],this._requestedSectionsQueue=[],this._bfsOrderWorkingSet=[],this._pendingNodeToRequest=null,this._multiplayer=t,this._multiplayer.addObserver(this),this._appState=e,e.addAppObserver(this),e.prototypeState().addObserver(this),this._emitter=Kt.getEventEmitter(),this._emitter.on("slowIncrementalLoad",n=>{Ae.trackEvent("Slow incremental load",n)})}dangerouslySetLoadFullDocument(e){this._setLoadFullDocument(e)}setLoadFullDocumentForTests(e){this._setLoadFullDocument(e)}_setLoadFullDocument(e){e?this._rootLevelSceneGraphQuery=Nr.create(X._new(0,0),0):this._rootLevelSceneGraphQuery=Nr.create(X._new(0,0),1)}simulateRepliedQueriesForTests(e){this._currentQueries=Pa.fromList(e),this.handleSceneGraphReply(0,e)}requestTlf(e){return this._setCurrentTlfIds([e]),this._isFullyLoaded(e)?!0:(this._requestedTlfIds.add(e),this._redeferUpdate(0),!1)}_setCurrentTlfIds(e){this._currentTlfIds=e}_requestTlfs(e){this._setCurrentTlfIds(e);for(let t of e){if(this._isFullyLoaded(t)){this._appState.requestedFrameMetricsTracker().track(t,{wasAlreadyLoaded:!0,wasAlreadyInWorkingSet:!0});continue}else{let n={wasAlreadyLoaded:!1,wasAlreadyInWorkingSet:!1};for(let o of this._bfsOrderWorkingSet)if(o.nodeId==t){n.wasAlreadyInWorkingSet=!0;break}this._appState.requestedFrameMetricsTracker().track(t,n)}this._requestedTlfIds.add(t),this._redeferUpdate(0)}}_isFullyLoaded(e){var o;let t=(o=this._multiplayer.scene())==null?void 0:o.findNode(e);if(t==null)return!1;let n=t;for(;n!=null;){if(this._previousSceneGraphReply.containsExactQuery(Nr.create(n.id(),0)))return!0;n=n.parent()}return!1}_isQueryPresent(e,t){for(let n of t)if(an.equals(n,e))return!0;return!1}_getQueriesToLoad(){let e=new Pa;return this._addRequestedTlfs(e),this._appState.scene()!=null&&this._addScreenAdjacencies(e),e}_addRequestedTlfs(e){var t;ur.logVerbose(()=>"Visiting requestedTlfs for next queries:"+this._requestedTlfIds.asList().join(","));for(let n of this._requestedTlfIds.asList()){let o=X.fromString(n);if(o==null)continue;if(!this._previousSceneGraphReply.containsNodeById(o)){e.add(Nr.create(o,1));continue}let a=(t=this._multiplayer.scene())==null?void 0:t.findNode(o);if(this._requestedTlfIds.remove(o),a==null){let s=X._new(0,0);e.add(Nr.create(s,1)),this._requestedTlfIds.add(s);let l=this._multiplayer.scene().firstUserCanvasOrNull();if(l==null){console.error("No user-visible canvases");continue}this._requestedTlfIds.add(l.id()),e.add(Nr.create(l.id(),1))}else if(a.type()=="DOCUMENT"){this._emitter.trigger("redirectingToFirstPageDueToInvalidStartNode");let s=this._multiplayer.scene().firstUserCanvasOrNull();if(s==null){console.error("No user-visible canvases");continue}this._requestedTlfIds.add(s.id()),e.add(Nr.create(s.id(),1))}else if(a.type()=="CANVAS"){let s=this._appState.prototypeStructure().nodeToRestartPrototypeOn(a);if(s==null)continue;this._requestedTlfIds.add(s.id()),e.add(Nr.create(s.id(),0)),this._setCurrentTlfIds([s.id()])}else{for(;a!=null&&!a.isTopLevel();)a=a.parent();a!=null&&(e.add(Nr.create(a.id(),0)),this._canvas=a.findContainingCanvasOrParent(),e.add(Nr.create(this._canvas.id(),1)))}}}_addScreenAdjacencies(e){Y.getViewerMode()==Y.ViewerMode.PROTOTYPE&&this._appState.prototypeStructure().isLinear()&&this._addScreenAdjacenciesForLinearPrototype(e),this._addScreenAdjacenciesForPrototype(e)}_getMaxBFSDistance(){return Pt.isCurrentOSMobileOrIPad()?ur.MOBILE_MAX_PROTOTYPE_BFS_DEPTH:ur.DEFAULT_MAX_PROTOTYPE_BFS_DEPTH}_getMaxBFSCount(){return Pt.isCurrentOSMobileOrIPad()?ur.MOBILE_MAX_PROTOTYPE_BFS_COUNT:ur.DEFAULT_MAX_PROTOTYPE_BFS_COUNT}_addScreenAdjacenciesForLinearPrototype(e){let t=this._appState.prototypeStructure().topLevelPrototypeNodesInOrder();if(!this._currentTlfIds.length||!X.isValid(this._currentTlfIds[0]))return;let n=t.indexOf(this._currentTlfIds[0]);if(!(n<0)){for(let o=n-ur.MAX_SLIDESHOW_PRELOAD_DISTANCE(),i=n+ur.MAX_SLIDESHOW_PRELOAD_DISTANCE()+1;o<i;o=o+1)o>=0&&o<t.length&&e.add(Nr.create(t[o],0));if(this._currentTlfIds.length>1)for(let o=1,i=this._currentTlfIds.length;o<i;o=o+1)X.isValid(this._currentTlfIds[o])&&e.add(Nr.create(this._currentTlfIds[o],0))}}_addScreenAdjacenciesForPrototype(e){if(this._currentTlfIds.length==0||!X.isValid(this._currentTlfIds[0]))return;let t=new ur.Queue;for(let l=this._currentTlfIds.length-1;l>=0;l=l-1)t.pushBackIfUnseen(this._currentTlfIds[l],0);let n=0;this._bfsOrderWorkingSet=[];let o=this._appState.prototypeStructure().nodeTransitionTracker().cleanedUpTransitionMapByTLF();for(;t.nonempty()&&(t.front().depth<=1||n<this._getMaxBFSCount());){let l=t.popFront(),d=l.guid,c=this._previousSceneGraphReply.containsExactQuery(Nr.create(d,0));this._bfsOrderWorkingSet.push(new ur.WorkingSetItem(d,c));let p=this._appState.scene().findNode(d);if(p==null||(l.depth>0&&(n=n+1),l.depth>=this._getMaxBFSDistance()))continue;let u=Yt.adjacentBaseScreens(o,p);yn(p,_=>{var h;if(_.isInstance()&&!_.isPrimaryInstance()&&_.getBoundVariables().componentProperties){let S=this._appState.scene().findNode(_.symbolID());if(S!=null){let m=S.parent();m.isStateGroup()&&(u.add(m.id()),_.invalidateRenderTreeForSelfAndParents(),_.invalidateRenderTreeForChildren())}}(h=_.prototypeInteractions())==null||h.forEach(S=>{for(let m of S.allActions())if(X.isValid(m.transitionNodeID())&&u.add(m.transitionNodeID()),m.connectionType()=="BACK"){let f=this._appState.prototypeState().getLastChangeInHistory();f!=null&&f.getRemovedFrameIds().forEach(T=>{T!=null&&u.add(T)})}}),Y.getFeatureFlags().viewer_ifl_enhancements&&Yt.isNodeInteractableBecauseOfHyperlinks(_)&&_.textHyperlinkBoxes().forEach(S=>{S.guid&&u.add(X.fromFigGUID(S.guid))})});for(let _ of u.asList())t.pushBackIfUnseen(_,l.depth+1)}Ae.trackDefinedEvent("prototype.ifl_nodes_loaded_count",{nodesLoadedCount:n,enforcePrototypeSecurityBoundaries:this._appState.prototypeSecurityBoundariesEnforced});let i=this._appState.prototypeState().getInitiatedChange();if(i!=null)for(let l of i.oldStateAndOverlays.statesAndOverlaysIncluded()){let d=X.fromString(l);this._bfsOrderWorkingSet.unshift(new ur.WorkingSetItem(d,this._previousSceneGraphReply.containsExactQuery(Nr.create(d,0))))}Rr.trackNumber("[IFL] Working set size",this._bfsOrderWorkingSet.length);let a=0,s=0;for(let l of this._bfsOrderWorkingSet)if(e.add(Nr.create(l.nodeId,0)),l.isAlreadySubscribed?s=s+1:a=a+1,a>=ur.MAX_PROTOTYPE_TLF_BATCH_SIZE)break;Rr.trackNumber("[IFL] Working set frames loaded",s)}getMetricsForNode(e){return this._appState.requestedFrameMetricsTracker().getMetricsForRequestedNode(e.id())}_requestNextQueriesToLoad(e){var n;if(e.add(this._rootLevelSceneGraphQuery),e.equals(this._currentQueries))return;Y.protoUseFrameEviction()?(this._multiplayer.scene()!=null&&(this._currentQueries.each(i=>{let a=this._multiplayer.scene().findNode(Ya.toString(i.startingNode));a!=null&&(a.type()=="DOCUMENT"||a.type()=="CANVAS")&&e.add(i)}),((n=N())==null?void 0:n.getChangedVariables()).forEach(i=>{e.add(Nr.create(i,0))})),this._currentQueries=e):e.each(o=>{this._currentQueries.add(o)});let t=[];for(let o of this._currentQueries.asList())t.push(o);ur.logVerbose(()=>"setting scene graph queries:"+t.map(o=>an.toString(o)).join(",")),this._multiplayer.setSceneGraphQueries(t)}_redeferUpdate(e){this._deferredUpdate!==void 0?this._deferredUpdate.redefer(e):this._deferredUpdate=new Tu(()=>{ur.logVerbose(()=>`update............
`+(ur.VERBOSE_LOGS_SHOW_SCENEGRAPH?this._multiplayer.scene().root().hierarchyString():"")),this._requestNextQueriesToLoad(this._getQueriesToLoad()),this._deferredUpdate=void 0},e)}handleSceneChange(e,t){e!=null&&e.removeObserver(this),t!=null&&t.addObserver(this),this._redeferUpdate(0)}handleActiveCanvasChange(e,t){this._redeferUpdate(0)}handleActivePrototypeStartingPointChange(e,t){}handleStateChangeAborted(e){}handleStateChangeCommitted(e,t){}handleStateChangeInitiated(e){this._redeferUpdate(0)}handleStateChangeRequested(e){let t=e.newStateAndOverlays.statesAndOverlaysIncluded(),n=[];for(let o of t)n.push(X.fromString(o));this._requestTlfs(n)}handleFitModeChange(e,t){}handleRestartPrototype(){}handleConnect(e,t){e==0&&(this._previousSceneGraphReply=new Pa,this._currentQueries=new Pa,this._redeferUpdate(0),Y.getViewerMode()==Y.ViewerMode.PROTOTYPE&&t==null&&(t=X._new(0,0)),t!=null&&(this._pendingNodeToRequest=t))}handleDisconnect(){}handleJoinStart(e,t,n){this._pendingNodeToRequest!=null&&this.requestTlf(this._pendingNodeToRequest),this._pendingNodeToRequest=null}handleJoinEnd(){}handlePresenterChange(){}handleNodeChanges(){}handleSceneChangedLoadingPhase(e,t){}handleSceneGraphReply(e,t){Ae.handleMultiplayerFirstResponse(),ur.logVerbose(()=>{let a="";return a+=`
-----handleSceneGraphReply-----
`,a+="sceneGraphQueries:"+t.map(s=>an.toString(s)).join(",")+`
`,ur.VERBOSE_LOGS_SHOW_SCENEGRAPH&&(a+=this._multiplayer.scene().root().hierarchyString()+`
`),a+="-----------------------------------",a}),this._previousSceneGraphReply=Pa.fromList(t);let n=this._getQueriesToLoad(),o=t.some(a=>Nr.isUnlimitedRootQuery(a));n.isSubsetOf(this._previousSceneGraphReply)||o?(Ae.handleMultiplayerIFLSatisfied(),ur.logVerbose(()=>"All queries satisfied! Calling finishIncrementalLoading..."),this._multiplayer.finishIncrementalLoading(),Ae.handleIFLCompleted()):this._requestNextQueriesToLoad(n)}handleSceneGraphEvent(e){if(zn.isPrototypeStructuralChange(e.property)){if(this._deferredUpdate!=null&&this._deferredUpdate.delayMs==0)return;this._redeferUpdate(hn||Xn?0:250)}}};ur.VERBOSE_LOGS=!1,ur.VERBOSE_LOGS_SHOW_SCENEGRAPH=!1,ur.MOBILE_MAX_PROTOTYPE_BFS_DEPTH=2,ur.DEFAULT_MAX_PROTOTYPE_BFS_DEPTH=8,ur.MOBILE_MAX_PROTOTYPE_BFS_COUNT=4,ur.DEFAULT_MAX_PROTOTYPE_BFS_COUNT=64,ur.MAX_PROTOTYPE_TLF_BATCH_SIZE=4;var ms=ur;(n=>{class r{constructor(i,a){this.guid=i,this.depth=a}}n.Entry=r;class e{constructor(i,a){this.nodeId=i,this.isAlreadySubscribed=a}}n.WorkingSetItem=e;class t{nonempty(){return this._queue.length>0}pushBackIfUnseen(i,a){this._seen.has(i)||(this._seen.set(i,!0),this._queue.push(new n.Entry(i,a)))}front(){return this._queue[0]}popFront(){return this._queue.shift()}constructor(){this._queue=[],this._seen=new Map}}n.Queue=t})(ms||(ms={}));var Pa=class r{add(e){let t=an.nodeIdString(e);if(!this._hash.has(t))this._hash.set(t,e);else{let n=this._hash.get(t);if(n.depth==0)return;(e.depth==0||e.depth>n.depth)&&this._hash.set(t,e)}}containsNodeById(e){return e!=null&&this._hash.has(e)}containsExactQuery(e){return this.containsNodeById(X.fromFigGUID(e.startingNode))?this._hash.get(an.nodeIdString(e)).depth==e.depth:!1}remove(e){this._hash.delete(an.hash(e))}count(){return this._hash.size}asList(){return Array.from(this._hash.values())}each(e){Array.from(this._hash.values()).forEach(e)}equals(e){if(e==null||this.count()!=e.count())return!1;for(let t of Array.from(this._hash.values()))if(!e.containsExactQuery(t))return!1;return!0}isSubsetOf(e){if(e==null||this.count()>e.count())return!1;for(let t of Array.from(this._hash.values()))if(!e.containsExactQuery(t))return!1;return!0}toJSObject(){return Ge.StringMap_toJSObject(this._hash)}static fromList(e){let t=new r;for(let n of e)t.add(n);return t}constructor(){this._hash=new Map}},Do=class Do{constructor(e,t){this.complete=()=>{var t;let e=this._executionTime-Date.now();e<=0||!1?((t=this.callback)==null||t.call(this),this.callback=null):this._timeoutID=Do._setTimeout(this.complete,e)};this.delayMs=t,this.callback=e,this._timeoutID=Do._setTimeout(this.complete,t),this._executionTime=Date.now()+t}redefer(e){this._executionTime=Date.now()+e}cancel(){this.callback=null,Do._clearTimeout(this._timeoutID)}static _setTimeout(e,t){if(!1){let n=(Do._nextMockTimeoutID=Do._nextMockTimeoutID+1)+-1;return Do._mockTimeouts.set(n,e),n}else return Sy()?(Promise.resolve().then(e),0):setTimeout(e,t)}static _clearTimeout(e){clearTimeout(e)}static fireAllMockedTimeouts(){let e=Array.from(Do._mockTimeouts.keys());for(let t of e)Do._mockTimeouts.get(t)(),Do._mockTimeouts.delete(t)}};Do._nextMockTimeoutID=1,Do._mockTimeouts=new Map;var Tu=Do;var pA=class{constructor(e,t){this.nodeId=e,this.offset=t}},Hh=class{version(){return mpGlobal.version}sock(){return mpGlobal.sock!=null?new Su(0,mpGlobal.sock):null}setSock(e){if(e!=null){let t=e.asHTMLSocket();t==null&&console.warn("Ignoring invalid socket binding for mpGlobal"),mpGlobal.sock=t.ws}else mpGlobal.sock=null}msgs(){return mpGlobal.msgs}setMsgs(e){mpGlobal.msgs=e}perfMetrics(){return mpGlobal.perfMetrics}setPerfMetrics(e){mpGlobal.perfMetrics=e}url(e){return mpGlobal.url(e)}preconnect(e){mpGlobal.preconnect(e)}newSocket(e){return new Su(1,e)}constructor(){}},_A=class r{static attemptToParseFrom(e){try{let t=JSON.parse(e);return new r(t.url,t.type)}catch{Oe("Failed to parse TooManyConnectionsPayload")}return null}constructor(e,t){this.url=e,this.type=t}},hA=class{static attemptToParseFrom(e){try{let t=JSON.parse(e);return{enforcePrototypeSecurityBoundaries:t.enforcePrototypeSecurityBoundaries,docNotInitiallyDecoded:t.docNotInitiallyDecoded,incremental:t.incremental,numMultiplayerConnections:t.numMultiplayerConnections}}catch{Oe("Failed to parse ServerSideLoadTimeMetadata")}return null}};var tn=class tn{static hasPrefix(e,t){if(e.length>=t.length){for(let n=0,o=t.length;n<o;n=n+1)if(e[n]!=t.charCodeAt(n))return!1;return!0}return!1}constructor(e,t,n){this._appState=null,this._isWindowActive=null,this._emitter=null,this._mpContext=null,this._incrementalLoader=null,this._role="viewer",this._scene=null,this._userSyncing=null,this._heartbeatTimeout=0,this._consecutiveFailedConnectionAttempts=0,this._attemptsSinceLastConnectionSuccess=0,this._hasConnectedAtLeastOnce=!1,this._onlineChangeHandler=null,this._reconnectionTimeout=0,this._isConnected=!1,this._isJoined=!1,this._shouldReconnect=!0,this._socket=null,this._url=null,this._fileKey=null,this._nodeId=null,this._partialSnapshotInfo=new zh(null,null,null),this._reconnectKey=null,this._previousTlfID=null,this._previousCanvasSpaceMouseLocation=null,this._sessionID=0,this._observingSessionID=-1,this._presenterSessionID=null,this._sessionsNominatingCurrentUser=new Set,this._sessionNominatedByCurrentUser=null,this._cachedNextUserChange=null,this._canvasSpaceClicks=[],this._nextCanvasSpaceClickID=0,this._pendingSceneGraphQueriesOrNull=null,this._lastSceneGraphQueryTime=0,this._lastSceneGraphQueryConcurrency=0,this._lastSentSceneGraphQueriesOrNull=null,this._observers=new jr,this._sceneLoadingPhase=rn.PENDING_INITIAL_LOAD,this._connectType=0,this._sessionSchema=null,this._staticFileRequest=null,this.maxScrollPositionsToStore=10,this._recentlyChangedScrollPositions=[],this._lastFlush=-1,this._appState=e,this._isWindowActive=t,this._emitter=Kt.getEventEmitter(),this._appState.addAppObserver(this),e.prototypeState().addObserver(this),e.prototypeState().addHsmObserver(this),this._wasBackgrounded=!1,this._mpContext=n,this._incrementalLoader=new ms(this._appState,this),this._flushQueueWhenAvailable=!1}addObserver(e){this._observers.add(e)}removeObserver(e){this._observers.remove(e)}fileKey(){return this._fileKey}observingSessionID(){return this._observingSessionID}setObservingSessionID(e){this._observingSessionID=e,this._getOrCreateNextUserChange().observing=[e]}observedUser(){return this._userSyncing!=null?Dt.IntMap_get(this._userSyncing.userBySessionID(),this._observingSessionID,null):null}isObserving(){return this.observingSessionID()!=-1}presenterSessionID(){return this._presenterSessionID}isPresenterSession(){return this._presenterSessionID&&this._presenterSessionID.value===this._sessionID}removeNominator(e){this._sessionsNominatingCurrentUser.delete(e)}sessionsNominatingCurrentUser(){return Array.from(this._sessionsNominatingCurrentUser.values())}sessionNominatedByCurrentUser(){return this._sessionNominatedByCurrentUser}setPresenterSessionID(e){this._presenterSessionID=e}scene(){return this._scene}nodeId(){return this._nodeId}incrementalLoader(){return this._incrementalLoader}socketForTesting(){var e;return(e=this._socket)==null?void 0:e.asMockSocket()}setMultiplayerUserSyncing(e){this._userSyncing=e}setScene(e){this._scene=e}isConnected(){return this._isConnected}fulfilledMultiplayerQueries(){return this._partialSnapshotInfo.fulfilledQueries}_setSceneLoadingPhase(e){let t=this._sceneLoadingPhase;switch(this._sceneLoadingPhase=e,t!=e&&this._observers.forEach(n=>{n.handleSceneChangedLoadingPhase(t,e)}),e){case rn.PENDING_INITIAL_LOAD:break;case rn.PENDING_LOAD_AFTER_RECONNECT:{console.log("sceneWillRebuildAfterReconnecting"),this._emitter.trigger("sceneWillRebuildAfterReconnecting");break}case rn.LOADED:{t==rn.PENDING_INITIAL_LOAD?this._appState.fontListPromise().then(()=>{console.debug("sceneDidCompleteInitialLoad"),this._emitter.trigger("sceneDidCompleteInitialLoad")}):t==rn.PENDING_LOAD_AFTER_RECONNECT&&(console.log("sceneDidRebuildAfterReconnecting"),this._emitter.trigger("sceneDidRebuildAfterReconnecting")),this._socket!=null&&this._sendSignal("client-rendered","");break}}}setNodeLoadedStatusesAndUpdate(e){this._setCanvasLoadedStatuses(e),this._setTlfLoadedStatuses(e),this._appState.prototypeState().tryToInitiateRequestedStateChange(ba.InitiateRequestedStateChangePolicy.WAIT_UNTIL_DESTINATIONS_LOADED),this._appState.trySettingRequestedActiveCanvas()}_setCanvasLoadedStatuses(e){this.scene().root().forEachChild(t=>{t.type()!="CANVAS"||t.isInternalOnly()||(e==null||e.some(n=>an.fullyLoadsNode(n,t)))&&t.setHasBeenLoaded(!0)})}_setTlfLoadedStatuses(e){var o,i,a;let t=0,n=0;tn.VERBOSE&&(console.log("-----------_setTlfLoadedStatuses-----------"),((o=this.scene())==null?void 0:o.root())!=null&&this.scene().root().forEachChild(s=>{s.forEachChild(l=>{l.hasBeenLoaded()&&(t=t+1)})})),this.scene().setTlfsLoaded(s=>e==null||e.some(l=>an.fullyLoadsNode(l,s))),tn.VERBOSE&&(((i=this.scene())==null?void 0:i.root())!=null&&this.scene().root().forEachChild(s=>{s.forEachChild(l=>{l.hasBeenLoaded()&&(n=n+1)})}),console.log(`\u{1F69A} numLoaded ${n-t} (${t} -> ${n})`),console.log("--------------------------------------------")),(a=N())==null||a.applyExistingVariableChangesToIFLLoadedNodes()}_finishLoadingIfNecessary(){this._sceneLoadingPhase!=rn.LOADED&&(this._appState.setCurrentFileKey(this._fileKey),this._appState.prototypeState().mostRecentFixInvalidStateInitiator="Multiplayer._finishLoadingIfNecessary",this._appState.setScene(this._scene),this._appState.prototypeState().navigateToFrameAndCloseOverlaysOrRestart(this._nodeId,"Multiplayer._finishLoadingIfNecessary"),this._setSceneLoadingPhase(rn.LOADED))}finishIncrementalLoading(){this._finishLoadingIfNecessary(),this._emitter.trigger("incrementalLoadingInfo",{type:"finishIncrementalLoading",fileKey:this._fileKey})}sessionID(){return this._sessionID}role(){return this._role}setRole(e){this._role=e}currentSceneGraphQueries(){return this._pendingSceneGraphQueriesOrNull!=null?this._pendingSceneGraphQueriesOrNull:this._lastSentSceneGraphQueriesOrNull!=null?this._lastSentSceneGraphQueriesOrNull:[]}connectTo(e,t){this._connectTo(e,0,t)}attemptReconnect(){var t;if(this._scene==null||this._sceneLoadingPhase==rn.PENDING_INITIAL_LOAD){this._scene!=null&&this._sceneLoadingPhase==rn.PENDING_INITIAL_LOAD&&Ae.trackEvent("Viewer reconnected during initial load",{}),this._connectTo(this._fileKey,0,this._nodeId);return}let e=this._appState.baseScreenId()??((t=this._appState.getActiveCanvas())==null?void 0:t.id());this._connectTo(this._fileKey,1,e)}_connectTo(e,t,n){this._attemptsSinceLastConnectionSuccess=this._attemptsSinceLastConnectionSuccess+1,Ae.handleMultiplayerOpenConnection(),this.disconnect(),this._fileKey=e,this._connectType=t,this._nodeId=n,this._staticFileRequest!=null&&(this._staticFileRequest.cancel(),this._staticFileRequest=null);let o="";switch(t){case 0:{o="initial-load",this._lastSentSceneGraphQueriesOrNull=null,this._pendingSceneGraphQueriesOrNull=null,this._partialSnapshotInfo=new zh(null,null,null);break}case 1:{o="reconnect",this._pendingSceneGraphQueriesOrNull==null&&this._lastSentSceneGraphQueriesOrNull!=null&&(this._pendingSceneGraphQueriesOrNull=this._lastSentSceneGraphQueriesOrNull,this._lastSentSceneGraphQueriesOrNull=null);break}}let i=this._mpContext.url({fileKey:e,role:this._role,connectionType:o,canvasQuerySkipContainers:!0}),a=this._partialSnapshotInfo.isValid()&&this._pendingSceneGraphQueriesOrNull!=null&&this._queriesAreEqual(this._partialSnapshotInfo.fulfilledQueries,this._pendingSceneGraphQueriesOrNull);if(this._scene!=null&&a){this._partialSnapshotInfo.snapshotHash!=null&&(i+=`&snapshot-hash=${encodeURIComponent(this._partialSnapshotInfo.snapshotHash)}`),this._partialSnapshotInfo.reconnectSequenceNumber!=null&&(i+=`&reconnect-sequence-number=${encodeURIComponent(this._partialSnapshotInfo.reconnectSequenceNumber.value.toString())}`);let _=encodeURIComponent(Nr.serializeListForMultiplayerURL(this._pendingSceneGraphQueriesOrNull));i+=`&scenegraph-queries=${_}`,this._sendSceneGraphQueries(this._pendingSceneGraphQueriesOrNull,0),this._pendingSceneGraphQueriesOrNull=null}this._reconnectKey!=null&&(console.log(`reconnecting with reconnect key ${this._reconnectKey}`),i+=`&reconnect-key=${encodeURIComponent(this._reconnectKey)}`),this._url=i,console.debug(`attempting to connect to ${i}`);let s=this._mpContext.sock(),l=this._mpContext.msgs();if(s!=null&&s.url()==i&&(s.readyState()==Fo.Socket_CONNECTING||s.readyState()==Fo.Socket_OPEN))console.debug(`Applied the preconnect optimization for URL ${i}`),this._mpContext.setSock(null),this._mpContext.setMsgs([]),this._mpContext.setPerfMetrics([]);else{if(s!=null){console.warn(`Preconnect URL ${s.url()} doesn't match URL ${i}, skipping preconnect optimization`),Ae.trackDefinedEvent("prototype.multiplayer_preconnect_failed",{role:this._role,socketUrl:s.url(),generatedUrl:i});try{s.close()}catch{}}s=this._mpContext.newSocket(i),s.setBinaryType("arraybuffer"),l=[]}let d=()=>this._socket==null?s==null:this._socket.equals(s),c=!0,p=null;s.setOnopen(_=>{if(!d()){console.warn("ignoring 'open' event on old socket");return}this._consecutiveFailedConnectionAttempts=0,p()}),p=()=>{this._isConnected=!0,console.debug(`connected to ${this._url}`),Ae.handleMultiplayerSocketConnectionAttempt(!0,this._attemptsSinceLastConnectionSuccess,!this._hasConnectedAtLeastOnce,this._isWindowActive()),this._hasConnectedAtLeastOnce=!0,this._attemptsSinceLastConnectionSuccess=0,this._observers.forEach(_=>{_.handleConnect(t,n)})};let u=null;s.setOnmessage(_=>{if(!d()){console.warn("ignoring 'message' event on old socket");return}if(!_.isArrayBuffer()){console.warn("ignoring 'message' event without an ArrayBuffer payload");return}let h=new Uint8Array(_.dataAsArrayBuffer());u(h)}),u=_=>{let h=N();if(c){if(c=!1,!h.modules().prototype.handleServerSchema(_)){this.disconnect();return}this._sendSignal("feature-flags",JSON.stringify(Y.getFeatureFlags()))}else h.modules().prototype.handleCompressedMultiplayerMessage(_,this.sessionID(),hn)},s.setOnclose(_=>{if(!d()){console.warn("ignoring 'close' event on old socket");return}if(this._isConnected?Ae.handleMultiplayerSocketDisconnected(this._isWindowActive()):Ae.handleMultiplayerSocketConnectionAttempt(!1,this._attemptsSinceLastConnectionSuccess,!this._hasConnectedAtLeastOnce,this._isWindowActive()),this.disconnect(),!this._shouldReconnect){console.warn("File too busy, not reconnecting");return}let h=null,S=()=>{clearTimeout(this._reconnectionTimeout),this._onlineChangeHandler!=null&&(qt.EventTarget_removeEventListener1(window,"online",this._onlineChangeHandler),this._onlineChangeHandler=null),this._isWindowActive()?this.attemptReconnect():h()};h=()=>{let m=Math.min(tn.RECONNECTION_DELAY_MAX,tn.RECONNECTION_DELAY_MIN*Math.pow(2,this._consecutiveFailedConnectionAttempts)),f=tn.RECONNECTION_DELAY_MIN+(m-tn.RECONNECTION_DELAY_MIN)*Math.random();console.debug(`attempting to reconnect to ${this._url} in ${f}s`),this._reconnectionTimeout=setTimeout(S,f*1e3|0),this._onlineChangeHandler=()=>{console.log("attempting to reconnect due to connectivity change"),navigator.onLine&&(this._consecutiveFailedConnectionAttempts=0,S())},qt.EventTarget_addEventListener1(window,"online",this._onlineChangeHandler)},h(),this._consecutiveFailedConnectionAttempts=this._consecutiveFailedConnectionAttempts+1}),this._socket=s,s.readyState()==Fo.Socket_OPEN&&p(),l.forEach(u)}_decodeConcatenatedUncompressedMessages(e,t){let n=new Sc.ByteBuffer(e);for(;n.length!==n._index;){let o=null;try{o=this._sessionSchema.decodeMessage(n)}catch(i){console.error(`decoding failed: '${i.message}'`);return}tn.VERBOSE&&console.log(`got message of type '${o.type}'`),t(o)}}handleUncompressedMessage(e,t){this._decodeConcatenatedUncompressedMessages(e,n=>{switch(n.type){case"JOIN_START":case"JOIN_START_SKIP_RELOAD":{this._handleJoinStartOrJoinStartSkipReload(n,this._connectType);break}case"JOIN_END":{this._handleJoinEnd();break}case"SCENE_GRAPH_REPLY":{this._handleSceneGraphReply(n);break}case"NODE_CHANGES":throw new Error("handleUncompressedMessage cannot handle a NODE_CHANGES payload. Did you mean to process this message in C++ and call PrototypeApp::willReceiveNodeChanges/PrototypeApp::didReceiveNodeChanges instead?");case"USER_CHANGES":{this._userSyncing!=null&&this._userSyncing.handleUserChanges(n,this);break}case"SIGNAL":{this._handleSignal(n);break}case"NOTIFY_SHOULD_UPGRADE":{this._handleNotifyShouldUpgrade();break}case"CLIENT_BROADCAST":{this._handleClientBroadcast(n);break}}})}handleUncompressedSchema(e){try{this._sessionSchema=Sc.createKiwiCodec(!!Y.getFeatureFlags().use_new_kiwi_codec_in_viewer,Sc.decodeBinarySchema(e))}catch(t){return console.error(`schema decoding failed: '${t.message}'; uncompressedBytes is ${e.length}`),!1}return!0}willReceiveNodeChanges(){this._appState.prototypeState().checkValidBaseScreenBeforeNodeChanges()}didReceiveNodeChanges(e,t){if(this._appState.prototypeState().checkValidBaseScreenAfterNodeChanges(),this._scene==null){console.warn("ignoring 'NODE_CHANGES' event without a scene");return}this._emitter.trigger("incrementalLoadingInfo",{type:"receiveNodeChanges",size:e}),this._partialSnapshotInfo.snapshotHash=null,t!==null&&t!=null&&(this._partialSnapshotInfo.reconnectSequenceNumber=new ce(t)),this._observers.forEach(n=>{n.handleNodeChanges()}),Y.getFeatureFlags().prototype_ifl_join_protocol_fix&&!hn||this._isJoined||(console.debug("server sent the full document (vs. incrementally loading)"),this.setNodeLoadedStatusesAndUpdate(null),this._finishLoadingIfNecessary())}getSceneLoadingPhase(){return this._sceneLoadingPhase}_handleJoinStartOrJoinStartSkipReload(e,t){let n=0;if(e.type=="JOIN_START"?n=0:(n=1,console.debug("performing fast reconnect to skip scene reload")),t==0?this._setSceneLoadingPhase(rn.PENDING_INITIAL_LOAD):t==1&&n!=1&&this._setSceneLoadingPhase(rn.PENDING_LOAD_AFTER_RECONNECT),this._sessionID=e.sessionID,n!=1){e.fileVersion||Oe("Viewer received JOIN_START message without a file version"),this._appState.prototypeState().mostRecentFixInvalidStateInitiator="Multiplayer._handleJoinStartOrJoinStartSkipReload",this._appState.setScene(null);let o=nt.createScene(this._sessionID,e.fileVersion||null);this.setScene(o),o.setFileKey(this.fileKey())}else this._sendSignal("client-rendered","");this._observers.forEach(o=>{o.handleJoinStart(n,e.sessionID,e.fileVersion)})}_handleJoinEnd(){this._isJoined=!0,this._enableHeartbeatTimer(),this._cachedNextUserChange!=null&&(this._getOrCreateNextUserChange().recentClicks=[]),this._pendingSceneGraphQueriesOrNull!=null&&(this._sendSceneGraphQueries(this._pendingSceneGraphQueriesOrNull,1),this._pendingSceneGraphQueriesOrNull=null),this._observers.forEach(e=>{e.handleJoinEnd()}),this.handleStateChangeInitiated(new Hr(0,ut.ROOT_STABLE_PATH()))}_handleSceneGraphReply(e){this._lastSceneGraphQueryConcurrency=this._lastSceneGraphQueryConcurrency-1,Rr.increment("[IFL] sceneGraphQueriesReceived",1),Rr.trackNumber("[IFL] Total Loaded Nodes",e.sceneGraphQueries.length),this._emitter.trigger("incrementalLoadingInfo",{type:"receiveSceneGraphReply",queries:e.sceneGraphQueries.map(t=>an.toString(t))}),this._partialSnapshotInfo.fulfilledQueries=e.sceneGraphQueries,this.setNodeLoadedStatusesAndUpdate(e.sceneGraphQueries),this._observers.forEach(t=>{t.handleSceneGraphReply(this._lastSceneGraphQueryConcurrency,e.sceneGraphQueries)}),this.handleStateChangeInitiated(new Hr(0,ut.ROOT_STABLE_PATH()))}_handleSignal(e){if(e.signalName!==void 0&&e.signalPayload!==void 0&&(e.signalName==="invalid-permissions"||e.signalName==="ip-allowlist"||e.signalName==="network-access-restriction")){console.warn(`received ${e.signalName} message.`),location.reload();return}if(e.signalName!==void 0&&e.signalPayload!==void 0&&e.signalName=="client-too-old"){console.warn("received 'client-too-old' message. refreshing!"),location.reload();return}if(e.signalName!==void 0&&e.signalPayload!==void 0&&e.signalName=="snapshot-hash"&&(this._partialSnapshotInfo.snapshotHash=e.signalPayload),e.signalName!==void 0&&e.signalPayload!==void 0&&e.signalName==="server-side-load-time-metadata"){let t=hA.attemptToParseFrom(e.signalPayload)}if(e.signalName!==void 0&&e.signalPayload!==void 0&&e.signalName=="reconnect-sequence-number"&&(this._partialSnapshotInfo.reconnectSequenceNumber=new ce(parseInt(e.signalPayload))),e.signalName!==void 0&&e.signalName=="reconnect-immediately"&&(console.log("received 'reconnect-immediately' signal. reconnecting."),this.attemptReconnect()),e.signalName!==void 0&&e.signalPayload!==void 0&&e.signalName=="reconnect-key"&&(this._reconnectKey=e.signalPayload,console.debug(`server sent reconnect key ${this._reconnectKey}`)),e.signalName!==void 0&&e.signalName=="too-many-connections"){let t=_A.attemptToParseFrom(e.signalPayload!==void 0?e.signalPayload:"");t!=null&&(this._staticFileRequest=new po(t.url).format(1),this._staticFileRequest.get().then(n=>{this._observers.forEach(o=>{o.handleJoinStart(0,-1,-1)}),this._appState.serialization().decodeSceneForViewerAndPrototypeLib1(n.bytes).then(o=>{o!=null?(this._scene=o,this.setNodeLoadedStatusesAndUpdate(null),this._observers.forEach(i=>{i.handleJoinEnd()}),this._finishLoadingIfNecessary()):Oe("Failed to parse scene")})})),console.warn("too many connections to multiplayer or example file, not reconnecting"),this._shouldReconnect=!1}}_handleNotifyShouldUpgrade(){console.warn("received NOTIFY_SHOULD_UPGRADE message. refreshing!"),location.reload()}_handleClientBroadcast(e){for(let t of e.broadcasts)t.prototypePresenter!=null&&(t.prototypePresenter.nomination!=null?this.updateNominatedPresenter(t.prototypePresenter.nomination,t.sessionID):(this.setPresenterSessionID(new ce(t.prototypePresenter.sessionID)),this._presenterSessionID!=null&&(this._sessionsNominatingCurrentUser.clear(),this._sessionNominatedByCurrentUser=null)));this._observers.forEach(t=>{t.handlePresenterChange()})}updateNominatedPresenter(e,t){e.isCancelled?(e.sessionID==this._sessionID&&(t==this._sessionID?this._sessionsNominatingCurrentUser.clear():this._sessionsNominatingCurrentUser.delete(t)),this._sessionNominatedByCurrentUser!=null&&this._sessionNominatedByCurrentUser.value==e.sessionID&&(this._sessionNominatedByCurrentUser=null)):(e.sessionID==this._sessionID&&this._sessionsNominatingCurrentUser.add(t),t==this._sessionID&&(this._sessionNominatedByCurrentUser=new ce(e.sessionID)))}disconnect(){if(this._isJoined=!1,this._socket!=null){try{this._socket.close()}catch{}this._socket=null}this._lastSceneGraphQueryConcurrency=0,clearTimeout(this._heartbeatTimeout),clearTimeout(this._reconnectionTimeout),this._isConnected&&(console.debug(`disconnected from ${this._url}`),this._isConnected=!1,this._observers.forEach(e=>{e.handleDisconnect()}))}_enableHeartbeatTimer(){if(!1)return;let e=null,t=()=>{var n;if(this._isWindowActive()&&((n=this._socket)==null?void 0:n.readyState())==Fo.Socket_OPEN){console.debug("sending heartbeat message");let o={};o.type="USER_CHANGES",o.userChanges=[],this._sendMessage(o)}e()};e=()=>{this._heartbeatTimeout=setTimeout(t,tn.HEARTBEAT_DELAY)},e()}handleSceneChange(e,t){e!=null&&e.removeObserver(this),t!=null&&t.addObserver(this)}handleActiveCanvasChange(e,t){}handleActivePrototypeStartingPointChange(e,t){}handleSceneGraphEvent(e){e.property==112&&Je.asString(e.newVal)=="CREATED"&&this._partialSnapshotInfo.fulfilledQueries!=null&&this._partialSnapshotInfo.fulfilledQueries.some(t=>an.fullyLoadsNode(t,e.node))&&e.node.setHasBeenLoaded(!0)}handleStateUpdate(e,t){this.pushAllInstanceStateChanges()}handleStateChangeAborted(e){e!=null&&(this.handleStateUpdate(e,"ABORTED"),this.handlePresentedStateChange(null,e.oldStateAndOverlays,null))}handleStateChangeCommitted(e,t){this.handleStateUpdate(e,"COMMITTED")}handleStateChangeInitiated(e){if(e==null||e.oldStateAndOverlays.stateId==null&&e.newStateAndOverlays.stateId==null)return;this.handleStateUpdate(e,"INITIATED");let t=this._getSynchronizableHotspotId_instanceHACK(e.interactionAddress.hotspotStablePath);this.handlePresentedStateChange(t,e.newStateAndOverlays,e.interactionAddress.interactionId)}handleStateChangeRequested(e){}_pushInstanceStateChange(e,t,n){let o=ot.encodeInstanceStateChange(t,n);o.hotspotStablePath==null&&(o.hotspotStablePath=ot.encodeGUIDPath(e)),this._getOrCreateNextUserChange().instanceStateChanges==null&&(this._getOrCreateNextUserChange().instanceStateChanges=[]),this._getOrCreateNextUserChange().instanceStateChanges.push(o)}handleHsmAborted(e,t){this._pushInstanceStateChange(e,t,"ABORTED")}handleHsmCommitted(e,t,n){this._pushInstanceStateChange(e,t,"COMMITTED")}handleHsmInitiated(e,t){this._pushInstanceStateChange(e,t,"INITIATED")}handleHsmRequested(e,t){}pushAllInstanceStateChanges(){let e=this._appState.prototypeState();e.getOnscreenStates().forEach(t=>{let n=e.getStateMachineLastChangeInHistory(t.a);this._pushInstanceStateChange(t.a,n,"INITIATED"),this._pushInstanceStateChange(t.a,n,"COMMITTED")})}onTransitionFrame(e){this._getOrCreateNextUserChange()}_getSynchronizableHotspotId_instanceHACK(e){var n,o;return(o=(n=this._appState.scene())==null?void 0:n.findNodeByStablePath(e))==null?void 0:o.id()}_createTriggeredOverlaysDataForMultiplayer(e,t){let n=[];return t.overlays.forEach(o=>{let i=this._getSynchronizableHotspotId_instanceHACK(o.openingHotspotStablePath);n.push(ot.encodeOverlayData(o,i))}),n}_updateNextUserChangeForOverlay(e,t){this.observedUser()==null&&(this._getOrCreateNextUserChange().triggeredOverlaysData=this._createTriggeredOverlaysDataForMultiplayer(e,t))}handleVideoStateChange(e){this._getOrCreateNextUserChange().videoStateChangeData=e.slice()}handleEmbeddedPrototypeChange(e,t){if(this._getOrCreateNextUserChange().embeddedPrototypeData==null&&(this._getOrCreateNextUserChange().embeddedPrototypeData=[],this._userSyncing!=null)){let o=this._userSyncing.userBySessionID().get(this._sessionID);o!=null&&o.embeddedPrototypeData!=null&&(this._getOrCreateNextUserChange().embeddedPrototypeData=o.embeddedPrototypeData)}if(t===-1){this._getOrCreateNextUserChange().embeddedPrototypeData=this._getOrCreateNextUserChange().embeddedPrototypeData.filter(n=>!X.equals(X.fromFigGUID(n.nodeId),e));return}this._getOrCreateNextUserChange().embeddedPrototypeData.push({nodeId:X.toFigGUID(e),sessionId:t})}handleActiveSlidesEmbeddedPrototypeChange(e){this._getOrCreateNextUserChange().activeSlidesEmbeddablePrototype=e?X.toFigGUID(e):null}pushAllVideoStateChanges(){this._appState.prototypeState().snapshotLatestVideoStateChanges(),this._getOrCreateNextUserChange().videoStateChangeData=this._appState.prototypeState().getVideoStateChanges()}handlePresentedStateChange(e,t,n){var a;let o=this._previousTlfID,i=this._appState.baseScreenId();X.equals(o,i)||(this._previousTlfID=i,this._getOrCreateNextUserChange().selection=[],i!=null&&this._getOrCreateNextUserChange().selection.push(X.toFigGUID(i))),e!=null&&(this._getOrCreateNextUserChange().lastTriggeredHotspot=ot.encodeGUID(e)),n!=null&&(this._getOrCreateNextUserChange().lastTriggeredPrototypeInteractionID=ot.encodeGUID(n)),this._getOrCreateNextUserChange().lastTriggeredObjectAnimationIndex=(a=t.animationState)==null?void 0:a.actionIndex,t.animationState!=null&&(this._getOrCreateNextUserChange().lastTriggeredPrototypeInteractionID=ot.encodeGUID(t.animationState.interactionId)),this._updateNextUserChangeForOverlay(e,t)}pushAllSetVariableActions(){this.handleSetVariableAction(this._appState.prototypeState()._setVariableActionHistory)}handleSetVariableAction(e){this._getOrCreateNextUserChange().triggeredSetVariableActionData=e}pushAllSetVariableModeActions(){this.handleSetVariableModeAction(this._appState.prototypeState()._setVariableModeActionHistory)}handleSetVariableModeAction(e){this._getOrCreateNextUserChange().triggeredSetVariableModeActionData=e}handleFitModeChange(e,t){}handleRestartPrototype(){}_getOrCreateNextUserChange(){return this._cachedNextUserChange==null&&(this._cachedNextUserChange={},this._cachedNextUserChange.sessionID=this._sessionID,this._cachedNextUserChange.instanceStateChanges=null),this._cachedNextUserChange}getParticles(){var e;return(e=this.observedUser())==null?void 0:e.remainingParticles()}getMouse(){var e;return(e=this.observedUser())==null?void 0:e.canvasSpaceMouse}getScrollPositions(){var e;return(e=this.observedUser())==null?void 0:e.scrollPositions}setCanvasSpaceMouse(e){let t=this._previousCanvasSpaceMouseLocation;if(e==null&&t==null||e!=null&&t!=null&&e.equals(t))return;this._previousCanvasSpaceMouseLocation=(e==null?void 0:e.clone())??null;let n={};e!=null?(n.x=e.x(),n.y=e.y()):(n.x=NaN,n.y=NaN);let o={};o.canvasSpaceLocation=n,o.cursor="DEFAULT",this._getOrCreateNextUserChange().mouse=o}recordCanvasSpaceClick(e){for(;this._canvasSpaceClicks.length>10;)this._canvasSpaceClicks.shift();let t={};t.x=e.x(),t.y=e.y();let n={};n.id=this._nextCanvasSpaceClickID=this._nextCanvasSpaceClickID+1,n.point=t,this._canvasSpaceClicks.push(n),this._getOrCreateNextUserChange().recentClicks=this._canvasSpaceClicks.slice()}setScrollPosition(e,t){for(ne.List_removeIf(this._recentlyChangedScrollPositions,n=>n.nodeId==e);this._recentlyChangedScrollPositions.length>this.maxScrollPositionsToStore;)this._recentlyChangedScrollPositions.shift();this._recentlyChangedScrollPositions.push(new pA(e,t)),this._getOrCreateNextUserChange().scrollPositions=this._recentlyChangedScrollPositions.map(n=>{let o={};return o.node=ot.encodeGUID(X.fromString(n.nodeId)),o.scrollOffset=ot.encodeVector2(n.offset),o})}maybeFlushNextUserChange(e){let t=Me.seconds();(this._lastFlush==-1||t-this._lastFlush>tn.FLUSH_INTERVAL_SEC||e==1)&&(this._flushNextUserChange(),this._lastFlush=t)}_flushNextUserChange(){if(this._isJoined&&this._cachedNextUserChange!=null){let e={};e.type="USER_CHANGES",e.userChanges=[this._cachedNextUserChange],tn.debugUserChanges&&console.log("flushNextUserChange",this._cachedNextUserChange),this._sendMessage(e),this._cachedNextUserChange=null}}_queriesAreEqual(e,t){let n=new Map;for(let i of e)n.set(an.hash(i),!0);let o=new Map;for(let i of t)o.set(an.hash(i),!0);if(n.size!=o.size)return!1;for(let i of Array.from(n.keys()))if(!o.has(i))return!1;return!0}setSceneGraphQueries(e){this._queriesAreEqual(e,this.currentSceneGraphQueries())||(this._isJoined?this._sendSceneGraphQueries(e,1):this._pendingSceneGraphQueriesOrNull=e)}_sendSceneGraphQueries(e,t){if(this._lastSceneGraphQueryConcurrency==0&&(this._lastSceneGraphQueryTime=Me.milliseconds()),this._lastSceneGraphQueryConcurrency=this._lastSceneGraphQueryConcurrency+1,e.length>0&&(this._lastSentSceneGraphQueriesOrNull=e,t==1)){let n={};n.type="SCENE_GRAPH_QUERY",n.sceneGraphQueries=e,Rr.increment("[IFL] sceneGraphQueriesSent",1),this._emitter.trigger("incrementalLoadingInfo",{type:"sendSceneGraphQuery",queries:n.sceneGraphQueries.map(o=>an.toString(o))}),this._sendMessage(n)}}_sendSignal(e,t){let n={};n.type="SIGNAL",n.signalName=e,n.signalPayload=t,this._sendMessage(n)}nominatePresenter(e){let t=this.presenterClientBroadcastMessageWithNomination(e,!1);this._sendClientBroadcast(t)}cancelPresenterNomination(e){let t=this.presenterClientBroadcastMessageWithNomination(e,!0);this._sendClientBroadcast(t)}presenterClientBroadcastMessageWithNomination(e,t){let n={};n.type="CLIENT_BROADCAST";let o={};o.sessionID=this._sessionID;let i={},a={};return this._presenterSessionID!=null&&(i.sessionID=this._presenterSessionID.value),a.sessionID=e,a.isCancelled=t,i.nomination=a,o.prototypePresenter=i,n.broadcasts=[o],n}startPresenting(){let e=this.presenterClientBroadcastMessage(!0);this._sendClientBroadcast(e)}stopPresenting(){let e=this.presenterClientBroadcastMessage(!1);this._sendClientBroadcast(e)}setSlideSpeakerNotes(e,t){let n={};n.type="NODE_CHANGES";let o={guid:X.toFigGUID(e),slideSpeakerNotes:t};n.nodeChanges=[o],this._sendClientBroadcast(n)}setInteractiveSlideConfigData(e,t,n){let o={};o.type="NODE_CHANGES";let i={entries:[{key:t,value:n}]},a={guid:X.toFigGUID(e),interactiveSlideConfigData:i};o.nodeChanges=[a],this._sendClientBroadcast(o)}setInteractiveSlideParticipantData(e,t,n){let o={};o.type="INTERACTIVE_SLIDE_CHANGE";let i={anonymousUserID:t,nodeID:X.toFigGUID(e),responseData:n};o.interactiveSlideElementChange=i,this._sendClientBroadcast(o)}presenterClientBroadcastMessage(e){let t={};t.type="CLIENT_BROADCAST";let n={},o={};return e&&(o.sessionID=this._sessionID),n.prototypePresenter=o,t.broadcasts=[n],t}_sendClientBroadcast(e){this._socket!=null&&this._sendMessage(e)}_sendMessage(e){Y.getFeatureFlags().prototype_log_all_ws&&console.log(e),this._socket.send2(Hi.deflateRaw(xe().encodeMessage(e)))}};tn.debugUserChanges=!1,tn.VERBOSE=!1,tn.SCHEMA_PREFIX="fig-wire\0\0\0",tn.SCHEMA_PREFIX_BYTES=new Uint8Array([102,105,103,45,119,105,114,101,1,0,0,0]),tn.RECONNECTION_DELAY_MIN=1,tn.RECONNECTION_DELAY_MAX=128,tn.FLUSH_INTERVAL_SEC=1/30,tn.HEARTBEAT_DELAY=60*1e3;var ea=tn;var zh=class{constructor(e,t,n){this.snapshotHash=null,this.reconnectSequenceNumber=null,this.fulfilledQueries=null,this.snapshotHash=e,this.reconnectSequenceNumber=t,this.fulfilledQueries=n}isValid(){return(this.snapshotHash!=null||this.reconnectSequenceNumber!=null)&&this.fulfilledQueries!=null}};var Nr;(n=>{function r(o,i){let a={};return a.startingNode=X.toFigGUID(o),a.depth=i,a}n.create=r;function e(o){if(o==null)return"";let i="";for(let a of o)i+=an.serializeForMultiplayerURL(a),i+=",";return i.slice(0,i.length-1)}n.serializeListForMultiplayerURL=e;function t(o){return o.startingNode.localID==0&&o.startingNode.sessionID==0&&o.depth==0}n.isUnlimitedRootQuery=t})(Nr||(Nr={}));var Eu=class Eu{age(){return sr.Math_clamp((Me.seconds()-this.startTimestamp)/Eu.LIFETIME,0,1)}constructor(e,t,n){this.sessionID=e,this.canvasSpaceLocation=t,this.startTimestamp=n}};Eu.LIFETIME=.25,Eu.RADIUS=25;var Tc=Eu,Wh=class{remainingParticles(){let e=Me.seconds(),t=null;return this.particles!=null&&ne.List_removeIf(this.particles,n=>e-n.startTimestamp>Tc.LIFETIME?!0:(t==null&&(t=[]),t.push(n),!1)),t}toJSON(){return{sessionID:this.sessionID,userID:this.userID,name:this.name,color:this.color!=O.TRANSPARENT?O.toCSS(this.color):null,imageURL:this.imageURL,deviceName:this.deviceName,currentFrame:this.currentFrame!=null?this.currentFrame:null}}constructor(e){this.sessionID=e,this.userID=null,this.clientID=null,this.name=null,this.color=O.TRANSPARENT,this.imageURL=null,this.deviceName=null,this.currentFrame=null,this.canvasSpaceMouse=null,this.largestClickID=-1,this.particles=null,this.scrollPositions=new Map,this.observedSessions=[],this.lastTriggeredHotspot=null,this.lastTriggeredPrototypeInteractionID=null,this.lastTriggeredObjectAnimationIndex=null,this.triggeredOverlaysData=[],this.instanceStateChanges=[],this.triggeredSetVariableActionData=[],this.triggeredSetVariableModeActionData=[],this.videoStateChangeData=[],this.embeddedPrototypeData=[],this.activeSlidesEmbeddablePrototype=null}},Iu=class{userBySessionID(){return this._userBySessionID}handleUserChanges(e,t){if(e.userChanges===void 0){console.error("decoded node change message with missing required field: 'userChanges'");return}let n=!1,o=!1;for(let i of e.userChanges){if(i.sessionID===void 0){Oe("skipping user change message without sessionID");continue}let a=i.sessionID,s=ea.debugUserChanges&&t!=null&&a!=t.sessionID();i.observing&&i.observing.includes(t.sessionID())&&(o=!0),i.connected!==void 0&&(i.connected?(this._userBySessionID.set(a,new Wh(a)),s&&console.log(`user sessionID ${a} connected`,this._userBySessionID.get(a).toJSON()),t!=null&&(t.pushAllInstanceStateChanges(),t.pushAllSetVariableActions(),t.pushAllSetVariableModeActions(),t.pushAllVideoStateChanges())):(s&&this._userBySessionID.has(a)&&console.log(`user sessionID ${a} disconnected`,this._userBySessionID.get(a).toJSON()),t!=null&&t.removeNominator(a),this._userBySessionID.delete(a)),n=!0);let l=Dt.IntMap_get(this._userBySessionID,a,null);l!=null?(n=this._applyChangeToUser(i,l,s)||n,this._applyNullChecksToUserStrings(l)):s&&Oe("could not find existing user to apply user change message"),s&&console.log("recvUserChange",i,n)}o&&t.pushAllVideoStateChanges(),n&&this.onChange!=null&&this.onChange()}_applyNullChecksToUserStrings(e){e.userID==null&&(e.userID=""),e.name==null&&(e.name=""),e.imageURL==null&&(e.imageURL="")}_applyChangeToUser(e,t,n){let o=!1,i=e.sessionID;if(e.color!==void 0&&(t.color=ot.decodeColor(e.color),o=!0),e.name!==void 0&&(t.name=e.name,o=!0),e.deviceName!==void 0&&(t.deviceName=e.deviceName,o=!0),e.imageURL!==void 0&&(t.imageURL=e.imageURL,o=!0),e.userID!==void 0&&(t.userID=e.userID,o=!0),e.clientID!==void 0&&(t.clientID=e.clientID,o=!0),e.observing!==void 0&&(t.observedSessions=e.observing,o=!0),e.selection!==void 0){let a=e.selection;t.currentFrame=a.length==1?ot.decodeGUID(a[0]):null,o=!0}if(e.mouse!==void 0){let a=e.mouse;if(a.canvasSpaceLocation!==void 0){let s=ot.decodeVector(a.canvasSpaceLocation);(t.canvasSpaceMouse==null||!t.canvasSpaceMouse.equals(s))&&(t.canvasSpaceMouse=s.equals(s)?s:null,this.onMouseCursorChange!=null&&this.onMouseCursorChange(i))}}if(e.recentClicks!==void 0)if(t.particles==null){t.particles=[];for(let a of e.recentClicks)a.id>t.largestClickID&&(t.largestClickID=a.id)}else for(let a of e.recentClicks)a.id>t.largestClickID&&(t.largestClickID=a.id,t.particles.push(new Tc(i,ot.decodeVector(a.point),Me.seconds())),this.onMouseCursorChange!=null&&this.onMouseCursorChange(i));if(e.scrollPositions!==void 0)for(let a of e.scrollPositions)t.scrollPositions.set(ot.decodeGUID_instanceHACK(a.node),ot.decodeVector(a.scrollOffset));return e.lastTriggeredHotspot!==void 0&&(t.lastTriggeredHotspot=ot.decodeGUID_instanceHACK(e.lastTriggeredHotspot),o=!0),e.lastTriggeredPrototypeInteractionID!==void 0&&(t.lastTriggeredPrototypeInteractionID=ot.decodeGUID(e.lastTriggeredPrototypeInteractionID),o=!0),e.lastTriggeredObjectAnimationIndex!==void 0&&(t.lastTriggeredObjectAnimationIndex=e.lastTriggeredObjectAnimationIndex,o=!0),e.triggeredOverlaysData!==void 0&&(t.triggeredOverlaysData=e.triggeredOverlaysData.slice(),o=!0),e.instanceStateChanges!==void 0&&(e.instanceStateChanges.forEach(a=>{t.instanceStateChanges.push(a)}),o=!0),e.triggeredSetVariableActionData!==void 0&&(t.triggeredSetVariableActionData=e.triggeredSetVariableActionData.slice(),o=!0),e.triggeredSetVariableModeActionData!==void 0&&(t.triggeredSetVariableModeActionData=e.triggeredSetVariableModeActionData.slice(),o=!0),e.videoStateChangeData!==void 0&&(t.videoStateChangeData=e.videoStateChangeData.slice(),o=!0),e.embeddedPrototypeData!==void 0&&(t.embeddedPrototypeData=e.embeddedPrototypeData.slice(),o=!0),e.activeSlidesEmbeddablePrototype!==void 0&&(t.activeSlidesEmbeddablePrototype=X.fromFigGUID(e.activeSlidesEmbeddablePrototype),o=!0),n&&console.log("_applyChangeToUser",e,t.toJSON()),o}constructor(){this._sessionID=-1,this._userBySessionID=new Map,this.onChange=null,this.onMouseCursorChange=null}};var ul;(a=>{function r(){let s=null;try{s=localStorage}catch{return 1}let l=+s.getItem("cursorScaleFactor");return l||1}a._globalCursorScaleFactor=r;function e(s,l,d,c,p,u,_){let h=G.new2(),S=G.new2(),m=d.clone(),f=1/l;if(Y.isInlinePreview()&&m.expand1(3),S.copyFrom(c),S.expand1(f),S.left()<m.left()&&s.fillRect(h.setTo1(S.left(),S.top(),m.left()-S.left(),S.height()),p),m.right()<S.right()&&s.fillRect(h.setTo1(m.right(),S.top(),S.right()-m.right(),S.height()),p),S.top()<m.top()&&s.fillRect(h.setTo1(m.left()-f,S.top(),m.width()+2*f,m.top()-S.top()),p),m.bottom()<S.bottom()&&s.fillRect(h.setTo1(m.left()-f,m.bottom(),m.width()+2*f,S.bottom()-m.bottom()),p),u>0){let T=_==null?void 0:_.clone();T==null||T.expand1(f);let y=u*Math.cos(Math.PI/4)+4*f;(T.left()+y>m.left()||T.top()+y>m.top())&&s.fillConvexPolygon([T.topLeft(),T.topLeft().add(new b(y,0)),T.topLeft().add(new b(0,y))],p),(T.right()-y<m.right()||T.top()+y>m.top())&&s.fillConvexPolygon([T.topRight(),T.topRight().add(new b(0,y)),T.topRight().add(new b(-y,0))],p),(T.right()-y<m.right()||T.bottom()-y<m.bottom())&&s.fillConvexPolygon([T.bottomRight(),T.bottomRight().add(new b(-y,0)),T.bottomRight().add(new b(0,-y))],p),(T.left()+y>m.left()||T.bottom()-y<m.bottom())&&s.fillConvexPolygon([T.bottomLeft(),T.bottomLeft().add(new b(0,-y)),T.bottomLeft().add(new b(y,0))],p)}}a.drawPreviewStencil=e;function t(s,l,d,c){for(let p of l){let u=b.new(p.canvasSpaceLocation);if(!c.contains2(u))continue;let _=[],h=p.age(),S=h*Tc.RADIUS,m=Math.max(8,(S|0)*2);for(let f=0;f<m;f=f+1){let T=Math.PI*2*f/m;_.push(new b(u.x()+Math.cos(T)*S*d,u.y()+Math.sin(T)*S*d))}s.fillConvexPolygon(_,O.new3(.9,.9,.9,.5*(1-h)))}}a.drawParticles=t;function n(s,l,d){let c=l.x(),p=l.y(),u=r()/d,_=[],h=[];for(let y of a.cursorOutlineOuter)_.push(b.new());for(let y of a.cursorOutlineInner)h.push(b.new());let S=2,m=.5,f=(S+1)*(S+1)*(S+1)*(S+1),T=m/f;for(let y=-S,E=S+1;y<E;y=y+1)for(let v=-S,A=S+1;v<A;v=v+1){let C=(S+1-Math.abs(y))*(S+1-Math.abs(v))*T;if(!(C<1/255)){for(let g=0,R=a.cursorOutlineOuter.length;g<R;g=g+1){let D=a.cursorOutlineOuter[g],P=_[g];P.setX(c+(D.x()+y)*u),P.setY(p+(D.y()+v+1)*u)}s.fillConvexPolygon(_,O.new3(0,0,0,C))}}for(let y=0,E=a.cursorOutlineOuter.length;y<E;y=y+1){let v=a.cursorOutlineOuter[y],A=_[y];A.setX(c+v.x()*u),A.setY(p+v.y()*u)}s.fillConvexPolygon(_,O.WHITE);for(let y=0,E=a.cursorOutlineInner.length;y<E;y=y+1){let v=a.cursorOutlineInner[y],A=h[y];A.setX(c+v.x()*u),A.setY(p+v.y()*u)}s.fillConvexPolygon(h,O.BLACK)}a.drawMouseCursor=n,a.cursorOutlineOuter=[new b(14.933,9.027),new b(7.755,10.975),new b(3.57,17.299),new b(0,0)],a.cursorOutlineInner=[new b(12.416,8.674),new b(7.13,10.109),new b(4.063,14.742),new b(1.442,2.04)]})(ul||(ul={}));var mA=class{constructor(e,t){this.tree=null,this.bounds=null,this.hash=0,this.tree=e,this.bounds=t;let n=new go;n.hash1(t.x()),n.hash1(t.y()),n.hash1(t.width()),n.hash1(t.height()),this.hash=n.value(),this._equalsImpl=(o,i)=>o.bounds.equals(i.bounds)?o.tree.equalsWithinBounds(i.tree,o.bounds):!1}equals(e){return this._equalsImpl(this,e)}},yu=class{constructor(e,t){this._tileAtlas=null,this._keyToTileHandle=null,this._keyToNeededImages=null,this._tileHandleToKey=null,this._resetMaps();let n=o=>{let i=Ge.StringMap_get(this._tileHandleToKey,o,null);i!=null&&(this._tileHandleToKey.delete(o),this._keyToTileHandle.remove(i),this._keyToNeededImages.remove(i))};this._tileAtlas=new tr(e,n)}_resetMaps(){this._keyToTileHandle=new pi(e=>e.hash,(e,t)=>e.equals(t),e=>null),this._keyToNeededImages=new pi(e=>e.hash,(e,t)=>e.equals(t),e=>null),this._tileHandleToKey=new Map}_allocateTileHandle(e){let t=this._tileAtlas.allocateTile();return this._tileHandleToKey.set(t,e),this._keyToTileHandle.set(e,t),t}getOrInsertOrNull(e,t){let n=new In(Ar.solidColorRect(t,O.BLACK,1),e).optimized();if(n==null)return null;let o=new mA(n,t),i=new Jp(o,this);return i.tileHandleOrNull=this._keyToTileHandle.get(o,null),i.neededImagesOrNull=this._keyToNeededImages.get(o,null),i}setNeededImagesForTile(e,t){this._keyToNeededImages.set(e.key,t),e.neededImagesOrNull=t}maximumCapacity(){return this._tileAtlas.maximumCapacity()}prepareForNewFrame(){this._tileAtlas.prepareForNewFrame()}totalVRAM(){return this._tileAtlas.totalVRAM()}hasRenderedContent(e){return e.tileHandleOrNull!=null&&this._tileAtlas.tileIsStillValid(e.tileHandleOrNull)}prepareToRenderTo(e,t){return this.hasRenderedContent(e)||(e.tileHandleOrNull=this._allocateTileHandle(e.key)),this._tileAtlas.viewportForTile(e.tileHandleOrNull,t),this._tileAtlas.framebufferForTile(e.tileHandleOrNull)}textureRegionOrNull(e){if(!this.hasRenderedContent(e))return null;let t=G.new2();this._tileAtlas.viewportForTile(e.tileHandleOrNull,t);let n=this._tileAtlas.framebufferForTile(e.tileHandleOrNull).colorTexture();return new tp(n,t.scaledBy1(1/n.width()))}devalueTile(e){this._tileAtlas.devalueTile(e.tileHandleOrNull)}clear(){this._tileAtlas.clearCache(),this._resetMaps()}};var Ti=class Ti{constructor(e,t,n,o){this._boundsCache=Ki._new(),this._backbuffer=null,this._prepareForEfficientCompositingMemoized=null,this._context=e,this._compositeTileCache=t,this._renderer=n,this._protoCleanUpInterruptCallback=o,this._prepareForEfficientCompositingMemoized=lA(i=>{let a=this._prepareForEfficientCompositing(i);return Ti._VERBOSE_LOGS&&(console.log("Before Preparation for Rasterization"),console.log("--------------"),console.log(i.debugString1()),console.log(""),console.log("After Preparation for Rasterization"),console.log("--------------"),console.log(a.debugString1())),a})}beginFrameAndCreateBudget(){this._compositeTileCache.prepareForNewFrame(),Ki.clear(this._boundsCache),this._context.resetNumFramebufferSwitches();let e=this._compositeTileCache.maximumCapacity();return e>=1e3&&(Ti._alreadyLoggedTooManyTiles||(Ae.trackEvent("viewer_prototype_too_many_tiles",{numTiles:e}),Ti._alreadyLoggedTooManyTiles=!0)),new Ti.FrameBudget(this._context,Ti.FrameBudget.defaultTimeBudgetInSeconds,Ti.FrameBudget.defaultTileRenderingBudget,e,Ti.FrameBudget.defaultFramebufferSwitchBudget)}prepareForEfficientCompositing(e){return this._prepareForEfficientCompositingMemoized(e)}_prepareForEfficientCompositing(e){if(e!=null&&e.isAxisAlignedRectFill()){let t=e;if(Se.onlySolidPaintOrNull(t.geometry.paints)!=null)return e}if(e.op()==11){let t=e;return new Eo(this._prepareForEfficientCompositing(t.child),t.transform)}if(e.canCacheRasterized())return new jp(e,this._compositeTileCache);switch(e.op()){case 0:{let t=e;return new qa(this._prepareForEfficientCompositing(t.child),t.flags)}case 2:{let t=e;return new _i(this._prepareForEfficientCompositing(t.child))}case 1:{let t=e,n=[],o=[];for(let i of t.children)if(i.canCacheRasterized())o.push(i);else{if(o.length!=0){let a=ke.wrap(o);n.push(this._prepareForEfficientCompositing(a)),o=[]}n.push(this._prepareForEfficientCompositing(i))}if(o.length!=0){let i=ke.wrap(o);n.push(this._prepareForEfficientCompositing(i))}return ke.wrap(n)}case 5:{let t=e;return new In(this._prepareForEfficientCompositing(t.alpha),this._prepareForEfficientCompositing(t.color),t.type,t.innerShadowFill,t.innerShadowAlphaRequiresHardMask)}case 6:{let t=e;return t.endRadius>=1?t:oo.createForStandardBlur(t.endRadius,this._prepareForEfficientCompositing(t.child),t.clamp)}case 7:{let t=e;return new io(t.blendMode,t.opacity,this._prepareForEfficientCompositing(t.child))}case 9:{let t=e;return new To(this._prepareForEfficientCompositing(t.alpha),t.color)}case 10:{let t=e;return new rt(this._prepareForEfficientCompositing(t.child),t.id,t.property,t.getter)}case 11:{let t=e;return new Eo(this._prepareForEfficientCompositing(t.child),t.transform)}case 12:{let t=e;return new cn(this._prepareForEfficientCompositing(t.startChild),this._prepareForEfficientCompositing(t.endChild),t.id,t.progressFn)}case 3:case 4:{if(e.hasAnimatingMedia()||e.hasVolatileContent()&&e.op()!=8)return e;throw new Error(`Unexpectedly received ${En[e.op()]} node`)}case 8:throw new Error(`Unexpectedly received ${En[e.op()]} node`);default:throw new Error(`Node type ${En[e.op()]} is unhandled`)}}getPrioritizedListOfTilesToPopulate(e,t,n,o){let i=[J.new2()],a=[J.new2()],s=[1],l=[],d=p=>{switch(p.op()){case 10:{let u=p;switch(u.property){case 2:{let _=J.new3(ne.List_last(i));_.multipliedBy1(u.transform()),i.push(_);let h=J.new3(u.transform());h.invert()||h.copyFrom(yt.FrozenAffineTransform_IDENTITY),h.multipliedBy1(ne.List_last(a)),a.push(h);break}case 0:{let _=J.new3(ne.List_last(i));_.multipliedBy1(ne.List_last(a)),i.push(_);let h=J.new2();a.push(h);break}case 1:{a.push(J.new2());break}case 3:{s.push(u.maxTransformScale());break}}break}case 11:{let u=p,_=J.new3(ne.List_last(i));_.multipliedBy1(u.transform),i.push(_);let h=J.new3(u.transform);h.invert()||h.copyFrom(yt.FrozenAffineTransform_IDENTITY),h.multipliedBy1(ne.List_last(a)),a.push(h);break}case 8:{let u=p,_=ne.List_last(i),h=J.new3(_);h.invert();let S=G.new3(n);h.transformRect(S);let m=G.new3(t);h.transformRect(m);let f=e*ne.List_last(s),T=(this._context.maxTextureSize()/tr.TILE_SIZE|0)**2;Y.viewerDoubleTileCompositionLimit()&&(T*=2),u.setDevicePixelPerCanvasPixel(f);let y=u.numTilesNeededForBounds(m);if(y>T){let E=Math.ceil(Math.log(y/T)/Math.log(4));f/=Math.pow(2,E),u.setDevicePixelPerCanvasPixel(f),y=u.numTilesNeededForBounds(m),y>T&&(f/=2),u.setDevicePixelPerCanvasPixel(f)}u.forEachTileWithinBounds(0,S,E=>{let A=E.bounds().distanceTo(m)*_.scale1().maxComponent();l.push(new Ti.TileWithPriority(E,A))});break}}},c=p=>{switch(p.op()){case 10:{let u=p.property;(u==2||u==0||u==1)&&ne.List_removeLast(a),(u==2||u==0)&&ne.List_removeLast(i),u==3&&ne.List_removeLast(s);break}case 11:{ne.List_removeLast(a),ne.List_removeLast(i);break}}};return Or.visitEachNodeInTree(o,d,c),l.sort((p,u)=>p.canvasSpaceDistanceToViewport<u.canvasSpaceDistanceToViewport?-1:1),l}cleanExistingInterrupt(e){this._renderer.cleanUpExistingInterrupt(),this._compositeTileCache.devalueTile(e),this._protoCleanUpInterruptCallback(),e.tileHandleOrNull=null,e.neededImagesOrNull=null}ensureTileIsPopulatedContinue(e,t,n){let o=G.new2(),i=this._compositeTileCache.prepareToRenderTo(e,o),a=!0,s=new Xi(e.key.tree,a,this._boundsCache,n,!1,!0,!1);return this._renderer.drawTileContinued(o,e.canvasSpaceBounds().x(),e.canvasSpaceBounds().y(),e.canvasSpaceBounds().width(),i,s,t)==null?(this.cleanExistingInterrupt(e),2):(t.recordTileWasRendered(),0)}ensureTileIsPopulated(e,t,n){if(t.recordTileCacheSlotWasUsed(),this._compositeTileCache.hasRenderedContent(e))return 2;let o=G.new2(),i=this._compositeTileCache.prepareToRenderTo(e,o),a=!0,s=new Xi(e.key.tree,a,this._boundsCache,n,!1,!0,!1),l=()=>{this.cleanExistingInterrupt(e)},d=this._renderer.drawTile(o,e.canvasSpaceBounds().x(),e.canvasSpaceBounds().y(),e.canvasSpaceBounds().width(),i,s,t,l);return d.status!=1&&t.recordTileWasRendered(),this._compositeTileCache.setNeededImagesForTile(e,d.neededImagesOrNull),d.status==1?1:0}drawToScreen(e,t,n,o,i,a){this._context.annotate("Composite",()=>{var v;let s=Gn.new2();s.copyFrom(t);let l=s.invert();if(this._backbuffer==null||this._backbuffer.colorTexture().width()!=(n.size().x()|0)||this._backbuffer.colorTexture().height()!=(n.size().y()|0)){this._backbuffer!=null&&this._backbuffer.deleteTexture();let A=this._context.createTexture(be.RGBA_LINEAR_CLAMP,n.size().x()|0,n.size().y()|0,yr.BACKBUFFER),I=this._context.createTexture(be.STENCIL,n.size().x()|0,n.size().y()|0,yr.BACKBUFFER);this._backbuffer=this._context.createFramebuffer(A,I,"Compositor Backbuffer")}this._context.clear(0,O.TRANSPARENT,this._backbuffer);let d=Y.viewerLargeTilesDrawToScreen(),c=d?Hf():tr.TILE_SIZE,p=new G(0,0,c,c),u=G.new2();Y.internalDebugTools()&&(e=this._renderer.treeToRender(e));let _=!1,h=!0,S=new Xi(e,_,this._boundsCache,a,h,!1,d);for(let A=n.left();A<=n.right();A+=c)for(let I=n.top();I<=n.bottom();I+=c)p.setX(A),p.setY(I),u.copyFrom(p),s.transformRect(u),p.translate2(n.topLeft().negative()),this._renderer.drawTile(p,u.x(),u.y(),u.width(),this._backbuffer,S,null,null);Y.internalDebugTools()&&this._renderer.finishLayerByLayerDrawToScreen();let m=J.new2();m.translate2(-1,1),m.scale4(2/o.width(),-2/o.height());let f=G.new2();f.copyFrom(n),f.transformBy1(m),f.setY(f.y()+f.height()),f.setHeight(-f.height());let T=null,y=new G(o.left()|0,o.top()|0,o.width()|0,o.height()|0);this._context.clear(0,i,T,null,y);let E=G.UNIT;this._renderer.drawTextureToCurrentFramebuffer((v=this._backbuffer)==null?void 0:v.colorTexture(),E,null,f,yt.FrozenAffineTransform_IDENTITY,1,1,T,y)})}};Ti._VERBOSE_LOGS=!1,Ti._alreadyLoggedTooManyTiles=!1;var pl=Ti;(t=>{class r{overlapsViewport(){return this.canvasSpaceDistanceToViewport==0}constructor(o,i){this.node=o,this.canvasSpaceDistanceToViewport=i}}t.TileWithPriority=r;class e{constructor(o,i,a,s,l){var d;this._context=o,this._renderingDeadline=0,this._tileRenderingBudgetRemaining=0,this._tileCacheCapacityRemaining=0,this._overrideFrameBudget=!1,this._renderingDeadline=Me.seconds()+i,this._tileRenderingBudgetRemaining=a,this._tileCacheCapacityRemaining=s,this._framebufferSwitchBudget=l,this._budgetCreationTimeMs=Me.milliseconds(),this._safeModeRenderingBudgetLimitMs=(d=Ac.safeModeOptions)==null?void 0:d.getForcedRenderTimeMs(),this.isSafeModeRendering=this._safeModeRenderingBudgetLimitMs>0}recordTileWasRendered(){this._tileRenderingBudgetRemaining=this._tileRenderingBudgetRemaining-1}recordTileCacheSlotWasUsed(){this._tileCacheCapacityRemaining=this._tileCacheCapacityRemaining-1}tileCacheCapacityRemaining(){return this._tileCacheCapacityRemaining}permitsMoreWork(){return this._safeModeRenderingBudgetLimitMs>0&&Me.milliseconds()-this._budgetCreationTimeMs>this._safeModeRenderingBudgetLimitMs?!1:this._overrideFrameBudget?!0:!(this.pastRenderingBudgetTime()>=0||this._tileRenderingBudgetRemaining<=0||this._tileCacheCapacityRemaining<=0||this._framebufferSwitchBudget-this._context.getNumFramebufferSwitches()<=0)}pastRenderingBudgetTime(){return Me.seconds()-this._renderingDeadline}frameBufferSwitchBudgetRemaining(){return this._framebufferSwitchBudget-this._context.getNumFramebufferSwitches()}tileRenderingBudgetRemaining(){return this._tileRenderingBudgetRemaining}permitWorkAfterBudgetExceeded(){this._overrideFrameBudget=!0}forbidWorkAfterBudgetExceeded(){this._overrideFrameBudget=!1}frameBudgetOverride(){return this._overrideFrameBudget}}e.defaultTimeBudgetInSeconds=.016,e.defaultTileRenderingBudget=2,e.defaultFramebufferSwitchBudget=250,t.FrameBudget=e})(pl||(pl={}));var Ec=class{constructor(e,t,n,o,i){this._boundsCache=Ki._new();this._context=e,this._renderer=t,this._requestImage=n,this._emitter=o,this._tag=i}generateThumbnail(e,t,n,o){if(!e.hasBeenLoaded()||!this._canGenerateThumbnailForNode(e))return console.log(`Cannot generate thumbnail for node from thumbnail renderer ${this._tag}. Check that the node is loaded and compatible with the generator.`),null;this._resetBuffer(n,o);let i=this._getTileRenderingOptionsForNode(e),a=tr.TILE_SIZE;for(let l=0;l<=n;l+=a)for(let d=0;d<=o;d+=a){let c=new G(l,d,a,a),p=G.new2();p.copyFrom(c),t.transformRect(p),this._renderer.drawTile(c,p.x(),p.y(),p.width(),this._frameBuffer,i,null,null)}return this._context.readPixels(this._frameBuffer,0,0,n,o)}handleImageLoaded(e){this._dirtyNode(e)}handleObjectAnimationStateChange(e){this._dirtyNode(e)}handleSceneGraphEvent(e){this._shouldDirtyNodeFromEvent(e)&&this._dirtyNode(e.node)}_resetBuffer(e,t){this._frameBuffer!=null&&this._frameBuffer.deleteTexture();let n=this._context.createTexture(be.RGBA_LINEAR_CLAMP,e,t,yr.EXPORT),o=this._context.createTexture(be.STENCIL,e,t,yr.EXPORT);this._frameBuffer=this._context.createFramebuffer(n,o,this._tag)}_dirtyNode(e){let t=this._getDirtyContainerNodeFor(e);t&&this._emitter.trigger("nodeThumbnailInvalidated",t.id())}};var Kh=class extends Ec{constructor(e,t,n,o){super(e,t,n,o,"slide_thumbnail_renderer")}_canGenerateThumbnailForNode(e){return e.type()==="SLIDE"}_getTileRenderingOptionsForNode(e){let t=new Nt(e),n=e.renderTreeForSlideThumbnail2(t);return new Xi(n,!0,this._boundsCache,this._requestImage,!1,!1,!1)}_getDirtyContainerNodeFor(e){return e.findNearestAncestorOrSelf("SLIDE")}_shouldDirtyNodeFromEvent(e){switch(e.property){case 68:case 69:case 71:case 72:case 75:case 90:case 93:case 108:case 109:return!1;case 30:case 32:case 101:return e.node.type()!=="SLIDE";default:return!0}}};var Ru=class extends Ec{constructor(e,t,n,o){super(e,t,n,o,"fd_thumbnail_renderer")}_canGenerateThumbnailForNode(e){return this._isTlf(e)}_getTileRenderingOptionsForNode(e){let t=new Nt(e),n=e.renderTreeForBaseScreen2(t);return new Xi(n,!0,this._boundsCache,this._requestImage,!1,!1,!1)}_getDirtyContainerNodeFor(e){let t=e;for(;t!==null;){if(this._isTlf(t))return t;t=t.parent()}return t}_shouldDirtyNodeFromEvent(e){switch(e.property){case 68:case 69:case 71:case 72:case 75:case 90:case 93:case 108:case 109:return!1;case 30:case 32:case 101:return!this._isTlf(e.node);default:return!0}}_isTlf(e){return e.type()==="FRAME"&&e.isTopLevel()}};var co=class co{constructor(e,t,n,o,i,a,s){this._interruptCompletionCallback=null;this._isInViewerRenderServerForTests=!1;this._frameIndexForTests=0;this._prerenderViewport=new Jo,this._devicePixelRatio=0,this._needsBlit=!0,this._isAnimatedMediaPlaying=!1,this._printRenderTree=!1,this._activeRenderTree=null,this._overlayBaseScreenId=null,this._generatedOverlays=new Map,this._debouncedDevicePixelsPerCanvasPixel=null,this._didRasterizeContentOnLastDraw=!0,this._observers=new jr,this._requestImageOnScreen=null,this._requestImageForPrerendering=null,this.PORTION_TO_LOG=50/100,this.MAX_TRANSITION_LOGS=50,this._numTransitionsLogged=0,this._transitionStats=new Map,this._transitionWasInterruptedByVisibilityChange=!1,this._visibilityListener=null,this.HEADERS=["frame_count","transition_count","mean_frame_ms","median_transition_mean","median_transition_max","count_0_to_20ms","count_20_to_40ms","count_40_to_80ms","count_80_to_160ms","count_160_to_320ms","count_320_to_640ms","count_640_ms_or_higher"],this._ongoingTransition=null,this._drewFirstFrameOfTransition=!0,this._transitionProgressTracker=new pn,this._ongoingObjectAnimation=null,this._objectAnimationProgressTracker=new pn,this._hsmTransitionMap=new Map,this._consolidatedRenderTreeForMagicMove=null,this._appState=t,this._context=i,this._bufferPool=a,this._compositeTileCache=new yu(this._context,this._bufferPool),this._renderer=s;let l=()=>{this._interruptCompletionCallback=null};this._compositor=new pl(this._context,this._compositeTileCache,this._renderer,l),this._viewport=e,this._appState.addAppObserver(this),this._emitter=o,this._renderer.context().addContextResetHandler(()=>{this._deviceRenderer.clearOnContextReset(),this._viewport.invalidate(),Y.shouldApplyMobileOptimizations()&&n.clearQueuesAndDecodedDataForAllImages(this._canvas())}),n.onImageLoaded=c=>{var p;c.invalidateRenderTreeForSelfAndParents(),this._dirtinessTracker.handleImageLoaded(c),(p=this._thumbnailRenderer)==null||p.handleImageLoaded(c),this._viewport.invalidate()};let d=c=>{this._onBoundsInvalidate(c)};this._dirtinessTracker=new Au(d),this._smoothPath=new Ba(this._context,this._bufferPool),this._deviceRenderer=new Mh(this._context,this._bufferPool),this._hotspotRenderer=new wh(this._context,this._bufferPool),this._debouncedDevicePixelsPerCanvasPixel=new fu(c=>{t.addFrameObserver(c)},2,(c,p)=>c==p,()=>{this.setNeedsBlit(!0)}),this._initMagicMoveRenderTreeCache(),this._requestImageOnScreen=(c,p)=>{let u=dn.forOnScreenPurpose(p);n.requestImageForRendering(c,u)},this._thumbnailRenderer=null,this._requestImageForPrerendering=(c,p)=>{let u=dn.forPrerenderPurpose(p);n.requestImageForRendering(c,u)},console.debug(`Graphics card: '${this._context.graphicsCardName()}'`)}setInViewerRenderServerForTests(e){Gr()&&(this._isInViewerRenderServerForTests=e)}toggleRenderTreePrinting(){this._printRenderTree=!this._printRenderTree,this._printRenderTree&&this._activeRenderTree!=null&&console.log(this._activeRenderTree.debugString1())}_currentBaseScreenId(){var e;return(e=this._appState.prototypeState().getCurrentBaseScreenNode())==null?void 0:e.id()}_currentOverlayData(){return this._appState.prototypeState().getCurrentOverlayData()}addObserver(e){this._observers.add(e)}removeObserver(e){this._observers.remove(e)}setBackgroundEnabled(e){}_uninitialize(){this._debouncedDevicePixelsPerCanvasPixel.unregister(e=>{this._appState.removeFrameObserver(e)}),this._appState.removeAppObserver(this)}isRenderingDone(){return!this._didRasterizeContentOnLastDraw}getContext(){return this._context}graphicsCardName(){return this._context.graphicsCardName()}setNeedsBlit(e){this._needsBlit=e,this._observers.forEach(t=>{t.handleSetNeedsBlit(e)})}checkNeedsBlit(){return this.setNeedsBlit(this._needsBlit||this._viewport.isInvalid()||this.isTopLevelTransitionOngoing()||this._animatedMediaPlaying()||this._hsmTransitionMap.size>0),this._needsBlit||ca.hasUnexpectedCompositingBug()}deviceRenderer(){return this._deviceRenderer}initializeThumbnailRenderer(e){var t,n;if(this._thumbnailRenderer){console.warn("Prototype node thumbnail renderer has already been initialized");return}switch(e){case"SLIDES":this._thumbnailRenderer=new Kh(this._context,this._renderer,this._requestImageOnScreen,this._emitter);break;case"DESIGN":this._thumbnailRenderer=new Ru(this._context,this._renderer,this._requestImageOnScreen,this._emitter);break;default:console.warn(`Unexpected editorType ${e} while initializing thumbnail renderer, falling back to TlfThumbnailRenderer`),this._thumbnailRenderer=new Ru(this._context,this._renderer,this._requestImageOnScreen,this._emitter)}(n=(t=this._canvas())==null?void 0:t.scene())==null||n.addObserver(this._thumbnailRenderer)}thumbnailRenderer(){return this._thumbnailRenderer}changeFitMode(e){this._viewport.invalidate()}setZoomScale(e){}updateScroll(e){this.setNeedsBlit(!0)}handleSceneChange(e,t){this._debouncedDevicePixelsPerCanvasPixel.clear()}handleActiveCanvasChange(e,t){this._renderer.setCanvas(t),e!=null&&(e.scene().removeObserver(this._dirtinessTracker),this._thumbnailRenderer&&e.scene().removeObserver(this._thumbnailRenderer)),t!=null&&(t.scene().addObserver(this._dirtinessTracker),this._thumbnailRenderer&&t.scene().addObserver(this._thumbnailRenderer)),this._dirtinessTracker.initCanvas(t)}handleActivePrototypeStartingPointChange(e,t){}resize(e,t,n,o){let a=new b(e,t).multiplyScalar(o),s=this._context.resizeDefaultFramebuffer(Math.round(a.x())|0,Math.round(a.y())|0);return this._devicePixelRatio=o,this.setZoomScale(n),this._debouncedDevicePixelsPerCanvasPixel.clear(),new sa(s.canvasSize.divideScalar(o),s.webGLDidAdjustCanvasSize)}drawBlank(){this._context.annotate("Draw blank",()=>{Y.isInlinePreview()&&this._ongoingTransition!=null&&this._onBeforeFrameForTransition(),this._renderer.context().beginFrame(),this._renderer.context().clear(0,O.TRANSPARENT,null)})}_renderTreeToDraw(e){if(this.isTopLevelTransitionOngoing())return this._renderTreeForTransition(e);{let t=this._appState.prototypeState().getCurrentBaseScreenNode(),n=this._appState.prototypeState().bindOverlays(this._currentOverlayData());return Ae.perfTimerScope("invalidateDirtyTiles",Ae.ProfileLevel.LEGACY,()=>{this._dirtinessTracker.invalidateDirtyTiles(this._canvas(),new Si(this._canvas(),this._hsmTransitionMap,new Oa(this._generatedOverlays),this._appState.prototypeStructure().nodeTransitionTracker().getStateGroupStateSwapInteractionCounts(),this._ongoingObjectAnimation,this._objectAnimationProgressTracker))}),this._generatedOverlays=new Map,this._renderTreeForBaseScreenAndOverlays(t,n)}}_renderTreeForBaseScreenAndOverlays(e,t){if(e==null)return null;let n=ye.renderTreeForBaseScreenWithPerfLogging(e,new Si(e,this._hsmTransitionMap,null,this._appState.prototypeStructure().nodeTransitionTracker().getStateGroupStateSwapInteractionCounts(),this._ongoingObjectAnimation,this._objectAnimationProgressTracker),"_renderTreeForBaseScreenAndOverlays");return n==null?null:rt.forTransformIsolation(ke.wrap([this._compositor.prepareForEfficientCompositing(n),this._renderTreeForOverlays(e,t)]).optimized())}_renderTreeForOverlays(e,t){let n=[],o=new Oa;for(let i=0,a=t.length;i<a;i=i+1){let s=ye.renderTreeForOverlayBackground(t[i].backgroundAppearance(),e.canvasSpaceBoundingBox());s!=null&&n.push(s);let l=this._renderTreeForOverlay1(t[i],e,i,o,null);l!=null&&n.push(l)}return ke.wrap(n)}_renderTreeForOverlay1(e,t,n,o,i){return this._renderTreeForOverlay2(e,t,n,null,o,i)}_renderTreeForOverlay2(e,t,n,o,i,a){if(t==null)return null;let s=e.node();if(s==null)return null;let l=e.renderedBounds(t),d=s.canvasSpaceBoundingBox(),c=l.center().subtract(d.center());this._overlayBaseScreenId!=null&&t.id()!=this._overlayBaseScreenId&&(s.invalidateRenderTreeForSelfAndParents(),s.invalidateRenderTreeForChildren()),this._overlayBaseScreenId=t.id();let p=new Nt(t,null),u=new nc(e.id(),e.node(),l,p,e.backgroundAppearance(),o,()=>c,a);i.addEntry(e.id(),u),this._generatedOverlays.set(e.id(),u);let _=ye.renderTreeForOverlayWithPerfLogging(s,new Si(s,this._hsmTransitionMap,i,this._appState.prototypeStructure().nodeTransitionTracker().getStateGroupStateSwapInteractionCounts(),this._ongoingObjectAnimation,this._objectAnimationProgressTracker),"_renderTreeForOverlay");if(_==null)return null;let h=this._compositor.prepareForEfficientCompositing(_);return h=rt.forTranslation(h,ft.forOverlayPosition(n),()=>c),h}_animatedMediaPlaying(){return this._isAnimatedMediaPlaying}_setAnimatedMediaPlaying(e){this._isAnimatedMediaPlaying=e}draw(e,t,n,o){var l;if(this._didRasterizeContentOnLastDraw=!1,this._renderer.context().isContextLost())return 2;if(((l=this._canvas())==null?void 0:l.scene())==null)return 2;if(this._currentTlf()==null)return 2;if(n.viewSpaceBounds().isEmpty())return 2;let i=this._compositor.beginFrameAndCreateBudget();var a="";let s=this._context.annotateAndReturn("draw",()=>{var E,v,A;let d=i.tileCacheCapacityRemaining();this._interruptCompletionCallback==null&&this._renderer.context().beginFrame(),this._isInViewerRenderServerForTests&&Gr()&&(this._renderer.context().getGpuMetricsCollection().nextFrame(this._frameIndexForTests++),Ae.nextFrame(this._renderer.context().getGpuMetricsCollection().getCurrentFrameIndex()));let c=this._ongoingTransition!=null,p=this._ongoingObjectAnimation!=null,u=this.isTopLevelTransitionOngoing();c&&this._onBeforeFrameForTransition(),p&&this._onBeforeFrameForObjectAnimation(),this._onBeforeFrameForHsm();let _=this._renderTreeToDraw(n);this._activeRenderTree=_,_!=null&&this._setAnimatedMediaPlaying(_.hasAnimatingMedia()),this._debouncedDevicePixelsPerCanvasPixel.queueValue(n.zoomScale()*this._devicePixelRatio);let h=this._debouncedDevicePixelsPerCanvasPixel.hasQueuedValue()&&!(u&&!this._drewFirstFrameOfTransition);this._drewFirstFrameOfTransition=!0;let S=[],m=0,f=G.new2();n.computeCanvasSpaceBounds1(f);let T=this.currentCanvasSpacePreviewBounds();if(T==null)return Ae.trackEvent("prototype_null_canvas_space_preview_bounds",{currentTlfID:((E=this._currentTlf())==null?void 0:E.id)??"null",baseScreenNodeID:((v=this._appState.baseScreenNode())==null?void 0:v.id)??"null",sceneNull:((A=this._canvas())==null?void 0:A.scene())==null,transitionOngoing:this._ongoingTransition!=null}),2;let y=this.currentCanvasSpaceFrameBounds()!=null?this.currentCanvasSpaceFrameBounds().topLeft():new b(0,0);return T.intersectWith(f),this._interruptCompletionCallback&&Ae.perfTimerScope("interruptCompletion",Ae.ProfileLevel.LEGACY,()=>{i.permitWorkAfterBudgetExceeded(),this._interruptCompletionCallback(i),i.forbidWorkAfterBudgetExceeded(),this._context.getGpuMetricsCollection().getCurrentFrameGPUMetrics()._bgtDidCompleteInterruptedFrame=!0,this._interruptCompletionCallback=null}),this._renderer.context().beginFrame(),Ae.perfTimerScope("drawOnScreenTiles",Ae.ProfileLevel.LEGACY,()=>{this._context.annotate("On-screen tiles",()=>{if(!h){let g=G.new3(T);for(g.expandedBy1(T.height()),S=this._compositor.getPrioritizedListOfTilesToPopulate(this._debouncedDevicePixelsPerCanvasPixel.getValue(),T,g,_),i.permitWorkAfterBudgetExceeded();m<S.length&&(!i.isSafeModeRendering||i.permitsMoreWork());){let R=S[m];if(!R.overlapsViewport()){a+="tileOutsideViewport_";break}let D=this._compositor.ensureTileIsPopulated(R.node,i,this._requestImageOnScreen);D==0?(this._didRasterizeContentOnLastDraw=!0,co.VERBOSE_LOGS&&console.log(`ProtoRenderManager: Rendered tile for current frame INSIDE of viewport. Capacity left: ${i.tileCacheCapacityRemaining()} / ${d}`),this._context.getGpuMetricsCollection().getCurrentFrameGPUMetrics()._bgtOnScreenTileCompletionCount++):D==1&&(this._didRasterizeContentOnLastDraw=!0,this._interruptCompletionCallback=P=>{this._compositor.ensureTileIsPopulatedContinue(R.node,P,this._requestImageForPrerendering)==0&&(this._didRasterizeContentOnLastDraw=!0)}),m=m+1}i.forbidWorkAfterBudgetExceeded()}})}),this._interruptCompletionCallback!=null?(a+="safeModeInterrupt_",1):(Ae.perfTimerScope("drawToScreen",Ae.ProfileLevel.LEGACY,()=>{var I;if(this._needsBlit){this._printRenderTree&&console.log(_.debugString1());let C=G.new2(),g=0,R=(I=this._canvas())==null?void 0:I.prototypeDevice(),D=R!=null&&R.type=="PRESET"&&this._appState.prototypeState().showDeviceFrame(),P=this._appState.prototypeState().showTransparentBackground();D?(C.setTo2(y,R.size()),g=O.BLACK):(C.copyFrom(T),g=o.backgroundColor),P&&(g=O.TRANSPARENT);let U=Gn.new2().scaledBy(this._devicePixelRatio).multipliedBy(n.canvasSpaceToViewSpace1());U.transformRect(C),C.round();let B=n.viewSpaceBounds(),M=new G(B.left()*this._devicePixelRatio,B.top()*this._devicePixelRatio,B.width()*this._devicePixelRatio,B.height()*this._devicePixelRatio).rounded();this._compositor.drawToScreen(_,U,C,M,g,this._requestImageOnScreen),this._context.getGpuMetricsCollection().getCurrentFrameGPUMetrics().setCurrentFrameSubMetricsType(ga.GpuSubMetricsType.OVERLAY_UI_RENDERING),this._drawUI(n,o),this._context.getGpuMetricsCollection().getCurrentFrameGPUMetrics().setCurrentFrameSubMetricsType(ga.GpuSubMetricsType.SCENE_GRAPH_RENDERING),this.setNeedsBlit(!1),this._context.getGpuMetricsCollection().getCurrentFrameGPUMetrics()._bgtBlitToScreen=!0}}),Ae.perfTimerScope("drawOffScreenTiles",Ae.ProfileLevel.LEGACY,()=>{this._context.annotate("Off-screen tiles",()=>{if(!h){for(var I=i.permitsMoreWork();(I=i.permitsMoreWork())&&m<S.length;){let C=this._compositor.ensureTileIsPopulated(S[m].node,i,this._requestImageForPrerendering);if(C==0)this._didRasterizeContentOnLastDraw=!0,this._context.getGpuMetricsCollection().getCurrentFrameGPUMetrics()._bgtOffScreenTileCompletionCount++;else if(C==1){this._didRasterizeContentOnLastDraw=!0;let g=S[m].node;this._interruptCompletionCallback=R=>{this._compositor.ensureTileIsPopulatedContinue(g,R,this._requestImageForPrerendering)==0&&(this._didRasterizeContentOnLastDraw=!0)},a+="optionalOffscreenInterrupt_";break}C==0&&co.VERBOSE_LOGS&&console.log(`ProtoRenderManager: Rendered tile for current frame OUTSIDE of viewport. Capacity left: ${i.tileCacheCapacityRemaining()} / ${d}`),m=m+1}if(I||(a+="offscreenHitBudget_"),m==S.length&&(a+="completedScreenTiles_"),t&&this._interruptCompletionCallback==null){let C=this._appState.prototypeState().bindOverlays(this._currentOverlayData()),g=null,R=this._appState.baseScreenNode().canvasSpaceBoundingBox().topLeft();for(let D of this._appState.prototypeStructure().getPrerenderingJobs(()=>i.permitsMoreWork())){let P=null,U=null,B=null,M=null,F=D.asScreen(),w=D.asSmartAnimate();if(F!=null){if(F.role==zr.FrameRole.BASE_SCREEN&&X.equals(F.nodeId,this._currentBaseScreenId())||(B=this._canvas().scene().findNode(F.nodeId),B==null||!B.hasBeenLoaded()))continue;if(!i.permitsMoreWork()){a+="startFutureFrame_";break}let Q=null;if(F.role==zr.FrameRole.OVERLAY){let j=kr.fromPrototypeAction(F.prototypeAction,0);Q=jd.BoundOverlay_computeNewBounds(B,this._appState.baseScreenNode(),j,R,B.overlayPositionType()),R=Q.topLeft();let pe=new Nt(this._appState.baseScreenNode(),null),Pe=new nc(B.id(),B,Q,pe,B.overlayBackgroundAppearance(),null,()=>B.canvasSpaceBoundingBox().topLeft().negative().add(R),null);this._generatedOverlays.set(B.id(),Pe),g==null&&(g=new Oa),g.addEntry(B.id(),Pe),P==null&&F.precedingOverlays!=null&&(P=new Oa)}if(F.role==zr.FrameRole.OVERLAY&&C.some(j=>X.equals(F.nodeId,j.id())))continue;if(M=this.canvasSpacePreviewBoundsForTransition(B,B),P!=null){let j=!1;for(let pe of F.precedingOverlays){let Pe=g.get(pe);if(Pe==null){j=!0;break}P.addEntry(pe,Pe)}if(j){a+="nonLoadedPrecedingOverlays_";break}}let K=new Si(B,this._hsmTransitionMap,P,this._appState.prototypeStructure().nodeTransitionTracker().getStateGroupStateSwapInteractionCounts(),this._ongoingObjectAnimation,this._objectAnimationProgressTracker);U=F.role==zr.FrameRole.BASE_SCREEN?ye.renderTreeForBaseScreenWithPerfLogging(B,K,"_draw"):ye.renderTreeForOverlayWithPerfLogging(B,K,"_draw")}else if(w!=null){let Q=this._canvas().scene().findNode(w.srcNodeId),K=this._canvas().scene().findNode(w.dstNodeId);if(Q==null||K==null||!Q.hasBeenLoaded()||!K.hasBeenLoaded())continue;M=this.canvasSpacePreviewBoundsForTransition(Q,K);let j=Tr.get(w.transitionType);U=this._renderTreeForMagicMove(Q,K,j,w.role,w.easingFunction),B=K}if(U==null)continue;if(!i.permitsMoreWork()){a+="beforePrepareFutureTree_";break}let V=this._compositor.prepareForEfficientCompositing(U);if(!i.permitsMoreWork()){a+="afterPrepareFutureTree_";break}this._prerenderViewport.copyFrom(this._viewport),this._prerenderViewport.updateForCurrentPreview(B.canvasSpaceBoundingBox(),M,this._appState.currentScalingInfo(),this._appState.activePrototypeDevice());let k=G.new2();this._prerenderViewport.computeCanvasSpaceBounds1(k),M.intersectWith(k);let H=this._prerenderViewport.zoomScale()*this._devicePixelRatio,z=this._compositor.getPrioritizedListOfTilesToPopulate(H,M,M,V);for(let Q of z){if(i.tileCacheCapacityRemaining()==0){a+="tileCapacityFutureFrame_";break}let K=this._compositor.ensureTileIsPopulated(Q.node,i,this._requestImageForPrerendering);if(K==0)this._didRasterizeContentOnLastDraw=!0,this._context.getGpuMetricsCollection().getCurrentFrameGPUMetrics()._bgtOptionalTileCompletionCount++,co.VERBOSE_LOGS&&console.log(`ProtoRenderManager: Rendering tile for future frame. Capacity left: ${i.tileCacheCapacityRemaining()} / ${d}`);else if(K==1){this._didRasterizeContentOnLastDraw=!0;let j=Q.node;this._interruptCompletionCallback=pe=>{this._compositor.ensureTileIsPopulatedContinue(j,pe,this._requestImageForPrerendering)==0&&(this._didRasterizeContentOnLastDraw=!0)},a+="optionalFutureInterrupt_";break}if(!i.permitsMoreWork()){a+="postFutureFrameRaster_";break}}}}}})}),0)});return this._context.getGpuMetricsCollection().getCurrentFrameGPUMetrics()._bgtDidRasterWork=this._didRasterizeContentOnLastDraw,this._context.getGpuMetricsCollection().getCurrentFrameGPUMetrics()._bgtHasPendingInterruptForNextFrame=this._interruptCompletionCallback!=null,this._context.getGpuMetricsCollection().getCurrentFrameGPUMetrics()._bgtBrokeRenderAt=a,this._renderer.context().getGpuMetricsCollection().getCurrentFrameGPUMetrics().updateFrameBudgetInfo(i),s}_canvas(){return this._appState.getActiveCanvas()}_currentTlf(){var e;return(e=this._canvas())==null?void 0:e.scene().findNode(this._currentBaseScreenId())}_drawUI(e,t){this._context.annotate("Draw UI",()=>{if(this._appState.getActiveCanvas()==null)return;let n=this.currentCanvasSpacePreviewBounds(),o=this.currentCanvasSpaceFrameBounds().topLeft(),i=G.new2();e.computeCanvasSpaceBounds1(i);let l=1/(e.zoomScale()*this._devicePixelRatio);if(n==null)return;let d=i.topLeft().subtract(n.topLeft()).makeAbs();this._smoothPath.setTransformAndPixelScale(e.canvasSpaceToClipSpace1(),l);let c=this._canvas().prototypeDevice(),p=c.type=="PRESET"&&this._appState.prototypeState().showDeviceFrame(),u=0;if(p&&gb(c.presetIdentifier)&&(u=25),!p)n.intersectWith(i),ul.drawPreviewStencil(this._smoothPath,e.zoomScale(),n,i,t.backgroundColor,u);else{let h=G.new2();h.setTo2(o,c.size()),h.expand1(1/e.zoomScale());let S=h.clone();n.intersectWith(i),h.intersectWith(i),ul.drawPreviewStencil(this._smoothPath,e.zoomScale(),h,i,t.backgroundColor,u,S)}this._drawDeviceFrameIfNecessary(this._smoothPath,e,this._currentTlf().canvasSpaceBoundingBox(),i),t.particles!=null&&ul.drawParticles(this._smoothPath,t.particles,1/e.zoomScale(),n),t.mouse!=null&&n.contains2(t.mouse)&&ul.drawMouseCursor(this._smoothPath,t.mouse,e.zoomScale()),t.hotspots!=null&&this._hotspotRenderer.draw(e.canvasSpaceToClipSpace1(),e.zoomScale(),t.hotspots,t.hotspotOpacity,this._devicePixelRatio),this._smoothPath.flush(),this.deviceRenderer().flush()})}drawDeviceFrameIfNecessary(e,t,n,o){return this._drawDeviceFrameIfNecessary(this._smoothPath,t,n,o)}_drawDeviceFrameIfNecessary(e,t,n,o){return this._canvas()==null||!this._appState.prototypeState().showDeviceFrame()?!1:(this._context.annotate("Draw device frame",()=>{var i;if(this.deviceRenderer().drawPrototypeDeviceIfAny(t,this._canvas().prototypeDevice(),n,t.canvasSpaceToClipSpace1()),this.deviceRenderer().isWaitingForDeviceFrameToLoad(this._canvas().prototypeDevice())){let a=u_((i=this._appState.baseScreenNode())==null?void 0:i.id(),this._appState.currentScalingInfo().fitMode,this._appState.prototypeState().showTransparentBackground(),this._canvas());e.fillRect(o,a)}}),!0)}_totalVRAM(){let e=0;return e=e+this._bufferPool.totalVRAM(),e=e+this._compositeTileCache.totalVRAM(),e=e+this._renderer.totalVRAM(),e}_onBoundsInvalidate(e){this._viewport.invalidate()}clearTileCaches(){this._compositeTileCache.clear()}_maybeLogPerformanceMetricsForTransition(){let e=this._transitionWasInterruptedByVisibilityChange;if(this._transitionWasInterruptedByVisibilityChange=!1,!(e||document.hidden)&&!this._transitionProgressTracker.isProgressControlledExternally()&&this._transitionProgressTracker.duration()>0){let t=Math.random()<this.PORTION_TO_LOG&&this._numTransitionsLogged<this.MAX_TRANSITION_LOGS;if(co.VERBOSE_LOGS||t){let n=this._transitionProgressTracker.frameTimesMs,o=n.length,i=0,a=0,s=0,l=0,d=0,c=0,p=0,u=0,_=0;for(let y of n)u=Math.max(u,y),_+=y,y<20?i=i+1:y<40?a=a+1:y<80?s=s+1:y<160?l=l+1:y<320?d=d+1:y<640?c=c+1:p=p+1;if(u>60*1e3)return;let h=_/o,S=this._ongoingTransition.change,m=S.transitionParameters.transitionType,f=m=="SMART_ANIMATE"||Rn.supportsSmartAnimate(m)&&S.transitionParameters.transitionShouldSmartAnimate,T=new Map([["is_smart_animate",f],["mean_frame_ms",h],["max_frame_ms",u],["frame_count",o],["count_0_to_20ms",i],["count_20_to_40ms",a],["count_40_to_80ms",s],["count_80_to_160ms",l],["count_160_to_320ms",d],["count_320_to_640ms",c],["count_640_ms_or_higher",p]]);co.VERBOSE_LOGS&&(console.group("ProtoRenderManager: Transition complete"),console.table(Ge.StringMap_toJSObject(T)),console.groupEnd()),t&&(Ae.trackEvent("viewer_transition_frame_times_v2",Ge.StringMap_toJSObject(T)),this._numTransitionsLogged=this._numTransitionsLogged+1)}}}triggerTransition(e,t,n){this._drewFirstFrameOfTransition=!1,this._ongoingTransition=new co.TransitionState(e,t),this._transitionProgressTracker.willStartTransitionWithDuration(e.transitionParameters.transitionDuration),n!=null&&dl.applyTo(n,this._transitionProgressTracker)}handleAbortedTransition(e){var t;e==((t=this._ongoingTransition)==null?void 0:t.change)&&(this._ongoingTransition=null)}handleCommittedTransition(e){var t;e==((t=this._ongoingTransition)==null?void 0:t.change)&&(this._ongoingTransition=null)}triggerHsmTransition(e,t,n){let o=e.toString(),i=new pn;i.willStartTransitionWithDuration(t.transitionParameters.transitionDuration),n!=null&&dl.applyTo(n,i),this._hsmTransitionMap.set(o,new co.InstanceSwapTransition(i,()=>{let a=i.progress();return t.transitionParameters.easingFunction==null||i.isProgressControlledExternally()?a:t.easingFunction().get(a)},t))}abortHsmTransition(e,t){this._hsmTransitionMap.delete(e.toString())}commitHsmTransition(e,t){this._hsmTransitionMap.delete(e.toString())}triggerObjectAnimation(e,t){co.VERBOSE_LOGS&&console.log("[ProtoRenderManager] triggerObjectAnimation",e),this._ongoingObjectAnimation=new co.TransitionState(e,t),this._objectAnimationProgressTracker.willStartTransitionWithDuration(e.transitionParameters.transitionDuration);let n=e.objectAnimationTargetNode(this._appState.scene());if(!n)throw new Error("Expected object animation target node");if(n.animatingFrom)throw new Error("Expected target node's animatingFrom property to be null when triggering a new object animation");let o=N().cloneNode(n.id()),i=this._appState.scene().findNode(o);if(!i)throw new Error("Expected cloned node");N().setNodeToInitialObjectAnimationState(o,n.id()),N().setNodeToFinalObjectAnimationState(n.id(),n.id()),n.animatingFrom=i;let a=this._appState.getActiveCanvas();a.invalidateRenderTreeForSelfAndParents(),a.invalidateRenderTreeForChildren()}_setObjectAnimationToState(e,t){var o,i,a;let n=(o=this._ongoingObjectAnimation)==null?void 0:o.change.objectAnimationTargetNode(this._appState.scene());n&&(n.animatingFrom=null,t==="initial"?N().setNodeToInitialObjectAnimationState(n.id(),n.id()):N().setNodeToFinalObjectAnimationState(n.id(),n.id()),this._dirtinessTracker.dirtyNode(n),(i=this._thumbnailRenderer)==null||i.handleObjectAnimationStateChange(n),n.invalidateRenderTreeForSelfAndParents(),n.invalidateRenderTreeForChildren()),e==((a=this._ongoingObjectAnimation)==null?void 0:a.change)&&(this._ongoingObjectAnimation=null)}handleAbortedObjectAnimation(e){co.VERBOSE_LOGS&&console.log("[ProtoRenderManager] handleAbortedObjectAnimation",e),this._setObjectAnimationToState(e,"initial")}handleCommittedObjectAnimation(e){co.VERBOSE_LOGS&&console.log("[ProtoRenderManager] handleCommittedObjectAnimation",e),this._setObjectAnimationToState(e,"final")}isTopLevelTransitionOngoing(){return this._ongoingTransition!=null&&this._transitionProgressTracker.isTransitionInProgress()}easedTransitionProgress(){let e=this._ongoingTransition;if(e==null)return 0;let t=this._transitionProgressTracker.progress();return e.change.easingFunction()==null||this._transitionProgressTracker.isProgressControlledExternally()?t:e.change.easingFunction().get(t)}_renderTreeForTransition(e){let t=this._ongoingTransition;return t==null?null:t.cachedRenderTree!=null?t.cachedRenderTree:X.equals(t.change.oldStateId(),t.change.newStateId())?this._renderTreeForOverlayTransition(t):this._renderTreeForBaseScreenTransition(t,e)}_initMagicMoveRenderTreeCache(){let e=a=>a[1]==zr.FrameRole.OVERLAY?ye.renderTreeWithPerfLogging2(a[0],new Si(a[0],this._hsmTransitionMap,null,this._appState.prototypeStructure().nodeTransitionTracker().getStateGroupStateSwapInteractionCounts(),this._ongoingObjectAnimation,this._objectAnimationProgressTracker),"_initMagicMoveRenderTreeCache"):ye.renderTreeForBaseScreenWithPerfLogging(a[0],new Si(a[0],this._hsmTransitionMap,null,this._appState.prototypeStructure().nodeTransitionTracker().getStateGroupStateSwapInteractionCounts(),this._ongoingObjectAnimation,this._objectAnimationProgressTracker),"_initMagicMoveRenderTreeCache"),t=a=>a,n=a=>a,o=(a,s,l,d)=>{let c=null;try{c=Po.renderTreeForMagicMove(a,s,()=>this.easedTransitionProgress(),d,l)}catch(p){c=new ke([]),Oe(p)}return co.VERBOSE_LOGS&&(console.log("Smart animate render tree"),console.log("-------------------------"),console.log(c.debugString1())),c},i=(a,s,l,d)=>o(a[0],s[0],l,d);this._consolidatedRenderTreeForMagicMove=Sb(i,e,e,t,n)}_renderTreeForMagicMove(e,t,n,o,i){return this._consolidatedRenderTreeForMagicMove([e,o],[t,o],n,i)}_preparedRenderTreeForMagicMove(e,t,n,o,i,a){let s=this._renderTreeForMagicMove(n,o,t,i,a);return e.cachedRenderTree=this._compositor.prepareForEfficientCompositing(s),e.cachedRenderTree}_renderTreeForBaseScreenTransition(e,t){let n=e.change,o=e.viewportBeforeTransition.zoomScale()*this._devicePixelRatio,i=this._appState.prototypeState().lastNodeForBaseScreen();if(i==null)return null;let a=t.zoomScale()*this._devicePixelRatio,s=this._appState.prototypeState().nextNodeForBaseScreen();if(s==null)return null;let l=n.oldOverlays(this._appState.prototypeState()),d=n.newOverlays(this._appState.prototypeState()),c=Tr.get(n.transitionParameters.transitionType);n.direction==1&&(c=c.reversed());let p=n.transitionParameters.transitionType=="SMART_ANIMATE"||Rn.supportsSmartAnimate(n.transitionParameters.transitionType)&&n.transitionParameters.transitionShouldSmartAnimate,u=l.length!=0;if(p){let f=this._preparedRenderTreeForMagicMove(e,c,i,s,zr.FrameRole.BASE_SCREEN,n.easingFunction());if(u){let T=s.size().max(i.size()),y=J.new2(),E=this._renderTreeForOverlays(i,l);if(E=rt.forOpacity(E,ft.EXITING_TLF,()=>c.exitingFrameTransition().interpolateOpacity(this.easedTransitionProgress())),E=rt.forTransform(E,ft.EXITING_TLF,()=>y.copyFrom(yt.FrozenAffineTransform_IDENTITY).translatedBy1(T.multiply(c.exitingFrameTransition().interpolateTranslation(this.easedTransitionProgress()))).translatedBy1(s.canvasSpaceBoundingBox().center()).scaledBy2(o/a).translatedBy1(i.canvasSpaceBoundingBox().center().negative())),n.transitionParameters.transitionType=="SMART_ANIMATE"){let v=ft.DISSOLVE_TRANSITION;E=new cn(E,f,v,()=>this.easedTransitionProgress())}return e.cachedRenderTree=ke.wrap([f,E]).optimized(),e.cachedRenderTree}else return f}let _=s.size().max(i.size()),h=J.new2(),S=this._renderTreeForBaseScreenAndOverlays(i,l);S!=null?(S=rt.forOpacity(S,ft.EXITING_TLF,()=>c.exitingFrameTransition().interpolateOpacity(this.easedTransitionProgress())),S=rt.forTransform(S,ft.EXITING_TLF,()=>h.copyFrom(yt.FrozenAffineTransform_IDENTITY).translatedBy1(_.multiply(c.exitingFrameTransition().interpolateTranslation(this.easedTransitionProgress()))).translatedBy1(s.canvasSpaceBoundingBox().center()).scaledBy2(o/a).translatedBy1(i.canvasSpaceBoundingBox().center().negative()))):S=new ke([]);let m=this._renderTreeForBaseScreenAndOverlays(s,d);if(m!=null?(m=rt.forOpacity(m,ft.ENTERING_TLF,()=>c.enteringFrameTransition().interpolateOpacity(this.easedTransitionProgress())),m=rt.forTranslation(m,ft.ENTERING_TLF,()=>_.multiply(c.enteringFrameTransition().interpolateTranslation(this.easedTransitionProgress())))):m=new ke([]),c.isDissolve()){let f=ft.DISSOLVE_TRANSITION;e.cachedRenderTree=new cn(S,m,f,()=>this.easedTransitionProgress())}else c.drawsEnteringFrameOnTopOfExitingFrame()?e.cachedRenderTree=ke.wrap([S,m]):e.cachedRenderTree=ke.wrap([m,S]);return e.cachedRenderTree}_renderTreeForOverlayTransition(e){var T,y;let t=e.change,n=t.oldOverlays(this._appState.prototypeState()),o=t.newOverlays(this._appState.prototypeState()),i=this._appState.prototypeState().lastNodeForBaseScreen(),a=i.canvasSpaceBoundingBox().topLeft();if(i==null)return null;let s=ye.renderTreeForBaseScreenWithPerfLogging(i,new Si(i,this._hsmTransitionMap,null,this._appState.prototypeStructure().nodeTransitionTracker().getStateGroupStateSwapInteractionCounts(),this._ongoingObjectAnimation,this._objectAnimationProgressTracker),"_renderTreeForOverlayTransition");if(s==null)return null;let l=[],d=this._compositor.prepareForEfficientCompositing(s);d!=null&&l.push(rt.forTransformIsolation(d));let c=t.getFramePairTransition(),p=new Oa,u=0;for(let E=0,v=Math.min(n.length,o.length);E<v&&X.equals(n[E].id(),o[E].id());E=E+1){let A=ye.renderTreeForOverlayBackground(n[E].backgroundAppearance(),i.canvasSpaceBoundingBox());A!=null&&l.push(A);let I=this._renderTreeForOverlay1(n[E],i,E,p,null);I!=null&&l.push(I),u=u+1}if(n.length==o.length&&u==n.length-1&&t.transitionParameters.transitionType=="SMART_ANIMATE"){let E=n[n.length-1],v=o[o.length-1],A=this._appState.prototypeState().lastNodeForOverlayAt(n.length-1),I=this._appState.prototypeState().nextNodeForOverlayAt(o.length-1);if(A!=null&&I!=null){let C=[];Ir(C,l);let g=ye.renderTreeForOverlayBackground(E.backgroundAppearance(),i.canvasSpaceBoundingBox()),R=ye.renderTreeForOverlayBackground(v.backgroundAppearance(),i.canvasSpaceBoundingBox());(g!=null||R!=null)&&C.push(new cn(g,R,ft.OVERLAY_BACKGROUND_DISSOLVE,()=>this.easedTransitionProgress()));let D=this._preparedRenderTreeForMagicMove(e,c,A,I,zr.FrameRole.OVERLAY,t.easingFunction());return D=rt.forTranslation(D,ft.SMART_ANIMATE_OVERLAY_TRANSLATION,()=>{let P=v.deltaFromRenderedPositionToCanvasSpacePosition(i),U=E.renderedOrigin(i).subtract(I.canvasSpaceBoundingBox().topLeft());return P.multiplyScalar(this.easedTransitionProgress()).add(U.multiplyScalar(1-this.easedTransitionProgress()))}),C.push(D),e.cachedRenderTree=ke.wrap(C).optimized(),e.cachedRenderTree}}let S=[];for(let E=u,v=n.length;E<v;E=E+1){let A=ye.renderTreeForOverlayBackground(n[E].backgroundAppearance(),i.canvasSpaceBoundingBox()),I=null;A!=null&&(I=()=>1-this.easedTransitionProgress(),S.push(rt.forOpacity(A,ft.EXITING_OVERLAY_BACKGROUND,I)));let C=n[E].renderedOrigin(i).subtract(a),g=((T=n[E].node())==null?void 0:T.size())??fe.FrozenVector_new1(),R=["MOVE_FROM_RIGHT","MOVE_FROM_BOTTOM"].indexOf(t.transitionParameters.transitionType)!=-1?i.size().subtract(C.add(g)):C,D=g.add(R),P=()=>D.multiply(c.exitingFrameTransition().interpolateTranslation(this.easedTransitionProgress())),U=this._renderTreeForOverlay2(n[E],i,E,I,p,P);p!=null&&p.removeEntry(n[E].id()),U!=null&&(U=rt.forOpacity(U,ft.EXITING_OVERLAY,()=>c.exitingFrameTransition().interpolateOpacity(this.easedTransitionProgress())),U=rt.forTranslation(U,ft.EXITING_OVERLAY,P),S.push(U))}let m=[];for(let E=u,v=o.length;E<v;E=E+1){let A=ye.renderTreeForOverlayBackground(o[E].backgroundAppearance(),i.canvasSpaceBoundingBox()),I=null;A!=null&&(I=()=>this.easedTransitionProgress(),m.push(rt.forOpacity(A,ft.ENTERING_OVERLAY_BACKGROUND,I)));let C=o[E].renderedOrigin(i).subtract(a),g=((y=o[E].node())==null?void 0:y.size())??fe.FrozenVector_new1(),R=["MOVE_FROM_RIGHT","MOVE_FROM_BOTTOM"].indexOf(t.transitionParameters.transitionType)!=-1?i.size().subtract(C.add(g)):C,D=g.add(R),P=()=>D.multiply(c.enteringFrameTransition().interpolateTranslation(this.easedTransitionProgress())),U=this._renderTreeForOverlay2(o[E],i,E,I,p,P);U!=null&&(U=rt.forOpacity(U,ft.ENTERING_OVERLAY,()=>c.enteringFrameTransition().interpolateOpacity(this.easedTransitionProgress())),U=rt.forTranslation(U,ft.ENTERING_OVERLAY,P),m.push(U))}let f=[];if(Ir(f,l),c.isDissolve()){let E=ft.DISSOLVE_TRANSITION,v=ke.wrap(S),A=ke.wrap(m);f.push(new cn(v,A,E,()=>this.easedTransitionProgress()))}else Ir(f,S),Ir(f,m);return e.cachedRenderTree=ke.wrap(f),e.cachedRenderTree}_onBeforeFrameForTransition(){if(this._ongoingTransition!=null&&(this._transitionProgressTracker.advanceToNextFrame(),!this._transitionProgressTracker.isTransitionInProgress())){this._maybeLogPerformanceMetricsForTransition();let t=this._transitionProgressTracker.transitionEnded();switch(this._appState.prototypeState().mostRecentFixInvalidStateInitiator="ProtoRenderManager._onBeforeFrameForTransition "+t,t){case pn.TransitionEndedAction.COMMIT:{this._appState.prototypeState().commitStateChange();break}case pn.TransitionEndedAction.ABORT:{this._appState.prototypeState().abortStateChange();break}}}}_onBeforeFrameForHsm(){this._hsmTransitionMap.size!=0&&Array.from(this._hsmTransitionMap.keys()).forEach(e=>{if(Array.from(this._hsmTransitionMap.keys()).indexOf(e)!=-1){let t=this._hsmTransitionMap.get(e),n=t.tracker;if(n.advanceToNextFrame(),!n.isTransitionInProgress()){let o=n.transitionEnded(),i=this._appState.prototypeState(),a=t.change;if(i.getStateMachineInitiatedChange(a.stablePath)==a)switch(o){case pn.TransitionEndedAction.COMMIT:{i.commitChangesBelowInstanceTransitionRoot(a.stablePath);let s=this._appState.scene().findNodeByStablePath(a.stablePath);s!=null&&this._dirtinessTracker.dirtyNode(s);break}case pn.TransitionEndedAction.ABORT:{i.abortInstanceStateChange(a.stablePath);break}}}}})}_onBeforeFrameForObjectAnimation(){let e=this._ongoingObjectAnimation;if(e)if(this._objectAnimationProgressTracker.advanceToNextFrame(),this._objectAnimationProgressTracker.isTransitionInProgress()){let t=e.change.objectAnimationTargetNode(this._appState.scene());if(!t)throw new Error("Expected object animation target node");this._dirtinessTracker.dirtyNode(t)}else{let t=this._objectAnimationProgressTracker.transitionEnded();switch(this._appState.prototypeState().mostRecentFixInvalidStateInitiator="ProtoRenderManager._onBeforeFrameForObjectAnimation "+t,t){case pn.TransitionEndedAction.COMMIT:{this._appState.prototypeState().commitStateChange();break}case pn.TransitionEndedAction.ABORT:{this._appState.prototypeState().abortStateChange();break}}}}currentCanvasSpacePreviewBounds(){if(this._ongoingTransition!=null&&this.ongoingPrototypeStateChange().transitionParameters.transitionType!="INSTANT_TRANSITION"){let o=this._appState.prototypeState(),i=o.lastNodeForBaseScreen(),a=o.nextNodeForBaseScreen()??o.lastNodeForBaseScreen();return this.canvasSpacePreviewBoundsForTransition(i,a)}let t=this._appState.baseScreenNode();return this.canvasSpacePreviewBoundsForTransition(t,t)}currentCanvasSpaceFrameBounds(){if(this._ongoingTransition!=null&&this.ongoingPrototypeStateChange().transitionParameters.transitionType!="INSTANT_TRANSITION"){let o=this._appState.prototypeState(),i=o.lastNodeForBaseScreen(),a=o.nextNodeForBaseScreen()??o.lastNodeForBaseScreen();return this.canvasSpaceFrameBoundsForTransition(i,a)}let t=this._appState.baseScreenNode();return this.canvasSpaceFrameBoundsForTransition(t,t)}canvasSpacePreviewBoundsForTransition(e,t){if(e==null&&t==null)return null;if(!X.equals(e==null?void 0:e.id(),t==null?void 0:t.id())){let n=fe.FrozenVector_ZERO,o=fe.FrozenVector_ZERO,i=0,a=0;e!=null&&(n=e.canvasSpaceBoundingBox().size(),e.strokeGeometry()!=null&&e.strokeGeometry().bounds.isFinite()&&e.strokeAlign()!="INSIDE"&&(i=Math.abs(e.strokeGeometry().bounds.left()))),o=t.canvasSpaceBoundingBox().size(),t.strokeGeometry()!=null&&t.strokeGeometry().bounds.isFinite()&&t.strokeAlign()!="INSIDE"&&(a=Math.abs(t.strokeGeometry().bounds.left()));let s=n.max(o),l=new G(0,0,s.x(),s.y()),d=Math.max(i,a),c=J.new2().translatedBy1(t.canvasSpaceBoundingBox().center()).translatedBy1(l.center().negative());return l.transformInto1(l,c),l.expand1(d),l}return t.canvasSpacePreviewBounds()}canvasSpaceFrameBoundsForTransition(e,t){if(e==null&&t==null)return null;if(!X.equals(e==null?void 0:e.id(),t==null?void 0:t.id())){let n=e!=null?e.size():fe.FrozenVector_ZERO,o=t.size(),i=n.max(o),a=new G(0,0,i.x(),i.y());return a.transformInto1(a,t.absoluteTransform()),a}return e.canvasSpaceBoundingBox()}ongoingPrototypeStateChange(){var e;return(e=this._ongoingTransition)==null?void 0:e.change}transitionProgressTracker(){return this._transitionProgressTracker}renderLayerByLayerActivate(e){this._renderer.renderLayerByLayerActivate(e)}renderLayerByLayerDeactivate(){this._renderer.renderLayerByLayerDeactivate()}renderLayerByLayerPlay(){this._renderer.renderLayerByLayerPlay()}renderLayerByLayerPause(){this._renderer.renderLayerByLayerPause()}renderLayerByLayerForward(){this._renderer.renderLayerByLayerForward()}renderLayerByLayerBackward(){this._renderer.renderLayerByLayerBackward()}renderLayerByLayerRewind(){this._renderer.renderLayerByLayerRewind()}renderLayerByLayerIncreaseSpeed(){this._renderer.renderLayerByLayerIncreaseSpeed()}renderLayerByLayerDecreaseSpeed(){this._renderer.renderLayerByLayerDecreaseSpeed()}attachTo(e){e.element().appendChild(this._context.gl().canvas)}removeFrom(e){e.element().removeChild(this._context.gl().canvas),this._uninitialize()}};co.VERBOSE_LOGS=!1;var Fa=co;(t=>{class r{constructor(o,i){this.change=null,this.viewportBeforeTransition=null,this.cachedRenderTree=null,this.change=o,this.viewportBeforeTransition=new Jo,this.viewportBeforeTransition.copyFrom(i)}}t.TransitionState=r;class e{constructor(o,i,a){this.tracker=o,this.progress=i,this.change=a}}t.InstanceSwapTransition=e})(Fa||(Fa={}));var Ic=class{constructor(e,t){this._ballisticSimulation=null,this._scrollingNodeID=null,this._isValid=!1,this._ballisticSimulation=e,this._scrollingNodeID=t,this._isValid=e!=null}nodeID(){return this._scrollingNodeID}simulation(){return this._ballisticSimulation}isOverscrolled(){return this._ballisticSimulation.isOverscrolled()}isValid(e){return e!=null&&e.findNode(this._scrollingNodeID)!=null}isDone(){return this._ballisticSimulation.isDone1()}performScroll(e,t){if(!this.isValid(t))return;let n=this._ballisticSimulation.pos1(),o=t.findNode(this._scrollingNodeID);e.setScrollOffsetUnconditionally(o,n)}};var vu=class{uninit(){this._semanticScrollStorage.uninitialize1()}getValueFromStorage(e){let t=new Nt(e),n=gr.getSemanticNodePath(t);return this._semanticScrollStorage.getData(n,gr.DEFAULT_STORAGE_KEY)}setValueInStorage(e,t){let n=new Nt(e),o=gr.getSemanticNodePath(n);this._semanticScrollStorage.insert(o,gr.DEFAULT_STORAGE_KEY,t)}_getOldNode(e){return e.stablePath.guids.length==0?this._appState.scene().findNode(e.oldStateId()):this._appState.scene().findNodeByStablePath(e.stablePath)}_getNewNode(e){return e.stablePath.guids.length==0?this._appState.scene().findNode(e.newStateId()):this._appState.scene().findNodeByStablePath(e.stablePath)}commitCurrentScrollStateToStorage(e){let t=this._getOldNode(e);this._recursivelyRecordOffsets(t);for(let n=0,o=e.oldStateAndOverlays.overlays.length;n<o;n=n+1){let i=e.oldStateAndOverlays.overlays[n].id,a=this._appState.scene().findNode(i);this._recursivelyRecordOffsets(a)}}applyStoredScrollStateToScene(e){let t=this._getNewNode(e);this._recursivelySetOffsets(t);for(let n=0,o=e.newStateAndOverlays.overlays.length;n<o;n=n+1){let i=e.newStateAndOverlays.overlays[n].id,a=this._appState.scene().findNode(i);this._recursivelySetOffsets(a)}}resetScrollStateToScene(e){let t=this._getNewNode(e);this._recursivelyResetOffsets(t);for(let n=0,o=e.newStateAndOverlays.overlays.length;n<o;n=n+1){let i=e.newStateAndOverlays.overlays[n].id,a=this._appState.scene().findNode(i);this._recursivelyResetOffsets(a)}}_recursivelyRecordOffsets(e){e!=null&&(e.scrollDirection()!="NONE"&&this.setValueInStorage(e,e.scrollOffset()),e.forEachChild(t=>{this._recursivelyRecordOffsets(t)}))}_recursivelySetOffsets(e){if(e!=null){if(e.scrollDirection()!="NONE"){let t=this.getValueFromStorage(e);t!=null?t.equals(e.scrollOffset())||(Ae.trackDefinedEvent("prototype.viewer_scroll_state_transferred",{}),e.setScrollOffset(this._canvasView.restrictScrollDeltaAxes(e,t))):e.setScrollOffset(fe.FrozenVector_ZERO)}e.forEachChild(t=>{this._recursivelySetOffsets(t)})}}_recursivelyResetOffsets(e){e!=null&&(e.scrollDirection()!="NONE"&&(Ae.trackDefinedEvent("prototype.viewer_scroll_state_reset",{}),e.setScrollOffset(fe.FrozenVector_ZERO),this.setValueInStorage(e,fe.FrozenVector_ZERO)),e.forEachChild(t=>{this._recursivelyResetOffsets(t)}))}toString(){return this._semanticScrollStorage.toString2(e=>e.toString())}constructor(e,t){this._canvasView=e,this._appState=t,this._semanticScrollStorage=new Xa}};var Yh=class{constructor(e,t,n,o,i,a,s,l,d){this.type="HOTSPOT",this.hotspot=e,this.prototypeInteraction=t,this.action=n,this.viewSpacePointOrNull=o,this.prototypeAction=i,this.connectionType=a,this.actionIndexPath=s,this.resolvedVariableModes=l,this.nodeForFindingTopmostScreen=d}},fA=class{constructor(e,t,n){this.type="OBJECT_ANIMATION",this.interactionId=e,this.actionIndex=t,this.transitionDirection=n}},Qh=class{constructor(e,t){this._queue=[],this._canvasView=e,this._prototypeState=t,this._prototypeState.addObserver(this),this._prototypeState.addHsmObserver(this),this._canvasView.addObserver(this)}appendHotspotActionToQueue(e,t,n,o,i,a,s,l,d){this._queue.push(new Yh(e,t,n,o,i,a,s,l,d))}insertHotspotActionInQueue(e,t,n,o,i,a,s,l,d,c){this._queue.splice(l,0,new Yh(e,t,n,o,i,a,s,d,c))}appendObjectAnimationActionToQueue(e,t,n){this._queue.push(new fA(e,t,n))}runNextAction(){if(this._queue.length>0){let e=this._queue.shift();e!=null&&this._runAction(e)}}_runAction(e){if(e.type=="HOTSPOT")this._canvasView.runSequentialAction(e.hotspot,e.prototypeInteraction,e.action,e.viewSpacePointOrNull,e.prototypeAction,e.connectionType,e.actionIndexPath,e.resolvedVariableModes,e.nodeForFindingTopmostScreen);else if(e.type=="OBJECT_ANIMATION"){let t=this._prototypeState.getCurrentBaseScreenNode(),n=new lo(e.interactionId,e.actionIndex);this._prototypeState.playObjectAnimation(t,n,e.transitionDirection)}}handleStateChangeAborted(e){this._queue.length=0}handleStateChangeCommitted(e,t){if(this._queue.length>0&&this._shouldProcessAction(e)){let n=this._queue.shift();n!=null&&t(()=>{this._runAction(n)})}}handleStateChangeInitiated(e){}handleStateChangeRequested(e){}handleFitModeChange(e,t){}handleRestartPrototype(){this._queue.length=0}handleHsmAborted(e,t){this._queue.length=0}handleHsmCommitted(e,t,n){if(this._queue.length>0&&this._shouldProcessAction(t)){let o=this._queue.shift();o!=null&&n(()=>{this._runAction(o)})}}handleHsmInitiated(e,t){}handleHsmRequested(e,t){}willTriggerHotspot(e,t,n,o){(n==4||n==8||n==9||n==3)&&(this._queue.length=0)}didScrollNode(e){}_shouldProcessAction(e){return!(e.cause==6||e.cause==7)}};var _l;(o=>{function r(i){return i.stateManagementVersion()==1}o.newStateManagementRulesEnabledForChange=r;function e(){return o._seenOldStateManagementInteraction}o.seenOldStateManagementInteraction=e;function t(){o._seenOldStateManagementInteraction=!0}o.markOldStateManagementInteractionSeen=t,o._seenOldStateManagementInteraction=!1})(_l||(_l={}));var Xh=class{check(e){(!this._lastOffset.equals(e.offset())||this._lastZoomScale!=e.zoomScale())&&(this._lastOffset=e.offset(),this._lastZoomScale=e.zoomScale(),this.onChange!=null&&this.onChange(this._lastOffset,this._lastZoomScale))}resetStateForTests(){this._lastOffset=fe.FrozenVector_ZERO,this._lastZoomScale=0}constructor(){this._lastOffset=fe.FrozenVector_ZERO,this._lastZoomScale=0,this.onChange=null}};var gA=(t=>(t[t.SHORTCUT=0]="SHORTCUT",t[t.SCROLL=1]="SCROLL",t))(gA||{});var qh=class{constructor(e,t){this.swappedStablePath=e,this.hotspotStablePath=t}},Zh=class{willTriggerHotspot(e,t,n,o){this.willTriggerHotspotCallback!=null&&this.willTriggerHotspotCallback(e,t,n,o)}didScrollNode(e){this.didScrollNodeCallback!=null&&this.didScrollNodeCallback(e)}constructor(e,t){this.willTriggerHotspotCallback=e,this.didScrollNodeCallback=t}},yc=class r{constructor(e,t){this.FRAMES_TO_FINISH_RENDERING=3,this._state=r.State.INACTIVE,this._framesToFinishRendering=0,this._observers=new jr,this._emitter=null,e.addObserver(this),this._emitter=t}onFrame(){this._state==r.State.WAITING_TO_FINISH&&(this._framesToFinishRendering==0?(this._emitter.trigger("renderingStop"),this._observers.forEach(e=>{e.handleRenderingStop()}),this._state=r.State.INACTIVE):this._framesToFinishRendering=this._framesToFinishRendering-1)}handleSetNeedsBlit(e){this._state==r.State.INACTIVE?e&&(this._emitter.trigger("renderingStart"),this._observers.forEach(t=>{t.handleRenderingStart()}),this._state=r.State.ACTIVE):this._state==r.State.ACTIVE?e||(this._state=r.State.WAITING_TO_FINISH,this._framesToFinishRendering=this.FRAMES_TO_FINISH_RENDERING):e&&(this._state=r.State.ACTIVE)}addObserver(e){this._observers.add(e)}removeObserver(e){this._observers.remove(e)}};(e=>{let r;(i=>(i[i.ACTIVE=0]="ACTIVE",i[i.INACTIVE=1]="INACTIVE",i[i.WAITING_TO_FINISH=2]="WAITING_TO_FINISH"))(r=e.State||(e.State={}))})(yc||(yc={}));var de=class de extends dd{constructor(e){super(),this._appState=null,this._observers=new jr,this._renderer=null,this._renderingStateTracker=null,this._idlenessTracker=null,this._transitionBehaviorManager=null,this._scrollSyncer=null,this._sequentialActionManager=null,this._viewportTracker=new Xh,this._viewport=new Jo,this._hotspotAnimation=new Dh,this._uiRenderData=new mu,this._showHotspots=!0,this._multiplayer=null,this._mostRecentTransitionViaArrows=!1,this._mostRecentTransitionViaArrowsLegacy=!1,this._mostRecentFrameNum=0,this._sequentialBlankFrameStartTimestamp=null,this._microtasksSinceLastFrame=0,this.MAX_MICROTASKS_PER_FRAME=2,this.onResize=null,this.onBaseScreenIdChanged=null,this.onScalingModeChanged=null,this.userDidAttemptZoom=null,this.disengageObservationMode=null,this.onURLClicked=null,this.onNavigateToPrototype=null,this.afterFrame=null,this.afterFirstRenderOfScreenStack=null,this._emitter=null,this._pointerEventDelegate=null,this.INTERACTION_REPORTING_RATE=10/100,this._currentMouseLocation=null,this._lastPressData=null,this._hoveredStateInstances=new Map,this._maintainedData=new xh,this._mouseEnteredNodesManager=null,this._initialFlingVelocity=new b(0,0),this._interactionObservers=new jr,this.ALT_CODE=18,this.SHIFT_CODE=16,this.META_CODE=91,this.CONTROL_CODE=17,this._appState=e,this._appState.prototypeState().addObserver(this),this._appState.prototypeState().addHsmObserver(this),this._emitter=Kt.getEventEmitter(),this.makeRenderer(),this.setPhysicsForOS(this.getRelevantOS()),this._idlenessTracker=new Lh(t=>{this._renderer.setZoomScale(t)},this._emitter),this._pointerEventDelegate=new de.CanvasPointerEventDelegate(this),this._scrollSyncer=new vu(this,this._appState),this._sequentialActionManager=new Qh(this,this._appState.prototypeState()),this._mouseEnteredNodesManager=new Bh(this._appState),this._loggedInvalidFramePresetSize=!1}addObserver(e){this._observers.add(e)}removeObserver(e){this._observers.remove(e)}setBackgroundEnabled(e){this._renderer.setBackgroundEnabled(e)}renderingStateTracker(){return this._renderingStateTracker}makeRenderer(){let e=this._renderer;if(e!=null&&e.removeFrom(this),Y.getFeatureFlags().viewer_disable_rendering)this._renderer=new DummyProtoRenderManager;else{let t=new di({needsAlpha:this._appState.needsAlphaGPUBackingStore()}),n=new la(t),o=new Qs(t,n);this._renderer=new Fa(this._viewport,this._appState,this._appState.imageManager(),this._emitter,t,n,o)}this._transitionBehaviorManager!=null&&this._transitionBehaviorManager.removeFrom(this),this._transitionBehaviorManager=new Vh(this),this._renderingStateTracker!=null&&this._appState.removeFrameObserver(this._renderingStateTracker),this._renderingStateTracker=new yc(this._renderer,this._emitter),this._appState.addFrameObserver(this._renderingStateTracker),e!=null&&this._renderer!=null&&this._renderer.attachTo(this)}graphicsCardName(){return this._renderer.graphicsCardName()}deviceRenderer(){return this._renderer.deviceRenderer()}initializeThumbnailRenderer(e){e!==null&&this._renderer.initializeThumbnailRenderer(e)}thumbnailRenderer(){return this._renderer.thumbnailRenderer()}getContext(){return this._renderer.getContext()}appState(){return this._appState}idlenessTracker(){return this._idlenessTracker}viewport(){return this._viewport}viewportTracker(){return this._viewportTracker}mostRecentFrameNum(){return this._mostRecentFrameNum}setScrollPadding(e,t,n,o){this._viewport.setScrollPadding([e,t,n,o])}setMultiplayer(e){this._multiplayer=e}setShowHotspots(e){this._showHotspots=e}handleSceneChange(e,t){e!=null&&e.removeObserver(this),t!=null&&t.addObserver(this),this._viewport.invalidate(),this._invalidateZoomScaleForRender(),this._idlenessTracker.handleSceneChange(),this._setCurrentViewportSizeOnCanvas()}resetStateForTests(){this._viewport.resetStateForTests(),this._viewportTracker.resetStateForTests(),this._appState.resetStateForTests(),this._lastPressData=null,this._hoveredStateInstances=new Map,this._maintainedData.resetAllEntries(),this._pointerEventDelegate.resetStateForTests(),this._mouseEnteredNodesManager.reset(),this._appState.prototypeState().addHsmObserver(this)}handleActiveCanvasChange(e,t){t!=null?this._viewport.invalidate():this._currentMouseLocation=null}handleActivePrototypeStartingPointChange(e,t){}afterEnteredViewer(){this._appState.nodeTransitionTracker().triggerPotentialTimedTransition=()=>{let e=this._appState.prototypeState(),t=[];e.getCurrentBaseScreenNode()!=null&&t.push(e.getCurrentBaseScreenNode());for(let n=0,o=e.getCurrentOverlayData().length;n<o;n=n+1)t.push(e.nodeForOverlayAt(n));this._triggerPotentialTimedTransition(t,0)},this._appState.nodeTransitionTracker().triggerPotentialTimedTransitionForSpecificRootNode=e=>{e&&this._triggerPotentialTimedTransition([e],0)},this._appState.nodeTransitionTracker().createVideoTriggerEventsForNodesInFrame=e=>{e&&this._createVideoTriggerEvents([e])},this._appState.nodeTransitionTracker().createVideoTriggerEventsForAllNodesOnscreen=()=>{let e=[],t=this._appState.prototypeState();t.getCurrentBaseScreenNode()!=null&&e.push(t.getCurrentBaseScreenNode());for(let n=0,o=t.getCurrentOverlayData().length;n<o;n=n+1)e.push(t.nodeForOverlayAt(n));this._createVideoTriggerEvents(e)}}navigateForward(e,t){if(this._appState.prototypeState().getCurrentBaseScreenId()==null)return;let o=this._appState.prototypeState().getCurrentBaseScreenNode();if(o==null)return;if(this._appState.prototypeState().getInitiatedChange()&&this._appState.prototypeStructure().navigationOrder().shouldCommitInitiatedChangeOnNavigate()){this._appState.prototypeState().commitStateChange(),this._viewport.invalidate();return}let i=this._appState.prototypeStructure().navigationOrder().getNextObjectAnimation();if(i!=null){let s=o.getObjectAnimationInteraction(i);if(s!=null)for(let l=i.actionIndex;l<s.allActions().length;l++)this._sequentialActionManager.appendObjectAnimationActionToQueue(s.id(),l,0);this._sequentialActionManager.runNextAction();return}if(Y.shouldPlayVideosLinearly()&&this._appState.videoManager().playNextVisibleVideo()&&t)return;let a=this._appState.prototypeStructure().navigationOrder().getNextBaseScreenNode();if(a!=null){this.navigateViaArrows(o.id(),a.id(),0,e);return}}navigateBackward(e){if(this._appState.prototypeState().getCurrentBaseScreenId()==null)return;let n=this._appState.prototypeState().getCurrentBaseScreenNode();if(n==null)return;if(this._appState.prototypeState().getInitiatedChange()){this._appState.prototypeState().abortStateChange(),this._viewport.invalidate();return}let i=this._appState.prototypeState().getCurrentAnimationState(),a=this._appState.prototypeStructure().navigationOrder().getPreviousObjectAnimation();if(i!=null){this._appState.prototypeState().playObjectAnimation(n,a,1);return}let s=this._appState.prototypeState().getPreviousBaseScreenNode();if(s!=null){this.navigateViaArrows(n.id(),s.id(),1,e);return}}navigateToFrameAtIndex(e){let t=this._appState.prototypeState().getCurrentBaseScreenId();if(t==null)return;let n=this._appState.prototypeState().getCurrentBaseScreenIndex(),o=this._appState.prototypeStructure().topLevelPrototypeNodesInOrder();if(e<0||e>o.length-1||e==n)return;let i=X.fromString(o[e]),a=n<e?0:1;this.navigateViaArrows(t,i,a,null)}navigateViaArrows(e,t,n,o){this._mostRecentTransitionViaArrows=!0,this._mostRecentTransitionViaArrowsLegacy=!0,Math.random()<this.INTERACTION_REPORTING_RATE&&Ae.trackEvent("prototype_view_interaction",{type:"navigateViaArrows",direction:Sn[n],nonInteraction:0,prototypeType:this._appState.prototypeStructure().navigationOrder().navigationOrderTypeString()});let i=this._appState.prototypeState().getCurrentBaseScreenNode();if(i!=null&&i.prototypeInteractions().length>0){let a=null;for(let s=0,l=i.prototypeInteractions().length;s<l;s=s+1){let d=i.prototypeInteractions()[s],c=(d==null?void 0:d.action())!=null?d.action().value:null;if(d!=null&&d.allActions().length>0)for(let u of d.allActions())u.transitionNodeID()!=null&&u.transitionNodeID()==t&&(c=u);let p=c!=null?this._appState.scene().findNode(c.transitionNodeID()):null;if(p!=null){let u=Yt.cleanedUpTransitionDestinationId(this._appState.getActiveCanvas(),i==null?void 0:i.id(),p==null?void 0:p.id(),c.navigationType(),c.connectionType());a=u??null}if(X.equals(a,t)){this._appState.prototypeState().navigateToFrameAndCloseOverlays(t,i,1,n,o,d,c);return}}}this._appState.prototypeState().navigateToFrameAndCloseOverlays(t,null,1,n,o,null,null)}_navigateToHyperlink(e,t){var n;if(e.hyperlink.url!==void 0){this.onURLClicked(e.hyperlink.url,!0);return}else if(e.hyperlink.guid!==void 0){let o=ot.decodeGUID(e.hyperlink.guid);if(X.equals(o,this._appState.getActiveCanvas().id())){this._appState.prototypeState().restartPrototype(1);return}let i=this._appState.scene().findNode(o),a=Yt.cleanedUpTransitionDestinationId(this._appState.getActiveCanvas(),(n=e.node)==null?void 0:n.id(),i==null?void 0:i.id(),t,"URL");if(a!=null){this._appState.prototypeState().navigateToFrameAndCloseOverlays(a);return}let s=this._appState.currentFileKey();this.onNavigateToPrototype(s,o)}}triggerHotspot(e,t,n,o){if(this._multiplayer!=null&&this._multiplayer.isObserving()||(this._observers.forEach(a=>{a.willTriggerHotspot(e,t,n,o)}),t==null||t.actions().length==0))return;!_l.seenOldStateManagementInteraction()&&t.stateManagementVersion()==0&&(Ae.trackDefinedEvent("prototype.viewer_old_noodle_used",{}),_l.markOldStateManagementInteractionSeen());let i=e.node.getResolvedVariableModesForPrototype();for(let a=0,s=t.actions().length;a<s;a=a+1){let l=t.actions()[a],d=l.connectionType();Math.random()<this.INTERACTION_REPORTING_RATE&&Ae.trackEvent("prototype_view_interaction",{type:"triggerHotspot",transitionAction:$e[n],transitionType:l==null?void 0:l.transitionType(),action:d=="INTERNAL_NODE"?l==null?void 0:l.navigationType():d=="UPDATE_MEDIA_RUNTIME"?l==null?void 0:l.mediaAction():d,nonInteraction:0}),Y.getViewerMode()==Y.ViewerMode.MIRROR&&Ae.trackDefinedEvent("mobile_platform.first_prototype_interaction_mirror",{});let c=e.node.id();if(e.node.isOrInInstance()){let p=e.node.findContainingPrimaryInstance();p&&p.id()&&(c=p.id())}this._sequentialActionManager.appendHotspotActionToQueue(e,t,n,o,l,d,[a],i,c)}this._sequentialActionManager.runNextAction()}runSequentialAction(e,t,n,o,i,a,s,l,d){let c=!0;switch(a){case"INTERNAL_NODE":{let p=i.transitionNodeID();this._performNavigationOrOverlayChangeForHotspot(e.node,p,n,t,o,s),i.navigationType()=="SCROLL_TO"&&i.transitionType()!="SCROLL_ANIMATE"||(c=!1);break}case"URL":{e.hyperlink==null?this.onURLClicked(i.connectionURL(),i.openUrlInNewTab()):this._navigateToHyperlink(e,i.navigationType());break}case"BACK":{this.requestBack(e.node,t,1,$e.fromInteractionType(t.event().interactionType()),kr.fromPrototypeAction(i,t.stateManagementVersion()),i),c=!1;break}case"CLOSE":{this._appState.prototypeState().closeOverlayForHotspot(e.node,t,1,i),c=!1;break}case"SET_VARIABLE":{let p=N();if(p.fonts().isWaitingForFontList())return;let u=i.targetVariableID()?p.getICActionsForSetVariableAction(d,i.targetVariableID(),i.targetVariableData(),this._appState.prototypeState().getTopmostScreenId(),l):i.targetNodeFieldAlias()?p.getICActionsForSetPropertyAction(d,i.targetNodeFieldAlias(),i.targetVariableData(),this._appState.prototypeState().getTopmostScreenId(),l):[];if(u.length>0){let _=Cn.instance.setReverseVariantBindingsForICsDisabled(!0);for(let h of u){let m=e.node.scene().findNode(h.nodeToSwap),f=m.prototypeInteractions()[h.interactionIndex];this.runSequentialAction(new jo(m),f,0,null,f.actions()[h.actionIndex],"INTERNAL_NODE",[h.actionIndex],l,d)}Cn.instance.setReverseVariantBindingsForICsDisabled(_),c=!1}if(i.targetVariableID()){let _=N().runSetVariable(d,i.targetVariableID(),i.targetVariableData(),l);this._appState.prototypeState().createMultiplayerSetVariableAction(d,i.targetVariableID(),_,l)}else i.targetNodeFieldAlias()&&N().runSetProperty(e.node.id(),i.targetNodeFieldAlias(),i.targetVariableData(),l);break}case"SET_VARIABLE_MODE":{let p=i.targetVariableSetID()?i.targetVariableSetID():i.deprecatedTargetVariableSetKey()?N().sceneGraphTsApi().getVariableSetIDByKey(i.deprecatedTargetVariableSetKey()):null,u=i.targetVariableModeID();if(p===null){console.warn(`SET_VARIABLE_MODE action has ${!!i.targetVariableSetID()} targetVariableSetID and ${!!i.deprecatedTargetVariableSetKey()} deprecatedTargetVariableSetKey, and was not able to resolve the final setID. Cannot set variable mode.`);break}if(u===null){Oe("SET_VARIABLE_MODE action has no targetVariableModeId. Cannot set variable mode.");break}let _=Y.getFeatureFlags().prototype_log_run_action?performance.now():0;if(N().runSetVariableMode(d,p,u),Y.getFeatureFlags().prototype_log_run_action){let h=performance.now()-_,S=N().sceneGraphTsApi().getVariableSetInfoForSetModeAnalytics(p);Ae.trackDefinedEvent("prototype.run_action",{action:"SET_VARIABLE_MODE",interaction_type:t.event().interactionType(),time_in_ms:h,...S})}this._appState.prototypeState().createMultiplayerSetVariableModeAction(d,p,u);break}case"UPDATE_MEDIA_RUNTIME":{this._appState.videoManager().updateVideoRuntime(i,e.node.id());break}case"CONDITIONAL":{if(N().fonts().isWaitingForFontList()||i.conditionalActions().length==0)return;let p=N().getFirstTruthyConditionalIndex(d,i.conditionalActions()[0].condition());if(p>=0&&p<i.conditionalActions().length){let _=i.conditionalActions()[p].actions();for(let h=0,S=_.length;h<S;h=h+1){let m=_[h],f=[s[0],p,h];this._sequentialActionManager.insertHotspotActionInQueue(e,t,n,o,m,m.connectionType(),f,h,l,d)}}break}default:console.error(`Unhandled connection type: ${a}`)}c&&this._sequentialActionManager.runNextAction()}triggerDelayedHotspot(e,t,n){var i;let o=(i=this._appState.scene())==null?void 0:i.findNode(e);o!=null&&this.triggerHotspot(new jo(o),t,n,null)}_findPrototypeActionGivenActionIndexPath(e,t){let n=e.actions(),o=t[0];if(o<n.length){let i=n[o];if(t.length>2){let a=t[1],s=t[2];if(i.conditionalActions()!=null&&i.conditionalActions().length>a){let l=i.conditionalActions()[a];if(l.actions()!=null&&l.actions().length>s)return l.actions()[s]}}return i}return null}_performNavigationOrOverlayChangeForHotspot(e,t,n,o,i,a){var l;this._mostRecentTransitionViaArrows=!1,this._mostRecentTransitionViaArrowsLegacy=i==null;let s=this._findPrototypeActionGivenActionIndexPath(o,a);if(e==null&&Oe("Hotspot node unexepectedly null when performing navigation or overlay change for hotspot"),e==null||s.navigationType()=="NAVIGATE"||s.navigationType()=="SWAP"&&this._appState.prototypeState().getTopmostOverlayId()==null)this._appState.prototypeState().navigateToFrameAndCloseOverlays(t,e,1,0,n,o,s);else if(s.navigationType()=="SCROLL_TO")this.scrollToDestinationInFrame(t,o);else if(s.navigationType()=="OVERLAY")this._appState.prototypeState().overlayFrame(t,e,0,n,o,s);else if(s.navigationType()=="SWAP")this._appState.prototypeState().swapTopOverlay(t,e,n,o,s);else if(s.navigationType()=="SWAP_STATE"){if(N().fonts().isWaitingForFontList())return;let d=(l=Gt.whichInstanceToSwap(e,s.transitionNodeID()))==null?void 0:l.stablePath();d!=null&&this._appState.prototypeState().swapInstanceToState2(d,t,e,n,o,1,s)}}requestBack(e,t,n,o,i,a){this._appState.prototypeState().returnToState2(e,t,n,o,i,a)}handleHsmAborted(e,t){this._renderer.abortHsmTransition(e,t),this._viewport.invalidate(),this._updateHoveredStateInstanceIfNeeded(t.stablePath);let n=[];this._appState.prototypeState().forMaterializedStateInstanceAndDescendants(e,o=>(n.push(this._appState.scene().findNodeByStablePath(o)),0)),this._onCommitOrAbortForInteractions(n,t.cause,t.oldStateId())}handleHsmCommitted(e,t,n){this._renderer.commitHsmTransition(e,t),this._viewport.invalidate(),this._updateHoveredStateInstanceIfNeeded(t.stablePath);let o=[];this._appState.prototypeState().forMaterializedStateInstanceAndDescendants(e,i=>(o.push(this._appState.scene().findNodeByStablePath(i)),0)),n(()=>{this._onCommitOrAbortForInteractions(o,t.cause,t.oldStateId())})}handleHsmRequested(e,t){_l.newStateManagementRulesEnabledForChange(t)&&this._scrollSyncer.commitCurrentScrollStateToStorage(t)}handleHsmInitiated(e,t){_l.newStateManagementRulesEnabledForChange(t)&&(t.resetScroll()==1?this._scrollSyncer.applyStoredScrollStateToScene(t):this._scrollSyncer.resetScrollStateToScene(t));let n=this._multiplayer!=null&&this._multiplayer.isObserving(),o=this._transitionBehaviorManager.getTransitionMixinForStateSwap(this._appState.scene(),t,n);this._renderer.triggerHsmTransition(e,t,o),this._viewport.invalidate(),this._updateHoveredStateInstanceIfNeeded(t.stablePath)}handleStateChangeAborted(e){this._updateCanvasForCurrentBaseScreen();let t=null,n=[];X.equals(e.oldStateId(),e.newStateId())||n.push(e.oldStateId());let o=e.oldOverlayData(),i=e.newOverlayData();for(let a=0,s=o.length;a<s;a=a+1)(a>=i.length||!X.equals(o[a].id,i[a].id))&&n.push(o[a].id);if(t=n.map(a=>{var s;return(s=this._appState.scene())==null?void 0:s.findNode(a)}).filter(a=>a!=null),!X.equals(e.oldStateId(),e.newStateId())&&this.onBaseScreenIdChanged!=null){let a=this._appState.scene().findNode(e.newStateId()),s=a==null?void 0:a.isSymbol();this.onBaseScreenIdChanged(e.oldStateId(),$e.getControlSource(e.cause),!e.isTransientChange(),this._appState.prototypeState().getOngoingNavigateRepairsInvalidState(),s)}e.isObjectAnimation()&&Y.getFeatureFlags().piper_object_animations?this._renderer.handleAbortedObjectAnimation(e):this._renderer.handleAbortedTransition(e),this._updateViewportForCurrentPreview(),this._appState.currentScalingInfo().fitMode=="free"&&this._appState.baseScreenNode()!=null&&this._viewport.zoomToFit2(0,this._appState.baseScreenNode().canvasSpaceBoundingBox()),this._invalidateZoomScaleForRender(),this._sendMouseCursorUpdate(),this._viewport.invalidate(),this._onCommitOrAbortForInteractions(t,e.cause,e.oldStateId())}handleStateChangeCommitted(e,t){this._updateCanvasForCurrentBaseScreen(),e.isObjectAnimation()&&Y.getFeatureFlags().piper_object_animations?this._renderer.handleCommittedObjectAnimation(e):this._renderer.handleCommittedTransition(e);let n=e.getNewOrChangedFrames(this._appState.scene()),o=this._appState.scene().findNode(this._appState.prototypeState().getTopmostScreenId());o!=null&&yn(o,i=>(i!=o&&i.isInstance()&&n.push(i),0)),t(()=>{this._onCommitOrAbortForInteractions(n,e.cause,e.oldStateId())})}handleStateChangeInitiated(e){if(this._updateCanvasForCurrentBaseScreen(),this._appState.baseScreenNode()==null&&!Y.isInlinePreview()){console.warn("no current TLF after receiving update");return}if(this.setPhysicsForOS(this.getRelevantOS()),e.isObjectAnimation()&&Y.getFeatureFlags().piper_object_animations)this._renderer.triggerObjectAnimation(e,this._viewport);else{let n=this._multiplayer!=null&&this._multiplayer.isObserving(),o=this._transitionBehaviorManager.getTransitionMixin(this._appState.scene(),e,n);this._renderer.triggerTransition(e,this._viewport,o)}if(this.setPhysicsForOS(this.getRelevantOS()),!X.equals(e==null?void 0:e.oldStateId(),e==null?void 0:e.newStateId())&&this.onBaseScreenIdChanged!=null){let n=this._appState.scene().findNode(e.newStateId()),o=n==null?void 0:n.isSymbol();this.onBaseScreenIdChanged(e.newStateId(),$e.getControlSource(e.cause),!e.isTransientChange(),this._appState.prototypeState().getOngoingNavigateRepairsInvalidState(),o)}let t=this._appState.prototypeState();if(e.stateManagementVersion()==1)this._scrollSyncer.commitCurrentScrollStateToStorage(e),e.resetScroll()==1?this._scrollSyncer.applyStoredScrollStateToScene(e):this._scrollSyncer.resetScrollStateToScene(e);else if(e.preserveScroll()==1)de.matchNodesAndPreserveScroll(this,t,e);else{let n=e.getNewOrChangedFrames(this._appState.scene());for(let o of n)this._resetScrollForTlf(o)}this._pointerEventDelegate.unlockScroll(),this._updateViewportForCurrentPreview(),this._appState.currentScalingInfo().fitMode=="free"&&this._appState.baseScreenNode()!=null&&this._viewport.zoomToFit2(0,this._appState.baseScreenNode().canvasSpaceBoundingBox()),this._invalidateZoomScaleForRender(),this._sendMouseCursorUpdate(),this._viewport.invalidate()}handleStateChangeRequested(e){}handleFitModeChange(e,t){this._appState.baseScreenNode()!=null&&!uv(this._appState.prototypeState().getCurrentScalingInfo())&&(this._appState.activePrototypeDevice()!=null&&Ka.hasDevice(this._appState.activePrototypeDevice().type)||this.updateScrollOffsetForNode(this._appState.baseScreenNode(),new b(0,0))),this._renderer.changeFitMode(t.fitMode),this.onScalingModeChanged!=null&&this.onScalingModeChanged(t),(e.contentScalingMode=="responsive"||t.contentScalingMode=="responsive")&&(this.maybeAbortStateChanges("CanvasView.handleFitModeChange"),this.resetResponsiveState()),this._setCurrentViewportSizeOnCanvas()}resetResponsiveState(e){var t;(t=N())==null||t.resetLocalNodeSizeChanges(e??null)}handleRestartPrototype(){this._scrollSyncer.uninit(),this.cancelAnimationManager(),this._mouseEnteredNodesManager.reset()}_updateCanvasForCurrentBaseScreen(){let e=this._appState.baseScreenNode();(e==null?void 0:e.canvas())!=null&&(this._appState.setActiveCanvas(e.canvas()),this._setCurrentViewportSizeOnCanvas())}_updateViewportForCurrentPreview(){let e=this._appState.currentScalingInfo(),t=this._appState.activePrototypeDevice(),n=this._renderer.currentCanvasSpaceFrameBounds(),o=this._renderer.currentCanvasSpacePreviewBounds();n!=null&&o!=null?this._viewport.updateForCurrentPreview(n,o,e,t):this._viewport.updateForBaseScreen(this._appState.baseScreenNode(),e,t)}_updateResponsiveSizeForCurrentBaseScreen(){var d;if(this._appState.currentScalingInfo().contentScalingMode!=="responsive")return;let e=this._appState.baseScreenNode();if(e==null||e.isSymbol())return;let t=this._appState.baseScreenId(),n=this._appState.storedPrototypeDevice(),o=n&&n.type==="PRESET",i=e.fullSize(),a=null;if(o&&Y.getViewerMode()!==Y.ViewerMode.MIRROR){let c=de._canvasSpaceBoundsOfDeviceBackground(e,n);if(c.isEmpty()&&!this._loggedInvalidFramePresetSize){this._loggedInvalidFramePresetSize=!0,Oe(`responsive viewer (inline preview ${Y.isInlinePreview()}): frame preset size does not exist for device`);return}a=c.size()}else a=this.window().size();!i.floatEquals(a,1)&&((d=N())==null||d.modules().prototype.updateResponsiveSize(t,a.x()||1,a.y()||1))}_invalidateZoomScaleForRender(){this._idlenessTracker.updateZoomScaleNow(this._viewport.zoomScale())}handleSceneGraphEvent(e){X.equals(e.node.id(),this._appState.baseScreenId())?e.property==32?this._updateCanvasForCurrentBaseScreen():e.property==57&&this._updateViewportForCurrentPreview():e.property==69&&(this._updateViewportForCurrentPreview(),this._invalidateZoomScaleForRender(),this._maybeChangePhysicsForDevice(e.oldVal)),this._handleScrollingPropertyChange(e.node,e.property,e.oldVal,e.newVal),e.property!=65&&this._viewport.invalidate()}handleAction(e,t){switch(e){case 1:{if(Y.isInlinePreview())break;this._viewport.adjustCameraZoomRounded(1,2),this.userDidAttemptZoom!=null&&this.userDidAttemptZoom(0);break}case 2:{if(Y.isInlinePreview())break;this._viewport.adjustCameraZoomRounded(1,.5),this.userDidAttemptZoom!=null&&this.userDidAttemptZoom(0);break}case 3:{this._viewport.setCameraZoom(1,1),this.userDidAttemptZoom!=null&&this.userDidAttemptZoom(0);break}case 4:{if(Y.isInlinePreview())break;this.canvasContentBounds()!=null&&this._viewport.zoomToFit2(1,this.canvasContentBounds()),this.userDidAttemptZoom!=null&&this.userDidAttemptZoom(0);break}}}setup(){this._setupInteractionHandlers(this._emitter),Jr.addUpdate(Bt.windowResize(this.events()),e=>{this._resize()}),Jr.addUpdate(Bt.windowFrame(this.window().events()),e=>{this._onFrame()}),this._renderer.attachTo(this),this._resize(),this._appState.addActionObserver(this),this._appState.addAppObserver(this)}canvasSpaceToWindowSpace(){let e=Gn.new2();return e.translate2(this._viewport.viewSpaceBounds().topLeft()),e.multiply(this._viewport.canvasSpaceToViewSpace1()),e}_tryResizingTo(e){this._viewport.setBounds(new G(0,0,e.x(),e.y())),this._updateViewportForCurrentPreview();let t=this._renderer.resize(e.x(),e.y(),this._viewport.zoomScale(),ho());return this.onResize!=null&&(this._setCurrentViewportSizeOnCanvas(),this.onResize()),this._idlenessTracker.handleInteraction(),t}_resize(){let e=this.absoluteBounds(),t=fe.FrozenVector_new4(e.width(),e.height()),n=this._tryResizingTo(t),o=n.canvasSize;if(n.webGLDidAdjustCanvasSize){let i=this._tryResizingTo(o).canvasSize}this._appState.currentScalingInfo().contentScalingMode==="responsive"&&this.maybeAbortStateChanges("CanvasView._resize")}maybeAbortStateChanges(e){let t=this._appState.prototypeState().getInitiatedChange(),n=t&&t.oldStateId()!=null;this.renderingIsComplete()&&this.isTopLevelTransitionOngoing()&&n&&(this._appState.prototypeState().mostRecentFixInvalidStateInitiator=e,this._appState.prototypeState().abortStateChange())}_setCurrentViewportSizeOnCanvas(){let e=this._appState.baseScreenNode();if(e==null)return;let t=e.findContainingCanvasOrSelf();if(t==null)return;let n=null,o=this._appState.prototypeState().getCurrentFitMode();if(o=="contain"||o=="scale-down")n=fe.FrozenVector_INFINITY;else if(o=="scale-down-width"||o=="fit-width"){let i=this._viewport.getScaleFactorForCurrentTlf(e.fullSize(),this._appState.prototypeState().getCurrentScalingInfo(),t.prototypeDevice()),a=this._viewport.viewSpaceBounds().size().y()/i;n=new b(1/0,a)}else this._viewport.viewSpaceBounds()!=null&&(n=this._viewport.viewSpaceBounds().size());n!=null&&!t.currentViewportSize().equals(n)&&t.setCurrentViewportSize(n)}renderingIsComplete(){return this._renderer.isRenderingDone()}isTopLevelTransitionOngoing(){return this._renderer.isTopLevelTransitionOngoing()}dangerouslyAccessProtoRenderManager(){return this._renderer}clearTileCaches(){this._renderer.clearTileCaches()}_onFrame(){var o,i,a;this._mostRecentFrameNum=this._mostRecentFrameNum+1,this._microtasksSinceLastFrame=0,this._appState.onFrame();let e=this._appState.getActiveCanvas();if(e==null)return;this._clampDirtyScrollContainers(),de._scrollAnimationManager!=null&&this._updateForAnimation(),(this._idlenessTracker.justInteracted()||this._renderer.checkNeedsBlit())&&this._renderer.setNeedsBlit(!0),this._idlenessTracker.advanceFrame(this._viewport),this._viewportTracker.check(this._viewport),this._viewport.prepareForRendering(),this._updateResponsiveSizeForCurrentBaseScreen(),this._updateViewportForCurrentPreview(),this._appState.baseScreenNode()!=null&&this._sendMouseCursorUpdate(),this._updateScrollOffsetsFromMultiplayer();let t=this._appState.baseScreenNode()!=null&&this._appState.baseScreenNode().visible();if(!t){if(this._sequentialBlankFrameStartTimestamp==null){let d=this._appState.prototypeState(),c=this._appState.scene(),p=(o=this._multiplayer)==null?void 0:o.scene(),u=this._appState.baseScreenNode(),_=((i=this._multiplayer)==null?void 0:i.nodeId())||X.invalid(),h=(a=this._appState.prototypeStructure())==null?void 0:a.getDestinationFrame(_);this._blankFrameLoggingEventParameters={hasScene:!!c,hasBaseScreenId:!!d.getCurrentBaseScreenId(),hasBaseScreen:!!u,baseScreenVisible:!!(u!=null&&u.visible()),hasMultiplayerScene:!!p,appStateAndMultiplayerScenesMatch:c===p,hasDestinationFrame:!!h,destinationFrameIsTopLevel:!!(h!=null&&h.isTopLevel()),destinationFrameIsVisibleInCanvas:!!(h!=null&&h.isVisibleInCanvas()),destinationFrameIsStateGroup:!!(h!=null&&h.isStateGroup()),destinationFrameIsGroup:!!(h!=null&&h.isGroup()),destinationFrameIsImmutableFrame:!!zt.isImmutableFrame(h==null?void 0:h.type()),mostRecentBaseScreenIdChangeInitiator:d.mostRecentBaseScreenIdChangeInitiator,mostRecentFixInvalidStateInitiator:d.mostRecentFixInvalidStateInitiator,baseScreenWasValidDestinationBeforeNodeChanges:d.baseScreenWasValidDestinationBeforeNodeChanges(),enforcePrototypeSecurityBoundaries:this._appState.prototypeSecurityBoundariesEnforced}}let s=performance.now();this._sequentialBlankFrameStartTimestamp??(this._sequentialBlankFrameStartTimestamp=s);let l=s-this._sequentialBlankFrameStartTimestamp>1e3;if(!Y.isInlinePreview()&&l){this._sequentialBlankFrameStartTimestamp=1/0;let d=this._renderer.getContext();d!=null&&d.isVisible()&&(Ae.trackDefinedEvent("prototype.draw_blank",this._blankFrameLoggingEventParameters),Y.getFeatureFlags().prototype_blank_frame_report_error&&Oe("drawing blank frames for >1s"))}this._renderer.drawBlank()}else this._sequentialBlankFrameStartTimestamp=null,this._appState.renderDots()?this._uiRenderData.backgroundColor=O.WHITE:this._uiRenderData.backgroundColor=u_(this._appState.baseScreenId(),this._appState.currentScalingInfo().fitMode,this._appState.prototypeState().showTransparentBackground(),e),this._uiRenderData.hotspots!=null&&this._uiRenderData.hotspots.length!=0&&this._renderer.setNeedsBlit(!0),this._uiRenderData.hotspots=this._findHotspotsToAnimate(),this._uiRenderData.hotspots!=null&&this._uiRenderData.hotspots.length!=0&&this._renderer.setNeedsBlit(!0),this._uiRenderData.hotspotOpacity=this._hotspotAnimation.getOpacity(),this._uiRenderData.particles=this._multiplayer==null?null:this._multiplayer.getParticles(),this._uiRenderData.mouse=this._multiplayer==null?null:this._multiplayer.getMouse(),this._uiRenderData.renderDots=this._appState.renderDots(),Ae.perfTimerScope("rendererDraw",Ae.ProfileLevel.LEGACY,()=>{let s=this._renderer.draw(this._idlenessTracker.zoomInProgress(),this._idlenessTracker.shouldRenderOptionalTiles(),this._viewport,this._uiRenderData);this._idlenessTracker.setPreviousRenderStatus(s)}),this._uiRenderData.particles!=null&&this._uiRenderData.particles.length!=0&&this._viewport.invalidate(),this._multiplayer!=null&&this.isTopLevelTransitionOngoing()&&this._multiplayer.onTransitionFrame(this._renderer.transitionProgressTracker().progress());this.afterFrame!=null&&this.afterFrame(),this.afterFirstRenderOfScreenStack!=null&&t&&this.afterFirstRenderOfScreenStack(),this._pointerEventDelegate.maybeProcessStoredPointerRelease()}_findHotspotsToAnimate(){let e=i=>{let a=i.canvasSpaceScrolledInteractiveBounds(1),s=i.canvasSpaceScrolledInteractiveBounds(0);return new hu(a,s)},t=this._appState.prototypeState(),n=this._appState.baseScreenNode();if(!(!this._showHotspots||!t.getTransitionOnClick()||this._hotspotAnimation.getOpacity()<=0)&&n!=null){let i=(s,l)=>{var p;let d=l.event().interactionType(),c=(p=l.action())==null?void 0:p.value;if(d=="ON_MEDIA_HIT"||d=="ON_MEDIA_END")return!1;if(l.actions().length==1&&c.navigationType()=="SWAP_STATE"){if(["ON_HOVER","ON_PRESS","AFTER_TIMEOUT"].indexOf(d)!=-1)return!1;if(s!=null)return Gt.whichInstanceToSwap(s,c==null?void 0:c.transitionNodeID())!=null}return!0},a=t.getTopmostOverlayNode();if(a!=null){let s=t.getTopmostOverlay();return this._appState.prototypeStructure().findHotspotsWithNoodleFilter(a,0,i).map(l=>{let d=e(l),c=s.overlaySpaceToBaseTlfSpace2(n,d.canvasSpaceBounds),p=s.overlaySpaceToBaseTlfSpace2(n,d.canvasSpaceClipBounds);return new hu(c,p)})}else return this._appState.prototypeStructure().findHotspotsWithNoodleFilter(n,1,i).map(e)}return null}hitTestDeviceFrame(e){let t=this._appState.getActiveCanvas();if(t==null)return!1;let n=this._appState.baseScreenNode();if(n==null)return!1;let o=this._renderer.deviceRenderer();if(o==null||!o.canRenderDeviceFrame(t.prototypeDevice()))return!1;let i=o.pixelAtPosition(e,n.canvasSpaceBoundingBox(),t.prototypeDevice());return O.alpha(i)>0}hitTestBaseScreen(e){let t=this._appState.baseScreenNode();if(t==null)return 0;let n=this._canvasSpacePoint(e),o=t.canvasSpaceBoundingBox();return o.contains2(n)?o.leftThird().contains2(n)?1:o.rightThird().contains2(n)?3:2:0}_canvasSpacePoint(e){return this._viewport.canvasSpaceToViewSpace1().clone().inverseTransformPoint(e.clone())}canvasContentBounds(){var e;return(e=this._appState.getActiveCanvas())==null?void 0:e.canvasSpaceRenderedBounds()}setMaximumDrawingBufferSizeForTesting(e){this._renderer.getContext().setMaximumDrawingBufferSizeForTesting(e)}clearMaximumDrawingBufferSizeForTesting(){this._renderer.getContext().clearMaximumDrawingBufferSizeForTesting()}triggerResizeForTesting(){let e=this._cachedAbsoluteBounds,t=e.clone();t.setWidth(t.width()-1),this._cachedAbsoluteBounds=t,this._resize(),this._cachedAbsoluteBounds=e,this._resize()}toggleRenderTreePrinting(){this._renderer.toggleRenderTreePrinting()}invalidateIdlenessTracker(){this._idlenessTracker.handleInteraction()}_nonNull(e){return e}_setupInteractionHandlers(e){let t=i=>a=>{Ae.perfTimerScope("discreteUserAction",Ae.ProfileLevel.LOW,()=>{i(a)})},n=i=>a=>{Ae.perfTimerScope("mouseMove",Ae.ProfileLevel.LOW,()=>{i(a)})},o=i=>a=>{Ae.perfTimerScope("dragUserAction",Ae.ProfileLevel.LOW,()=>{i(a)})};Jr.addUpdate(Bt.mousePress(this.events()),t(i=>{this._pointerEventDelegate.onMousePress(this._nonNull(i.asMouseEvent()))})),Jr.addUpdate(Bt.mouseDrag(this.events()),o(i=>{this._pointerEventDelegate.onDrag(this._nonNull(i.asMouseEvent()))})),Jr.addUpdate(Bt.mouseRelease(this.events()),t(i=>{this._pointerEventDelegate.onMouseRelease(this._nonNull(i.asMouseEvent()))})),Jr.addUpdate(Bt.mouseMove(this.events()),n(i=>{this._pointerEventDelegate.onMouseMove(this._nonNull(i.asMouseEvent()))})),Jr.addUpdate(Bt.mouseScroll(this.events()),o(i=>{this._pointerEventDelegate.onMouseScroll(this._nonNull(i.asMouseEvent()))})),Jr.addUpdate(Bt.mouseLeave(this.window().root().events()),t(i=>{this._pointerEventDelegate.onMouseLeave(this._nonNull(i.asMouseEvent()))})),Jr.addUpdate(Bt.touchPress(this.events()),t(i=>{this._pointerEventDelegate.onTouchPress(this._nonNull(i.asTouchEvent()))})),Jr.addUpdate(Bt.touchDrag(this.events()),o(i=>{this._pointerEventDelegate.onDrag(this._nonNull(i.asTouchEvent()))})),Jr.addUpdate(Bt.touchRelease(this.events()),t(i=>{this._pointerEventDelegate.onTouchRelease(this._nonNull(i.asTouchEvent()))})),Jr.addUpdate(Bt.keyPress(this.events()),t(i=>{this._pointerEventDelegate.onKeyPress(i.asKeyEvent(),e)})),Jr.addUpdate(Bt.gamepadDown(this.events()),t(i=>{this._pointerEventDelegate.onGamepadDown(i.asGamepadEvent())}))}_updateHoveredStateInstanceIfNeeded(e){let t=this._appState.prototypeState(),n=t.getStateMachineInitiatedChange(e)??t.getStateMachineLastChangeInHistory(e);n!=null&&n.cause==2?this._hoveredStateInstances.set(e.toString(),n):this._hoveredStateInstances.delete(e.toString())}_onCommitOrAbortForInteractions(e,t,n){if(this._triggerPotentialTimedTransition(e,t),this._createVideoTriggerEvents(e),this._mouseEnteredNodesManager.markNodesAsNotEnteredWithoutTriggeringMouseLeave(e.map(o=>o.id())),n!=null&&this._currentMouseLocation!=null&&!this._mostRecentTransitionViaArrows){let o=!this._mostRecentTransitionViaArrowsLegacy,i=this._currentMouseLocation;this._microtasksSinceLastFrame=this._microtasksSinceLastFrame+1,this._microtasksSinceLastFrame<=this.MAX_MICROTASKS_PER_FRAME&&dp(()=>{this.handleInteractionsForMove(i,o)})}}_createCallbackForMediaEvent(e,t,n){return()=>{this.triggerHotspot(e,t,n,null)}}_createVideoTriggerEvents(e){var t,n;if(this._appState.prototypeState().interactionsEnabled())if(Y.viewerCreateVideoTriggersOpt()){let o=this._appState.prototypeStructure().nodeTransitionTracker().cleanedUpMediaHitInteractionMap();for(let a of o.hotspots()){let s=o.getHotspotInteractions(a),l=(t=this._appState.scene())==null?void 0:t.findNode(a);if(l==null||s==null)return;for(let d of e)if(d.isAncestorOf(l)){this._createMediaHitEvents(s,new jo(l));break}}let i=this._appState.prototypeStructure().nodeTransitionTracker().cleanedUpMediaEndInteractionMap();for(let a of i.hotspots()){let s=i.getHotspotInteractions(a),l=(n=this._appState.scene())==null?void 0:n.findNode(a);if(l==null||s==null)return;for(let d of e)if(d.isAncestorOf(l)){this._createMediaEndEvents(s,new jo(l));break}}}else{let o=new Set([$e.mapToInteractionType(20),$e.mapToInteractionType(21)]),i=s=>o.has(s.event().interactionType()),a=this._appState.prototypeStructure().findHotspotsWithInteractionFilterWithinMultipleNodes(new Set(e),0,i);for(let s of a)this._registerMediaEventsForHotspot(s)}}_createMediaHitEvents(e,t){for(let n of e){let o=n.event().mediaHitTime();this._appState.videoManager().addInteractionEvent(n,t.node.id(),o,this._createCallbackForMediaEvent(t,n,20))}}_createMediaEndEvents(e,t){for(let n=0,o=e.length;n<o;n=n+1){let i=e[n],a=this._createCallbackForMediaEvent(t,i,21);if(this._appState.videoManager().addInteractionEvent(i,t.node.id(),0,a),n+1<e.length){let s=e[n+1];if(this._shouldTriggerVariantInteractionWithMediaAction(i,s)){let l=this._createCallbackForMediaEvent(t,s,21);this._appState.videoManager().addInteractionEvent(s,t.node.id(),0,l)}}}}_registerMediaEventsForHotspot(e){let t=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(e.node,$e.mapToInteractionType(20));this._createMediaHitEvents(t,e);let n=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(e.node,$e.mapToInteractionType(21));this._createMediaEndEvents(n,e)}_triggerPotentialTimedTransition(e,t){if(!this._appState.prototypeState().interactionsEnabled())return;let n=[],o=[],i=e.filter(s=>!e.some(l=>l!==s&&l.isAncestorOf(s)));for(let s of i){let l=this._appState.prototypeStructure().findHotspotsWithInteractionType(s,0,"AFTER_TIMEOUT");for(let d of l){let c=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(d.node,$e.mapToInteractionType(1));for(let p of c)n.push(p),o.push(d.node)}}let a=0;n.forEach(s=>{var f;let l=o[a];a=a+1;let d=s.getFirstActionInInteractionWithSpecificNavigation("SWAP_STATE"),c=d!=null?(f=Gt.whichInstanceToSwap(l,d.transitionNodeID()))==null?void 0:f.stablePath():null,p=this._appState.prototypeState(),u=c!=null?p.actionCountersForStateAndAncestors(c):[p.actionCounter()],_=this._appState.nodeTransitionTracker().topmostScreenChangeCounter(),h=l.stablePath(),S=()=>{var A;let T=(A=this._appState.scene())==null?void 0:A.findNodeByStablePath(h);if(T==null)return;let y=c!=null?p.actionCountersForStateAndAncestors(c):[p.actionCounter()];this._appState.nodeTransitionTracker().topmostScreenChangeCounter()==_&&ne.List_equalsWithComparison(u,y,(I,C)=>I==C)&&this.triggerDelayedHotspot(T.id(),s,1)},m=s.event().transitionTimeout()*1e3|0;(t==18||t==19)&&(m=Math.max(500,m)),setTimeout(S,m)})}updateCursorType(e,t){if(!this._appState.prototypeState().interactionsEnabled()){this.setCursor(0);return}if(Pt.isMobile(this.getRelevantOS())){this.setCursor(2);return}let n=this._appState.prototypeState().getTopmostScreen();if(n==null){this.setCursor(0);return}let o=this._hotspotAtViewportSpacePointWithInteractionType(e,"ON_CLICK",Yt.getNodeInteractionPairs("ON_CLICK",t));o==null&&(o=this._hotspotAtViewportSpacePointWithInteractionType(e,"ON_PRESS",Yt.getNodeInteractionPairs("ON_PRESS",t))),o==null&&(o=this._hotspotAtViewportSpacePointWithInteractionType(e,"MOUSE_DOWN",Yt.getNodeInteractionPairs("MOUSE_DOWN",t))),o==null&&(o=this._hotspotAtViewportSpacePointWithInteractionType(e,"MOUSE_UP",Yt.getNodeInteractionPairs("MOUSE_UP",t))),o!=null&&!X.equals(o.node.id(),n.id())?this.setCursor(1):this.setCursor(0)}_handleMaintainedInteraction(e,t,n){var u;if(!this._appState.prototypeState().interactionsEnabled()||t==null)return;let o=e.node.id(),i=t.event().interactionType();if(this._maintainedData.getByHotspotAndInteractionType(o,i)!=null)return;let a=this._maintainedData.set(o,i,n),s=t.getFirstActionInInteractionWithSpecificNavigation("SWAP_STATE"),l=s!=null?(u=Gt.whichInstanceToSwap(e.node,s.transitionNodeID()))==null?void 0:u.stablePath():null,d=l!=null?this._appState.prototypeState().actionCounterForState(l):-1,c=this._appState.prototypeState().actionCounter();setTimeout(()=>{var E;let _=this._maintainedData.getByHotspotAndInteractionType(o,i);if(_==null)return;let h=_.counter(),S=l!=null?this._appState.prototypeState().actionCounterForState(l):-1,m=this._appState.prototypeState().actionCounter(),f=(E=this._appState.scene())==null?void 0:E.findNode(o),T=a==h,y=T&&c==m&&d==S;T&&this._maintainedData.resetEntry(o,i),y&&f!=null&&this.triggerDelayedHotspot(f.id(),t,_.action())},t.event().interactionDuration()*1e3|0)}_handleMouseEnterMouseLeave(e,t){let n=this._canvasSpacePoint(e);this._mouseEnteredNodesManager.updateEnteredNodes(n,t),this._mouseEnteredNodesManager.resetNoLongerMaintainedMouseEnterOrLeaveInteractions(this._maintainedData);let o=de.WasHandled.NOT_HANDLED,i=this._appState.prototypeState().actionCounter(),a=this._appState.prototypeState(),s=a.getTopmostOverlayNode(),l=this._appState.baseScreenNode(),d=s??l,c=a.getSecondTopmostOverlayNodeOrBaseScreen(),p=this._appState.prototypeStructure().findHotspotsWithInteractionFilter(d,0,S=>S.event().interactionType()=="MOUSE_LEAVE",Yt.getNodeInteractionPairs("MOUSE_LEAVE",t));if(c!=null){let S=this._appState.prototypeStructure().findHotspotsWithInteractionFilter(c,0,m=>m.event().interactionType()=="MOUSE_LEAVE");Ir(p,S)}let u=this._appState.prototypeStructure().findHotspotsWithInteractionFilter(d,0,S=>S.event().interactionType()=="MOUSE_ENTER",Yt.getNodeInteractionPairs("MOUSE_ENTER",t)),_=this._mouseEnteredNodesManager.getNewlyLeftMouseLeaveHotspotsInOrderOfLeaving(p);for(let S of _){let m=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(S.node,"MOUSE_LEAVE"),f=this._appState.prototypeState().actionCounter();if(i!=f)return o;o=this._triggerOrHandleMaintainedInteractions(m,S,13,e)}let h=this._mouseEnteredNodesManager.getNewlyEnteredMouseEnterHotspotsInOrderOfEntering(u);for(let S of h){let m=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(S.node,"MOUSE_ENTER"),f=this._appState.prototypeState().actionCounter();if(i!=f)return o;o=this._triggerOrHandleMaintainedInteractions(m,S,12,e)}return o}handleInteractionsForMove(e,t){if(this._appState.scene()==null||!this._appState.prototypeState().interactionsEnabled())return;let n=this._appState.prototypeState().getTopmostScreen(),o=this._appState.prototypeStructure().getInteractionsGroupedByType([n]);this.updateCursorType(e,o);let i=this._handleMouseEnterMouseLeave(e,o);t&&(i=this._handleGranularMoveForDeprecatedMouseInMouseOut(e,o)),i==de.WasHandled.NOT_HANDLED&&t&&(this._handleHover1(e,o),this._handleReverseHover(e))}_handleGranularMoveForDeprecatedMouseInMouseOut(e,t){let n=10,o=this._hotspotAtViewportSpacePointWithInteractionType(e,"MOUSE_IN",Yt.getNodeInteractionPairs("MOUSE_IN",t));if(o==null&&(o=this._hotspotAtViewportSpacePointWithInteractionType(e,"MOUSE_OUT",Yt.getNodeInteractionPairs("MOUSE_OUT",t)),n=11),this._maintainedData.resetAllEntriesMatchingPredicate((a,s)=>["MOUSE_IN","MOUSE_OUT"].indexOf(s)!=-1&&!X.equals(o!=null?o.node.id():null,a)),o==null)return de.WasHandled.NOT_HANDLED;let i=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(o.node,$e.mapToInteractionType(n));return this._triggerOrHandleMaintainedInteractions(i,o,n,e)}_handleHover1(e,t){let n=this._hotspotAtViewportSpacePointWithInteractionType(e,"ON_HOVER",Yt.getNodeInteractionPairs("ON_HOVER",t));return this._handleHover2(n,e)}handleHoverAtHotspot(e){return this._mostRecentTransitionViaArrows=!0,this._mostRecentTransitionViaArrowsLegacy=!0,this._handleHover2(e,null)}_handleHover2(e,t){if(e!=null){let n=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(e.node,$e.mapToInteractionType(2));for(let o of n)return this.triggerHotspot(e,o,2,t),o.setHoverLastHandledFrameNum(this.mostRecentFrameNum()),de.WasHandled.HANDLED}return de.WasHandled.NOT_HANDLED}handleReverseHoverAtHotspot(e){var o;let t=e.node,n=Ge.StringMap_get(this._hoveredStateInstances,e.node.stablePath().toString(),null);return n==null||!X.equals((o=t.topLevelAncestor())==null?void 0:o.id(),this._appState.prototypeState().getTopmostScreenId())?de.WasHandled.NOT_HANDLED:(this._appState.prototypeState().returnInstanceToState(n.stablePath,2,6),de.WasHandled.HANDLED)}_handleReverseHover(e){var S,m;if(this._multiplayer!=null&&this._multiplayer.isObserving())return de.WasHandled.HANDLED;let t=this._appState.prototypeState(),n=de.WasHandled.NOT_HANDLED;for(let f of Array.from(this._hoveredStateInstances.keys())){let T=Ge.StringMap_get(this._hoveredStateInstances,f,null);if(T==null)continue;let y=this._appState.scene().findNodeByStablePath(T.stablePath);if(y==null||!X.equals((S=y.topLevelAncestor())==null?void 0:S.id(),t.getTopmostScreenId()))continue;let E=(m=T==null?void 0:T.canvasSpaceTriggerBoundsOrNull)==null?void 0:m.clone(),v=t.getCurrentBaseScreenNode();if(E!=null&&v!=null){let A=null,I=this._canvasSpacePoint(e),C=this._appState.prototypeState().getTopmostOverlay();if(A=(C==null?void 0:C.baseTlfSpaceToOverlaySpace1(v,I))??I,y.scrollAndClipBoundsBySelfAndAncestors(E,0).contains2(A))continue;t.returnInstanceToState(T.stablePath,2,6),n=de.WasHandled.HANDLED;break}}if(n==de.WasHandled.HANDLED)return n;let o=this._appState.prototypeState().getInitiatedChange()??this._appState.prototypeState().getLastChangeInHistory(),i=o==null?void 0:o.canvasSpaceTriggerBoundsOrNull;if(!(i!=null&&o.cause==2))return de.WasHandled.NOT_HANDLED;let s=null;if(s=this._appState.scene().findNode(o==null?void 0:o.oldStateId()),s==null)return de.WasHandled.NOT_HANDLED;let l=null,d=this._canvasSpacePoint(e);X.equals(o==null?void 0:o.oldStateId(),o==null?void 0:o.newStateId())||(d=this._canvasSpacePointInPreviousFrame(s,this._appState.baseScreenNode(),d));let c=o==null?void 0:o.oldOverlays(this._appState.prototypeState());c.length>0?l=ne.List_last(c).baseTlfSpaceToOverlaySpace1(s,d):l=d;let p=o!=null?o.interactionAddress.hotspotStablePath:null,u=this._retrieveReverseInteractionHotspotFromStoredData(p);if(u==null||u.scrollAndClipBoundsBySelfAndAncestors(i,0).contains2(l))return de.WasHandled.NOT_HANDLED;let h=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(this._retrieveReverseInteractionHotspotFromStoredData(p),$e.mapToInteractionType(2));for(let f of h){if(f.getHoverLastHandledFrameNum()==this.mostRecentFrameNum())break;return this.requestBack(u,f,2,6,null,null),de.WasHandled.HANDLED}return de.WasHandled.NOT_HANDLED}_retrieveReverseInteractionHotspotFromStoredData(e){return this._appState.scene().findNodeByStablePath(e)}handleInteractionsForPress(e){if(this._lastPressData=null,!this._appState.prototypeState().interactionsEnabled())return de.WasHandled.HANDLED;this._maintainedData.resetAllEntriesWithInteractionType("MOUSE_UP");let t=this._handleMouseDown(e);return t==de.WasHandled.NOT_HANDLED&&(t=this._handlePress(e)),t}_handleMouseDown(e){if(!this._appState.prototypeState().interactionsEnabled())return de.WasHandled.HANDLED;let t=this._hotspotAtViewportSpacePointWithInteractionType(e,"MOUSE_DOWN");if(t==null)return de.WasHandled.NOT_HANDLED;let n=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(t.node,$e.mapToInteractionType(8));return this._triggerOrHandleMaintainedInteractions(n,t,8,e)}_handlePress(e){if(!this._appState.prototypeState().interactionsEnabled())return de.WasHandled.HANDLED;let t=this._hotspotAtViewportSpacePointWithInteractionType(e,"ON_PRESS");if(t==null)return de.WasHandled.NOT_HANDLED;let n=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(t.node,$e.mapToInteractionType(3));for(let o of n){let i=t.node.stablePath(),a=o.getFirstActionInInteractionWithSpecificNavigation("SWAP_STATE");if(a!=null){let s=Gt.whichInstanceToSwap(t.node,a.transitionNodeID());this._lastPressData=new qh(s==null?void 0:s.stablePath(),i)}else this._lastPressData=new qh(null,i);return this.triggerHotspot(t,o,3,e),de.WasHandled.HANDLED}return de.WasHandled.NOT_HANDLED}maybeHandleSingleTapAsNavigation(e){if(this._appState.scene()==null||this._appState.getActiveCanvas()==null)return!1;if(this._appState.prototypeStructure().isLinear()){let o=this.hitTestBaseScreen(e);if(o!=0&&o!=2){let i=o==1?-1:1;return i==1?this.navigateForward(17):this.navigateBackward(17),Math.random()<this.INTERACTION_REPORTING_RATE&&Ae.trackEvent("prototype_view_interaction",{type:"navigateViaArrows",direction:i==1?"FORWARD":"REVERSE",inputType:"tap",nonInteraction:0,prototypeType:this._appState.prototypeStructure().navigationOrder().navigationOrderTypeString()}),!0}}return!1}handleInteractionsForRelease(e,t,n){let o=this._lastPressData;if(this._lastPressData=null,!this._appState.prototypeState().interactionsEnabled())return de.WasHandled.HANDLED;this._maintainedData.resetAllEntriesWithInteractionType("MOUSE_DOWN");let i=this._appState.prototypeState().isDragging(),a=this._viewport.viewSpaceToCanvasSpace1().transformPoint(e.clone());if(this._interactionObservers.forEach(c=>{c.handleRelease(a)}),i)return this._appState.prototypeState().setIsDragging(!1),de.WasHandled.HANDLED;let s=this._handleMouseUp(e);s==de.WasHandled.NOT_HANDLED&&t&&(s=this._handleClick(e)),s==de.WasHandled.NOT_HANDLED&&(s=this._handleReversePress(o));let l=s==de.WasHandled.NOT_HANDLED,d=n==de.WasHandled.NOT_HANDLED;return l&&d&&hs.notifyUnhandledMouseRelease(this._appState,a),s}_handleMouseUp(e){if(!this._appState.prototypeState().interactionsEnabled())return de.WasHandled.HANDLED;let t=this._hotspotAtViewportSpacePointWithInteractionType(e,"MOUSE_UP");if(t==null)return de.WasHandled.NOT_HANDLED;let n=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(t.node,$e.mapToInteractionType(9));return this._triggerOrHandleMaintainedInteractions(n,t,9,e)}_handleReversePress(e){if(!this._appState.prototypeState().interactionsEnabled()||this._multiplayer!=null&&this._multiplayer.isObserving())return de.WasHandled.HANDLED;if(e==null)return de.WasHandled.NOT_HANDLED;if(e.swappedStablePath!=null)return this._appState.prototypeState().returnInstanceToState(e.swappedStablePath,2,7),de.WasHandled.HANDLED;{let t=e.hotspotStablePath!=null?this._retrieveReverseInteractionHotspotFromStoredData(e.hotspotStablePath):null,n=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(t,$e.mapToInteractionType(3));for(let o of n)return this.requestBack(t,o,2,7,null,null),de.WasHandled.HANDLED}return de.WasHandled.NOT_HANDLED}_handleClick(e){if(!this._appState.prototypeState().interactionsEnabled()||!this._appState.prototypeState().getTransitionOnClick())return de.WasHandled.HANDLED;this._appState.prototypeState().disengageObservationOnClick()&&this.disengageObservationMode();let t=this._hotspotAtViewportSpacePointWithInteractionType(e,"ON_CLICK"),n=(t==null?void 0:t.node)||null,o=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(n,$e.mapToInteractionType(4));if(Y.getFeatureFlags().piper_object_animations&&this._appState.prototypeStructure().navigationOrderType()==2){let i=o.filter(a=>{let s=a.actions();for(let l of s)if(l.navigationType()=="NAVIGATE"&&l.connectionType()=="INTERNAL_NODE")return!1;return!0});return i.length>0?i.forEach(a=>{this.triggerHotspot(t,a,4,e)}):this.navigateForward(4),de.WasHandled.HANDLED}else{for(let i=0,a=o.length;i<a;i=i+1){let s=o[i];if(this.triggerHotspot(t,s,4,e),i+1<o.length){let l=o[i+1];this._shouldTriggerVariantInteractionWithMediaAction(s,l)&&this.triggerHotspot(t,l,4,e)}return de.WasHandled.HANDLED}if(this._shouldCloseTopmostOverlayOnClickOutside(e)){let i=this._appState.prototypeState().getCurrentOverlayData().length-1;return this._appState.prototypeState().closeOverlayAtAndAbove(i,1),de.WasHandled.HANDLED}}return de.WasHandled.NOT_HANDLED}performHotspotAnimationOnClick(){this._hotspotAnimation.onClick()}handleInteractionsForDrag(e){let t=this._hotspotAtViewportSpacePointWithInteractionType(e,"MOUSE_DOWN");this._maintainedData.resetAllEntriesMatchingPredicate((o,i)=>i=="MOUSE_DOWN"&&!X.equals(t!=null?t.node.id():null,o));let n=this._viewport.viewSpaceToCanvasSpace1().transformPoint(e.clone());this._interactionObservers.forEach(o=>{o.handleDrag(n)})}handleDragStart(e,t,n){if(!this._appState.prototypeState().interactionsEnabled()||this._appState.prototypeState().isDragging())return de.WasHandled.HANDLED;if(t==null)return de.WasHandled.NOT_HANDLED;let o=this._appState.prototypeStructure().findPrototypeInteractionWithId(t!=null?t.id():null,n);if(o==null)return de.WasHandled.NOT_HANDLED;this.triggerHotspot(new jo(t),o,5,e),this._appState.prototypeState().setIsDragging(!0);let i=this._viewport.viewSpaceToCanvasSpace1().transformPoint(e.clone());return this._interactionObservers.forEach(a=>{a.handleDragStart(i)}),de.WasHandled.HANDLED}handleInteractionsForScroll(){this._maintainedData.resetAllEntriesWithInteractionType("MOUSE_DOWN"),this._lastPressData!=null&&(this._handleReversePress(this._lastPressData),this._lastPressData=null)}handleFling(e,t){var l;let n=t.length,o=Me.seconds(),i=this._appState.getActiveCanvas();if(i==null)return de.WasHandled.NOT_HANDLED;if(!this._appState.prototypeState().interactionsEnabled())return de.WasHandled.HANDLED;let a=(l=i.scene())==null?void 0:l.findNode(e),s=50*ho();this._initialFlingVelocity=new b(0,0);for(let d=n-1;d>=0;d=d-1)if(d==0||o-t[d-1].startTime>.1){let c=t[d],p=t[n-1],u=p.startLocation.subtract(c.startLocation).divideScalar(p.startTime-c.startTime),_=u.length(),h=Math.log(1+_)/5,S=_*h/5,m=u.multiplyScalar(S/_);if(c!=p&&_>s)if(a==null||a==i)this._viewport.flingCameraOffset(m,h);else{this._initialFlingVelocity=this.restrictScrollDeltaAxes(a,u).negative();let f=de._scrollPhysics.createBallisticScrollSimulation(a.scrollOffset(),this._initialFlingVelocity,a.minScrollOffsetX(),a.maxScrollOffsetX(),a.minScrollOffsetY(),a.maxScrollOffsetY());return f!=null&&(de._scrollAnimationManager=new Ic(f,a.id())),de.WasHandled.HANDLED}break}return de.WasHandled.NOT_HANDLED}handleInteractionsForLeave(){this._maintainedData.resetAllEntriesWithInteractionType("MOUSE_DOWN"),this._maintainedData.resetAllEntriesWithInteractionType("MOUSE_IN"),this.handleInteractionsForMove(fe.FrozenVector_new4(-1,-1),!0)}handleInteractionsForKeyPress(e){let t=this._appState.prototypeState().getTopmostScreen(),n=this._appState.prototypeStructure().findHotspotsWithInteractionType(t,0,"ON_KEY_DOWN"),o=this._createListFromKeyEvent(e),i=s=>(s=Pt.current()!=4&&s==this.META_CODE?this.CONTROL_CODE:s,o.some(l=>l.indexOf(s)!=-1)),a=s=>{let l=s.event().keyTrigger().triggerDevice=="KEYBOARD",d=s.event().keyTrigger().keyCodes;if(d==null)return!1;let c=d.length==o.length;return l&&c&&d.every(i)};for(let s of n){let d=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(s.node,$e.mapToInteractionType(14)).filter(a);for(let c=0,p=d.length;c<p;c=c+1){let u=d[c];if(this.triggerHotspot(s,u,14,null),c+1<d.length){let _=d[c+1];this._shouldTriggerVariantInteractionWithMediaAction(u,_)&&this.triggerHotspot(s,_,14,null)}return e.accept(),de.WasHandled.HANDLED}}return de.WasHandled.NOT_HANDLED}_createListFromKeyEvent(e){let t=[];return 1&e.modifiers()&&t.push([this.ALT_CODE]),4&e.modifiers()&&t.push([this.SHIFT_CODE]),2&e.modifiers()&&t.push([this.META_CODE]),8&e.modifiers()&&t.push([this.CONTROL_CODE]),cd.Key_isModifier(e.key)||t.push(cd.Key_keyToKeyCode(e.key)),t}handleInteractionsForGamepadDown(e){let t=this._appState.prototypeState().getTopmostScreen(),n=i=>{let a=i.event().keyTrigger().triggerDevice!="KEYBOARD";return i.event().keyTrigger().keyCodes==null?!1:a&&i.event().keyTrigger().keyCodes.indexOf(e.button)!=-1},o=this._appState.prototypeStructure().findHotspotsWithInteractionType(t,0,"ON_KEY_DOWN");for(let i of o){let s=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(i.node,$e.mapToInteractionType(14)).filter(n);for(let l=0,d=s.length;l<d;l=l+1){let c=s[l];if(this.triggerHotspot(i,c,14,null),l+1<s.length){let p=s[l+1];this._shouldTriggerVariantInteractionWithMediaAction(c,p)&&this.triggerHotspot(i,p,14,null)}return e.accept(),de.WasHandled.HANDLED}}return de.WasHandled.NOT_HANDLED}addInteractionObserver(e){this._interactionObservers.add(e)}removeInteractionObserver(e){this._interactionObservers.remove(e)}_hotspotAtViewportSpacePointWithInteractionType(e,t,n){if(!this._appState.prototypeState().getTransitionOnClick())return null;let o=this._canvasSpacePoint(e);return this._hotspotAtCanvasSpacePointWithInteractionType(o,t,n)}_hotspotAtCanvasSpacePointWithInteractionType(e,t,n){let o=this._appState.baseScreenNode();if(o==null||!o.canvasSpaceBoundingBox().contains2(e)&&t!="MOUSE_OUT")return null;let i=this._appState.prototypeState(),a=i.getTopmostOverlayNode();if(a!=null){let s=i.getTopmostOverlay().baseTlfSpaceToOverlaySpace1(o,e);return this._appState.prototypeStructure().hotspotOnPresentedNode(a,s,t,n)}else return this._appState.prototypeStructure().hotspotOnPresentedNode(o,e,t,n)}_canvasSpacePointInPreviousFrame(e,t,n){if(e==t)return n;let o=t.absoluteTransform().clone();if(!o.invert())return n;let i=e.absoluteTransform(),a=n.clone();return o.transformPoint(a),i.transformPoint(a),a}updateUserCursor(e){this._currentMouseLocation=e==null?void 0:e.locationInView(this),this._sendMouseCursorUpdate()}_shouldCloseTopmostOverlayOnClickOutside(e){let t=this._appState.prototypeState().getTopmostOverlay(),n=this._appState.prototypeState().getTopmostOverlayNode(),o=this._appState.baseScreenNode();if(o==null||n==null||t.backgroundInteraction()!="CLOSE_ON_CLICK_OUTSIDE")return!1;let i=this._canvasSpacePoint(e),a=t.baseTlfSpaceToOverlaySpace1(o,i);return!n.canvasSpaceBoundingBox().contains2(a)}recordViewportSpaceClick(e){if(this._multiplayer==null)return;let t=this._canvasSpacePoint(e);this._multiplayer.recordCanvasSpaceClick(t)}_sendMouseCursorUpdate(){if(this._multiplayer!=null)if(this._currentMouseLocation==null)this._multiplayer.setCanvasSpaceMouse(null);else{let e=this._canvasSpacePoint(this._currentMouseLocation);e!=null&&this._multiplayer.setCanvasSpaceMouse(e)}}triggerMouseAction(e,t){this._appState.triggerAction2(e,t)}_triggerOrHandleMaintainedInteractions(e,t,n,o){for(let i=0,a=e.length;i<a;i=i+1){let s=de.WasHandled.NOT_HANDLED,l=e[i];if(l.event().interactionMaintained()?(this._handleMaintainedInteraction(t,l,n),s=de.WasHandled.MAINTAINED):(this.triggerHotspot(t,l,n,o),s=de.WasHandled.HANDLED),i+1<e.length){let d=e[i+1];this._shouldTriggerVariantInteractionWithMediaAction(l,d)&&(l.event().interactionMaintained()?(this._handleMaintainedInteraction(t,d,n),s=de.WasHandled.MAINTAINED):(this.triggerHotspot(t,d,n,o),s=de.WasHandled.HANDLED))}return s}return de.WasHandled.NOT_HANDLED}_shouldTriggerVariantInteractionWithMediaAction(e,t){let n=e.allActions().length>=1&&e.allActions().every(l=>l.connectionType()=="UPDATE_MEDIA_RUNTIME"),o=e.allActions().length>=1&&e.allActions().every(l=>X.isValid(l.transitionNodeID())),i=t.getFirstActionInInteractionWithSpecificNavigation("SWAP_STATE"),a=i!=null&&i.connectionType()=="INTERNAL_NODE",s=n&&o&&a;return s&&Y.getFeatureFlags().prototype_log_video_and_ic_swap&&Ae.trackEvent("prototype_interaction_conflict_override_triggered",{interaction_type:e.event().interactionType(),action_type:e.actions().map(l=>l.mediaAction())}),s}getRelevantOS(){return this._appState.getActiveCanvas()==null?0:de._getRelevantOSForDevice(this._appState.getActiveCanvas().prototypeDevice())}_resetScrollForTlf(e){if(e!=null){this.updateScrollOffsetForNode(e,fe.FrozenVector_ZERO);let t=e.scrollableFrameDescendants();for(let n of t)this.updateScrollOffsetForNode(n,fe.FrozenVector_ZERO)}}getBestScrollOrDragProposal(e,t,n){let o=this._appState.getActiveCanvas();if(o==null)return null;if(this._appState.currentScalingInfo().fitMode=="min-zoom"&&this._viewport.zoomScale()!=1)return new de.ScrollOrDragProposal(de.ScrollOrDragProposal.InteractionType.SCROLL,1,o==null?void 0:o.id(),null);let i=this._canvasSpacePoint(t);if(i==null||this._appState.baseScreenNode()==null)return null;let a=null;e==de.ScrollOrDragQuerySet.SCROLL_OR_DRAG&&(a=(l,d)=>dr.computeDragVector1(l,d,this._appState.baseScreenNode(),this._appState.prototypeStructure(),this._appState.prototypeState()));let s=this._appState.prototypeState().getCurrentOverlays();for(let l=0,d=s.length;l<d;l=l+1){let c=s[s.length-l-1],p=c.node();if(p==null)continue;let u=c.baseTlfSpaceToOverlaySpace1(this._appState.baseScreenNode(),i);if(!p.canvasSpaceBoundingBox().contains2(u)){if(c.backgroundAppearance().backgroundType=="SOLID_COLOR")return null;continue}let _=de.findBestScrollOrDragProposalInFrame(o,u,n,p,this._appState.activePrototypeDevice(),a);return X.equals(_==null?void 0:_.targetNodeId,o==null?void 0:o.id())?null:_}return de.findBestScrollOrDragProposalInFrame(o,i,n,this._appState.baseScreenNode(),this._appState.activePrototypeDevice(),a)}_updateForAnimation(){if(de._scrollAnimationManager==null)return;let e=!de._scrollAnimationManager.isValid(this._appState.scene());e||(de._scrollAnimationManager.performScroll(this,this._appState.scene()),e=de._scrollAnimationManager.isDone()),e&&(this.cancelAnimationManager(),this._sequentialActionManager.runNextAction())}cancelAnimationManager(){de._scrollAnimationManager=null}maybeHandleOverdragRelease(){var n;if(de._overscrolledNodeID==null)return;let e=(n=this._appState.scene())==null?void 0:n.findNode(de._overscrolledNodeID);de._overscrolledNodeID=null,!(e==null||de.clampScrollOffsetForNode(e,e.scrollOffset()).equals(e.scrollOffset()))&&(de._scrollAnimationManager=new Ic(new mc(e.scrollOffset(),new b(0,0),e.minScrollOffsetX(),e.maxScrollOffsetX(),e.minScrollOffsetY(),e.maxScrollOffsetY()),e.id()))}setPhysicsForOS(e){switch($g(e)){case 0:{de._scrollPhysics=new uu;break}case 1:{de._scrollPhysics=new pu;break}case 2:{de._scrollPhysics=new dc;break}}}_maybeChangePhysicsForDevice(e){let t=this.getRelevantOS(),n=de._getRelevantOSForDevice(e);t!=n&&this.setPhysicsForOS(t)}updateScrollOffsetForNode(e,t){let n=de.clampScrollOffsetForNode(e,t),o=this.restrictScrollDeltaAxes(e,t),i=this._pointerEventDelegate.isDragging();if(e.scrollOffset().equals(n)&&(!i||e.scrollOffset().equals(t)))return!1;if(i&&!n.equals(t)){let s=de._scrollPhysics.applyOverscrollBehavior(o,n,e.scrollOffset(),e.size());s.equals(n)||(de._overscrolledNodeID=e.id(),n=s)}e.setScrollOffset(n),this._observers.forEach(s=>{s.didScrollNode(e)}),this._emitter.trigger("scrollNode",e.id());let a=e.id();return this._multiplayer!=null&&this._multiplayer.setScrollPosition(a,e.scrollOffset()),!0}setScrollOffsetUnconditionally(e,t){e.setScrollOffset(t);let n=e.id();this._multiplayer!=null&&this._multiplayer.setScrollPosition(n,t)}restrictScrollDeltaAxes(e,t){let n=t.clone();switch(e.scrollDirection()){case"HORIZONTAL":{n.setY(0);break}case"VERTICAL":{n.setX(0);break}case"NONE":{n.setX(0),n.setY(0);break}case"BOTH":{let o=null;switch(e.overflowDirection()){case"NONE":{o="NONE";break}case"HORIZONTAL":{o="HORIZONTAL";break}case"VERTICAL":{o="VERTICAL";break}case"BOTH":{o="BOTH";break}}!ln.scrollsHorizontally(o)&&!e.hasOverflowingContentInXDirection()&&n.setX(0),!ln.scrollsVertically(o)&&!e.hasOverflowingContentInYDirection()&&n.setY(0);break}}return n}scrollToDestinationInFrame(e,t){var i;let n=this._appState.scene().findNode(e),o=n.parent();for(;o!=null&&!((o.scrollDirection()!="NONE"||o.isTopLevel())&&!o.isTooRotatedToScroll());)o=o.parent();if(o!=null){let a=(i=t.action())==null?void 0:i.value;for(let d of t.getAllActionsWithSpecificTransitionType("SCROLL_ANIMATE"))a=d;let s=kr.fromPrototypeAction(a,t.stateManagementVersion()),l=n.absoluteTransform().translation().add(s.extraScrollOffset).subtract(o.absoluteTransform().translation());if(a.transitionType()=="SCROLL_ANIMATE"){let d=de.clampScrollOffsetForNode(o,l);de._scrollAnimationManager=new Ic(new _u(o.scrollOffset(),d,s.transitionDuration,s.easingFunction),o.id())}else this.updateScrollOffsetForNode(o,l)}}scrollNode(e,t,n){var s,l;let o=(s=this._appState.scene())==null?void 0:s.findNode(e);if(o==null)return!1;if(de._scrollAnimationManager!=null&&de._scrollAnimationManager.isOverscrolled()){let d=de._scrollAnimationManager;if(o.id()!=d.nodeID()){let c=(l=this._appState.scene())==null?void 0:l.findNode(d.nodeID());c!=null&&c.setScrollOffset(d.simulation().endPos())}this.cancelAnimationManager()}else de._scrollAnimationManager!=null&&t!=de.ScrollSource.FLING&&this.cancelAnimationManager();if(o.isTooRotatedToScroll()||o.scrollDirection()=="NONE")return!1;let i=o.scrollOffset().clone();o.scrollDirection()=="HORIZONTAL"?i.setX(i.x()+(n.x()==0&&t==de.ScrollSource.SCROLL_EVENT?n.y():n.x())):i.addUpdate1(n);let a=this.updateScrollOffsetForNode(o,i);return this.disengageObservationMode(),a}_updateScrollOffsetsFromMultiplayer(){var t,n;let e=((t=this._multiplayer)==null?void 0:t.getScrollPositions())||new Map;if(e!=null)for(let o of Array.from(e.keys())){let i=X.fromString(o),a=(n=this._appState.scene())==null?void 0:n.findNode(i);a!=null&&a.setScrollOffset(e.get(o))}}_clampDirtyScrollContainers(){let e=this._appState.scene();if(e==null)return;let t=new Set;for(let n of Array.from(de._dirtyNodesForScrollClamping.values())){let o=e.findNode(n);for(let i=o;i!=null&&!(t.has(i.id())||i!=o&&zt.isFrameLike(i.type())&&i.clipsToBoundingRectangle());i=i.parent())i.scrollDirection()!="NONE"&&this.updateScrollOffsetForNode(i,i.scrollOffset()),t.add(i.id())}de._dirtyNodesForScrollClamping=new Set}_handleScrollingPropertyChange(e,t,n,o){if(t==41)e.setScrollOffset(fe.FrozenVector_ZERO);else if(t==57||t==30)de._dirtyNodesForScrollClamping.add(e.id());else if(t==69){let i=this._appState.baseScreenNode();i!=null&&this.updateScrollOffsetForNode(i,i.scrollOffset())}else t==98&&(this._renderer.updateScroll(e),this._emitter.trigger("scrollEvent"))}renderLayerByLayerActivate(){this._renderer.renderLayerByLayerActivate(()=>{this.viewport().invalidate()})}renderLayerByLayerDeactivate(){this._renderer.renderLayerByLayerDeactivate()}renderLayerByLayerPlay(){this._renderer.renderLayerByLayerPlay()}renderLayerByLayerPause(){this._renderer.renderLayerByLayerPause()}renderLayerByLayerForward(){this._renderer.renderLayerByLayerForward()}renderLayerByLayerBackward(){this._renderer.renderLayerByLayerBackward()}renderLayerByLayerRewind(){this._renderer.renderLayerByLayerRewind()}renderLayerByLayerIncreaseSpeed(){this._renderer.renderLayerByLayerIncreaseSpeed()}renderLayerByLayerDecreaseSpeed(){this._renderer.renderLayerByLayerDecreaseSpeed()}static findBestScrollOrDragProposalInTree(e,t,n,o,i){let a=o==0,s=null;return s=(l,d)=>{let c=l.canvasSpaceGeometryBounds().contains2(d),p=l.canvasSpaceBoundingBox().contains2(d);if(l.clipsToBoundingRectangle()&&!c&&!p)return null;let u=null;for(let y=0,E=l.childCount();y<E;y=y+1){let v=l.childAt2(l.childCount()-y-1,!0),A=d,I=Oi.getScrollTranslationOfNodeRelativeToParent(v);A=d.add(I);let C=s(v,A);u=(u==null?void 0:u.updateToBestProposal1(C))??C}let _=l.scrollDirectionWithScrollableContent(),h=p||c,S=_!="NONE"&&h&&!l.isInvisibleOrTransparent(),m=h&&l.visible()&&l.prototypeInteractions().some(y=>y.event().interactionType()=="DRAG"&&y.allActions().some(E=>eu.isValidForConnection(y.event().interactionType(),E.connectionType()))),f=t.length()>0?t.divideScalar(t.length()):t,T=null;if(h){if(S){let y=fv(_),E=de.ScrollOrDragProposal.InteractionType.OVERSCROLL;Math.abs(f.y())>0&&Math.abs(y.y())>0&&(f.y()>0?l.scrollOffset().y()<l.maxScrollOffsetY():l.scrollOffset().y()>l.minScrollOffsetY())&&(E=de.ScrollOrDragProposal.InteractionType.SCROLL),Math.abs(f.x())>0&&Math.abs(y.x())>0&&(f.x()>0?l.scrollOffset().x()<l.maxScrollOffsetX():l.scrollOffset().x()>l.minScrollOffsetX())&&(E=de.ScrollOrDragProposal.InteractionType.SCROLL);let v=ln.getDirectionSimilarity(_,f);(E==de.ScrollOrDragProposal.InteractionType.SCROLL||a)&&(T=new de.ScrollOrDragProposal(E,v,l.id(),null))}if(i!=null&&m){let y=f.multiplyScalar(-1);for(let E of l.prototypeInteractions().filter(v=>v.event().interactionType()=="DRAG")){let v=i(l,E),A=v!=null?y.dot(v.divideScalar(v.length())):0;T=(T==null?void 0:T.updateToBestProposal2(de.ScrollOrDragProposal.InteractionType.DRAG,A,l.id(),E.id()))??new de.ScrollOrDragProposal(de.ScrollOrDragProposal.InteractionType.DRAG,A,l.id(),E.id())}}}return T=(u==null?void 0:u.updateToBestProposal1(T))??T,T},s(n,e)}static _canvasSpaceBoundsOfDeviceBackground(e,t){let n=Fn.infoForDevice(t);if(n==null)return Yr.FrozenRect_EMPTY;let o=e.canvasSpaceBoundingBox().topLeft(),i=t.canvasSpaceFramePresetSize(n);return new G(o.x(),o.y(),i.x(),i.y())}static findBestScrollOrDragProposalInFrame(e,t,n,o,i,a){if(o==null)return null;let s=i!=null&&Ka.hasDevice(i.type),l=$g(de._getRelevantOSForDevice(i)),d=Math.abs(n.y())>Math.abs(n.x())?"VERTICAL":"HORIZONTAL",c=o.scrollsInPreferredDirection(d)&&o.hasOverflowingContentInScrollDirection();if(o.canvasSpaceBoundingBox().contains2(t)){let p=de.findBestScrollOrDragProposalInTree(t,n,o,l,a);if(p!=null)return p;if(s)return null}else if(s){if(de._canvasSpaceBoundsOfDeviceBackground(o,i).contains2(t))return null}else if(c)return new de.ScrollOrDragProposal(de.ScrollOrDragProposal.InteractionType.SCROLL,1,o.id(),null);return new de.ScrollOrDragProposal(de.ScrollOrDragProposal.InteractionType.SCROLL,1,e==null?void 0:e.id(),null)}static copyScrollOffset(e,t,n){t!=null&&n!=null&&(e==null?n.setScrollOffset(t.scrollOffset()):e.updateScrollOffsetForNode(n,t.scrollOffset()))}static findMatchingTransitionNode(e,t){let n=t.filter(l=>l.name()==e.name());if(n.length==1)return n[0];let o=e.canvasSpaceBoundingBox(),i=t.filter(l=>l.canvasSpaceBoundingBox().size().approximatelyEquals(o.size(),1));if(i.length==0)return null;if(i.length==1)return i[0];let a=e.topLevelAncestor(),s=o.topLeft();a!=null&&s.subtractUpdate1(a.canvasSpaceBoundingBox().topLeft());for(let l of i){let d=l.canvasSpaceBoundingBox().topLeft(),c=l.topLevelAncestor();if(c!=null&&d.subtractUpdate1(c.canvasSpaceBoundingBox().topLeft()),s.approximatelyEquals(d,1))return l}return null}static matchNodesAndPreserveScroll(e,t,n){if(!X.equals(n.oldStateId(),n.newStateId())){let a=t.lastNodeForBaseScreen(),s=t.nextNodeForBaseScreen();de.findMatchingNodesAndPreserveScroll(e,a,s)}let o=n.oldStateAndOverlays.overlays,i=n.newStateAndOverlays.overlays;for(let a=0,s=Math.min(o.length,i.length);a<s;a=a+1)if(!X.equals(o[a].id,i[a].id)){let l=t.lastNodeForOverlayAt(a),d=t.nextNodeForOverlayAt(a);de.findMatchingNodesAndPreserveScroll(e,l,d)}}static findMatchingNodesAndPreserveScroll(e,t,n){if(t!=null&&n!=null){de.copyScrollOffset(e,t,n);let o=t.scrollableFrameDescendants(),i=n.scrollableFrameDescendants();for(let a of o){if(i.length==0)break;let s=de.findMatchingTransitionNode(a,i);s!=null&&(de.copyScrollOffset(e,a,s),ne.List_removeOne(i,s))}}}static clampScrollOffsetForNode(e,t){if(e.scrollDirection()=="NONE")return fe.FrozenVector_ZERO.clone();let n=b.new();return e.scrollDirection()=="HORIZONTAL"?n.setX(sr.Math_clamp(t.x(),e.minScrollOffsetX(),e.maxScrollOffsetX())):e.scrollDirection()=="VERTICAL"?n.setY(sr.Math_clamp(t.y(),e.minScrollOffsetY(),e.maxScrollOffsetY())):e.scrollDirection()=="BOTH"&&(n.setX(sr.Math_clamp(t.x(),e.minScrollOffsetX(),e.maxScrollOffsetX())),n.setY(sr.Math_clamp(t.y(),e.minScrollOffsetY(),e.maxScrollOffsetY()))),n}static _getRelevantOSForDevice(e){return Pt.current()==2||Pt.current()==1||e==null?Pt.current():e.os()==2||e.os()==1?e.os():Pt.current()}};de._scrollPhysics=new dc,de._scrollAnimationManager=null,de._overscrolledNodeID=null,de._dirtyNodesForScrollClamping=new Set;var Bi=de;(i=>{class r{constructor(s){this._canvasView=null,this._dragStart=null,this._isDragging=!1,this._isDragGestureConfirmed=!1,this._isDragInteractionLocked=!1,this._activeScrollOrDrag=null,this._flingPoints=null,this._currentGesture=null,this._previousGesture=null,this._scrollingNodeId=null,this._lastScrollEvent=0,this._lastPointerPressHandled=0,this._storedPointerReleasePoint=null,this._lastPointerPressHandledAt=0,this._canvasView=s}unlockScroll(){this._lastScrollEvent=0,this._scrollingNodeId=null}resetStateForTests(){this._resetDragInfo(),this._flingPoints=null,this._currentGesture=null,this._previousGesture=null,this._scrollingNodeId=null,this._lastScrollEvent=0,this._lastPointerPressHandled=0,this._storedPointerReleasePoint=null,this._lastPointerPressHandledAt=0}isDragging(){return this._isDragging}_handleSinglePointerPress(s,l){let d=s.locationInView(this._canvasView);this._canvasView.triggerMouseAction(l,d),this._dragStart=d,this._isDragGestureConfirmed=!1,this._canvasView.recordViewportSpaceClick(this._dragStart),s.accept(),this._flingPoints=[],this._currentGesture=new Jh(d,Me.seconds(),s.interactionType()),this._lastPointerPressHandled=this._canvasView.handleInteractionsForPress(d),this._lastPointerPressHandled!=0&&(this._lastPointerPressHandledAt=Me.seconds())}onMousePress(s){this._handleSinglePointerPress(s,6),this._canvasView.cancelAnimationManager()}onTouchPress(s){this._canvasView.cancelAnimationManager(),s.touches.length==1?this._handleSinglePointerPress(s,10):s.accept()}_processPointerRelease(s){var m;if(!this._canvasView.appState().prototypeState().interactionsEnabled())return!1;let l=this._isDragGestureConfirmed,d=!l&&this._lastPointerPressHandled!=2,c=l&&this._lastPointerPressHandled==1&&(this._activeScrollOrDrag==null||this._activeScrollOrDrag.interactionType==i.ScrollOrDragProposal.InteractionType.DRAG),p=d||c,u=this._canvasView.handleInteractionsForRelease(s,p,this._lastPointerPressHandled);return(this._isDragging?this._canvasView.handleFling((m=this._activeScrollOrDrag)==null?void 0:m.targetNodeId,this._flingPoints):0)==0&&this._canvasView.maybeHandleOverdragRelease(),!l&&u==0&&this._lastPointerPressHandled==0&&this._canvasView.performHotspotAnimationOnClick(),!l&&this._canvasView.appState().scene()!=null&&Y.getViewerMode()==Y.ViewerMode.MIRROR&&this._canvasView.appState().triggerAction1(5),this._canvasView.updateCursorType(s,null),this._resetDragInfo(),l||u==1||this._lastPointerPressHandled==1}_storeOrProcessPointerReleaseAtPoint(s){if(Me.seconds()-this._lastPointerPressHandledAt<Gw)this._storedPointerReleasePoint=s;else if(this._processPointerRelease(s))return 1;return this._lastPointerPressHandledAt=0,0}onMouseRelease(s){let l=s.locationInView(this._canvasView);this._canvasView.triggerMouseAction(9,l),this._storeOrProcessPointerReleaseAtPoint(l)}onTouchRelease(s){s.touches.length==0&&this._currentGesture!=null?(this._currentGesture!=null&&(this._currentGesture.endTime=Me.seconds(),this.isSingleTap()?this._storeOrProcessPointerReleaseAtPoint(this._currentGesture.endLocation)==0&&this._canvasView.appState().prototypeState().getTransitionOnClick()&&this._canvasView.maybeHandleSingleTapAsNavigation(this._currentGesture.endLocation):this._storeOrProcessPointerReleaseAtPoint(this._currentGesture.endLocation)),this._resetDragInfo()):s.touches.length==0&&this._canvasView.maybeHandleOverdragRelease(),this._previousGesture=this._currentGesture,this._currentGesture=null}_resetDragInfo(){this._dragStart=null,this._activeScrollOrDrag=null,this._isDragging=!1,this._isDragGestureConfirmed=!1,this._isDragInteractionLocked=!1}onDrag(s){var d;let l=s.locationInView(this._canvasView);if(this._isDragging=!0,this._dragStart!=null&&!this._isDragGestureConfirmed&&(this._isDragGestureConfirmed=s.interactionCount()>1||l.distanceTo(this._dragStart)>Lw),this._dragStart!=null&&this._isDragGestureConfirmed&&!this._isDragInteractionLocked){let c=l.subtract(this._dragStart).multiplyScalar(-1);this._activeScrollOrDrag=this._canvasView.getBestScrollOrDragProposal(1,this._dragStart,c)}if(!this._canvasView.appState().prototypeState().isDragging()){if(this._isDragGestureConfirmed&&Y.getDragToPan()&&this._activeScrollOrDrag!=null){let c=s.delta(),p=(d=this._canvasView.appState().scene())==null?void 0:d.findNode(this._activeScrollOrDrag.targetNodeId);switch(this._activeScrollOrDrag.interactionType){case i.ScrollOrDragProposal.InteractionType.SCROLL:case i.ScrollOrDragProposal.InteractionType.OVERSCROLL:{p!=null&&p!=this._canvasView.appState().getActiveCanvas()?this._canvasView.scrollNode(p.id(),1,c.negative().divideScalar(this._canvasView.viewport().zoomScale()))&&(this._lastPointerPressHandled=1,this._isDragInteractionLocked=!0,this._canvasView.handleInteractionsForScroll()):this._canvasView.viewport().panCamera(c);break}case i.ScrollOrDragProposal.InteractionType.DRAG:{this._lastPointerPressHandled=this._canvasView.handleDragStart(l,p,this._activeScrollOrDrag.targetInteractionId),this._isDragInteractionLocked=!0;break}}s.interactionCount()!=1?this._currentGesture=null:this._currentGesture!=null&&(this._flingPoints.push(new Jh(l,Me.seconds(),s.interactionType())),this._currentGesture.endLocation=l,this._currentGesture.endTime=Me.seconds())}}this._canvasView.idlenessTracker().handleInteraction(),this._canvasView.handleInteractionsForDrag(l),s.interactionType()==0&&(this._canvasView.updateUserCursor(s),this._canvasView.triggerMouseAction(8,l))}onMouseScroll(s){var u;let l=this._canvasView.appState().getActiveCanvas();if(l==null)return;let d=Me.seconds();d-this._lastScrollEvent>xw&&(this._scrollingNodeId=null);let c=s.locationInView(this._canvasView),p=this._canvasView.appState().activePrototypeDevice()!=null&&Ka.hasDevice(this._canvasView.appState().activePrototypeDevice().type);if((8&s.modifiers()||2&s.modifiers())&&wp(this._canvasView.appState().prototypeState().getCurrentScalingInfo(),p))this._canvasView.viewport().adjustCameraZoomWithPin(Math.pow(.99,s.scrollDelta.y()),c.subtract(this._canvasView.viewport().viewSpaceBounds().topLeft())),s.accept(),this._canvasView.userDidAttemptZoom!=null&&this._canvasView.userDidAttemptZoom(1);else{let _=(u=l.scene())==null?void 0:u.findNode(this._scrollingNodeId);if(_==null){let h=this._canvasView.getBestScrollOrDragProposal(0,c,s.scrollDelta);_=this._canvasView.appState().scene().findNode(h==null?void 0:h.targetNodeId),this._scrollingNodeId=_==null?void 0:_.id()}_==null||(_!=l?(this._canvasView.scrollNode(this._scrollingNodeId,0,s.scrollDelta.divideScalar(this._canvasView.viewport().zoomScale()))&&(this._canvasView.handleInteractionsForScroll(),this._canvasView.handleInteractionsForMove(c,!0)),s.accept()):Y.getScrollToPan()&&(this._canvasView.viewport().panCamera(s.scrollDelta.negative()),this._scrollingNodeId=l.id(),s.accept(),this._canvasView.handleInteractionsForMove(c,!0)))}this._lastScrollEvent=d,this._canvasView.idlenessTracker().handleInteraction()}onMouseMove(s){let l=s.locationInView(this._canvasView);this._canvasView.updateUserCursor(s),this._canvasView.triggerMouseAction(7,l),this._canvasView.handleInteractionsForMove(l,!0),this._scrollingNodeId=null}onMouseLeave(s){this._canvasView.updateUserCursor(null),this._canvasView.handleInteractionsForLeave()}onKeyPress(s,l){let d=this._canvasView.handleInteractionsForKeyPress(s);Y.isInlinePreview()&&d==0&&(s.key==7||s.key==8&&4&s.modifiers())&&l.trigger("requestClose")}onGamepadDown(s){this._canvasView.handleInteractionsForGamepadDown(s)}maybeProcessStoredPointerRelease(){this._storedPointerReleasePoint!=null&&(this._processPointerRelease(this._storedPointerReleasePoint),this._storedPointerReleasePoint=null)}isSingleTap(){return this._canvasView.appState().baseScreenNode()!=null&&this._currentGesture!=null&&this._currentGesture.isTap()}}i.CanvasPointerEventDelegate=r;let e;(d=>(d[d.NOT_HANDLED=0]="NOT_HANDLED",d[d.HANDLED=1]="HANDLED",d[d.MAINTAINED=2]="MAINTAINED"))(e=i.WasHandled||(i.WasHandled={}));let t;(l=>(l[l.SCROLL_ONLY=0]="SCROLL_ONLY",l[l.SCROLL_OR_DRAG=1]="SCROLL_OR_DRAG"))(t=i.ScrollOrDragQuerySet||(i.ScrollOrDragQuerySet={}));class n{updateToBestProposal1(s){return s!=null&&this.updateToBestProposal2(s.interactionType,s.directionSimilarity,s.targetNodeId,s.targetInteractionId),this}updateToBestProposal2(s,l,d,c){return(this.interactionType==i.ScrollOrDragProposal.InteractionType.OVERSCROLL&&s==i.ScrollOrDragProposal.InteractionType.DRAG||l>this.directionSimilarity)&&(this.interactionType=s,this.directionSimilarity=l,this.targetNodeId=d,this.targetInteractionId=c),this}constructor(s,l,d,c){this.interactionType=s,this.directionSimilarity=l,this.targetNodeId=d,this.targetInteractionId=c}}i.ScrollOrDragProposal=n,(s=>{let a;(p=>(p[p.OVERSCROLL=0]="OVERSCROLL",p[p.SCROLL=1]="SCROLL",p[p.DRAG=2]="DRAG"))(a=s.InteractionType||(s.InteractionType={}))})(n=i.ScrollOrDragProposal||(i.ScrollOrDragProposal={}));let o;(d=>(d[d.SCROLL_EVENT=0]="SCROLL_EVENT",d[d.DRAGGING=1]="DRAGGING",d[d.FLING=2]="FLING"))(o=i.ScrollSource||(i.ScrollSource={}))})(Bi||(Bi={}));var Jh=class{constructor(e,t,n){this.startLocation=null,this.startTime=0,this.endLocation=null,this.endTime=0,this.type=0,this.startLocation=e,this.startTime=t,this.endLocation=e,this.endTime=t,this.type=n}isTap(){return(this.endLocation==null||this.startLocation.distanceTo(this.endLocation)<Mw)&&this.endTime-this.startTime<Bw}},Lw=5,xw=.2,Bw=.4,Mw=50,Gw=.1;var Ou=class{constructor(e,t,n){this._appState=null,this._canvasView=null,this._emitter=null,this._session=null,this._userSyncing=null,this._isFirst=!1,this._appState=e,this._canvasView=t,this._emitter=Kt.getEventEmitter(),this._session=n,this._userSyncing=null,this._isFirst=!0,this._session.addObserver(this),this._appState.addFrameObserver(this)}reset(){this._isFirst=!0}userInfoJSON(){var l;if(this._userSyncing==null)return null;let e=[],t=this._userSyncing.userBySessionID(),n=this._session.sessionID(),o=t.get(n),i=o==null?void 0:o.clientID,a=(l=this._session.presenterSessionID())==null?void 0:l.value;o!=null&&e.push(o.toJSON());for(let d of Array.from(this._userSyncing.userBySessionID().values()))if(d.sessionID!=n){if(i!=null&&d.clientID==i){a==d.sessionID&&(a=null);continue}e.push(d.toJSON())}let s=0;if(a!=null&&a==n)for(let d of Array.from(this._userSyncing.userBySessionID().values()))d.sessionID!=n&&d.observedSessions.indexOf(n)!=-1&&(s=s+1);return{deviceNameFilter:this._session.role(),sessionID:n,allUsers:e,followerCount:s,observingSessionID:this._session.observingSessionID(),presenterSessionID:a,sessionNominatedByCurrentUser:this._session.sessionNominatedByCurrentUser()!=null?this._session.sessionNominatedByCurrentUser().value:null,sessionsNominatingCurrentUser:this._session.sessionsNominatingCurrentUser()}}performVariableActions(e){let t=this._appState.prototypeState(),n=this._session.observedUser();if(n==null)return;e&&t.resetVariablePrototypeState();let o=n.triggeredSetVariableActionData??[],i=n.triggeredSetVariableModeActionData??[];(t.getSetVariableActionHistoryLength()>o.length||t.getSetVariableModeActionHistoryLength()>i.length)&&t.resetVariablePrototypeState();let a=t.getSetVariableActionHistoryLength();for(let l=0;l<o.length;l++){let d=o[l];(l>=a||d.targetVariableData!==t._setVariableActionHistory[l].targetVariableData)&&t.performMultiplayerSetVariableAction(d)}let s=t.getSetVariableModeActionHistoryLength();for(let l=0;l<i.length;l++){let d=i[l];(l>=s||d.targetVariableModeId!==t._setVariableModeActionHistory[l].targetVariableModeId)&&t.performMultiplayerSetVariableModeAction(d)}}performVideoStateChanges(){let e=this._appState.prototypeState(),t=this._session.observedUser();if(t==null)return;let n=t.videoStateChangeData??[];for(let o=0;o<n.length;o++){let i=n[o];if(!i.targetNodeId)continue;let a=X.fromFigGUID(i.targetNodeId),s=e.getVideoStateChangeForGuid(a);(!s||!this._videoStateEqual(i,s))&&e.performMultiplayerVideoStateChange((s==null?void 0:s.currentTimes)||[],i)}}performEmbeddedPrototypeChanges(e){if(this._userSyncing==null)return null;let t=this._session.observedUser(),n=this._userSyncing.userBySessionID(),o=this._session.sessionID(),i=n.get(o);if(i==null)return;if(e&&t==null){i.embeddedPrototypeData.forEach(l=>{this._emitter.trigger("embeddedPrototypeChange",{presenterSessionId:null,nodeId:X.fromFigGUID(l.nodeId)})});return}else if(t==null)return;let a=i.embeddedPrototypeData.map(l=>X.fromFigGUID(l.nodeId));t.embeddedPrototypeData.filter(l=>a.includes(X.fromFigGUID(l.nodeId))).forEach(l=>{this._emitter.trigger("embeddedPrototypeChange",{presenterSessionId:l.sessionId,nodeId:X.fromFigGUID(l.nodeId)})})}performActiveSlidesEmbeddedPrototypeChanges(){let e=this._session.observedUser();if(e==null)return;let t=e.activeSlidesEmbeddablePrototype;this._appState.prototypeState().setActiveSlidesPrototypeEmbedGUID(t)}_videoStateEqual(e,t){if(!(!e.targetNodeId&&!t.targetNodeId||e.targetNodeId&&t.targetNodeId&&X.fromFigGUID(e.targetNodeId)===X.fromFigGUID(t.targetNodeId))||e.isPlaying!=t.isPlaying||e.isPlayingSound!=t.isPlayingSound||e.actionTakenTimestamp!=t.actionTakenTimestamp)return!1;let o=e.currentTimes,i=t.currentTimes;return!(!o&&i||o&&!i)}setPreviewToObservedFrameOrOverlay(e){if(!this._appState.getActiveCanvas()||!this._appState.getActiveCanvas().scene())return;let t=this._appState.prototypeState(),n=this._appState.prototypeStructure(),o=this._session.observedUser();if(o==null)return;this.applyInstanceStateSwaps(e);let i=o.triggeredOverlaysData??[],a=o.currentFrame;if(a!=null&&!X.equals(this._appState.baseScreenId(),a)){let l=null,d=null;i.length==0&&(l=o.lastTriggeredHotspot,d=o.lastTriggeredPrototypeInteractionID);let c=null;if(l!=null&&d!=null)c=n.findPrototypeInteractionWithId(l,d);else if(l!=null){let u=this._appState.getActiveCanvas().scene().findNode(l),_=Yt.cleanedInteractionsForNode(this._appState,u);_.length!=0&&(c=_[0])}let p=this._appState.prototypeStructure().transitionDirectionBetweenFrames(this._appState.baseScreenId(),a);this._appState.prototypeState().navigateToFrameAndCloseOverlays(a,this._appState.scene().findNode(l),1,p,0,c,null)}this._applyObjectAnimationStateFromDriver(o,e);let s=t.getCurrentOverlays();s.length>i.length&&(t.closeOverlayAtAndAbove(i.length,1),s=t.getCurrentOverlays());for(let l=0,d=i.length;l<d;l=l+1){let c=ot.decodeGUID(i[l].overlayGuid),p=ot.decodeGUID(i[l].swapGuid),u=ot.decodeGUID_instanceHACK(i[l].hotspotGuid),_=ot.decodeGUID(i[l].prototypeInteractionGuid),h=o.lastTriggeredPrototypeInteractionID,S=null;if(_!=null)S=n.findPrototypeInteractionWithId(u,_);else{let f=this._appState.prototypeStructure().findPrototypeInteractionsWithTransition(u,p);f.length!=0&&(S=f[0])}if(s.length<=l){let f=this._appState.scene().findNode(u);if(f==null)return;t.overlayFrame(p,f,0,0,S,null),s=t.getCurrentOverlays()}let m=s[l];if(!m){na.loge("MultiplayerCoupler","Cannot find overlay for setPreviewToObservedFrameOrOverlay",{driverOverlayId:c,driverOpeningOverlayId:p},{reportAsSentryError:!0,logToConsole:0});continue}if(!X.equals(m.id(),c)||!X.equals(m.overlayDataModelId(),p)){if(l<s.length-1&&t.closeOverlayAtAndAbove(l+1,1),!X.equals(m.overlayDataModelId(),p)){t.closeOverlayAtAndAbove(l,1);let v=this._appState.scene().findNode(u);t.overlayFrame(p,v,0,0,S,null)}let f=this._appState.scene().findNode(m.id()),T=o.lastTriggeredHotspot,y=this._appState.scene().findNode(T);y=f!=null&&f.isAncestorOf(y)?y:null;let E=null;y!=null&&h!=null?E=n.findPrototypeInteractionWithId(y.id(),h):y!=null&&n.nodeTransitionTracker().cleanedUpInteractionMap()._in(y.id())&&(E=n.nodeTransitionTracker().cleanedUpInteractionMap().getHotspotInteractions(y.id())[0]),t.swapTopOverlay(c,y,0,E,null)}s=t.getCurrentOverlays()}t.getInitiatedChange()!=null&&!e&&(t.mostRecentFixInvalidStateInitiator="MultiplayerCoupler.setPreviewToObservedFrameOrOverlay",t.commitStateChange())}_initiateStateSwap(e){var a;let t=this._appState.prototypeState(),n=ot.decodeGUIDPath(e.hotspotStablePath),o=(a=this._appState.scene())==null?void 0:a.findNodeByStablePath(n),i=ot.decodeGUID(e.interactionID);t.swapInstanceToState2(ot.decodeGUIDPath(e.instanceStablePath),ot.decodeGUID(e.stateID),o,0,o==null?void 0:o.findPrototypeInteraction(i),1,null)}_commitStateSwap(e){let t=this._appState.prototypeState(),n=ot.decodeGUIDPath(e.instanceStablePath);t.commitChangesBelowInstanceTransitionRoot(n)}_applyObjectAnimationStateFromDriver(e,t){if(this._appState.prototypeStructure().navigationOrderType()!==2)return;let n=this._appState.prototypeState(),o=e.lastTriggeredPrototypeInteractionID,i=e.lastTriggeredObjectAnimationIndex,a=null;o&&o!==X.invalid()&&i!==null&&(a=new lo(o,i));let s=this._appState.scene().findNode(this._appState.baseScreenId());if(!s)return;let l=s.objectAnimations();if(l.length===0)return;let d=n.getCurrentAnimationState();if(a==null&&d)this._playOrPreviewObjectAnimation(t,null,s,1);else if(a!=null){let c=d==null?void 0:d.compareTo(a,l);c===void 0&&l.some(p=>p.id()===a.interactionId)?this._playOrPreviewObjectAnimation(t,a,s,0):c!==void 0&&c!==0&&this._playOrPreviewObjectAnimation(t,a,s,c>0?1:0)}}_playOrPreviewObjectAnimation(e,t,n,o){let i=this._appState.prototypeState();if(e)i.playObjectAnimation(n,t,o);else if(t==null)N().previewSceneAt(n.id(),0,0);else{let a=n.objectAnimations().findIndex(s=>s.id()===t.interactionId);if(a<0)return;N().previewSceneAt(n.id(),a,t.actionIndex)}}applyInstanceStateSwaps(e){let t=this._session.observedUser();if(t.instanceStateChanges!=null){for(let n of t.instanceStateChanges)n.phase=="INITIATED"&&this._initiateStateSwap(n),(n.phase=="COMMITTED"||!e)&&this._commitStateSwap(n);t.instanceStateChanges=[]}}handleConnect(e,t){this._userSyncing=new Iu,this._session.setMultiplayerUserSyncing(this._userSyncing),this._userSyncing.onChange=()=>{this._emitter.trigger("multiplayerUserInfoChange",this.userInfoJSON())},this._userSyncing.onMouseCursorChange=n=>{var o;n==this._session.observingSessionID()&&((o=this._canvasView)==null||o.viewport().invalidate())}}handleDisconnect(){this._userSyncing=null,this._session.setMultiplayerUserSyncing(null),this._emitter.trigger("multiplayerUserInfoChange",null)}handleJoinStart(e,t,n){e!=1&&this._emitter.trigger("joinStart")}handleJoinEnd(){var t;this._session.scene()!=this._appState.scene()&&this._appState.setActiveCanvas(null),this._isFirst&&(this._isFirst=!1);let e=this._appState.getActiveCanvas();e!=null&&(Y.isSlidesEmbed()?this._emitter.trigger("prototypeDeviceChanged",e.storedPrototypeDevice().toJSON()):this._emitter.trigger("prototypeDeviceChanged",e.prototypeDevice().toJSON())),(t=this._canvasView)==null||t.afterEnteredViewer()}handleNodeChanges(){this._appState.prototypeState().mostRecentFixInvalidStateInitiator="MultiplayerCoupler.didApplyNodeChanges",this._appState.prototypeState().didApplyNodeChanges()}handlePresenterChange(){this._emitter.trigger("multiplayerUserInfoChange",this.userInfoJSON())}handleSceneGraphReply(e,t){}handleSceneChangedLoadingPhase(e,t){}onFrame(){this.setPreviewToObservedFrameOrOverlay(!0),this.performVariableActions(!1),this.performVideoStateChanges(),this.performEmbeddedPrototypeChanges(!1),this.performActiveSlidesEmbeddedPrototypeChanges()}};var jh;(p=>{function r(u){return u}p._shortcut1=r;function e(u,_){return u|_<<p.MODIFIERS_SHIFT}p._shortcut2=e;function t(u,_,h){return u|_<<p.MODIFIERS_SHIFT|h<<p.FLAGS_SHIFT}p._shortcut3=t;function n(u){let _=new Map([[3,[e(20,4),e(20,16)]],[4,[21,29]],[1,[93,92,69,e(93,16),e(92,16),e(69,16)]],[2,[91,70,e(91,16),e(70,16)]]]);for(let h of Array.from(_.keys()))for(let S of _.get(h)){let m=S&p.KEY_MASK,f=S>>p.MODIFIERS_SHIFT&p.MODIFIERS_MASK,T=S>>p.FLAGS_SHIFT&p.FLAGS_MASK;i.Flags_currentlyApplies(T)&&(16&f&&(f|=ks.Modifiers_currentPlatformModifier()),Fl.KeyShortcutMap_set(u,m,f,h))}}p.addTo=n;let o;(S=>(S[S.__NONE=0]="__NONE",S[S.MAC=1]="MAC",S[S.NON_MAC=2]="NON_MAC"))(o=p.Flags||(p.Flags={}));let i;(S=>{function u(m){return(1&m)!=0}S.Flags_isMacOnly=u;function _(m){return(2&m)!=0}S.Flags_isNonMacOnly=_;function h(m){return(!u(m)||Pt.current()==4)&&(!_(m)||Pt.current()!=4)}S.Flags_currentlyApplies=h})(i=p.in_Flags||(p.in_Flags={})),p.KEY_MASK=255,p.MODIFIERS_MASK=255,p.MODIFIERS_SHIFT=8,p.FLAGS_MASK=255,p.FLAGS_SHIFT=16})(jh||(jh={}));var Rc=class{constructor(e,t,n,o){this._window=null,this._appState=null,this._canvasView=null,this._shortcuts=new Map,this._multiplayerSession=null,this._multiplayerCoupler=null,this._window=new bp(e,t,o==1,()=>Y.disableKeyboardHandling(),()=>Y.isInlinePreview()),this._appState=new jt,this._canvasView=new Bi(this._appState),this._canvasView.setParent(this._window.root()),this._canvasView.setup(),this._canvasView.focus(),this._registerShortcuts(),this._multiplayerSession=new ea(this._appState,()=>this._window.isActive(),n),this._multiplayerCoupler=new Ou(this._appState,this._canvasView,this._multiplayerSession),this._canvasView.setMultiplayer(this._multiplayerSession),Cn.instance.setMultiplayer(this._multiplayerSession)}state(){return this._appState}canvasView(){return this._canvasView}window(){return this._window}multiplayerSession(){return this._multiplayerSession}multiplayerCoupler(){return this._multiplayerCoupler}_registerShortcuts(){let e=!0;Jr.addUpdate(Bt.keyPress(this._window.root().events()),t=>{e&&(jh.addTo(this._shortcuts),e=!1);let n=Fl.KeyShortcutMap_get(this._shortcuts,t.asKeyEvent().key,t.modifiers(),0);n!=0&&(this._appState.triggerAction1(n),t.accept())})}unloadSceneAndResetPrototypeLib(){this._multiplayerSession.disconnect(),this._appState.prototypeState().mostRecentFixInvalidStateInitiator="App.unloadSceneAndResetPrototypeLib",this._appState.setScene(null),this._multiplayerSession.setScene(null),N()!=null&&(console.debug("Resetting PrototypeLib..."),Wu())}initializePrototypeLib(e){if(this.unloadSceneAndResetPrototypeLib(),e==null)throw new Error("Can't initialize PrototypeLib with null CppModules");zu(new ec(e,this._appState))}connectTo(e,t,n,o,i,a){this._appState.prototypeState().mostRecentFixInvalidStateInitiator="App.connectTo",this._appState.setActivePrototypeStartingPointNodeId(n),this._appState.prototypeState().mostRecentBaseScreenIdChangeInitiator="App.connectTo",this._appState.prototypeState().resetPrototype(),this._multiplayerCoupler.reset(),this._appState.setRenderDots(!!o),this._canvasView.setBackgroundEnabled(!o),this._appState.setEditorType(a),this._canvasView.initializeThumbnailRenderer(a),Ct.setImagePrefixURL(`/file/${e}/image`),Ct.setVideoPrefixUrl(`/api/files/${e}/videos`),Ct.setCompressedTexturesAvailabilityURL(`/file/${e}/compressed_texture_available/batch`),Y.shouldApplyMobileOptimizations()?Ct.setImageBatchURL(`/file/${e}/image/batch?max_size=2048`):Ct.setImageBatchURL(`/file/${e}/image/batch`),this.canvasView().dangerouslyAccessProtoRenderManager().getContext().supportsCompressedTextures()&&Y.shouldUseCompressedTextures()&&Ct.setShouldUseCompressedTextures(!0),this.initializePrototypeLib(i),this._multiplayerSession.connectTo(e,t)}};var AA;(o=>{function r(i){return Array.from(i.values())}o.Set_values=r;function e(i,a){return n(i,a)}o.Set_subtract=e;function t(i){return new Set(i)}o.Set_new1=t;function n(i,a){let s=new Set(Array.from(i.values()));return i.forEach(l=>{a.has(l)&&s.delete(l)}),s}o.Set_difference=n})(AA||(AA={}));var TA=class{constructor(e,t){this._context=e,this._byteCount=t,this._bytes=new Uint8Array(t)}context(){return this._context}bytesForUpload(){return this._bytes}byteCount(){return this._byteCount}moveBytesForUpload(e,t,n){n>=0,0<=e&&e+n<=this._byteCount,0<=t&&t+n<=this._byteCount,e!=t&&n!=0&&this._bytes.set(this._bytes.subarray(e,e+n),t)}setBytesForUpload(e,t){0<=t&&t+e.length<=this._byteCount,this._bytes.set(e,t)}prepare(){}},EA=class{constructor(e,t,n){this._context=e,this._name=t,this._format=n}prepare(){throw new Error("Method not implemented.")}program(){throw new Error("Method not implemented.")}getEmscriptenProgramId(){throw new Error("Method not implemented.")}context(){return this._context}name(){return this._name}format(){return this._format}setUniformFloat(e,t){}setUniformInt(e,t){}setUniformVec21(e,t,n){}setUniformVec41(e,t,n,o,i){}setUniformMat31(e,t,n,o,i,a,s){}setUniformSampler(e,t,n){}},vc=class{createVertexBuffer(e){let t=new TA(this,e);return this.buffers.push(t),t}addContextResetHandler(e){}beginFrame(){}clear(e,t){this.clearCount+=1}createMaterial(e,t,n,o){return new EA(this,e,t)}createTexture(e,t,n,o){return null}createTextureWithPixels(e,t,n,o,i){return null}createTextureWithVideo(e,t,n){return null}createFramebuffer(e,t,n){return null}currentBlendState(){return null}draw(e,t,n){}flush(){}getNumFramebufferSwitches(){return 0}height(){return 0}maxTextureSize(){return 4096}removeContextResetHandler(e){}resizeDefaultFramebuffer(e,t){return new sa(new b(e,t),!1)}readPixels(e,t,n,o,i){return null}resetNumFramebufferSwitches(){}bindWebGLFramebufferAndTrackForBudget(e){}width(){return 0}annotate(e,t){t()}annotateAndReturn(e,t){return t()}annotateProfile(e,t){t()}isContextLost(){return!1}graphicsCardName(){return"Unknown"}isVisible(){return!1}setMaximumDrawingBufferSizeForTesting(e){}clearMaximumDrawingBufferSizeForTesting(){}hasLoggedHighpPrecisionUnsupported(){return!0}setHasLoggedHighpPrecisionUnsupported(){}stats(){return null}getGpuMetricsCollection(){return this._gpuMetricsCollection}supportsCompressedTextures(){return!1}constructor(){this.buffers=[],this._gpuMetricsCollection=new ga.GpuMetricsCollection,this._gpuMetricsCollection.setBufferSize(2),this.clearCount=0}};var Rb;(d=>{let r=Bo.BYTE_COUNT,e=r/4|0;function t(){let c=AssertLib.deepStrictEqual,p=new l,u=p.add(Le.getPositionF2(),e,0);c(u.area.byteOffset(),0);let _=p.add(Le.getPositionF2(),e,1);c(_.area.byteOffset(),e);let h=p.add(Le.getPositionF2(),e,2);c(h.area.byteOffset(),e*2);let S=p.add(Le.getPositionF2(),e,3);c(S.area.byteOffset(),e*3),c(p.pool.usedVRAM(),r/4*4),u.free(),h.free(),c(p.pool.usedVRAM(),r/4*2);let m=p.add(Le.getPositionF2(),e,4);c(_.area.byteOffset(),0),c(S.area.byteOffset(),e),c(m.area.byteOffset(),e*2),c(p.pool.totalVRAM(),r),c(p.pool.usedVRAM(),r/4*3),c(p.context.buffers.length,1);let f=p.context.buffers[0];_.check(f),S.check(f),m.check(f)}d.testBasicBufferPoolGC=t;function n(){let c=AssertLib.deepStrictEqual,p=new l,u=p.add(Le.getPositionF2(),e,0);c(u.area.byteOffset(),0);let _=p.add(Le.getPositionF2(),e,1);c(_.area.byteOffset(),e);let h=p.add(Le.getPositionF2(),e,2);c(h.area.byteOffset(),e*2);let S=p.add(Le.getPositionF2(),e,3);c(S.area.byteOffset(),e*3),c(p.pool.usedVRAM(),r/4*4),u.free(),c(p.pool.usedVRAM(),r/4*3);let m=p.add(Le.getPositionF2(),e,4);c(_.area.byteOffset(),0),c(h.area.byteOffset(),e),c(S.area.byteOffset(),e*2),c(m.area.byteOffset(),e*3),c(p.pool.totalVRAM(),r),c(p.pool.usedVRAM(),r/4*4),c(p.context.buffers.length,1);let f=p.context.buffers[0];_.check(f),h.check(f),S.check(f),m.check(f)}d.testBasicBufferPoolGC2=n;async function o(){Qn.updateFeatureGateForTesting("viewer_cleanup_buffer_areas",!0);let c=AssertLib.deepStrictEqual,p=new l,u=p.add(Le.getPositionF2(),e,0);c(u.area.byteOffset(),0);let _=p.add(Le.getPositionF2(),e,1);c(_.area.byteOffset(),e);let h=p.add(Le.getPositionF2(),e,2);c(h.area.byteOffset(),e*2);let S=p.add(Le.getPositionF2(),e,3);c(S.area.byteOffset(),e*3),c(p.pool.usedVRAM(),r/4*4),u=null,h=null,await Qw(),c(p.pool.usedVRAM(),r/4*2);let m=p.add(Le.getPositionF2(),e,4);c(_.area.byteOffset(),0),c(S.area.byteOffset(),e),c(m.area.byteOffset(),e*2),c(p.pool.totalVRAM(),r),c(p.pool.usedVRAM(),r/4*3),c(p.context.buffers.length,1);let f=p.context.buffers[0];_.check(f),S.check(f),m.check(f)}d.testBufferPoolGCAfterSystemGC=o;function i(){let c=AssertLib.deepStrictEqual,p=new l,u=p.add(Le.getPositionF2(),e,0);c(u.area.byteOffset(),0);let _=p.add(Le.getPositionF2(),e,1);c(_.area.byteOffset(),e);let h=p.add(Le.getPositionF2(),e,2);c(h.area.byteOffset(),e*2),_.free();let S=p.add(Le.getPositionF2(),r/2|0,3);c(u.area.byteOffset(),0),c(h.area.byteOffset(),e),c(S.area.byteOffset(),e*2),c(p.pool.totalVRAM(),r),c(p.pool.usedVRAM(),r/4*4),c(p.context.buffers.length,1);let m=p.context.buffers[0];u.check(m),h.check(m),S.check(m)}d.testByteOffsetBugFig5426=i;function a(){let c=AssertLib.deepStrictEqual,p=new l,u=p.add(Le.getPositionF2(),8,0);c(u.area.byteOffset(),0);let _=p.add(Le.getPositionF2(),8,1);c(_.area.byteOffset(),8);let h=p.add(Le.getPositionF4CoordF4(),32,2);c(h.area.byteOffset(),32);let S=p.add(Le.getPositionF4CoordF4(),32,3);c(S.area.byteOffset(),64),_.free(),h.free();let m=p.add(Le.getPositionF2(),r-64,4);c(u.area.byteOffset(),0),c(S.area.byteOffset(),32),c(m.area.byteOffset(),64),c(p.pool.totalVRAM(),r),c(p.pool.usedVRAM(),r-64+40),c(p.context.buffers.length,1);let f=p.context.buffers[0];u.check(f),S.check(f),m.check(f)}d.testStrideBugFig5426=a;class s{free(){this.area.free(),this.area.wasFreed()}check(p){for(let u=0,_=this.bytes.length;u<_;u=u+1)p.bytesForUpload()[this.area.byteOffset()+u]==this.bytes[u]}constructor(p,u){this.bytes=p,this.area=u}}d.Result=s;class l{constructor(){this.context=new vc,this.pool=new la(this.context)}add(p,u,_){let h=new Uint8Array(u);h[0]=_*2+1,h[h.length-1]=_*2+2;let S=this.pool.allocate(p,h);return S!=null,S.byteCount()==u,S.wasFreed(),new s(h,S)}}d.Helper=l})(Rb||(Rb={}));function Yw(r){return new Promise(e=>setTimeout(e,r))}async function Qw(){window.gc(),await Yw(100)}var Cu=class{constructor(e){this._scene=null,this._watchedNodeIDs=new Map,this.onChangeCallback=null,e.addAppObserver(this)}watchNodesWithIDs(e){this._watchedNodeIDs=new Map;for(let t of e)this._watchedNodeIDs.set(t,!0)}handleSceneChange(e,t){this._scene=t,e!=null&&e.removeObserver(this),t!=null&&t.addObserver(this),this.onChangeCallback!=null&&this.onChangeCallback()}handleActiveCanvasChange(e,t){}handleActivePrototypeStartingPointChange(e,t){}_isWatchedNode(e){return this._watchedNodeIDs.has(e)}_isAncestorOrSelfOfWatchedNode(e){for(let t of Array.from(this._watchedNodeIDs.keys())){let n=this._scene.findNode(t);for(let o=n;o!=null;o=o.parent())if(X.equals(o.id(),e))return!0}return!1}handleSceneGraphEvent(e){let t=!1;if(e.property==32){let n=e.oldVal!=null&&Je.isParentIndex(e.oldVal)?Je.asParentIndex(e.oldVal):null,o=e.newVal!=null&&Je.isParentIndex(e.newVal)?Je.asParentIndex(e.newVal):null;(n==null||o==null||n.id!=o.id)&&(t=this._isAncestorOrSelfOfWatchedNode(e.node.id()))}else e.property==30?t=this._isAncestorOrSelfOfWatchedNode(e.node.id()):(e.property==57||e.property==98)&&(t=this._isWatchedNode(e.node.id()));t&&this.onChangeCallback!=null&&this.onChangeCallback()}};var hl=class r{toJSON(){let e={nodeId:this.nodeId};return this.nodeOffset!=null&&(e.nodeOffset={x:this.nodeOffset.x(),y:this.nodeOffset.y()}),this.canvasPosition!=null&&(e.canvasPosition={x:this.canvasPosition.x(),y:this.canvasPosition.y()}),e}static fromJSON(e){let t=null,n=null,o=null;return e.nodeId!==null&&e.nodeId!==void 0&&(t=X.fromString(e.nodeId)),e.nodeOffset!==null&&e.nodeOffset!==void 0&&(n=new b(e.nodeOffset.x,e.nodeOffset.y)),e.canvasPosition!==null&&e.canvasPosition!==void 0&&(o=new b(e.canvasPosition.x,e.canvasPosition.y)),new r(t,n,o)}constructor(e,t,n){this.nodeId=e,this.nodeOffset=t,this.canvasPosition=n}},bu=class{constructor(e){this._appState=null,this._boundsWatcher=null,this._shouldNotifyCommentPositionsChanged=!1,this._nodesWithComments=[],this.notifyCommentPositionsChange=null,this._appState=e,this._boundsWatcher=new Cu(e),this._boundsWatcher.onChangeCallback=()=>{this._shouldNotifyCommentPositionsChanged=!0},this._appState.addAppObserver(this),this._appState.addFrameObserver(this),this._appState.prototypeState().addObserver(this)}setNodesWithComments(e){this._boundsWatcher.watchNodesWithIDs(e),this._nodesWithComments=e}onFrame(){this._shouldNotifyCommentPositionsChanged&&(this.notifyCommentPositionsChange!=null&&this.notifyCommentPositionsChange(),this._shouldNotifyCommentPositionsChanged=!1)}handleSceneChange(e,t){this._shouldNotifyCommentPositionsChanged=!0}handleActiveCanvasChange(e,t){this._shouldNotifyCommentPositionsChanged=!0}handleActivePrototypeStartingPointChange(e,t){}_isAncestorOrSelfOfNodeWithComment(e){let t=this._appState.scene();if(t==null)return!1;for(let n of this._nodesWithComments){let o=t.findNode(n);for(let i=o;i!=null;i=i.parent()){let a=i.id();if(X.equals(a,e))return!0}}return!1}handleStateChangeAborted(e){this.handlePresentedStateChange(e)}handleStateChangeCommitted(e,t){this.handlePresentedStateChange(e)}handleStateChangeInitiated(e){this.handlePresentedStateChange(e)}handleStateChangeRequested(e){}handlePresentedStateChange(e){if(e==null||this._shouldNotifyCommentPositionsChanged)return;if(this._isAncestorOrSelfOfNodeWithComment(e.oldStateAndOverlays.stateId)){this._shouldNotifyCommentPositionsChanged=!0;return}let t=e.oldStateAndOverlays.overlays;for(let o=0,i=t.length;o<i;o=o+1){let a=t[o].id;if(this._isAncestorOrSelfOfNodeWithComment(a)){this._shouldNotifyCommentPositionsChanged=!0;return}}if(this._isAncestorOrSelfOfNodeWithComment(e.newStateAndOverlays.stateId)){this._shouldNotifyCommentPositionsChanged=!0;return}let n=e.newStateAndOverlays.overlays;for(let o=0,i=n.length;o<i;o=o+1){let a=n[o].id;if(this._isAncestorOrSelfOfNodeWithComment(a)){this._shouldNotifyCommentPositionsChanged=!0;return}}}handleFitModeChange(e,t){}handleRestartPrototype(){}getCommentDestinationAtPosition(e){let t=this._appState.scene();if(t==null)return null;let n=this._appState.baseScreenNode();if(n==null)return null;let o=this._appState.prototypeState().getCurrentOverlays();for(let a=o.length-1;a>=0;a=a-1){let s=t.findNode(o[a].id());if(s==null)continue;let l=o[a].renderedBounds(n);if(l.contains2(e)){let d=e.subtract(l.topLeft());return new hl(s.id(),d,null)}}let i=e.subtract(n.canvasSpaceBoundingBox().topLeft());return new hl(n.id(),i,null)}_currentCommentsScreen(){return this._appState.prototypeState().getTopmostScreen()}_currentCommentsScreenRenderedBounds(){let e=this._appState.baseScreenNode(),t=this._appState.prototypeState().getTopmostOverlay();return e!=null&&t!=null?t.renderedBounds(e):e==null?void 0:e.canvasSpaceBoundingBox()}getCanvasSpaceCommentLocations(e,t){let n={};for(let o of Array.from(t.keys())){let i=t.get(o),a=e.findNode(i.nodeId),s=this._currentCommentsScreen(),l=this._currentCommentsScreenRenderedBounds();if(a==null||s==null||l==null)continue;let d=!1;if(d=s.isAncestorOf(a),!d)continue;let c=a.canvasSpaceScrolledBounds(1).topLeft().subtract(s.canvasSpaceBoundingBox().topLeft()),u=l.topLeft().add(c).add(i.nodeOffset),_={};_.x=u.x(),_.y=u.y(),n[o]=_}return n}};var em;(m=>{function r(f,T){let y=new Dr("NONZERO",0,Rt.forCenterStrokeAroundRect(f,T),f);return new wr([y],null,y.bounds(),null)}m.strokeGeometryForRect=r;function e(f,T){if(Math.abs(O.redF(f)-O.redF(T))+Math.abs(O.greenF(f)-O.greenF(T))+Math.abs(O.blueF(f)-O.blueF(T))+Math.abs(O.alphaF(f)-O.alphaF(T))>.01)throw new Error(`Colors are too different ${O.toString(f)} ${O.toString(T)}`)}m.assertColorRoughlyEquals=e;function t(f,T,y){let E=wv(f);return E.setTestOnlyFillPaints([$.createSolid(O.BLACK,y)]),E.setTestOnlyFillGeometry(Mv(T)),He(E,E.fillGeometry().bounds.topLeft(),E.fillGeometry().bounds.size()),E}m.createStaticVectorWithMultipleRegions=t;function n(f,T,y,E){f.setTestOnlyFillPaints([$.createSolid(O.BLACK,1)]),S.GeometryType_hasFill(T)&&f.setTestOnlyFillGeometry(mi(y)),S.GeometryType_hasStroke(T)&&(f.setTestOnlyStrokeGeometry(r(y,E)),f.setStrokeWeight(E)),He(f,y.topLeft(),y.size())}m.addPaintsAndGeometry=n;function o(f,T,y,E){let v=vn(f);return n(v,T,y,E),v}m.createRectangleWithPaintsAndGeometry1=o;function i(f,T,y){return o(f,T,y,1)}m.createRectangleWithPaintsAndGeometry2=i;function a(f,T,y,E,v){let A=Lv(f,T);return n(A,y,E,v),A}m.createRoundedRectangleWithPaintsAndGeometry1=a;function s(f,T,y,E){return a(f,T,y,E,1)}m.createRoundedRectangleWithPaintsAndGeometry2=s;function l(f,T,y,E,v,A,I,C,g,R){let D=new Dr("NONZERO",0,St.fromRect(y),y),P=new wr([D],null,D.bounds(),null),U=Xr(f,"RECTANGLE");return U.setTestOnlyFillGeometry(P),U.setTestOnlyFillPaints(E),U.setTestOnlyStrokeGeometry(P),U.setTestOnlyStrokePaints(v),U.setStrokeAlign(A),U.setStrokeWeight(10),U.setStrokeJoin("MITER"),U.setStrokeMiterLimit(4),U.setTestOnlyEffects([Re.createDropShadow(I,C,g,R)]),U}m.createRoundedRectangleWithStrokeFillAndDropShadow=l;function d(f,T){let y=vn(f);y.setTestOnlyFillPaints([$.createSolid(O.BLACK,1)]);let E=T.topLeft().x(),v=T.topLeft().y(),A=T.width(),I=T.height(),C=new Dr("NONZERO",0,Rt.new2().moveTo1(E,v).lineTo(E+A,v).lineTo(E+A,v+I).lineTo(E,v+I-1).close(),T),g=new wr([C],null,C.bounds(),null);return y.setTestOnlyFillPaints([$.createSolid(O.BLACK,1)]),y.setTestOnlyFillGeometry(g),y.setTestOnlyStrokeGeometry(g),He(y,T.topLeft(),T.size()),y}m.createNonRectangleInNode=d;function c(f,T,y){let E=f.canvasSpaceBoundingBox();switch(y){case"INSIDE":case"OUTSIDE":{f.setTestOnlyStrokeGeometry(r(E,T*2));break}case"CENTER":{f.setTestOnlyStrokeGeometry(r(E,T));break}}f.setStrokeAlign(y)}m.setStrokeForRect=c;function p(){let f=AssertLib.deepStrictEqual,T=new sl("./src/test/rendertree.test.ts");At("generateRenderTree",()=>{let y=null,E=null,v=()=>{y=nt.createSceneWithCanvasForTests1(),E=y.root().childAt1(0),E.setPrototypeDevice(sn.DEFAULT)};beforeEach(v),ue("simple rect",()=>{let A=i(E,0,new G(0,0,100,100));return T.asyncAssertMatchesSnapshot("should emit single fill",A.renderTree1().debugString1())}),ue("simple rounded rect",()=>{let A=s(E,10,0,new G(0,0,100,100));return T.asyncAssertMatchesSnapshot("should emit single rounded rect fill",A.renderTree1().debugString1())}),ue("rounded rect symbol",()=>{let A=Pi(E);return n(A,0,new G(0,0,100,100),0),A.setIsFrameMaskDisabled(!0),A.setCornerRadius(10),T.asyncAssertMatchesSnapshot("symbol should emit rounded rect fill",A.renderTree1().debugString1())}),ue("rounded rect instance",()=>{let A=Pi(E),I=$a(E,A);return n(I,0,new G(0,0,100,100),0),I.setIsFrameMaskDisabled(!0),I.setCornerRadius(10),T.asyncAssertMatchesSnapshot("instance should emit rounded rect fill",I.renderTree1().debugString1())}),ll("simple vector with multiple regions",()=>{let A=[],I=t(E,[new G(0,0,10,10),new G(20,20,10,10)],.5);A.push(T.asyncAssertMatchesSnapshot("should emit single fill",I.renderTree1().debugString1()));let C=t(E,[new G(0,0,10,10),new G(5,5,10,10)],.5);return A.push(T.asyncAssertMatchesSnapshot("should emit multiple fills",C.renderTree1().debugString1())),Promise.all(A)}),ue("multiply blend mode",()=>{let A=i(E,0,new G(0,0,100,100));return A.setBlendMode("MULTIPLY"),T.asyncAssertMatchesSnapshot("should emit fill with blend mode",A.renderTree1().debugString1())}),ue("foreground blur",()=>{let A=i(E,0,new G(0,0,100,100));return A.setTestOnlyEffects([Re.createForegroundBlur(4)]),T.asyncAssertMatchesSnapshot("should emit foreground blur",A.renderTree1().debugString1())}),ue("foreground blur w/ radius zero",()=>{let A=i(E,0,new G(0,0,100,100));return A.setTestOnlyEffects([Re.createForegroundBlur(0)]),T.asyncAssertMatchesSnapshot("blur should be ellided",A.renderTree1().debugString1())}),ue("foreground blur disabled",()=>{let A=i(E,0,new G(0,0,100,100)),I=Re.createForegroundBlur(4);return I.setIsEnabled(!1),A.setTestOnlyEffects([I]),T.asyncAssertMatchesSnapshot("blur should be ellided",A.renderTree1().debugString1())}),ue("background blur",()=>{i(E,0,new G(25,25,50,50)).setTestOnlyFillPaints([$.createSolid(O.RED,1)]);let I=i(E,0,new G(0,0,100,100));return I.setTestOnlyEffects([Re.createBackgroundBlur(4)]),T.asyncAssertMatchesSnapshot("blur should be ellided because rect with blur is opaque",I.renderTree1().debugString1())}),ue("background blur on partially transparent node",()=>{let A=Object({viewer_background_blur_opts:!1});Y.updateFeatureFlags(A),i(E,0,new G(25,25,50,50)).setTestOnlyFillPaints([$.createSolid(O.RED,1)]);let C=i(E,0,new G(0,0,100,100));return C.setTestOnlyFillPaints([$.createSolid(O.BLACK,.5)]),C.setTestOnlyEffects([Re.createBackgroundBlur(4)]),T.asyncAssertMatchesSnapshot("background blur should be emitted",C.renderTree1().debugString1())}),ue("rectangle won't show up in the background blur",()=>{let A=Object({viewer_background_blur_opts:!1});Y.updateFeatureFlags(A),i(E,0,new G(0,0,10,10)).setTestOnlyFillPaints([$.createSolid(O.RED,1)]);let C=et(E);C.setTestOnlyFillPaints([$.createSolid(O.BLACK,.5)]),He(C,new b(0,0),new b(10,10));let g=i(C,0,new G(0,0,10,10));return g.setTestOnlyFillPaints([$.createSolid(O.GREEN,.5)]),g.setTestOnlyEffects([Re.createBackgroundBlur(4)]),T.asyncAssertMatchesSnapshot("red rectangle should not show up in the background blur",C.renderTree1().debugString1())}),At("scrolling frames",()=>{ue("wrap scrollable layers in a volatile property binding",()=>{let A=et(E);return A.setOverflowDirection("VERTICAL"),He(A,new b(0,0),new b(100,100)),i(A,0,new G(0,0,100,200)).setTestOnlyFillPaints([$.createSolid(O.RED,1)]),T.asyncAssertMatchesSnapshot("red fill should be in volatile property binding",A.renderTree1().debugString1())}),ue("wrap scrollable layers with non-isolated blends with a group",()=>{let A=et(E);A.setOverflowDirection("VERTICAL"),He(A,new b(0,0),new b(100,100));let I=i(A,0,new G(0,0,100,200));I.setBlendMode("MULTIPLY"),I.setTestOnlyFillPaints([$.createSolid(O.RED,1)]);let C=A.renderTree1();return T.asyncAssertMatchesSnapshot("red rectangle should be wrapped with a group",C.debugString1())}),ll("fixed layers and their descendants should be re-positioned",()=>{let A=[];E.setPrototypeDevice(new sn("CUSTOM",new b(100,100),"","NONE"));let I=et(E);He(I,new b(0,0),new b(100,500));let C=et(I);return C.setScrollBehavior("FIXED_WHEN_CHILD_OF_SCROLLING_FRAME"),C.setVerticalConstraint("MAX"),He(C,new b(0,400),new b(100,100)),i(C,0,new G(0,0,100,100)).setTestOnlyFillPaints([$.createSolid(O.RED,1)]),A.push(T.asyncAssertMatchesSnapshot("Red square should NOT be culled because the screen is 100 x 500",I.renderTree1().debugString1())),A.push(T.asyncAssertMatchesSnapshot("Red square should NOT be culled even though the screen is 100 x 100 because it is a fixed footer that was repositioned to be in in the screen",I.renderTreeForBaseScreen1().debugString1())),C.setScrollBehavior("SCROLLS"),A.push(T.asyncAssertMatchesSnapshot("Red square SHOULD be culled because the screen is 100 x 100 and the footer is not fixed",I.renderTreeForBaseScreen1().debugString1())),Promise.all(A)}),ue("do not wrap fixed layers in a volatile property binding",()=>{let A=et(E);A.setOverflowDirection("VERTICAL"),He(A,new b(0,0),new b(100,100));let I=et(A);return I.setTestOnlyFillPaints([$.createSolid(O.GREEN,1)]),I.setScrollBehavior("FIXED_WHEN_CHILD_OF_SCROLLING_FRAME"),i(A,0,new G(0,50,100,150)).setTestOnlyFillPaints([$.createSolid(O.RED,1)]),T.asyncAssertMatchesSnapshot("red fill should be in volatile property binding; green fill should not",A.renderTree1().debugString1())}),ue("Background blur trees should not cull scrollable content",()=>{let A=Object({viewer_background_blur_opts:!1});Y.updateFeatureFlags(A);let I=et(E);I.setOverflowDirection("VERTICAL"),He(I,new b(0,0),new b(100,100)),I.setTestOnlyFillPaints([$.createSolid(O.BLACK,1)]);let C=i(I,0,new G(0,150,100,100));He(C,new b(150,0),new b(100,101)),C.setTestOnlyFillPaints([$.createSolid(O.GREEN,1)]);let g=i(I,0,new G(0,0,100,100));return g.setScrollBehavior("FIXED_WHEN_CHILD_OF_SCROLLING_FRAME"),He(g,new b(0,0),new b(100,100)),g.setTestOnlyFillPaints([$.createSolid(O.RED,.5)]),g.setTestOnlyEffects([Re.createBackgroundBlur(4)]),T.asyncAssertMatchesSnapshot("blur node should contain green fill",I.renderTree1().optimized().debugString1())}),["FRAME","GROUP"].forEach(A=>{ue(`Background blur inside ${A} in scrolling content should contain transformed scrolling siblings`,()=>{let I=Object({viewer_background_blur_opts:!1});Y.updateFeatureFlags(I);let C=et(E);C.setOverflowDirection("VERTICAL"),He(C,new b(0,0),new b(100,100)),C.setTestOnlyFillPaints([$.createSolid(O.BLACK,1)]);let g=A=="FRAME"?et(C):Ni(C),R=i(g,0,new G(0,0,100,101));He(R,new b(0,0),new b(100,101)),R.setTestOnlyFillPaints([$.createSolid(O.GREEN,1)]);let D=i(g,0,new G(0,0,100,100));return He(D,new b(0,0),new b(100,100)),D.setTestOnlyFillPaints([$.createSolid(O.RED,.5)]),D.setTestOnlyEffects([Re.createBackgroundBlur(4)]),He(g,new b(0,0),new b(100,101)),T.asyncAssertMatchesSnapshot("blur node should contain transformed green fill",C.renderTree1().optimized().debugString1())})}),ue("calling .renderTree on a frame should NOT make it scrollable by default",()=>{E.setCurrentViewportSize(new b(100,50));let A=et(E);return He(A,new b(0,0),new b(100,100)),i(A,0,new G(0,0,100,100)).setTestOnlyFillPaints([$.createSolid(O.RED,1)]),T.asyncAssertMatchesSnapshot("VOLATILE_PROPERTY_BINDING should NOT be present",A.renderTree1().debugString1())}),ue("calling .renderTreeForBaseScreen on a frame should make it scrollable by default",()=>{E.setCurrentViewportSize(new b(100,50));let A=et(E);return He(A,new b(0,0),new b(100,100)),i(A,0,new G(0,0,100,100)).setTestOnlyFillPaints([$.createSolid(O.RED,1)]),T.asyncAssertMatchesSnapshot("VOLATILE_PROPERTY_BINDING should be present",A.renderTreeForBaseScreen1().debugString1())})}),ue("drop shadow",()=>{let A=i(E,0,new G(0,0,100,100));return A.setTestOnlyFillPaints([$.createSolid(O.BLACK,1)]),A.setTestOnlyEffects([Re.createDropShadow(4,new b(0,0),O.BLACK,.25)]),T.asyncAssertMatchesSnapshot("drop shadow should be emitted",A.renderTree1().debugString1())}),ue("two drop shadows",()=>{let A=i(E,0,new G(0,0,100,100));return A.setTestOnlyFillPaints([$.createSolid(O.BLACK,1)]),A.setTestOnlyEffects([Re.createDropShadow(0,new b(50,50),O.RED,1),Re.createDropShadow(0,new b(-50,-50),O.GREEN,1)]),T.asyncAssertMatchesSnapshot("two drop shadows should be emitted",A.renderTree1().debugString1())}),ue("drop shadow on semi-transparent layer",()=>{let A=i(E,0,new G(0,0,100,100));return A.setTestOnlyFillPaints([$.createSolid(O.BLACK,1)]),A.setTestOnlyEffects([Re.createDropShadow(4,new b(0,0),O.BLACK,.25)]),A.setOpacity(.5),T.asyncAssertMatchesSnapshot("should be wrapped in blend with 0.5 opacity",A.renderTree1().debugString1())}),ue("drop shadow on clipping frame with visible background paints",()=>{let A=et(E);He(A,new b(-100,-100),new b(300,300));let I=et(A);return He(I,new b(0,0),new b(200,200)),I.setTestOnlyFillPaints([$.createSolid(O.RED,1)]),i(I,0,new G(0,0,100,100)).setTestOnlyFillPaints([$.createSolid(O.GREEN,1)]),I.setTestOnlyEffects([Re.createDropShadow(4,new b(0,0),O.BLACK,.25)]),T.asyncAssertMatchesSnapshot("shadow tree does not contain rect fill",I.renderTree1().debugString1())}),ue("drop shadow on non-clipping frame with visible background paints",()=>{let A=et(E);He(A,new b(-100,-100),new b(300,300));let I=et(A);return He(I,new b(0,0),new b(200,200)),I.setTestOnlyFillPaints([$.createSolid(O.RED,1)]),I.setIsFrameMaskDisabled(!0),i(I,0,new G(0,0,100,100)).setTestOnlyFillPaints([$.createSolid(O.GREEN,1)]),I.setTestOnlyEffects([Re.createDropShadow(4,new b(0,0),O.BLACK,.25)]),T.asyncAssertMatchesSnapshot("shadow tree DOES contain rect fill",I.renderTree1().debugString1())}),ue("drop shadow on clipping frame with no background paints",()=>{let A=et(E);He(A,new b(-100,-100),new b(300,300));let I=et(A);return He(I,new b(0,0),new b(200,200)),I.setTestOnlyFillPaints([]),i(I,0,new G(0,0,100,100)).setTestOnlyFillPaints([$.createSolid(O.GREEN,1)]),I.setTestOnlyEffects([Re.createDropShadow(4,new b(0,0),O.BLACK,.25)]),T.asyncAssertMatchesSnapshot("shadow tree DOES contain rect fill; does not contain frame background",I.renderTree1().debugString1())}),ue("drop shadow on clipping frame with no visible background paints",()=>{let A=et(E);He(A,new b(-100,-100),new b(300,300));let I=et(A);return He(I,new b(0,0),new b(200,200)),I.setTestOnlyFillPaints([$.createSolid(O.RED,0)]),i(I,0,new G(0,0,100,100)).setTestOnlyFillPaints([$.createSolid(O.GREEN,1)]),I.setTestOnlyEffects([Re.createDropShadow(4,new b(0,0),O.BLACK,.25)]),T.asyncAssertMatchesSnapshot("shadow tree DOES contain rect fill; does not contain frame background",I.renderTree1().debugString1())}),ue("drop shadow on clipping frame with visible background paint with transparent area",()=>{let A=$.createLinearGradient([new je(O.new3(0,0,0,1),0),new je(O.new3(0,0,0,0),.5)]),I=et(E);He(I,new b(-100,-100),new b(300,300));let C=et(I);return He(C,new b(0,0),new b(200,200)),C.setTestOnlyFillPaints([A]),i(C,0,new G(0,0,100,100)).setTestOnlyFillPaints([$.createSolid(O.GREEN,1)]),C.setTestOnlyEffects([Re.createDropShadow(4,new b(0,0),O.BLACK,.25)]),T.asyncAssertMatchesSnapshot("shadow tree should contain frame background and rect",C.renderTree1().debugString1())}),ue("drop shadow on clipping frame with inside stroke",()=>{let A=et(E);He(A,new b(-100,-100),new b(300,300));let I=Zs(A,"frame",[$.createSolid(O.RED,1)],[$.createSolid(O.BLACK,1)],new G(0,0,50,50));return He(I,new b(0,0),new b(50,50)),I.setStrokeAlign("INSIDE"),I.setStrokeWeight(4),d(I,new G(0,0,100,100)),I.setTestOnlyEffects([Re.createDropShadow(4,new b(0,0),O.BLACK,.25)]),T.asyncAssertMatchesSnapshot("drop shadow should not be clipped by frame mask",I.renderTree1().debugString1())}),ue("drop shadow on rounded rectangle clipping frame with inside stroke",()=>{let A=et(E);He(A,new b(-100,-100),new b(300,300));let I=Zs(A,"frame",[$.createSolid(O.RED,1)],[$.createSolid(O.WHITE,1)],new G(0,0,50,50));return He(I,new b(0,0),new b(50,50)),I.setStrokeAlign("INSIDE"),I.setStrokeWeight(4),I.setCornerRadius(10),I.setTestOnlyFillGeometry(xv(I.canvasSpaceBoundingBox(),10)),I.setTestOnlyEffects([Re.createDropShadow(4,new b(0,0),O.BLACK,.25)]),T.asyncAssertMatchesSnapshot("drop shadow should be a rounded rect",I.renderTree1().debugString1())}),ue("drop shadow and inner shadow on clipping frame with inside stroke",()=>{let A=et(E);He(A,new b(-100,-100),new b(300,300));let I=Zs(A,"frame",[$.createSolid(O.RED,1)],[$.createSolid(O.BLACK,1)],new G(0,0,50,50));return He(I,new b(0,0),new b(50,50)),I.setTestOnlyFillPaints([$.createSolid(O.WHITE,1)]),I.setStrokeAlign("INSIDE"),I.setTestOnlyStrokePaints([$.createSolid(O.RED,1)]),I.setStrokeWeight(4),d(I,new G(0,0,100,100)),I.setTestOnlyEffects([Re.createInnerShadow(4,new b(0,0),O.BLACK,.25),Re.createDropShadow(4,new b(0,0),O.BLACK,.25)]),T.asyncAssertMatchesSnapshot("inner shadow should be clipped by frame mask",I.renderTree1().debugString1())}),ue("spread shadow for eligible frame",()=>{let A=et(E);He(A,new b(0,0),new b(300,300));let I=Io(A,"frame",$.createSolid(O.RED,1));return He(I,new b(0,0),new b(50,50)),I.setTestOnlyEffects([Re.createDropShadow(0,new b(0,0),O.BLACK,.25,10)]),T.asyncAssertMatchesSnapshot("should generate shadow with spread for eligible frame: max bounds",`${I.renderTree1().maxBounds}
`)}),ue("no spread shadow for frame with no visible fill paints",()=>{let A=Io(E,"frame",$.createSolid(O.RED,0));return He(A,new b(0,0),new b(50,50)),i(A,0,new G(0,0,100,100)).setTestOnlyFillPaints([$.createSolid(O.BLACK,1)]),A.setTestOnlyEffects([Re.createDropShadow(0,new b(0,0),O.BLACK,.25,10)]),T.asyncAssertMatchesSnapshot("should generate shadow without spread for frame with no visible fill: max bounds",`${A.renderTree1().maxBounds}
`)}),ue("no spread shadow for frame that does not clip",()=>{let A=et(E);He(A,new b(0,0),new b(300,300));let I=Io(A,"frame",$.createSolid(O.RED,1));return He(I,new b(0,0),new b(50,50)),I.setIsFrameMaskDisabled(!0),I.setTestOnlyEffects([Re.createDropShadow(0,new b(0,0),O.BLACK,.25,10)]),T.asyncAssertMatchesSnapshot("should generate shadow without spread for frame with no clipping: max bounds",`${I.renderTree1().maxBounds}
`)}),ue("drop shadow with knockout: translucent node",()=>{let A=i(E,0,new G(0,0,100,100));return A.setTestOnlyFillPaints([$.createSolid(O.RED,.5)]),A.setTestOnlyEffects([Re.createDropShadow(10,new b(10,0),O.BLACK,.25,5,!1)]),T.asyncAssertMatchesSnapshot("should generate knockout shadow for regular translucent node",A.renderTree1().debugString1())}),ue("drop shadow with knockout: opaque node",()=>{let A=i(E,0,new G(0,0,100,100));return A.setTestOnlyFillPaints([$.createSolid(O.RED,1)]),A.setTestOnlyEffects([Re.createDropShadow(10,new b(10,0),O.BLACK,.25,5,!1)]),T.asyncAssertMatchesSnapshot("should optimize out knockout shadow for opaque node",A.renderTree1().debugString1())}),ue("drop shadow with knockout: opaque frame",()=>{let A=et(E);He(A,new b(-100,-100),new b(300,300));let I=Io(A,"frame",$.createSolid(O.RED,1));return He(I,new b(0,0),new b(50,50)),I.setIsFrameMaskDisabled(!0),I.setTestOnlyEffects([Re.createDropShadow(10,new b(10,0),O.BLACK,.25,20,!1)]),T.asyncAssertMatchesSnapshot("should optimize out knockout shadow for opaque frame",I.renderTree1().debugString1())}),ue("drop shadow with knockout: node with gradient transparency",()=>{let A=i(E,0,new G(0,0,100,100)),I=$.createLinearGradient([new je(O.new3(0,0,0,1),0),new je(O.new3(0,0,0,0),.3),new je(O.new3(0,0,0,0),.7),new je(O.new3(0,0,0,1),.7)]);return A.setTestOnlyFillPaints([I]),A.setTestOnlyEffects([Re.createDropShadow(10,new b(10,0),O.BLACK,.25,5,!1)]),T.asyncAssertMatchesSnapshot("should knockout gradient with transparency",A.renderTree1().debugString1())}),ue("drop shadow with knockout: with effect blend mode",()=>{let A=i(E,0,new G(0,0,100,100));A.setTestOnlyFillPaints([$.createSolid(O.RED,.5)]);let I=Re.createDropShadow(0,new b(10,0),O.BLACK,.25,5,!1);return I.setBlendMode("DIFFERENCE"),A.setTestOnlyEffects([I]),T.asyncAssertMatchesSnapshot("should generate blend for knockout shadow",A.renderTree1().debugString1())}),ue("drop shadow with knockout: with an inner shadow",()=>{let A=i(E,0,new G(0,0,100,100));return A.setTestOnlyFillPaints([$.createSolid(O.RED,.5)]),A.setTestOnlyEffects([Re.createDropShadow(10,new b(10,0),O.BLACK,.25,5,!1),Re.createInnerShadow(4,new b(5,5),O.BLACK,.25)]),T.asyncAssertMatchesSnapshot("should generate knockout shadow and inner shadow",A.renderTree1().debugString1())}),ue("drop shadow with knockout: with fill/stroke blend modes",()=>{let A=i(E,0,new G(0,0,100,100)),I=$.createSolid(O.RED,.5);I.setBlendMode("HARD_LIGHT"),A.setTestOnlyFillPaints([I]);let C=$.createSolid(O.BLUE,.5);return C.setBlendMode("SOFT_LIGHT"),A.setTestOnlyStrokePaints([C]),A.setStrokeWeight(5),A.setStrokeAlign("OUTSIDE"),A.setTestOnlyEffects([Re.createDropShadow(10,new b(10,0),O.BLACK,.25,5,!1)]),T.asyncAssertMatchesSnapshot("should generate fills/strokes with effects correctly (should not nest blends into knockout shadow mask alpha)",A.renderTree1().debugString1())}),ue("with fill/stroke blend modes (fast stroke optimization)",()=>{let A=Object({viewer_fast_stroke_shadow:!0});Y.updateFeatureFlags(A);let I=i(E,1,new G(0,0,100,100)),C=$.createSolid(O.RED,.5);C.setBlendMode("HARD_LIGHT"),I.setTestOnlyFillPaints([C]);let g=$.createSolid(O.BLACK,1);return g.setBlendMode("SOFT_LIGHT"),I.setTestOnlyStrokePaints([g]),I.setStrokeAlign("OUTSIDE"),I.setStrokeJoin("MITER"),I.setStrokeMiterLimit(4),I.setTestOnlyEffects([Re.createDropShadow(10,new b(10,0),O.BLACK,.25,5,!1)]),T.asyncAssertMatchesSnapshot("should generate strokes with a combined rendertree.",I.renderTree1().debugString1())}),ue("drop shadow with knockout: should not render knockout shadow inside bg blur",()=>{let A=Object({viewer_background_blur_opts:!1});Y.updateFeatureFlags(A);let I=Io(E,"frame",$.createSolid(O.RED,1));He(I,new b(0,0),new b(50,50));let C=i(E,0,new G(0,0,100,100));return C.setTestOnlyFillPaints([$.createSolid(O.RED,.5)]),C.setTestOnlyEffects([Re.createDropShadow(10,new b(10,0),O.BLACK,.25,5,!1),Re.createBackgroundBlur(10)]),T.asyncAssertMatchesSnapshot("should not render knockout shadow inside bg blur",C.renderTree1().debugString1())}),ue("drop shadow with knockout: with drop shadow that does not overlap node at all",()=>{let A=i(E,0,new G(0,0,100,100));return A.setTestOnlyFillPaints([$.createSolid(O.RED,.5)]),A.setTestOnlyEffects([Re.createDropShadow(10,new b(200,0),O.BLACK,.25,5,!1)]),T.asyncAssertMatchesSnapshot("should optimize but not cull knockout shadow that does not overlap node",A.renderTree1().debugString1())}),ue("drop shadow with knockout: transparent frame with stroke should have no shadows inside",()=>{let A=et(E);He(A,new b(-100,-100),new b(300,300));let I=Zs(A,"frame",[$.createSolid(O.RED,0)],[$.createSolid(O.BLACK,1)],new G(0,0,50,50));return He(I,new b(0,0),new b(50,50)),I.setTestOnlyEffects([Re.createDropShadow(10,new b(10,0),O.BLACK,1,5,!1)]),T.asyncAssertMatchesSnapshot("should generate knockout shadow for transparent node",I.renderTree1().debugString1())}),ue("inner shadow",()=>{let A=i(E,0,new G(0,0,100,100));return A.setTestOnlyFillPaints([$.createSolid(O.BLACK,1)]),A.setTestOnlyEffects([Re.createInnerShadow(4,new b(0,0),O.BLACK,.25)]),T.asyncAssertMatchesSnapshot("should output inner shadow",A.renderTree1().debugString1())}),ue("two inner shadows",()=>{let A=i(E,0,new G(0,0,100,100));return A.setTestOnlyFillPaints([$.createSolid(O.BLACK,1)]),A.setTestOnlyEffects([Re.createInnerShadow(0,new b(50,50),O.RED,1),Re.createInnerShadow(0,new b(-50,-50),O.GREEN,1)]),T.asyncAssertMatchesSnapshot("should output two inner shadows",A.renderTree1().debugString1())}),ue("inner shadow w/ zero blur radius",()=>{let A=i(E,0,new G(0,0,100,100));return A.setTestOnlyFillPaints([$.createSolid(O.BLACK,1)]),A.setTestOnlyEffects([Re.createInnerShadow(0,new b(0,4),O.BLACK,.25)]),T.asyncAssertMatchesSnapshot("should NOT output inner shadow",A.renderTree1().debugString1())}),ue("inner shadow, with outside stroke (mask.alpha HARD_MASK_WITH_COLOR inlines into shader)",()=>{let A=i(E,1,new G(0,0,100,100));return A.setStrokeAlign("OUTSIDE"),A.setTestOnlyFillPaints([$.createSolid(O.BLACK,1)]),A.setTestOnlyStrokePaints([$.createSolid(O.WHITE,1)]),A.setTestOnlyEffects([Re.createInnerShadow(1,new b(0,4),O.BLACK,.25)]),T.asyncAssertMatchesSnapshot("should have mask without hard mask alpha",A.renderTree1().debugString1())}),ue("semi-transparent rect",()=>{let A=i(E,0,new G(0,0,100,100));return A.setTestOnlyFillPaints([$.createSolid(O.BLACK,.5)]),A.setOpacity(.5),T.asyncAssertMatchesSnapshot("opacity should be baked into fill paint",A.renderTree1().debugString1())}),ue("simple rect with stroke",()=>{let A=i(E,1,new G(0,0,100,100));return A.setStrokeAlign("INSIDE"),A.setTestOnlyFillPaints([$.createSolid(O.BLACK,1)]),A.setTestOnlyStrokePaints([$.createSolid(O.WHITE,1)]),T.asyncAssertMatchesSnapshot("should output FillStroke",A.renderTree1().debugString1())}),ue("rect with stroke and disabled fill should NOT render fill",()=>{let A=i(E,1,new G(0,0,100,100));A.setStrokeAlign("INSIDE");let I=$.createSolid(O.BLACK,1);return I.setIsEnabled(!1),A.setTestOnlyFillPaints([I]),A.setTestOnlyStrokePaints([$.createSolid(O.WHITE,1)]),T.asyncAssertMatchesSnapshot("FILL_STROKE should NOT have black fill",A.renderTree1().debugString1())}),ue("background blur with no background",()=>{let A=Object({viewer_background_blur_opts:!0});Y.updateFeatureFlags(A);let I=Io(E,"frame",$.createSolid(O.RED,.5));return He(I,new b(0,0),new b(100,100)),I.setTestOnlyEffects([Re.createBackgroundBlur(10)]),T.asyncAssertMatchesSnapshot("should not generate a background blur subtree",I.renderTree1().debugString1())}),ue("background blur with no scrolling elements",()=>{let A=Object({viewer_background_blur_opts:!0});Y.updateFeatureFlags(A);let I=Io(E,"frame",$.createSolid(O.RED,1));He(I,new b(0,0),new b(100,100));let C=i(E,0,new G(0,0,50,50));return C.setTestOnlyFillPaints([$.createSolid(O.RED,.5)]),C.setTestOnlyEffects([Re.createBackgroundBlur(10)]),T.asyncAssertMatchesSnapshot("should not include an INVERSE_TRANSFORM node",C.renderTree1().debugString1())}),ue("background blur with scroll: foreground and background in clipping frame",()=>{let A=Object({viewer_background_blur_opts:!0});Y.updateFeatureFlags(A);let I=Io(E,"frame",$.createSolid(O.RED,1));He(I,new b(0,0),new b(100,100)),I.setOverflowDirection("VERTICAL");let C=Io(I,"container",$.createSolid(O.WHITE,1));He(C,new b(0,0),new b(100,500));let g=i(C,0,new G(0,0,50,50));return g.setTestOnlyFillPaints([$.createSolid(O.RED,.5)]),g.setTestOnlyEffects([Re.createBackgroundBlur(10)]),T.asyncAssertMatchesSnapshot("background blur should not include INVERSE_TRANSFORM or scrolling TRANSFORM nodes",g.renderTree1().debugString1())}),At("simple stroke-only rect",()=>{let A=null;beforeEach(()=>{v(),A=i(E,1,new G(0,0,100,100)),A.setTestOnlyFillPaints(Se.EMPTY),A.setTestOnlyStrokePaints([$.createSolid(O.WHITE,1)])}),ue("inside stroke",()=>(c(A,1,"INSIDE"),T.asyncAssertMatchesSnapshot("should output FillStroke with mode .INSIDE",A.renderTree1().debugString1()))),ue("outside stroke",()=>(c(A,1,"OUTSIDE"),T.asyncAssertMatchesSnapshot("should output FillStroke with mode .OUTSIDE",A.renderTree1().debugString1()))),ue("center stroke",()=>(c(A,1,"CENTER"),T.asyncAssertMatchesSnapshot("should output FillStroke with mode .CENTER",A.renderTree1().debugString1())))}),At("drop shadow with stroke, no spread",()=>{let A=null;ue("strokeAlign = CENTER, drop shadow",()=>{let I=Object({viewer_fast_stroke_shadow:!0});return Y.updateFeatureFlags(I),v(),A=l(E,0,new G(0,0,100,100),[$.createSolid(O.BLACK,1)],[$.createSolid(O.WHITE,1)],"CENTER",4,new b(0,0),O.BLACK,.25),T.asyncAssertMatchesSnapshot("Should output one BLUR and three FILLS",A.renderTree1().debugString1())}),ue("strokeAlign = INSIDE, drop shadow",()=>{let I=Object({viewer_fast_stroke_shadow:!0});return Y.updateFeatureFlags(I),v(),A=l(E,0,new G(0,0,100,100),[$.createSolid(O.BLACK,1)],[$.createSolid(O.WHITE,1)],"INSIDE",4,new b(0,0),O.BLACK,.25),T.asyncAssertMatchesSnapshot("Should output one BLUR, two FILLS and one FILL_STROKE",A.renderTree1().debugString1())}),ue("strokeAlign = OUTSIDE, drop shadow",()=>{let I=Object({viewer_fast_stroke_shadow:!0});return Y.updateFeatureFlags(I),v(),A=l(E,0,new G(0,0,100,100),[$.createSolid(O.BLACK,1)],[$.createSolid(O.WHITE,1)],"OUTSIDE",4,new b(0,0),O.BLACK,.25),T.asyncAssertMatchesSnapshot("Should output one BLUR, TWO FILLS, and one FILL_STROKE",A.renderTree1().debugString1())}),ue("simulated image border, corner radius > 0",()=>{let I=Object({viewer_fast_stroke_shadow:!0});Y.updateFeatureFlags(I),v(),A=s(E,20,1,new G(0,0,100,100));let C=$.createSolid(O.WHITE,1);A.setTestOnlyFillPaints([C]);let g=$.createSolid(O.WHITE,1);return A.setTestOnlyStrokePaints([g]),A.setStrokeAlign("OUTSIDE"),A.setTestOnlyEffects([Re.createDropShadow(6,new b(0,2),O.BLACK,.1,0,!1),Re.createDropShadow(6,new b(0,0),O.BLACK,.08,0,!1),Re.createDropShadow(6,new b(0,0),O.BLACK,.2,0,!1)]),A.setStrokeJoin("MITER"),A.setStrokeMiterLimit(4),T.asyncAssertMatchesSnapshot("should output three BLURs with FILLs, a FILL, and a FILL_STROKE.",A.renderTree1().debugString1())})}),At("Simple tests on non-rects",()=>{ue("simple non-rectangle",()=>{let A=d(E,new G(0,0,100,100));return T.asyncAssertMatchesSnapshot("should be single fill without isRect flag",A.renderTree1().debugString1())}),ue("non-rectangle not clipped by frame",()=>{let A=et(E);return He(A,new b(0,0),new b(100,100)),A.setTestOnlyFillPaints([$.createSolid(O.WHITE,1)]),d(A,new G(0,0,99,99)),T.asyncAssertMatchesSnapshot("group with two fills (frame background and non-rect layer)",A.renderTree1().debugString1())}),ue("non-rectangle clipped by frame",()=>{let A=et(E);return He(A,new b(0,0),new b(50,50)),A.setTestOnlyFillPaints([$.createSolid(O.WHITE,1)]),d(A,new G(0,0,100,100)),T.asyncAssertMatchesSnapshot("clipping should not be optimized",A.renderTree1().debugString1())})}),ue("grouped single node",()=>{let A=Ni(E);es(A,!1),He(A,new b(0,0),new b(100,100));let I=i(A,0,new G(0,0,100,100));return I.setTestOnlyFillPaints([$.createSolid(O.BLACK,1)]),T.asyncAssertMatchesSnapshot("group should be ellided since it does not affect rendering",I.renderTree1().debugString1())}),ue("nested groups",()=>{let A=Ni(E);es(A,!1),He(A,new b(0,0),new b(100,100));let I=Ni(A);es(I,!1),He(I,new b(0,0),new b(50,50)),i(I,0,new G(0,0,50,50)).setTestOnlyFillPaints([$.createSolid(O.BLACK,1)]);let g=Ni(A);return es(g,!1),He(g,new b(50,50),new b(50,50)),i(g,0,new G(0,0,50,50)).setTestOnlyFillPaints([$.createSolid(O.BLACK,1)]),T.asyncAssertMatchesSnapshot("render tree should contain only 1 group since groups do not affect rendering",A.renderTree1().debugString1())}),ue("flatten nested opacities",()=>{let A=Ni(E);He(A,new b(0,0),new b(100,100)),A.setOpacity(.8);let I=Ni(A);He(I,new b(0,0),new b(50,50)),I.setOpacity(.5);let C=i(I,0,new G(0,0,50,50));C.setTestOnlyFillPaints([$.createSolid(O.BLACK,1)]),C.setOpacity(.5);let g=Ni(A);He(g,new b(50,50),new b(50,50)),g.setOpacity(.25);let R=i(g,0,new G(0,0,50,50));return R.setTestOnlyFillPaints([$.createSolid(O.BLACK,1)]),R.setOpacity(.1),T.asyncAssertMatchesSnapshot("opacities for ellided groups should be applied to leaves",A.renderTree1().debugString1())}),At("node outside bounds of frame",()=>{let A=null;beforeEach(()=>{v(),A=et(E),A.setTestOnlyFillPaints([$.createSolid(O.WHITE,1)]),He(A,new b(0,0),new b(100,100)),i(A,0,new G(110,110,100,100)).setTestOnlyFillPaints([$.createSolid(O.BLACK,1)])}),ue("without frame clipping",()=>(A.setIsFrameMaskDisabled(!0),T.asyncAssertMatchesSnapshot("there should be two fills; one for the non-clipped rect",A.renderTree1().debugString1()))),ue("with frame clipping",()=>(A.setIsFrameMaskDisabled(!1),T.asyncAssertMatchesSnapshot("there should be on fill; rect was clipped",A.renderTree1().debugString1()))),me("with frame clipping and no background color",()=>{A.setIsFrameMaskDisabled(!1),es(A,!1),f(A.renderTree1(),null)})}),At("frame background",()=>{let A=null;beforeEach(()=>{v(),A=et(E),A.setTestOnlyFillPaints([$.createSolid(O.WHITE,1)]),es(A,!0),He(A,new b(0,0),new b(100,100))}),ue("with solid paint",()=>(A.setTestOnlyFillPaints([$.createSolid(O.new3(1,.5,0,1),1)]),T.asyncAssertMatchesSnapshot("frame background fill should be present",E.renderTree1().debugString1()))),ue("with solid paint and blend mode",()=>{let I=$.createSolid(O.new3(1,.5,0,1),1);return I.setBlendMode("MULTIPLY"),A.setTestOnlyFillPaints([I]),T.asyncAssertMatchesSnapshot("frame background should have MULTIPLY blend mode",E.renderTree1().debugString1())}),ue("with solid paint and blended gradient",()=>{let I=$.createSolid(O.new3(1,.5,0,1),1),C=$.createLinearGradient([new je(O.new3(1,.5,0,1),.25),new je(O.new3(0,.5,1,1),.75)]);return C.setBlendMode("MULTIPLY"),A.setTestOnlyFillPaints([I,C]),T.asyncAssertMatchesSnapshot("should output solid Fill and blended gradient Fill",E.renderTree1().debugString1())}),ue("with solid paint and blend mode and children",()=>{let I=$.createSolid(O.new3(1,.5,0,1),1);return I.setBlendMode("MULTIPLY"),A.setTestOnlyFillPaints([I]),i(A,0,new G(0,0,100,100)).setTestOnlyFillPaints([$.createSolid(O.BLACK,.5)]),T.asyncAssertMatchesSnapshot("should output background and children",E.renderTree1().debugString1())}),ue("with drop shadow and opaque fill",()=>(A.setTestOnlyEffects([Re.createDropShadow(4,new b(0,0),O.BLACK,.25)]),T.asyncAssertMatchesSnapshot("should not output a drop shadow",A.renderTree1().debugString1()))),ue("with drop shadow and no opaque fill",()=>(A.setTestOnlyFillPaints([$.createSolid(O.WHITE,.5)]),A.setTestOnlyEffects([Re.createDropShadow(4,new b(0,0),O.BLACK,.25)]),T.asyncAssertMatchesSnapshot("should output a drop shadow",A.renderTree1().debugString1())))}),At("frame fills for containers supporting fill stroke and corners",()=>{let A=null;beforeEach(()=>{v(),A=et(E),A.setTestOnlyFillPaints([$.createSolid(O.WHITE,1)]),He(A,new b(0,0),new b(100,100))}),ue("with solid paint",()=>(A.setTestOnlyFillPaints([$.createSolid(O.new3(1,.5,0,1),1)]),T.asyncAssertMatchesSnapshot("frame background fill should be present",E.renderTree1().debugString1()))),ue("with solid paint and blend mode",()=>{let I=$.createSolid(O.new3(1,.5,0,1),1);return I.setBlendMode("MULTIPLY"),A.setTestOnlyFillPaints([I]),T.asyncAssertMatchesSnapshot("frame background should have MULTIPLY blend mode",E.renderTree1().debugString1())}),ue("with solid paint and blended gradient",()=>{let I=$.createSolid(O.new3(1,.5,0,1),1),C=$.createLinearGradient([new je(O.new3(1,.5,0,1),.25),new je(O.new3(0,.5,1,1),.75)]);return C.setBlendMode("MULTIPLY"),A.setTestOnlyFillPaints([I,C]),T.asyncAssertMatchesSnapshot("should output solid Fill and blended gradient Fill",E.renderTree1().debugString1())}),ue("with solid paint and blend mode and children",()=>{let I=$.createSolid(O.new3(1,.5,0,1),1);return I.setBlendMode("MULTIPLY"),A.setTestOnlyFillPaints([I]),i(A,0,new G(0,0,100,100)).setTestOnlyFillPaints([$.createSolid(O.BLACK,.5)]),T.asyncAssertMatchesSnapshot("should output background and children",E.renderTree1().debugString1())}),ue("with inside stroke",()=>{let I=Zs(E,"frame",[$.createSolid(O.RED,1)],[$.createSolid(O.BLACK,1)],new G(0,0,50,50));return He(I,new b(0,0),new b(50,50)),I.setStrokeAlign("INSIDE"),I.setStrokeWeight(4),d(I,new G(0,0,100,100)),T.asyncAssertMatchesSnapshot("should generate a fill render node that is clipped by the frame mask",E.renderTree1().debugString1())}),ue("with outside stroke",()=>{let I=Zs(E,"frame",[$.createSolid(O.RED,1)],[$.createSolid(O.BLACK,1)],new G(0,0,50,50));return He(I,new b(0,0),new b(50,50)),He(I,new b(0,0),new b(50,50)),I.setStrokeAlign("OUTSIDE"),I.setStrokeWeight(4),d(I,new G(0,0,100,100)),T.asyncAssertMatchesSnapshot("should have stroke on top of mask",E.renderTree1().debugString1())})}),At("masks",()=>{ue("blend mode of masked content should mark mask and all ancestors as 'hasBlends'",()=>{let A=et(E);return A.setIsBackgroundEnabled(!1),A.setIsFrameMaskDisabled(!0),i(A,0,new G(0,0,10,10)).setIsMask(!0),i(A,0,new G(0,0,100,100)).setBlendMode("MULTIPLY"),T.asyncAssertMatchesSnapshot("all ancestors of rect should have 'hasBlends' flag",E.renderTree1().debugString1())}),ue("small outside strokes should be masked",()=>{let A=et(E);A.setIsBackgroundEnabled(!1),A.setIsFrameMaskDisabled(!0),i(A,0,new G(0,0,100,100)).setIsMask(!0);let C=o(A,1,new G(0,0,100,100),2);return C.setStrokeAlign("OUTSIDE"),C.setTestOnlyFillPaints([$.createSolid(O.WHITE,1)]),C.setTestOnlyStrokePaints([$.createSolid(O.BLACK,1)]),T.asyncAssertMatchesSnapshot("optimized RenderTree should mask rect with outside stroke",E.renderTree1().optimized().debugString1())}),ue("mask should be ignored if color is contained within the alpha",()=>{let A=et(E);return A.setIsBackgroundEnabled(!1),A.setIsFrameMaskDisabled(!0),s(A,50,0,new G(0,0,100,100)).setIsMask(!0),s(A,10,0,new G(40,40,20,20)).setTestOnlyFillPaints([$.createSolid(O.WHITE,1)]),T.asyncAssertMatchesSnapshot("optimized RenderTree should ignore mask as contained",E.renderTree1().optimized().debugString1())}),ue("mask should not ignored if color is not contained within the alpha",()=>{let A=et(E);return A.setIsBackgroundEnabled(!1),A.setIsFrameMaskDisabled(!0),s(A,50,0,new G(0,0,100,100)).setIsMask(!0),s(A,32,0,new G(12,12,76,76)).setTestOnlyFillPaints([$.createSolid(O.WHITE,1)]),T.asyncAssertMatchesSnapshot("optimized RenderTree should have a mask if alpha does not contain color",E.renderTree1().optimized().debugString1())}),ue("mask should be ignored if color contained within the a rounded rectangular alpha",()=>{let A=et(E);return A.setIsBackgroundEnabled(!1),A.setIsFrameMaskDisabled(!0),s(A,27,0,new G(0,0,100,100)).setIsMask(!0),s(A,32,0,new G(12,12,76,76)).setTestOnlyFillPaints([$.createSolid(O.WHITE,1)]),T.asyncAssertMatchesSnapshot("optimized RenderTree should not contain a mask if color is contained within a rounded rectangular alpha",E.renderTree1().optimized().debugString1())})}),At("rectangle visibility",()=>{let A=null;beforeEach(()=>{v(),A=i(E,0,new G(0,0,100,100)),A.setTestOnlyFillPaints([$.createSolid(O.BLACK,1)])}),ue("default visible",()=>T.asyncAssertMatchesSnapshot("should output single fill",A.renderTree1().debugString1())),me("visibility false",()=>{A.setVisible(!1),f(A.renderTree1(),null)}),me("layer opacity zero",()=>{A.setOpacity(0),f(A.renderTree1(),null)}),me("fill paint opacity zero",()=>{A.setTestOnlyFillPaints([$.createSolid(O.BLACK,0)]),f(A.renderTree1(),null)}),me("no paints",()=>{A.setTestOnlyFillPaints(Se.EMPTY),f(A.renderTree1(),null)}),me("no fill paint, stroke paints, zero stroke width",()=>{let C=o(E,1,new G(0,0,100,100),0);C.setTestOnlyFillPaints(Se.EMPTY),C.setTestOnlyStrokePaints([$.createSolid(O.TRANSPARENT,0)]),f(C.renderTree1(),null)})}),At("solid paints",()=>{let A=null;beforeEach(()=>{v(),A=i(E,0,new G(0,0,100,100))}),ue("normal",()=>(A.setTestOnlyFillPaints([$.createSolid(O.new3(1,.5,0,1),1)]),T.asyncAssertMatchesSnapshot("should output fill with opacity=1",A.renderTree1().debugString1()))),ue("50% opacity",()=>(A.setTestOnlyFillPaints([$.createSolid(O.new3(1,.5,0,1),.5)]),T.asyncAssertMatchesSnapshot("should output fill with opacity=0.5",A.renderTree1().debugString1()))),me("0% opacity",()=>{A.setTestOnlyFillPaints([$.createSolid(O.new3(1,.5,0,1),0)]),f(A.renderTree1(),null)}),me("disabled",()=>{let I=$.createSolid(O.new3(1,.5,0,1),1);I.setIsEnabled(!1),A.setTestOnlyFillPaints([I]),f(A.renderTree1(),null)}),ue("multiply blend",()=>{let I=$.createSolid(O.new3(1,.5,0,1),1);return I.setBlendMode("MULTIPLY"),A.setTestOnlyFillPaints([I]),T.asyncAssertMatchesSnapshot("should output Blend with Fill child",A.renderTree1().debugString1())})}),At("gradient paints",()=>{let A=null;beforeEach(()=>{v(),A=i(E,0,new G(0,0,100,100))}),ue("linear",()=>{let I=$.createLinearGradient([new je(O.new3(1,.5,0,1),.25),new je(O.new3(0,.5,1,1),.75)]);return A.setTestOnlyFillPaints([I]),T.asyncAssertMatchesSnapshot("should output Fill with linear gradient paint",A.renderTree1().debugString1())}),ue("radial",()=>{let I=$.createRadialGradient([new je(O.new3(1,.5,0,1),.25),new je(O.new3(0,.5,1,1),.75)]);return A.setTestOnlyFillPaints([I]),T.asyncAssertMatchesSnapshot("should output Fill with radial gradient paint",A.renderTree1().debugString1())}),ue("angular",()=>{let I=$.createAngularGradient([new je(O.new3(1,.5,0,1),.25),new je(O.new3(0,.5,1,1),.75)]);return A.setTestOnlyFillPaints([I]),T.asyncAssertMatchesSnapshot("should output Fill with angular gradient paint",A.renderTree1().debugString1())}),ue("diamond",()=>{let I=$.createDiamondGradient([new je(O.new3(1,.5,0,1),.25),new je(O.new3(0,.5,1,1),.75)]);return A.setTestOnlyFillPaints([I]),T.asyncAssertMatchesSnapshot("should output Fill with diamond gradient paint",A.renderTree1().debugString1())}),ue("50% opacity",()=>{let I=$.createLinearGradient([new je(O.new3(1,.5,0,1),.25),new je(O.new3(0,.5,1,1),.75)]);return I.setOpacity(.5),A.setTestOnlyFillPaints([I]),T.asyncAssertMatchesSnapshot("should output linear gradient with 50% opacity",A.renderTree1().debugString1())}),me("0% opacity",()=>{let I=$.createLinearGradient([new je(O.new3(1,.5,0,1),.25),new je(O.new3(0,.5,1,1),.75)]);I.setOpacity(0),A.setTestOnlyFillPaints([I]),f(A.renderTree1(),null)}),me("disabled",()=>{let I=$.createLinearGradient([new je(O.new3(1,.5,0,1),.25),new je(O.new3(0,.5,1,1),.75)]);I.setIsEnabled(!1),A.setTestOnlyFillPaints([I]),f(A.renderTree1(),null)}),ue("40% stop opacity",()=>{let I=$.createLinearGradient([new je(O.new3(1,.5,0,.4),.25),new je(O.new3(0,.5,1,.6),.75)]);return A.setTestOnlyFillPaints([I]),T.asyncAssertMatchesSnapshot("should output linear gradient with partial opacity stops",A.renderTree1().debugString1())}),me("0% stop opacity",()=>{let I=$.createLinearGradient([new je(O.new3(1,.5,0,0),.25),new je(O.new3(0,.5,1,0),.75)]);A.setTestOnlyFillPaints([I]),f(A.renderTree1(),null)}),ue("transform",()=>{let I=$.createLinearGradient([new je(O.new3(1,.5,0,1),.25),new je(O.new3(0,.5,1,1),.75)]);I.setTransform1(new J(.5,-.5,1,-1,1.5,-1.5)),A.setTestOnlyFillPaints([I]);let C=A.renderTree1();f(C.op(),3);let R=C.geometry.paints;return f(R,A.fillPaints()),T.asyncAssertMatchesSnapshot("should output linear gradient",A.renderTree1().debugString1())})}),ue("geometry",()=>{let A=Xr(E,"VECTOR");A.setTestOnlyFillPaints([$.createSolid(O.BLACK,1)]);let I=new G(0,0,100,100),C=new Dr("ODD",0,Rt.new2().moveTo1(0,0).lineTo(100,0).lineTo(50,100).close(),I),g=new Dr("NONZERO",0,Rt.new2().moveTo1(0,100).lineTo(100,100).lineTo(50,0).close(),I);A.setTestOnlyFillGeometry(new wr([C,g],null,I,null));let R=A.renderTree1();f(R.op(),1);let D=R;return f(D.children.length,2),f(D.children[0].op(),3),f(D.children[1].op(),3),f(D.children[0].geometry.path().windingRule(),"ODD"),f(D.children[1].geometry.path().windingRule(),"NONZERO"),T.asyncAssertMatchesSnapshot("should output a group with two fills",A.renderTree1().debugString1())})}),At("RenderTree optimization of PaintData",()=>{me("dual-color gradient",()=>{let y=[$.createLinearGradient([new je(O.new3(0,.5,1,1),0),new je(O.new3(1,.5,0,1),1)])],E=Se.optimize(y);f(E.length,1),f(E[0].type(),"GRADIENT_LINEAR")}),me("dual-opacity gradient",()=>{let y=[$.createLinearGradient([new je(O.new3(1,.5,0,0),0),new je(O.new3(1,.5,0,1),1)])],E=Se.optimize(y);f(E.length,1),f(E[0].type(),"GRADIENT_LINEAR")}),me("single-color gradient",()=>{let y=[$.createLinearGradient([new je(O.new3(1,.5,0,1),0),new je(O.new3(1,.5,0,1),1)])],E=Se.optimize(y);f(E.length,1),f(E[0].type(),"SOLID")}),me("solid underneath dual-color gradient",()=>{let y=[$.createSolid(O.GREEN,1),$.createLinearGradient([new je(O.new3(0,0,1,.5),0),new je(O.new3(1,0,0,.5),1)])],E=Se.optimize(y);f(E.length,1),f(E[0].type(),"GRADIENT_LINEAR"),E[0].asSinglePaint()!=null;let v=E[0].asSinglePaint().colorStops()[0],A=E[0].asSinglePaint().colorStops()[1];f(v.position,0),e(v.color,O.new3(0,.5,.5,1)),f(A.position,1),e(A.color,O.new3(.5,.5,0,1))}),me("solid underneath single-color gradient",()=>{let y=[$.createSolid(O.GREEN,1),$.createLinearGradient([new je(O.new3(1,0,0,.5),0),new je(O.new3(1,0,0,.5),1)])],E=Se.optimize(y);f(E.length,1),f(E[0].type(),"SOLID"),e(E[0].asSinglePaint().color(),O.new3(.5,.5,0,1))})}),At("RenderTree.isRect",()=>{let y=v=>{f(new Et(v,"ODD").isRect(),!0)},E=v=>{f(new Et(v,"ODD").isRect(),!1)};me("RenderTree.isRect",()=>{y(Rt.new2().lineTo(10,0).lineTo(10,5).lineTo(0,5)),y(Rt.new2().lineTo(10,0).lineTo(10,5).lineTo(0,5).lineTo(0,0)),y(Rt.new2().lineTo(10,0).lineTo(10,5).lineTo(0,5).lineTo(0,0).close()),y(Rt.new2().moveTo1(0,0).lineTo(10,0).lineTo(10,5).lineTo(0,5).close()),y(Rt.new2().moveTo1(0,0).lineTo(10,0).lineTo(10,5).lineTo(0,5).lineTo(0,0).close()),E(Rt.new2().moveTo1(10,0).lineTo(10,5).lineTo(0,5)),E(Rt.new2().moveTo1(10,0).lineTo(0,0).lineTo(10,5).lineTo(0,5).close()),E(Rt.new2().quadraticTo(10,0,10,5).lineTo(0,5)),E(Rt.new2().lineTo(10,0).quadraticTo(10,5,0,5)),E(Rt.new2().cubicTo1(10,0,10,5,0,5));let A=nt.createSceneWithCanvasForTests1().root().childAt1(0),I=i(A,0,new G(0,0,100,100));f(I.renderTree1()!=null,!0),f(I.renderTree1().isRectFill(),!0)})}),At("RenderTree optimization of Group nodes",()=>{let y=null;beforeEach(()=>{let E=new wt(new Et(St.fromRect(new G(0,0,1,1)),"ODD"),[$.createSolid(O.BLACK,1)]);y=new Ar(J.new2(),E,b.new())}),me("empty group",()=>{f(new ke([]).optimized(),null)}),me("empty nested group",()=>{f(new ke([new ke([])]).optimized(),null)}),ue("single group",()=>T.asyncAssertMatchesSnapshot("should be fill only; no groups",new ke([y]).optimized().debugString1())),ue("single nested group",()=>T.asyncAssertMatchesSnapshot("should be fill only; no groups",new ke([new ke([y])]).optimized().debugString1())),ue("double group",()=>T.asyncAssertMatchesSnapshot("group with two fill children can't be optimized",new ke([y,y]).optimized().debugString1())),ue("double nested group 1",()=>T.asyncAssertMatchesSnapshot("outer group should be optimized away, leaving a group with two fill children",new ke([new ke([y,y])]).optimized().debugString1())),ue("double nested group 2",()=>T.asyncAssertMatchesSnapshot("inner groups should be optimized away, leaving a group with two fill children",new ke([new ke([y]),new ke([y])]).optimized().debugString1()))}),At("RenderTree optimization of Dissolve",()=>{let y=null,E=null,v=(A,I)=>new cn(A,I,"A",()=>1).optimized();beforeEach(()=>{let A=new wt(new Et(St.fromRect(new G(0,0,1,1)),"ODD"),[$.createSolid(O.BLACK,1)]);y=new Ar(J.new2(),A,b.new());let I=new wt(new Et(St.fromRect(new G(0,0,1,1)),"ODD"),[$.createSolid(O.RED,1)]);E=new Ar(J.new2(),I,b.new())}),me("both subtrees null",()=>{f(v(null,null),null)}),ue("old subtree null",()=>T.asyncAssertMatchesSnapshot("dissolve should be optimized into volatile opacity because old subtree is null",v(null,y).debugString1())),ue("new subtree null",()=>T.asyncAssertMatchesSnapshot("dissolve should be optimized into volatile opacity because new subtree is null",v(y,null).debugString1())),ue("identical subtrees",()=>T.asyncAssertMatchesSnapshot("dissolve should be optimized away entirely because subtrees are identical",v(y,y).debugString1())),ue("different subtrees",()=>T.asyncAssertMatchesSnapshot("dissolve should not be optimized away",v(y,E).debugString1()))}),At("RenderTree optimization of Fill",()=>{me("fill with zero opacity paint",()=>{f(new Ar(J.new2(),new wt(new Et(St.fromRect(new G(0,0,1,1)),"ODD"),[$.createSolid(O.BLACK,0)]),b.new()).optimized(),null)}),me("fill with disabled paint",()=>{f(new Ar(J.new2(),new wt(new Et(St.fromRect(new G(0,0,1,1)),"ODD"),[$.create("SOLID",1,"NORMAL",!1,O.BLACK)]),b.new()).optimized(),null)}),me("fill with empty bounds",()=>{f(new Ar(J.new2(),new wt(new Et(St.fromRect(new G(0,0,0,0)),"ODD"),[$.createSolid(O.BLACK,1)]),b.new()).optimized(),null)})}),At("RenderTree optimization of Blur",()=>{let y=null;beforeEach(()=>{let E=new wt(new Et(St.fromRect(new G(0,0,1,1)),"ODD"),[$.createSolid(O.BLACK,1)]);y=new Ar(J.new2(),E,b.new())}),ue("zero radius blur",()=>T.asyncAssertMatchesSnapshot("should contain no Blur node",oo.createForStandardBlur(0,y,G.INVALID).optimized().debugString1())),ue("blur wrapping volatile fill",()=>T.asyncAssertMatchesSnapshot("volatile property binding should be OUTSIDE of blur",oo.createForStandardBlur(10,rt.forTranslation(y,ft.forAnimateableTranslation("x"),()=>b.new()),G.INVALID).optimized().debugString1())),ue("clamp blur wrapping volatile fill",()=>T.asyncAssertMatchesSnapshot("volatile property binding should be INSIDE of blur",oo.createForStandardBlur(10,rt.forTranslation(y,ft.forAnimateableTranslation("x"),()=>b.new()),new G(0,0,1,1)).optimized().debugString1()))}),At("RenderTree optimization of HardMaskWithColor",()=>{let y=null;beforeEach(()=>{let E=new wt(new Et(St.fromRect(new G(0,0,1,1)),"ODD"),[$.createSolid(O.BLACK,1)]);y=new Ar(J.new2(),E,b.new())}),ue("hard mask wrapping fill",()=>T.asyncAssertMatchesSnapshot("should be a single Fill",new To(y,O.BLACK).optimized().debugString1())),ue("hard mask wrapping volatile fill",()=>T.asyncAssertMatchesSnapshot("should be a single Fill wrapped by the VolatilePropertyBinding",new To(rt.forTranslation(y,ft.forAnimateableTranslation("x"),()=>b.new()),O.BLACK).optimized().debugString1())),ue("hard mask wrapping blend nodes",()=>T.asyncAssertMatchesSnapshot("should be a single Fill",new To(new io("MULTIPLY",.5,y),O.BLACK).optimized().debugString1()))}),At("Stack reverse Z index",()=>{let y=null,E=null,v=()=>{y=nt.createSceneWithCanvasForTests1(),E=y.root().childAt1(0),E.setPrototypeDevice(sn.DEFAULT)};beforeEach(v),ue("stacking frame without stackReverseZIndex",()=>{let A=qe(E,"f");return Ft(A,"c1",O.RED,1),Ft(A,"c2",O.BLUE,1),A.setStackMode("VERTICAL"),A.setStackReverseZIndex(!1),T.asyncAssertMatchesSnapshot("should have non-reversed children",A.renderTree1().debugString1())}),ue("stacking frame with stackReverseZIndex",()=>{let A=qe(E,"f");return Ft(A,"c1",O.RED,1),Ft(A,"c2",O.BLUE,1),A.setStackMode("VERTICAL"),A.setStackReverseZIndex(!0),T.asyncAssertMatchesSnapshot("should have reversed children",A.renderTree1().debugString1())}),ue("non-stacking frame without stackReverseZIndex",()=>{let A=qe(E,"f");return Ft(A,"c1",O.RED,1),Ft(A,"c2",O.BLUE,1),A.setStackMode("NONE"),A.setStackReverseZIndex(!1),T.asyncAssertMatchesSnapshot("should have non-reversed children",A.renderTree1().debugString1())}),ue("non-stacking frame with stackReverseZIndex",()=>{let A=qe(E,"f");return Ft(A,"c1",O.RED,1),Ft(A,"c2",O.BLUE,1),A.setStackMode("NONE"),A.setStackReverseZIndex(!0),T.asyncAssertMatchesSnapshot("should have non-reversed children",A.renderTree1().debugString1())})})}m.testRenderTree=p;function u(){let f=AssertLib.deepStrictEqual;me("Reparenting a node should invalidate render trees on both its old and its new parent",()=>{let y=nt.createSceneWithCanvasForTests1().root().childAt1(0),E=et(y),v=et(y),A=i(E,0,new G(0,0,100,100)),I=E.renderTree1(),C=v.renderTree1();f(I!=null,!0),f(C!=null,!0),A.setParentIndex(new Qr(X.invalid(),nr.fromString(""))),v.appendChild(A);let g=E.renderTree1(),R=v.renderTree1();f(g!=I,!0),f(R!=C,!0)})}m.testNodeRenderTree=u;function _(){let f=AssertLib.deepStrictEqual,T=AssertLib.notDeepStrictEqual;me("equalWithinBounds works for Group nodes",()=>{let E=nt.createSceneWithCanvasForTests1().root().childAt1(0),v=ar(E,"frame1",O.BLUE),A=ar(E,"frame2",O.BLUE),I=null,C=null,g=()=>{I=v.renderTree1(),C=A.renderTree1()};g(),f(I.equals(C),!0),f(I,C),f(I.equalsWithinBounds(C,new G(15,15,10,10)),!0),f(I.equalsWithinBounds(C,new G(0,0,5,5)),!0);let R=i(v,0,new G(1,1,10,10)),D=i(A,0,new G(0,0,10,10));g(),f(I.equals(C),!1),T(I,C),f(I.equalsWithinBounds(C,new G(15,15,10,10)),!0),f(I.equalsWithinBounds(C,new G(0,0,5,5)),!1);let P=i(v,0,new G(15,15,10,10));g(),f(I.equalsWithinBounds(C,new G(30,30,10,10)),!1),f(I.equalsWithinBounds(C,new G(15,15,10,10)),!1),f(I.equalsWithinBounds(C,new G(0,0,5,5)),!1)}),me("equalWithinBounds works with nested masking",()=>{let E=nt.createSceneWithCanvasForTests1().root().childAt1(0),v=ar(E,"frame1",O.BLUE),A=ar(E,"frame2",O.BLUE),I=null,C=null,g=()=>{I=v.renderTree1(),C=A.renderTree1()};g(),f(I.equals(C),!0),f(I,C),f(I.equalsWithinBounds(C,new G(15,15,10,10)),!0),f(I.equalsWithinBounds(C,new G(0,0,5,5)),!0),i(v,0,new G(1,1,10,10)).setIsMask(!0);let D=i(v,0,new G(1,1,100,100));i(A,0,new G(1,1,10,10)).setIsMask(!0);let U=i(A,0,new G(1,1,101,101));g(),f(I.equals(C),!1),T(I,C),f(I.equalsWithinBounds(C,new G(15,15,10,10)),!0),f(I.equalsWithinBounds(C,new G(0,0,5,5)),!1)})}m.testEqualsWithinBounds=_;let h;(y=>(y[y.FILL=0]="FILL",y[y.FILL_AND_STROKE=1]="FILL_AND_STROKE"))(h=m.GeometryType||(m.GeometryType={}));let S;(y=>{function f(E){return E==0||E==1}y.GeometryType_hasFill=f;function T(E){return E==1}y.GeometryType_hasStroke=T})(S=m.in_GeometryType||(m.in_GeometryType={}))})(em||(em={}));var tm;(s=>(s.FIG_FILE_NO_THUMBNAIL=new Uint8Array([102,105,103,45,107,105,119,105,1,0,0,0,208,10,0,0,141,24,123,127,227,70,113,87,118,156,199,229,30,125,80,74,41,165,148,82,74,129,114,87,74,41,165,180,149,45,217,86,34,75,170,36,231,113,148,186,138,45,199,106,100,201,104,101,95,114,208,239,206,204,142,94,78,14,126,228,143,104,231,177,243,218,153,217,89,127,57,10,133,8,46,67,255,102,21,50,182,119,100,27,214,196,243,85,215,103,240,103,217,154,62,233,13,85,107,160,123,0,242,177,167,187,13,88,145,220,186,165,193,186,229,25,3,75,53,97,213,246,252,115,83,135,197,142,92,76,60,29,101,117,106,201,19,239,216,112,38,174,110,218,42,238,220,85,175,35,1,194,206,80,227,57,170,81,167,83,48,10,80,174,174,106,19,219,50,17,203,36,112,234,26,62,202,230,86,58,11,157,69,32,192,104,165,7,36,95,215,136,105,100,159,200,37,63,141,146,89,148,92,186,235,24,121,44,219,122,170,187,54,242,216,154,86,74,32,175,95,2,34,10,101,154,221,27,143,116,11,237,229,61,213,58,81,165,151,3,215,30,59,232,98,223,85,71,200,215,238,218,182,169,171,214,196,118,116,87,245,13,219,66,111,79,244,158,111,187,232,42,122,137,142,153,134,20,187,167,155,166,225,120,184,220,119,129,9,194,39,227,115,224,234,131,177,169,186,19,199,54,207,7,82,200,61,80,101,105,186,54,105,242,29,250,250,25,154,116,223,51,141,30,34,30,120,231,163,174,141,177,126,104,88,160,204,146,216,71,221,56,76,102,35,240,138,177,87,28,213,243,38,254,16,196,13,134,116,146,238,72,158,14,215,84,247,88,71,93,202,104,108,250,134,35,131,219,66,83,193,146,238,216,69,82,187,103,155,118,5,237,152,198,96,232,203,61,29,15,98,45,87,187,197,14,205,214,6,210,73,218,82,130,251,112,10,174,169,162,236,3,207,238,251,19,41,3,61,28,170,174,86,65,135,154,209,239,235,174,78,30,220,215,207,122,230,216,163,120,62,24,142,17,247,208,83,253,113,21,228,71,82,11,44,94,50,199,35,195,178,61,195,71,21,47,59,65,148,228,116,152,29,207,54,13,153,11,3,87,213,12,56,205,9,153,138,206,87,40,252,202,120,40,21,10,194,141,167,129,209,168,112,192,52,178,101,126,183,141,145,42,61,219,49,150,80,46,222,52,136,67,138,53,228,187,171,251,61,25,230,190,33,115,167,111,152,82,182,111,200,3,108,233,243,121,56,45,236,107,27,150,5,85,228,13,85,205,62,149,73,231,218,78,13,242,190,13,105,33,211,96,210,53,199,104,142,210,85,123,199,219,168,150,31,94,231,61,153,253,109,219,53,6,6,149,30,27,59,144,145,40,197,180,79,229,2,76,240,201,6,220,161,133,211,52,11,242,40,77,0,81,38,61,38,156,91,164,42,7,95,140,99,189,78,28,197,90,47,47,194,108,156,68,57,20,100,203,85,165,201,142,113,166,155,178,35,128,186,30,21,140,210,75,19,145,103,245,65,236,192,1,33,51,210,201,168,145,138,53,174,212,241,106,121,61,85,90,215,246,242,44,189,10,213,56,186,68,211,170,45,12,242,219,208,164,101,246,216,47,150,10,49,247,130,21,40,41,189,144,225,145,30,124,61,86,93,201,166,186,174,125,42,15,31,77,109,17,168,127,61,54,76,232,22,110,209,171,164,168,163,52,66,181,35,163,208,218,213,79,116,89,44,165,84,165,155,166,113,24,36,246,42,44,227,215,30,91,148,147,96,35,108,243,160,96,165,250,113,215,119,85,185,86,206,236,234,172,164,103,195,52,139,158,167,73,30,196,176,221,212,251,254,118,120,220,162,40,148,163,177,231,27,125,67,182,177,122,247,73,152,229,209,20,247,182,124,219,217,222,218,181,125,223,30,201,162,78,215,34,236,173,51,145,102,80,11,154,222,87,161,202,37,179,107,123,144,101,134,228,215,207,117,76,59,74,22,5,26,186,84,229,168,224,10,84,125,239,88,182,236,182,163,83,99,131,220,77,179,81,148,101,40,179,202,155,178,61,113,185,128,242,129,178,214,173,129,47,211,70,11,196,130,202,67,233,65,243,67,254,250,216,185,44,161,162,28,28,107,128,212,35,71,31,200,248,157,224,71,113,180,190,44,156,235,85,154,229,183,51,171,213,179,193,113,48,181,76,31,86,34,78,13,77,234,231,37,98,168,151,65,53,131,155,116,157,15,178,104,86,8,185,147,158,181,129,138,12,250,58,79,221,80,68,207,195,134,211,82,129,244,181,146,204,107,29,94,126,19,135,94,88,22,0,132,215,179,139,202,244,117,117,36,13,131,179,165,147,234,187,144,139,208,249,100,255,245,245,145,99,187,170,123,78,73,73,98,192,239,60,172,156,190,211,215,100,36,139,174,4,170,131,233,21,69,188,50,118,8,173,225,41,4,130,26,63,52,100,223,232,81,211,147,220,189,116,13,242,179,162,232,218,255,79,185,226,182,163,181,200,163,249,205,255,218,225,168,61,125,2,53,68,55,119,107,48,6,195,185,34,224,82,135,210,129,245,46,227,113,10,169,44,151,208,56,98,72,44,222,206,216,62,227,151,240,79,185,128,127,173,0,254,181,41,247,96,243,53,18,111,144,232,2,10,184,107,196,51,228,94,32,183,148,228,229,233,10,54,76,165,212,46,227,171,84,68,178,100,129,117,20,228,89,116,205,120,103,249,248,49,238,95,62,126,130,232,229,227,143,80,198,242,9,34,219,203,39,136,220,89,62,65,100,199,9,50,56,3,35,153,133,176,79,185,92,71,51,246,85,67,232,189,178,69,2,113,19,196,235,16,197,174,101,187,124,29,206,24,78,208,10,150,33,227,173,121,176,140,226,27,224,231,2,143,23,55,130,144,92,76,179,104,149,3,116,39,215,65,96,142,39,255,152,241,82,176,210,141,211,11,198,249,197,77,30,10,214,226,84,72,76,105,193,32,180,64,56,65,93,32,121,22,228,129,228,221,133,170,150,194,148,67,41,236,1,227,101,96,148,116,21,76,163,28,67,216,218,68,34,186,0,163,56,107,95,84,83,196,33,219,17,16,75,193,134,188,3,38,37,98,158,102,75,118,196,118,35,169,245,132,237,201,133,191,0,255,147,32,138,1,179,31,109,95,142,143,216,65,150,230,65,17,254,123,2,9,176,56,148,151,17,216,200,148,221,233,34,200,130,41,228,161,192,216,84,144,172,1,67,19,108,23,18,7,215,246,38,204,160,120,67,63,64,67,115,222,138,101,65,123,88,159,26,152,13,151,97,28,37,16,150,111,248,206,101,124,179,90,8,246,45,239,204,170,27,79,176,239,248,110,183,224,98,74,187,58,65,72,205,103,209,44,199,4,82,144,118,142,1,193,197,48,140,46,23,57,102,196,0,229,193,158,105,186,92,6,201,76,20,161,229,13,25,100,164,76,232,214,28,78,93,218,5,91,27,87,174,162,100,144,186,130,245,57,175,153,21,202,112,10,70,107,35,1,43,204,159,165,217,85,169,37,129,176,7,49,200,155,21,206,254,151,128,96,153,57,1,56,162,112,76,83,193,190,226,220,187,89,94,164,113,33,93,72,0,212,66,2,211,186,148,33,96,191,2,89,139,39,44,79,175,31,200,186,219,103,149,212,81,176,90,193,56,13,94,20,21,128,154,102,80,236,112,98,96,153,20,231,134,243,16,170,101,10,241,221,153,71,113,120,28,82,194,215,122,21,80,136,77,96,136,9,11,73,143,134,54,164,11,182,224,237,50,187,119,104,108,98,74,71,166,238,203,205,212,157,207,69,152,67,40,90,89,48,139,214,2,35,93,231,240,78,51,135,59,84,87,208,78,115,169,0,194,176,158,207,161,9,128,97,81,117,15,125,200,160,97,84,149,231,194,64,92,93,23,76,217,147,250,63,98,60,192,151,138,2,78,84,170,90,201,122,233,129,145,50,193,118,88,187,48,12,218,135,32,108,145,7,157,203,117,142,89,77,208,110,233,200,30,157,151,242,172,241,86,217,67,63,183,242,76,193,167,74,111,17,36,88,235,63,148,45,8,191,126,112,9,244,63,173,228,67,168,3,29,5,23,132,252,100,213,104,92,38,107,53,64,98,248,179,244,234,128,181,241,75,168,79,139,254,177,131,95,66,253,165,246,181,83,44,137,240,25,116,240,171,112,6,248,93,90,17,250,175,117,87,217,43,150,68,248,188,121,40,251,21,64,196,191,77,241,46,130,197,129,92,16,242,11,65,233,126,15,191,132,250,178,217,135,14,43,128,136,95,205,32,169,32,160,16,103,232,54,252,126,3,36,6,53,144,87,186,116,146,179,7,53,68,228,238,5,220,110,151,25,24,48,211,19,44,42,116,238,225,29,36,49,247,150,129,184,2,250,35,252,18,74,11,203,14,142,183,182,176,19,104,247,156,189,116,23,75,236,58,238,52,132,189,206,101,71,226,236,229,45,4,49,245,107,245,118,21,216,87,238,32,137,121,0,173,38,9,51,183,44,137,87,155,48,177,12,27,189,233,71,229,154,72,6,100,72,112,153,5,171,5,38,73,130,73,252,218,45,20,49,30,85,88,15,181,39,120,101,255,248,54,142,88,143,69,30,100,70,2,70,120,69,235,127,125,27,67,108,230,50,130,83,50,35,248,0,203,79,106,136,200,35,33,167,244,211,178,31,191,209,132,137,197,202,225,70,241,225,234,184,34,123,126,218,132,137,197,94,84,227,119,227,146,125,131,189,249,34,60,109,113,68,227,89,242,38,251,89,3,36,134,175,69,245,20,121,139,189,85,1,68,116,69,253,184,120,155,253,188,134,136,236,229,47,120,23,188,203,222,126,1,154,54,248,249,157,167,192,123,236,23,119,144,196,60,206,203,23,226,171,236,157,114,77,164,147,124,251,41,248,26,251,229,54,134,216,78,47,110,191,121,222,97,239,222,198,17,235,217,166,208,189,21,216,95,221,197,18,251,57,220,13,177,28,75,4,59,227,239,213,16,145,159,82,164,42,134,95,55,97,98,249,123,227,126,182,216,251,53,68,228,111,230,229,220,229,176,223,148,107,34,253,35,47,71,143,167,236,131,114,77,164,111,67,121,223,8,22,243,223,22,75,34,76,160,245,206,96,162,145,47,32,204,175,15,216,239,110,161,136,241,187,112,251,174,73,248,239,183,49,196,22,228,219,207,139,143,217,135,219,24,98,187,136,171,59,72,176,21,255,67,3,36,134,233,166,158,29,46,216,227,26,34,242,172,158,50,158,20,75,34,132,117,255,232,21,23,209,71,183,80,196,56,199,163,25,132,233,50,204,179,27,150,241,63,54,97,98,185,164,195,105,48,125,188,141,33,182,133,168,222,39,159,177,168,2,136,248,189,132,235,102,114,213,132,137,37,150,40,39,152,205,136,101,217,132,137,37,41,103,9,152,74,210,114,77,164,149,168,199,160,57,251,103,13,17,57,155,103,144,31,35,232,190,90,36,202,198,47,238,32,137,57,207,232,136,210,62,52,43,206,214,13,144,24,54,116,228,221,42,160,13,161,207,196,157,135,215,231,236,90,52,159,85,95,176,27,241,194,145,234,123,246,60,18,132,116,214,23,113,4,92,116,47,255,171,201,223,24,164,254,61,11,179,104,83,18,164,243,57,255,225,36,10,159,161,125,48,8,77,131,100,19,8,140,115,216,69,67,97,52,133,185,46,186,14,99,39,11,55,192,7,194,21,9,107,97,34,138,167,130,252,129,1,55,211,111,12,239,195,180,82,139,49,225,85,87,14,196,13,180,23,198,52,13,117,211,107,208,209,26,139,48,43,231,153,131,173,103,33,12,97,9,176,202,96,41,197,52,210,42,167,165,182,156,215,198,174,137,35,202,166,244,99,195,58,75,105,211,53,219,21,165,34,152,125,247,210,11,80,179,193,124,217,229,251,51,112,104,26,90,36,241,160,248,209,155,41,15,229,16,4,79,215,166,21,10,28,7,77,242,73,53,120,225,132,220,94,87,118,11,246,156,195,152,9,42,152,207,59,2,14,50,136,11,225,187,1,253,124,221,102,123,162,120,200,23,148,125,209,252,125,224,19,118,32,94,240,208,255,148,221,91,5,34,199,186,221,97,135,114,105,151,211,238,125,9,246,171,201,250,1,41,118,130,155,56,13,102,128,120,248,31,73,0,0,0,99,100,100,98,96,102,96,97,98,100,96,96,98,96,97,100,117,201,79,46,205,77,205,43,97,96,99,228,168,103,96,96,224,100,224,1,81,64,0,166,4,24,132,24,24,24,25,192,154,24,20,129,250,88,157,19,243,202,18,139,113,40,231,103,4,105,16,102,48,130,136,1,0]),s.FIG_FILE_THUMBNAIL=new Uint8Array([102,105,103,45,107,105,119,105,1,0,0,0,208,10,0,0,141,24,123,127,227,70,113,87,118,156,199,229,30,125,80,74,41,165,148,82,74,129,114,87,74,41,165,180,149,45,217,86,34,75,170,36,231,113,148,186,138,45,199,106,100,201,104,101,95,114,208,239,206,204,142,94,78,14,126,228,143,104,231,177,243,218,153,217,89,127,57,10,133,8,46,67,255,102,21,50,182,119,100,27,214,196,243,85,215,103,240,103,217,154,62,233,13,85,107,160,123,0,242,177,167,187,13,88,145,220,186,165,193,186,229,25,3,75,53,97,213,246,252,115,83,135,197,142,92,76,60,29,101,117,106,201,19,239,216,112,38,174,110,218,42,238,220,85,175,35,1,194,206,80,227,57,170,81,167,83,48,10,80,174,174,106,19,219,50,17,203,36,112,234,26,62,202,230,86,58,11,157,69,32,192,104,165,7,36,95,215,136,105,100,159,200,37,63,141,146,89,148,92,186,235,24,121,44,219,122,170,187,54,242,216,154,86,74,32,175,95,2,34,10,101,154,221,27,143,116,11,237,229,61,213,58,81,165,151,3,215,30,59,232,98,223,85,71,200,215,238,218,182,169,171,214,196,118,116,87,245,13,219,66,111,79,244,158,111,187,232,42,122,137,142,153,134,20,187,167,155,166,225,120,184,220,119,129,9,194,39,227,115,224,234,131,177,169,186,19,199,54,207,7,82,200,61,80,101,105,186,54,105,242,29,250,250,25,154,116,223,51,141,30,34,30,120,231,163,174,141,177,126,104,88,160,204,146,216,71,221,56,76,102,35,240,138,177,87,28,213,243,38,254,16,196,13,134,116,146,238,72,158,14,215,84,247,88,71,93,202,104,108,250,134,35,131,219,66,83,193,146,238,216,69,82,187,103,155,118,5,237,152,198,96,232,203,61,29,15,98,45,87,187,197,14,205,214,6,210,73,218,82,130,251,112,10,174,169,162,236,3,207,238,251,19,41,3,61,28,170,174,86,65,135,154,209,239,235,174,78,30,220,215,207,122,230,216,163,120,62,24,142,17,247,208,83,253,113,21,228,71,82,11,44,94,50,199,35,195,178,61,195,71,21,47,59,65,148,228,116,152,29,207,54,13,153,11,3,87,213,12,56,205,9,153,138,206,87,40,252,202,120,40,21,10,194,141,167,129,209,168,112,192,52,178,101,126,183,141,145,42,61,219,49,150,80,46,222,52,136,67,138,53,228,187,171,251,61,25,230,190,33,115,167,111,152,82,182,111,200,3,108,233,243,121,56,45,236,107,27,150,5,85,228,13,85,205,62,149,73,231,218,78,13,242,190,13,105,33,211,96,210,53,199,104,142,210,85,123,199,219,168,150,31,94,231,61,153,253,109,219,53,6,6,149,30,27,59,144,145,40,197,180,79,229,2,76,240,201,6,220,161,133,211,52,11,242,40,77,0,81,38,61,38,156,91,164,42,7,95,140,99,189,78,28,197,90,47,47,194,108,156,68,57,20,100,203,85,165,201,142,113,166,155,178,35,128,186,30,21,140,210,75,19,145,103,245,65,236,192,1,33,51,210,201,168,145,138,53,174,212,241,106,121,61,85,90,215,246,242,44,189,10,213,56,186,68,211,170,45,12,242,219,208,164,101,246,216,47,150,10,49,247,130,21,40,41,189,144,225,145,30,124,61,86,93,201,166,186,174,125,42,15,31,77,109,17,168,127,61,54,76,232,22,110,209,171,164,168,163,52,66,181,35,163,208,218,213,79,116,89,44,165,84,165,155,166,113,24,36,246,42,44,227,215,30,91,148,147,96,35,108,243,160,96,165,250,113,215,119,85,185,86,206,236,234,172,164,103,195,52,139,158,167,73,30,196,176,221,212,251,254,118,120,220,162,40,148,163,177,231,27,125,67,182,177,122,247,73,152,229,209,20,247,182,124,219,217,222,218,181,125,223,30,201,162,78,215,34,236,173,51,145,102,80,11,154,222,87,161,202,37,179,107,123,144,101,134,228,215,207,117,76,59,74,22,5,26,186,84,229,168,224,10,84,125,239,88,182,236,182,163,83,99,131,220,77,179,81,148,101,40,179,202,155,178,61,113,185,128,242,129,178,214,173,129,47,211,70,11,196,130,202,67,233,65,243,67,254,250,216,185,44,161,162,28,28,107,128,212,35,71,31,200,248,157,224,71,113,180,190,44,156,235,85,154,229,183,51,171,213,179,193,113,48,181,76,31,86,34,78,13,77,234,231,37,98,168,151,65,53,131,155,116,157,15,178,104,86,8,185,147,158,181,129,138,12,250,58,79,221,80,68,207,195,134,211,82,129,244,181,146,204,107,29,94,126,19,135,94,88,22,0,132,215,179,139,202,244,117,117,36,13,131,179,165,147,234,187,144,139,208,249,100,255,245,245,145,99,187,170,123,78,73,73,98,192,239,60,172,156,190,211,215,100,36,139,174,4,170,131,233,21,69,188,50,118,8,173,225,41,4,130,26,63,52,100,223,232,81,211,147,220,189,116,13,242,179,162,232,218,255,79,185,226,182,163,181,200,163,249,205,255,218,225,168,61,125,2,53,68,55,119,107,48,6,195,185,34,224,82,135,210,129,245,46,227,113,10,169,44,151,208,56,98,72,44,222,206,216,62,227,151,240,79,185,128,127,173,0,254,181,41,247,96,243,53,18,111,144,232,2,10,184,107,196,51,228,94,32,183,148,228,229,233,10,54,76,165,212,46,227,171,84,68,178,100,129,117,20,228,89,116,205,120,103,249,248,49,238,95,62,126,130,232,229,227,143,80,198,242,9,34,219,203,39,136,220,89,62,65,100,199,9,50,56,3,35,153,133,176,79,185,92,71,51,246,85,67,232,189,178,69,2,113,19,196,235,16,197,174,101,187,124,29,206,24,78,208,10,150,33,227,173,121,176,140,226,27,224,231,2,143,23,55,130,144,92,76,179,104,149,3,116,39,215,65,96,142,39,255,152,241,82,176,210,141,211,11,198,249,197,77,30,10,214,226,84,72,76,105,193,32,180,64,56,65,93,32,121,22,228,129,228,221,133,170,150,194,148,67,41,236,1,227,101,96,148,116,21,76,163,28,67,216,218,68,34,186,0,163,56,107,95,84,83,196,33,219,17,16,75,193,134,188,3,38,37,98,158,102,75,118,196,118,35,169,245,132,237,201,133,191,0,255,147,32,138,1,179,31,109,95,142,143,216,65,150,230,65,17,254,123,2,9,176,56,148,151,17,216,200,148,221,233,34,200,130,41,228,161,192,216,84,144,172,1,67,19,108,23,18,7,215,246,38,204,160,120,67,63,64,67,115,222,138,101,65,123,88,159,26,152,13,151,97,28,37,16,150,111,248,206,101,124,179,90,8,246,45,239,204,170,27,79,176,239,248,110,183,224,98,74,187,58,65,72,205,103,209,44,199,4,82,144,118,142,1,193,197,48,140,46,23,57,102,196,0,229,193,158,105,186,92,6,201,76,20,161,229,13,25,100,164,76,232,214,28,78,93,218,5,91,27,87,174,162,100,144,186,130,245,57,175,153,21,202,112,10,70,107,35,1,43,204,159,165,217,85,169,37,129,176,7,49,200,155,21,206,254,151,128,96,153,57,1,56,162,112,76,83,193,190,226,220,187,89,94,164,113,33,93,72,0,212,66,2,211,186,148,33,96,191,2,89,139,39,44,79,175,31,200,186,219,103,149,212,81,176,90,193,56,13,94,20,21,128,154,102,80,236,112,98,96,153,20,231,134,243,16,170,101,10,241,221,153,71,113,120,28,82,194,215,122,21,80,136,77,96,136,9,11,73,143,134,54,164,11,182,224,237,50,187,119,104,108,98,74,71,166,238,203,205,212,157,207,69,152,67,40,90,89,48,139,214,2,35,93,231,240,78,51,135,59,84,87,208,78,115,169,0,194,176,158,207,161,9,128,97,81,117,15,125,200,160,97,84,149,231,194,64,92,93,23,76,217,147,250,63,98,60,192,151,138,2,78,84,170,90,201,122,233,129,145,50,193,118,88,187,48,12,218,135,32,108,145,7,157,203,117,142,89,77,208,110,233,200,30,157,151,242,172,241,86,217,67,63,183,242,76,193,167,74,111,17,36,88,235,63,148,45,8,191,126,112,9,244,63,173,228,67,168,3,29,5,23,132,252,100,213,104,92,38,107,53,64,98,248,179,244,234,128,181,241,75,168,79,139,254,177,131,95,66,253,165,246,181,83,44,137,240,25,116,240,171,112,6,248,93,90,17,250,175,117,87,217,43,150,68,248,188,121,40,251,21,64,196,191,77,241,46,130,197,129,92,16,242,11,65,233,126,15,191,132,250,178,217,135,14,43,128,136,95,205,32,169,32,160,16,103,232,54,252,126,3,36,6,53,144,87,186,116,146,179,7,53,68,228,238,5,220,110,151,25,24,48,211,19,44,42,116,238,225,29,36,49,247,150,129,184,2,250,35,252,18,74,11,203,14,142,183,182,176,19,104,247,156,189,116,23,75,236,58,238,52,132,189,206,101,71,226,236,229,45,4,49,245,107,245,118,21,216,87,238,32,137,121,0,173,38,9,51,183,44,137,87,155,48,177,12,27,189,233,71,229,154,72,6,100,72,112,153,5,171,5,38,73,130,73,252,218,45,20,49,30,85,88,15,181,39,120,101,255,248,54,142,88,143,69,30,100,70,2,70,120,69,235,127,125,27,67,108,230,50,130,83,50,35,248,0,203,79,106,136,200,35,33,167,244,211,178,31,191,209,132,137,197,202,225,70,241,225,234,184,34,123,126,218,132,137,197,94,84,227,119,227,146,125,131,189,249,34,60,109,113,68,227,89,242,38,251,89,3,36,134,175,69,245,20,121,139,189,85,1,68,116,69,253,184,120,155,253,188,134,136,236,229,47,120,23,188,203,222,126,1,154,54,248,249,157,167,192,123,236,23,119,144,196,60,206,203,23,226,171,236,157,114,77,164,147,124,251,41,248,26,251,229,54,134,216,78,47,110,191,121,222,97,239,222,198,17,235,217,166,208,189,21,216,95,221,197,18,251,57,220,13,177,28,75,4,59,227,239,213,16,145,159,82,164,42,134,95,55,97,98,249,123,227,126,182,216,251,53,68,228,111,230,229,220,229,176,223,148,107,34,253,35,47,71,143,167,236,131,114,77,164,111,67,121,223,8,22,243,223,22,75,34,76,160,245,206,96,162,145,47,32,204,175,15,216,239,110,161,136,241,187,112,251,174,73,248,239,183,49,196,22,228,219,207,139,143,217,135,219,24,98,187,136,171,59,72,176,21,255,67,3,36,134,233,166,158,29,46,216,227,26,34,242,172,158,50,158,20,75,34,132,117,255,232,21,23,209,71,183,80,196,56,199,163,25,132,233,50,204,179,27,150,241,63,54,97,98,185,164,195,105,48,125,188,141,33,182,133,168,222,39,159,177,168,2,136,248,189,132,235,102,114,213,132,137,37,150,40,39,152,205,136,101,217,132,137,37,41,103,9,152,74,210,114,77,164,149,168,199,160,57,251,103,13,17,57,155,103,144,31,35,232,190,90,36,202,198,47,238,32,137,57,207,232,136,210,62,52,43,206,214,13,144,24,54,116,228,221,42,160,13,161,207,196,157,135,215,231,236,90,52,159,85,95,176,27,241,194,145,234,123,246,60,18,132,116,214,23,113,4,92,116,47,255,171,201,223,24,164,254,61,11,179,104,83,18,164,243,57,255,225,36,10,159,161,125,48,8,77,131,100,19,8,140,115,216,69,67,97,52,133,185,46,186,14,99,39,11,55,192,7,194,21,9,107,97,34,138,167,130,252,129,1,55,211,111,12,239,195,180,82,139,49,225,85,87,14,196,13,180,23,198,52,13,117,211,107,208,209,26,139,48,43,231,153,131,173,103,33,12,97,9,176,202,96,41,197,52,210,42,167,165,182,156,215,198,174,137,35,202,166,244,99,195,58,75,105,211,53,219,21,165,34,152,125,247,210,11,80,179,193,124,217,229,251,51,112,104,26,90,36,241,160,248,209,155,41,15,229,16,4,79,215,166,21,10,28,7,77,242,73,53,120,225,132,220,94,87,118,11,246,156,195,152,9,42,152,207,59,2,14,50,136,11,225,187,1,253,124,221,102,123,162,120,200,23,148,125,209,252,125,224,19,118,32,94,240,208,255,148,221,91,5,34,199,186,221,97,135,114,105,151,211,238,125,9,246,171,201,250,1,41,118,130,155,56,13,102,128,120,248,31,76,0,0,0,99,100,100,98,96,102,96,97,98,100,96,96,98,96,97,100,117,201,79,46,205,77,205,43,97,96,99,228,168,103,96,96,224,100,224,1,81,64,0,166,4,24,132,24,24,24,25,192,154,24,20,129,250,88,157,19,243,202,18,139,113,40,231,103,4,105,16,102,48,2,11,177,49,48,0,0,3,0,0,0,1,2,3]),s.GIF_MULTI_IMAGE=new Uint8Array([71,73,70,56,57,97,2,0,2,0,241,0,0,0,0,0,255,255,255,255,0,0,0,255,0,33,255,11,78,69,84,83,67,65,80,69,50,46,48,3,1,0,0,0,33,249,4,4,50,0,0,0,44,0,0,0,0,2,0,2,0,0,2,2,12,94,0,44,1,0,0,0,1,0,1,0,0,2,2,84,1,0,33,249,4,4,50,0,0,0,44,1,0,0,0,1,0,1,0,0,2,2,76,1,0,44,1,0,1,0,1,0,1,0,0,2,2,84,1,0,33,249,4,4,50,0,0,0,44,1,0,1,0,1,0,1,0,0,2,2,76,1,0,44,0,0,1,0,1,0,1,0,0,2,2,84,1,0,33,249,4,4,50,0,0,0,44,0,0,1,0,1,0,1,0,0,2,2,76,1,0,59]),s.GIF_MALFORMED_END_NO_EOF=new Uint8Array([71,73,70,56,57,97,2,0,2,0,241,0,0,0,0,0,255,255,255,255,0,0,0,255,0,33,255,11,78,69,84,83,67,65,80,69,50,46,48,3,1,0,0,0,33,249,4,4,50,0,0,0,44,0,0,0,0,2,0,2,0,0,2,2,12,94,0,44,1,0,0,0,1,0,1,0,0,2,2,84,1,0,33,249,4,4,50,0,0,0,44,1,0,0,0,1,0,1,0,0,2,2,76,1,0,44,1,0,1,0,1,0,1,0,0,2,2,84,1,0,33,249,4,4,50,0,0,0,44,1,0,1,0,1,0,1,0,0,2,2,76,1,0,44,0,0,1,0,1,0,1,0,0,2,2,84,1,0,33,249,4,4,50,0,0,0,44,0,0,1,0,1,0,1,0,0,2,50,76,1,0]),s.GIF_SPEED=new Uint8Array([71,73,70,56,57,97,2,0,2,0,240,0,0,0,0,0,255,255,255,33,255,11,78,69,84,83,67,65,80,69,50,46,48,3,1,0,0,0,33,249,4,0,25,0,0,0,44,0,0,0,0,2,0,2,0,0,2,2,12,94,0,33,249,4,0,50,0,0,0,44,0,0,0,0,2,0,2,0,0,2,3,68,0,5,0,33,249,4,0,100,0,0,0,44,0,0,0,0,2,0,2,0,0,2,2,132,83,0,33,249,4,0,200,0,0,0,44,0,0,0,0,2,0,2,0,0,2,3,4,2,5,0,59]),s.GIF_D1_D3_D3_D3=new Uint8Array([71,73,70,56,57,97,4,0,4,0,240,0,0,0,0,0,255,0,0,33,249,4,5,100,0,0,0,33,255,11,78,69,84,83,67,65,80,69,50,46,48,3,1,0,0,0,33,255,11,73,109,97,103,101,77,97,103,105,99,107,13,103,97,109,109,97,61,48,46,52,53,52,53,53,0,44,0,0,0,0,4,0,4,0,0,2,5,76,0,134,203,80,0,33,249,4,13,100,0,0,0,33,255,11,73,109,97,103,101,77,97,103,105,99,107,13,103,97,109,109,97,61,48,46,52,53,52,53,53,0,44,0,0,0,0,4,0,4,0,128,0,0,0,0,255,0,2,5,4,18,134,198,92,0,33,249,4,13,100,0,0,0,33,255,11,73,109,97,103,101,77,97,103,105,99,107,13,103,97,109,109,97,61,48,46,52,53,52,53,53,0,44,0,0,0,0,4,0,4,0,128,0,0,0,0,0,255,2,5,132,143,17,166,5,0,33,249,4,13,100,0,0,0,33,255,11,73,109,97,103,101,77,97,103,105,99,107,13,103,97,109,109,97,61,48,46,52,53,52,53,53,0,44,0,0,0,0,4,0,4,0,128,0,0,0,255,0,255,2,5,132,111,17,185,80,0,59]),s.GIF_D3_D3_D3_D3=new Uint8Array([71,73,70,56,57,97,4,0,4,0,240,0,0,0,0,0,255,0,0,33,249,4,13,100,0,0,0,33,255,11,78,69,84,83,67,65,80,69,50,46,48,3,1,0,0,0,33,255,11,73,109,97,103,101,77,97,103,105,99,107,13,103,97,109,109,97,61,48,46,52,53,52,53,53,0,44,0,0,0,0,4,0,4,0,0,2,5,76,0,134,203,80,0,33,249,4,13,100,0,0,0,33,255,11,73,109,97,103,101,77,97,103,105,99,107,13,103,97,109,109,97,61,48,46,52,53,52,53,53,0,44,0,0,0,0,4,0,4,0,128,0,0,0,0,255,0,2,5,4,18,134,198,92,0,33,249,4,13,100,0,0,0,33,255,11,73,109,97,103,101,77,97,103,105,99,107,13,103,97,109,109,97,61,48,46,52,53,52,53,53,0,44,0,0,0,0,4,0,4,0,128,0,0,0,0,0,255,2,5,132,143,17,166,5,0,33,249,4,13,100,0,0,0,33,255,11,73,109,97,103,101,77,97,103,105,99,107,13,103,97,109,109,97,61,48,46,52,53,52,53,53,0,44,0,0,0,0,4,0,4,0,128,0,0,0,255,0,255,2,5,132,111,17,185,80,0,59])))(tm||(tm={}));var Nu=class{constructor(e,t){if(this._app=null,this._frameLoader=null,this._session=null,this._pendingNodeId=null,this._app=e,this._session=t,this._frameLoader=this._session.incrementalLoader(),this._frameLoader==null)throw new Error("Expected incremental frame loader for mirror mode");this._emitter=Kt.getEventEmitter(),this._pendingNodeId=null,this._emitter.on("incrementalLoadingInfo",n=>{n.type==="finishIncrementalLoading"&&this._handleIncrementalLoadFinished()})}hasPendingSelectionChange(){return this._pendingNodeId!==null}connectToFileAndShowNode(e,t,n,o,i,a){n!=null&&(this._app.state().prototypeState().mostRecentFixInvalidStateInitiator="Mirror.connectToFileAndShowNode",this._app.state().setActivePrototypeStartingPointNodeId(n)),this._session.fileKey()!=e?this._app.connectTo(e,t,n,o,i,a):this._app.state().currentFileKey()!=e?(this._frameLoader.requestTlf(t),this._pendingNodeId=t):this._frameLoader.requestTlf(t)?this._app.state().prototypeState().navigateToFrameAndCloseOverlays(t):this._pendingNodeId=t}_handleIncrementalLoadFinished(){var e;this._pendingNodeId!=null&&((e=this._app.state().scene())==null?void 0:e.findNode(this._pendingNodeId))!=null&&(this._app.state().prototypeState().navigateToFrameAndCloseOverlays(this._pendingNodeId),this._pendingNodeId=null)}};var Oc;(a=>{function r(s){return{x:Math.round(s.x()*100)/100,y:Math.round(s.y()*100)/100}}a._serialize=r;function e(s){return new b(s.x,s.y)}a._deserializeVector=e;function t(s,l){1&l&&(s.alt=!0),2&l&&(s.meta=!0),4&l&&(s.shift=!0),8&l&&(s.ctrl=!0),16&l&&(s.platform=!0)}a._setModifiers=t;function n(s){return("alt"in s?1:0)|("meta"in s?2:0)|("shift"in s?4:0)|("ctrl"in s?8:0)|("platform"in s?16:0)}a._loadModifiers=n;function o(s,l){let d=s.asMouseEvent();if(d!=null){let p={};return p.type=Hs[s.type()],p.at=r(l(d.locationInWindow)),d.locationInWindow.equals(d.previousLocationInWindow)||(p.lastAt=r(l(d.previousLocationInWindow))),d.clickCount!=0&&(p.clicks=d.clickCount),d.scrollDelta!=null&&(p.scroll=r(d.scrollDelta)),t(p,s.modifiers()),p}let c=s.asKeyEvent();if(c!=null){let p={};return p.type=Hs[s.type()],p.key=c.key,c.isRepeat&&(p.repeat=!0),t(p,s.modifiers()),p}return null}a.serialize=o;function i(s,l,d,c){let p=Ha.ViewerEventType_fromString(s.type);if(Ha.ViewerEventType_isMouseEventType(p)){let u=c(e(s.at)),_=l(u),h=u;"lastAt"in s&&(h=c(e(s.lastAt)));let S=null;"scroll"in s&&(S=e(s.scroll));let m=0;"clicks"in s&&(m=s.clicks);let f=n(s);return new Gs(p,_,f,u,h,S,m,[])}else if(Ha.ViewerEventType_isKeyEventType(p)){let u=d(),_=s.key|0,h=s.repeat,S=n(s);return new Vs(p,u,S,_,h)}else if(Ha.ViewerEventType_isTouchEventType(p)){let u=n(s),_=c(e(s.at)),h=l(_);if(p==11||p==12){let S=_;"lastAt"in s&&(S=c(e(s.lastAt)));let m=new Pl(0,h,_,S);return new Us(p,h,u,[m],[m])}else return new Us(p,h,u,[],[])}else if(Ha.ViewerEventType_isWindowEventType(p))throw new Error("Deserializing window events not supported");throw new Error(`Unrecognized event type in deserialize ${Hs[p]}`)}a.deserialize=i})(Oc||(Oc={}));var Ace=new pc(1/.05,1),Sce=uc.withDampingRatio(.5,100,1.1);var vb;(t=>{function r(n,o){return n(o)}t.call=r;function e(n){return n}t._new=e})(vb||(vb={}));var CA;(o=>{function r(i){e(i.map(a=>(s,l,d,c)=>{a(d,c)}))}o.createNewSceneAndRun=r;function e(i){let a=new jt,s=nt.createSceneWithCanvasForTests1(),l=s.root().childAt1(0),d=ar(l,"source",O.BLACK);d.setRelativeTransform(new J(1,0,0,0,1,400)),d.setSize(new b(500,700));let c=ar(l,"dst",O.BLACK);c.setRelativeTransform(new J(1,0,0,0,1,1100)),c.setSize(new b(500,700)),a.setActiveCanvas(l),a.setScene(s);for(let p of i)p(a,s,d,c)}o.createNewAppStateAndSceneAndRun=e;function t(){let i=AssertLib.deepStrictEqual,a=new sl("./src/test/protomagicmove.test.ts");beforeEach(()=>{Y.setViewerMode(Y.ViewerMode.PROTOTYPE)}),At("getNodeMatches",()=>{let s=(l,d,c)=>{let p=Po.getNodeMatches(l,d);for(let u of c){let _=u[0],h=u[1],S=Ge.StringMap_get(p,_.id(),null),m=Ge.StringMap_get(p,h.id(),null);i(S,h,`Expected ${_.id()} to match ${h.id()}, but got ${S==null?null:S.id()} instead.`),i(m,_,`Expected ${h.id()} to match ${_.id()}, but got ${m==null?null:m.id()} instead.`)}i(p.size,c.length*2)};me("simple match case",()=>{let d=nt.createSceneWithCanvasForTests1().root().childAt1(0),c=qe(d,"src"),p=Xe(c,"A"),u=Xe(c,"B"),_=Xe(c,"C"),h=qe(d,"dst"),S=Xe(h,"A"),m=Xe(h,"B"),f=Xe(h,"C");s(c,h,[[p,S],[u,m],[_,f]])}),me("crossed match case",()=>{let d=nt.createSceneWithCanvasForTests1().root().childAt1(0),c=qe(d,"src"),p=Xe(c,"A"),u=Xe(c,"B"),_=qe(d,"dst"),h=Xe(_,"B"),S=Xe(_,"A");s(c,_,[[p,S],[u,h]])}),me("duplicate names",()=>{let d=nt.createSceneWithCanvasForTests1().root().childAt1(0),c=qe(d,"src"),p=Xe(c,"A"),u=Xe(c,"A");Xe(c,"A");let _=qe(d,"dst"),h=Xe(_,"A"),S=Xe(_,"A");s(c,_,[[p,h],[u,S]])}),me("recursive matches",()=>{let d=nt.createSceneWithCanvasForTests1().root().childAt1(0),c=qe(d,"src"),p=qe(d,"dst"),u=Xe(c,"A"),_=Xe(u,"A"),h=Xe(u,"B"),S=Xe(c,"B");Xe(S,"A"),Xe(S,"B");let m=Xe(c,"C");Xe(m,"A"),Xe(m,"B");let f=Xe(p,"A"),T=Xe(f,"A"),y=Xe(f,"B"),E=Xe(p,"B");Xe(E,"C"),Xe(E,"D");let v=Xe(p,"D");Xe(v,"A"),Xe(v,"B"),s(c,p,[[u,f],[_,T],[h,y],[S,E]])}),me("hidden and transparent nodes",()=>{let d=nt.createSceneWithCanvasForTests1().root().childAt1(0),c=qe(d,"src"),p=Xe(c,"A");Xe(c,"B");let u=Xe(c,"C"),_=Xe(c,"D");p.setVisible(!1),u.setOpacity(0);let h=qe(d,"dst");Xe(h,"A");let S=Xe(h,"B"),m=Xe(h,"C"),f=Xe(h,"D");S.setVisible(!1),_.setOpacity(0),s(c,h,[[u,m],[_,f]])}),me("boolean op nodes",()=>{let d=nt.createSceneWithCanvasForTests1().root().childAt1(0),c=qe(d,"src"),p=kl(c);p.setName("booleanOp"),Xe(p,"A"),Xe(p,"B");let u=qe(d,"dst"),_=kl(u);_.setName("booleanOp"),Xe(_,"A"),Xe(_,"B"),s(c,u,[[p,_]])})}),me("Smart animate of fixed elements",()=>{let s=new b(100,100),l=new b(10,10),d=new jt,c=nt.createSceneWithCanvasForTests1(),p=c.root().childAt1(0);p.setPrototypeDevice(new sn("CUSTOM",s,null,"NONE")),p.setCurrentViewportSize(s),d.setActiveCanvas(p),d.setScene(c);let u=(m,f)=>{let T=et(p);T.setSize(new b(m,f)),T.setUsedAsBaseScreen(!0);let y=vn(T);return y.setSize(new b(10,10)),y.setRelativeTransform(new J(1,0,0,0,1,f-l.y())),y.setVerticalConstraint("MAX"),y.setScrollBehavior("FIXED_WHEN_CHILD_OF_SCROLLING_FRAME"),T},_=u(100,200),h=u(100,100);Js(_,h);let S=gc.buildStrategy(_.childAt1(0),h.childAt1(0));i(S.transition.from().transform1().translation().y(),s.y()-l.y()),i(S.transition.to().transform1().translation().y(),s.y()-l.y())}),At("interpolation strategies",()=>{let s=(l,d)=>{let c=gc.buildStrategy(l,d);xi(c.isDissolve)};me("dissolve discrete properties",()=>{[(d,c)=>{let p=ie(d,"A");p.setBlendMode("NORMAL");let u=ie(c,"A");u.setBlendMode("MULTIPLY"),s(p,u)},(d,c)=>{let p=Gv(d,"B"),u=ie(c,"B");s(p,u)},(d,c)=>{let p=ar(d,"C",O.TRANSPARENT);ie(p,"C_content");let u=Ea(c,"C");ie(u,"C_content"),s(p,u)},(d,c)=>{d.setOverflowDirection("VERTICAL"),c.setOverflowDirection("VERTICAL");let p=ie(d,"D");p.setScrollBehavior("SCROLLS");let u=ie(c,"D");u.setScrollBehavior("FIXED_WHEN_CHILD_OF_SCROLLING_FRAME"),s(p,u)}].forEach(d=>{r([d])})}),me("interpolate effects and paints",()=>{let l=$.createLinearGradient([new je(O.RED,0),new je(O.TRANSPARENT,.5)]);[(c,p)=>{let u=y_(c,"A",[l]),_=ie(p,"A");s(u,_)},(c,p)=>{let u=ie(c,"B");u.setTestOnlyEffects([]);let _=ie(p,"B");_.setTestOnlyEffects([Re.createForegroundBlur(1)]),s(u,_)},(c,p)=>{let u=ie(c,"C");u.setTestOnlyEffects([Re.createForegroundBlur(1)]);let _=ie(p,"C");_.setTestOnlyEffects([Re.createDropShadow(1,new b(1,1),O.BLACK,1)]),s(u,_)},(c,p)=>{let u=ie(c,"D"),_=[Re.createForegroundBlur(1),Re.createDropShadow(1,new b(1,1),O.BLACK,1)];u.setTestOnlyEffects(_);let h=ie(p,"D"),S=_.slice();S[0].setIsEnabled(!1),h.setTestOnlyEffects(S),s(u,h)},(c,p)=>{let u=ie(c,"E"),_=[l,$.createSolid(O.RED,1)];u.setTestOnlyFillPaints(_);let h=ie(p,"E"),S=_.slice();S[0].setIsEnabled(!1),h.setTestOnlyFillPaints(S),s(u,h)}].forEach(c=>{r([c])})}),me("interpolate geometry",()=>{let l=(c,p,u)=>{let _=Xe(c,p);_.setTestOnlyFillPaints([$.createSolid(O.BLACK,1)]);let h=u.topLeft().x(),S=u.topLeft().y(),m=u.width(),f=u.height(),T=new Dr("NONZERO",0,Rt.new2().moveTo1(h,S).lineTo(h+m,S).lineTo(h+m,S+f).lineTo(h,S+f-1).close(),u),y=new wr([T],null,T.bounds(),null);return _.setTestOnlyFillPaints([$.createSolid(O.RED,1)]),_.setTestOnlyFillGeometry(y),_.setTestOnlyStrokeGeometry(y),He(_,u.topLeft(),u.size()),_};[(c,p)=>{let u=l(c,"A",new G(0,0,100,100)),_=Ft(p,"A",O.RED,1);s(u,_)}].forEach(c=>{r([c])})})}),At("magic move",()=>{let s=(p,u,_)=>{ll(p,()=>{let h=[];return u.forEach(S=>{r([_,(m,f)=>{let T=new J(1,0,0,0,1,700),y=yt.FrozenAffineTransform_IDENTITY,E=Po.getMagicMovePlan2(m,T,f,y,Tr.get(S));h.push(a.asyncAssertMatchesSnapshot(`plan ${S}`,E.debugString()));let v=()=>0,A=Vn.makeEasingFunction([0,0,1,1],.3),I=new Ai(E,v,A);h.push(a.asyncAssertMatchesSnapshot(`render tree ${S}`,I.renderTree().debugString1()))}])}),Promise.all(h)})},l=["DISSOLVE","SLIDE_FROM_RIGHT","PUSH_FROM_RIGHT","MOVE_FROM_RIGHT","SLIDE_OUT_TO_RIGHT","MOVE_OUT_TO_RIGHT"],d=["DISSOLVE","MOVE_FROM_RIGHT","MOVE_OUT_TO_RIGHT"],c=["DISSOLVE"];s("identical rectangles",c,(p,u)=>{ie(p,"rect"),ie(u,"rect")}),s("rectangles with different opacities",c,(p,u)=>{ie(p,"rect").setOpacity(.9),ie(u,"rect").setOpacity(.1)}),s("rectangles with changing and unchanging paints",c,(p,u)=>{y_(p,"rect",[$.createSolid(O.RED,1),$.createSolid(O.GREEN,1)]),y_(u,"rect",[$.createSolid(O.BLUE,1),$.createSolid(O.GREEN,1)])}),s("rectangles with different translations",c,(p,u)=>{ie(p,"rect").setRelativeTransform(new J(1,0,30,0,1,50)),ie(u,"rect").setRelativeTransform(new J(1,0,130,0,1,250))}),s("rectangles with different rotation",c,(p,u)=>{let _=ie(p,"rect");_.setRelativeTransform(new J(1,0,30,0,1,50));let h=ie(u,"rect"),S=J.new3(_.relativeTransform());S.rotatedBy(Math.PI/4),h.setRelativeTransform(S)}),s("rectangles with different scale",c,(p,u)=>{let _=ie(p,"rect");_.setRelativeTransform(new J(1,0,30,0,1,50));let h=ie(u,"rect"),S=J.new3(_.relativeTransform());S.scaledBy1(new b(2,3)),h.setRelativeTransform(S)}),s("insertion of new rectangle",c,(p,u)=>{ie(u,"rect")}),s("deletion of old rectangle",c,(p,u)=>{ie(p,"rect")}),s("rectangles with mismatched names",c,(p,u)=>{ie(p,"A"),ie(u,"B")}),s("hidden and never-visible rectangles",c,(p,u)=>{let _=ie(p,"hidden"),h=ie(p,"neverVisible");_.setVisible(!1),h.setOpacity(0);let S=ie(u,"hidden"),m=ie(u,"neverVisible");S.setVisible(!1),m.setOpacity(0)}),s("hidden and transparent and no match nodes to visible nodes",c,(p,u)=>{let _=ie(p,"hidden"),h=ie(p,"transparent");_.setVisible(!1),h.setOpacity(0),ie(u,"hidden"),ie(u,"transparent"),ie(u,"noMatch")}),s("visible nodes to hidden and transparent and no match nodes",c,(p,u)=>{ie(p,"hidden"),ie(p,"transparent"),ie(p,"noMatch");let _=ie(u,"hidden"),h=ie(u,"transparent");_.setVisible(!1),h.setOpacity(0)}),s("matching boolean op nodes",c,(p,u)=>{let _=kl(p);_.setName("booleanOp"),Xe(_,"A"),Xe(_,"B");let h=kl(u);h.setName("booleanOp"),Xe(h,"A"),Xe(h,"B")}),s("simple matching with layer re-ordering",c,(p,u)=>{ie(p,"A"),ie(p,"B"),ie(u,"B"),ie(u,"A")}),s("simple insertion, deletion, and matching",l,(p,u)=>{ie(p,"A"),ie(p,"B"),ie(u,"C"),ie(u,"B")}),s("complex layer re-ordering with insertions and removals",d,(p,u)=>{ie(p,"A"),ie(p,"B"),ie(p,"C"),ie(p,"D"),ie(p,"E"),ie(p,"F"),ie(p,"G"),ie(p,"H"),ie(u,"1"),ie(u,"2"),ie(u,"F"),ie(u,"3"),ie(u,"4"),ie(u,"C"),ie(u,"5"),ie(u,"6")}),s("complex matching case with no nesting",c,(p,u)=>{ie(p,"A"),ie(p,"B"),ie(p,"C"),ie(p,"E"),ie(u,"X"),ie(u,"Y"),ie(u,"B"),ie(u,"Z"),ie(u,"E"),ie(u,"F")}),s("simple nested matching",c,(p,u)=>{let _=qe(p,"F");qe(_,"rect");let h=qe(u,"F");qe(h,"rect").setOpacity(.5)}),s("nested insertions/removals",d,(p,u)=>{let _=qe(p,"A");ie(_,"rectA");let h=qe(u,"B");ie(h,"rectB")}),s("dissolving between different sized objects",c,(p,u)=>{ie(p,"A").setSize(new b(100,100)),ie(u,"A").setSize(new b(200,200))}),s("dissolving between non-uniformly scaling frames with children",c,(p,u)=>{let _=qe(p,"A");_.setSize(new b(150,1)),Ft(_,"rect",O.RED,1).setSize(new b(100,100)),Ft(_,"rect",O.RED,1).setSize(new b(100,100));let m=qe(u,"A");m.setSize(new b(300,300)),Ft(m,"rect",O.RED,1).setSize(new b(100,100)),Ft(m,"rect",O.RED,1).setSize(new b(100,100))}),s("dissolving between background blur objects",c,(p,u)=>{let _=Object({viewer_background_blur_opts:!1});Y.updateFeatureFlags(_),Ft(p,"A",O.RED,.5).setTestOnlyEffects([Re.createBackgroundBlur(1)]),Ft(u,"A",O.BLUE,.5).setTestOnlyEffects([Re.createBackgroundBlur(1)])}),s("dissolving between background blur objects with a background blur behind",c,(p,u)=>{let _=Object({viewer_background_blur_opts:!1});Y.updateFeatureFlags(_),Ft(p,"BG",O.RED,.5).setTestOnlyEffects([Re.createBackgroundBlur(1)]),Ft(u,"BG",O.RED,.5).setTestOnlyEffects([Re.createBackgroundBlur(1)]),Ft(p,"A",O.RED,.5).setTestOnlyEffects([Re.createBackgroundBlur(1)]),Ft(u,"A",O.BLUE,.5).setTestOnlyEffects([Re.createBackgroundBlur(1)])}),s("translating a background blur contained in a frame with clip-content enabled",c,(p,u)=>{let _=Object({viewer_background_blur_opts:!1});Y.updateFeatureFlags(_);let h=qe(p,"A");h.setIsFrameMaskDisabled(!0);let S=qe(h,"B");Ft(S,"BG",O.RED,.5).setTestOnlyEffects([Re.createBackgroundBlur(1)]);let f=qe(u,"A");f.setIsFrameMaskDisabled(!0);let T=J.new3(f.relativeTransform());T.translatedBy2(10,10),f.setRelativeTransform(T);let y=qe(f,"B");Ft(y,"BG",O.RED,.5).setTestOnlyEffects([Re.createBackgroundBlur(1)])}),s("translating a node with a background blur",c,(p,u)=>{Ft(p,"BG",O.RED,.5).setTestOnlyEffects([Re.createBackgroundBlur(1)]);let h=Ft(u,"BG",O.RED,.5);h.setTestOnlyEffects([Re.createBackgroundBlur(1)]);let S=J.new3(h.relativeTransform());S.translatedBy2(10,10),h.setRelativeTransform(S)}),s("dissolving + scaling between nodes with unmatched children",c,(p,u)=>{let _=ar(p,"F",O.RED);_.setSize(new b(100,100)),ie(_,"rect"),qe(u,"F").setSize(new b(200,200))}),s("dissolve only between nodes with unmatched children",c,(p,u)=>{let _=ar(p,"F",O.RED);_.setSize(new b(100,100)),ie(_,"rect"),Dv(u,"F").setSize(new b(100,100))}),s("dissolving between visible top frame to invisibile top frame",c,(p,u)=>{let _=new $("SOLID");_.setColor(O.RED),_.setOpacity(1),_.setIsEnabled(!0),p.setTestOnlyFillPaints([_]),_.setOpacity(0),u.setTestOnlyFillPaints([_])}),s("dissolving between different opacity objects",c,(p,u)=>{let _=ie(p,"A");_.setOpacity(1),_.setBlendMode("MULTIPLY");let h=ie(u,"A");h.setOpacity(.5),h.setBlendMode("NORMAL")}),s("dissolving between invisible node to visible node",c,(p,u)=>{Ft(p,"A",O.RED,0),Ft(u,"A",O.BLUE,.5)}),s("interpolating between two solid color paints",c,(p,u)=>{Ft(p,"A",O.RED,1),Ft(u,"A",O.BLUE,1)}),s("drop shadow: node rotates",c,(p,u)=>{let _=ie(p,"rect");_.setTestOnlyEffects([Re.createDropShadow(1,fe.FrozenVector_new4(1,1),O.BLACK,.5)]),_.setRelativeTransform(new J(1,0,30,0,1,50));let h=ie(u,"rect");h.setTestOnlyEffects([Re.createDropShadow(1,fe.FrozenVector_new4(1,1),O.BLACK,.5)]);let S=J.new3(_.relativeTransform());S.rotatedBy(Math.PI/4),h.setRelativeTransform(S)}),s("inner shadow: node rotates",c,(p,u)=>{let _=ie(p,"rect");_.setTestOnlyEffects([Re.createInnerShadow(1,fe.FrozenVector_new4(1,1),O.BLACK,.5)]),_.setRelativeTransform(new J(1,0,30,0,1,50));let h=ie(u,"rect");h.setTestOnlyEffects([Re.createInnerShadow(1,fe.FrozenVector_new4(1,1),O.BLACK,.5)]);let S=J.new3(_.relativeTransform());S.rotatedBy(Math.PI/4),h.setRelativeTransform(S)}),s("drop shadow: group shadow where group rotates and children are static",c,(p,u)=>{let _=ar(p,"F",O.TRANSPARENT);_.setIsBackgroundEnabled(!1),ie(_,"rectA").setRelativeTransform(J.new2()),ie(_,"rectB").setRelativeTransform(new J(1,0,50,0,1,0)),_.setRelativeTransform(new J(1,0,30,0,1,50)),_.setTestOnlyEffects([Re.createDropShadow(1,fe.FrozenVector_new4(1,1),O.BLACK,.5)]);let m=ar(u,"F",O.TRANSPARENT);m.setIsBackgroundEnabled(!1),ie(m,"rectA").setRelativeTransform(J.new2()),ie(m,"rectB").setRelativeTransform(new J(1,0,50,0,1,0));let y=J.new3(_.relativeTransform());y.rotatedBy(Math.PI/4),m.setRelativeTransform(y),m.setTestOnlyEffects([Re.createDropShadow(1,fe.FrozenVector_new4(1,1),O.BLACK,.5)])}),s("drop shadow: group shadow where group is static and children rotate",c,(p,u)=>{let _=ar(p,"F",O.TRANSPARENT);_.setIsBackgroundEnabled(!1),ie(_,"rectA").setRelativeTransform(J.new2()),ie(_,"rectB").setRelativeTransform(new J(1,0,50,0,1,0)),_.setRelativeTransform(new J(1,0,30,0,1,50)),_.setTestOnlyEffects([Re.createDropShadow(1,fe.FrozenVector_new4(1,1),O.BLACK,.5)]);let m=ar(u,"F",O.TRANSPARENT);m.setIsBackgroundEnabled(!1);let f=ie(m,"rectA");f.setRelativeTransform(J.new2());let T=ie(m,"rectB");T.setRelativeTransform(new J(1,0,50,0,1,0));let y=J.new3(f.relativeTransform());y.rotatedBy(Math.PI/4),f.setRelativeTransform(y);let E=J.new3(T.relativeTransform());E.rotatedBy(Math.PI/4),T.setRelativeTransform(E),m.setTestOnlyEffects([Re.createDropShadow(1,fe.FrozenVector_new4(1,1),O.BLACK,.5)])}),s("drop shadow: complex group shadow with nested groups and mixed transitions",c,(p,u)=>{let _=ar(p,"staticGroup1",O.TRANSPARENT);_.setIsBackgroundEnabled(!1),_.setRelativeTransform(new J(1,0,30,0,1,50)),_.setTestOnlyEffects([Re.createDropShadow(1,fe.FrozenVector_new4(1,1),O.BLACK,.5)]),ie(_,"staticRectZ").setRelativeTransform(J.new2());let S=ar(_,"rotatingGroup2",O.TRANSPARENT);S.setIsBackgroundEnabled(!1),ie(S,"rotatingRectA").setRelativeTransform(J.new2()),ie(S,"staticRectB").setRelativeTransform(new J(1,0,50,0,1,0));let T=ar(u,"staticGroup1",O.TRANSPARENT);T.setIsBackgroundEnabled(!1),T.setRelativeTransform(new J(1,0,30,0,1,50)),T.setTestOnlyEffects([Re.createDropShadow(1,fe.FrozenVector_new4(1,1),O.BLACK,.5)]),ie(T,"staticRectZ").setRelativeTransform(J.new2());let E=ar(T,"rotatingGroup2",O.TRANSPARENT);E.setIsBackgroundEnabled(!1),E.setRelativeTransform(J.new2().rotatedBy(Math.PI/4)),ie(E,"rotatingRectA").setRelativeTransform(J.new2().rotatedBy(Math.PI/3)),ie(E,"staticRectB").setRelativeTransform(new J(1,0,50,0,1,0))}),s("inner shadow: complex group shadow with nested groups and mixed transitions",c,(p,u)=>{let _=ar(p,"staticGroup1",O.TRANSPARENT);_.setIsBackgroundEnabled(!1),_.setRelativeTransform(new J(1,0,30,0,1,50)),_.setTestOnlyEffects([Re.createInnerShadow(1,fe.FrozenVector_new4(1,1),O.BLACK,.5)]),ie(_,"staticRectZ").setRelativeTransform(J.new2());let S=ar(_,"rotatingGroup2",O.TRANSPARENT);S.setIsBackgroundEnabled(!1),ie(S,"rotatingRectA").setRelativeTransform(J.new2()),ie(S,"staticRectB").setRelativeTransform(new J(1,0,50,0,1,0));let T=ar(u,"staticGroup1",O.TRANSPARENT);T.setIsBackgroundEnabled(!1),T.setRelativeTransform(new J(1,0,30,0,1,50)),T.setTestOnlyEffects([Re.createInnerShadow(1,fe.FrozenVector_new4(1,1),O.BLACK,.5)]),ie(T,"staticRectZ").setRelativeTransform(J.new2());let E=ar(T,"rotatingGroup2",O.TRANSPARENT);E.setIsBackgroundEnabled(!1),E.setRelativeTransform(J.new2().rotatedBy(Math.PI/4)),ie(E,"rotatingRectA").setRelativeTransform(J.new2().rotatedBy(Math.PI/3)),ie(E,"staticRectB").setRelativeTransform(new J(1,0,50,0,1,0))}),s("drop shadow: no node change but parent rotates",c,(p,u)=>{let _=qe(p,"F");ie(_,"rect").setTestOnlyEffects([Re.createDropShadow(1,fe.FrozenVector_new4(1,1),O.BLACK,.5)]),_.setRelativeTransform(new J(1,0,30,0,1,50));let S=ie(u,"F");ie(S,"rect").setTestOnlyEffects([Re.createDropShadow(1,fe.FrozenVector_new4(1,1),O.BLACK,.5)]);let f=J.new3(_.relativeTransform());f.rotatedBy(Math.PI/4),S.setRelativeTransform(f)}),s("drop shadow: no node change but parent translates/resizes",c,(p,u)=>{let _=qe(p,"F");ie(_,"rect").setTestOnlyEffects([Re.createDropShadow(1,fe.FrozenVector_new4(1,1),O.BLACK,.5)]),_.setRelativeTransform(new J(1,0,30,0,1,50)),_.setSize(new b(100,100));let S=qe(u,"F");ie(S,"rect").setTestOnlyEffects([Re.createDropShadow(1,fe.FrozenVector_new4(1,1),O.BLACK,.5)]);let f=J.new3(_.relativeTransform());f.translate1(fe.FrozenVector_new4(1,1)),S.setRelativeTransform(f),S.setSize(new b(100,200))}),s("transition between scrolling frames",d,(p,u)=>{p.setOverflowDirection("VERTICAL"),p.setTestOnlyFillPaints([$.createSolid(O.RED,1)]),p.setTestOnlyEffects([Re.createDropShadow(1,new b(1,1),O.BLACK,1)]),u.setTestOnlyFillPaints([$.createSolid(O.BLUE,1)]),u.setTestOnlyEffects([Re.createDropShadow(1,new b(1,1),O.BLACK,1)]);let _=Ft(p,"rect",O.GREEN,1);_.setSize(new b(p.size().x(),p.size().y()+100)),Ft(u,"rect",O.GREEN,1).setSize(_.size())}),s("scaling nodes whose children have different scaling factors",c,(p,u)=>{let _=qe(p,"subframe");_.setSize(new b(100,100)),ie(_,"rect").setSize(new b(50,50));let S=qe(u,"subframe");S.setSize(new b(200,200)),ie(S,"rect").setSize(new b(50,50))}),s("deeply nested scaling nodes whose children have different scaling factors",c,(p,u)=>{let _=qe(p,"A");_.setSize(new b(100,100));let h=ar(_,"B",O.RED);h.setSize(new b(50,50)),ar(h,"C",O.BLACK).setSize(new b(10,10));let m=qe(u,"A");m.setSize(new b(200,200));let f=ie(m,"B");f.setSize(new b(50,50)),ar(f,"C",O.BLACK).setSize(new b(10,10))}),s("transition between two screens with masks",c,(p,u)=>{let _=ie(p,"mask");_.setSize(new b(50,50)),_.setIsMask(!0),ie(p,"color").setSize(new b(100,100)),Xe(u,"andrew");let S=ie(u,"mask");S.setRelativeTransform(new J(1,0,10,0,1,10)),S.setSize(new b(50,50)),S.setIsMask(!0),ie(u,"color").setSize(new b(100,100))}),s("MOVE_IN with unmatched layers nested inside of matched layers",["MOVE_FROM_RIGHT"],(p,u)=>{let _=qe(p,"A");Ft(_,"A_1",O.BLUE,1);let h=qe(u,"A");Ft(h,"A_2",O.GREEN,1)}),s("MOVE_IN with unmatched layers nested inside of matched fixed layers",["MOVE_FROM_RIGHT"],(p,u)=>{let _=qe(p,"A");_.setScrollBehavior("FIXED_WHEN_CHILD_OF_SCROLLING_FRAME"),Ft(_,"A_1",O.BLUE,1);let h=qe(u,"A");Ft(h,"A_2",O.GREEN,1)}),s("dissolving image fills with different geometries should separate into masks",c,(p,u)=>{qf(p,"tri",new b(100,100)),qf(u,"tri",new b(50,100))}),s("dissolving non-image fills with different geometries should NOT separate into masks",c,(p,u)=>{Zf(p,"rect",O.RED,1,new b(100,100)),Zf(u,"rect",O.GREEN,1,new b(50,100))}),ll("non-image rects with different geometries interpolate rounded rectangle parameters",()=>{let p=[];return c.forEach(u=>{r([(_,h)=>{Ln(_,"rect",O.RED,1,new b(100,100)),Ln(h,"rect",O.GREEN,1,new b(50,100));let S=new J(1,0,0,0,1,700),m=yt.FrozenAffineTransform_IDENTITY,f=Po.getMagicMovePlan2(_,S,h,m,Tr.get(u));p.push(a.asyncAssertMatchesSnapshot(`plan ${u}`,f.debugString()));let T=()=>0,y=Vn.makeEasingFunction([0,0,1,1],.3),E=new Ai(f,T,y);p.push(a.asyncAssertMatchesSnapshot(`render tree ${u}`,E.renderTree().debugString1()))}])}),Promise.all(p)}),ll("non-image rects with different geometries and different effect spreads interpolate rounded rectangle + effect parameters",()=>{let p=[];return c.forEach(u=>{r([(_,h)=>{Ln(_,"rect",O.RED,1,new b(100,100)).setTestOnlyEffects([Re.createDropShadow(1,new b(5,5),O.BLACK,.5,10)]),Ln(h,"rect",O.GREEN,1,new b(50,100)).setTestOnlyEffects([Re.createDropShadow(1,new b(5,5),O.BLACK,.5,10)]);let f=new J(1,0,0,0,1,700),T=yt.FrozenAffineTransform_IDENTITY,y=Po.getMagicMovePlan2(_,f,h,T,Tr.get(u));p.push(a.asyncAssertMatchesSnapshot(`plan ${u}`,y.debugString()));let E=()=>0,v=Vn.makeEasingFunction([0,0,1,1],.3),A=new Ai(y,E,v);p.push(a.asyncAssertMatchesSnapshot(`render tree ${u}`,A.renderTree().debugString1()))}])}),Promise.all(p)}),s("dissolving image rects with different geometries: render good-enough identical shadows for now",c,(p,u)=>{let _=[Re.createDropShadow(1,new b(5,5),O.BLACK,.5)];Pd(p,"rect",new b(100,100)).setTestOnlyEffects(_),Pd(u,"rect",new b(50,100)).setTestOnlyEffects(_)}),s("dissolving image rects with different geometries: non-identical shadows fall back to dissolve for now",c,(p,u)=>{Pd(p,"rect",new b(100,100)).setTestOnlyEffects([Re.createDropShadow(1,new b(5,5),O.BLACK,.5)]),Pd(u,"rect",new b(50,100)).setTestOnlyEffects([Re.createDropShadow(5,new b(5,5),O.BLACK,.5)])}),s("groups with drop shadows and moving children",c,(p,u)=>{let _=Ea(p,"G");Ln(_,"A",O.RED,1,new b(10,10)),Ln(_,"B",O.GREEN,1,new b(10,10)),_.setTestOnlyEffects([Re.createDropShadow(1,fe.FrozenVector_new4(1,1),O.BLACK,.5)]);let h=Ea(u,"G");h.setTestOnlyEffects([Re.createDropShadow(1,fe.FrozenVector_new4(1,1),O.BLACK,.5)]),Ln(h,"A",O.RED,1,new b(10,10)).setRelativeTransform(new J(1,0,20,0,1,30)),Ln(h,"B",O.GREEN,1,new b(10,10)).setRelativeTransform(new J(1,0,50,0,1,100))}),s("resizing resize-to-fit-groups without background paints",c,(p,u)=>{let _=Ea(p,"G");Ln(_,"A",O.RED,1,new b(10,10)).setRelativeTransform(new J(1,0,0,0,1,0)),Ln(_,"B",O.GREEN,1,new b(10,10)).setRelativeTransform(new J(1,0,10,0,1,30)),_.setSize(new b(20,40));let m=Ea(u,"G");Ln(m,"A",O.RED,1,new b(10,10)).setRelativeTransform(new J(1,0,0,0,1,0)),Ln(m,"B",O.GREEN,1,new b(10,10)).setRelativeTransform(new J(1,0,20,0,1,30)),m.setSize(new b(30,40))}),s("resizing resize-to-fit-groups with background paints",c,(p,u)=>{let _=[$.createSolid(O.RED,1)],h=Ea(p,"G");h.setTestOnlyFillPaints(_),Ln(h,"A",O.RED,1,new b(10,10)).setRelativeTransform(new J(1,0,0,0,1,0)),Ln(h,"B",O.GREEN,1,new b(10,10)).setRelativeTransform(new J(1,0,10,0,1,30)),h.setSize(new b(20,40));let f=Ea(u,"G");f.setTestOnlyFillPaints(_),Ln(f,"A",O.RED,1,new b(10,10)).setRelativeTransform(new J(1,0,0,0,1,0)),Ln(f,"B",O.GREEN,1,new b(10,10)).setRelativeTransform(new J(1,0,20,0,1,30)),f.setSize(new b(30,40))}),s("transition between symbols with new frame properties",c,(p,u)=>{p.setType("SYMBOL"),p.setTestOnlyFillPaints(p.fillPaints()),u.setType("SYMBOL"),u.setTestOnlyFillPaints([$.createSolid(O.RED,1)])}),s("Smart animate frames with reverse z-index",["SMART_ANIMATE"],(p,u)=>{let _=h=>{h.setStackReverseZIndex(!0),h.setStackMode("HORIZONTAL");let S=Ft(h,"A",O.RED,.5);S.setSize(new b(20,20)),S.setRelativeTransform(new J(1,0,0,0,1,0));let m=Ft(h,"B",O.BLUE,.5);m.setSize(new b(20,20)),m.setRelativeTransform(new J(1,0,10,0,1,0))};_(p),_(u)})})}o.testMagicMove=t;function n(){let i=AssertLib.deepEqual;beforeEach(()=>{Y.setViewerMode(Y.ViewerMode.PROTOTYPE)}),At("Drag vector computation:",()=>{me("Smart animate drag - matched object with translation",()=>{e([(a,s,l,d)=>{let c=ie(l,"rect");c.setRelativeTransform(new J(1,0,30,0,1,50)),ie(d,"rect").setRelativeTransform(new J(1,0,130,0,1,250));let u=Lr(c,d,"DRAG","SMART_ANIMATE","NAVIGATE"),_=dr.computeDragVector1(c,u,l,a.prototypeStructure(),a.prototypeState());i(_,new b(100,200))}])}),me("Smart animate drag - matched object with translation, rotation, and resizing",()=>{e([(a,s,l,d)=>{let c=ie(l,"rect");c.setSize(new b(100,100)),c.setRelativeTransform(J.new2().translatedBy1(c.size().negative().divideScalar(2)));let p=ie(d,"rect");p.setSize(new b(200,100));let u=J.new2().translatedBy1(p.size().negative().divideScalar(2));u.postRotate(Math.PI/2),u.postTranslate(new b(100,200)),p.setRelativeTransform(u);let _=Lr(c,d,"DRAG","SMART_ANIMATE","NAVIGATE"),h=dr.computeDragVector1(c,_,l,a.prototypeStructure(),a.prototypeState());i(h,new b(100,200))}])}),me("Smart animate drag - no matches",()=>{e([(a,s,l,d)=>{let c=ie(l,"rect");c.setRelativeTransform(new J(1,0,30,0,1,50));let p=Lr(c,d,"DRAG","SMART_ANIMATE","NAVIGATE"),u=dr.computeDragVector1(c,p,l,a.prototypeStructure(),a.prototypeState());i(u,null)}])}),me("Smart animate drag - overlay swap with matched object with translation",()=>{e([(a,s,l,d)=>{let c=s.root().childAt1(0),p=qe(c,"overlayA"),u=qe(c,"overlayB"),_=ie(p,"rect");_.setRelativeTransform(new J(1,0,30,0,1,50)),ie(u,"rect").setRelativeTransform(new J(1,0,130,0,1,250));let S=Lr(_,u,"DRAG","SMART_ANIMATE","SWAP");Lr(l,p,"ON_CLICK","MOVE_FROM_LEFT","OVERLAY");let m=dr.computeDragVector1(_,S,l,a.prototypeStructure(),a.prototypeState());i(m,new b(100,200))}])}),me("Smart animate drag - overlay swap with no matches",()=>{e([(a,s,l,d)=>{let c=s.root().childAt1(0),p=qe(c,"overlayA"),u=qe(c,"overlayB"),_=ie(p,"rect");_.setRelativeTransform(new J(1,0,30,0,1,50));let h=Lr(_,u,"DRAG","SMART_ANIMATE","SWAP");Lr(l,p,"ON_CLICK","MOVE_FROM_LEFT","OVERLAY");let S=dr.computeDragVector1(_,h,l,a.prototypeStructure(),a.prototypeState());i(S,null)}])}),me("Move in smart animate drag - matched object with translation",()=>{e([(a,s,l,d)=>{let c=ie(l,"rect");c.setRelativeTransform(new J(1,0,30,0,1,50)),ie(d,"rect").setRelativeTransform(new J(1,0,130,0,1,250));let u=S_(c,d,"DRAG","MOVE_FROM_LEFT","NAVIGATE",!0),_=dr.computeDragVector1(c,u,l,a.prototypeStructure(),a.prototypeState());i(_,new b(100,200))}])}),me("Move in smart animate drag - no matches",()=>{e([(a,s,l,d)=>{let c=ie(l,"rect");c.setRelativeTransform(new J(1,0,30,0,1,50));let p=S_(c,d,"DRAG","MOVE_FROM_LEFT","NAVIGATE",!0),u=Tr.get("MOVE_FROM_LEFT").enteringFrameTransition(),_=d.size().multiply(u.to().translation1().subtract(u.from().translation1())),h=dr.computeDragVector1(c,p,l,a.prototypeStructure(),a.prototypeState());i(h,_)}])}),me("Screen swipe drag - nested node move in transition",()=>{e([(a,s,l,d)=>{let c=ie(l,"rect");c.setRelativeTransform(new J(1,0,30,0,1,50));let p=Lr(c,d,"DRAG","MOVE_FROM_LEFT","NAVIGATE"),u=Tr.get("MOVE_FROM_LEFT").enteringFrameTransition(),_=d.size().multiply(u.to().translation1().subtract(u.from().translation1())),h=dr.computeDragVector1(c,p,l,a.prototypeStructure(),a.prototypeState());i(h,_)}])}),me("Screen swipe drag - nested node move out transition",()=>{e([(a,s,l,d)=>{let c=ie(l,"rect");c.setRelativeTransform(new J(1,0,30,0,1,50));let p=Lr(c,d,"DRAG","MOVE_OUT_TO_LEFT","NAVIGATE"),u=Tr.get("MOVE_OUT_TO_LEFT").exitingFrameTransition(),_=l.size().multiply(u.to().translation1().subtract(u.from().translation1())),h=dr.computeDragVector1(c,p,l,a.prototypeStructure(),a.prototypeState());i(h,_)}])}),me("Screen swipe drag - TLF move in transition",()=>{e([(a,s,l,d)=>{let c=Lr(l,d,"DRAG","MOVE_FROM_LEFT","NAVIGATE"),p=Tr.get("MOVE_FROM_LEFT").enteringFrameTransition(),u=d.size().multiply(p.to().translation1().subtract(p.from().translation1())),_=dr.computeDragVector1(l,c,l,a.prototypeStructure(),a.prototypeState());i(_,u)}])}),me("Back screen swipe drag - TLF was opened by move in",()=>{e([(a,s,l,d)=>{var m;Lr(l,d,"ON_CLICK","MOVE_FROM_LEFT","NAVIGATE"),T_(d),I_(d,"DRAG");let c=l.prototypeInteractions()[0],p=(m=c.action())==null?void 0:m.value;a.scene().setAllTlfsLoaded(),a.prototypeState().navigateToFrameAndCloseOverlays(l.id()),a.prototypeState().commitStateChange(),a.prototypeState().navigateToFrameAndCloseOverlays(p.transitionNodeID(),a.baseScreenNode(),1,0,4,c,p),a.prototypeState().commitStateChange();let u=Tr.get("MOVE_FROM_LEFT").reversed().exitingFrameTransition(),_=d.size().multiply(u.to().translation1().subtract(u.from().translation1())),h=d.prototypeInteractions()[0],S=dr.computeDragVector1(d,h,d,a.prototypeStructure(),a.prototypeState());i(S,_)}])}),me("Overlay swipe drag - overlay move in transition",()=>{e([(a,s,l,d)=>{Lr(l,d,"DRAG","MOVE_FROM_LEFT","OVERLAY"),d.setSize(new b(250,250)),d.setOverlayPositionType("TOP_LEFT");let c=dr.computeDragVector1(l,l.prototypeInteractions()[0],l,a.prototypeStructure(),a.prototypeState());i(c,new b(d.size().x(),0))}])}),me("Overlay swipe drag - overlay move in transition with nested source",()=>{e([(a,s,l,d)=>{let c=ie(l,"rect"),p=Lr(c,d,"DRAG","MOVE_FROM_LEFT","OVERLAY");d.setSize(new b(250,250)),d.setOverlayPositionType("TOP_LEFT");let u=dr.computeDragVector1(c,p,l,a.prototypeStructure(),a.prototypeState());i(u,new b(d.size().x(),0))}])}),me("Close overlay swipe drag - overlay opened by move in",()=>{e([(a,s,l,d)=>{let c=s.root().childAt1(0),p=qe(c,"overlayA");p.setSize(new b(250,250)),p.setOverlayPositionType("TOP_LEFT");let u=ie(p,"rect");u.setRelativeTransform(new J(1,0,30,0,1,50)),Lr(l,p,"ON_CLICK","MOVE_FROM_LEFT","OVERLAY"),Xf(u),I_(u,"DRAG"),a.scene().setAllTlfsLoaded(),a.prototypeState().navigateToFrameAndCloseOverlays(l.id()),a.prototypeState().commitStateChange(),a.prototypeState().overlayFrame(p.id(),l,0,0,l.prototypeInteractions()[0],null),a.prototypeState().commitStateChange();let _=Tr.get("MOVE_FROM_LEFT").reversed().exitingFrameTransition(),h=p.size().multiply(_.to().translation1().subtract(_.from().translation1())),S=dr.computeDragVector1(u,u.prototypeInteractions()[0],l,a.prototypeStructure(),a.prototypeState());i(S,h)}])}),me("Overlay go back swipe drag - no back frame",()=>{e([(a,s,l,d)=>{d.setSize(new b(250,250)),d.setOverlayPositionType("TOP_LEFT"),Lr(l,d,"DRAG","MOVE_FROM_LEFT","OVERLAY"),T_(d),I_(d,"DRAG"),a.scene().setAllTlfsLoaded(),a.prototypeState().navigateToFrameAndCloseOverlays(l.id()),a.prototypeState().commitStateChange(),a.prototypeState().overlayFrame(d.id(),l,0,0,l.prototypeInteractions()[0],null),a.prototypeState().commitStateChange();let c=dr.computeDragVector1(d,d.prototypeInteractions()[0],l,a.prototypeStructure(),a.prototypeState());i(c,null)}])}),me("Drag - invalid navigate transition",()=>{e([(a,s,l,d)=>{Lr(l,d,"DRAG","DISSOLVE","NAVIGATE");let c=dr.computeDragVector1(l,null,l,a.prototypeStructure(),a.prototypeState());i(c,null)}])})}),At("Drag progress measurement:",()=>{let a=null;beforeEach(()=>{a=new Tl,Me.dangerouslyPushMockTime(a)}),afterEach(()=>{Me.popMockTime()}),me("Simple drag velocity and progress measurement",()=>{e([(s,l,d,c)=>{let p=(A,I,C)=>{ds(C,I,`Expected velocity at timestep ${A} to equal ${I}, got ${C}`)};s.prototypeState().setIsDragging(!0);let u=new dr(null,new b(1,0),null,null);u.handleDragStart(new b(0,0)),u.handleDrag(new b(0,0));let _=u.onTickProgress();i(_,0),a.advanceSeconds(1),u.handleDrag(new b(.5,0));let h=u.onTickProgress();i(h,.5);let S=u.signedDragSpeed();p(1,.5,S),a.advanceSeconds(.5),u.handleDrag(new b(1,0));let m=u.onTickProgress();i(m,1);let f=u.signedDragSpeed();p(2,1,f),a.advanceSeconds(1);let T=u.onTickProgress();i(T,1);let y=u.signedDragSpeed();p(3,0,y),a.advanceSeconds(.1),u.handleDrag(new b(.5,0));let E=u.onTickProgress();i(E,.5);let v=u.signedDragSpeed();p(4,-5,v)}])}),me("Different-direction drag velocity and progress measurement",()=>{e([(s,l,d,c)=>{s.prototypeState().setIsDragging(!0);let p=new dr(null,new b(1,0),null,null);p.handleDragStart(new b(0,0)),p.handleDrag(new b(0,0));let u=p.onTickProgress();i(u,0),a.advanceSeconds(1),p.handleDrag(new b(0,.5));let _=p.onTickProgress();i(_,0);let h=p.signedDragSpeed();bh(1,0,h),a.advanceSeconds(1),p.handleDrag(new b(-.5,0));let S=p.onTickProgress();i(S,0);let m=p.signedDragSpeed();bh(2,-.5,m),a.advanceSeconds(1),p.handleDrag(new b(.5,1));let f=p.onTickProgress();i(f,.5);let T=p.signedDragSpeed();bh(3,1,T)}])})})}o.testDragToAnimateBehavior=n})(CA||(CA={}));var rm=class{constructor(e){this._viewerStatsigConfigBindings=e}getDynamicConfigBoolean(e,t,n){return this._viewerStatsigConfigBindings.getDynamicConfigBoolean(e,t,n)}getDynamicConfigNumber(e,t,n){return this._viewerStatsigConfigBindings.getDynamicConfigNumber(e,t,n)}getDynamicConfigString(e,t,n){return this._viewerStatsigConfigBindings.getDynamicConfigString(e,t,n)}getExperimentBoolean(e,t,n){return this._viewerStatsigConfigBindings.getExperimentBoolean(e,t,n)}getExperimentNumber(e,t,n){return this._viewerStatsigConfigBindings.getExperimentNumber(e,t,n)}getExperimentString(e,t,n){return this._viewerStatsigConfigBindings.getExperimentString(e,t,n)}getFeatureGate(e){return this._viewerStatsigConfigBindings.getFeatureGate(e)}updateFeatureGateForTesting(e,t){Gr(),this._viewerStatsigConfigBindings.updateFeatureGateForTesting(e,t)}setInRenderServerForViewerTests(){var e;Gr(),(e=this._viewerStatsigConfigBindings)==null||e.setInRenderServerForViewerTests()}clearFeatureGatesForTesting(){var e;Gr(),(e=this._viewerStatsigConfigBindings)==null||e.clearFeatureGatesForTesting()}};var nm=class{constructor(e){this._session=null,this._preservers=[],this._isReconnecting=!1,this._session=e,this._session.addObserver(this),this._preservers.push(new NA),this._preservers.push(new bA)}handleSceneChangedLoadingPhase(e,t){t==rn.PENDING_LOAD_AFTER_RECONNECT?this.handleSceneWillRebuildAfterReconnect():e==rn.PENDING_LOAD_AFTER_RECONNECT&&t==rn.LOADED&&this.handleSceneDidRebuildAfterReconnect()}handleSceneWillRebuildAfterReconnect(){if(this._session.scene()==null){Oe("Scene unexpectedly null in handleSceneWillRebuildAfterReconnect");return}this._isReconnecting=!0,this._preservers.forEach(e=>{e.reset()}),this._session.scene().each(e=>{this._preservers.forEach(t=>{t.saveDataFromOldSceneNode(e)})})}handleSceneDidRebuildAfterReconnect(){this._isReconnecting=!1,this._preservers.forEach(e=>{e.restoreDataToNewScene(this._session.scene())}),this._preservers.forEach(e=>{e.reset()})}handleConnect(e,t){}handleDisconnect(){}handleJoinStart(e,t,n){}handleJoinEnd(){}handlePresenterChange(){}handleNodeChanges(){this._isReconnecting&&this._preservers.forEach(e=>{e.restoreDataToNewScene(this._session.scene())})}handleSceneGraphReply(e,t){}},bA=class{constructor(){this._nodeDeveloperFriendlyIdToScrollOffset=null,this.reset()}reset(){this._nodeDeveloperFriendlyIdToScrollOffset=new Map}saveDataFromOldSceneNode(e){e.scrollDirection()!="NONE"&&!e.scrollOffset().equals(fe.FrozenVector_ZERO)&&this._nodeDeveloperFriendlyIdToScrollOffset.set(e.developerFriendlyId(),e.scrollOffset())}restoreDataToNewScene(e){Ge.StringMap_each(this._nodeDeveloperFriendlyIdToScrollOffset,(t,n)=>{let o=e.findNodeFromDeveloperFriendlyId(t);o!=null&&o.setScrollOffset(n)})}},NA=class{constructor(){this._nodeDeveloperFriendlyIdsUsedAsBaseScreens=null,this.reset()}reset(){this._nodeDeveloperFriendlyIdsUsedAsBaseScreens=new Dn}saveDataFromOldSceneNode(e){e.usedAsBaseScreen()&&this._nodeDeveloperFriendlyIdsUsedAsBaseScreens.add(e.developerFriendlyId())}restoreDataToNewScene(e){this._nodeDeveloperFriendlyIdsUsedAsBaseScreens.each(t=>{let n=e.findNodeFromDeveloperFriendlyId(t);n!=null&&n.setUsedAsBaseScreen(!0)})}};var om=class{constructor(e){this._scene=null,this.onChange=null,this._scene=e.scene(),e.addAppObserver(this)}handleSceneChange(e,t){e!=null&&e.removeObserver(this),t!=null&&t.addObserver(this),this._scene=t}handleActiveCanvasChange(e,t){}handleActivePrototypeStartingPointChange(e,t){}handleSceneGraphEvent(e){(e.node.type()=="CANVAS"||e.node.type()=="DOCUMENT")&&this.onChange(this.pages())}pages(){let e=[];if(this._scene!=null&&this._scene.root()!=null)for(let t=0;t<this._scene.root().childCount();t=t+1){let n=this._scene.root().childAt1(t);n.type()=="CANVAS"&&!n.isInternalOnly()&&e.push({id:n.id(),name:n.name()})}return e}};var im=class{handleStateChangeAborted(e){}handleStateChangeCommitted(e,t){this.callback(e)}handleStateChangeInitiated(e){}handleStateChangeRequested(e){}handleFitModeChange(e,t){}handleRestartPrototype(){}handleSetVariableAction(e){}constructor(e){this.callback=e}};var PA;(o=>{function r(){return o._instance}o.instance=r;function e(i,a){o._instance=new t(i,a)}o.create=e;class t extends im{constructor(a,s){super(l=>{this._emitter.trigger("topLevelFrameChange",null)}),this._dirtyNodes=null,this._emitter=null,this._scene=null,a.addFrameObserver(this),a.addAppObserver(this),a.prototypeState().addObserver(this),this._emitter=s,this._clearDirtySet()}_clearDirtySet(){this._dirtyNodes=new ci(a=>a)}handleSceneGraphEvent(a){switch(a.property){case 65:case 32:case 30:case 98:case 57:case 86:case 4:case 25:case 8:{this._dirtyNodes.add(a.node.id());break}}}handleSceneChange(a,s){a!=null&&a.removeObserver(this),s!=null&&s.addObserver(this)}handleActiveCanvasChange(a,s){}handleActivePrototypeStartingPointChange(a,s){}onFrame(){this._dirtyNodes.each(a=>{this._emitter.trigger("accessibilityNodeInvalidated",a)}),this._clearDirtySet()}}o._AccessibilityObserver=t,o._instance=null})(PA||(PA={}));function Pu(r){return{x:r.x(),y:r.y(),width:r.width(),height:r.height()}}function Ob(r){let e=r.state().getActiveCanvas();if(e==null)return null;let t=e.backgroundColor();return t==O.TRANSPARENT?null:O.asFloattoJSON(t)}function Cb(r){if(r.state().scene()==null)return null;let t=r.state().getActiveCanvas();if(t==null)return null;let n=Y.prototypeBackgroundColorOverride!=null?Y.prototypeBackgroundColorOverride.value:t.prototypeBackgroundColor();return n==O.TRANSPARENT?null:O.asInttoJSON(n)}function oL(r){let e=[];for(let t of r)e.push(X.fromString(t));return e}function iL(r){return{trigger:r.event().interactionType(),to:r.action().value.connectionType(),type:r.action().value.navigationType()}}function Nb(r){return t=>{let n=t.subtract(r.canvasView().absoluteBounds().topLeft()),o=r.canvasView().canvasSpaceToWindowSpace().clone();return o.invert()?(o.transformPoint(n),n):null}}function Pb(r,e){e.window().setRecordInteractionCallback(t=>{let n=Oc.serialize(t,r);n!==null&&Kt.getEventEmitter().trigger("recordInteraction",n)})}function aL(r){let e=Nb(r);Pb(e,r)}async function sL(r){var C;ca.detect(),Ct.initialize(r),Jt.initialize(),Fn.initialize(),Y.initialize(r),Nv(r.kiwiSchema),Qn.setDelegate(new rm(r.statsigViewerWebConfig)),Ac.initialize(r.safeModeOptions),md.initialize(r.emscriptenGL);let e=new Rc(Ct.getContainerElement(),Y.gameControllerListener(),new Hh,0),t=e.multiplayerSession(),n=e.multiplayerCoupler(),o=Kt.getEventEmitter();new nm(t);let i=new bu(e.state()),a=new om(e.state()),s={clientId:null,allowedEmbedOrigins:null,embedHost:null},l=new URLSearchParams(window.location.search),d=l.get("client-id")||null,c=((C=window.INITIAL_OPTIONS)==null?void 0:C.allowed_embed_origins)||null,p=l.get("embed_host")||l.get("embed-host")||null;s={clientId:d,allowedEmbedOrigins:c,embedHost:p},hs.init(e.state(),e.canvasView(),s);let u=null;Y.getViewerMode()==Y.ViewerMode.MIRROR&&(u=new Nu(e,t)),o.on("documentSyncingMessage",g=>{Ae.trackEvent("Viewer Document Syncing Message",{...g,hasPendingMirrorSelectionChange:(u==null?void 0:u.hasPendingSelectionChange())??!1,hasPendingPrototypeStateChange:e.state().prototypeState().hasRequestedStateChange()})});let _=r.connectionRole;if(typeof _=="string"){if(["viewer","prototype"].indexOf(_)==-1)throw new Error(`Invalid connection role ${_}`);t.setRole(_)}o.on("sceneDidCompleteInitialLoad",g=>{let R=D=>{window.figmaPerfTesting&&window.postMessage({name:D,value:0},"*")};R("DOCUMENT_IS_LOADED"),window.DebuggingHelpers&&(window.DebuggingHelpers.documentIsLoaded=!0),e.canvasView().afterFrame=()=>{e.canvasView().afterFrame=null,R("AFTER_FIRST_RENDER"),o.trigger("documentIsLoaded")},e.canvasView().afterFirstRenderOfScreenStack=()=>{e.canvasView().afterFirstRenderOfScreenStack=null,R("AFTER_FIRST_RENDER_OF_TLF")}});let h=0,S=r.interactionTestState;if(typeof S!="string"||S==="NONE")h=0;else if(S==="RECORD")h=1,Ay();else if(S==="PLAYBACK")h=2,gy();else throw new Error(`Invalid interactionTestState ${S}`);let m=null,f=null,T=null,y=null;h!=0&&(m=g=>{let R=g.clone();return e.canvasView().canvasSpaceToWindowSpace().transformPoint(R),R.add(e.canvasView().absoluteBounds().topLeft())},f=Nb(e),T=g=>e.window().root().viewFromPoint(g),y=()=>e.window().focusedView()),h==1&&Pb(f,e),e.state().addActionObserver(new Kt.ActionHandler);let E=new Kt.AppHandler(e.state());e.state().addFrameObserver(E),PA.create(e.state(),o),Jr.addUpdate(Bt.windowFrame(e.window().events()),g=>{t.maybeFlushNextUserChange(0)}),e.canvasView().onBaseScreenIdChanged=(g,R,D,P,U)=>{g!=null&&o.trigger("baseScreenChanged",{nodeId:g,userInitiated:R==1,updateURL:D,repairsInvalidState:P,isSymbol:U})},e.canvasView().onScalingModeChanged=g=>{o.trigger("scalingModeChanged",{contentScalingMode:g.contentScalingMode.toString(),viewportScalingMode:g.fitMode.toString()})},e.canvasView().disengageObservationMode=()=>{o.trigger("disengageObservationMode")},e.canvasView().viewportTracker().onChange=(g,R)=>{o.trigger("viewportChanged",{offset:{x:g.x(),y:g.y()},zoomScale:R})},e.canvasView().onResize=()=>{o.trigger("canvasResize")},e.canvasView().onURLClicked=(g,R)=>{o.trigger("urlClicked",{url:g,openInNewWindow:R})},e.canvasView().onNavigateToPrototype=(g,R)=>{o.trigger("navigateToPrototype",{fileKey:g,guid:R})},Zn.instance().startLibLoad=()=>{o.trigger("loadVideoJsLib",{})},a.onChange=g=>{o.trigger("pagesChange",g)},i.notifyCommentPositionsChange=()=>{o.trigger("watchedNodeBoundsChange")},new cl(e.state(),67,g=>{o.trigger("backgroundColorChange",Ob(e))}),new cl(e.state(),68,g=>{o.trigger("prototypeBackgroundColorChange",Cb(e))}),new cl(e.state(),69,g=>{o.trigger("prototypeDeviceChanged",g!=null?g.toJSON():null)});let v=[],A={appState:()=>e.state(),multiplayer:()=>t,prototypeState:()=>e.state().prototypeState(),logAndGetDocument:()=>{var R;let g=(R=e.state().scene())==null?void 0:R.root();return g!=null?console.log(g.debugString()):console.log("Document root not found \u{1F630}"),g},logAndGetBaseScreen:()=>{let g=e.state().baseScreenNode();return g!=null?console.log(g.debugString()):console.log("Base screen not found \u{1F630}"),g},logAndGetNode:g=>{var D;let R=(D=e.state().scene())==null?void 0:D.findNode(g);return R!=null?console.log(R.debugString()):console.log(`Node with id ${g??"null"} not found!`),R},logAndGetNodeByStablePath:g=>{var D;let R=(D=e.state().scene())==null?void 0:D.findNodeByStablePath(ut.fromString(g));return R!=null?console.log(R.debugString()):console.log(`Node with stablePath ${g??"null"} not found!`),R},logAndGetRenderTree:g=>{var D,P;let R=(D=e.state().scene())==null?void 0:D.findNode(g);return R!=null?console.log(((P=R.renderTree1())==null?void 0:P.debugString1())??"null"):console.log(`Node with id ${g??"null"} not found!`),R.renderTree1()},logFakeError:g=>{my(g)},setDebugUserChanges:g=>{ea.debugUserChanges=g},fulfilledMultiplayerQueries:()=>t.fulfilledMultiplayerQueries(),ICSemanticStorageTrie:()=>{console.log(e.state().prototypeState().componentStateSyncer.debugString())},VideoSemanticStorageTrie:()=>{console.log(e.state().videoManager().runtimeStorage().toString1())},getMemoryBreakdown:()=>{let g=N().modules().corePerfInfo;return{jsBuffers:g==null?void 0:g.getJsBufferMemory(),memStats:g==null?void 0:g.getMemStatsSummary()}}};Y.getFeatureFlags().internal_only_debug_tools&&(window.DebuggingHelpers=A);let I={setObservingSessionID:g=>{if(!gl(g))throw new Error("Missing sessionID");let R=g|0;R!=t.observingSessionID()&&(t.setObservingSessionID(R),n.setPreviewToObservedFrameOrOverlay(!1),n.performVariableActions(!0),n.performVideoStateChanges(),n.performEmbeddedPrototypeChanges(!0),n.performActiveSlidesEmbeddedPrototypeChanges(),o.trigger("multiplayerUserInfoChange",n.userInfoJSON()),e.canvasView().viewport().invalidate())},nominatePresenter:g=>{if(!gl(g))throw new Error("Missing sessionID");t.nominatePresenter(g|0)},cancelPresenterNomination:g=>{if(!gl(g))throw new Error("Missing sessionID");t.cancelPresenterNomination(g|0)},startPresenting:()=>{t.startPresenting()},stopPresenting:()=>{t.stopPresenting()},setSlideSpeakerNotes:(g,R)=>{t.setSlideSpeakerNotes(g,R)},setInteractiveSlideConfigData:(g,R,D)=>{t.setInteractiveSlideConfigData(g,R,D)},setInteractiveSlideParticipantData:(g,R,D)=>{t.setInteractiveSlideParticipantData(g,R,D)},adjustZoom:(g,R)=>{e.canvasView().viewport().adjustCameraZoom2(1,g,R)},setZoom:(g,R)=>{e.canvasView().viewport().setCameraZoom(1,g)},zoomToNode:(g,R)=>{var P;let D=(P=e.state().scene())==null?void 0:P.findNode(X.fromString(g));D!=null&&(e.state().setActiveCanvas(D.canvas()),e.canvasView().viewport().zoomToFit1(1,D.canvasSpaceBoundingBox(),R))},getZoomBounds:()=>({min:Jo.ZOOM_MIN,max:Jo.ZOOM_MAX}),setCanvasSpaceCenter:(g,R)=>{let D=new b(-1*g.x,-1*g.y);e.canvasView().viewport().setCameraOffset2(1,D,R)},setCanvasSpaceCenterWithScroll:g=>{var F;let R=new b(g.x,g.y),D=(F=e.state().baseScreenNode())==null?void 0:F.canvasSpaceBoundingBox();if(D==null)return;let P=Math.max(R.x()-D.x(),0),U=Math.max(R.y()-D.y(),0),B=Math.max(P-D.width()/2,0),M=Math.max(U-D.height()/2,0);if(P!=0||U!=0){let w=new b(B,M);e.canvasView().updateScrollOffsetForNode(e.state().prototypeState().getTopmostScreen(),w)}},setScrollPadding:g=>{e.canvasView().setScrollPadding(+g.left,+g.top,+g.right,+g.bottom)},setScrollToPan:g=>{Y.setScrollToPan(g)},setDragToPan:g=>{Y.setDragToPan(g)},setShouldPlayVideosLinearly:g=>{Y.setShouldPlayVideosLinearly(g)},injectVideoJsLib:g=>{Zn.instance().onLoadComplete(g)},connectTo:(g,R)=>{let D={prototypeApp:Cn.instance,skewKiwiSerialization:Ku(),deprecatedJsSceneHooks:Cn.instance};R(D).then(P=>{let U=P.cppModules;e.state().setFontListPromise(P.fontListPromise),Y.getFeatureFlags().internal_only_debug_tools&&(A.fullscreen=U==null?void 0:U.sharedDebuggingHelpers,window.DebuggingHelpers=A);let B=g.fileKey,M=X.fromString(g.nodeId);X.isRoot(M)&&(M=null),Y.getViewerMode()==Y.ViewerMode.MIRROR&&u!=null?u.connectToFileAndShowNode(B,M,X.fromString(g.startingPointNodeId),!!g.renderDots,U,g.editorType):e.connectTo(B,M,X.fromString(g.startingPointNodeId),!!g.renderDots,U,g.editorType)})},openFileKey:()=>t.fileKey()??e.state().currentFileKey(),isConnected:()=>t.isConnected(),hasActiveScene:()=>e.state().scene()!=null,unloadSceneForTesting:()=>{t.disconnect(),e.state().prototypeState().resetPrototype(),e.state().setScene(null)},disconnectForTesting:()=>{t.disconnect()},reconnectForTesting:()=>{t.attemptReconnect()},enforceValidPrototypeStateForTesting:()=>{e.state().prototypeState().enforceValidPrototypeStateForTesting()},deleteNodeForTesting:g=>{let R=e.state().scene();if(R==null)throw new Error("No current scene");R.removeNode(X.fromString(g))},translateNodeForTesting:(g,R,D)=>{let P=e.state().scene();if(P==null)throw new Error("No current scene");let U=P.findNode(g);if(U==null)throw new Error("Node not found");let B=U.relativeTransform().clone();B.translate2(R,D),U.setRelativeTransform(B)},addCanvasViewObserverForTesting:(g,R)=>{let D=new Zh((P,U,B,M)=>{g()},P=>{R(P.scrollOffset().x(),P.scrollOffset().y())});v.push(D),e.canvasView().addObserver(D)},clearCanvasViewObserversForTesting:()=>{for(let g of v)e.canvasView().removeObserver(g);v=[]},sendMultiplayerNodeChangesForTesting:g=>{let R=e.state().scene();if(R==null)throw new Error("No current scene");let D=xe().encodeMessage(g);R.applyMessageToScene(D)},setMockEmbedListener:g=>{hs.setMockListener(g)},isPreloaded(){return e.state().isPreloaded},setMaximumDrawingBufferSizeForTesting:g=>{e.canvasView().setMaximumDrawingBufferSizeForTesting(g)},clearMaximumDrawingBufferSizeForTesting:()=>{e.canvasView().clearMaximumDrawingBufferSizeForTesting()},triggerResizeForTesting:()=>{e.canvasView().triggerResizeForTesting()},getVideoStateForNodeIdForTesting:g=>e.state().prototypeState().getVideoStateChangeForGuid(g),waitForAllVisibleVideosToLoadForTesting:()=>new Promise((R,D)=>{let P=1,U=()=>{e.state().prototypeState().allVisibleVideosAreLoaded()?R(!0):P>3?R(!1):(P++,setTimeout(U,P*1e3))};U()}),reset:()=>{e.state().prototypeState().resetState(),e.unloadSceneAndResetPrototypeLib()},loadFile:(g,R)=>{let D={prototypeApp:Cn.instance,skewKiwiSerialization:Ku(),deprecatedJsSceneHooks:Cn.instance};R(D).then(P=>{let U=P.cppModules;e.state().setFontListPromise(P.fontListPromise),e.initializePrototypeLib(U),Y.getFeatureFlags().internal_only_debug_tools&&(A.fullscreen=U==null?void 0:U.debuggingHelpers,window.DebuggingHelpers=A);let B=g.bytes,M=X.fromString(g.nodeId);X.isRoot(M)&&(M=null);let F=g.startingPointNodeId,w=g.imagePrefixURL,V=g.videoPrefixURL,k=g.renderDots,H=g.editorType;typeof w=="string"&&Ct.setImagePrefixURL(w),typeof V=="string"&&Ct.setVideoPrefixUrl(V);let z;Qn.getFeatureGate("viewer_load_images_from_figfile")?z=e.state().serialization().decodeSceneWithImages(B,"DUMMY_FILE_KEY"):z=e.state().serialization().decodeSceneForViewerAndPrototypeLib2(B,"DUMMY_FILE_KEY"),z.then(Q=>{if(t.disconnect(),e.state().prototypeState().mostRecentBaseScreenIdChangeInitiator="externalAPI.loadFile",e.state().prototypeState().resetPrototype(),e.state().prototypeState().mostRecentFixInvalidStateInitiator="externalAPI.loadFile 1",e.state().setScene(Q),e.state().setRenderDots(!!k),e.canvasView().setBackgroundEnabled(!k),e.state().setEditorType(H),e.canvasView().initializeThumbnailRenderer(H),Q.setAllTlfsLoaded(),Y.getViewerMode()==Y.ViewerMode.PROTOTYPE){let K=e.state().scene().findNode(M);if(K==null){let Pe=e.state().scene().findNode(X.fromString(F));if(Pe!=null&&Pe.isTopLevel()&&mv(Pe)&&(K=Pe),K==null){let at=e.state().prototypeStructure().topLevelPrototypeStartingPointNodeIdsSorted();at.length>0&&(K=e.state().scene().findNode(X.fromString(at[0])))}}e.state().prototypeState().mostRecentFixInvalidStateInitiator="externalAPI.loadFile 2",e.state().setActivePrototypeStartingPointNodeId(X.fromString(F));let j=e.state().prototypeStructure().nodeToRestartPrototypeOn(e.state().getActiveCanvas()),pe=K==null?void 0:K.topLevelAncestor();if(pe!=null)e.state().prototypeState().navigateToFrameAndCloseOverlays(pe.id());else if(j!=null)e.state().prototypeState().navigateToFrameAndCloseOverlays(j.id());else if(!oa)throw new Error("Calling loadFile in PROTOTYPE mode but with a file that isn't a valid prototype")}e.state().fontListPromise().then(()=>{o.trigger("sceneDidCompleteInitialLoad")})})})},navigateForward:g=>{e.canvasView().navigateForward(19,g)},navigateBackward:()=>{e.canvasView().navigateBackward(18)},navigateToFrameAndCloseOverlays:g=>{let R=X.fromString(g);R!=null&&e.state().prototypeState().navigateToFrameAndCloseOverlays(R)},navigateToFrameAndCloseOverlaysOrRestart:g=>{let R=X.fromString(g);R!=null&&e.state().prototypeState().navigateToFrameAndCloseOverlaysOrRestart(R,"externalAPI.navigateToFrameAndCloseOverlaysOrRestart")},navigateToFrameAtIndex:g=>{e.canvasView().navigateToFrameAtIndex(g)},setPreloaded:g=>{e.state().isPreloaded=g},restartPrototype:()=>{e.state().prototypeState().restartPrototype(1)},forceFrame:()=>{e.window().forceFrame!=null&&dp(()=>{e.window().forceFrame()})},setScalingMode:g=>{typeof g=="string"?(g==="free"&&console.warn("setScalingMode('free') called "),e.state().prototypeState().setScalingInfoFromParameter(g)):g.hasOwnProperty("contentScalingMode")&&g.hasOwnProperty("viewportScalingMode")&&(g.viewportScalingMode==="free"&&console.warn("setScalingMode('free') called "),e.state().prototypeState().setScalingInfoFromParameter(g.viewportScalingMode,g.contentScalingMode)),e.state().prototypeState().getCurrentFitMode()=="min-zoom"&&e.canvasView().viewport().setCameraZoom(0,1)},setTransitionOnClick:g=>{e.state().prototypeState().setTransitionOnClick(g)},setShowHotspots:g=>{e.canvasView().setShowHotspots(g)},setShowDeviceFrame:g=>{e.state().prototypeState().setShowDeviceFrame(g),e.canvasView().viewport().invalidate()},setShowBareUI:g=>{e.state().prototypeState().setShowTransparentBackground(g),e.canvasView().viewport().invalidate()},setDisengageObservationOnClick:g=>{e.state().prototypeState().setDisengageObservationOnClick(g)},toggleInteractionRecording:g=>{g?aL(e):e.window().stopRecordingInteractions()},getBackgroundColor:()=>Ob(e),getPrototypeBackgroundColor:()=>Cb(e),getPrototypeStartNodeId:()=>{let g=null,R=e.state().prototypeStructure().topLevelPrototypeStartingPointNodeIdsSorted();return R.length>0&&(g=X.fromString(R[0])),g==null||!X.isValid(g)?null:g},getActivePrototypeStartingPointNodeId:()=>{let g=e.state().activePrototypeStartingPointNodeId();return g==null||!X.isValid(g)?null:g},setActivePrototypeStartingPointNodeId:g=>{let R=X.fromString(g);e.state().activePrototypeStartingPointNodeId()!=R&&(e.state().prototypeState().mostRecentFixInvalidStateInitiator="externalAPI.setActivePrototypeStartingPointNodeId",e.state().setActivePrototypeStartingPointNodeId(R))},prototypeStartingPointsData:()=>{let g=e.state().prototypeStructure();return g==null?null:g.prototypeStartingPointsData()},getBaseScreenId:()=>e.state().baseScreenId(),isScalingModeResponsive:()=>e.state().currentScalingInfo().contentScalingMode==="responsive",getCurrentOverlayIdsForTesting:()=>e.state().prototypeState().getCurrentOverlayIds().map(g=>g),getOnscreenStatesForTesting:()=>e.state().prototypeState().getOnscreenStates().map(g=>({stablePath:g.a.guids.map(R=>R),stateId:g.b})),getRelativeTransformForNode:g=>{var D;let R=(D=e.state().scene())==null?void 0:D.findNode(X.fromString(g));return R?R.relativeTransform().clone():null},pageIdForNodeId:g=>{var P;let R=e.state().scene();if(R==null)return null;let D=R.findNode(g);return(P=D==null?void 0:D.findContainingCanvasOrSelf())==null?void 0:P.id()},navigationOrderType:()=>e.state().prototypeStructure().navigationOrder().navigationOrderTypeString(),supportsLinearNavigationOrder:()=>e.state().prototypeStructure().isLinear(),requestPage:g=>{var U;let R,D=X.fromString(g),P=(U=e.state().scene())==null?void 0:U.findNode(D);P!=null&&P.type()=="CANVAS"&&e.state().requestSetActiveCanvas(P)},setCurrentPageId:g=>{var U;let R,D=X.fromString(g),P=(U=e.state().scene())==null?void 0:U.findNode(D);P!=null&&P.type()=="CANVAS"&&e.state().setActiveCanvas(P)},getCurrentPageId:()=>{var R;let g=e.state().getActiveCanvas();return(R=g==null?void 0:g.findContainingCanvasOrSelf())==null?void 0:R.id()},getNodesToShowInPrototype:()=>e.state().prototypeStructure().navigationOrder().topLevelPrototypeNodesInOrder(),getStatsForAnalytics:()=>{var D,P;let g=e.state().getActiveCanvas();if(g==null)throw new Error("Asking for stats without an active canvas");let R=g.prototypeDevice();return{pageId:g.id(),deviceType:R.type,deviceSizeWidth:R.size().x(),deviceSizeHeight:R.size().y(),presetIdentifier:R.presetIdentifier,graphicsCardName:e.canvasView().graphicsCardName(),isHardwareAccelerationDisabled:Oy(e.canvasView().getContext()),isHighDPR:Y.isHighDPR(),fastImageDecode:Ur.browserSupportsFastImageDecoding(),baseScreenWidth:(D=e.state().baseScreenNode())==null?void 0:D.fullSize().x(),baseScreenHeight:(P=e.state().baseScreenNode())==null?void 0:P.fullSize().y(),isInlinePreview:Y.isInlinePreview()}},getPrototypeDeviceType:()=>{let g=e.state().getActiveCanvas();return g==null?(Oe("Asking for prototype device type without a playback canvas"),"NONE"):g.prototypeDevice().type},getStoredPrototypeDevice:()=>{let g=e.state().getActiveCanvas();return g==null?null:g.storedPrototypeDevice()},setStoredPrototypeDevice:g=>{let R=e.state().getActiveCanvas();return R==null?(Oe("Trying to set prototype device type without a playback canvas"),null):g==null?(Oe("Trying to set null prototype device type"),null):R.setPrototypeDevice(ot.decodePrototypeDevice(g))},getCurrentTlfBounds:(g=!1)=>{var P;let R=(P=e.state().baseScreenNode())==null?void 0:P.canvasSpaceBoundingBox(),D=G.new2();return R==null?null:g?Pu(R):(R.transformInto2(D,e.canvasView().canvasSpaceToWindowSpace()),Pu(D))},setUserDidAttemptZoom:g=>{e.canvasView().userDidAttemptZoom=R=>{g(gA[R])}},getCanvasSpaceBoundsByNodeId:g=>{let R={},D=e.state().scene();if(D==null)throw new Error("No current scene");for(let P of g){let U=X.fromString(P);if(U==null)continue;let B=D.findNode(U);if(B==null)continue;let M=B.canvasSpaceBoundingBox();R[P]=new Map([["x",M.x()],["y",M.y()],["width",M.width()],["height",M.height()]])}return R},getFullSizeByNodeId:g=>{let R=e.state().scene();if(R==null)throw new Error("No current scene");let D=X.fromString(g);if(D==null)return null;let P=R.findNode(D);return P==null?null:P.fullSize().toJSON()},watchBoundsForNodes:g=>{let R=oL(g);i.setNodesWithComments(R)},getPrototypeStateCurrentIndex:()=>e.state().prototypeState().getCurrentBaseScreenIndex(),getNavigateForwardEnabled:()=>e.state().prototypeStructure().navigationOrder().getNavigateForwardEnabled(),getNavigateBackwardEnabled:()=>e.state().prototypeStructure().navigationOrder().getNavigateBackwardEnabled(),getPages:()=>a.pages(),viewport:()=>{let g=e.canvasView().viewport(),R=g.offset(),D=g.zoomScale();return{offset:{x:R.x(),y:R.y()},zoomScale:D}},getStatsForDebugging:()=>Rr.getStatsForDebugging(),getGPUMemoryTotal:()=>e.canvasView().getContext().stats().total(),getGPUMemoryStats:()=>{let g=e.canvasView().getContext().stats();return{textures:g.forType(0),vertexBuffers:g.forType(1),renderBuffers:g.forType(2),uniformBuffers:0}},on:o.on.bind(o),off:o.off.bind(o),trigger:o.trigger.bind(o),playbackInteraction:g=>{if(h==2){let R=Oc.deserialize(g,T,y,m);e.window().notify(R)}},setNewContainerElement:g=>{e.window().setNewContainerElement(g)},editorTypeForTesting:()=>e.state().editorType(),canvasViewCursorForTesting:()=>Pp[e.canvasView().cursor()],lastTopLevelTransitionPropertiesForTesting:()=>{let g=e.state().prototypeState().lastInitiatedTopLevelStateChange();return g==null||g.transitionParameters==null?null:{type:g.transitionParameters.transitionType,durationSeconds:g.transitionParameters.transitionDuration}},lastICTransitionPropertiesForTesting:()=>{let g=e.state().prototypeState().lastInitiatedInstanceStateChange();return g==null||g.transitionParameters==null?null:{type:g.transitionParameters.transitionType,durationSeconds:g.transitionParameters.transitionDuration}},scrollOffsetForNodeInBaseScreenForTesting:g=>{let R=e.state().scene();if(R==null)return{};let D=R.findNode(g);return D!=null?D.scrollOffset().toJSON():b.new().toJSON()},scrollOffsetForNodeInOverlayAtForTesting:(g,R)=>{let D=e.state().scene();if(D==null)return{};let P=D.findNode(g);return P!=null?P.scrollOffset().toJSON():b.new().toJSON()},getCanvasSpaceCommentLocations:g=>{let R=e.state().scene();if(R==null)return{};let D=new Map;for(let P in g)D.set(P,hl.fromJSON(g[P]));return i.getCanvasSpaceCommentLocations(R,D)},getCommentDestinationAtPosition:g=>{let R=new b(g.x,g.y),D=i.getCommentDestinationAtPosition(R);return D==null?null:D.toJSON()},onChange:g=>{var R;return(R=e.state().scene())==null?void 0:R.onChange(g)},getRevisionNumber:()=>{var g;return(g=e.state().scene())==null?void 0:g.getRevisionNumber()},setLoadFullDocument:g=>e.multiplayerSession().incrementalLoader().dangerouslySetLoadFullDocument(g),preloadAllImages:()=>{e.state().imageManager().preloadAllImages()},preloadAllVideos:()=>e.state().videoManager().preloadAllVideos(),associateYoutubeWithNode:(g,R)=>{e.state().videoManager().associateYoutubeWithNode(g,R)},disassociateYoutubeWithNode:g=>{e.state().videoManager().disassociateYoutubeWithNode(g)},hasVideoControls:g=>{var D;let R=(D=e.state().scene())==null?void 0:D.findNode(g);return(R==null?void 0:R.videoPlayback().showControls)??!1},hasVideoRuntimes:g=>!!e.state().videoManager().getVideoRuntimesForNode(g),subscribeToVideoRuntimeUpdates:g=>e.state().videoManager().subscribeToVideoRuntimeUpdates(g),getHtmlVideoElementForNode:g=>{let R=e.state().videoManager().getVideoRuntimesForNode(g);if(R==null)return null;for(let D of R.values()){let P=D.getHtmlVideoElement();if(P!=null)return P}return null},playVideoRuntimesForNode:g=>{let R=ir.NULL_ACTION.withTransitionNodeID(g).withMediaAction("PLAY");e.state().videoManager().updateVideoRuntime(R,g)},pauseVideoRuntimesForNode:g=>{let R=ir.NULL_ACTION.withTransitionNodeID(g).withMediaAction("PAUSE");e.state().videoManager().updateVideoRuntime(R,g)},setIsSeekingVideoRuntimesForNode:(g,R)=>{let D=e.state().videoManager().getVideoRuntimesForNode(g);if(D==null)return null;for(let P of D.values())P.setIsSeeking(R)},skipToVideoRuntimesForNode:(g,R)=>{let D=ir.NULL_ACTION.withTransitionNodeID(g).withMediaAction("SKIP_TO").withMediaSkipToTime(R);e.state().videoManager().updateVideoRuntime(D,g)},muteVideoRuntimesForNode:g=>{let R=ir.NULL_ACTION.withTransitionNodeID(g).withMediaAction("MUTE");e.state().videoManager().updateVideoRuntime(R,g)},unmuteVideoRuntimesForNode:g=>{let R=ir.NULL_ACTION.withTransitionNodeID(g).withMediaAction("UNMUTE");e.state().videoManager().updateVideoRuntime(R,g)},preloadDeviceFrames:(g,R)=>{(async()=>(await e.canvasView().deviceRenderer().preloadDeviceImage(ot.decodePrototypeDevice(g)),await Promise.all(R.map(D=>e.canvasView().deviceRenderer().preloadDeviceImage(ot.decodePrototypeDevice(D))))))()},getNodeByIdForTests(g){var R;return(R=e.state().scene())==null?void 0:R.findNode(g)},initialLoadFrames(){return[e.state().baseScreenNode().parent().parent()]},loadFrames:(g,R)=>{let D=0,P=[];for(;g.length>0&&P.length+D<50;){let U=g.pop();if(U!=null){if(U.isTopLevel()&&(U.type()=="FRAME"||U.type()=="SLIDE")&&!U.isInternalOnly())if(U.hasBeenLoaded())D+=1;else{P.push(U);continue}(U.type()=="DOCUMENT"||U.type()=="CANVAS"||U.type()=="SECTION"||U.type()=="SLIDE_GRID"||U.type()=="SLIDE_ROW"||U.isSlideModule())&&!U.isInternalOnly()&&U.forEachChild(B=>{g.push(B)})}}return{nodesToVisit:[...g,...P],numLoaded:R+D}},areAllImagesLoaded:()=>e.state().imageManager().getImageLoadingProgress(),areAllVideosLoaded:g=>e.state().videoManager().getVideoLoadingProgress(g),getThumbnailForNode:(g,R,D)=>{var H;let P=(H=e.state().scene())==null?void 0:H.findNode(g);if(!P)return console.log("Cannot get thumbnail for node that does not exist"),null;let U=P.fullSizeCanvasSpaceBoundingBox().topLeft(),B=P.fullSize().x()/R,M=P.fullSize().y()/D,F=Math.max(B,M),w=new Gn(U,F),V=e.canvasView().thumbnailRenderer();return V?V.generateThumbnail(P,w,R,D):(console.error("Thumbnail renderer not ready"),null)},isWaitingForDeviceFrameToLoadForTesting:()=>{var R;let g=e.state().getActiveCanvas();return g==null?!1:(R=e.canvasView().deviceRenderer())==null?void 0:R.isWaitingForDeviceFrameToLoad(g.prototypeDevice())},prototypeViewHitTest:g=>{let R=new b(g.x,g.y),D=e.state().baseScreenNode();return D==null?{type:"NONE"}:e.canvasView().hitTestDeviceFrame(R)?{type:"DEVICE_FRAME"}:D.canvasSpaceBoundingBox().contains2(R)?{type:"CURRENT_TLF"}:{type:"PROTOTYPE_BACKGROUND"}},getPrototypeNode:g=>{var R;return(R=e.state().scene())==null?void 0:R.findNode(g)},getPrototypeNodeHasLoaded:g=>{var D;let R=(D=e.state().scene())==null?void 0:D.findNode(g);return(R==null?void 0:R.hasBeenLoaded())??!1},getTopmostFrameNode:g=>e.state().prototypeState().getTopmostScreen(),mapChildren:(g,R)=>{let D=[];if(g.isStack())for(let P=0,U=g.childCount();P<U;P=P+1)D.push(R(g.childAt1(P)));else for(let P=0,U=g.childCount();P<U;P=P+1)D.push(R(g.childAt1(g.childCount()-P-1)));return D},nodeId:g=>g.id(),nodeName:g=>g.name(),nodeParent:g=>g.parent(),nodeType:g=>g.type(),nodeCanvasSpaceBounds:g=>Pu(g.canvasSpacePreviewBounds()),nodeAbsoluteTransform:g=>g.absoluteTransform(),nodeDisplayBounds:g=>{let R=null;if(g.parent().type()=="CANVAS"){let D=e.state().prototypeState().getOpenOverlayData(g.id());D!=null?R=D.renderedBounds(e.state().prototypeState().getCurrentBaseScreenNode()):R=g.canvasSpaceScrolledBounds(1),R=e.canvasView().viewport().canvasSpaceToViewSpace1().transformRect(R.clone())}else{let D=g.fullSize(),P=new G(0,0,D.x(),D.y()),U=g.relativeTransform().clone(),B=J.new2();B.scale2(e.canvasView().viewport().canvasSpaceToViewSpace1().scale()),U.leftMultiply(B),R=U.transformRect(P)}return Pu(R)},nodeFullSize:g=>{if(g.type()=="CANVAS")return null;let R=g.fullSize(),D=new G(0,0,R.x(),R.y());return Pu(D)},nodeFillTypes:g=>g.fillPaints().map(R=>R.type()),nodeInteractions:g=>g.prototypeInteractions().filter(R=>R.action()!=null&&R.action().value.connectionType()!="NONE").map(R=>iL(R)),nodeScrollBounds:g=>{let R=null;if(g.hasOverflowingContentInScrollDirection()){let D=g.canvasSpaceContentBounds(),P=g.scrollOffset();R={x:P.x(),y:P.y(),width:D.width(),height:D.height()}}return R},nodeScrollTo:(g,R,D)=>{g.setScrollOffset(new b(R,D))},nodeText:g=>{var R;return(R=g==null?void 0:g.textData())==null?void 0:R.characters()},nodeVisible:g=>g==null?!1:g.visible(),nodeAccessibilityProperties:g=>({label:g.accessibleLabel()}),nodeCharacterStyles:g=>{var D,P,U;let R=(D=g==null?void 0:g.textData())==null?void 0:D.characters();if(R!=null){let B=or._new();or.set(B,6,g.get(6));let M=(P=g==null?void 0:g.textData())==null?void 0:P.characterStyleIds(),F=((U=g==null?void 0:g.textData())==null?void 0:U.styleOverrideTable())??new $r,w=M!=null?M.length:0,V=0,k=0,H=[],z=(Q,K,j)=>{let pe=new Map;or.each(B,(at,Ke)=>{pe.set(Tt[at],Ke)});let Pe=F==null?void 0:F.styleByID2();if(Pe!=null){let at=Dt.IntMap_get(Pe,j,null);at!=null&&or.each(at,(Ke,_t)=>{pe.set(Tt[Ke],_t)})}H.push({start:Q,end:K,props:pe})};for(let Q=0,K=R.length;Q<K;Q=Q+1){let j=w>Q?M[Q]:0;F._in(j)||(j=0),V!=j&&(z(k,Q,V),V=j,k=Q)}return z(k,R.length,V),H}else return[]},nodeLineData:g=>{var D;let R=(D=g==null?void 0:g.textData())==null?void 0:D.lines();return R!=null?R.map(P=>({indentLevel:P.indentationLevel,lineType:P.lineType})):null},nodeTriggerInteraction:(g,R)=>{let D=0;R=="ON_CLICK"&&(D=4);let P=e.state().prototypeStructure().findHotspotsWithInteractionType(g,0,R);for(let U of P){let B=e.state().prototypeStructure().findPrototypeInteractionsWithInteractionType(U.node,R);for(let M of B){e.canvasView().triggerHotspot(U,M,D,null);return}}},nodeHover:g=>{let R=new jo(g);e.canvasView().handleHoverAtHotspot(R)},nodeReverseHover:g=>{let R=new jo(g);e.canvasView().handleReverseHoverAtHotspot(R)},nodeTableCells:g=>{if(g.type()!="TABLE")return null;let R=[];for(let D=0,P=g.childCount();D<P;D=D+1)R.push(g.childAt1(g.childCount()-D-1));return R},nodeTableCellContent:g=>{var R,D;return g.type()!="TABLE_CELL"?null:(D=(R=g.childAt1(0))==null?void 0:R.textData())==null?void 0:D.characters()},nodeInteractiveSlideElementType:g=>g.interactiveSlideElementType(),nodeInteractiveSlideConfigData:g=>g.interactiveSlideConfigData(),nodeInteractiveSlideParticipantData:g=>g.interactiveSlideParticipantData(),nodeSlideSpeakerNotes:g=>g.slideSpeakerNotes(),nodeIsSkippedSlide:g=>g.isSkippedSlide(),nodeSlideThumbnailHash:g=>g.slideThumbnailHash(),isPresenterSession:()=>e.multiplayerSession().isPresenterSession(),userSessionId:()=>e.multiplayerSession().sessionID(),observingSessionId:()=>e.multiplayerSession().observingSessionID(),getPreviousAndNextNBaseScreenIds:g=>e.state().prototypeState().getPreviousAndNextNBaseScreenIds(g),handleEmbeddedPrototypeChange:(g,R)=>e.multiplayerSession().handleEmbeddedPrototypeChange(g,R),getActiveSlidesEmbeddedPrototype:()=>e.state().prototypeState().getActiveSlidesPrototypeEmbedGUID(),setActiveSlidesEmbeddedPrototype:g=>{e.state().prototypeState().setActiveSlidesPrototypeEmbedGUID(g)},getCurrentOverlayStack:()=>e.state().prototypeState().getCurrentOverlays().map(g=>g.node()),setFeatureFlagsForTesting:g=>{Y.setFeatureFlags(g)},setPrototypeBackgroundColorOverride:g=>{let R=O.new2(g>>16&255,g>>8&255,g&255,255);Y.setPrototypeBackgroundColorOverride(new ce(R))},resetStateForTests:()=>{e.canvasView().resetStateForTests(),e.window().resetStateForTests()},takeSpectorSnapshot:()=>{e.canvasView().viewport().invalidate(),e.canvasView().getContext().takeSpectorSnapshot()},clearTileCachesAndTakeSpectorSnapshot:()=>{e.canvasView().viewport().invalidate(),e.canvasView().clearTileCaches(),e.canvasView().getContext().takeSpectorSnapshot()},renderLayerByLayerActivate:()=>{Y.internalDebugTools()&&(e.canvasView().viewport().invalidate(),e.canvasView().clearTileCaches(),e.canvasView().renderLayerByLayerActivate())},renderLayerByLayerDeactivate:()=>{Y.internalDebugTools()&&e.canvasView().renderLayerByLayerDeactivate()},renderLayerByLayerPlay:()=>{Y.internalDebugTools()&&e.canvasView().renderLayerByLayerPlay()},renderLayerByLayerPause:()=>{Y.internalDebugTools()&&e.canvasView().renderLayerByLayerPause()},renderLayerByLayerForward:()=>{Y.internalDebugTools()&&e.canvasView().renderLayerByLayerForward()},renderLayerByLayerBackward:()=>{Y.internalDebugTools()&&e.canvasView().renderLayerByLayerBackward()},renderLayerByLayerRewind:()=>{Y.internalDebugTools()&&e.canvasView().renderLayerByLayerRewind()},renderLayerByLayerIncreaseSpeed:()=>{Y.internalDebugTools()&&e.canvasView().renderLayerByLayerIncreaseSpeed()},renderLayerByLayerDecreaseSpeed:()=>{Y.internalDebugTools()&&e.canvasView().renderLayerByLayerDecreaseSpeed()},toggleRenderTreePrinting:()=>{Y.internalDebugTools()&&e.canvasView().toggleRenderTreePrinting()},getAndClearHistogramBatchFields:()=>yi.getAndClearHistogramBatchFields(),getAndClearSlowFrameTrackerFields:()=>yi.getAndClearSlowFrameTrackerFields(),clearAllSlowFrameTrackerFields:()=>{yi.clearAllSlowFrameTrackerFields()},getViewerGpuMetricsCurrentFrameJSON:()=>JSON.stringify(e.canvasView().dangerouslyAccessProtoRenderManager().getContext().getGpuMetricsCollection().getCurrentFrameGPUMetrics()),getViewerGpuMetricsPreviousFrameJSON:()=>JSON.stringify(e.canvasView().dangerouslyAccessProtoRenderManager().getContext().getGpuMetricsCollection().getPreviousFrameGPUMetrics()),gpuMetricsNextFrame:g=>{e.canvasView().dangerouslyAccessProtoRenderManager().getContext().getGpuMetricsCollection().nextFrame(g)},setProtoUseFrameEvictionForUnitTests:g=>{Y.setProtoUseFrameEvictionForUnitTests(g)},invalidateCanvas:()=>{e.canvasView().viewport().invalidate()}};return!1,Cn.instance.setViewer(I),I}function lL(){return{prototypeApp:Cn.instance,skewKiwiSerialization:Ku(),deprecatedJsSceneHooks:Cn.instance}}function Fb(){let r=window,e=r.Fig;e||(r.Fig=e={}),e.createViewer=async t=>{if(delete e.createViewer,!(t instanceof Object))throw new Error("Missing parameters");return await sL(t)},e.getPrototypeAppBindingsForTest=()=>(delete e.getPrototypeAppBindingsForTest,lL())}var sm=class sm{setSerialization(e){this._serialization=e}decodeFillPaintData(e){if(e.length==0)return Se.EMPTY;let t=xe().decodeMessage(e);if(t.nodeChanges===void 0||t.nodeChanges.length!=1)throw new Error("Got bad node changes from C++");let n=null;try{let o=t.nodeChanges[0],i=o.fillPaints!=null?o.fillPaints:o.strokePaints;n=this._serialization.decodePaints(i,t.blobs)}catch(o){Oe("Caught error during fill paints marshaling. Rendered output may be incorrect"),Oe(o),n=Se.EMPTY}return n}decodeSingleSolidFillWithNormalBlendMode(e,t,n){if(e.alpha!=1)throw new Error("Alpha from C++ is always expected to be 1");let o=new $("SOLID");return o.setColor(O.new3(e.red,e.green,e.blue,e.alpha)),o.setOpacity(t),o.setIsEnabled(n),[o]}decodeEffectData(e){let t=xe().decodeMessage(e);if(t.nodeChanges===void 0||t.nodeChanges.length!=1)throw new Error("Got bad node changes from C++");return ot.decodeEffects(t.nodeChanges[0].effects)}decodePrototypeInteractions(e){let t=xe().decodeNodeChange(e);if(t==null)throw new Error("Got bad node change from C++");return ot.decodePrototypeInteractions(t.prototypeInteractions)}decodeVectorData(e){let t=xe().decodeMessage(e);if(t.nodeChanges===void 0||t.nodeChanges.length!=1)throw new Error("Got bad node changes from C++");return this._serialization.decodeVectorData(t.nodeChanges[0].vectorData,t.blobs)}decodeTextData(e){let t=xe().decodeMessage(e);if(t.nodeChanges===void 0||t.nodeChanges.length!=1)throw new Error("Got bad node changes from C++");let n=this._serialization.decodeTextData(t.nodeChanges[0].textData,t.blobs);return new qi(n.styleOverrideTable(),n.fontSizes(),n.characters(),n.lines(),n.characterStyleIds())}decodeDerivedTextData(e,t,n){let o=xe().decodeMessage(e);if(o.nodeChanges===void 0||o.nodeChanges.length!=1)throw new Error("Got bad node changes from C++");let i=this._serialization.decodeDerivedTextData(o.nodeChanges[0].derivedTextData,o.blobs),a=[];for(let s of t)a.push(this._serialization.decodeEmojiImage(s,n));return new ss(i.hyperlinkBoxes(),t,a)}constructor(){this._serialization=null}};sm.instance=new sm;var am=sm;function Db(){Iy(new am)}function cL(){Db(),Fb()}cL();})();
//!!!!!!!!!!!!!!!!!!!!!!
/*! Bundled license information:

diff/dist/diff.js:
  (*!
  
   diff v3.5.0
  
  Software License Agreement (BSD License)
  
  Copyright (c) 2009-2015, Kevin Decker <kpdecker@gmail.com>
  
  All rights reserved.
  
  Redistribution and use of this software in source and binary forms, with or without modification,
  are permitted provided that the following conditions are met:
  
  * Redistributions of source code must retain the above
    copyright notice, this list of conditions and the
    following disclaimer.
  
  * Redistributions in binary form must reproduce the above
    copyright notice, this list of conditions and the
    following disclaimer in the documentation and/or other
    materials provided with the distribution.
  
  * Neither the name of Kevin Decker nor the names of its
    contributors may be used to endorse or promote products
    derived from this software without specific prior
    written permission.
  
  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR
  IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND
  FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
  DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
  DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER
  IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
  OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
  @license
  *)

pako/dist/pako.esm.mjs:
  (*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) *)
*/
//# sourceMappingURL=https://admin.figma.com/admin/viewerbuild-artifacts/9073014700bf150ac2027280c8f23d3a88377df4/ts-viewer.js.map

//# debugId=b7475c6e-f46a-55d0-bf68-6170192b4ace
